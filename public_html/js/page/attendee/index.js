/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (function() { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./resources/js/page/attendee/filter.js":
/*!**********************************************!*\
  !*** ./resources/js/page/attendee/filter.js ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (obj) {\n  var data = {\n    user_type_id: []\n  };\n\n  if (_typeof(obj) === 'object' && obj != null) {\n    data = $.extend(data, obj);\n  }\n\n  $('[data-attendee] [name=\"user_type_id\"]:checked').each(function () {\n    data.user_type_id.push($(this).val());\n  });\n\n  if ($('[data-attendee] [name=\"industry_id\"]:checked').length) {\n    data.industry_id = $('[data-attendee] [name=\"industry_id\"]:checked').val();\n  } else {\n    data.industry_id = $('[data-attendee] [name=\"industry_id\"]').val();\n  }\n\n  data.name = $('[data-attendee] [name=\"name\"]').val();\n  return data;\n});//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9yZXNvdXJjZXMvanMvcGFnZS9hdHRlbmRlZS9maWx0ZXIuanMuanMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsK0RBQWUsVUFBQ0EsR0FBRCxFQUFTO0FBQ3BCLE1BQUlDLElBQUksR0FBRztBQUNQQyxJQUFBQSxZQUFZLEVBQUU7QUFEUCxHQUFYOztBQUlBLE1BQUksUUFBT0YsR0FBUCxNQUFlLFFBQWYsSUFBMkJBLEdBQUcsSUFBSSxJQUF0QyxFQUE0QztBQUN4Q0MsSUFBQUEsSUFBSSxHQUFHRSxDQUFDLENBQUNDLE1BQUYsQ0FBU0gsSUFBVCxFQUFlRCxHQUFmLENBQVA7QUFDSDs7QUFFREcsRUFBQUEsQ0FBQyxDQUFDLCtDQUFELENBQUQsQ0FBbURFLElBQW5ELENBQXdELFlBQVk7QUFDaEVKLElBQUFBLElBQUksQ0FBQ0MsWUFBTCxDQUFrQkksSUFBbEIsQ0FBdUJILENBQUMsQ0FBQyxJQUFELENBQUQsQ0FBUUksR0FBUixFQUF2QjtBQUNILEdBRkQ7O0FBSUEsTUFBSUosQ0FBQyxDQUFDLDhDQUFELENBQUQsQ0FBa0RLLE1BQXRELEVBQThEO0FBQzFEUCxJQUFBQSxJQUFJLENBQUNRLFdBQUwsR0FBbUJOLENBQUMsQ0FBQyw4Q0FBRCxDQUFELENBQWtESSxHQUFsRCxFQUFuQjtBQUNILEdBRkQsTUFFTztBQUNITixJQUFBQSxJQUFJLENBQUNRLFdBQUwsR0FBbUJOLENBQUMsQ0FBQyxzQ0FBRCxDQUFELENBQTBDSSxHQUExQyxFQUFuQjtBQUNIOztBQUVETixFQUFBQSxJQUFJLENBQUNTLElBQUwsR0FBWVAsQ0FBQyxDQUFDLCtCQUFELENBQUQsQ0FBbUNJLEdBQW5DLEVBQVo7QUFFQSxTQUFPTixJQUFQO0FBQ0gsQ0F0QkQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9yZXNvdXJjZXMvanMvcGFnZS9hdHRlbmRlZS9maWx0ZXIuanM/MjYzZSJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCAob2JqKSA9PiB7XHJcbiAgICB2YXIgZGF0YSA9IHtcclxuICAgICAgICB1c2VyX3R5cGVfaWQ6IFtdXHJcbiAgICB9O1xyXG5cclxuICAgIGlmICh0eXBlb2Ygb2JqID09PSAnb2JqZWN0JyAmJiBvYmogIT0gbnVsbCkge1xyXG4gICAgICAgIGRhdGEgPSAkLmV4dGVuZChkYXRhLCBvYmopO1xyXG4gICAgfVxyXG5cclxuICAgICQoJ1tkYXRhLWF0dGVuZGVlXSBbbmFtZT1cInVzZXJfdHlwZV9pZFwiXTpjaGVja2VkJykuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgZGF0YS51c2VyX3R5cGVfaWQucHVzaCgkKHRoaXMpLnZhbCgpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmICgkKCdbZGF0YS1hdHRlbmRlZV0gW25hbWU9XCJpbmR1c3RyeV9pZFwiXTpjaGVja2VkJykubGVuZ3RoKSB7XHJcbiAgICAgICAgZGF0YS5pbmR1c3RyeV9pZCA9ICQoJ1tkYXRhLWF0dGVuZGVlXSBbbmFtZT1cImluZHVzdHJ5X2lkXCJdOmNoZWNrZWQnKS52YWwoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZGF0YS5pbmR1c3RyeV9pZCA9ICQoJ1tkYXRhLWF0dGVuZGVlXSBbbmFtZT1cImluZHVzdHJ5X2lkXCJdJykudmFsKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZGF0YS5uYW1lID0gJCgnW2RhdGEtYXR0ZW5kZWVdIFtuYW1lPVwibmFtZVwiXScpLnZhbCgpO1xyXG5cclxuICAgIHJldHVybiBkYXRhO1xyXG59Il0sIm5hbWVzIjpbIm9iaiIsImRhdGEiLCJ1c2VyX3R5cGVfaWQiLCIkIiwiZXh0ZW5kIiwiZWFjaCIsInB1c2giLCJ2YWwiLCJsZW5ndGgiLCJpbmR1c3RyeV9pZCIsIm5hbWUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./resources/js/page/attendee/filter.js\n");

/***/ }),

/***/ "./resources/js/page/attendee/index.js":
/*!*********************************************!*\
  !*** ./resources/js/page/attendee/index.js ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var metro4__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! metro4 */ \"./node_modules/metro4/build/js/metro.js\");\n/* harmony import */ var metro4__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(metro4__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _items__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./items */ \"./resources/js/page/attendee/items.js\");\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9yZXNvdXJjZXMvanMvcGFnZS9hdHRlbmRlZS9pbmRleC5qcy5qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9yZXNvdXJjZXMvanMvcGFnZS9hdHRlbmRlZS9pbmRleC5qcz9kMTc3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1ldHJvLCBTZWxlY3QgfSBmcm9tICdtZXRybzQnO1xyXG5pbXBvcnQgJy4vaXRlbXMnOyJdLCJuYW1lcyI6WyJNZXRybyIsIlNlbGVjdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./resources/js/page/attendee/index.js\n");

/***/ }),

/***/ "./resources/js/page/attendee/items.js":
/*!*********************************************!*\
  !*** ./resources/js/page/attendee/items.js ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _filter__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./filter */ \"./resources/js/page/attendee/filter.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n\nvar Attendeeitems = {\n  init: function init() {\n    ZoneObject.create('[data-section-attendee]', {\n      run: function run() {\n        Attendeeitems.items();\n        $('[data-attendee] [name]').on('change', function () {\n          items.update('attendee');\n        });\n      }\n    });\n  },\n  html: function html(_html, data) {\n    if (_typeof(data.user) === 'object' && data.user != null) {\n      if (data.user.photo) {\n        _html.find('[html-user-photo]').html('<img src=\"' + data.user.photo + '\">');\n      }\n\n      _html.find('[html-user-name]').html(data.user.name);\n\n      _html.find('[html-user-occupation]').html(data.user.occupation);\n    }\n\n    if (_typeof(data.user) === 'object' && data.user != null && data.user.industry != null) {\n      _html.find('[attr-industry-color]').css('background', data.user.industry.color);\n    } else {\n      _html.find('[attr-industry-color]').css({\n        'background-color': 'transparent',\n        'border': '1px solid #868686'\n      });\n    }\n\n    if (_typeof(data.type) === 'object' && data.type != null) {\n      _html.find('[html-type-name]').html(data.type.name);\n    }\n\n    _html.attr('attendee-open', data.id);\n\n    return _html;\n  },\n  is_scroll_window: function is_scroll_window() {\n    return window.location.href.indexOf('attendee') > -1 || window.location.href.indexOf('account/speaker') > -1;\n  },\n  items: function (_items) {\n    function items() {\n      return _items.apply(this, arguments);\n    }\n\n    items.toString = function () {\n      return _items.toString();\n    };\n\n    return items;\n  }(function () {\n    items.create({\n      name: 'attendee',\n      scroll_window: Attendeeitems.is_scroll_window(),\n      first_load: true,\n      data: _filter__WEBPACK_IMPORTED_MODULE_0__.default,\n      html: Attendeeitems.html\n    });\n  })\n};\n$(Attendeeitems.init);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q1RXLE1BQUFBLElBQUksRUFBRSxVQURHO0FBRVRhLE1BQUFBLGFBQWEsRUFBRTNCLGFBQWEsQ0FBQ3NCLGdCQUFkLEVBRk47QUFHVE0sTUFBQUEsVUFBVSxFQUFFLElBSEg7QUFJVGxCLE1BQUFBLElBQUksRUFBRVgsNENBSkc7QUFLVFUsTUFBQUEsSUFBSSxFQUFFVCxhQUFhLENBQUNTO0FBTFgsS0FBYjtBQU9ILEdBUkk7QUE5Q1csQ0FBcEI7QUEwREFILENBQUMsQ0FBQ04sYUFBYSxDQUFDQyxJQUFmLENBQUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9yZXNvdXJjZXMvanMvcGFnZS9hdHRlbmRlZS9pdGVtcy5qcz9mYWE3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBGaWx0ZXIgZnJvbSAnLi9maWx0ZXInO1xyXG5cclxudmFyIEF0dGVuZGVlaXRlbXMgPSB7XHJcblxyXG4gICAgaW5pdDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIFpvbmVPYmplY3QuY3JlYXRlKCdbZGF0YS1zZWN0aW9uLWF0dGVuZGVlXScsIHtcclxuICAgICAgICAgICAgcnVuOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBBdHRlbmRlZWl0ZW1zLml0ZW1zKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgJCgnW2RhdGEtYXR0ZW5kZWVdIFtuYW1lXScpLm9uKCdjaGFuZ2UnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXMudXBkYXRlKCdhdHRlbmRlZScpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcblxyXG4gICAgaHRtbDogZnVuY3Rpb24gKGh0bWwsIGRhdGEpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGRhdGEudXNlciA9PT0gJ29iamVjdCcgJiYgZGF0YS51c2VyICE9IG51bGwpIHtcclxuICAgICAgICAgICAgaWYgKGRhdGEudXNlci5waG90bykge1xyXG4gICAgICAgICAgICAgICAgaHRtbC5maW5kKCdbaHRtbC11c2VyLXBob3RvXScpLmh0bWwoJzxpbWcgc3JjPVwiJyArIGRhdGEudXNlci5waG90byArICdcIj4nKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaHRtbC5maW5kKCdbaHRtbC11c2VyLW5hbWVdJykuaHRtbChkYXRhLnVzZXIubmFtZSk7XHJcbiAgICAgICAgICAgIGh0bWwuZmluZCgnW2h0bWwtdXNlci1vY2N1cGF0aW9uXScpLmh0bWwoZGF0YS51c2VyLm9jY3VwYXRpb24pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiBkYXRhLnVzZXIgPT09ICdvYmplY3QnICYmIGRhdGEudXNlciAhPSBudWxsICYmIGRhdGEudXNlci5pbmR1c3RyeSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIGh0bWwuZmluZCgnW2F0dHItaW5kdXN0cnktY29sb3JdJykuY3NzKCdiYWNrZ3JvdW5kJywgZGF0YS51c2VyLmluZHVzdHJ5LmNvbG9yKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBodG1sLmZpbmQoJ1thdHRyLWluZHVzdHJ5LWNvbG9yXScpLmNzcyh7XHJcbiAgICAgICAgICAgICAgICAnYmFja2dyb3VuZC1jb2xvcic6ICd0cmFuc3BhcmVudCcsXHJcbiAgICAgICAgICAgICAgICAnYm9yZGVyJzogJzFweCBzb2xpZCAjODY4Njg2J1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgZGF0YS50eXBlID09PSAnb2JqZWN0JyAmJiBkYXRhLnR5cGUgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBodG1sLmZpbmQoJ1todG1sLXR5cGUtbmFtZV0nKS5odG1sKGRhdGEudHlwZS5uYW1lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGh0bWwuYXR0cignYXR0ZW5kZWUtb3BlbicsIGRhdGEuaWQpO1xyXG5cclxuICAgICAgICByZXR1cm4gaHRtbDtcclxuICAgIH0sXHJcblxyXG4gICAgaXNfc2Nyb2xsX3dpbmRvdzogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCdhdHRlbmRlZScpID4gLTEgfHwgd2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZignYWNjb3VudC9zcGVha2VyJykgPiAtMTtcclxuICAgIH0sXHJcblxyXG4gICAgaXRlbXM6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpdGVtcy5jcmVhdGUoe1xyXG4gICAgICAgICAgICBuYW1lOiAnYXR0ZW5kZWUnLFxyXG4gICAgICAgICAgICBzY3JvbGxfd2luZG93OiBBdHRlbmRlZWl0ZW1zLmlzX3Njcm9sbF93aW5kb3coKSxcclxuICAgICAgICAgICAgZmlyc3RfbG9hZDogdHJ1ZSxcclxuICAgICAgICAgICAgZGF0YTogRmlsdGVyLFxyXG4gICAgICAgICAgICBodG1sOiBBdHRlbmRlZWl0ZW1zLmh0bWxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbiQoQXR0ZW5kZWVpdGVtcy5pbml0KTsiXSwibmFtZXMiOlsiRmlsdGVyIiwiQXR0ZW5kZWVpdGVtcyIsImluaXQiLCJab25lT2JqZWN0IiwiY3JlYXRlIiwicnVuIiwiaXRlbXMiLCIkIiwib24iLCJ1cGRhdGUiLCJodG1sIiwiZGF0YSIsInVzZXIiLCJwaG90byIsImZpbmQiLCJuYW1lIiwib2NjdXBhdGlvbiIsImluZHVzdHJ5IiwiY3NzIiwiY29sb3IiLCJ0eXBlIiwiYXR0ciIsImlkIiwiaXNfc2Nyb2xsX3dpbmRvdyIsIndpbmRvdyIsImxvY2F0aW9uIiwiaHJlZiIsImluZGV4T2YiLCJzY3JvbGxfd2luZG93IiwiZmlyc3RfbG9hZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./resources/js/page/attendee/items.js\n");

/***/ }),

/***/ "./node_modules/metro4/build/js/metro.js":
/*!***********************************************!*\
  !*** ./node_modules/metro4/build/js/metro.js ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, __unused_webpack_exports, __webpack_require__) {

eval("/*\r\n * Metro 4 Components Library v4.5.0  (https://metroui.org.ua)\r\n * Copyright 2012-2021 Sergey Pimenov\r\n * Built at 01/08/2021 18:53:43\r\n * Licensed under MIT\r\n */\r\n/*!\n * Datetime v1.0.0, (https://github.com/olton/DatetimeJS.git)\n * Copyright 2021 by Serhii Pimenov (https://pimenov.com.ua)\n * Datetime.js is a minimalist JavaScript library that parses, validates, manipulates, and displays dates and times for modern browsers with comfortable modern API.\n * Build at 11/01/2021 21:09:55\n * Licensed under MIT\n !*/\n(function(global) {\n    'use strict';\n\n    var DEFAULT_FORMAT = \"YYYY-MM-DDTHH:mm:ss.sss\";\n    var INVALID_DATE = \"Invalid date\";\n    var REGEX_FORMAT = /\\[([^\\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|m{1,2}|s{1,3}/g;\n\n    global['DATETIME_LOCALES'] = {\n        \"en\": {\n            months: \"January February March April May June July August September October November December\".split(\" \"),\n            monthsShort: \"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec\".split(\" \"),\n            weekdays: \"Sunday Monday Tuesday Wednesday Thursday Friday Saturday\".split(\" \"),\n            weekdaysShort: \"Sun Mon Tue Wed Thu Fri Sat\".split(\" \"),\n            weekdaysMin: \"Su Mo Tu We Th Fr Sa\".split(\" \"),\n            weekStart: 0\n        }\n    }\n\n    var M = {\n        ms: \"Milliseconds\",\n        s: \"Seconds\",\n        m: \"Minutes\",\n        h: \"Hours\",\n        D: \"Date\",\n        d: \"Day\",\n        M: \"Month\",\n        Y: \"FullYear\",\n        y: \"Year\",\n        t: \"Time\"\n    }\n\n    var C = {\n        ms: \"ms\",\n        s: \"second\",\n        m: \"minute\",\n        h: \"hour\",\n        D: \"day\",\n        W: \"week\",\n        d: \"weekDay\",\n        M: \"month\",\n        Y: \"year\",\n        Y2: \"year2\",\n        t: \"time\",\n        c: \"century\",\n        q: \"quarter\"\n    }\n\n    var lpad = function(str, pad, length){\n        var _str = \"\"+str;\n        if (length && _str.length >= length) {\n            return _str;\n        }\n        return Array((length + 1) - _str.length).join(pad) + _str;\n    }\n\n    var not = function(v){\n        return typeof v === \"undefined\" || v === null;\n    }\n    var datetime = function(){\n        var args;\n\n        if (arguments[0] instanceof Datetime) {\n            return datetime(arguments[0].value);\n        }\n\n        args = [].slice.call(Array.isArray(arguments[0]) ? arguments[0] : arguments);\n\n        return new (Function.prototype.bind.apply(Datetime,  [this].concat(args) ) );\n    }\n    var Datetime = function(){\n        var args = [].slice.call(arguments);\n        this.value = new (Function.prototype.bind.apply(Date,  [this].concat(args) ) );\n        this.locale = \"en\";\n        this.weekStart = global['DATETIME_LOCALES'][\"en\"].weekStart;\n        this.utcMode = false;\n        this.mutable = true;\n\n        if (isNaN(this.value.getTime())) {\n            throw new Error(INVALID_DATE);\n        }\n    }\n    Datetime.DEFAULT_FORMAT = DEFAULT_FORMAT;\n    Datetime.REGEX_FORMAT = REGEX_FORMAT;\n    Datetime.INVALID_DATE = INVALID_DATE;\n\n    Datetime.lpad = lpad;\n    Datetime.not = not;\n\n    Datetime.isDatetime = function(val){\n        return val instanceof Datetime;\n    }\n\n    Datetime.now = function(asDate){\n        return datetime()[asDate ? \"val\" : \"time\"]();\n    }\n\n    Datetime.locale = function(name, locale){\n        global['DATETIME_LOCALES'][name] = locale;\n    }\n\n    Datetime.getLocale = function(locale){\n        return global['DATETIME_LOCALES'][locale || \"en\"] || global['DATETIME_LOCALES'][\"en\"];\n    }\n\n    Datetime.parse = function(str){\n        return datetime(Date.parse(str));\n    }\n\n    Datetime.align = function(d, align){\n        var date = d instanceof Datetime ? d : datetime(d),\n            result, temp;\n\n        switch (align) {\n            case C.s:  result = date.ms(0); break; //second\n            case C.m:  result = Datetime.align(date, C.s)[C.s](0); break; //minute\n            case C.h:  result = Datetime.align(date, C.m)[C.m](0); break; //hour\n            case C.D:  result = Datetime.align(date, C.h)[C.h](0); break; //day\n            case C.M:  result = Datetime.align(date, C.D)[C.D](1); break; //month\n            case C.Y:  result = Datetime.align(date, C.M)[C.M](0); break; //year\n            case C.W:  {\n                temp = date.weekDay();\n                result = Datetime.align(date, C.D).addDay(-temp);\n                break; // week\n            }\n            default:   result = date;\n        }\n        return result;\n    }\n\n    Datetime.alignEnd = function(d, align){\n        var date = d instanceof Datetime ? d : datetime(d),\n            result, temp;\n\n        switch (align) {\n            case C.ms: result = date.ms(999); break; //second\n            case C.s:  result = Datetime.alignEnd(date, C.ms); break; //second\n            case C.m:  result = Datetime.alignEnd(date, C.s)[C.s](59); break; //minute\n            case C.h:  result = Datetime.alignEnd(date, C.m)[C.m](59); break; //hour\n            case C.D:  result = Datetime.alignEnd(date, C.h)[C.h](23); break; //day\n            case C.M:  result = Datetime.alignEnd(date, C.D)[C.D](1).add(1, C.M).add(-1, C.D); break; //month\n            case C.Y:  result = Datetime.alignEnd(date, C.D)[C.M](11)[C.D](31); break; //year\n            case C.W:  {\n                temp = date.weekDay();\n                result = Datetime.alignEnd(date, 'day').addDay(6 - temp);\n                break; // week\n            }\n\n            default:   result = date;\n        }\n\n        return result;\n    }\n    Datetime.extend = function(where){\n        var options, name,\n            length = arguments.length;\n\n        for (var i = 1; i < length; i++ ) {\n            if ( ( options = arguments[ i ] ) != null ) {\n                for ( name in options ) {\n                    if (Object.prototype.hasOwnProperty.call(options, name))\n                        where[ name ] = options[ name ];\n                }\n            }\n        }\n\n        return where;\n    };\n\n    Datetime.use = function(obj){\n        Datetime.extend(Datetime.prototype, obj);\n    }\n\n    Datetime.useStatic = function(obj){\n        Datetime.extend(Datetime, obj);\n    }\n\n    Datetime.prototype = {\n        immutable: function(v){\n            this.mutable = !(not(v) ? true : v);\n            return this;\n        },\n\n        utc: function(){\n            this.utcMode = true;\n            return this;\n        },\n\n        local: function(){\n            this.utcMode = false\n            return this;\n        },\n\n        useLocale: function(val){\n            if (!Datetime.getLocale(val)) {\n                console.warn(\"Locale \" + val + \" is not defined!\");\n                return this;\n            }\n            this.locale = val;\n            this.weekStart = Datetime.getLocale(val).weekStart;\n            return this;\n        },\n\n        clone: function(){\n            var c = datetime(this.value);\n            c.locale = this.locale;\n            c.weekStart = this.weekStart;\n            c.mutable = this.mutable;\n            return c;\n        },\n\n        align: function(to){\n            if (this.mutable) {\n                this.value = Datetime.align(this, to).val();\n                return this;\n            }\n\n            return this.clone().immutable(false).align(to).immutable(!this.mutable);\n        },\n\n        alignEnd: function(to){\n            if (this.mutable) {\n                this.value = Datetime.alignEnd(this, to).val();\n                return this;\n            }\n\n            return this.clone().immutable(false).alignEnd(to).immutable(!this.mutable);\n        },\n\n        val: function(val){\n            if ( !(val instanceof Date) )\n                return this.value;\n\n            if (this.mutable) {\n                this.value = val;\n                return this;\n            }\n\n            return datetime(val);\n        },\n\n        year2: function(){\n            return +(\"\"+this.year()).substr(-2);\n        },\n\n        _set: function(m, v){\n            var fn = \"set\" + (this.utcMode && m !== \"t\" ? \"UTC\" : \"\") + M[m];\n            if (this.mutable) {\n                this.value[fn](v);\n                return this;\n            }\n            var clone = this.clone();\n            clone.value[fn](v);\n            return clone;\n        },\n\n        _get: function(m){\n            var fn = \"get\" + (this.utcMode && m !== \"t\" ? \"UTC\" : \"\") + M[m];\n            return this.value[fn]();\n        },\n\n        _work: function(part, val){\n            if (!arguments.length || (typeof val === \"undefined\" || val === null)) {\n                return this._get(part);\n            }\n            return this._set(part, val);\n        },\n\n        ms: function(val){ return this._work(\"ms\", val);},\n        second: function(val){return this._work(\"s\", val);},\n        minute: function(val){return this._work(\"m\", val); },\n        hour: function(val){return this._work(\"h\", val);},\n        day: function(val){return this._work(\"D\", val);},\n        month: function(val){return this._work(\"M\", val);},\n        year: function(val){return this._work(\"Y\", val);},\n        time: function(val){return this._work(\"t\", val);},\n\n        weekDay: function(val){\n            if (!arguments.length || (not(val))) {\n                return this.utcMode ? this.value.getUTCDay() : this.value.getDay();\n            }\n\n            var curr = this.weekDay();\n            var diff = val - curr;\n\n            this.day(this.day() + diff);\n\n            return this;\n        },\n\n        get: function(unit){\n            return typeof this[unit] !== \"function\" ? this : this[unit]();\n        },\n\n        set: function(unit, val){\n            return typeof this[unit] !== \"function\" ? this : this[unit](val);\n        },\n\n        add: function(val, to){\n            switch (to) {\n                case C.h: return this.time(this.time() + (val * 60 * 60 * 1000));\n                case C.m: return this.time(this.time() + (val * 60 * 1000));\n                case C.s: return this.time(this.time() + (val * 1000));\n                case C.ms: return this.time(this.time() + (val));\n                case C.D: return this.day(this.day() + val);\n                case C.W: return this.day(this.day() + val * 7);\n                case C.M: return this.month(this.month() + val);\n                case C.Y: return this.year(this.year() + val);\n            }\n        },\n\n        addHour: function(v){return this.add(v,C.h);},\n        addMinute: function(v){return this.add(v,C.m);},\n        addSecond: function(v){return this.add(v, C.s);},\n        addMs: function(v){return this.add(v, C.ms);},\n        addDay: function(v){return this.add(v,C.D);},\n        addWeek: function(v){return this.add(v,C.W);},\n        addMonth: function(v){return this.add(v, C.M);},\n        addYear: function(v){return this.add(v, C.Y);},\n\n        format: function(fmt, locale){\n            var format = fmt || DEFAULT_FORMAT;\n            var names = Datetime.getLocale(locale || this.locale);\n            var year = this.year(), year2 = this.year2(), month = this.month(), day = this.day(), weekDay = this.weekDay();\n            var hour = this.hour(), minute = this.minute(), second = this.second(), ms = this.ms();\n            var matches = {\n                YY: year2,\n                YYYY: year,\n                M: month + 1,\n                MM: lpad(month + 1, \"0\", 2),\n                MMM: names.monthsShort[month],\n                MMMM: names.months[month],\n                D: day,\n                DD: lpad(day, \"0\", 2),\n                d: weekDay,\n                dd: names.weekdaysMin[weekDay],\n                ddd: names.weekdaysShort[weekDay],\n                dddd: names.weekdays[weekDay],\n                H: hour,\n                HH: lpad(hour, \"0\", 2),\n                m: minute,\n                mm: lpad(minute,\"0\", 2),\n                s: second,\n                ss: lpad(second,\"0\", 2),\n                sss: lpad(ms,\"0\", 3)\n            };\n\n            return format.replace(REGEX_FORMAT, function(match, $1){\n                return $1 || matches[match];\n            });\n        },\n\n        valueOf: function(){\n            return this.value.valueOf();\n        },\n\n        toString: function(){\n            return this.value.toString();\n        }\n    }\n\n    global.Datetime = Datetime;\n    global.datetime = datetime;\n\n}(typeof self === \"undefined\" ? typeof __webpack_require__.g === \"undefined\" ? window : __webpack_require__.g : self));\n(function() {\n    'use strict';\n\n    var fnFormat = Datetime.prototype.format;\n\n    Datetime.use({\n        buddhist: function(){\n            return this.year() + 543;\n        },\n\n        format: function(format, locale){\n            format = format || Datetime.DEFAULT_FORMAT;\n            var matches = {\n                BB: (this.buddhist()+\"\").slice(-2),\n                BBBB: this.buddhist()\n            }\n            var result = format.replace(/(\\[[^\\]]+])|B{4}|B{2}/g, function(match, $1){\n                return $1 || matches[match];\n            })\n            return fnFormat.bind(this)(result, locale)\n        }\n    });\n}());\r(function() {\n    'use strict';\n\n    Datetime.use({\n        calendar: function(iso){\n            return Datetime.calendar(this, iso);\n        }\n    });\n\n    Datetime.useStatic({\n        calendar: function(d, iso){\n            var date = d instanceof Datetime ? d.clone().align(\"month\") : datetime(d);\n            var ws = iso === 0 || iso ? iso : date.weekStart;\n            var wd = ws ? date.isoWeekDay() : date.weekDay();\n            var names = Datetime.getLocale(date.locale);\n            var now = datetime(), i;\n\n            var getWeekDays = function (wd, ws){\n                if (ws === 0) {\n                    return wd;\n                }\n                var su = wd[0];\n                return wd.slice(1).concat([su]);\n            }\n\n            var result = {\n                month: names.months[date.month()],\n                days: [],\n                weekstart: iso ? 1 : 0,\n                weekdays: getWeekDays(names.weekdaysMin,ws),\n                today: now.format(\"YYYY-MM-DD\"),\n                weekends: [],\n                week: []\n            };\n\n            date.addDay(ws ? -wd+1 : -wd);\n\n            for(i = 0; i < 42; i++) {\n                result.days.push(date.format(\"YYYY-MM-DD\"));\n                date.add(1, 'day');\n            }\n\n            result.weekends = result.days.filter(function(v, i){\n                var def = [0,6,7,13,14,20,21,27,28,34,35,41];\n                var iso = [5,6,12,13,19,20,26,27,33,34,40,41];\n\n                return ws === 0 ? def.indexOf(i) > -1 : iso.indexOf(i) > -1;\n            });\n\n            date = now.clone();\n            wd = ws ? date.isoWeekDay() : date.weekDay();\n            date.addDay(ws ? -wd+1 : -wd);\n            for (i = 0; i < 7; i++) {\n                result.week.push(date.format(\"YYYY-MM-DD\"));\n                date.add(1, 'day');\n            }\n\n            return result;\n        }\n    });\n}());\n\n(function() {\n    'use strict';\n\n    var oldFormat = Datetime.prototype.format;\n\n    Datetime.use({\n        century: function(){\n            return parseInt(this.year() / 100);\n        },\n\n        format: function(format, locale){\n            format = format || Datetime.DEFAULT_FORMAT;\n            var matches = {\n                C: this.century()\n            }\n            var result = format.replace(/(\\[[^\\]]+])|C/g, function(match, $1){\n                return $1 || matches[match];\n            })\n            return oldFormat.bind(this)(result, locale)\n        }\n    })\n}());\n(function() {\n    'use strict';\n\n    Datetime.use({\n        same: function(d){\n            return this.time() === datetime(d).time();\n        },\n        compare: function(d, align, operator){\n            var date = datetime(d);\n            var curr = datetime(this.value);\n            var t1, t2;\n\n            operator = operator || \"=\";\n\n            if ([\"<\", \">\", \">=\", \"<=\", \"=\", \"!=\"].indexOf(operator) === -1) {\n                operator = \"=\";\n            }\n\n            align = (align || \"ms\").toLowerCase();\n\n            t1 = curr.align(align).time();\n            t2 = date.align(align).time();\n\n            switch (operator) {\n                case \"<\":\n                    return t1 < t2;\n                case \">\":\n                    return t1 > t2;\n                case \"<=\":\n                    return t1 <= t2;\n                case \">=\":\n                    return t1 >= t2;\n                case \"=\":\n                    return t1 === t2;\n                case \"!=\":\n                    return t1 !== t2;\n            }\n        },\n\n        between: function(d1, d2){\n            return this.younger(d1) && this.older(d2);\n        },\n\n        older: function(date, align){\n            return this.compare(date, align, \"<\");\n        },\n\n        olderOrEqual: function(date, align){\n            return this.compare(date, align, \"<=\");\n        },\n\n        younger: function(date, align){\n            return this.compare(date, align, \">\");\n        },\n\n        youngerOrEqual: function(date, align){\n            return this.compare(date, align, \">=\");\n        },\n\n        equal: function(date, align){\n            return this.compare(date, align, \"=\");\n        },\n\n        notEqual: function(date, align){\n            return this.compare(date, align, \"!=\");\n        },\n\n        diff: function(d){\n            var date = datetime(d);\n            var diff = Math.abs(this.time() - date.time());\n            var diffMonth = Math.abs(this.month() - date.month() + (12 * (this.year() - date.year())));\n\n            return {\n                \"ms\": diff,\n                \"second\": Math.ceil(diff / 1000),\n                \"minute\": Math.ceil(diff / (1000 * 60)),\n                \"hour\": Math.ceil(diff / (1000 * 60 * 60)),\n                \"day\": Math.ceil(diff / (1000 * 60 * 60 * 24)),\n                \"month\": diffMonth,\n                \"year\": Math.floor(diffMonth / 12)\n            }\n        },\n\n        distance: function(d, align){\n            return this.diff(d)[align];\n        }\n    })\n}());\n(function() {\n    'use strict';\n\n    Datetime.use({\n        dayOfYear: function(){\n            var dayCount = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];\n            var month = this.month();\n            var day = this.day();\n            return dayCount[month] + day + ((month > 1 && this.isLeapYear()) ? 1 : 0);\n        }\n    })\n}());\n(function() {\n    'use strict';\n\n    Datetime.use({\n        daysInMonth: function(){\n            var curr = datetime(this.value);\n            return curr.add(1, 'month').day(1).add(-1, 'day').day();\n        },\n\n        daysInYear: function(){\n            return this.isLeapYear() ? 366 : 365;\n        },\n\n        daysInYearMap: function(){\n            var result = [];\n            var curr = datetime(this.value);\n\n            curr.month(0).day(1);\n\n            for(var i = 0; i < 12; i++) {\n                curr.add(1, 'month').add(-1, 'day');\n                result.push(curr.day());\n                curr.day(1).add(1, 'month');\n            }\n            return result;\n        },\n\n        daysInYearObj: function(locale, shortName){\n            var map = this.daysInYearMap();\n            var result = {};\n            var names = Datetime.getLocale(locale || this.locale);\n\n            map.forEach(function(v, i){\n                result[names[shortName ? 'monthsShort' : 'months'][i]] = v;\n            });\n\n            return result;\n        }\n    })\n}());\n(function() {\n    'use strict';\n\n    Datetime.use({\n        decade: function(){\n            return Math.floor(this.year()/10) * 10;\n        },\n\n        decadeStart: function(){\n            var decade = this.decade();\n            var result = this.mutable ? this : this.clone();\n\n            return result.year(decade).month(0).day(1);\n        },\n\n        decadeEnd: function(){\n            var decade = this.decade() + 9;\n            var result = this.mutable ? this : this.clone();\n\n            return result.year(decade).month(11).day(31);\n        },\n\n        decadeOfMonth: function(){\n            var part = this.clone().add(1, \"month\").day(1).add(-1, 'day').day() / 3;\n            var day = this.day();\n\n            if (day <= part) return 1;\n            if (day <= part * 2) return 2;\n            return 3;\n        }\n    })\n}());\n(function() {\n    'use strict';\n\n    Datetime.useStatic({\n        from: function(str, format, locale){\n            var norm, normFormat, fItems, dItems;\n            var iMonth, iDay, iYear, iHour, iMinute, iSecond, iMs;\n            var year, month, day, hour, minute, second, ms;\n            var parsedMonth;\n\n            var getIndex = function(where, what){\n                return where.map(function(el){\n                    return el.toLowerCase();\n                }).indexOf(what.toLowerCase());\n            }\n\n            var monthNameToNumber = function(month){\n                var i = -1;\n                var names = Datetime.getLocale(locale || 'en');\n\n                if (Datetime.not(month)) return -1;\n\n                i = getIndex(names.months, month);\n\n                if (i === -1 && typeof names[\"monthsParental\"] !== \"undefined\") {\n                    i = getIndex(names.monthsParental, month);\n                }\n\n                if (i === -1) {\n                    month = month.substr(0, 3);\n                    i = getIndex(names.monthsShort, month);\n                }\n\n                return i === -1 ? -1 : i + 1;\n            };\n\n            var getPartIndex = function(part){\n                var parts = {\n                    \"month\": [\"M\", \"mm\", \"%m\"],\n                    \"day\": [\"D\", \"dd\", \"%d\"],\n                    \"year\": [\"YY\", \"YYYY\", \"yy\", \"yyyy\", \"%y\"],\n                    \"hour\": [\"h\", \"hh\", \"%h\"],\n                    \"minute\": [\"m\", \"mi\", \"i\", \"ii\", \"%i\"],\n                    \"second\": [\"s\", \"ss\", \"%s\"],\n                    \"ms\": [\"sss\"]\n                }\n\n                var result = -1, key, index;\n\n                for(var i = 0; i < parts[part].length; i++) {\n                    key = parts[part][i];\n                    index = fItems.indexOf(key);\n                    if (index !== -1) {\n                        result = index;\n                        break;\n                    }\n                }\n\n                return result;\n            }\n\n            if (Datetime.not(format) || (\"\"+format).trim() === \"\") {\n                return datetime();\n            }\n            norm = str.replace(/[\\/,.:\\s]/g, '-');\n            normFormat = format.toLowerCase().replace(/[^a-zA-Z0-9%]/g, '-');\n            fItems = normFormat.split('-');\n            dItems = norm.split('-');\n\n            if (norm.replace(/-/g,\"\").trim() === \"\") {\n                throw new Error(Datetime.INVALID_DATE);\n            }\n\n            iMonth = getPartIndex(\"month\");\n            iDay = getPartIndex(\"day\");\n            iYear = getPartIndex(\"year\");\n            iHour = getPartIndex(\"hour\");\n            iMinute = getPartIndex(\"minute\");\n            iSecond = getPartIndex(\"second\");\n            iMs = getPartIndex(\"ms\");\n\n            if (iMonth > -1 && dItems[iMonth]) {\n                if (isNaN(parseInt(dItems[iMonth]))) {\n                    dItems[iMonth] = monthNameToNumber(dItems[iMonth]);\n                    if (dItems[iMonth] === -1) {\n                        iMonth = -1;\n                    }\n                } else {\n                    parsedMonth = parseInt(dItems[iMonth]);\n                    if (parsedMonth < 1 || parsedMonth > 12) {\n                        iMonth = -1;\n                    }\n                }\n            } else {\n                iMonth = -1;\n            }\n\n            year  = iYear > -1 && dItems[iYear] ? dItems[iYear] : 0;\n            month = iMonth > -1 && dItems[iMonth] ? dItems[iMonth] : 1;\n            day   = iDay > -1 && dItems[iDay] ? dItems[iDay] : 1;\n\n            hour    = iHour > -1 && dItems[iHour] ? dItems[iHour] : 0;\n            minute  = iMinute > -1 && dItems[iMinute] ? dItems[iMinute] : 0;\n            second  = iSecond > -1 && dItems[iSecond] ? dItems[iSecond] : 0;\n            ms  = iMs > -1 && dItems[iMs] ? dItems[iMs] : 0;\n\n            return datetime(year, month-1, day, hour, minute, second, ms);\n        }\n    })\n}());\n(function() {\n    'use strict';\n\n    var fnFormat = Datetime.prototype.format;\n    var lpad = Datetime.lpad;\n\n    Datetime.use({\n        ampm: function(isLowerCase){\n            var val = this.hour() < 12 ? \"AM\" : \"PM\";\n            return isLowerCase ? val.toLowerCase() : val;\n        },\n\n        hour12: function(h, p){\n            var hour = h;\n\n            if (arguments.length === 0) {\n                return this.hour() % 12;\n            }\n\n            p = p || 'am';\n\n            if (p.toLowerCase() === \"pm\") {\n                hour += 12;\n            }\n\n            return this.hour(hour);\n        },\n\n        format: function(format, locale){\n            var matches, result, h12 = this.hour12();\n\n            format = format || Datetime.DEFAULT_FORMAT;\n\n            matches = {\n                a: \"[\"+this.ampm(true)+\"]\",\n                A: \"[\"+this.ampm(false)+\"]\",\n                h: h12,\n                hh: lpad(h12, \"0\", 2)\n            };\n\n            result = format.replace(/(\\[[^\\]]+])|a|A|h{1,2}/g, function(match, $1){\n                return $1 || matches[match];\n            });\n\n            return fnFormat.bind(this)(result, locale)\n        }\n    })\n}());\n(function() {\n    'use strict';\n\n    Datetime.use({\n        isLeapYear: function(){\n            var year = this.year();\n            return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;\n        }\n    })\n}());\n(function() {\n    'use strict';\n\n    var fnFormat = Datetime.prototype.format;\n    var fnAlign = Datetime.align;\n    var fnAlignEnd = Datetime.alignEnd;\n\n    Datetime.useStatic({\n        align: function(d, align){\n            var date = d instanceof Datetime ? d : datetime(d),\n                result, temp;\n\n            switch(align) {\n                case \"isoWeek\":\n                    temp = date.isoWeekDay();\n                    result = fnAlign(date, 'day').addDay(-temp + 1);\n                    break; // isoWeek\n\n                default: result = fnAlign.apply(this, [date, align]);\n            }\n\n            return result;\n        },\n\n        alignEnd: function(d, align){\n            var date = d instanceof Datetime ? d : datetime(d),\n                result, temp;\n\n            switch(align) {\n                case \"isoWeek\":\n                    temp = date.isoWeekDay();\n                    result = fnAlignEnd(date, 'day').addDay(7 - temp);\n                    break; // isoWeek\n\n                default: result = fnAlignEnd.apply(this, [date, align]);\n            }\n\n            return result;\n        }\n    })\n\n    Datetime.use({\n        isoWeekDay: function(val){\n            var wd = (this.weekDay() + 6) % 7 + 1;\n\n            if (!arguments.length || (Datetime.not(val))) {\n                return wd;\n            }\n\n            return this.addDay(val - wd);\n        },\n\n        format: function(format, locale){\n            format = format || Datetime.DEFAULT_FORMAT;\n            var matches = {\n                I: this.isoWeekDay()\n            }\n            var result = format.replace(/(\\[[^\\]]+])|I{1,2}/g, function(match, $1){\n                return $1 || matches[match];\n            })\n            return fnFormat.bind(this)(result, locale)\n        }\n    })\n}());\n(function() {\n    'use strict';\n\n    Datetime.useStatic({\n        max: function(){\n            var arr = [].slice.call(arguments);\n\n            return arr.map(function(el){\n                return datetime(el);\n            }).sort(function(a, b){\n                return b.time() - a.time()\n            })[0];\n        }\n    });\n\n    Datetime.use({\n        max: function(){\n            return Datetime.max.apply(this, [this].concat([].slice.call(arguments)));\n        }\n    });\n}());\n(function() {\n    'use strict';\n\n    Datetime.useStatic({\n        min: function(){\n            var arr = [].slice.call(arguments);\n\n            return arr.map(function(el){\n                return datetime(el);\n            }).sort(function(a, b){\n                return a.time() - b.time()\n            })[0];\n        }\n    });\n\n    Datetime.use({\n        min: function(){\n            return Datetime.min.apply(this, [this].concat([].slice.call(arguments)));\n        }\n    })\n}());\n(function() {\n    'use strict';\n\n    var fnAlign = Datetime.align;\n    var fnAlignEnd = Datetime.alignEnd;\n    var fnAdd = Datetime.prototype.add;\n\n    Datetime.useStatic({\n        align: function(d, align){\n            var date = d instanceof Datetime ? d : datetime(d),\n                result;\n\n            switch(align) {\n                case \"quarter\":  result = Datetime.align(date, 'day').day(1).month(date.quarter() * 3 - 3); break; //quarter\n                default: result = fnAlign.apply(this, [date, align]);\n            }\n\n            return result;\n        },\n\n        alignEnd: function(d, align){\n            var date = d instanceof Datetime ? d : datetime(d),\n                result;\n\n            switch(align) {\n                case \"quarter\":  result = Datetime.align(date, 'quarter').add(3, 'month').add(-1, 'ms'); break; //quarter\n                default: result = fnAlignEnd.apply(this, [date, align]);\n            }\n\n            return result;\n        }\n    })\n\n    Datetime.use({\n        quarter: function(){\n            var month = this.month();\n\n            if (month <= 2) return 1;\n            if (month <= 5) return 2;\n            if (month <= 8) return 3;\n            return 4;\n        },\n\n        add: function(val, to){\n            if (to === \"quarter\") {\n                return this.month(this.month() + val * 3);\n            }\n            return fnAdd.bind(this)(val, to);\n        },\n\n        addQuarter: function(v){\n            return this.add(v, \"quarter\");\n        }\n    })\n}());\n(function() {\n    'use strict';\n\n    Datetime.useStatic({\n        sort: function(arr, opt){\n            var result, _arr;\n            var o = {};\n\n            if (typeof opt === \"string\" || typeof opt !== \"object\" || Datetime.not(opt)) {\n                o.format = Datetime.DEFAULT_FORMAT;\n                o.dir = opt && opt.toUpperCase() === \"DESC\" ? \"DESC\" : \"ASC\";\n                o.returnAs = \"datetime\";\n            } else {\n                o.format = opt.format || Datetime.DEFAULT_FORMAT;\n                o.dir = (opt.dir || \"ASC\").toUpperCase();\n                o.returnAs = opt.format ? \"string\" : opt.returnAs || \"datetime\";\n            }\n\n            _arr =  arr.map(function(el){\n                return datetime(el);\n            }).sort(function(a, b){\n                return a.valueOf() - b.valueOf();\n            });\n\n            if (o.dir === \"DESC\") {\n                _arr.reverse();\n            }\n\n            switch (o.returnAs) {\n                case \"string\":\n                    result = _arr.map(function(el){\n                        return el.format(o.format)\n                    });\n                    break;\n                case \"date\":\n                    result = _arr.map(function(el){\n                        return el.val();\n                    });\n                    break;\n\n                default: result = _arr;\n            }\n\n            return result;\n        }\n    })\n}());\n(function() {\n    'use strict';\n\n    var REGEX_FORMAT_STRFTIME = /(%[a-z])/gi;\n    var DEFAULT_FORMAT_STRFTIME = \"%Y-%m-%dT%H:%M:%S.%Q%t\";\n\n    var lpad = Datetime.lpad;\n\n    Datetime.use({\n        strftime: function(fmt, locale){\n            var format = fmt || DEFAULT_FORMAT_STRFTIME;\n            var names = Datetime.getLocale(locale || this.locale);\n            var year = this.year(), year2 = this.year2(), month = this.month(), day = this.day(), weekDay = this.weekDay();\n            var hour = this.hour(), hour12 = this.hour12(), minute = this.minute(), second = this.second(), ms = this.ms(), time = this.time();\n            var aDay = lpad(day, \"0\", 2),\n                aMonth = lpad(month + 1, \"0\", 2),\n                aHour = lpad(hour, \"0\", 2),\n                aHour12 = lpad(hour12, \"0\", 2),\n                aMinute = lpad(minute, \"0\", 2),\n                aSecond = lpad(second, \"0\", 2),\n                aMs = lpad(ms, \"0\", 3);\n\n            var that = this;\n\n            var thursday = function(){\n                var target = datetime(that.value);\n                target.day(that.day() - ((that.weekDay() + 6) % 7) + 3);\n                return target;\n            };\n\n            var matches = {\n                '%a': names.weekdaysShort[weekDay],\n                '%A': names.weekdays[weekDay],\n                '%b': names.monthsShort[month],\n                '%h': names.monthsShort[month],\n                '%B': names.months[month],\n                '%c': this.toString().substring(0, this.toString().indexOf(\" (\")),\n                '%C': this.century(),\n                '%d': aDay,\n                '%D': [aDay, aMonth, year].join(\"/\"),\n                '%e': day,\n                '%F': [year, aMonth, aDay].join(\"-\"),\n                '%G': thursday().year(),\n                '%g': (\"\"+thursday().year()).slice(2),\n                '%H': aHour,\n                '%I': aHour12,\n                '%j': lpad(this.dayOfYear(), \"0\", 3),\n                '%k': aHour,\n                '%l': aHour12,\n                '%m': aMonth,\n                '%n': month + 1,\n                '%M': aMinute,\n                '%p': this.ampm(),\n                '%P': this.ampm(true),\n                '%s': Math.round(time / 1000),\n                '%S': aSecond,\n                '%u': this.isoWeekDay(),\n                '%V': this.isoWeekNumber(),\n                '%w': weekDay,\n                '%x': this.toLocaleDateString(),\n                '%X': this.toLocaleTimeString(),\n                '%y': year2,\n                '%Y': year,\n                '%z': this.timezone().replace(\":\", \"\"),\n                '%Z': this.timezoneName(),\n                '%r': [aHour12, aMinute, aSecond].join(\":\") + \" \" + this.ampm(),\n                '%R': [aHour, aMinute].join(\":\"),\n                \"%T\": [aHour, aMinute, aSecond].join(\":\"),\n                \"%Q\": aMs,\n                \"%q\": ms,\n                \"%t\": this.timezone()\n            };\n\n            return format.replace(REGEX_FORMAT_STRFTIME, function(match){\n                return (matches[match] === 0 || matches[match] ? matches[match] : match);\n            });\n        }\n    });\n}());\n(function() {\n    'use strict';\n\n    var fnFormat = Datetime.prototype.format;\n\n    Datetime.use({\n        utcOffset: function(){\n            return this.value.getTimezoneOffset();\n        },\n\n        timezone: function(){\n            return this.toTimeString().replace(/.+GMT([+-])(\\d{2})(\\d{2}).+/, '$1$2:$3');\n        },\n\n        timezoneName: function(){\n            return this.toTimeString().replace(/.+\\((.+?)\\)$/, '$1');\n        },\n\n        format: function(format, locale){\n            format = format || Datetime.DEFAULT_FORMAT;\n\n            var matches = {\n                Z: this.utcMode ? \"Z\" : this.timezone(),\n                ZZ: this.timezone().replace(\":\", \"\"),\n                ZZZ: \"[GMT]\"+this.timezone(),\n                z: this.timezoneName()\n            }\n            var result = format.replace(/(\\[[^\\]]+])|Z{1,3}|z/g, function(match, $1){\n                return $1 || matches[match];\n            })\n\n            return fnFormat.bind(this)(result, locale)\n        }\n    })\n}());\n(function() {\n    'use strict';\n\n    Datetime.useStatic({\n        isToday: function(date){\n            var d = datetime(date).align(\"day\");\n            var c = datetime().align('day');\n\n            return d.time() === c.time();\n        }\n    })\n\n    Datetime.use({\n        isToday: function(){\n            return Datetime.isToday(this);\n        },\n\n        today: function(){\n            var now = datetime();\n            if (!this.mutable) {\n                return now;\n            }\n            return this.val(now.val());\n        }\n    })\n}());\n(function() {\n    'use strict';\n\n    Datetime.useStatic({\n        isTomorrow: function(date){\n            var d = datetime(date).align(\"day\");\n            var c = datetime().align('day').add(1, 'day');\n\n            return d.time() === c.time();\n        }\n    });\n\n    Datetime.use({\n        isTomorrow: function(){\n            return Datetime.isTomorrow(this);\n        },\n\n        tomorrow: function(){\n            if (!this.mutable) {\n                return this.clone().add(1, 'day');\n            }\n            return this.add(1, 'day');\n        }\n    });\n}());\n(function() {\n    'use strict';\n\n    Datetime.use({\n        toDateString: function(){\n            return this.value.toDateString();\n        },\n\n        toISOString: function(){\n            return this.value.toISOString();\n        },\n\n        toJSON: function(){\n            return this.value.toJSON();\n        },\n\n        toGMTString: function(){\n            return this.value.toGMTString();\n        },\n\n        toLocaleDateString: function(){\n            return this.value.toLocaleDateString();\n        },\n\n        toLocaleString: function(){\n            return this.value.toLocaleString();\n        },\n\n        toLocaleTimeString: function(){\n            return this.value.toLocaleTimeString();\n        },\n\n        toTimeString: function(){\n            return this.value.toTimeString();\n        },\n\n        toUTCString: function(){\n            return this.value.toUTCString();\n        },\n\n        toDate: function(){\n            return new Date(this.value);\n        }\n    });\n}());\n(function() {\n    'use strict';\n\n    Datetime.useStatic({\n        timestamp: function(){\n            return new Date().getTime() / 1000;\n        }\n    })\n\n    Datetime.use({\n        unix: function(val) {\n            var _val;\n\n            if (!arguments.length || (Datetime.not(val))) {\n                return Math.floor(this.valueOf() / 1000)\n            }\n\n            _val = val * 1000;\n\n            if (this.mutable) {\n                return this.time(_val);\n            }\n\n            return datetime(this.value).time(_val);\n        },\n\n        timestamp: function(){\n            return this.unix();\n        }\n    });\n}());\n(function() {\n    'use strict';\n\n    var fnFormat = Datetime.prototype.format;\n    var lpad = Datetime.lpad;\n\n    Datetime.use({\n        weekNumber: function (weekStart) {\n            var nYear, nday, newYear, day, daynum, weeknum;\n\n            weekStart = +weekStart || 0;\n            newYear = datetime(this.year(), 0, 1);\n            day = newYear.weekDay() - weekStart;\n            day = (day >= 0 ? day : day + 7);\n            daynum = Math.floor(\n                (this.time() - newYear.time() - (this.utcOffset() - newYear.utcOffset()) * 60000) / 86400000\n            ) + 1;\n\n            if(day < 4) {\n                weeknum = Math.floor((daynum + day - 1) / 7) + 1;\n                if(weeknum > 52) {\n                    nYear = datetime(this.year() + 1, 0, 1);\n                    nday = nYear.weekDay() - weekStart;\n                    nday = nday >= 0 ? nday : nday + 7;\n                    weeknum = nday < 4 ? 1 : 53;\n                }\n            }\n            else {\n                weeknum = Math.floor((daynum + day - 1) / 7);\n            }\n            return weeknum;\n        },\n\n        isoWeekNumber: function(){\n            return this.weekNumber(1);\n        },\n\n        weeksInYear: function(weekStart){\n            var curr = datetime(this.value);\n            return curr.month(11).day(31).weekNumber(weekStart);\n        },\n\n        format: function(format, locale){\n            var matches, result, wn = this.weekNumber(), wni = this.isoWeekNumber();\n\n            format = format || Datetime.DEFAULT_FORMAT;\n\n            matches = {\n                W: wn,\n                WW: lpad(wn, \"0\", 2),\n                WWW: wni,\n                WWWW: lpad(wni, \"0\", 2)\n            };\n\n            result = format.replace(/(\\[[^\\]]+])|W{1,4}/g, function(match, $1){\n                return $1 || matches[match];\n            });\n\n            return fnFormat.bind(this)(result, locale)\n        }\n    })\n}());\n(function() {\n    'use strict';\n\n    Datetime.useStatic({\n        isYesterday: function(date){\n            var d = datetime(date).align(\"day\");\n            var c = datetime().align('day').add(-1, 'day');\n\n            return d.time() === c.time();\n        }\n    });\n\n    Datetime.use({\n        isYesterday: function(){\n            return Datetime.isYesterday(this);\n        },\n\n        yesterday: function(){\n            if (!this.mutable) {\n                return this.clone().add(-1, 'day');\n            }\n            return this.add(-1, 'day');\n        }\n    })\n}());\n\r\n\r\n(function() {\n    'use strict';\n\n    var getLocale = Datetime.getLocale;\n\n    Datetime.getLocale = function(locale){\n        var data;\n\n        if (!Metro) {\n            locale = 'en';\n            return getLocale.call(this, locale);\n        }\n\n        if (!Metro.locales[locale]) {\n            locale = \"en-US\";\n        }\n\n        data = Metro.locales[locale]['calendar'];\n\n        return {\n            months: data.months.filter( function(el, i){ return i < 12} ),\n            monthsShort: data.months.filter( function(el, i){ return i > 11} ),\n            weekdays: data.days.filter( function(el, i){ return i < 7} ),\n            weekdaysShort: data.days.filter( function(el, i){ return i > 13} ),\n            weekdaysMin: data.days.filter( function(el, i){ return i > 6 && i < 14} ),\n            weekStart: data.weekStart\n        }\n    }\n}());\r\n\r\n/*! \n * Cake string library 1.0.0\n * https://github.com/olton/cake\n *\n * Copyright 2020-2021 Serhii Pimenov\n * Released under the MIT license\n */\n\n(function () {\n    'use strict';\n\n    var isNull = function isNull(val) {\n      return val === undefined || val === null;\n    };\n\n    /**\n     * A regular expression string matching digits\n     */\n    var digit = '\\\\d';\n    /**\n     * A regular expression string matching whitespace\n     */\n\n    var whitespace = \"\\\\s\\\\uFEFF\\\\xA0\";\n    /**\n     * A regular expression string matching diacritical mark\n     */\n\n    var diacriticalMark = \"\\\\u0300-\\\\u036F\\\\u1AB0-\\\\u1AFF\\\\u1DC0-\\\\u1DFF\\\\u20D0-\\\\u20FF\\\\uFE20-\\\\uFE2F\";\n    /**\n     * A regular expression to match the General Punctuation Unicode block\n     */\n\n    var generalPunctuationBlock = \"\\\\u2000-\\\\u206F\";\n    /**\n     * A regular expression to match non characters from from Basic Latin and Latin-1 Supplement Unicode blocks\n     */\n\n    var nonCharacter = '\\\\x00-\\\\x2F\\\\x3A-\\\\x40\\\\x5B-\\\\x60\\\\x7b-\\\\xBF\\\\xD7\\\\xF7';\n    /**\n     * A regular expression to match the dingbat Unicode block\n     */\n\n    var dingbatBlock = \"\\\\u2700-\\\\u27BF\";\n    /**\n     * A regular expression string that matches lower case letters: LATIN\n     */\n\n    var lowerCaseLetter = \"a-z\\\\xB5\\\\xDF-\\\\xF6\\\\xF8-\\\\xFF\\\\u0101\\\\u0103\\\\u0105\\\\u0107\\\\u0109\\\\u010B\\\\u010D\\\\u010F\\\\u0111\\\\u0113\\\\u0115\\\\u0117\\\\u0119\\\\u011B\\\\u011D\\\\u011F\\\\u0121\\\\u0123\\\\u0125\\\\u0127\\\\u0129\\\\u012B\\\\u012D\\\\u012F\\\\u0131\\\\u0133\\\\u0135\\\\u0137\\\\u0138\\\\u013A\\\\u013C\\\\u013E\\\\u0140\\\\u0142\\\\u0144\\\\u0146\\\\u0148\\\\u0149\\\\u014B\\\\u014D\\\\u014F\\\\u0151\\\\u0153\\\\u0155\\\\u0157\\\\u0159\\\\u015B\\\\u015D\\\\u015F\\\\u0161\\\\u0163\\\\u0165\\\\u0167\\\\u0169\\\\u016B\\\\u016D\\\\u016F\\\\u0171\\\\u0173\\\\u0175\\\\u0177\\\\u017A\\\\u017C\\\\u017E-\\\\u0180\\\\u0183\\\\u0185\\\\u0188\\\\u018C\\\\u018D\\\\u0192\\\\u0195\\\\u0199-\\\\u019B\\\\u019E\\\\u01A1\\\\u01A3\\\\u01A5\\\\u01A8\\\\u01AA\\\\u01AB\\\\u01AD\\\\u01B0\\\\u01B4\\\\u01B6\\\\u01B9\\\\u01BA\\\\u01BD-\\\\u01BF\\\\u01C6\\\\u01C9\\\\u01CC\\\\u01CE\\\\u01D0\\\\u01D2\\\\u01D4\\\\u01D6\\\\u01D8\\\\u01DA\\\\u01DC\\\\u01DD\\\\u01DF\\\\u01E1\\\\u01E3\\\\u01E5\\\\u01E7\\\\u01E9\\\\u01EB\\\\u01ED\\\\u01EF\\\\u01F0\\\\u01F3\\\\u01F5\\\\u01F9\\\\u01FB\\\\u01FD\\\\u01FF\\\\u0201\\\\u0203\\\\u0205\\\\u0207\\\\u0209\\\\u020B\\\\u020D\\\\u020F\\\\u0211\\\\u0213\\\\u0215\\\\u0217\\\\u0219\\\\u021B\\\\u021D\\\\u021F\\\\u0221\\\\u0223\\\\u0225\\\\u0227\\\\u0229\\\\u022B\\\\u022D\\\\u022F\\\\u0231\\\\u0233-\\\\u0239\\\\u023C\\\\u023F\\\\u0240\\\\u0242\\\\u0247\\\\u0249\\\\u024B\\\\u024D\\\\u024F\";\n    /**\n     * A regular expression string that matches upper case letters: LATIN\n     */\n\n    var upperCaseLetter = \"\\\\x41-\\\\x5a\\\\xc0-\\\\xd6\\\\xd8-\\\\xde\\\\u0100\\\\u0102\\\\u0104\\\\u0106\\\\u0108\\\\u010a\\\\u010c\\\\u010e\\\\u0110\\\\u0112\\\\u0114\\\\u0116\\\\u0118\\\\u011a\\\\u011c\\\\u011e\\\\u0120\\\\u0122\\\\u0124\\\\u0126\\\\u0128\\\\u012a\\\\u012c\\\\u012e\\\\u0130\\\\u0132\\\\u0134\\\\u0136\\\\u0139\\\\u013b\\\\u013d\\\\u013f\\\\u0141\\\\u0143\\\\u0145\\\\u0147\\\\u014a\\\\u014c\\\\u014e\\\\u0150\\\\u0152\\\\u0154\\\\u0156\\\\u0158\\\\u015a\\\\u015c\\\\u015e\\\\u0160\\\\u0162\\\\u0164\\\\u0166\\\\u0168\\\\u016a\\\\u016c\\\\u016e\\\\u0170\\\\u0172\\\\u0174\\\\u0176\\\\u0178\\\\u0179\\\\u017b\\\\u017d\\\\u0181\\\\u0182\\\\u0184\\\\u0186\\\\u0187\\\\u0189-\\\\u018b\\\\u018e-\\\\u0191\\\\u0193\\\\u0194\\\\u0196-\\\\u0198\\\\u019c\\\\u019d\\\\u019f\\\\u01a0\\\\u01a2\\\\u01a4\\\\u01a6\\\\u01a7\\\\u01a9\\\\u01ac\\\\u01ae\\\\u01af\\\\u01b1-\\\\u01b3\\\\u01b5\\\\u01b7\\\\u01b8\\\\u01bc\\\\u01c4\\\\u01c5\\\\u01c7\\\\u01c8\\\\u01ca\\\\u01cb\\\\u01cd\\\\u01cf\\\\u01d1\\\\u01d3\\\\u01d5\\\\u01d7\\\\u01d9\\\\u01db\\\\u01de\\\\u01e0\\\\u01e2\\\\u01e4\\\\u01e6\\\\u01e8\\\\u01ea\\\\u01ec\\\\u01ee\\\\u01f1\\\\u01f2\\\\u01f4\\\\u01f6-\\\\u01f8\\\\u01fa\\\\u01fc\\\\u01fe\\\\u0200\\\\u0202\\\\u0204\\\\u0206\\\\u0208\\\\u020a\\\\u020c\\\\u020e\\\\u0210\\\\u0212\\\\u0214\\\\u0216\\\\u0218\\\\u021a\\\\u021c\\\\u021e\\\\u0220\\\\u0222\\\\u0224\\\\u0226\\\\u0228\\\\u022a\\\\u022c\\\\u022e\\\\u0230\\\\u0232\\\\u023a\\\\u023b\\\\u023d\\\\u023e\\\\u0241\\\\u0243-\\\\u0246\\\\u0248\\\\u024a\\\\u024c\\\\u024e\";\n\n    /**\n     * Regular expression to match whitespaces from the left side\n     */\n\n    var REGEXP_TRIM_LEFT = new RegExp('^[' + whitespace + ']+');\n    /**\n     * Regular expression to match whitespaces from the right side\n     */\n\n    var REGEXP_TRIM_RIGHT = new RegExp('[' + whitespace + ']+$');\n    /**\n     * Regular expression to match digit characters\n     */\n\n    var REGEXP_DIGIT = new RegExp('^' + digit + '+$');\n    /**\n     * Regular expression to match HTML special characters.\n     */\n\n    var REGEXP_HTML_SPECIAL_CHARACTERS = /[<>&\"'`]/g;\n    var REGEXP_TAGS = /(<([^>]+)>)/ig;\n    /**\n     * Regular expression to match Unicode words\n     */\n\n    var REGEXP_WORD = new RegExp('(?:[' + upperCaseLetter + '][' + diacriticalMark + ']*)?(?:[' + lowerCaseLetter + '][' + diacriticalMark + ']*)+|\\\n(?:[' + upperCaseLetter + '][' + diacriticalMark + ']*)+(?![' + lowerCaseLetter + '])|\\\n[' + digit + ']+|\\\n[' + dingbatBlock + ']|\\\n[^' + nonCharacter + generalPunctuationBlock + whitespace + ']+', 'g');\n    /**\n     * Regular expression to match words from Basic Latin and Latin-1 Supplement blocks\n     */\n\n    var REGEXP_LATIN_WORD = /[A-Z\\xC0-\\xD6\\xD8-\\xDE]?[a-z\\xDF-\\xF6\\xF8-\\xFF]+|[A-Z\\xC0-\\xD6\\xD8-\\xDE]+(?![a-z\\xDF-\\xF6\\xF8-\\xFF])|\\d+/g;\n    /**\n     * Regular expression to match alpha characters\n     */\n\n    var REGEXP_ALPHA = new RegExp('^(?:[' + lowerCaseLetter + upperCaseLetter + '][' + diacriticalMark + ']*)+$');\n    /**\n     * Regular expression to match alpha and digit characters\n     */\n\n    var REGEXP_ALPHA_DIGIT = new RegExp('^((?:[' + lowerCaseLetter + upperCaseLetter + '][' + diacriticalMark + ']*)|[' + digit + '])+$');\n    /**\n     * Regular expression to match Extended ASCII characters, i.e. the first 255\n     */\n\n    var REGEXP_EXTENDED_ASCII = /^[\\x01-\\xFF]*$/;\n\n    function nvl(val, def) {\n      return isNull(val) ? def : val;\n    }\n\n    function toStr(val) {\n      var def = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"\";\n      if (isNull(val)) return def;\n      if (typeof val === \"string\") return val;\n      if (Array.isArray(val)) return val.join(\"\");\n      return JSON.stringify(val);\n    }\n\n    /*\n    * Split string to words. You can set specified patter to split\n    * */\n\n    function words(s, pattern, flags) {\n      var regexp;\n\n      if (isNull(pattern)) {\n        regexp = REGEXP_EXTENDED_ASCII.test(s) ? REGEXP_LATIN_WORD : REGEXP_WORD;\n      } else if (pattern instanceof RegExp) {\n        regexp = pattern;\n      } else {\n        regexp = new RegExp(pattern, nvl(flags, ''));\n      }\n\n      return nvl(toStr(s).match(regexp), []);\n    }\n\n    function capitalize(s, strong) {\n      var _s = toStr(s);\n\n      var last = _s.substr(1);\n\n      return _s.substr(0, 1).toUpperCase() + (strong ? last.toLowerCase() : last);\n    }\n\n    function camelCase(s) {\n      return words(toStr(s)).map(function (el, i) {\n        return i === 0 ? el.toLowerCase() : capitalize(el);\n      }).join(\"\");\n    }\n\n    function dashedName(s) {\n      return words(toStr(s)).map(function (el) {\n        return el.toLowerCase();\n      }).join(\"-\");\n    }\n\n    function decapitalize(s) {\n      var _s = toStr(s);\n\n      return _s.substr(0, 1).toLowerCase() + _s.substr(1);\n    }\n\n    function kebab(s) {\n      return words(toStr(s)).map(function (el) {\n        return el.toLowerCase();\n      }).join(\"-\");\n    }\n\n    function lower(s) {\n      return toStr(s).toLowerCase();\n    }\n\n    /*\n    * Split string to chars array with ignores\n    * */\n\n    function chars(s) {\n      var ignore = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n      return toStr(s).split(\"\").filter(function (el) {\n        return !ignore.includes(el);\n      });\n    }\n\n    function reverse(s, ignore) {\n      return chars(toStr(s), ignore).reverse().join(\"\");\n    }\n\n    function _typeof(obj) {\n      \"@babel/helpers - typeof\";\n\n      if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n        _typeof = function (obj) {\n          return typeof obj;\n        };\n      } else {\n        _typeof = function (obj) {\n          return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n        };\n      }\n\n      return _typeof(obj);\n    }\n\n    function _classCallCheck(instance, Constructor) {\n      if (!(instance instanceof Constructor)) {\n        throw new TypeError(\"Cannot call a class as a function\");\n      }\n    }\n\n    function _defineProperties(target, props) {\n      for (var i = 0; i < props.length; i++) {\n        var descriptor = props[i];\n        descriptor.enumerable = descriptor.enumerable || false;\n        descriptor.configurable = true;\n        if (\"value\" in descriptor) descriptor.writable = true;\n        Object.defineProperty(target, descriptor.key, descriptor);\n      }\n    }\n\n    function _createClass(Constructor, protoProps, staticProps) {\n      if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n      if (staticProps) _defineProperties(Constructor, staticProps);\n      return Constructor;\n    }\n\n    function _defineProperty(obj, key, value) {\n      if (key in obj) {\n        Object.defineProperty(obj, key, {\n          value: value,\n          enumerable: true,\n          configurable: true,\n          writable: true\n        });\n      } else {\n        obj[key] = value;\n      }\n\n      return obj;\n    }\n\n    function _toConsumableArray(arr) {\n      return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n    }\n\n    function _arrayWithoutHoles(arr) {\n      if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n    }\n\n    function _iterableToArray(iter) {\n      if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n    }\n\n    function _unsupportedIterableToArray(o, minLen) {\n      if (!o) return;\n      if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n      var n = Object.prototype.toString.call(o).slice(8, -1);\n      if (n === \"Object\" && o.constructor) n = o.constructor.name;\n      if (n === \"Map\" || n === \"Set\") return Array.from(o);\n      if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n    }\n\n    function _arrayLikeToArray(arr, len) {\n      if (len == null || len > arr.length) len = arr.length;\n\n      for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n      return arr2;\n    }\n\n    function _nonIterableSpread() {\n      throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n    }\n\n    function shuffleArray (a) {\n      var _a = _toConsumableArray(a);\n\n      var i = _a.length,\n          t,\n          r;\n\n      while (0 !== i) {\n        r = Math.floor(Math.random() * i);\n        i -= 1;\n        t = _a[i];\n        _a[i] = _a[r];\n        _a[r] = t;\n      }\n\n      return _a;\n    }\n\n    function shuffle(s) {\n      var _s = toStr(s);\n\n      return shuffleArray(_s.split(\"\")).join(\"\");\n    }\n\n    function snake(s) {\n      return words(toStr(s)).map(function (el) {\n        return el.toLowerCase();\n      }).join(\"_\");\n    }\n\n    var _swap = function _swap(swapped, _char) {\n      var lc = _char.toLowerCase();\n\n      var uc = _char.toUpperCase();\n\n      return swapped + (_char === lc ? uc : lc);\n    };\n\n    function swap(s) {\n      return toStr(s).split(\"\").reduce(_swap, '');\n    }\n\n    function title(s, noSplit) {\n      var _s = toStr(s);\n\n      var regexp = REGEXP_EXTENDED_ASCII.test(_s) ? REGEXP_LATIN_WORD : REGEXP_WORD;\n      var noSplitArray = Array.isArray(noSplit) ? noSplit : isNull(noSplit) ? [] : noSplit.split();\n      return s.replace(regexp, function (w, i) {\n        var isNoSplit = i && noSplitArray.includes(_s[i - 1]);\n        return isNoSplit ? lower(w) : capitalize(w);\n      });\n    }\n\n    function upper(s) {\n      return toStr(s).toUpperCase();\n    }\n\n    function wrapTag(s) {\n      var tag = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"div\";\n      return \"<\".concat(tag, \">\").concat(toStr(s), \"</\").concat(tag, \">\");\n    }\n\n    function wrap(s) {\n      var before = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"\";\n      var after = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"\";\n      return before + toStr(s) + after;\n    }\n\n    /*\n    * Get string length\n    * */\n\n    function count(s) {\n      return toStr(s).length;\n    }\n\n    function un (a) {\n      var _a = _toConsumableArray(a);\n\n      for (var i = 0; i < _a.length; ++i) {\n        for (var j = i + 1; j < _a.length; ++j) {\n          if (_a[i] === _a[j]) _a.splice(j--, 1);\n        }\n      }\n\n      return _a;\n    }\n\n    function countChars(s, ignore) {\n      return chars(s, ignore).length;\n    }\n    function countUniqueChars(s, ignore) {\n      return un(chars(s, ignore)).length;\n    }\n\n    function countSubstr(s, sub) {\n      var _s = toStr(s);\n\n      var _sub = toStr(sub);\n\n      return _s === '' || _sub === '' ? 0 : _s.split(_sub).length - 1;\n    }\n\n    function countWords(s, pattern, flags) {\n      return words(s, pattern, flags).length;\n    }\n    function countUniqueWords(s, pattern, flags) {\n      return un(words(s, pattern, flags)).length;\n    }\n\n    var escapeCharactersMap = {\n      '<': '&lt;',\n      '>': '&gt;',\n      '&': '&amp;',\n      '\"': '&quot;',\n      \"'\": '&#x27;',\n      '`': '&#x60;'\n    };\n\n    function replaceSpecialCharacter(character) {\n      return escapeCharactersMap[character];\n    }\n\n    function escapeHtml(s) {\n      return toStr(s).replace(REGEXP_HTML_SPECIAL_CHARACTERS, replaceSpecialCharacter);\n    }\n\n    var unescapeCharsMap = {\n      '<': /(&lt;)|(&#x0*3c;)|(&#0*60;)/gi,\n      '>': /(&gt;)|(&#x0*3e;)|(&#0*62;)/gi,\n      '&': /(&amp;)|(&#x0*26;)|(&#0*38;)/gi,\n      '\"': /(&quot;)|(&#x0*22;)|(&#0*34;)/gi,\n      \"'\": /(&#x0*27;)|(&#0*39;)/gi,\n      '`': /(&#x0*60;)|(&#0*96;)/gi\n    };\n    var chars$1 = Object.keys(unescapeCharsMap);\n\n    function reduceUnescapedString(string, key) {\n      return string.replace(unescapeCharsMap[key], key);\n    }\n\n    function unescapeHtml(s) {\n      return chars$1.reduce(reduceUnescapedString, toStr(s));\n    }\n\n    function unique(s, ignore) {\n      return un(chars(s, ignore)).join(\"\");\n    }\n\n    function uniqueWords(s, pattern, flags) {\n      return un(words(s, pattern, flags)).join(\"\");\n    }\n\n    /*\n    * Get substring from string.\n    * */\n\n    function substr(s, start, len) {\n      var _s = toStr(s);\n\n      return _s.substr(start, len);\n    }\n\n    /*\n    * Get N first chars from string.\n    * */\n\n    function first(s, len) {\n      var _s = toStr(s);\n\n      return _s ? substr(_s, 0, len) : '';\n    }\n\n    /*\n    * Get N last chars from string.\n    * */\n\n    function last(s, len) {\n      var _s = toStr(s);\n\n      return _s ? substr(_s, _s.length - len) : '';\n    }\n\n    var MAX_SAFE_INTEGER = 0x1fffffffffffff;\n\n    function clip(val, min) {\n      var max = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : MAX_SAFE_INTEGER;\n      if (val < min) return min;\n      if (val > max) return max;\n      return val;\n    }\n\n    function toInt(val) {\n      if (val === Infinity) return MAX_SAFE_INTEGER;\n      if (val === -Infinity) return -MAX_SAFE_INTEGER;\n      return ~~val;\n    }\n\n    /*\n    * Truncates `subject` to a new `length` with specified ending.\n    * */\n\n    function truncate(s, len) {\n      var end = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '...';\n\n      var _s = toStr(s);\n\n      var _len = isNull(len) || isNaN(len) ? _s.length : clip(toInt(len), 0, MAX_SAFE_INTEGER);\n\n      return substr(_s, 0, _len) + (_s.length === _len ? '' : end);\n    }\n\n    /*\n    * Slice string to N parts.\n    * */\n\n    function slice(s) {\n      var parts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n\n      var _s = toStr(s);\n\n      var res = [];\n      var len = Math.round(_s.length / parts);\n\n      for (var i = 0; i < parts; i++) {\n        res.push(substr(_s, i * len, len));\n      }\n\n      return res;\n    }\n\n    /*\n    * Truncates `subject` to a new `length` and does not break the words with specified ending.\n    * */\n\n    function prune(s, len) {\n      var end = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"\";\n\n      var _s = toStr(s);\n\n      var _len = isNull(len) || isNaN(len) ? _s.length : clip(toInt(len), 0, MAX_SAFE_INTEGER);\n\n      var _truncatedLen = 0;\n      var pattern = REGEXP_EXTENDED_ASCII.test(_s) ? REGEXP_LATIN_WORD : REGEXP_WORD;\n\n      _s.replace(pattern, function (word, offset) {\n        var wordLength = offset + word.length;\n\n        if (wordLength <= _len - end.length) {\n          _truncatedLen = wordLength;\n        }\n      });\n\n      return _s.substr(0, _truncatedLen) + end;\n    }\n\n    function repeat(s, times) {\n      var _s = toStr(s);\n\n      var _times = isNull(times) || isNaN(times) ? _s.length : clip(toInt(times), 0, MAX_SAFE_INTEGER);\n\n      var _origin = _s;\n\n      if (times === 0) {\n        return \"\";\n      }\n\n      for (var i = 0; i < _times - 1; i++) {\n        _s += _origin;\n      }\n\n      return _s;\n    }\n\n    function padBuilder(pad, len) {\n      var padLength = pad.length;\n      var length = len - padLength;\n      return repeat(pad, length + 1).substr(0, len);\n    }\n\n    function pad(s, len) {\n      var pad = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : ' ';\n\n      var _s = toStr(s);\n\n      var _len = isNull(len) || isNaN(len) ? _s.length : clip(toInt(len), 0, MAX_SAFE_INTEGER);\n\n      var _padLen = pad.length;\n\n      var _paddingLen = _len - _s.length;\n\n      var _sideLen = toInt(_paddingLen / 2); //?\n\n\n      var _remainingLen = _paddingLen % 2; //?\n\n\n      if (_paddingLen <= 0 || _padLen === 0) {\n        return _s;\n      }\n\n      return padBuilder(pad, _sideLen) + _s + padBuilder(pad, _sideLen + _remainingLen); //?\n    }\n\n    var _pad = function _pad(s, len, pad, left) {\n      var _s = toStr(s);\n\n      var _len = isNull(len) || isNaN(len) ? _s.length : clip(toInt(len), 0, MAX_SAFE_INTEGER);\n\n      var _padLen = pad.length;\n\n      var _paddingLen = _len - _s.length;\n\n      var _sideLen = _paddingLen;\n\n      if (_paddingLen <= 0 || _padLen === 0) {\n        return _s;\n      }\n\n      var pads = padBuilder(pad, _sideLen);\n      return left ? pads + _s : _s + pads;\n    };\n\n    function lpad(s, len) {\n      var pad = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : ' ';\n      return _pad(s, len, pad, true);\n    }\n    function rpad(s, len) {\n      var pad = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : ' ';\n      return _pad(s, len, pad, false);\n    }\n\n    function insert(s) {\n      var sbj = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n      var pos = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n      var _s = toStr(s);\n\n      return _s.substr(0, pos) + sbj + _s.substr(pos);\n    }\n\n    var reduce = Array.prototype.reduce;\n    var reduceRight = Array.prototype.reduceRight;\n    function trim(s, ws) {\n      return ltrim(rtrim(s, ws), ws);\n    }\n    function ltrim(s, ws) {\n      var _s = toStr(s);\n\n      if (isNull(ws)) {\n        return _s.replace(REGEXP_TRIM_LEFT, '');\n      }\n\n      if (ws === '' || _s === '') {\n        return _s;\n      }\n\n      if (typeof ws !== \"string\") {\n        ws = '';\n      }\n\n      var match = true;\n      return reduce.call(_s, function (trimmed, _char) {\n        if (match && ws.includes(_char)) {\n          return trimmed;\n        }\n\n        match = false;\n        return trimmed + _char;\n      }, '');\n    }\n    function rtrim(s, ws) {\n      var _s = toStr(s);\n\n      if (isNull(ws)) {\n        return _s.replace(REGEXP_TRIM_RIGHT, '');\n      }\n\n      if (ws === '' || _s === '') {\n        return _s;\n      }\n\n      if (typeof ws !== \"string\") {\n        ws = '';\n      }\n\n      var match = true;\n      return reduceRight.call(_s, function (trimmed, _char2) {\n        if (match && ws.includes(_char2)) {\n          return trimmed;\n        }\n\n        match = false;\n        return _char2 + trimmed;\n      }, '');\n    }\n\n    function endsWith(s, end, pos) {\n      var _s = toStr(s);\n\n      return _s.endsWith(end, pos);\n    }\n\n    function isAlpha(s) {\n      return REGEXP_ALPHA.test(toStr(s));\n    }\n\n    function isAlphaDigit(s) {\n      return REGEXP_ALPHA_DIGIT.test(toStr(s));\n    }\n\n    function isAlphaDigit$1(s) {\n      return REGEXP_DIGIT.test(toStr(s));\n    }\n\n    function isBlank(s) {\n      return trim(s).length === 0;\n    }\n\n    function isEmpty(s) {\n      return toStr(s).length === 0;\n    }\n\n    function isLower(s) {\n      var _s = toStr(s);\n\n      return _s.toLowerCase() === _s;\n    }\n\n    function isUpper(s) {\n      var _s = toStr(s);\n\n      return _s.toUpperCase() === _s;\n    }\n\n    function startWith(s, start, pos) {\n      var _s = toStr(s);\n\n      return _s.startsWith(start, pos);\n    }\n\n    function stripTagsAll(s) {\n      var _s = toStr(s);\n\n      return _s.replace(REGEXP_TAGS, '');\n    }\n    function stripTags(s) {\n      var allowed = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n      var _s = toStr(s);\n\n      var tags = /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi;\n      return _s.replace(tags, function ($0, $1) {\n\n        return allowed.includes($1) ? $0 : '';\n      });\n    }\n\n    /*\n    * Original code\n    * copyright (c) 2007-present by Alexandru Mărășteanu <hello@alexei.ro>\n    * Source: https://github.com/alexei/sprintf.js\n    * License: BSD-3-Clause License\n    * */\n    var re = {\n      not_string: /[^s]/,\n      not_bool: /[^t]/,\n      not_type: /[^T]/,\n      not_primitive: /[^v]/,\n      number: /[diefg]/,\n      numeric_arg: /[bcdiefguxX]/,\n      json: /[j]/,\n      not_json: /[^j]/,\n      text: /^[^\\x25]+/,\n      modulo: /^\\x25{2}/,\n      placeholder: /^\\x25(?:([1-9]\\d*)\\$|\\(([^)]+)\\))?(\\+)?(0|'[^$])?(-)?(\\d+)?(?:\\.(\\d+))?([b-gijostTuvxX])/,\n      key: /^([a-z_][a-z_\\d]*)/i,\n      key_access: /^\\.([a-z_][a-z_\\d]*)/i,\n      index_access: /^\\[(\\d+)\\]/,\n      sign: /^[+-]/\n    };\n\n    function sprintf_format(parse_tree, argv) {\n      var cursor = 1,\n          tree_length = parse_tree.length,\n          arg,\n          output = '',\n          ph,\n          pad,\n          pad_character,\n          pad_length,\n          is_positive,\n          sign;\n\n      for (var i = 0; i < tree_length; i++) {\n        if (typeof parse_tree[i] === 'string') {\n          output += parse_tree[i];\n        } else if (_typeof(parse_tree[i]) === 'object') {\n          ph = parse_tree[i]; // convenience purposes only\n\n          if (ph.keys) {\n            // keyword argument\n            arg = argv[cursor];\n\n            for (var k = 0; k < ph.keys.length; k++) {\n              if (typeof arg === \"undefined\") {\n                throw new Error(sprintf('[sprintf] Cannot access property \"%s\" of undefined value \"%s\"', ph.keys[k], ph.keys[k - 1]));\n              }\n\n              arg = arg[ph.keys[k]];\n            }\n          } else if (ph.param_no) {\n            // positional argument (explicit)\n            arg = argv[ph.param_no];\n          } else {\n            // positional argument (implicit)\n            arg = argv[cursor++];\n          }\n\n          if (re.not_type.test(ph.type) && re.not_primitive.test(ph.type) && arg instanceof Function) {\n            arg = arg();\n          }\n\n          if (re.numeric_arg.test(ph.type) && typeof arg !== 'number' && isNaN(arg)) {\n            throw new TypeError(sprintf('[sprintf] expecting number but found %T', arg));\n          }\n\n          if (re.number.test(ph.type)) {\n            is_positive = arg >= 0;\n          }\n\n          switch (ph.type) {\n            case 'b':\n              arg = parseInt(arg, 10).toString(2);\n              break;\n\n            case 'c':\n              arg = String.fromCharCode(parseInt(arg, 10));\n              break;\n\n            case 'd':\n            case 'i':\n              arg = parseInt(arg, 10);\n              break;\n\n            case 'j':\n              arg = JSON.stringify(arg, null, ph.width ? parseInt(ph.width) : 0);\n              break;\n\n            case 'e':\n              arg = ph.precision ? parseFloat(arg).toExponential(ph.precision) : parseFloat(arg).toExponential();\n              break;\n\n            case 'f':\n              arg = ph.precision ? parseFloat(arg).toFixed(ph.precision) : parseFloat(arg);\n              break;\n\n            case 'g':\n              arg = ph.precision ? String(Number(arg.toPrecision(ph.precision))) : parseFloat(arg);\n              break;\n\n            case 'o':\n              arg = (parseInt(arg, 10) >>> 0).toString(8);\n              break;\n\n            case 's':\n              arg = String(arg);\n              arg = ph.precision ? arg.substring(0, ph.precision) : arg;\n              break;\n\n            case 't':\n              arg = String(!!arg);\n              arg = ph.precision ? arg.substring(0, ph.precision) : arg;\n              break;\n\n            case 'T':\n              arg = Object.prototype.toString.call(arg).slice(8, -1).toLowerCase();\n              arg = ph.precision ? arg.substring(0, ph.precision) : arg;\n              break;\n\n            case 'u':\n              arg = parseInt(arg, 10) >>> 0;\n              break;\n\n            case 'v':\n              arg = arg.valueOf();\n              arg = ph.precision ? arg.substring(0, ph.precision) : arg;\n              break;\n\n            case 'x':\n              arg = (parseInt(arg, 10) >>> 0).toString(16);\n              break;\n\n            case 'X':\n              arg = (parseInt(arg, 10) >>> 0).toString(16).toUpperCase();\n              break;\n          }\n\n          if (re.json.test(ph.type)) {\n            output += arg;\n          } else {\n            if (re.number.test(ph.type) && (!is_positive || ph.sign)) {\n              sign = is_positive ? '+' : '-';\n              arg = arg.toString().replace(re.sign, '');\n            } else {\n              sign = '';\n            }\n\n            pad_character = ph.pad_char ? ph.pad_char === '0' ? '0' : ph.pad_char.charAt(1) : ' ';\n            pad_length = ph.width - (sign + arg).length;\n            pad = ph.width ? pad_length > 0 ? pad_character.repeat(pad_length) : '' : '';\n            output += ph.align ? sign + arg + pad : pad_character === '0' ? sign + pad + arg : pad + sign + arg;\n          }\n        }\n      }\n\n      return output;\n    }\n\n    var sprintf_cache = Object.create(null);\n\n    function sprintf_parse(fmt) {\n      if (sprintf_cache[fmt]) {\n        return sprintf_cache[fmt];\n      }\n\n      var _fmt = fmt,\n          match,\n          parse_tree = [],\n          arg_names = 0;\n\n      while (_fmt) {\n        if ((match = re.text.exec(_fmt)) !== null) {\n          parse_tree.push(match[0]);\n        } else if ((match = re.modulo.exec(_fmt)) !== null) {\n          parse_tree.push('%');\n        } else if ((match = re.placeholder.exec(_fmt)) !== null) {\n          if (match[2]) {\n            arg_names |= 1;\n            var field_list = [],\n                replacement_field = match[2],\n                field_match = [];\n\n            if ((field_match = re.key.exec(replacement_field)) !== null) {\n              field_list.push(field_match[1]);\n\n              while ((replacement_field = replacement_field.substring(field_match[0].length)) !== '') {\n                if ((field_match = re.key_access.exec(replacement_field)) !== null) {\n                  field_list.push(field_match[1]);\n                } else if ((field_match = re.index_access.exec(replacement_field)) !== null) {\n                  field_list.push(field_match[1]);\n                } else {\n                  throw new SyntaxError('[sprintf] failed to parse named argument key');\n                }\n              }\n            } else {\n              throw new SyntaxError('[sprintf] failed to parse named argument key');\n            }\n\n            match[2] = field_list;\n          } else {\n            arg_names |= 2;\n          }\n\n          if (arg_names === 3) {\n            throw new Error('[sprintf] mixing positional and named placeholders is not (yet) supported');\n          }\n\n          parse_tree.push({\n            placeholder: match[0],\n            param_no: match[1],\n            keys: match[2],\n            sign: match[3],\n            pad_char: match[4],\n            align: match[5],\n            width: match[6],\n            precision: match[7],\n            type: match[8]\n          });\n        } else {\n          throw new SyntaxError('[sprintf] unexpected placeholder');\n        }\n\n        _fmt = _fmt.substring(match[0].length);\n      }\n\n      return sprintf_cache[fmt] = parse_tree;\n    }\n\n    function sprintf(key) {\n      return sprintf_format(sprintf_parse(key), arguments);\n    }\n    function vsprintf(fmt, argv) {\n      return sprintf.apply(null, [fmt].concat(argv || []));\n    }\n\n    function includes(s, sub, pos) {\n      var _s = toStr(s);\n\n      return _s.includes(sub, pos);\n    }\n\n    var functions = {\n      camelCase: camelCase,\n      capitalize: capitalize,\n      chars: chars,\n      count: count,\n      countChars: countChars,\n      countUniqueChars: countUniqueChars,\n      countSubstr: countSubstr,\n      countWords: countWords,\n      countUniqueWords: countUniqueWords,\n      dashedName: dashedName,\n      decapitalize: decapitalize,\n      kebab: kebab,\n      lower: lower,\n      reverse: reverse,\n      shuffle: shuffle,\n      snake: snake,\n      swap: swap,\n      title: title,\n      upper: upper,\n      words: words,\n      wrap: wrap,\n      wrapTag: wrapTag,\n      escapeHtml: escapeHtml,\n      unescapeHtml: unescapeHtml,\n      unique: unique,\n      uniqueWords: uniqueWords,\n      substr: substr,\n      first: first,\n      last: last,\n      truncate: truncate,\n      slice: slice,\n      prune: prune,\n      repeat: repeat,\n      pad: pad,\n      lpad: lpad,\n      rpad: rpad,\n      insert: insert,\n      trim: trim,\n      ltrim: ltrim,\n      rtrim: rtrim,\n      endsWith: endsWith,\n      isAlpha: isAlpha,\n      isAlphaDigit: isAlphaDigit,\n      isDigit: isAlphaDigit$1,\n      isBlank: isBlank,\n      isEmpty: isEmpty,\n      isLower: isLower,\n      isUpper: isUpper,\n      startWith: startWith,\n      stripTags: stripTags,\n      stripTagsAll: stripTagsAll,\n      sprintf: sprintf,\n      vsprintf: vsprintf,\n      includes: includes\n    };\n\n    var __global = null;\n\n    function getGlobalObject() {\n      if (__global !== null) {\n        return __global;\n      }\n\n      if ((typeof __webpack_require__.g === \"undefined\" ? \"undefined\" : _typeof(__webpack_require__.g)) === 'object' && __webpack_require__.g.Object === Object) {\n        __global = __webpack_require__.g;\n      } else if ((typeof self === \"undefined\" ? \"undefined\" : _typeof(self)) === 'object' && self.Object === Object) {\n        __global = self;\n      } else {\n        __global = new Function('return this')();\n      }\n\n      return __global;\n    }\n\n    var _Symbol$toPrimitive, _Symbol$toStringTag;\n    _Symbol$toPrimitive = Symbol.toPrimitive;\n    _Symbol$toStringTag = Symbol.toStringTag;\n\n    var Cake = /*#__PURE__*/function () {\n      function Cake() {\n        var s = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n\n        _classCallCheck(this, Cake);\n\n        _defineProperty(this, \"_value\", void 0);\n\n        this._value = \"\" + s;\n      }\n\n      _createClass(Cake, [{\n        key: _Symbol$toPrimitive,\n        value: function value(hint) {\n          if (hint === \"number\") {\n            return +this.value;\n          }\n\n          return this.value;\n        }\n      }, {\n        key: \"toString\",\n        value: function toString() {\n          return this.value;\n        }\n        /* escape */\n\n      }, {\n        key: \"escapeHtml\",\n        value: function escapeHtml() {\n          this.value = functions.escapeHtml(this.value);\n          return this;\n        }\n      }, {\n        key: \"unescapeHtml\",\n        value: function unescapeHtml() {\n          this.value = functions.unescapeHtml(this.value);\n          return this;\n        }\n        /* end of escape */\n\n      }, {\n        key: \"camelCase\",\n        value: function camelCase() {\n          this.value = functions.camelCase(this.value);\n          return this;\n        }\n      }, {\n        key: \"capitalize\",\n        value: function capitalize(strong) {\n          this.value = functions.capitalize(this.value, strong);\n          return this;\n        }\n      }, {\n        key: \"chars\",\n        value: function chars() {\n          return functions.chars(this.value);\n        }\n      }, {\n        key: \"count\",\n        value: function count() {\n          return functions.count(this.value);\n        }\n      }, {\n        key: \"countChars\",\n        value: function countChars(ignore) {\n          return functions.countChars(this.value, ignore);\n        }\n      }, {\n        key: \"countUniqueChars\",\n        value: function countUniqueChars(ignore) {\n          return functions.countUniqueChars(this.value, ignore);\n        }\n      }, {\n        key: \"countSubstr\",\n        value: function countSubstr(sub) {\n          return functions.countSubstr(this.value, sub);\n        }\n      }, {\n        key: \"countWords\",\n        value: function countWords(pattern, flags) {\n          return functions.countWords(this.value, pattern, flags);\n        }\n      }, {\n        key: \"countUniqueWords\",\n        value: function countUniqueWords(pattern, flags) {\n          return functions.countUniqueWords(this.value, pattern, flags);\n        }\n      }, {\n        key: \"dashedName\",\n        value: function dashedName() {\n          this.value = functions.dashedName(this.value);\n          return this;\n        }\n      }, {\n        key: \"decapitalize\",\n        value: function decapitalize() {\n          this.value = functions.decapitalize(this.value);\n          return this;\n        }\n      }, {\n        key: \"kebab\",\n        value: function kebab() {\n          this.value = functions.kebab(this.value);\n          return this;\n        }\n      }, {\n        key: \"lower\",\n        value: function lower() {\n          this.value = functions.lower(this.value);\n          return this;\n        }\n      }, {\n        key: \"reverse\",\n        value: function reverse() {\n          this.value = functions.reverse(this.value);\n          return this;\n        }\n      }, {\n        key: \"shuffle\",\n        value: function shuffle() {\n          this.value = functions.shuffle(this.value);\n          return this;\n        }\n      }, {\n        key: \"snake\",\n        value: function snake() {\n          this.value = functions.snake(this.value);\n          return this;\n        }\n      }, {\n        key: \"swap\",\n        value: function swap() {\n          this.value = functions.swap(this.value);\n          return this;\n        }\n      }, {\n        key: \"title\",\n        value: function title() {\n          this.value = functions.title(this.value);\n          return this;\n        }\n      }, {\n        key: \"upper\",\n        value: function upper() {\n          this.value = functions.upper(this.value);\n          return this;\n        }\n      }, {\n        key: \"words\",\n        value: function words(pattern, flags) {\n          return functions.words(this.value, pattern, flags);\n        }\n      }, {\n        key: \"wrap\",\n        value: function wrap(a, b) {\n          this.value = functions.wrap(this.value, a, b);\n          return this;\n        }\n      }, {\n        key: \"wrapTag\",\n        value: function wrapTag(t) {\n          this.value = functions.wrapTag(this.value, t);\n          return this;\n        }\n      }, {\n        key: \"pad\",\n        value: function pad(len, _pad) {\n          this.value = functions.pad(this.value, len, _pad);\n          return this;\n        }\n      }, {\n        key: \"lpad\",\n        value: function lpad(len, pad) {\n          this.value = functions.lpad(this.value, len, pad);\n          return this;\n        }\n      }, {\n        key: \"rpad\",\n        value: function rpad(len, pad) {\n          this.value = functions.rpad(this.value, len, pad);\n          return this;\n        }\n      }, {\n        key: \"repeat\",\n        value: function repeat(times) {\n          this.value = functions.repeat(this.value, times);\n          return this;\n        }\n      }, {\n        key: \"prune\",\n        value: function prune(len, end) {\n          this.value = functions.prune(this.value, len, end);\n          return this;\n        }\n      }, {\n        key: \"slice\",\n        value: function slice(parts) {\n          return functions.slice(this.value, parts);\n        }\n      }, {\n        key: \"truncate\",\n        value: function truncate(len, end) {\n          this.value = functions.truncate(this.value, len, end);\n          return this;\n        }\n      }, {\n        key: \"last\",\n        value: function last(len) {\n          this.value = functions.last(this.value, len);\n          return this;\n        }\n      }, {\n        key: \"first\",\n        value: function first(len) {\n          this.value = functions.first(this.value, len);\n          return this;\n        }\n      }, {\n        key: \"substr\",\n        value: function substr(start, len) {\n          this.value = functions.substr(this.value, start, len);\n          return this;\n        }\n      }, {\n        key: \"unique\",\n        value: function unique(ignore) {\n          return functions.unique(this.value, ignore);\n        }\n      }, {\n        key: \"uniqueWords\",\n        value: function uniqueWords(pattern, flags) {\n          return functions.uniqueWords(this.value, pattern, flags);\n        }\n      }, {\n        key: \"insert\",\n        value: function insert(sbj, pos) {\n          this.value = functions.insert(this.value, sbj, pos);\n          return this;\n        }\n      }, {\n        key: \"trim\",\n        value: function trim(ws) {\n          this.value = functions.trim(this.value, ws);\n          return this;\n        }\n      }, {\n        key: \"ltrim\",\n        value: function ltrim(ws) {\n          this.value = functions.ltrim(this.value, ws);\n          return this;\n        }\n      }, {\n        key: \"rtrim\",\n        value: function rtrim(ws) {\n          this.value = functions.rtrim(this.value, ws);\n          return this;\n        }\n      }, {\n        key: \"endsWith\",\n        value: function endsWith(end, pos) {\n          return functions.endsWith(this.value, end, pos);\n        }\n      }, {\n        key: \"startWith\",\n        value: function startWith(start, pos) {\n          return functions.startWith(this.value, start, pos);\n        }\n      }, {\n        key: \"isAlpha\",\n        value: function isAlpha() {\n          return functions.isAlpha(this.value);\n        }\n      }, {\n        key: \"isAlphaDigit\",\n        value: function isAlphaDigit() {\n          return functions.isAlphaDigit(this.value);\n        }\n      }, {\n        key: \"isDigit\",\n        value: function isDigit() {\n          return functions.isDigit(this.value);\n        }\n      }, {\n        key: \"isBlank\",\n        value: function isBlank() {\n          return functions.isBlank(this.value);\n        }\n      }, {\n        key: \"isEmpty\",\n        value: function isEmpty() {\n          return functions.isEmpty(this.value);\n        }\n      }, {\n        key: \"isLower\",\n        value: function isLower() {\n          return functions.isLower(this.value);\n        }\n      }, {\n        key: \"isUpper\",\n        value: function isUpper() {\n          return functions.isUpper(this.value);\n        }\n      }, {\n        key: \"stripTagsAll\",\n        value: function stripTagsAll() {\n          this.value = functions.stripTagsAll(this.value);\n          return this;\n        }\n      }, {\n        key: \"stripTags\",\n        value: function stripTags(allowed) {\n          this.value = functions.stripTags(this.value, allowed);\n          return this;\n        }\n      }, {\n        key: \"sprintf\",\n        value: function sprintf(args) {\n          return functions.sprintf(this.value, args);\n        }\n      }, {\n        key: \"vsprintf\",\n        value: function vsprintf(args) {\n          return functions.vsprintf(this.value, args);\n        }\n      }, {\n        key: \"includes\",\n        value: function includes(sub, pos) {\n          return functions.includes(this.value, sub, pos);\n        }\n      }, {\n        key: _Symbol$toStringTag,\n        get: function get() {\n          return \"Cake\";\n        }\n      }, {\n        key: \"value\",\n        get: function get() {\n          return this._value;\n        },\n        set: function set(s) {\n          this._value = s;\n        }\n      }, {\n        key: \"length\",\n        get: function get() {\n          return this._value.length;\n        }\n      }]);\n\n      return Cake;\n    }();\n\n    var cake = function cake(s) {\n      return new Cake(s);\n    };\n\n    var Cake$1 = Object.assign({}, functions);\n    var global$1 = getGlobalObject();\n    global$1.Cake = Cake$1;\n    global$1.cake = cake;\n\n}());\n\r\n\r\n(function (global, undefined) {\n\n// Source: src/mode.js\n\n/* jshint -W097 */\n'use strict';\n\n// Source: src/func.js\n\n/* global dataSet */\n/* exported isDark, isTouch, isSimple, isHidden, isPlainObject, isEmptyObject, isArrayLike, str2arr, parseUnit, getUnit, setStyleProp, acceptData, dataAttr, normName, strip, dashedName, isLocalhost */\n\nvar numProps = ['opacity', 'zIndex', \"order\", \"zoom\"];\n\nfunction isSimple(v){\n    return typeof v === \"string\" || typeof v === \"boolean\" || typeof v === \"number\";\n}\n\nfunction isVisible(elem) {\n    return !!( elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length );\n}\n\nfunction isHidden(elem) {\n    var s = getComputedStyle(elem);\n    return !isVisible(elem) || +s.opacity === 0 || elem.hidden || s.visibility === \"hidden\";\n}\n\nfunction not(value){\n    return value === undefined || value === null;\n}\n\nfunction camelCase(string){\n    return string.replace( /-([a-z])/g, function(all, letter){\n        return letter.toUpperCase();\n    });\n}\n\nfunction dashedName(str){\n    return str.replace(/([A-Z])/g, function(u) { return \"-\" + u.toLowerCase(); });\n}\n\nfunction isPlainObject( obj ) {\n    var proto;\n    if ( !obj || Object.prototype.toString.call( obj ) !== \"[object Object]\" ) {\n        return false;\n    }\n    proto = obj.prototype !== undefined;\n    if ( !proto ) {\n        return true;\n    }\n    return proto.constructor && typeof proto.constructor === \"function\";\n}\n\nfunction isEmptyObject( obj ) {\n    for (var name in obj ) {\n        if (hasProp(obj, name)) return false;\n    }\n    return true;\n}\n\nfunction isArrayLike (o){\n    return o instanceof Object && 'length' in o;\n}\n\nfunction str2arr (str, sep) {\n    sep = sep || \" \";\n    return str.split(sep).map(function(el){\n        return  (\"\"+el).trim();\n    }).filter(function(el){\n        return el !== \"\";\n    });\n}\n\nfunction parseUnit(str, out) {\n    if (!out) out = [ 0, '' ];\n    str = String(str);\n    out[0] = parseFloat(str);\n    out[1] = str.match(/[\\d.\\-+]*\\s*(.*)/)[1] || '';\n    return out;\n}\n\nfunction getUnit(val, und){\n    var split = /[+-]?\\d*\\.?\\d+(?:\\.\\d+)?(?:[eE][+-]?\\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(val);\n    return typeof split[1] !== \"undefined\" ? split[1] : und;\n}\n\nfunction setStyleProp(el, key, val){\n    key = camelCase(key);\n\n    if ([\"scrollLeft\", \"scrollTop\"].indexOf(key) > -1) {\n        el[key] = (parseInt(val));\n    } else {\n        el.style[key] = isNaN(val) || numProps.indexOf(\"\"+key) > -1 ? val : val + 'px';\n    }\n}\n\nfunction acceptData(owner){\n    return owner.nodeType === 1 || owner.nodeType === 9 || !( +owner.nodeType );\n}\n\nfunction getData(data){\n    try {\n        return JSON.parse(data);\n    } catch (e) {\n        return data;\n    }\n}\n\nfunction dataAttr(elem, key, data){\n    var name;\n\n    if ( not(data) && elem.nodeType === 1 ) {\n        name = \"data-\" + key.replace( /[A-Z]/g, \"-$&\" ).toLowerCase();\n        data = elem.getAttribute( name );\n\n        if ( typeof data === \"string\" ) {\n            data = getData( data );\n            dataSet.set( elem, key, data );\n        } else {\n            data = undefined;\n        }\n    }\n    return data;\n}\n\nfunction normName(name) {\n    return typeof name !== \"string\" ? undefined : name.replace(/-/g, \"\").toLowerCase();\n}\n\nfunction strip(name, what) {\n    return typeof name !== \"string\" ? undefined : name.replace(what, \"\");\n}\n\nfunction hasProp(obj, prop){\n    return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nfunction isLocalhost(host){\n    var hostname = host || window.location.hostname;\n    return (\n        hostname === \"localhost\" ||\n        hostname === \"127.0.0.1\" ||\n        hostname === \"[::1]\" ||\n        hostname === \"\" ||\n        hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/) !== null\n    );\n}\n\nfunction isTouch() {\n    return (('ontouchstart' in window)\n        || (navigator.maxTouchPoints > 0)\n        || (navigator.msMaxTouchPoints > 0));\n}\n\nfunction isDark(){\n    var prefersDarkScheme = window.matchMedia(\"(prefers-color-scheme: dark)\")\n    return prefersDarkScheme.matches\n}\n\n// Source: src/setimmediate.js\n\n/* global global */\n/*\n * setImmediate polyfill\n * Version 1.0.5\n * Url: https://github.com/YuzuJS/setImmediate\n * Copyright (c) 2016 Yuzu (https://github.com/YuzuJS)\n * Licensed under MIT\n */\n(function (global) {\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1;\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n        if (typeof callback !== \"function\") {\n            /* jshint -W054 */\n            callback = new Function(\"\" + callback);\n        }\n        var args = new Array(arguments.length - 1);\n        for (var i = 0; i < args.length; i++) {\n            args[i] = arguments[i + 1];\n        }\n        tasksByHandle[nextHandle] = { callback: callback, args: args };\n        registerImmediate(nextHandle);\n        return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n            case 0:\n                callback();\n                break;\n            case 1:\n                callback(args[0]);\n                break;\n            case 2:\n                callback(args[0], args[1]);\n                break;\n            case 3:\n                callback(args[0], args[1], args[2]);\n                break;\n            default:\n                callback.apply(undefined, args);\n                break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        if (currentlyRunningATask) {\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    // global.process\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            global.process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    // web workers\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    // Browsers\n    function installPostMessageImplementation() {\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        global.addEventListener(\"message\", onGlobalMessage, false);\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    if ({}.toString.call(global.process) === \"[object process]\") {\n\n        installNextTickImplementation();\n\n    } else if (global.MessageChannel) {\n\n        installMessageChannelImplementation();\n\n    } else {\n\n        installPostMessageImplementation();\n\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? window : global : self));\n\n// Source: src/core.js\n\n/* global hasProp */\n\nvar m4qVersion = \"v1.1.0. Built at 05/05/2021 22:47:56\";\n\n/* eslint-disable-next-line */\nvar matches = Element.prototype.matches\n    || Element.prototype.matchesSelector\n    || Element.prototype.webkitMatchesSelector\n    || Element.prototype.mozMatchesSelector\n    || Element.prototype.msMatchesSelector\n    || Element.prototype.oMatchesSelector;\n\nvar $ = function(selector, context){\n    return new $.init(selector, context);\n};\n\n$.version = m4qVersion;\n\n$.fn = $.prototype = {\n    version: m4qVersion,\n    constructor: $,\n    length: 0,\n    uid: \"\",\n\n    push: [].push,\n    sort: [].sort,\n    splice: [].splice,\n    indexOf: [].indexOf,\n    reverse: [].reverse\n};\n\n$.extend = $.fn.extend = function(){\n    var options, name,\n        target = arguments[ 0 ] || {},\n        i = 1,\n        length = arguments.length;\n\n    if ( typeof target !== \"object\" && typeof target !== \"function\" ) {\n        target = {};\n    }\n\n    if ( i === length ) {\n        target = this;\n        i--;\n    }\n\n    for ( ; i < length; i++ ) {\n        if ( ( options = arguments[ i ] ) != null ) {\n            for ( name in options ) {\n                if (hasProp(options, name))\n                    target[ name ] = options[ name ];\n            }\n        }\n    }\n\n    return target;\n};\n\n$.assign = function(){\n    var options, name,\n        target = arguments[ 0 ] || {},\n        i = 1,\n        length = arguments.length;\n\n    if ( typeof target !== \"object\" && typeof target !== \"function\" ) {\n        target = {};\n    }\n\n    if ( i === length ) {\n        target = this;\n        i--;\n    }\n\n    for ( ; i < length; i++ ) {\n        if ( ( options = arguments[ i ] ) != null ) {\n            for ( name in options ) {\n                if (hasProp(options, name) && options[name] !== undefined)\n                    target[ name ] = options[ name ];\n            }\n        }\n    }\n\n    return target;\n};\n\n// if (typeof window[\"hideM4QVersion\"] === \"undefined\") console.info(\"m4q \" + $.version);\n\n// Source: src/interval.js\n\n/* global $ */\n\nvar now = function(){\n    return Date.now();\n};\n\n$.extend({\n\n    intervalId: -1,\n    intervalQueue: [],\n    intervalTicking: false,\n    intervalTickId: null,\n\n    setInterval: function(fn, int){\n        var that = this;\n\n        this.intervalId++;\n\n        this.intervalQueue.push({\n            id: this.intervalId,\n            fn: fn,\n            interval: int,\n            lastTime: now()\n        });\n\n        if (!this.intervalTicking) {\n            var tick = function(){\n                that.intervalTickId = requestAnimationFrame(tick);\n                $.each(that.intervalQueue, function(){\n                    var item = this;\n                    if (item.interval < 17 || now() - item.lastTime >= item.interval) {\n                        item.fn();\n                        item.lastTime = now();\n                    }\n                });\n            };\n            this.intervalTicking = true;\n            tick();\n        }\n\n        return this.intervalId;\n    },\n\n    clearInterval: function(id){\n        for(var i = 0; i < this.intervalQueue.length; i++){\n            if (id === this.intervalQueue[i].id) {\n                this.intervalQueue.splice(i, 1);\n                break;\n            }\n        }\n        if (this.intervalQueue.length === 0) {\n            cancelAnimationFrame(this.intervalTickId);\n            this.intervalTicking = false;\n        }\n    },\n\n    setTimeout: function(fn, interval){\n        var that = this, id = this.setInterval(function(){\n            that.clearInterval(id);\n            fn();\n        }, interval);\n\n        return id;\n    },\n\n    clearTimeout: function(id){\n        return this.clearInterval(id);\n    }\n});\n\n// Source: src/contains.js\n\n/* global $, not, matches, isArrayLike, isVisible */\n\n$.fn.extend({\n    index: function(sel){\n        var el, _index = -1;\n\n        if (this.length === 0) {\n            return _index;\n        }\n\n        if (not(sel)) {\n            el = this[0];\n        } else if (sel instanceof $ && sel.length > 0) {\n            el = sel[0];\n        } else if (typeof sel === \"string\") {\n            el = $(sel)[0];\n        } else {\n            el = undefined;\n        }\n\n        if (not(el)) {\n            return _index;\n        }\n\n        if (el && el.parentNode) $.each(el.parentNode.children, function(i){\n            if (this === el) {\n                _index = i;\n            }\n        });\n        return _index;\n    },\n\n    get: function(i){\n        if (i === undefined) {\n            return this.items();\n        }\n        return i < 0 ? this[ i + this.length ] : this[ i ];\n    },\n\n    eq: function(i){\n        return !not(i) && this.length > 0 ? $.extend($(this.get(i)), {_prevObj: this}) : this;\n    },\n\n    is: function(s){\n        var result = false;\n\n        if (this.length === 0) {\n            return false;\n        }\n\n        if (s instanceof $) {\n            return this.same(s);\n        }\n\n        if (s === \":selected\") {\n            this.each(function(){\n                if (this.selected) result = true;\n            });\n        } else\n\n        if (s === \":checked\") {\n            this.each(function(){\n                if (this.checked) result = true;\n            });\n        } else\n\n        if (s === \":visible\") {\n            this.each(function(){\n                if (isVisible(this)) result = true;\n            });\n        } else\n\n        if (s === \":hidden\") {\n            this.each(function(){\n                var styles = getComputedStyle(this);\n                if (\n                    this.getAttribute('type') === 'hidden'\n                        || this.hidden\n                        || styles.display === 'none'\n                        || styles.visibility === 'hidden'\n                        || parseInt(styles.opacity) === 0\n                ) result = true;\n            });\n        } else\n\n        if (typeof  s === \"string\" && [':selected'].indexOf(s) === -1) {\n            this.each(function(){\n                if (matches.call(this, s)) {\n                    result = true;\n                }\n            });\n        } else\n\n        if (isArrayLike(s)) {\n            this.each(function(){\n                var el = this;\n                $.each(s, function(){\n                    var sel = this;\n                    if (el === sel) {\n                        result = true;\n                    }\n                });\n            });\n        } else\n\n        if (typeof s === \"object\" && s.nodeType === 1) {\n            this.each(function(){\n                if  (this === s) {\n                    result = true;\n                }\n            });\n        }\n\n        return result;\n    },\n\n    same: function(o){\n        var result = true;\n\n        if (!(o instanceof $)) {\n            o = $(o);\n        }\n\n        if (this.length !== o.length) return false;\n\n        this.each(function(){\n            if (o.items().indexOf(this) === -1) {\n                result = false;\n            }\n        });\n\n        return result;\n    },\n\n    last: function(){\n        return this.eq(this.length - 1);\n    },\n\n    first: function(){\n        return this.eq(0);\n    },\n\n    odd: function(){\n        var result = this.filter(function(el, i){\n            return i % 2 === 0;\n        });\n        return $.extend(result, {_prevObj: this});\n    },\n\n    even: function(){\n        var result = this.filter(function(el, i){\n            return i % 2 !== 0;\n        });\n        return $.extend(result, {_prevObj: this});\n    },\n\n    filter: function(fn){\n        if (typeof fn === \"string\") {\n            var sel = fn;\n            fn = function(el){\n                return matches.call(el, sel);\n            };\n        }\n\n        return $.extend($.merge($(), [].filter.call(this, fn)), {_prevObj: this});\n    },\n\n    find: function(s){\n        var res = [], result;\n\n        if (s instanceof $) return s;\n\n        if (this.length === 0) {\n            result = this;\n        } else {\n            this.each(function () {\n                var el = this;\n                if (typeof el.querySelectorAll === \"undefined\") {\n                    return ;\n                }\n                res = res.concat([].slice.call(el.querySelectorAll(s)));\n            });\n            result = $.merge($(), res);\n        }\n\n        return $.extend(result, {_prevObj: this});\n    },\n\n    contains: function(s){\n        return this.find(s).length > 0;\n    },\n\n    children: function(s){\n        var i, res = [];\n\n        if (s instanceof $) return s;\n\n        this.each(function(){\n            var el = this;\n            for(i = 0; i < el.children.length; i++) {\n                if (el.children[i].nodeType === 1)\n                    res.push(el.children[i]);\n            }\n        });\n        res = s ? res.filter(function(el){\n            return matches.call(el, s);\n        }) : res;\n\n        return $.extend($.merge($(), res), {_prevObj: this});\n    },\n\n    parent: function(s){\n        var res = [];\n        if (this.length === 0) {\n            return ;\n        }\n\n        if (s instanceof $) return s;\n\n        this.each(function(){\n            if (this.parentNode) {\n                if (res.indexOf(this.parentNode) === -1) res.push(this.parentNode);\n            }\n        });\n        res = s ? res.filter(function(el){\n            return matches.call(el, s);\n        }) : res;\n\n        return $.extend($.merge($(), res), {_prevObj: this});\n    },\n\n    parents: function(s){\n        var res = [];\n\n        if (this.length === 0) {\n            return ;\n        }\n\n        if (s instanceof $) return s;\n\n        this.each(function(){\n            var par = this.parentNode;\n            while (par) {\n                if (par.nodeType === 1 && res.indexOf(par) === -1) {\n                    if (!not(s)) {\n                        if (matches.call(par, s)) {\n                            res.push(par);\n                        }\n                    } else {\n                        res.push(par);\n                    }\n                }\n                par = par.parentNode;\n            }\n        });\n\n        return $.extend($.merge($(), res), {_prevObj: this});\n    },\n\n    siblings: function(s){\n        var res = [];\n\n        if (this.length === 0) {\n            return ;\n        }\n\n        if (s instanceof $) return s;\n\n        this.each(function(){\n            var el = this;\n            if (el.parentNode) {\n                $.each(el.parentNode.children, function(){\n                    if (el !== this) res.push(this);\n                });\n            }\n        });\n\n        if (s) {\n            res = res.filter(function(el){\n                return matches.call(el, s);\n            });\n        }\n\n        return $.extend($.merge($(), res), {_prevObj: this});\n    },\n\n    _siblingAll: function(dir, s){\n        var res = [];\n\n        if (this.length === 0) {\n            return ;\n        }\n\n        if (s instanceof $) return s;\n\n        this.each(function(){\n            var el = this;\n            while (el) {\n                el = el[dir];\n                if (!el) break;\n                res.push(el);\n            }\n        });\n\n        if (s) {\n            res = res.filter(function(el){\n                return matches.call(el, s);\n            });\n        }\n\n        return $.extend($.merge($(), res), {_prevObj: this});\n    },\n\n    _sibling: function(dir, s){\n        var res = [];\n\n        if (this.length === 0) {\n            return ;\n        }\n\n        if (s instanceof $) return s;\n\n        this.each(function(){\n            var el = this[dir];\n            if (el && el.nodeType === 1) {\n                res.push(el);\n            }\n        });\n\n        if (s) {\n            res = res.filter(function(el){\n                return matches.call(el, s);\n            });\n        }\n\n        return $.extend($.merge($(), res), {_prevObj: this});\n    },\n\n    prev: function(s){\n        return this._sibling('previousElementSibling', s);\n    },\n\n    next: function(s){\n        return this._sibling('nextElementSibling', s);\n    },\n\n    prevAll: function(s){\n        return this._siblingAll('previousElementSibling', s);\n    },\n\n    nextAll: function(s){\n        return this._siblingAll('nextElementSibling', s);\n    },\n\n    closest: function(s){\n        var res = [];\n\n        if (this.length === 0) {\n            return ;\n        }\n\n        if (s instanceof $) return s;\n\n        if (!s) {\n            return this.parent(s);\n        }\n\n        this.each(function(){\n            var el = this;\n            while (el) {\n                if (!el) break;\n                if (matches.call(el, s)) {\n                    res.push(el);\n                    return ;\n                }\n                el = el.parentElement;\n            }\n        });\n\n        return $.extend($.merge($(), res.reverse()), {_prevObj: this});\n    },\n\n    has: function(selector){\n        var res = [];\n\n        if (this.length === 0) {\n            return ;\n        }\n\n        this.each(function(){\n            var el = $(this);\n            var child = el.children(selector);\n            if (child.length > 0) {\n                res.push(this);\n            }\n        });\n\n        return $.extend($.merge($(), res), {_prevObj: this});\n    },\n\n    back: function(to_start){\n        var ret;\n        if (to_start === true) {\n            ret = this._prevObj;\n            while (ret) {\n                if (!ret._prevObj) break;\n                ret = ret._prevObj;\n            }\n        } else {\n            ret = this._prevObj ? this._prevObj : this;\n        }\n        return ret;\n    }\n});\n\n// Source: src/script.js\n\n/* global $, not */\n\nfunction createScript(script){\n    var s = document.createElement('script');\n    s.type = 'text/javascript';\n\n    if (not(script)) return $(s);\n\n    var _script = $(script)[0];\n\n    if (_script.src) {\n        s.src = _script.src;\n    } else {\n        s.textContent = _script.innerText;\n    }\n\n    document.body.appendChild(s);\n\n    if (_script.parentNode) _script.parentNode.removeChild(_script);\n\n    return s;\n}\n\n$.extend({\n    script: function(el){\n\n        if (not(el)) {\n            return createScript();\n        }\n\n        var _el = $(el)[0];\n\n        if (_el.tagName && _el.tagName === \"SCRIPT\") {\n            createScript(_el);\n        } else $.each($(_el).find(\"script\"), function(){\n            createScript(this);\n        });\n    }\n});\n\n$.fn.extend({\n    script: function(){\n        return this.each(function(){\n            $.script(this);\n        });\n    }\n});\n\n// Source: src/prop.js\n\n/* global $, not */\n\n$.fn.extend({\n    _prop: function(prop, value){\n        if (arguments.length === 1) {\n            return this.length === 0 ? undefined : this[0][prop];\n        }\n\n        if (not(value)) {\n            value = '';\n        }\n\n        return this.each(function(){\n            var el = this;\n\n            el[prop] = value;\n\n            if (prop === \"innerHTML\") {\n                $.script(el);\n            }\n        });\n    },\n\n    prop: function(prop, value){\n        return arguments.length === 1 ? this._prop(prop) : this._prop(prop, typeof value === \"undefined\" ? \"\" : value);\n    },\n\n    val: function(value){\n        if (not(value)) {\n            return this.length === 0 ? undefined : this[0].value;\n        }\n\n        return this.each(function(){\n            var el = $(this);\n            if (typeof this.value !== \"undefined\") {\n                this.value = value;\n            } else {\n                el.html(value);\n            }\n        });\n    },\n\n    html: function(value){\n        var that = this, v = [];\n\n        if (arguments.length === 0) {\n            return this._prop('innerHTML');\n        }\n\n        if (value instanceof $) {\n            value.each(function(){\n                v.push($(this).outerHTML());\n            });\n        } else {\n            v.push(value);\n        }\n\n        that._prop('innerHTML', v.length === 1 && not(v[0]) ? \"\" : v.join(\"\\n\"));\n\n        return this;\n    },\n\n    outerHTML: function(){\n        return this._prop('outerHTML');\n    },\n\n    text: function(value){\n        return arguments.length === 0 ? this._prop('textContent') : this._prop('textContent', typeof value === \"undefined\" ? \"\" : value);\n    },\n\n    innerText: function(value){\n        return arguments.length === 0 ? this._prop('innerText') : this._prop('innerText', typeof value === \"undefined\" ? \"\" : value);\n    },\n\n    empty: function(){\n        return this.each(function(){\n            if (typeof this.innerHTML !== \"undefined\") this.innerHTML = \"\";\n        });\n    },\n\n    clear: function(){\n        return this.empty();\n    }\n});\n\n// Source: src/each.js\n\n/* global $, isArrayLike, hasProp */\n\n$.each = function(ctx, cb){\n    var index = 0;\n    if (isArrayLike(ctx)) {\n        [].forEach.call(ctx, function(val, key) {\n            cb.apply(val, [key, val]);\n        });\n    } else {\n        for(var key in ctx) {\n            if (hasProp(ctx, key))\n                cb.apply(ctx[key], [key, ctx[key],  index++]);\n        }\n    }\n\n    return ctx;\n};\n\n$.fn.extend({\n    each: function(cb){\n        return $.each(this, cb);\n    }\n});\n\n\n// Source: src/data.js\n\n/* global acceptData, camelCase, $, not, dataAttr, isEmptyObject, hasProp */\n\n/*\n * Data routines\n * Url: https://jquery.com\n * Copyright (c) Copyright JS Foundation and other contributors, https://js.foundation/\n * Licensed under MIT\n */\nvar Data = function(ns){\n    this.expando = \"DATASET:UID:\" + ns.toUpperCase();\n    Data.uid++;\n};\n\nData.uid = -1;\n\nData.prototype = {\n    cache: function(owner){\n        var value = owner[this.expando];\n        if (!value) {\n            value = {};\n            if (acceptData(owner)) {\n                if (owner.nodeType) {\n                    owner[this.expando] = value;\n                } else {\n                    Object.defineProperty(owner, this.expando, {\n                        value: value,\n                        configurable: true\n                    });\n                }\n            }\n        }\n        return value;\n    },\n\n    set: function(owner, data, value){\n        var prop, cache = this.cache(owner);\n\n        if (typeof data === \"string\") {\n            cache[camelCase(data)] = value;\n        } else {\n            for (prop in data) {\n                if (hasProp(data, prop))\n                    cache[camelCase(prop)] = data[prop];\n            }\n        }\n        return cache;\n    },\n\n    get: function(owner, key){\n        return key === undefined ? this.cache(owner) : owner[ this.expando ] && owner[ this.expando ][ camelCase( key ) ];\n    },\n\n    access: function(owner, key, value){\n        if (key === undefined || ((key && typeof key === \"string\") && value === undefined) ) {\n            return this.get(owner, key);\n        }\n        this.set(owner, key, value);\n        return value !== undefined ? value : key;\n    },\n\n    remove: function(owner, key){\n        var i, cache = owner[this.expando];\n        if (cache === undefined) {\n            return ;\n        }\n        if (key !== undefined) {\n            if ( Array.isArray( key ) ) {\n                key = key.map( camelCase );\n            } else {\n                key = camelCase( key );\n\n                key = key in cache ? [ key ] : ( key.match( /[^\\x20\\t\\r\\n\\f]+/g ) || [] ); // ???\n            }\n\n            i = key.length;\n\n            while ( i-- ) {\n                delete cache[ key[ i ] ];\n            }\n        }\n        if ( key === undefined || isEmptyObject( cache ) ) {\n            if ( owner.nodeType ) {\n                owner[ this.expando ] = undefined;\n            } else {\n                delete owner[ this.expando ];\n            }\n        }\n        return true;\n    },\n\n    hasData: function(owner){\n        var cache = owner[ this.expando ];\n        return cache !== undefined && !isEmptyObject( cache );\n    }\n};\n\nvar dataSet = new Data('m4q');\n\n$.extend({\n    hasData: function(elem){\n        return dataSet.hasData(elem);\n    },\n\n    data: function(elem, key, val){\n        return dataSet.access(elem, key, val);\n    },\n\n    removeData: function(elem, key){\n        return dataSet.remove(elem, key);\n    },\n\n    dataSet: function(ns){\n        if (not(ns)) return dataSet;\n        if (['INTERNAL', 'M4Q'].indexOf(ns.toUpperCase()) > -1) {\n            throw Error(\"You can not use reserved name for your dataset\");\n        }\n        return new Data(ns);\n    }\n});\n\n$.fn.extend({\n    data: function(key, val){\n        var res, elem, data, attrs, name, i;\n\n        if (this.length === 0) {\n            return ;\n        }\n\n        elem = this[0];\n\n        if ( arguments.length === 0 ) {\n            if ( this.length ) {\n                data = dataSet.get( elem );\n\n                if ( elem.nodeType === 1) {\n                    attrs = elem.attributes;\n                    i = attrs.length;\n                    while ( i-- ) {\n                        if ( attrs[ i ] ) {\n                            name = attrs[ i ].name;\n                            if ( name.indexOf( \"data-\" ) === 0 ) {\n                                name = camelCase( name.slice( 5 ) );\n                                dataAttr( elem, name, data[ name ] );\n                            }\n                        }\n                    }\n                }\n            }\n\n            return data;\n        }\n\n        if ( arguments.length === 1 ) {\n            res = dataSet.get(elem, key);\n            if (res === undefined) {\n                if ( elem.nodeType === 1) {\n                    if (elem.hasAttribute(\"data-\"+key)) {\n                        res = elem.getAttribute(\"data-\"+key);\n                    }\n                }\n            }\n            return res;\n        }\n\n        return this.each( function() {\n            dataSet.set( this, key, val );\n        } );\n    },\n\n    removeData: function( key ) {\n        return this.each( function() {\n            dataSet.remove( this, key );\n        } );\n    },\n\n    origin: function(name, value, def){\n\n        if (this.length === 0) {\n            return this;\n        }\n\n        if (not(name) && not(value)) {\n            return $.data(this[0]);\n        }\n\n        if (not(value)) {\n            var res = $.data(this[0], \"origin-\"+name);\n            return !not(res) ? res : def;\n        }\n\n        this.data(\"origin-\"+name, value);\n\n        return this;\n    }\n});\n\n// Source: src/utils.js\n\n/* global $, not, isDark, camelCase, dashedName, isPlainObject, isEmptyObject, isArrayLike, acceptData, parseUnit, getUnit, isVisible, isHidden, matches, strip, normName, hasProp, isLocalhost, isTouch */\n\n$.extend({\n\n    device: (/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())),\n    localhost: isLocalhost(),\n    isLocalhost: isLocalhost,\n    touchable: isTouch(),\n    dark: isDark(),\n\n    uniqueId: function (prefix) {\n        var d = new Date().getTime();\n        if (not(prefix)) {\n            prefix = 'm4q';\n        }\n        return (prefix !== '' ? prefix + '-' : '') + 'xxxx-xxxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n            var r = (d + Math.random() * 16) % 16 | 0;\n            d = Math.floor(d / 16);\n            return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);\n        });\n    },\n\n    toArray: function(n){\n        var i, out = [];\n\n        for (i = 0 ; i < n.length; i++ ) {\n            out.push(n[i]);\n        }\n\n        return out;\n    },\n\n    import: function(ctx){\n        var res = [];\n        this.each(ctx, function(){\n            res.push(this);\n        });\n        return this.merge($(), res);\n    },\n\n    merge: function( first, second ) {\n        var len = +second.length,\n            j = 0,\n            i = first.length;\n\n        for ( ; j < len; j++ ) {\n            first[ i++ ] = second[ j ];\n        }\n\n        first.length = i;\n\n        return first;\n    },\n\n    type: function(obj){\n        return Object.prototype.toString.call(obj).replace(/^\\[object (.+)]$/, '$1').toLowerCase();\n    },\n\n    sleep: function(ms) {\n        ms += new Date().getTime();\n        /* eslint-disable-next-line */\n        while (new Date() < ms){}\n    },\n\n    isSelector: function(selector){\n        if (typeof selector !== 'string') {\n            return false;\n        }\n        try {\n            document.querySelector(selector);\n        } catch(error) {\n            return false;\n        }\n        return true;\n    },\n\n    remove: function(s){\n        return $(s).remove();\n    },\n\n    camelCase: camelCase,\n    dashedName: dashedName,\n    isPlainObject: isPlainObject,\n    isEmptyObject: isEmptyObject,\n    isArrayLike: isArrayLike,\n    acceptData: acceptData,\n    not: not,\n    parseUnit: parseUnit,\n    getUnit: getUnit,\n    unit: parseUnit,\n    isVisible: isVisible,\n    isHidden: isHidden,\n    matches: function(el, s) {return matches.call(el, s);},\n    random: function(from, to) {\n        if (arguments.length === 1 && isArrayLike(from)) {\n            return from[Math.floor(Math.random()*(from.length))];\n        }\n        return Math.floor(Math.random()*(to-from+1)+from);\n    },\n    strip: strip,\n    normName: normName,\n    hasProp: hasProp,\n\n    serializeToArray: function(form){\n        var _form = $(form)[0];\n        if (!_form || _form.nodeName !== \"FORM\") {\n            console.warn(\"Element is not a HTMLFromElement\");\n            return;\n        }\n        var i, j, q = [];\n        for (i = _form.elements.length - 1; i >= 0; i = i - 1) {\n            if (_form.elements[i].name === \"\") {\n                continue;\n            }\n            switch (_form.elements[i].nodeName) {\n                case 'INPUT':\n                    switch (_form.elements[i].type) {\n                        case 'checkbox':\n                        case 'radio':\n                            if (_form.elements[i].checked) {\n                                q.push(_form.elements[i].name + \"=\" + encodeURIComponent(_form.elements[i].value));\n                            }\n                            break;\n                        case 'file':\n                            break;\n                        default: q.push(_form.elements[i].name + \"=\" + encodeURIComponent(_form.elements[i].value));\n                    }\n                    break;\n                case 'TEXTAREA':\n                    q.push(_form.elements[i].name + \"=\" + encodeURIComponent(_form.elements[i].value));\n                    break;\n                case 'SELECT':\n                    switch (_form.elements[i].type) {\n                        case 'select-one':\n                            q.push(_form.elements[i].name + \"=\" + encodeURIComponent(_form.elements[i].value));\n                            break;\n                        case 'select-multiple':\n                            for (j = _form.elements[i].options.length - 1; j >= 0; j = j - 1) {\n                                if (_form.elements[i].options[j].selected) {\n                                    q.push(_form.elements[i].name + \"=\" + encodeURIComponent(_form.elements[i].options[j].value));\n                                }\n                            }\n                            break;\n                    }\n                    break;\n                case 'BUTTON':\n                    switch (_form.elements[i].type) {\n                        case 'reset':\n                        case 'submit':\n                        case 'button':\n                            q.push(_form.elements[i].name + \"=\" + encodeURIComponent(_form.elements[i].value));\n                            break;\n                    }\n                    break;\n            }\n        }\n        return q;\n    },\n    serialize: function(form){\n        return $.serializeToArray(form).join(\"&\");\n    }\n});\n\n$.fn.extend({\n    items: function(){\n        return $.toArray(this);\n    }\n});\n\n// Source: src/events.js\n\n/* global $, not, camelCase, str2arr, normName, matches, isEmptyObject, isPlainObject */\n\n// (function () {\n//     if ( typeof window.CustomEvent === \"function\" ) return false;\n//\n//     function CustomEvent ( event, params ) {\n//         params = params || { bubbles: false, cancelable: false, detail: null };\n//         var evt = document.createEvent( 'CustomEvent' );\n//         evt.initCustomEvent( event, params.bubbles, params.cancelable, params.detail );\n//         return evt;\n//     }\n//\n//     CustomEvent.prototype = window.Event.prototype;\n//\n//     window.CustomEvent = CustomEvent;\n// })();\n\nvar overriddenStop =  Event.prototype.stopPropagation;\nvar overriddenPrevent =  Event.prototype.preventDefault;\n\nEvent.prototype.stopPropagation = function(){\n    this.isPropagationStopped = true;\n    overriddenStop.apply(this, arguments);\n};\nEvent.prototype.preventDefault = function(){\n    this.isPreventedDefault = true;\n    overriddenPrevent.apply(this, arguments);\n};\n\nEvent.prototype.stop = function(immediate){\n    return immediate ? this.stopImmediatePropagation() : this.stopPropagation();\n};\n\n$.extend({\n    events: [],\n    eventHooks: {},\n\n    eventUID: -1,\n\n    /*\n    * el, eventName, handler, selector, ns, id, options\n    * */\n    setEventHandler: function(obj){\n        var i, freeIndex = -1, eventObj, resultIndex;\n        if (this.events.length > 0) {\n            for(i = 0; i < this.events.length; i++) {\n                if (this.events[i].handler === null) {\n                    freeIndex = i;\n                    break;\n                }\n            }\n        }\n\n        eventObj = {\n            element: obj.el,\n            event: obj.event,\n            handler: obj.handler,\n            selector: obj.selector,\n            ns: obj.ns,\n            id: obj.id,\n            options: obj.options\n        };\n\n        if (freeIndex === -1) {\n            this.events.push(eventObj);\n            resultIndex = this.events.length - 1;\n        } else {\n            this.events[freeIndex] = eventObj;\n            resultIndex = freeIndex;\n        }\n\n        return resultIndex;\n    },\n\n    getEventHandler: function(index){\n        if (this.events[index] !== undefined && this.events[index] !== null) {\n            this.events[index] = null;\n            return this.events[index].handler;\n        }\n        return undefined;\n    },\n\n    off: function(){\n        $.each(this.events, function(){\n            this.element.removeEventListener(this.event, this.handler, true);\n        });\n        this.events = [];\n        return this;\n    },\n\n    getEvents: function(){\n        return this.events;\n    },\n\n    getEventHooks: function(){\n        return this.eventHooks;\n    },\n\n    addEventHook: function(event, handler, type){\n        if (not(type)) {\n            type = \"before\";\n        }\n        $.each(str2arr(event), function(){\n            this.eventHooks[camelCase(type+\"-\"+this)] = handler;\n        });\n        return this;\n    },\n\n    removeEventHook: function(event, type){\n        if (not(type)) {\n            type = \"before\";\n        }\n        $.each(str2arr(event), function(){\n            delete this.eventHooks[camelCase(type+\"-\"+this)];\n        });\n        return this;\n    },\n\n    removeEventHooks: function(event){\n        var that = this;\n        if (not(event)) {\n            this.eventHooks = {};\n        } else {\n            $.each(str2arr(event), function(){\n                delete that.eventHooks[camelCase(\"before-\"+this)];\n                delete that.eventHooks[camelCase(\"after-\"+this)];\n            });\n        }\n        return this;\n    }\n});\n\n$.fn.extend({\n    on: function(eventsList, sel, handler, options){\n        if (this.length === 0) {\n            return ;\n        }\n\n        if (typeof sel === 'function') {\n            options = handler;\n            handler = sel;\n            sel = undefined;\n        }\n\n        if (!isPlainObject(options)) {\n            options = {};\n        }\n\n        return this.each(function(){\n            var el = this;\n            $.each(str2arr(eventsList), function(){\n                var h, ev = this,\n                    event = ev.split(\".\"),\n                    name = normName(event[0]),\n                    ns = options.ns ? options.ns : event[1],\n                    index, originEvent;\n\n                $.eventUID++;\n\n                h = function(e){\n                    var target = e.target;\n                    var beforeHook = $.eventHooks[camelCase(\"before-\"+name)];\n                    var afterHook = $.eventHooks[camelCase(\"after-\"+name)];\n\n                    if (typeof beforeHook === \"function\") {\n                        beforeHook.call(target, e);\n                    }\n\n                    if (!sel) {\n                        handler.call(el, e);\n                    } else {\n                        while (target && target !== el) {\n                            if (matches.call(target, sel)) {\n                                handler.call(target, e);\n                                if (e.isPropagationStopped) {\n                                    e.stopImmediatePropagation();\n                                    break;\n                                }\n                            }\n                            target = target.parentNode;\n                        }\n                    }\n\n                    if (typeof afterHook === \"function\") {\n                        afterHook.call(target, e);\n                    }\n\n                    if (options.once) {\n                        index = +$(el).origin( \"event-\"+e.type+(sel ? \":\"+sel:\"\")+(ns ? \":\"+ns:\"\") );\n                        if (!isNaN(index)) $.events.splice(index, 1);\n                    }\n                };\n\n                Object.defineProperty(h, \"name\", {\n                    value: handler.name && handler.name !== \"\" ? handler.name : \"func_event_\"+name+\"_\"+$.eventUID\n                });\n\n                originEvent = name+(sel ? \":\"+sel:\"\")+(ns ? \":\"+ns:\"\");\n\n                el.addEventListener(name, h, !isEmptyObject(options) ? options : false);\n\n                index = $.setEventHandler({\n                    el: el,\n                    event: name,\n                    handler: h,\n                    selector: sel,\n                    ns: ns,\n                    id: $.eventUID,\n                    options: !isEmptyObject(options) ? options : false\n                });\n                $(el).origin('event-'+originEvent, index);\n            });\n        });\n    },\n\n    one: function(events, sel, handler, options){\n        if (!isPlainObject(options)) {\n            options = {};\n        }\n\n        options.once = true;\n\n        return this.on.apply(this, [events, sel, handler, options]);\n    },\n\n    off: function(eventsList, sel, options){\n\n        if (isPlainObject(sel)) {\n            options = sel;\n            sel = null;\n        }\n\n        if (!isPlainObject(options)) {\n            options = {};\n        }\n\n        if (not(eventsList) || eventsList.toLowerCase() === 'all') {\n            return this.each(function(){\n                var el = this;\n                $.each($.events, function(){\n                    var e = this;\n                    if (e.element === el) {\n                        el.removeEventListener(e.event, e.handler, e.options);\n                        e.handler = null;\n                        $(el).origin(\"event-\"+name+(e.selector ? \":\"+e.selector:\"\")+(e.ns ? \":\"+e.ns:\"\"), null);\n                    }\n                });\n            });\n        }\n\n        return this.each(function(){\n            var el = this;\n            $.each(str2arr(eventsList), function(){\n                var evMap = this.split(\".\"),\n                    name = normName(evMap[0]),\n                    ns = options.ns ? options.ns : evMap[1],\n                    originEvent, index;\n\n                originEvent = \"event-\"+name+(sel ? \":\"+sel:\"\")+(ns ? \":\"+ns:\"\");\n                index = $(el).origin(originEvent);\n\n                if (index !== undefined && $.events[index].handler) {\n                    el.removeEventListener(name, $.events[index].handler, $.events[index].options);\n                    $.events[index].handler = null;\n                }\n\n                $(el).origin(originEvent, null);\n            });\n        });\n    },\n\n    trigger: function(name, data){\n        return this.fire(name, data);\n    },\n\n    fire: function(name, data){\n        var _name, e;\n\n        if (this.length === 0) {\n            return ;\n        }\n\n        _name = normName(name);\n\n        if (['focus', 'blur'].indexOf(_name) > -1) {\n            this[0][_name]();\n            return this;\n        }\n\n        if (typeof CustomEvent !== \"undefined\") {\n            e = new CustomEvent(_name, {\n                bubbles: true,\n                cancelable: true,\n                detail: data\n            });\n        } else {\n            e = document.createEvent('Events');\n            e.detail = data;\n            e.initEvent(_name, true, true);\n        }\n\n        return this.each(function(){\n            this.dispatchEvent(e);\n        });\n    }\n});\n\n( \"blur focus resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu touchstart touchend touchmove touchcancel\" )\n    .split( \" \" )\n    .forEach(\n    function( name ) {\n        $.fn[ name ] = function( sel, fn, opt ) {\n            return arguments.length > 0 ?\n                this.on( name, sel, fn, opt ) :\n                this.fire( name );\n        };\n});\n\n$.fn.extend( {\n    hover: function( fnOver, fnOut ) {\n        return this.mouseenter( fnOver ).mouseleave( fnOut || fnOver );\n    }\n});\n\n$.ready = function(fn, options){\n    document.addEventListener('DOMContentLoaded', fn, (options || false));\n};\n\n$.load = function(fn){\n    return $(window).on(\"load\", fn);\n};\n\n$.unload = function(fn){\n    return $(window).on(\"unload\", fn);\n};\n\n$.fn.extend({\n    unload: function(fn){\n        return (this.length === 0 || this[0].self !== window) ? undefined : $.unload(fn);\n    }\n});\n\n$.beforeunload = function(fn){\n    if (typeof fn === \"string\") {\n        return $(window).on(\"beforeunload\", function(e){\n            e.returnValue = fn;\n            return fn;\n        });\n    } else {\n        return $(window).on(\"beforeunload\", fn);\n    }\n};\n\n$.fn.extend({\n    beforeunload: function(fn){\n        return (this.length === 0 || this[0].self !== window) ? undefined : $.beforeunload(fn);\n    }\n});\n\n$.fn.extend({\n    ready: function(fn){\n        if (this.length && this[0] === document && typeof fn === 'function') {\n            return $.ready(fn);\n        }\n    }\n});\n\n// Source: src/ajax.js\n\n/* global $, Promise, not, isSimple, isPlainObject, isEmptyObject, camelCase */\n/* can be changed to fetch */\n$.ajax = function(p){\n    return new Promise(function(resolve, reject){\n        var xhr = new XMLHttpRequest(), data;\n        var method = (p.method || \"GET\").toUpperCase();\n        var headers = [];\n        var async = not(p.async) ? true : p.async;\n        var url = p.url;\n        var urlWithParams = url.indexOf(\"?\") > -1;\n        var joinParamsSymbol = urlWithParams ? \"&\" : \"?\";\n\n        var exec = function(fn, params){\n            if (typeof fn === \"function\") {\n                fn.apply(null, params);\n            }\n        };\n\n        var isGet = function(method){\n            return [\"GET\", \"JSON\"].indexOf(method) !== -1;\n        };\n\n        var plainObjectToData = function(obj){\n            var _data = [];\n            $.each(obj, function(k, v){\n                var _v = isSimple(v) ? v : JSON.stringify(v);\n                _data.push(k+\"=\" + _v);\n            });\n            return _data.join(\"&\");\n        };\n\n        if (p.data instanceof HTMLFormElement) {\n            var _action = p.data.getAttribute(\"action\");\n            var _method = p.data.getAttribute(\"method\");\n\n            if (not(url) && _action && _action.trim() !== \"\") {url = _action;}\n            if (_method && _method.trim() !== \"\") {method = _method.toUpperCase();}\n        }\n\n\n        if (p.timeout) {\n            xhr.timeout = p.timeout;\n        }\n\n        if (p.withCredentials) {\n            xhr.withCredentials = p.withCredentials;\n        }\n\n        if (p.data instanceof HTMLFormElement) {\n            data = $.serialize(p.data);\n        } else if (p.data instanceof HTMLElement && p.data.getAttribute(\"type\") && p.data.getAttribute(\"type\").toLowerCase() === \"file\") {\n            var _name = p.data.getAttribute(\"name\");\n            data = new FormData();\n            for (var i = 0; i < p.data.files.length; i++) {\n                data.append(_name, p.data.files[i]);\n            }\n        } else if (isPlainObject(p.data)) {\n            data = plainObjectToData(p.data);\n        } else if (p.data instanceof FormData) {\n            data = p.data;\n        } else if (typeof p.data === \"string\") {\n            data = p.data;\n        } else {\n            data = new FormData();\n            data.append(\"_data\", JSON.stringify(p.data));\n        }\n\n        if (isGet(method)) {\n            url += (typeof data === \"string\" ? joinParamsSymbol + data : isEmptyObject(data) ? \"\" : joinParamsSymbol + JSON.stringify(data));\n        }\n\n        xhr.open(method, url, async, p.user, p.password);\n        if (p.headers) {\n            $.each(p.headers, function(k, v){\n                xhr.setRequestHeader(k, v);\n                headers.push(k);\n            });\n        }\n        if (!isGet(method)) {\n            if (headers.indexOf(\"Content-type\") === -1 && p.contentType !== false) {\n                xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n            }\n        }\n        xhr.send(data);\n\n        xhr.addEventListener(\"load\", function(e){\n            if (xhr.readyState === 4 && xhr.status < 300) {\n                var _return = p.returnValue && p.returnValue === 'xhr' ? xhr : xhr.response;\n                if (p.parseJson) {\n                    try {\n                        _return = JSON.parse(_return);\n                    } catch (ex) {\n                        _return = {};\n                    }\n                }\n                exec(resolve, [_return]);\n                exec(p.onSuccess, [e, xhr]);\n            } else {\n                exec(reject, [xhr]);\n                exec(p.onFail, [e, xhr]);\n            }\n            exec(p.onLoad, [e, xhr]);\n        });\n\n        $.each([\"readystatechange\", \"error\", \"timeout\", \"progress\", \"loadstart\", \"loadend\", \"abort\"], function(){\n            var ev = camelCase(\"on-\"+(this === 'readystatechange' ? 'state' : this));\n            xhr.addEventListener(ev, function(e){\n                exec(p[ev], [e, xhr]);\n            });\n        });\n    });\n};\n\n['get', 'post', 'put', 'patch', 'delete', 'json'].forEach(function(method){\n    $[method] = function(url, data, options){\n        var _method = method.toUpperCase();\n        var _options = {\n            method: _method === 'JSON' ? 'GET' : _method,\n            url: url,\n            data: data,\n            parseJson: _method === 'JSON'\n        };\n        return $.ajax($.extend({}, _options, options));\n    };\n});\n\n$.fn.extend({\n    load: function(url, data, options){\n        var that = this;\n\n        if (this.length && this[0].self === window ) {\n            return $.load(url);\n        }\n\n        return $.get(url, data, options).then(function(data){\n            that.each(function(){\n                this.innerHTML = data;\n            });\n        });\n    }\n});\n\n// Source: src/css.js\n\n/* global $, not, setStyleProp */\n\n$.fn.extend({\n\n    style: function(name, pseudo){\n        var el;\n\n        function _getStyle(el, prop, pseudo){\n            return [\"scrollLeft\", \"scrollTop\"].indexOf(prop) > -1 ? $(el)[prop]() : getComputedStyle(el, pseudo)[prop];\n        }\n\n        if (typeof name === 'string' && this.length === 0) {\n            return undefined;\n        }\n\n        if (this.length === 0) {\n            return this;\n        }\n\n        el = this[0];\n\n        if (not(name) || name === \"all\") {\n            return getComputedStyle(el, pseudo);\n        } else {\n            var result = {}, names = name.split(\", \").map(function(el){\n                return (\"\"+el).trim();\n            });\n            if (names.length === 1)  {\n                return _getStyle(el, names[0], pseudo);\n            } else {\n                $.each(names, function () {\n                    var prop = this;\n                    result[this] = _getStyle(el, prop, pseudo);\n                });\n                return result;\n            }\n        }\n    },\n\n    removeStyleProperty: function(name){\n        if (not(name) || this.length === 0) return this;\n        var names = name.split(\", \").map(function(el){\n            return (\"\"+el).trim();\n        });\n\n        return this.each(function(){\n            var el = this;\n            $.each(names, function(){\n                el.style.removeProperty(this);\n            });\n        });\n    },\n\n    css: function(key, val){\n        key = key || 'all';\n\n        if (typeof key === \"string\" && not(val)) {\n            return  this.style(key);\n        }\n\n        return this.each(function(){\n            var el = this;\n            if (typeof key === \"object\") {\n                $.each(key, function(key, val){\n                    setStyleProp(el, key, val);\n                });\n            } else if (typeof key === \"string\") {\n                setStyleProp(el, key, val);\n            }\n        });\n    },\n\n    scrollTop: function(val){\n        if (not(val)) {\n            return this.length === 0 ? undefined : this[0] === window ? pageYOffset : this[0].scrollTop;\n        }\n        return this.each(function(){\n            this.scrollTop = val;\n        });\n    },\n\n    scrollLeft: function(val){\n        if (not(val)) {\n            return this.length === 0 ? undefined : this[0] === window ? pageXOffset : this[0].scrollLeft;\n        }\n        return this.each(function(){\n            this.scrollLeft = val;\n        });\n    }\n});\n\n\n\n// Source: src/classes.js\n\n/* global $, not */\n\n$.fn.extend({\n    addClass: function(){},\n    removeClass: function(){},\n    toggleClass: function(){},\n\n    containsClass: function(cls){\n        return this.hasClass(cls);\n    },\n\n    hasClass: function(cls){\n        var result = false;\n        var classes = cls.split(\" \").filter(function(v){\n            return (\"\"+v).trim() !== \"\";\n        });\n\n        if (not(cls)) {\n            return false;\n        }\n\n        this.each(function(){\n            var el = this;\n\n            $.each(classes, function(){\n                if (!result && el.classList && el.classList.contains(this)) {\n                    result = true;\n                }\n            });\n        });\n\n        return result;\n    },\n\n    clearClasses: function(){\n        return this.each(function(){\n            this.className = \"\";\n        });\n    },\n\n    cls: function(array){\n        return this.length === 0 ? undefined : array ? this[0].className.split(\" \") : this[0].className;\n    },\n\n    removeClassBy: function(mask){\n        return this.each(function(){\n            var el = $(this);\n            var classes = el.cls(true);\n            $.each(classes, function(){\n                var elClass = this;\n                if (elClass.indexOf(mask) > -1) {\n                    el.removeClass(elClass);\n                }\n            });\n        });\n    }\n});\n\n['add', 'remove', 'toggle'].forEach(function (method) {\n    $.fn[method + \"Class\"] = function(cls){\n        if (not(cls) || (\"\"+cls).trim() === \"\") return this;\n        return this.each(function(){\n            var el = this;\n            var hasClassList = typeof el.classList !== \"undefined\";\n            $.each(cls.split(\" \").filter(function(v){\n                return (\"\"+v).trim() !== \"\";\n            }), function(){\n                if (hasClassList) el.classList[method](this);\n            });\n        });\n    };\n});\n\n\n// Source: src/parser.js\n\n/* global $ */\n\n$.parseHTML = function(data){\n    var base, singleTag, result = [], ctx, _context;\n    var regexpSingleTag = /^<([a-z][^\\/\\0>:\\x20\\t\\r\\n\\f]*)[\\x20\\t\\r\\n\\f]*\\/?>(?:<\\/\\1>|)$/i; // eslint-disable-line\n\n    if (typeof data !== \"string\") {\n        return [];\n    }\n\n    data = data.trim();\n\n    ctx = document.implementation.createHTMLDocument(\"\");\n    base = ctx.createElement( \"base\" );\n    base.href = document.location.href;\n    ctx.head.appendChild( base );\n    _context = ctx.body;\n\n    singleTag = regexpSingleTag.exec(data);\n\n    if (singleTag) {\n        result.push(document.createElement(singleTag[1]));\n    } else {\n        _context.innerHTML = data;\n        for(var i = 0; i < _context.childNodes.length; i++) {\n            result.push(_context.childNodes[i]);\n        }\n    }\n\n    return result;\n};\n\n\n// Source: src/size.js\n\n/* global $, not */\n\n$.fn.extend({\n    _size: function(prop, val){\n        if (this.length === 0) return ;\n\n        if (not(val)) {\n\n            var el = this[0];\n\n            if (prop === 'height') {\n                return el === window ? window.innerHeight : el === document ? el.body.clientHeight : parseInt(getComputedStyle(el).height);\n            }\n            if (prop === 'width') {\n                return el === window ? window.innerWidth : el === document ? el.body.clientWidth : parseInt(getComputedStyle(el).width);\n            }\n        }\n\n        return this.each(function(){\n            var el = this;\n            if (el === window || el === document) {return ;}\n            el.style[prop] = isNaN(val) ? val : val + 'px';\n        });\n    },\n\n    height: function(val){\n        return this._size('height', val);\n    },\n\n    width: function(val){\n        return this._size('width', val);\n    },\n\n    _sizeOut: function(prop, val){\n        var el, size, style, result;\n\n        if (this.length === 0) {\n            return ;\n        }\n\n        if (!not(val) && typeof val !== \"boolean\") {\n            return this.each(function(){\n                var el = this;\n                if (el === window || el === document) {return ;}\n                var h, style = getComputedStyle(el),\n                    bs = prop === 'width' ? parseInt(style['border-left-width']) + parseInt(style['border-right-width']) : parseInt(style['border-top-width']) + parseInt(style['border-bottom-width']),\n                    pa = prop === 'width' ? parseInt(style['padding-left']) + parseInt(style['padding-right']) : parseInt(style['padding-top']) + parseInt(style['padding-bottom']);\n\n                h = $(this)[prop](val)[prop]() - bs - pa;\n                el.style[prop] = h + 'px';\n            });\n        }\n\n        el = this[0];\n        size = el[prop === 'width' ? 'offsetWidth' : 'offsetHeight'];\n        style = getComputedStyle(el);\n        result = size + parseInt(style[prop === 'width' ? 'margin-left' : 'margin-top']) + parseInt(style[prop === 'width' ? 'margin-right' : 'margin-bottom']);\n        return val === true ? result : size;\n    },\n\n    outerWidth: function(val){\n        return this._sizeOut('width', val);\n    },\n\n    outerHeight: function(val){\n        return this._sizeOut('height', val);\n    },\n\n    padding: function(p){\n        if (this.length === 0) return;\n        var s = getComputedStyle(this[0], p);\n\n        return {\n            top: parseInt(s[\"padding-top\"]),\n            right: parseInt(s[\"padding-right\"]),\n            bottom: parseInt(s[\"padding-bottom\"]),\n            left: parseInt(s[\"padding-left\"])\n        };\n    },\n\n    margin: function(p){\n        if (this.length === 0) return;\n        var s = getComputedStyle(this[0], p);\n\n        return {\n            top: parseInt(s[\"margin-top\"]),\n            right: parseInt(s[\"margin-right\"]),\n            bottom: parseInt(s[\"margin-bottom\"]),\n            left: parseInt(s[\"margin-left\"])\n        };\n    },\n\n    border: function(p){\n        if (this.length === 0) return;\n        var s = getComputedStyle(this[0], p);\n\n        return {\n            top: parseInt(s[\"border-top-width\"]),\n            right: parseInt(s[\"border-right-width\"]),\n            bottom: parseInt(s[\"border-bottom-width\"]),\n            left: parseInt(s[\"border-left-width\"])\n        };\n    }\n});\n\n// Source: src/position.js\n\n/* global $, not */\n\n$.fn.extend({\n    offset: function(val){\n        var rect;\n\n        if (not(val)) {\n            if (this.length === 0) return undefined;\n            rect = this[0].getBoundingClientRect();\n            return {\n                top: rect.top + pageYOffset,\n                left: rect.left + pageXOffset\n            };\n        }\n\n        return this.each(function(){ //?\n            var el = $(this),\n                top = val.top,\n                left = val.left,\n                position = getComputedStyle(this).position,\n                offset = el.offset();\n\n            if (position === \"static\") {\n                el.css(\"position\", \"relative\");\n            }\n\n            if ([\"absolute\", \"fixed\"].indexOf(position) === -1) {\n                top = top - offset.top;\n                left = left - offset.left;\n            }\n\n            el.css({\n                top: top,\n                left: left\n            });\n        });\n    },\n\n    position: function(margin){\n        var ml = 0, mt = 0, el, style;\n\n        if (not(margin) || typeof margin !== \"boolean\") {\n            margin = false;\n        }\n\n        if (this.length === 0) {\n            return undefined;\n        }\n\n        el = this[0];\n        style = getComputedStyle(el);\n\n        if (margin) {\n            ml = parseInt(style['margin-left']);\n            mt = parseInt(style['margin-top']);\n        }\n\n        return {\n            left: el.offsetLeft - ml,\n            top: el.offsetTop - mt\n        };\n    },\n\n    left: function(val, margin){\n        if (this.length === 0) return ;\n        if (not(val)) {\n            return this.position(margin).left;\n        }\n        if (typeof val === \"boolean\") {\n            margin = val;\n            return this.position(margin).left;\n        }\n        return this.each(function(){\n            $(this).css({\n                left: val\n            });\n        });\n    },\n\n    top: function(val, margin){\n        if (this.length === 0) return ;\n        if (not(val)) {\n            return this.position(margin).top;\n        }\n        if (typeof val === \"boolean\") {\n            margin = val;\n            return this.position(margin).top;\n        }\n        return this.each(function(){\n            $(this).css({\n                top: val\n            });\n        });\n    },\n\n    coord: function(){\n        return this.length === 0 ? undefined : this[0].getBoundingClientRect();\n    },\n\n    pos: function(){\n        if (this.length === 0) return ;\n        return {\n            top: parseInt($(this[0]).style(\"top\")),\n            left: parseInt($(this[0]).style(\"left\"))\n        };\n    }\n});\n\n// Source: src/attr.js\n\n/* global $, not, isPlainObject */\n\n$.fn.extend({\n    attr: function(name, val){\n        var attributes = {};\n\n        if (this.length === 0 && arguments.length === 0) {\n            return undefined;\n        }\n\n        if (this.length && arguments.length === 0) {\n            $.each(this[0].attributes, function(){\n                attributes[this.nodeName] = this.nodeValue;\n            });\n            return attributes;\n        }\n\n        if (arguments.length === 1 && typeof name === \"string\") {\n            return this.length && this[0].nodeType === 1 && this[0].hasAttribute(name) ? this[0].getAttribute(name) : undefined;\n        }\n\n        return this.each(function(){\n            var el = this;\n            if (isPlainObject(name)) {\n                $.each(name, function(k, v){\n                    el.setAttribute(k, v);\n                });\n            } else {\n                el.setAttribute(name, val);\n                // \n            }\n        });\n    },\n\n    removeAttr: function(name){\n        var attributes;\n\n        if (not(name)) {\n            return this.each(function(){\n                var el = this;\n                $.each(this.attributes, function(){\n                    el.removeAttribute(this);\n                });\n            });\n        }\n\n        attributes = typeof name === \"string\" ? name.split(\",\").map(function(el){\n            return el.trim();\n        }) : name;\n\n        return this.each(function(){\n            var el = this;\n            $.each(attributes, function(){\n                if (el.hasAttribute(this)) el.removeAttribute(this);\n            });\n        });\n    },\n\n    toggleAttr: function(name, val){\n        return this.each(function(){\n            var el = this;\n\n            if (not(val)) {\n                el.removeAttribute(name);\n            } else {\n                el.setAttribute(name, val);\n            }\n\n        });\n    },\n\n    id: function(val){\n        return this.length ? $(this[0]).attr(\"id\", val) : undefined;\n    }\n});\n\n$.extend({\n    meta: function(name){\n        return not(name) ? $(\"meta\") : $(\"meta[name='$name']\".replace(\"$name\", name));\n    },\n\n    metaBy: function(name){\n        return not(name) ? $(\"meta\") : $(\"meta[$name]\".replace(\"$name\", name));\n    },\n\n    doctype: function(){\n        return $(\"doctype\");\n    },\n\n    html: function(){\n        return $(\"html\");\n    },\n\n    head: function(){\n        return $(\"html\").find(\"head\");\n    },\n\n    body: function(){\n        return $(\"body\");\n    },\n\n    document: function(){\n        return $(document);\n    },\n\n    window: function(){\n        return $(window);\n    },\n\n    charset: function(val){\n        var meta = $(\"meta[charset]\");\n        if (val) {\n            meta.attr(\"charset\", val);\n        }\n        return meta.attr(\"charset\");\n    }\n});\n\n// Source: src/proxy.js\n\n/* global $ */\n\n$.extend({\n    proxy: function(fn, ctx){\n        return typeof fn !== \"function\" ? undefined : fn.bind(ctx);\n    },\n\n    bind: function(fn, ctx){\n        return this.proxy(fn, ctx);\n    }\n});\n\n\n// Source: src/manipulation.js\n\n/* global $, isArrayLike, not, matches, hasProp */\n\n(function (arr) {\n    arr.forEach(function (item) {\n        ['append', 'prepend'].forEach(function(where){\n            if (hasProp(item, where)) {\n                return;\n            }\n\n            Object.defineProperty(item, where, {\n                configurable: true,\n                enumerable: true,\n                writable: true,\n                value: function () {\n                    var argArr = Array.prototype.slice.call(arguments),\n                        docFrag = document.createDocumentFragment();\n\n                    argArr.forEach(function (argItem) {\n                        var isNode = argItem instanceof Node;\n                        docFrag.appendChild(isNode ? argItem : document.createTextNode(String(argItem)));\n                    });\n\n                    if (where === 'prepend')\n                        this.insertBefore(docFrag, this.firstChild);\n                    else\n                        this.appendChild(docFrag);\n                }\n            });\n        });\n    });\n})([Element.prototype, Document.prototype, DocumentFragment.prototype]);\n\nvar normalizeElements = function(s){\n    var result;\n\n    if (typeof s === \"string\") result = $.isSelector(s) ? $(s) : $.parseHTML(s);\n    else if (s instanceof HTMLElement) result = [s];\n    else if (isArrayLike(s)) result = s;\n    return result;\n};\n\n$.fn.extend({\n\n    appendText: function(text){\n        return this.each(function(elIndex, el){\n            el.innerHTML += text;\n        });\n    },\n\n    prependText: function(text){\n        return this.each(function(elIndex, el){\n            el.innerHTML = text + el.innerHTML;\n        });\n    },\n\n    append: function(elements){\n        var _elements = normalizeElements(elements);\n\n        return this.each(function(elIndex, el){\n            $.each(_elements, function(){\n                if (el === this) return ;\n                var child = elIndex === 0 ? this : this.cloneNode(true);\n                $.script(child);\n                if (child.tagName && child.tagName !== \"SCRIPT\") el.append(child);\n            });\n        });\n    },\n\n    appendTo: function(elements){\n        var _elements = normalizeElements(elements);\n\n        return this.each(function(){\n            var el = this;\n            $.each(_elements, function(parIndex, parent){\n                if (el === this) return ;\n                parent.append(parIndex === 0 ? el : el.cloneNode(true));\n            });\n        });\n    },\n\n    prepend: function(elements){\n        var _elements = normalizeElements(elements);\n\n        return this.each(function (elIndex, el) {\n            $.each(_elements, function(){\n                if (el === this) return ;\n                var child = elIndex === 0 ? this : this.cloneNode(true);\n                $.script(child);\n                if (child.tagName && child.tagName !== \"SCRIPT\") el.prepend(child);\n            });\n        });\n    },\n\n    prependTo: function(elements){\n        var _elements = normalizeElements(elements);\n\n        return this.each(function(){\n            var el = this;\n            $.each(_elements, function(parIndex, parent){\n                if (el === this) return ;\n                $(parent).prepend(parIndex === 0 ? el : el.cloneNode(true));\n            });\n        });\n    },\n\n    insertBefore: function(elements){\n        var _elements = normalizeElements(elements);\n\n        return this.each(function(){\n            var el = this;\n            $.each(_elements, function(elIndex){\n                if (el === this) return ;\n                var parent = this.parentNode;\n                if (parent) {\n                    parent.insertBefore(elIndex === 0 ? el : el.cloneNode(true), this);\n                }\n            });\n        });\n    },\n\n    insertAfter: function(elements){\n        var _elements = normalizeElements(elements);\n\n        return this.each(function(){\n            var el = this;\n            $.each(_elements, function(elIndex, element){\n                if (el === this) return ;\n                var parent = this.parentNode;\n                if (parent) {\n                    parent.insertBefore(elIndex === 0 ? el : el.cloneNode(true), element.nextSibling);\n                }\n            });\n        });\n    },\n\n    after: function(html){\n        return this.each(function(){\n            var el = this;\n            if (typeof html === \"string\") {\n                el.insertAdjacentHTML('afterend', html);\n            } else {\n                $(html).insertAfter(el);\n            }\n        });\n    },\n\n    before: function(html){\n        return this.each(function(){\n            var el = this;\n            if (typeof html === \"string\") {\n                el.insertAdjacentHTML('beforebegin', html);\n            } else {\n                $(html).insertBefore(el);\n            }\n        });\n    },\n\n    clone: function(deep, withData){\n        var res = [];\n        if (not(deep)) {\n            deep = false;\n        }\n        if (not(withData)) {\n            withData = false;\n        }\n        this.each(function(){\n            var el = this.cloneNode(deep);\n            var $el = $(el);\n            var data;\n            if (withData && $.hasData(this)) {\n                data = $(this).data();\n                $.each(data, function(k, v){\n                    $el.data(k, v);\n                });\n            }\n            res.push(el);\n        });\n        return $.merge($(), res);\n    },\n\n    import: function(deep){\n        var res = [];\n        if (not(deep)) {\n            deep = false;\n        }\n        this.each(function(){\n            res.push(document.importNode(this, deep));\n        });\n        return $.merge($(), res);\n    },\n\n    adopt: function(){\n        var res = [];\n        this.each(function(){\n            res.push(document.adoptNode(this));\n        });\n        return $.merge($(), res);\n    },\n\n    remove: function(selector){\n        var i = 0, node, out, res = [];\n\n        if (this.length === 0) {\n            return ;\n        }\n\n        out = selector ? this.filter(function(el){\n            return matches.call(el, selector);\n        }) : this.items();\n\n        for ( ; ( node = out[ i ] ) != null; i++ ) {\n            if (node.parentNode) {\n                res.push(node.parentNode.removeChild(node));\n                $.removeData(node);\n            }\n        }\n\n        return $.merge($(), res);\n    },\n\n    wrap: function( el ){\n        if (this.length === 0) {\n            return ;\n        }\n\n        var wrapper = $(normalizeElements(el));\n\n        if (!wrapper.length) {\n            return ;\n        }\n\n        var res = [];\n\n        this.each(function(){\n            var _target, _wrapper;\n\n            _wrapper = wrapper.clone(true, true);\n            _wrapper.insertBefore(this);\n\n            _target = _wrapper;\n            while (_target.children().length) {\n                _target = _target.children().eq(0);\n            }\n            _target.append(this);\n\n            res.push(_wrapper);\n        });\n\n        return $(res);\n    },\n\n    wrapAll: function( el ){\n        var wrapper, _wrapper, _target;\n\n        if (this.length === 0) {\n            return ;\n        }\n\n        wrapper = $(normalizeElements(el));\n\n        if (!wrapper.length) {\n            return ;\n        }\n\n        _wrapper = wrapper.clone(true, true);\n        _wrapper.insertBefore(this[0]);\n\n        _target = _wrapper;\n        while (_target.children().length) {\n            _target = _target.children().eq(0);\n        }\n\n        this.each(function(){\n            _target.append(this);\n        })\n\n        return _wrapper;\n    },\n\n    wrapInner: function( el ){\n        if (this.length === 0) {\n            return ;\n        }\n\n        var wrapper = $(normalizeElements(el));\n\n        if (!wrapper.length) {\n            return ;\n        }\n\n        var res = [];\n\n        this.each(function(){\n            var elem = $(this);\n            var html = elem.html();\n            var wrp = wrapper.clone(true, true);\n            elem.html(wrp.html(html));\n            res.push(wrp);\n        });\n\n        return $(res);\n    }\n});\n\n// Source: src/animation.js\n\n/* global $, not, camelCase, parseUnit, Promise, getUnit, matches */\n\n$.extend({\n    animation: {\n        duration: 1000,\n        ease: \"linear\",\n        elements: {}\n    }\n});\n\nif (typeof window[\"setupAnimation\"] === 'object') {\n    $.each(window[\"setupAnimation\"], function(key, val){\n        if (typeof $.animation[key] !== \"undefined\" && !not(val))\n            $.animation[key] = val;\n    });\n}\n\nvar transformProps = ['translateX', 'translateY', 'translateZ', 'rotate', 'rotateX', 'rotateY', 'rotateZ', 'scale', 'scaleX', 'scaleY', 'scaleZ', 'skew', 'skewX', 'skewY'];\nvar numberProps = ['opacity', 'zIndex'];\nvar floatProps = ['opacity', 'volume'];\nvar scrollProps = [\"scrollLeft\", \"scrollTop\"];\nvar reverseProps = [\"opacity\", \"volume\"];\n\nfunction _validElement(el) {\n    return el instanceof HTMLElement || el instanceof SVGElement;\n}\n\n/**\n *\n * @param to\n * @param from\n * @returns {*}\n * @private\n */\nfunction _getRelativeValue (to, from) {\n    var operator = /^(\\*=|\\+=|-=)/.exec(to);\n    if (!operator) return to;\n    var u = getUnit(to) || 0;\n    var x = parseFloat(from);\n    var y = parseFloat(to.replace(operator[0], ''));\n    switch (operator[0][0]) {\n        case '+':\n            return x + y + u;\n        case '-':\n            return x - y + u;\n        case '*':\n            return x * y + u;\n        case '/':\n            return x / y + u;\n    }\n}\n\n/**\n *\n * @param el\n * @param prop\n * @param pseudo\n * @returns {*|number|string}\n * @private\n */\nfunction _getStyle (el, prop, pseudo){\n    if (typeof el[prop] !== \"undefined\") {\n        if (scrollProps.indexOf(prop) > -1) {\n            return prop === \"scrollLeft\" ? el === window ? pageXOffset : el.scrollLeft : el === window ? pageYOffset : el.scrollTop;\n        } else {\n            return el[prop] || 0;\n        }\n    }\n\n    return el.style[prop] || getComputedStyle(el, pseudo)[prop];\n}\n\n/**\n *\n * @param el\n * @param key\n * @param val\n * @param unit\n * @param toInt\n * @private\n */\nfunction _setStyle (el, key, val, unit, toInt) {\n\n    if (not(toInt)) {\n        toInt = false;\n    }\n\n    key = camelCase(key);\n\n    if (toInt) {\n        val  = parseInt(val);\n    }\n\n    if (_validElement(el)) {\n        if (typeof el[key] !== \"undefined\") {\n            el[key] = val;\n        } else {\n            el.style[key] = key === \"transform\" || key.toLowerCase().indexOf('color') > -1 ? val : val + unit;\n        }\n    } else {\n        el[key] = val;\n    }\n}\n\n/**\n *\n * @param el\n * @param mapProps\n * @param p\n * @private\n */\nfunction _applyStyles (el, mapProps, p) {\n    $.each(mapProps, function (key, val) {\n        _setStyle(el, key, val[0] + (val[2] * p), val[3], val[4]);\n    });\n}\n\n/**\n *\n * @param el\n * @returns {{}}\n * @private\n */\nfunction _getElementTransforms (el) {\n    if (!_validElement(el)) return {};\n    var str = el.style.transform || '';\n    var reg = /(\\w+)\\(([^)]*)\\)/g;\n    var transforms = {};\n    var m;\n\n    /* jshint ignore:start */\n    // eslint-disable-next-line\n    while (m = reg.exec(str))\n        transforms[m[1]] = m[2];\n    /* jshint ignore:end */\n\n    return transforms;\n}\n\n/**\n *\n * @param val\n * @returns {number[]}\n * @private\n */\nfunction _getColorArrayFromHex (val){\n    var a = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(val ? val : \"#000000\");\n    return a.slice(1).map(function(v) {\n            return parseInt(v, 16);\n    });\n}\n\n/**\n *\n * @param el\n * @param key\n * @returns {number[]}\n * @private\n */\nfunction _getColorArrayFromElement (el, key) {\n    return getComputedStyle(el)[key].replace(/[^\\d.,]/g, '').split(',').map(function(v) {\n        return parseInt(v);\n    });\n}\n\n/**\n *\n * @param el\n * @param mapProps\n * @param p\n * @private\n */\nfunction _applyTransform (el, mapProps, p) {\n    var t = [];\n    var elTransforms = _getElementTransforms(el);\n\n    $.each(mapProps, function(key, val) {\n        var from = val[0], to = val[1], delta = val[2], unit = val[3];\n        key = \"\" + key;\n\n        if ( key.indexOf(\"rotate\") > -1 || key.indexOf(\"skew\") > -1) {\n            if (unit === \"\") unit = \"deg\";\n        }\n\n        if (key.indexOf('scale') > -1) {\n            unit = '';\n        }\n\n        if (key.indexOf('translate') > -1 && unit === '') {\n            unit = 'px';\n        }\n\n        if (unit === \"turn\") {\n            t.push(key+\"(\" + (to * p) + unit + \")\");\n        } else {\n            t.push(key +\"(\" + (from + (delta * p)) + unit+\")\");\n        }\n    });\n\n    $.each(elTransforms, function(key, val) {\n        if (mapProps[key] === undefined) {\n            t.push(key+\"(\"+val+\")\");\n        }\n    });\n\n    el.style.transform = t.join(\" \");\n}\n\n/**\n *\n * @param el\n * @param mapProps\n * @param p\n * @private\n */\nfunction _applyColors (el, mapProps, p) {\n    $.each(mapProps, function (key, val) {\n        var i, result = [0, 0, 0], v;\n        for (i = 0; i < 3; i++) {\n            result[i] = Math.floor(val[0][i] + (val[2][i] * p));\n        }\n        v = \"rgb(\"+(result.join(\",\"))+\")\";\n        el.style[key] = v;\n    });\n}\n\n/**\n *\n * @param val\n * @returns {string|*}\n * @private\n */\nfunction _expandColorValue (val) {\n    var regExp = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n    if (val[0] === \"#\" && val.length === 4) {\n        return \"#\" + val.replace(regExp, function(m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n    }\n    return val[0] === \"#\" ? val : \"#\"+val;\n}\n\n/**\n *\n * @param el\n * @param map\n * @param p\n */\nfunction applyProps (el, map, p) {\n    _applyStyles(el, map.props, p);\n    _applyTransform(el, map.transform, p);\n    _applyColors(el, map.color, p);\n}\n\n/**\n *\n * @param el\n * @param draw\n * @param dir\n * @returns {{transform: {}, color: {}, props: {}}}\n */\nfunction createAnimationMap (el, draw, dir) {\n    var map = {\n        props: {},\n        transform: {},\n        color: {}\n    };\n    var i, from, to, delta, unit, temp;\n    var elTransforms = _getElementTransforms(el);\n\n    if (not(dir)) {\n        dir = \"normal\";\n    }\n\n    $.each(draw, function(key, val) {\n\n        var isTransformProp = transformProps.indexOf(\"\"+key) > -1;\n        var isNumProp = numberProps.indexOf(\"\"+key) > -1;\n        var isColorProp = (\"\"+key).toLowerCase().indexOf(\"color\") > -1;\n\n        if (Array.isArray(val) && val.length === 1) {\n            val = val[0];\n        }\n\n        if (!Array.isArray(val)) {\n            if (isTransformProp) {\n                from = elTransforms[key] || 0;\n            } else if (isColorProp) {\n                from = _getColorArrayFromElement(el, key);\n            } else {\n                from = _getStyle(el, key);\n            }\n            from = !isColorProp ? parseUnit(from) : from;\n            to = !isColorProp ? parseUnit(_getRelativeValue(val, Array.isArray(from) ? from[0] : from)) : _getColorArrayFromHex(val);\n        } else {\n            from = !isColorProp ? parseUnit(val[0]) : _getColorArrayFromHex(_expandColorValue(val[0]));\n            to = !isColorProp ? parseUnit(val[1]) : _getColorArrayFromHex(_expandColorValue(val[1]));\n        }\n\n        if (reverseProps.indexOf(\"\"+key) > -1 && from[0] === to[0]) {\n            from[0] = to[0] > 0 ? 0 : 1;\n        }\n\n        if (dir === \"reverse\") {\n            temp = from;\n            from = to;\n            to = temp;\n        }\n\n        unit = el instanceof HTMLElement && to[1] === '' && !isNumProp && !isTransformProp ? 'px' : to[1];\n\n        if (isColorProp) {\n            delta = [0, 0, 0];\n            for (i = 0; i < 3; i++) {\n                delta[i] = to[i] - from[i];\n            }\n        } else {\n            delta = to[0] - from[0];\n        }\n\n        if (isTransformProp) {\n            map.transform[key] = [from[0], to[0], delta, unit];\n        } else if (isColorProp) {\n            map.color[key] = [from, to, delta, unit];\n        } else {\n            map.props[key] = [from[0], to[0], delta, unit, floatProps.indexOf(\"\"+key) === -1];\n        }\n    });\n\n    return map;\n}\n\nfunction minMax(val, min, max) {\n    return Math.min(Math.max(val, min), max);\n}\n\nvar Easing = {\n    linear: function(){return function(t) {return t;};}\n};\n\nEasing.default = Easing.linear;\n\nvar eases = {\n    Sine: function(){\n        return function(t){\n            return 1 - Math.cos(t * Math.PI / 2);\n        };\n    },\n    Circ: function(){\n        return function(t){\n            return 1 - Math.sqrt(1 - t * t);\n        };\n    },\n    Back: function(){\n        return function(t){\n            return t * t * (3 * t - 2);\n        };\n    },\n    Bounce: function(){\n        return function(t){\n            var pow2, b = 4;\n            // eslint-disable-next-line\n            while (t < (( pow2 = Math.pow(2, --b)) - 1) / 11) {}\n            return 1 / Math.pow(4, 3 - b) - 7.5625 * Math.pow(( pow2 * 3 - 2 ) / 22 - t, 2);\n        };\n    },\n    Elastic: function(amplitude, period){\n        if (not(amplitude)) {\n            amplitude = 1;\n        }\n\n        if (not(period)) {\n            period = 0.5;\n        }\n        var a = minMax(amplitude, 1, 10);\n        var p = minMax(period, 0.1, 2);\n        return function(t){\n            return (t === 0 || t === 1) ? t :\n                -a * Math.pow(2, 10 * (t - 1)) * Math.sin((((t - 1) - (p / (Math.PI * 2) * Math.asin(1 / a))) * (Math.PI * 2)) / p);\n        };\n    }\n};\n\n['Quad', 'Cubic', 'Quart', 'Quint', 'Expo'].forEach(function(name, i) {\n    eases[name] = function(){\n        return function(t){\n            return Math.pow(t, i + 2);\n        };\n    };\n});\n\nObject.keys(eases).forEach(function(name) {\n    var easeIn = eases[name];\n    Easing['easeIn' + name] = easeIn;\n    Easing['easeOut' + name] = function(a, b){\n        return function(t){\n            return 1 - easeIn(a, b)(1 - t);\n        };\n    };\n    Easing['easeInOut' + name] = function(a, b){\n        return function(t){\n            return t < 0.5 ? easeIn(a, b)(t * 2) / 2 : 1 - easeIn(a, b)(t * -2 + 2) / 2;\n        };\n    };\n});\n\nvar defaultAnimationProps = {\n    id: null,\n    el: null,\n    draw: {},\n    dur: $.animation.duration,\n    ease: $.animation.ease,\n    loop: 0,\n    pause: 0,\n    dir: \"normal\",\n    defer: 0,\n    onStart: function(){},\n    onStop: function(){},\n    onStopAll: function(){},\n    onPause: function(){},\n    onPauseAll: function(){},\n    onResume: function(){},\n    onResumeAll: function(){},\n    onFrame: function(){},\n    onDone: function(){}\n};\n\nfunction animate(args){\n    return new Promise(function(resolve){\n        var that = this;\n        var props = $.assign({}, defaultAnimationProps, {dur: $.animation.duration, ease: $.animation.ease}, args);\n        var id = props.id, el = props.el, draw = props.draw, dur = props.dur, ease = props.ease, loop = props.loop,\n            onStart = props.onStart, onFrame = props.onFrame, onDone = props.onDone,\n            pauseStart = props.pause, dir = props.dir, defer = props.defer;\n        var map = {};\n        var easeName = \"linear\", easeArgs = [], easeFn = Easing.linear, matchArgs;\n        var direction = dir === \"alternate\" ? \"normal\" : dir;\n        var replay = false;\n        var animationID = id ? id : +(performance.now() * Math.pow(10, 14));\n\n        if (not(el)) {\n            throw new Error(\"Unknown element!\");\n        }\n\n        if (typeof el === \"string\") {\n            el = document.querySelector(el);\n        }\n\n        if (typeof draw !== \"function\" && typeof draw !== \"object\") {\n            throw new Error(\"Unknown draw object. Must be a function or object!\");\n        }\n\n        if (dur === 0) {\n            dur = 1;\n        }\n\n        if (dir === \"alternate\" && typeof loop === \"number\") {\n            loop *= 2;\n        }\n\n        if (typeof ease === \"string\") {\n            matchArgs = /\\(([^)]+)\\)/.exec(ease);\n            easeName = ease.split(\"(\")[0];\n            easeArgs = matchArgs ? matchArgs[1].split(',').map(function(p){return parseFloat(p);}) : [];\n            easeFn = Easing[easeName] || Easing.linear;\n        } else if (typeof ease === \"function\") {\n            easeFn = ease;\n        } else {\n            easeFn = Easing.linear;\n        }\n\n        $.animation.elements[animationID] = {\n            element: el,\n            id: null,\n            stop: 0,\n            pause: 0,\n            loop: 0,\n            t: -1,\n            started: 0,\n            paused: 0\n        };\n\n        var play = function() {\n            if (typeof draw === \"object\") {\n                map = createAnimationMap(el, draw, direction);\n            }\n\n            if (typeof onStart === \"function\") {\n                onStart.apply(el);\n            }\n\n            // start = performance.now();\n            $.animation.elements[animationID].loop += 1;\n            $.animation.elements[animationID].started = performance.now();\n            $.animation.elements[animationID].duration = dur;\n            $.animation.elements[animationID].id = requestAnimationFrame(animate);\n        };\n\n        var done = function() {\n            cancelAnimationFrame($.animation.elements[animationID].id);\n            delete $.animation.elements[id];\n\n            if (typeof onDone === \"function\") {\n                onDone.apply(el);\n            }\n\n            resolve(that);\n        };\n\n        var animate = function(time) {\n            var p, t;\n            var stop = $.animation.elements[animationID].stop;\n            var pause = $.animation.elements[animationID].pause;\n            var start = $.animation.elements[animationID].started;\n\n            if ($.animation.elements[animationID].paused) {\n                start = time - $.animation.elements[animationID].t * dur;\n                $.animation.elements[animationID].started = start;\n            }\n\n            t = ((time - start) / dur).toFixed(4);\n\n            if (t > 1) t = 1;\n            if (t < 0) t = 0;\n\n            p = easeFn.apply(null, easeArgs)(t);\n\n            $.animation.elements[animationID].t = t;\n            $.animation.elements[animationID].p = p;\n\n            if (pause) {\n                $.animation.elements[animationID].id = requestAnimationFrame(animate);\n                // $.animation.elements[animationID].started = performance.now();\n                return;\n            }\n\n            if ( stop > 0) {\n                if (stop === 2) {\n                    if (typeof draw === \"function\") {\n                        draw.bind(el)(1, 1);\n                    } else {\n                        applyProps(el, map, 1);\n                    }\n                }\n                done();\n                return;\n            }\n\n            if (typeof draw === \"function\") {\n                draw.bind(el)(t, p);\n            } else {\n                applyProps(el, map, p);\n            }\n\n            if (typeof onFrame === 'function') {\n                onFrame.apply(el, [t, p]);\n            }\n\n            if (t < 1) {\n                $.animation.elements[animationID].id = requestAnimationFrame(animate);\n            }\n\n            if (parseInt(t) === 1) {\n                if (loop) {\n                    if (dir === \"alternate\") {\n                        direction = direction === \"normal\" ? \"reverse\" : \"normal\";\n                    }\n\n                    if (typeof loop === \"boolean\") {\n                        setTimeout(function () {\n                            play();\n                        }, pauseStart);\n                    } else {\n                        if (loop > $.animation.elements[animationID].loop) {\n                            setTimeout(function () {\n                                play();\n                            }, pauseStart);\n                        } else {\n                            done();\n                        }\n                    }\n                } else {\n                    if (dir === \"alternate\" && !replay) {\n                        direction = direction === \"normal\" ? \"reverse\" : \"normal\";\n                        replay = true;\n                        play();\n                    } else {\n                        done();\n                    }\n                }\n            }\n        };\n        if (defer > 0) {\n            setTimeout(function() {\n                play();\n            }, defer);\n        } else {\n            play();\n        }\n    });\n}\n\n// Stop animation\nfunction stopAnimation(id, done){\n    var an = $.animation.elements[id];\n\n    if (typeof an === \"undefined\") {\n        return ;\n    }\n\n    if (not(done)) {\n        done = true;\n    }\n\n    an.stop = done === true ? 2 : 1;\n\n    if (typeof an.onStop === \"function\") {\n        an.onStop.apply(an.element);\n    }\n}\n\nfunction stopAnimationAll(done, filter){\n    $.each($.animation.elements, function(k, v){\n        if (filter) {\n            if (typeof filter === \"string\") {\n                if (matches.call(v.element, filter)) stopAnimation(k, done);\n            } else if (filter.length) {\n                $.each(filter, function(){\n                    if (v.element === this) stopAnimation(k, done);\n                });\n            } else if (filter instanceof Element) {\n                if (v.element === filter) stopAnimation(k, done);\n            }\n        } else {\n            stopAnimation(k, done);\n        }\n    });\n}\n// end of stop\n\n// Pause and resume animation\nfunction pauseAnimation(id){\n    var an = $.animation.elements[id];\n\n    if (typeof an === \"undefined\") {\n        return ;\n    }\n\n    an.pause = 1;\n    an.paused = performance.now();\n\n    if (typeof an.onPause === \"function\") {\n        an.onPause.apply(an.element);\n    }\n}\n\nfunction pauseAnimationAll(filter){\n    $.each($.animation.elements, function(k, v){\n        if (filter) {\n            if (typeof filter === \"string\") {\n                if (matches.call(v.element, filter)) pauseAnimation(k);\n            } else if (filter.length) {\n                $.each(filter, function(){\n                    if (v.element === this) pauseAnimation(k);\n                });\n            } else if (filter instanceof Element) {\n                if (v.element === filter) pauseAnimation(k);\n            }\n        } else {\n            pauseAnimation(k);\n        }\n    });\n}\n// end of pause\n\nfunction resumeAnimation(id){\n    var an = $.animation.elements[id];\n\n    if (typeof an === \"undefined\") {\n        return ;\n    }\n\n    an.pause = 0;\n    an.paused = 0;\n\n    if (typeof an.onResume === \"function\") {\n        an.onResume.apply(an.element);\n    }\n}\n\nfunction resumeAnimationAll(filter){\n    $.each($.animation.elements, function(k, v){\n        if (filter) {\n            if (typeof filter === \"string\") {\n                if (matches.call(v.element, filter)) resumeAnimation(k);\n            } else if (filter.length) {\n                $.each(filter, function(){\n                    if (v.element === this) resumeAnimation(k);\n                });\n            } else if (filter instanceof Element) {\n                if (v.element === filter) resumeAnimation(k);\n            }\n        } else {\n            resumeAnimation(k);\n        }\n    });\n}\n\n/* eslint-enable */\n\nvar defaultChainOptions = {\n    loop: false,\n    onChainItem: null,\n    onChainItemComplete: null,\n    onChainComplete: null\n}\n\nfunction chain(arr, opt){\n    var o = $.extend({}, defaultChainOptions, opt);\n\n    if (typeof o.loop !== \"boolean\") {\n        o.loop--;\n    }\n\n    if (!Array.isArray(arr)) {\n        console.warn(\"Chain array is not defined!\");\n        return false;\n    }\n\n    var reducer = function(acc, item){\n        return acc.then(function(){\n            if (typeof o[\"onChainItem\"] === \"function\") {\n                o[\"onChainItem\"](item);\n            }\n            return animate(item).then(function(){\n                if (typeof o[\"onChainItemComplete\"] === \"function\") {\n                    o[\"onChainItemComplete\"](item);\n                }\n            });\n        });\n    };\n\n    arr.reduce(reducer, Promise.resolve()).then(function(){\n        if (typeof o[\"onChainComplete\"] === \"function\") {\n            o[\"onChainComplete\"]();\n        }\n\n        if (o.loop) {\n            chain(arr, o);\n        }\n    });\n}\n\n$.easing = {};\n\n$.extend($.easing, Easing);\n\n$.extend({\n    animate: function(args){\n        var el, draw, dur, ease, cb;\n\n        if (arguments.length > 1) {\n            el = $(arguments[0])[0];\n            draw = arguments[1];\n            dur = arguments[2] || $.animation.duration;\n            ease = arguments[3] || $.animation.ease;\n            cb = arguments[4];\n\n            if (typeof dur === 'function') {\n                cb = dur;\n                ease = $.animation.ease;\n                dur = $.animation.duration;\n            }\n\n            if (typeof ease === 'function') {\n                cb = ease;\n                ease = $.animation.ease;\n            }\n\n            return animate({\n                el: el,\n                draw: draw,\n                dur: dur,\n                ease: ease,\n                onDone: cb\n            });\n        }\n\n        return animate(args);\n    },\n    chain: chain,\n    stop: stopAnimation,\n    stopAll: stopAnimationAll,\n    resume: resumeAnimation,\n    resumeAll: resumeAnimationAll,\n    pause: pauseAnimation,\n    pauseAll: pauseAnimationAll\n});\n\n$.fn.extend({\n    /**\n     *\n\n     args = {\n         draw: {} | function,\n         dur: 1000,\n         ease: \"linear\",\n         loop: 0,\n         pause: 0,\n         dir: \"normal\",\n         defer: 0,\n         onFrame: function,\n         onDone: function\n     }\n\n     * @returns {this}\n     */\n    animate: function(args){\n        var that = this;\n        var draw, dur, easing, cb;\n        var a = args;\n        var compatibilityMode;\n\n        compatibilityMode = !Array.isArray(args) && (arguments.length > 1 || (arguments.length === 1 && typeof arguments[0].draw === 'undefined'));\n\n        if ( compatibilityMode ) {\n            draw = arguments[0];\n            dur = arguments[1] || $.animation.duration;\n            easing = arguments[2] || $.animation.ease;\n            cb = arguments[3];\n\n            if (typeof dur === 'function') {\n                cb = dur;\n                dur = $.animation.duration;\n                easing = $.animation.ease;\n            }\n\n            if (typeof easing === 'function') {\n                cb = easing;\n                easing = $.animation.ease;\n            }\n\n            return this.each(function(){\n                return $.animate({\n                    el: this,\n                    draw: draw,\n                    dur: dur,\n                    ease: easing,\n                    onDone: cb\n                });\n            });\n        }\n\n        if (Array.isArray(args)) {\n            $.each(args, function(){\n                var a = this;\n                that.each(function(){\n                    a.el = this;\n                    $.animate(a);\n                });\n            });\n            return this;\n        }\n\n        return this.each(function(){\n            a.el = this;\n            $.animate(a);\n        });\n    },\n\n    chain: function(arr, loop){\n        return this.each(function(){\n            var el = this;\n            $.each(arr, function(){\n                this.el = el;\n            });\n            $.chain(arr, loop);\n        });\n    },\n\n    /**\n     *\n     * @param done\n     * @returns {this}\n     */\n    stop: function(done){\n        return this.each(function(){\n            var el = this;\n            $.each($.animation.elements, function(k, o){\n                if (o.element === el) {\n                    stopAnimation(k, done);\n                }\n            });\n        });\n    },\n\n    pause: function(){\n        return this.each(function(){\n            var el = this;\n            $.each($.animation.elements, function(k, o){\n                if (o.element === el) {\n                    pauseAnimation(k);\n                }\n            });\n        });\n    },\n\n    resume: function(){\n        return this.each(function(){\n            var el = this;\n            $.each($.animation.elements, function(k, o){\n                if (o.element === el) {\n                    resumeAnimation(k);\n                }\n            });\n        });\n    }\n});\n\n\n// Source: src/visibility.js\n\n/* global $ */\n\n$.extend({\n    hidden: function(el, val, cb){\n        el = $(el)[0];\n\n        if (typeof val === \"string\") {\n            val = val.toLowerCase() === \"true\";\n        }\n\n        if (typeof val === \"function\") {\n            cb = val;\n            val = !el.hidden;\n        }\n\n        el.hidden = val;\n\n        if (typeof cb === \"function\") {\n            $.bind(cb, el);\n            cb.call(el, arguments);\n        }\n\n        return this;\n    },\n\n    hide: function(el, cb){\n        var $el = $(el);\n\n        $el.origin('display', (el.style.display ? el.style.display : getComputedStyle(el, null).display));\n        el.style.display = 'none';\n\n        if (typeof cb === \"function\") {\n            $.bind(cb, el);\n            cb.call(el, arguments);\n        }\n\n        return this;\n    },\n\n    show: function(el, cb){\n        var display = $(el).origin('display', undefined, \"block\");\n        el.style.display = display ? display === 'none' ? 'block' : display : '';\n        if (parseInt(el.style.opacity) === 0) {\n            el.style.opacity = \"1\";\n        }\n        if (typeof cb === \"function\") {\n            $.bind(cb, el);\n            cb.call(el, arguments);\n        }\n        return this;\n    },\n\n    visible: function(el, mode, cb){\n        if (mode === undefined) {\n            mode = true;\n        }\n        el.style.visibility = mode ? 'visible' : 'hidden';\n        if (typeof cb === \"function\") {\n            $.bind(cb, el);\n            cb.call(el, arguments);\n        }\n        return this;\n    },\n\n    toggle: function(el, cb){\n        var func = getComputedStyle(el, null).display !== 'none' ? 'hide' : 'show';\n        return $[func](el, cb);\n    }\n});\n\n$.fn.extend({\n    hide: function(){\n        var callback;\n\n        $.each(arguments, function(){\n            if (typeof this === 'function') {\n                callback = this;\n            }\n        });\n\n        return this.each(function(){\n            $.hide(this, callback);\n        });\n    },\n\n    show: function(){\n        var callback;\n\n        $.each(arguments, function(){\n            if (typeof this === 'function') {\n                callback = this;\n            }\n        });\n\n        return this.each(function(){\n            $.show(this, callback);\n        });\n    },\n\n    visible: function(mode, cb){\n        return this.each(function(){\n            $.visible(this, mode, cb);\n        });\n    },\n\n    toggle: function(cb){\n        return this.each(function(){\n            $.toggle(this, cb);\n        });\n    },\n\n    hidden: function(val, cb){\n        return this.each(function(){\n            $.hidden(this, val, cb);\n        });\n    }\n});\n\n\n\n// Source: src/effects.js\n\n/* global $, not, isVisible */\n\n$.extend({\n    fx: {\n        off: false\n    }\n});\n\n$.fn.extend({\n    fadeIn: function(dur, easing, cb){\n        return this.each(function(){\n            var el = this;\n            var $el = $(el);\n            var visible = !(!isVisible(el) || (isVisible(el) && +($el.style('opacity')) === 0));\n\n            if (visible) {\n                return this;\n            }\n\n            if (not(dur) && not(easing) && not(cb)) {\n                cb = null;\n                dur = $.animation.duration;\n            } else if (typeof dur === \"function\") {\n                cb = dur;\n                dur = $.animation.duration;\n            }\n\n            if (typeof easing === \"function\") {\n                cb = easing;\n                easing = $.animation.ease;\n            }\n\n            if ($.fx.off) {\n                dur = 0;\n            }\n\n            var originDisplay = $el.origin(\"display\", undefined, 'block');\n\n            el.style.opacity = \"0\";\n            el.style.display = originDisplay;\n\n            return $.animate({\n                el: el,\n                draw: {\n                    opacity: 1\n                },\n                dur: dur,\n                ease: easing,\n                onDone: function(){\n                    if (typeof cb === 'function') {\n                        $.proxy(cb, this)();\n                    }\n                }\n            });\n        });\n    },\n\n    fadeOut: function(dur, easing, cb){\n        return this.each(function(){\n            var el = this;\n            var $el = $(el);\n\n            if ( !isVisible(el) ) return ;\n\n            if (not(dur) && not(easing) && not(cb)) {\n                cb = null;\n                dur = $.animation.duration;\n            } else\n            if (typeof dur === \"function\") {\n                cb = dur;\n                dur = $.animation.duration;\n            }\n            if (typeof easing === \"function\") {\n                cb = easing;\n                easing = $.animation.ease;\n            }\n\n            $el.origin(\"display\", $el.style('display'));\n\n            return $.animate({\n                el: el,\n                draw: {\n                    opacity: 0\n                },\n                dur: dur,\n                ease: easing,\n                onDone: function(){\n                    this.style.display = 'none';\n\n                    if (typeof cb === 'function') {\n                        $.proxy(cb, this)();\n                    }\n                }\n            });\n        });\n    },\n\n    slideUp: function(dur, easing, cb){\n        return this.each(function(){\n            var el = this;\n            var $el = $(el);\n            var currHeight;\n\n            if ($el.height() === 0) return ;\n\n            if (not(dur) && not(easing) && not(cb)) {\n                cb = null;\n                dur = $.animation.duration;\n            } else\n            if (typeof dur === \"function\") {\n                cb = dur;\n                dur = $.animation.duration;\n            }\n            if (typeof easing === \"function\") {\n                cb = easing;\n                easing = $.animation.ease;\n            }\n\n            currHeight = $el.height();\n            $el.origin(\"height\", currHeight);\n            $el.origin(\"display\", $(el).style('display'));\n\n            $el.css({\n                overflow: \"hidden\"\n            });\n\n            return $.animate({\n                el: el,\n                draw: {\n                    height: 0\n                },\n                dur: dur,\n                ease: easing,\n                onDone: function(){\n                    $el.hide().removeStyleProperty(\"overflow, height\");\n                    if (typeof cb === 'function') {\n                        $.proxy(cb, this)();\n                    }\n                }\n            });\n        });\n    },\n\n    slideDown: function(dur, easing, cb){\n        return this.each(function(){\n            var el = this;\n            var $el = $(el);\n            var targetHeight, originDisplay;\n\n            if (not(dur) && not(easing) && not(cb)) {\n                cb = null;\n                dur = $.animation.duration;\n            } else\n            if (typeof dur === \"function\") {\n                cb = dur;\n                dur = $.animation.duration;\n            }\n            if (typeof easing === \"function\") {\n                cb = easing;\n                easing = $.animation.ease;\n            }\n\n            $el.show().visible(false);\n            targetHeight = +$el.origin(\"height\", undefined, $el.height());\n            if (parseInt(targetHeight) === 0) {\n                targetHeight = el.scrollHeight;\n            }\n            originDisplay = $el.origin(\"display\", $el.style('display'), \"block\");\n            $el.height(0).visible(true);\n\n            $el.css({\n                overflow: \"hidden\",\n                display: originDisplay === \"none\" ? \"block\" : originDisplay\n            });\n\n            return $.animate({\n                el: el,\n                draw: {\n                    height: targetHeight\n                },\n                dur: dur,\n                ease: easing,\n                onDone: function(){\n                    $(el).removeStyleProperty(\"overflow, height, visibility\");\n                    if (typeof cb === 'function') {\n                        $.proxy(cb, this)();\n                    }\n                }\n            });\n        });\n    },\n\n    moveTo: function(x, y, dur, easing, cb){\n        var draw = {\n            top: y,\n            left: x\n        };\n\n        if (typeof dur === \"function\") {\n            cb = dur;\n            dur = $.animation.duration;\n            easing = $.animation.ease;\n        }\n\n        if (typeof easing === \"function\") {\n            cb = easing;\n            easing = $.animation.ease;\n        }\n\n        return this.each(function(){\n            $.animate({\n                el: this,\n                draw: draw,\n                dur: dur,\n                ease: easing,\n                onDone: cb\n            });\n        });\n    },\n\n    centerTo: function(x, y, dur, easing, cb){\n        if (typeof dur === \"function\") {\n            cb = dur;\n            dur = $.animation.duration;\n            easing = $.animation.ease;\n        }\n\n        if (typeof easing === \"function\") {\n            cb = easing;\n            easing = $.animation.ease;\n        }\n\n        return this.each(function(){\n            var draw = {\n                left: x - this.clientWidth / 2,\n                top: y - this.clientHeight / 2\n            };\n            $.animate({\n                el: this,\n                draw: draw,\n                dur: dur,\n                ease: easing,\n                onDone: cb\n            });\n        });\n    },\n\n    colorTo: function(color, dur, easing, cb){\n        var draw = {\n            color: color\n        };\n\n        if (typeof dur === \"function\") {\n            cb = dur;\n            dur = $.animation.duration;\n            easing = $.animation.ease;\n        }\n\n        if (typeof easing === \"function\") {\n            cb = easing;\n            easing = $.animation.ease;\n        }\n\n        return this.each(function(){\n            $.animate({\n                el: this,\n                draw: draw,\n                dur: dur,\n                ease: easing,\n                onDone: cb\n            });\n        });\n    },\n\n    backgroundTo: function(color, dur, easing, cb){\n        var draw = {\n            backgroundColor: color\n        };\n\n        if (typeof dur === \"function\") {\n            cb = dur;\n            dur = $.animation.duration;\n            easing = $.animation.ease;\n        }\n\n        if (typeof easing === \"function\") {\n            cb = easing;\n            easing = $.animation.ease;\n        }\n\n        return this.each(function(){\n            $.animate({\n                el: this,\n                draw: draw,\n                dur: dur,\n                ease: easing,\n                onDone: cb\n            });\n        });\n    }\n});\n\n// Source: src/init.js\n\n/* global $, isArrayLike, isPlainObject, hasProp, str2arr */\n\n$.init = function(sel, ctx){\n    var parsed;\n    var that = this;\n\n    if (typeof sel === \"string\") {\n        sel = sel.trim();\n    }\n\n    this.uid = $.uniqueId();\n\n    if (!sel) {\n        return this;\n    }\n\n    if (typeof sel === \"function\") {\n        return $.ready(sel);\n    }\n\n    if (sel instanceof Element) {\n        this.push(sel);\n        return this;\n    }\n\n    if (sel instanceof $) {\n        $.each(sel, function(){\n            that.push(this);\n        });\n        return this;\n    }\n\n    if (sel === \"window\") sel = window;\n    if (sel === \"document\") sel = document;\n    if (sel === \"body\") sel = document.body;\n    if (sel === \"html\") sel = document.documentElement;\n    if (sel === \"doctype\") sel = document.doctype;\n    if (sel && (sel.nodeType || sel.self === window)) {\n        this.push(sel);\n        return this;\n    }\n\n    if (isArrayLike(sel)) {\n        $.each(sel, function(){\n            $(this).each(function(){\n                that.push(this);\n            });\n        });\n        return this;\n    }\n\n    if (typeof sel !== \"string\" && (sel.self && sel.self !== window)) {\n        return this;\n    }\n\n    if (sel === \"#\" || sel === \".\") {\n        console.error(\"Selector can't be # or .\") ;\n        return this;\n    }\n\n    if (sel[0] === \"@\") {\n\n        $(\"[data-role]\").each(function(){\n            var roles = str2arr($(this).attr(\"data-role\"), \",\");\n            if (roles.indexOf(sel.slice(1)) > -1) {\n                that.push(this);\n            }\n        });\n\n    } else {\n\n        parsed = $.parseHTML(sel);\n\n        if (parsed.length === 1 && parsed[0].nodeType === 3) { // Must be a text node -> css sel\n            try {\n                [].push.apply(this, document.querySelectorAll(sel));\n            } catch (e) {\n                //console.error(sel + \" is not a valid selector\");\n            }\n        } else {\n            $.merge(this, parsed);\n        }\n    }\n\n    if (ctx !== undefined) {\n        if (ctx instanceof $) {\n            this.each(function () {\n                $(ctx).append(that);\n            });\n        } else if (ctx instanceof HTMLElement) {\n            $(ctx).append(that);\n        } else {\n            if (isPlainObject(ctx)) {\n                $.each(this,function(){\n                    for(var name in ctx) {\n                        if (hasProp(ctx, name))\n                            this.setAttribute(name, ctx[name]);\n                    }\n                });\n            }\n        }\n    }\n\n    return this;\n};\n\n$.init.prototype = $.fn;\n\n\n// Source: src/populate.js\n\n/* global Promise, $ */\n\nvar _$ = window.$;\n\n$.Promise = Promise;\n\nwindow.m4q = $;\n\nif (typeof window.$ === \"undefined\") {\n    window.$ = $;\n}\n\n$.global = function(){\n    _$ = window.$;\n    window.$ = $;\n};\n\n$.noConflict = function() {\n    if ( window.$ === $ ) {\n        window.$ = _$;\n    }\n\n    return $;\n};\n\n}(window));\n\r\n\r\n(function($) {\n    'use strict';\n\n    var meta_init = $.meta('metro4:init').attr(\"content\");\n    var meta_locale = $.meta('metro4:locale').attr(\"content\");\n    var meta_week_start = $.meta('metro4:week_start').attr(\"content\");\n    var meta_date_format = $.meta('metro4:date_format').attr(\"content\");\n    var meta_date_format_input = $.meta('metro4:date_format_input').attr(\"content\");\n    var meta_animation_duration = $.meta('metro4:animation_duration').attr(\"content\");\n    var meta_callback_timeout = $.meta('metro4:callback_timeout').attr(\"content\");\n    var meta_timeout = $.meta('metro4:timeout').attr(\"content\");\n    var meta_scroll_multiple = $.meta('metro4:scroll_multiple').attr(\"content\");\n    var meta_cloak = $.meta('metro4:cloak').attr(\"content\");\n    var meta_cloak_duration = $.meta('metro4:cloak_duration').attr(\"content\");\n    var meta_global_common = $.meta('metro4:global_common').attr(\"content\");\n    var meta_blur_image = $.meta('metro4:blur_image').attr(\"content\");\n\n    if (window.METRO_BLUR_IMAGE === undefined) {\n        window.METRO_BLUR_IMAGE = meta_blur_image !== undefined ? JSON.parse(meta_global_common) : false;\n    }\n\n    if (window.METRO_GLOBAL_COMMON === undefined) {\n        window.METRO_GLOBAL_COMMON = meta_global_common !== undefined ? JSON.parse(meta_global_common) : false;\n    }\n\n    var meta_jquery = $.meta('metro4:jquery').attr(\"content\"); //undefined\n    window.jquery_present = typeof jQuery !== \"undefined\";\n    if (window.METRO_JQUERY === undefined) {\n        window.METRO_JQUERY = meta_jquery !== undefined ? JSON.parse(meta_jquery) : true;\n    }\n    window.useJQuery = window.jquery_present && window.METRO_JQUERY;\n\n\n    /* Added by Ken Kitay https://github.com/kens-code*/\n    var meta_about = $.meta('metro4:about').attr(\"content\");\n    if (window.METRO_SHOW_ABOUT === undefined) {\n        window.METRO_SHOW_ABOUT = meta_about !== undefined ? JSON.parse(meta_about) : true;\n    }\n    /* --- end ---*/\n\n    var meta_compile = $.meta('metro4:compile').attr(\"content\");\n    if (window.METRO_SHOW_COMPILE_TIME === undefined) {\n        window.METRO_SHOW_COMPILE_TIME = meta_compile !== undefined ? JSON.parse(meta_compile) : true;\n    }\n\n    if (window.METRO_INIT === undefined) {\n        window.METRO_INIT = meta_init !== undefined ? JSON.parse(meta_init) : true;\n    }\n\n    if (window.METRO_DEBUG === undefined) {window.METRO_DEBUG = true;}\n\n    if (window.METRO_WEEK_START === undefined) {\n        window.METRO_WEEK_START = meta_week_start !== undefined ? parseInt(meta_week_start) : 0;\n    }\n    if (window.METRO_DATE_FORMAT === undefined) {\n        window.METRO_DATE_FORMAT = meta_date_format !== undefined ? meta_date_format : \"YYYY-MM-DD\";\n    }\n    if (window.METRO_DATE_FORMAT_INPUT === undefined) {\n        window.METRO_DATE_FORMAT_INPUT = meta_date_format_input !== undefined ? meta_date_format_input : \"YYYY-MM-DD\";\n    }\n    if (window.METRO_LOCALE === undefined) {\n        window.METRO_LOCALE = meta_locale !== undefined ? meta_locale : 'en-US';\n    }\n    if (window.METRO_ANIMATION_DURATION === undefined) {\n        window.METRO_ANIMATION_DURATION = meta_animation_duration !== undefined ? parseInt(meta_animation_duration) : 100;\n    }\n    if (window.METRO_CALLBACK_TIMEOUT === undefined) {\n        window.METRO_CALLBACK_TIMEOUT = meta_callback_timeout !== undefined ? parseInt(meta_callback_timeout) : 500;\n    }\n    if (window.METRO_TIMEOUT === undefined) {\n        window.METRO_TIMEOUT = meta_timeout !== undefined ? parseInt(meta_timeout) : 2000;\n    }\n    if (window.METRO_SCROLL_MULTIPLE === undefined) {\n        window.METRO_SCROLL_MULTIPLE = meta_scroll_multiple !== undefined ? parseInt(meta_scroll_multiple) : 20;\n    }\n    if (window.METRO_CLOAK_REMOVE === undefined) {\n        window.METRO_CLOAK_REMOVE = meta_cloak !== undefined ? (\"\"+meta_cloak).toLowerCase() : \"fade\";\n    }\n    if (window.METRO_CLOAK_DURATION === undefined) {\n        window.METRO_CLOAK_DURATION = meta_cloak_duration !== undefined ? parseInt(meta_cloak_duration) : 300;\n    }\n\n    if (window.METRO_HOTKEYS_FILTER_CONTENT_EDITABLE === undefined) {window.METRO_HOTKEYS_FILTER_CONTENT_EDITABLE = true;}\n    if (window.METRO_HOTKEYS_FILTER_INPUT_ACCEPTING_ELEMENTS === undefined) {window.METRO_HOTKEYS_FILTER_INPUT_ACCEPTING_ELEMENTS = true;}\n    if (window.METRO_HOTKEYS_FILTER_TEXT_INPUTS === undefined) {window.METRO_HOTKEYS_FILTER_TEXT_INPUTS = true;}\n    if (window.METRO_HOTKEYS_BUBBLE_UP === undefined) {window.METRO_HOTKEYS_BUBBLE_UP = false;}\n    if (window.METRO_THROWS === undefined) {window.METRO_THROWS = true;}\n\n    window.METRO_MEDIA = [];\n\n}(m4q));\r\n\r\n/* Metro 4 Core */\n(function() {\n    'use strict';\n\n    var $ = m4q;\n\n    if (typeof m4q === 'undefined') {\n        throw new Error('Metro 4 requires m4q helper!');\n    }\n\n    if (!('MutationObserver' in window)) {\n        throw new Error('Metro 4 requires MutationObserver!');\n    }\n\n    var isTouch = (('ontouchstart' in window) || (navigator[\"MaxTouchPoints\"] > 0) || (navigator[\"msMaxTouchPoints\"] > 0));\n\n    var normalizeComponentName = function(name){\n        return typeof name !== \"string\" ? undefined : name.replace(/-/g, \"\").toLowerCase();\n    };\n\n    var Metro = {\n\n        version: \"4.5.0\",\n        compileTime: \"01/08/2021 18:53:43\",\n        buildNumber: \"755\",\n        isTouchable: isTouch,\n        fullScreenEnabled: document.fullscreenEnabled,\n        sheet: null,\n\n\n        controlsPosition: {\n            INSIDE: \"inside\",\n            OUTSIDE: \"outside\"\n        },\n\n        groupMode: {\n            ONE: \"one\",\n            MULTI: \"multi\"\n        },\n\n        aspectRatio: {\n            HD: \"hd\",\n            SD: \"sd\",\n            CINEMA: \"cinema\"\n        },\n\n        fullScreenMode: {\n            WINDOW: \"window\",\n            DESKTOP: \"desktop\"\n        },\n\n        position: {\n            TOP: \"top\",\n            BOTTOM: \"bottom\",\n            LEFT: \"left\",\n            RIGHT: \"right\",\n            TOP_RIGHT: \"top-right\",\n            TOP_LEFT: \"top-left\",\n            BOTTOM_LEFT: \"bottom-left\",\n            BOTTOM_RIGHT: \"bottom-right\",\n            LEFT_BOTTOM: \"left-bottom\",\n            LEFT_TOP: \"left-top\",\n            RIGHT_TOP: \"right-top\",\n            RIGHT_BOTTOM: \"right-bottom\"\n        },\n\n        popoverEvents: {\n            CLICK: \"click\",\n            HOVER: \"hover\",\n            FOCUS: \"focus\"\n        },\n\n        stepperView: {\n            SQUARE: \"square\",\n            CYCLE: \"cycle\",\n            DIAMOND: \"diamond\"\n        },\n\n        listView: {\n            LIST: \"list\",\n            CONTENT: \"content\",\n            ICONS: \"icons\",\n            ICONS_MEDIUM: \"icons-medium\",\n            ICONS_LARGE: \"icons-large\",\n            TILES: \"tiles\",\n            TABLE: \"table\"\n        },\n\n        events: {\n            click: 'click',\n            start: isTouch ? 'touchstart' : 'mousedown',\n            stop: isTouch ? 'touchend' : 'mouseup',\n            move: isTouch ? 'touchmove' : 'mousemove',\n            enter: isTouch ? 'touchstart' : 'mouseenter',\n\n            startAll: 'mousedown touchstart',\n            stopAll: 'mouseup touchend',\n            moveAll: 'mousemove touchmove',\n\n            leave: 'mouseleave',\n            focus: 'focus',\n            blur: 'blur',\n            resize: 'resize',\n            keyup: 'keyup',\n            keydown: 'keydown',\n            keypress: 'keypress',\n            dblclick: 'dblclick',\n            input: 'input',\n            change: 'change',\n            cut: 'cut',\n            paste: 'paste',\n            scroll: 'scroll',\n            mousewheel: 'mousewheel',\n            inputchange: \"change input propertychange cut paste copy drop\",\n            dragstart: \"dragstart\",\n            dragend: \"dragend\",\n            dragenter: \"dragenter\",\n            dragover: \"dragover\",\n            dragleave: \"dragleave\",\n            drop: 'drop',\n            drag: 'drag'\n        },\n\n        keyCode: {\n            BACKSPACE: 8,\n            TAB: 9,\n            ENTER: 13,\n            SHIFT: 16,\n            CTRL: 17,\n            ALT: 18,\n            BREAK: 19,\n            CAPS: 20,\n            ESCAPE: 27,\n            SPACE: 32,\n            PAGEUP: 33,\n            PAGEDOWN: 34,\n            END: 35,\n            HOME: 36,\n            LEFT_ARROW: 37,\n            UP_ARROW: 38,\n            RIGHT_ARROW: 39,\n            DOWN_ARROW: 40,\n            COMMA: 188\n        },\n\n        media_queries: {\n            FS: \"(min-width: 0px)\",\n            XS: \"(min-width: 360px)\",\n            SM: \"(min-width: 576px)\",\n            MD: \"(min-width: 768px)\",\n            LG: \"(min-width: 992px)\",\n            XL: \"(min-width: 1200px)\",\n            XXL: \"(min-width: 1452px)\"\n        },\n\n        media_sizes: {\n            FS: 0,\n            XS: 360,\n            SM: 576,\n            LD: 640,\n            MD: 768,\n            LG: 992,\n            XL: 1200,\n            XXL: 1452\n        },\n\n        media_mode: {\n            FS: \"fs\",\n            XS: \"xs\",\n            SM: \"sm\",\n            MD: \"md\",\n            LG: \"lg\",\n            XL: \"xl\",\n            XXL: \"xxl\"\n        },\n\n        media_modes: [\"fs\",\"xs\",\"sm\",\"md\",\"lg\",\"xl\",\"xxl\"],\n\n        actions: {\n            REMOVE: 1,\n            HIDE: 2\n        },\n\n        hotkeys: {},\n        locales: {},\n        utils: {},\n        colors: {},\n        dialog: null,\n        pagination: null,\n        md5: null,\n        storage: null,\n        export: null,\n        animations: null,\n        cookie: null,\n        template: null,\n        defaults: {},\n\n        about: function(){\n            var content =\n                \"<h3>About</h3>\" +\n                \"<hr>\" +\n                \"<div><b>Metro 4</b> - v\" + Metro.version +\". \"+ Metro.showCompileTime() + \"</div>\" +\n                \"<div><b>M4Q</b> - \" + m4q.version + \"</div>\";\n            Metro.infobox.create(content)\n        },\n\n        info: function(){\n            console.info(\"Metro 4 - v\" + Metro.version +\". \"+ Metro.showCompileTime());\n            console.info(\"m4q - \" + m4q.version);\n        },\n\n        showCompileTime: function(){\n            return \"Built at: \" + Metro.compileTime;\n        },\n\n        aboutDlg: function(){\n            alert(\"Metro 4 - v\" + Metro.version +\". \"+ Metro.showCompileTime());\n        },\n\n        ver: function(){\n            return Metro.version;\n        },\n\n        build: function(){\n            return Metro.build;\n        },\n\n        compile: function(){\n            return Metro.compileTime;\n        },\n\n        observe: function(){\n            var observer, observerCallback;\n            var observerConfig = {\n                childList: true,\n                attributes: true,\n                subtree: true\n            };\n            observerCallback = function(mutations){\n                mutations.map(function(mutation){\n                    if (mutation.type === 'attributes' && mutation.attributeName !== \"data-role\") {\n                        if (mutation.attributeName === 'data-hotkey') {\n                            Metro.initHotkeys([mutation.target], true);\n                        } else {\n                            var element = $(mutation.target);\n                            var mc = element.data('metroComponent');\n                            var attr = mutation.attributeName, newValue = element.attr(attr), oldValue = mutation.oldValue;\n\n                            if (mc !== undefined) {\n                                element.fire(\"attr-change\", {\n                                    attr: attr,\n                                    newValue: newValue,\n                                    oldValue: oldValue,\n                                    __this: element[0]\n                                });\n\n                                $.each(mc, function(){\n                                    var plug = Metro.getPlugin(element, this);\n                                    if (plug && typeof plug.changeAttribute === \"function\") {\n                                        plug.changeAttribute(attr, newValue, oldValue);\n                                    }\n                                });\n                            }\n                        }\n                    } else\n\n                    if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {\n                        var i, widgets = [];\n                        var $node, node, nodes = mutation.addedNodes;\n\n                        if (nodes.length) {\n                            for(i = 0; i < nodes.length; i++) {\n                                node = nodes[i];\n                                $node = $(node);\n\n                                if ($node.attr(\"data-role\") !== undefined) {\n                                    widgets.push(node);\n                                }\n\n                                $.each($node.find(\"[data-role]\"), function(){\n                                    var o = this;\n                                    if (widgets.indexOf(o) !== -1) {\n                                        return;\n                                    }\n                                    widgets.push(o);\n                                });\n                            }\n\n                            if (widgets.length) Metro.initWidgets(widgets, \"observe\");\n                        }\n\n                    } else  {\n                        //\n                    }\n                });\n            };\n            observer = new MutationObserver(observerCallback);\n            observer.observe($(\"html\")[0], observerConfig);\n        },\n\n        init: function(){\n            var widgets = $(\"[data-role]\");\n            var hotkeys = $(\"[data-hotkey]\");\n            var html = $(\"html\");\n            var that = this;\n\n            if (window.METRO_BLUR_IMAGE) {\n                html.addClass(\"use-blur-image\");\n            }\n\n            if (window.METRO_SHOW_ABOUT) Metro.info(true);\n\n            if (isTouch === true) {\n                html.addClass(\"metro-touch-device\");\n            } else {\n                html.addClass(\"metro-no-touch-device\");\n            }\n\n            Metro.sheet = this.utils.newCssSheet();\n\n            this.utils.addCssRule(Metro.sheet, \"*, *::before, *::after\", \"box-sizing: border-box;\");\n\n            window.METRO_MEDIA = [];\n            $.each(Metro.media_queries, function(key, query){\n                if (that.utils.media(query)) {\n                    window.METRO_MEDIA.push(Metro.media_mode[key]);\n                }\n            });\n\n            Metro.observe();\n\n            Metro.initHotkeys(hotkeys);\n            Metro.initWidgets(widgets, \"init\");\n\n            if (window.METRO_CLOAK_REMOVE !== \"fade\") {\n                $(\".m4-cloak\").removeClass(\"m4-cloak\");\n                $(window).fire(\"metro-initiated\");\n            } else {\n                $(\".m4-cloak\").animate({\n                    draw: {\n                        opacity: 1\n                    },\n                    dur: 300,\n                    onDone: function(){\n                        $(\".m4-cloak\").removeClass(\"m4-cloak\");\n                        $(window).fire(\"metro-initiated\");\n                    }\n                });\n            }\n        },\n\n        initHotkeys: function(hotkeys, redefine){\n            $.each(hotkeys, function(){\n                var element = $(this);\n                var hotkey = element.attr('data-hotkey') ? element.attr('data-hotkey').toLowerCase() : false;\n                var fn = element.attr('data-hotkey-func') ? element.attr('data-hotkey-func') : false;\n\n                if (hotkey === false) {\n                    return;\n                }\n\n                if (element.data('hotKeyBonded') === true && redefine !== true) {\n                    return;\n                }\n\n                Metro.hotkeys[hotkey] = [this, fn];\n                element.data('hotKeyBonded', true);\n                element.fire(\"hot-key-bonded\", {\n                    __this: element[0],\n                    hotkey: hotkey,\n                    fn: fn\n                });\n            });\n        },\n\n        initWidgets: function(widgets) {\n            var that = this;\n\n            $.each(widgets, function () {\n                var $this = $(this), roles;\n\n                if (!this.hasAttribute(\"data-role\")) {\n                    return ;\n                }\n\n                roles = $this.attr('data-role').split(/\\s*,\\s*/);\n\n                roles.map(function (func) {\n\n                    var $$ = that.utils.$();\n                    var _func = normalizeComponentName(func);\n\n                    if ($$.fn[_func] !== undefined && $this.attr(\"data-role-\"+_func) === undefined) {\n                        try {\n                            $$.fn[_func].call($this);\n                            $this.attr(\"data-role-\"+_func, true);\n\n                            var mc = $this.data('metroComponent');\n\n                            if (mc === undefined) {\n                                mc = [_func];\n                            } else {\n                                mc.push(_func);\n                            }\n                            $this.data('metroComponent', mc);\n\n                            $this.fire(\"create\", {\n                                __this: $this[0],\n                                name: _func\n                            });\n                            $(document).fire(\"component-create\", {\n                                element: $this[0],\n                                name: _func\n                            });\n                        } catch (e) {\n                            console.error(\"Error creating component \" + func + \" for \", $this[0]);\n                            throw e;\n                        }\n                    }\n                });\n            });\n        },\n\n        plugin: function(name, object){\n            var _name = normalizeComponentName(name);\n\n            var register = function($){\n                $.fn[_name] = function( options ) {\n                    return this.each(function() {\n                        $.data( this, _name, Object.create(object).init(options, this ));\n                    });\n                };\n            }\n\n            register(m4q);\n\n            if (window.useJQuery) {\n                register(jQuery);\n            }\n        },\n\n        pluginExists: function(name){\n            var $ = window.useJQuery ? jQuery : m4q;\n            return typeof $.fn[normalizeComponentName(name)] === \"function\";\n        },\n\n        destroyPlugin: function(element, name){\n            var p, mc;\n            var el = $(element);\n            var _name = normalizeComponentName(name);\n\n            p = Metro.getPlugin(el, _name);\n\n            if (typeof p === 'undefined') {\n                console.warn(\"Component \"+name+\" can not be destroyed: the element is not a Metro 4 component.\");\n                return ;\n            }\n\n            if (typeof p['destroy'] !== 'function') {\n                console.warn(\"Component \"+name+\" can not be destroyed: method destroy not found.\");\n                return ;\n            }\n\n            p['destroy']();\n            mc = el.data(\"metroComponent\");\n            this.utils.arrayDelete(mc, _name);\n            el.data(\"metroComponent\", mc);\n            $.removeData(el[0], _name);\n            el.removeAttr(\"data-role-\"+_name);\n        },\n\n        destroyPluginAll: function(element){\n            var el = $(element);\n            var mc = el.data(\"metroComponent\");\n\n            if (mc !== undefined && mc.length > 0) $.each(mc, function(){\n                Metro.destroyPlugin(el[0], this);\n            });\n        },\n\n        noop: function(){},\n        noop_true: function(){return true;},\n        noop_false: function(){return false;},\n\n        requestFullScreen: function(element){\n            if (element[\"mozRequestFullScreen\"]) {\n                element[\"mozRequestFullScreen\"]();\n            } else if (element[\"webkitRequestFullScreen\"]) {\n                element[\"webkitRequestFullScreen\"]();\n            } else if (element[\"msRequestFullscreen\"]) {\n                element[\"msRequestFullscreen\"]();\n            } else {\n                element.requestFullscreen().catch( function(err){\n                    console.warn(\"Error attempting to enable full-screen mode: \"+err.message+\" \"+err.name);\n                });\n            }\n        },\n\n        exitFullScreen: function(){\n            if (document[\"mozCancelFullScreen\"]) {\n                document[\"mozCancelFullScreen\"]();\n            }\n            else if (document[\"webkitCancelFullScreen\"]) {\n                document[\"webkitCancelFullScreen\"]();\n            }\n            else if (document[\"msExitFullscreen\"]) {\n                document[\"msExitFullscreen\"]();\n            } else {\n                document.exitFullscreen().catch( function(err){\n                    console.warn(\"Error attempting to disable full-screen mode: \"+err.message+\" \"+err.name);\n                });\n            }\n        },\n\n        inFullScreen: function(){\n            var fsm = (document.fullscreenElement || document[\"webkitFullscreenElement\"] || document[\"mozFullScreenElement\"] || document[\"msFullscreenElement\"]);\n            return fsm !== undefined;\n        },\n\n        $: function(){\n            return window.useJQuery ? jQuery : m4q;\n        },\n\n        get$el: function(el){\n            return Metro.$()($(el)[0]);\n        },\n\n        get$elements: function(el){\n            return Metro.$()($(el));\n        },\n\n        // TODO add if name is not defined, return one or array of plugins\n        getPlugin: function(el, name){\n            var _name = normalizeComponentName(name);\n            var $el = Metro.get$el(el);\n            return $el.length ? $el.data(_name) : undefined;\n        },\n\n        makePlugin: function(el, name, options){\n            var _name = normalizeComponentName(name);\n            var $el = Metro.get$elements(el);\n            return $el.length && typeof $el[_name] === \"function\" ? $el[_name](options) : undefined;\n        },\n\n        Component: function(nameName, compObj){\n            var name = normalizeComponentName(nameName);\n            var Utils = Metro.utils;\n            var component = $.extend({name: name}, {\n                _super: function(el, options, defaults, setup){\n                    var self = this;\n\n                    this.elem = el;\n                    this.element = $(el);\n                    this.options = $.extend( {}, defaults, options );\n                    this.component = this.elem;\n\n                    this._setOptionsFromDOM();\n                    this._runtime();\n\n                    if (setup && typeof setup === 'object') {\n                        $.each(setup, function(key, val){\n                            self[key] = val;\n                        })\n                    }\n\n                    this._createExec();\n                },\n\n                _setOptionsFromDOM: function(){\n                    var element = this.element, o = this.options;\n\n                    $.each(element.data(), function(key, value){\n                        if (key in o) {\n                            try {\n                                o[key] = JSON.parse(value);\n                            } catch (e) {\n                                o[key] = value;\n                            }\n                        }\n                    });\n                },\n\n                _runtime: function(){\n                    var element = this.element, mc;\n                    var roles = (element.attr(\"data-role\") || \"\").toArray(\",\").map(function(v){\n                        return normalizeComponentName(v);\n                    }).filter(function(v){\n                        return v.trim() !== \"\";\n                    });\n\n                    if (!element.attr('data-role-'+this.name)) {\n                        element.attr(\"data-role-\"+this.name, true);\n                        if (roles.indexOf(this.name) === -1) {\n                            roles.push(this.name);\n                            element.attr(\"data-role\", roles.join(\",\"));\n                        }\n\n                        mc = element.data('metroComponent');\n                        if (mc === undefined) {\n                            mc = [this.name];\n                        } else {\n                            mc.push(this.name);\n                        }\n                        element.data('metroComponent', mc);\n                    }\n                },\n\n                _createExec: function(){\n                    var that = this, timeout = this.options[this.name+'Deferred'];\n\n                    if (timeout) {\n                        setTimeout(function(){\n                            that._create();\n                        }, timeout)\n                    } else {\n                        that._create();\n                    }\n                },\n\n                _fireEvent: function(eventName, data, log, noFire){\n                    var element = this.element, o = this.options;\n                    var _data;\n                    var event = $.camelCase(eventName).capitalize();\n\n                    data = $.extend({}, data, {__this: element[0]});\n\n                    _data = data ? Object.values(data) : {};\n\n                    if (log) {\n                        console.warn(log);\n                        console.warn(\"Event: \" + \"on\"+event);\n                        console.warn(\"Data: \", data);\n                        console.warn(\"Element: \", element[0]);\n                    }\n\n                    if (noFire !== true)\n                        element.fire(event.toLowerCase(), data);\n\n                    return Utils.exec(o[\"on\"+event], _data, element[0]);\n                },\n\n                _fireEvents: function(events, data, log, noFire){\n                    var that = this, _events;\n\n                    if (arguments.length === 0) {\n                        return ;\n                    }\n\n                    if (arguments.length === 1) {\n\n                        $.each(events, function () {\n                            var ev = this;\n                            that._fireEvent(ev.name, ev.data, ev.log, ev.noFire);\n                        });\n\n                        return Utils.objectLength(events);\n                    }\n\n                    if (!Array.isArray(events) && typeof events !== \"string\") {\n                        return ;\n                    }\n\n                    _events = Array.isArray(events) ? events : events.toArray(\",\");\n\n                    $.each(_events, function(){\n                        that._fireEvent(this, data, log, noFire);\n                    });\n                },\n\n                getComponent: function(){\n                    return this.component;\n                },\n\n                getComponentName: function(){\n                    return this.name;\n                }\n            }, compObj);\n\n            Metro.plugin(name, component);\n\n            return component;\n        },\n\n        fetch: {\n            status: function(response){\n                return response.ok ? Promise.resolve(response) : Promise.reject(new Error(response.statusText));\n            },\n\n            json: function(response){\n                return response.json();\n            },\n\n            text: function(response){\n                return response.text();\n            },\n\n            form: function(response){\n                return response.formData();\n            },\n\n            blob: function(response){\n                return response.blob();\n            },\n\n            buffer: function(response){\n                return response.arrayBuffer();\n            }\n        }\n    };\n\n    $(window).on(Metro.events.resize, function(){\n        window.METRO_MEDIA = [];\n        $.each(Metro.media_queries, function(key, query){\n            if (Metro.utils.media(query)) {\n                window.METRO_MEDIA.push(Metro.media_mode[key]);\n            }\n        });\n    });\n\n    window.Metro = Metro;\n\n    if (window.METRO_INIT ===  true) {\n        $(function(){\n            Metro.init()\n        });\n    }\n\n    return Metro;\n}());\n\r\n\r\n(function(Metro, $) {\n    $.extend(Metro['locales'], {\n        'da-DK': {\n            \"calendar\": {\n                \"months\": [\n                    \"Januar\", \"Februar\", \"Marts\", \"April\", \"Maj\", \"Juni\", \"Juli\", \"August\", \"September\", \"Oktober\", \"November\", \"December\",\n                    \"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Maj\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"\n                ],\n                \"days\": [\n                    \"Søndag\", \"Mandag\", \"Tirsdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lørdag\",\n                    \"Sø\", \"Ma\", \"Ti\", \"On\", \"To\", \"Fr\", \"Lø\",\n                    \"Søn\", \"Man\", \"Tir\", \"Ons\", \"Tor\", \"Fre\", \"Lør\"\n                ],\n                \"time\": {\n                    \"days\": \"DAGE\",\n                    \"hours\": \"TIMER\",\n                    \"minutes\": \"MIN\",\n                    \"seconds\": \"SEK\",\n                    \"month\": \"MON\",\n                    \"day\": \"DAG\",\n                    \"year\": \"ÅR\"\n                },\n                \"weekStart\": 1\n            },\n            \"buttons\": {\n                \"ok\": \"OK\",\n                \"cancel\": \"Annuller\",\n                \"done\": \"Færdig\",\n                \"today\": \"Idag\",\n                \"now\": \"Nu\",\n                \"clear\": \"Ryd\",\n                \"help\": \"Hjælp\",\n                \"yes\": \"Ja\",\n                \"no\": \"Nej\",\n                \"random\": \"Tilfældig\",\n                \"save\": \"Gem\",\n                \"reset\": \"Nulstil\"\n            },\n            \"table\": {\n                \"rowsCount\": \"Show entries:\",\n                \"search\": \"Search:\",\n                \"info\": \"Showing $1 to $2 of $3 entries\",\n                \"prev\": \"Prev\",\n                \"next\": \"Next\",\n                \"all\": \"All\",\n                \"inspector\": \"Inspector\",\n                \"skip\": \"Goto page\",\n                \"empty\": \"Nothing to show\"\n            },\n            \"colorSelector\": {\n                addUserColorButton: \"ADD TO SWATCHES\",\n                userColorsTitle: \"USER COLORS\"\n            },\n            \"switch\": {\n                on: \"on\",\n                off: \"off\"\n            }\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    $.extend(Metro.locales, {\n        'de-DE': {\n            \"calendar\": {\n                \"months\": [\n                    \"Januar\", \"Februar\", \"März\", \"April\", \"Mai\", \"Juni\", \"Juli\", \"August\", \"September\", \"Oktober\", \"November\", \"Dezember\",\n                    \"Jan\", \"Feb\", \"Mär\", \"Apr\", \"Mai\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dez\"\n                ],\n                \"days\": [\n                    \"Sonntag\", \"Montag\", \"Dienstag\", \"Mittwoch\", \"Donnerstag\", \"Freitag\", \"Samstag\",\n                    \"So\", \"Mo\", \"Di\", \"Mi\", \"Do\", \"Fr\", \"Sa\",\n                    \"Son\", \"Mon\", \"Die\", \"Mit\", \"Don\", \"Fre\", \"Sam\"\n                ],\n                \"time\": {\n                    \"days\": \"TAGE\",\n                    \"hours\": \"STD\",\n                    \"minutes\": \"MIN\",\n                    \"seconds\": \"SEK\"\n                },\n                \"weekStart\": 2\n            },\n            \"buttons\": {\n                \"ok\": \"OK\",\n                \"cancel\": \"Abbrechen\",\n                \"done\": \"Fertig\",\n                \"today\": \"Heute\",\n                \"now\": \"Jetzt\",\n                \"clear\": \"Löschen\",\n                \"help\": \"Hilfe\",\n                \"yes\": \"Ja\",\n                \"no\": \"Nein\",\n                \"random\": \"Zufällig\",\n                \"save\": \"Speichern\",\n                \"reset\": \"Zurücksetzen\"\n            },\n            \"table\": {\n                \"rowsCount\": \"Show entries:\",\n                \"search\": \"Search:\",\n                \"info\": \"Showing $1 to $2 of $3 entries\",\n                \"prev\": \"Prev\",\n                \"next\": \"Next\",\n                \"all\": \"All\",\n                \"inspector\": \"Inspector\",\n                \"skip\": \"Goto page\",\n                \"empty\": \"Nothing to show\"\n            },\n            \"colorSelector\": {\n                addUserColorButton: \"ADD TO SWATCHES\",\n                userColorsTitle: \"USER COLORS\"\n            },\n            \"switch\": {\n                on: \"on\",\n                off: \"off\"\n            }\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    $.extend(Metro.locales, {\n        'en-US': {\n            \"calendar\": {\n                \"months\": [\n                    \"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\",\n                    \"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"\n                ],\n                \"days\": [\n                    \"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\",\n                    \"Su\", \"Mo\", \"Tu\", \"We\", \"Th\", \"Fr\", \"Sa\",\n                    \"Sun\", \"Mon\", \"Tus\", \"Wen\", \"Thu\", \"Fri\", \"Sat\"\n                ],\n                \"time\": {\n                    \"days\": \"DAYS\",\n                    \"hours\": \"HOURS\",\n                    \"minutes\": \"MINS\",\n                    \"seconds\": \"SECS\",\n                    \"month\": \"MON\",\n                    \"day\": \"DAY\",\n                    \"year\": \"YEAR\"\n                },\n                \"weekStart\": 0\n            },\n            \"buttons\": {\n                \"ok\": \"OK\",\n                \"cancel\": \"Cancel\",\n                \"done\": \"Done\",\n                \"today\": \"Today\",\n                \"now\": \"Now\",\n                \"clear\": \"Clear\",\n                \"help\": \"Help\",\n                \"yes\": \"Yes\",\n                \"no\": \"No\",\n                \"random\": \"Random\",\n                \"save\": \"Save\",\n                \"reset\": \"Reset\"\n            },\n            \"table\": {\n                \"rowsCount\": \"Show entries:\",\n                \"search\": \"Search:\",\n                \"info\": \"Showing $1 to $2 of $3 entries\",\n                \"prev\": \"Prev\",\n                \"next\": \"Next\",\n                \"all\": \"All\",\n                \"inspector\": \"Inspector\",\n                \"skip\": \"Goto page\",\n                \"empty\": \"Nothing to show\"\n            },\n            \"colorSelector\": {\n                addUserColorButton: \"ADD TO SWATCHES\",\n                userColorsTitle: \"USER COLORS\"\n            },\n            \"switch\": {\n                on: \"on\",\n                off: \"off\"\n            }\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    $.extend(Metro.locales, {\n        'es-MX': {\n            \"calendar\": {\n                \"months\": [\n                    \"Enero\", \"Febrero\", \"Marzo\", \"Abril\", \"Mayo\", \"Junio\", \"Julio\", \"Agosto\", \"Septiembre\", \"Octubre\", \"Noviembre\", \"Diciembre\",\n                    \"Ene\", \"Feb\", \"Mar\", \"Abr\", \"May\", \"Jun\", \"Jul\", \"Ago\", \"Sep\", \"Oct\", \"Nov\", \"Dic\"\n                ],\n                \"days\": [\n                    \"Domingo\", \"Lunes\", \"Martes\", \"Miércoles\", \"Jueves\", \"Viernes\", \"Sábado\",\n                    \"Do\", \"Lu\", \"Ma\", \"Mi\", \"Ju\", \"Vi\", \"Sa\",\n                    \"Dom\", \"Lun\", \"Mar\", \"Mié\", \"Jue\", \"Vie\", \"Sáb\"\n                ],\n                \"time\": {\n                    \"days\": \"DÍAS\",\n                    \"hours\": \"HORAS\",\n                    \"minutes\": \"MINS\",\n                    \"seconds\": \"SEGS\",\n                    \"month\": \"MES\",\n                    \"day\": \"DÍA\",\n                    \"year\": \"AÑO\"\n                },\n                \"weekStart\": 1\n            },\n            \"buttons\": {\n                \"ok\": \"Aceptar\",\n                \"cancel\": \"Cancelar\",\n                \"done\": \"Hecho\",\n                \"today\": \"Hoy\",\n                \"now\": \"Ahora\",\n                \"clear\": \"Limpiar\",\n                \"help\": \"Ayuda\",\n                \"yes\": \"Si\",\n                \"no\": \"No\",\n                \"random\": \"Aleatorio\",\n                \"save\": \"Salvar\",\n                \"reset\": \"Reiniciar\"\n            },\n            \"table\": {\n                \"rowsCount\": \"Show entries:\",\n                \"search\": \"Search:\",\n                \"info\": \"Showing $1 to $2 of $3 entries\",\n                \"prev\": \"Prev\",\n                \"next\": \"Next\",\n                \"all\": \"All\",\n                \"inspector\": \"Inspector\",\n                \"skip\": \"Goto page\",\n                \"empty\": \"Nothing to show\"\n            },\n            \"colorSelector\": {\n                addUserColorButton: \"ADD TO SWATCHES\",\n                userColorsTitle: \"USER COLORS\"\n            },\n            \"switch\": {\n                on: \"on\",\n                off: \"off\"\n            }\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    $.extend(Metro.locales, {\n        'fr-FR': {\n            \"calendar\": {\n                \"months\": [\n                    \"Janvier\", \"Février\", \"Mars\", \"Avril\", \"Mai\", \"Juin\", \"Juillet\", \"Août\", \"Septembre\", \"Octobre\", \"Novembre\", \"Décembre\",\n                    \"Janv\", \"Févr\", \"Mars\", \"Avr\", \"Mai\", \"Juin\", \"Juil\", \"Août\", \"Sept\", \"Oct\", \"Nov\", \"Déc\"\n                ],\n                \"days\": [\n                    \"Dimanche\", \"Lundi\", \"Mardi\", \"Mercredi\", \"Jeudi\", \"Vendredi\", \"Samedi\",\n                    \"Di\", \"Lu\", \"Ma\", \"Me\", \"Je\", \"Ve\", \"Sa\",\n                    \"Dim\", \"Lun\", \"Mar\", \"Mer\", \"Jeu\", \"Ven\", \"Sam\"\n                ],\n                \"time\": {\n                    \"days\": \"JOURS\",\n                    \"hours\": \"HEURES\",\n                    \"minutes\": \"MINS\",\n                    \"seconds\": \"SECS\",\n                    \"month\": \"MOIS\",\n                    \"day\": \"JOUR\",\n                    \"year\": \"ANNEE\"\n                },\n                \"weekStart\": 1\n            },\n            \"buttons\": {\n                \"ok\": \"OK\",\n                \"cancel\": \"Annulé\",\n                \"done\": \"Fait\",\n                \"today\": \"Aujourd'hui\",\n                \"now\": \"Maintenant\",\n                \"clear\": \"Effacé\",\n                \"help\": \"Aide\",\n                \"yes\": \"Oui\",\n                \"no\": \"Non\",\n                \"random\": \"Aléatoire\",\n                \"save\": \"Sauvegarder\",\n                \"reset\": \"Réinitialiser\"\n            },\n            \"table\": {\n                \"rowsCount\": \"Show entries:\",\n                \"search\": \"Search:\",\n                \"info\": \"Showing $1 to $2 of $3 entries\",\n                \"prev\": \"Prev\",\n                \"next\": \"Next\",\n                \"all\": \"All\",\n                \"inspector\": \"Inspector\",\n                \"skip\": \"Goto page\",\n                \"empty\": \"Nothing to show\"\n            },\n            \"colorSelector\": {\n                addUserColorButton: \"ADD TO SWATCHES\",\n                userColorsTitle: \"USER COLORS\"\n            },\n            \"switch\": {\n                on: \"on\",\n                off: \"off\"\n            }\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    $.extend(Metro.locales, {\n        'hr-HR': {\n            \"calendar\": {\n                \"months\": [\n                    \"Siječanj\", \"Veljača\", \"Ožujak\", \"Travanj\", \"Svibanj\", \"Lipanj\", \"Srpanj\", \"Kolovoz\", \"Rujan\", \"Listopad\", \"Studeni\", \"Prosinac\",\n                    \"Sij\", \"Velj\", \"Ožu\", \"Tra\", \"Svi\", \"Lip\", \"Srp\", \"Kol\", \"Ruj\", \"Lis\", \"Stu\", \"Pro\"\n                ],\n                \"days\": [\n                    \"Nedjelja\",\"Ponedjeljak\",\"Utorak\", \"Srijeda\", \"Četvrtak\", \"Petak\", \"Subota\",  \n                    \"Ne\",\"Po\", \"Ut\", \"Sr\", \"Če\", \"Pe\", \"Su\", \n                    \"Ned\", \"Pon\", \"Uto\", \"Sri\", \"Čet\", \"Pet\", \"Sub\" \n                ],\n                \"time\": {\n                    \"days\": \"DANI\",\n                    \"hours\": \"SATI\",\n                    \"minutes\": \"MINUTE\",\n                    \"seconds\": \"SEKUNDE\",\n                    \"month\": \"MJESEC\",\n                    \"day\": \"DAN\",\n                    \"year\": \"GODINA\"\n                },\n                \"weekStart\": 1\n            },\n            \"buttons\": {\n                \"ok\": \"OK\",\n                \"cancel\": \"Otkaži\",\n                \"done\": \"Gotovo\",\n                \"today\": \"Danas\",\n                \"now\": \"Sada\",\n                \"clear\": \"Izbriši\",\n                \"help\": \"Pomoć\",\n                \"yes\": \"Da\",\n                \"no\": \"Ne\",\n                \"random\": \"Nasumično\",\n                \"save\": \"Spremi\",\n                \"reset\": \"Reset\"\n            },\n            \"table\": {\n                \"rowsCount\": \"Broj redaka:\",\n                \"search\": \"Pretraga:\",\n                \"info\": \"Prikazujem $1 do $2 od $3\",\n                \"prev\": \"Nazad\",\n                \"next\": \"Naprijed\",\n                \"all\": \"Sve\",\n                \"inspector\": \"Inspektor\",\n                \"skip\": \"Idi na stranicu\",\n                \"empty\": \"Prazno\"\n            },\n            \"colorSelector\": {\n                addUserColorButton: \"Dodaj uzorcima\",\n                userColorsTitle: \"Korisničke boje\"\n            },\n            \"switch\": {\n                on: \"on\",\n                off: \"off\"\n            }\n        }\n    });\n}(Metro, m4q));\n\r\n\r\n(function(Metro, $) {\n    $.extend(Metro.locales, {\n        'hu-HU': {\n            \"calendar\": {\n                \"months\": [\n                    'Január', 'Február', 'Március', 'Április', 'Május', 'Június', 'Július', 'Augusztus', 'Szeptember', 'Október', 'November', 'December',\n                    'Jan', 'Feb', 'Már', 'Ápr', 'Máj', 'Jún', 'Júl', 'Aug', 'Szep', 'Okt', 'Nov', 'Dec'\n                ],\n                \"days\": [\n                    'Vasárnap', 'Hétfő', 'Kedd', 'Szerda', 'Csütörtök', 'Péntek', 'Szombat',\n                    'V', 'H', 'K', 'Sz', 'Cs', 'P', 'Sz',\n                    'Vas', 'Hét', 'Ke', 'Sze', 'Csü', 'Pén', 'Szom'\n                ],\n                \"time\": {\n                    \"days\": \"NAP\",\n                    \"hours\": \"ÓRA\",\n                    \"minutes\": \"PERC\",\n                    \"seconds\": \"MP\"\n                },\n                \"weekStart\": 1\n            },\n            \"buttons\": {\n                \"ok\": \"OK\",\n                \"cancel\": \"Mégse\",\n                \"done\": \"Kész\",\n                \"today\": \"Ma\",\n                \"now\": \"Most\",\n                \"clear\": \"Törlés\",\n                \"help\": \"Segítség\",\n                \"yes\": \"Igen\",\n                \"no\": \"Nem\",\n                \"random\": \"Véletlen\",\n                \"save\": \"Mentés\",\n                \"reset\": \"Visszaállítás\"\n            },\n            \"table\": {\n                \"rowsCount\": \"Show entries:\",\n                \"search\": \"Search:\",\n                \"info\": \"Showing $1 to $2 of $3 entries\",\n                \"prev\": \"Prev\",\n                \"next\": \"Next\",\n                \"all\": \"All\",\n                \"inspector\": \"Inspector\",\n                \"skip\": \"Goto page\",\n                \"empty\": \"Nothing to show\"\n            },\n            \"colorSelector\": {\n                addUserColorButton: \"ADD TO SWATCHES\",\n                userColorsTitle: \"USER COLORS\"\n            },\n            \"switch\": {\n                on: \"on\",\n                off: \"off\"\n            }\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    $.extend(Metro.locales, {\n        'it-IT': {\n            \"calendar\": {\n                \"months\": [\n                    \"Gennaio\", \"Febbraio\", \"Marzo\", \"Aprile\", \"Maggio\", \"Giugno\", \"Luglio\", \"Agosto\", \"Settembre\", \"Ottobre\", \"Novembre\", \"Dicembre\",\n                    \"Gen\", \"Feb\", \"Mar\", \"Apr\", \"Mag\", \"Giu\", \"Lug\", \"Ago\", \"Set\", \"Ott\", \"Nov\", \"Dic\"\n                ],\n                \"days\": [\n                    \"Domenica\", \"Lunedì\", \"Martedì\", \"Mercoledì\", \"Giovedì\", \"Venerdì\", \"Sabato\",\n                    \"Do\", \"Lu\", \"Ma\", \"Me\", \"Gi\", \"Ve\", \"Sa\",\n                    \"Dom\", \"Lun\", \"Mar\", \"Mer\", \"Gio\", \"Ven\", \"Sab\"\n                ],\n                \"time\": {\n                    \"days\": \"GIORNI\",\n                    \"hours\": \"ORE\",\n                    \"minutes\": \"MIN\",\n                    \"seconds\": \"SEC\",\n                    \"month\": \"MESE\",\n                    \"day\": \"GIORNO\",\n                    \"year\": \"ANNO\"\n                },\n                \"weekStart\": 1\n            },\n            \"buttons\": {\n                \"ok\": \"OK\",\n                \"cancel\": \"Annulla\",\n                \"done\": \"Fatto\",\n                \"today\": \"Oggi\",\n                \"now\": \"Adesso\",\n                \"clear\": \"Cancella\",\n                \"help\": \"Aiuto\",\n                \"yes\": \"Sì\",\n                \"no\": \"No\",\n                \"random\": \"Random\",\n                \"save\": \"Salvare\",\n                \"reset\": \"Reset\"\n            },\n            \"table\": {\n                \"rowsCount\": \"Show entries:\",\n                \"search\": \"Search:\",\n                \"info\": \"Showing $1 to $2 of $3 entries\",\n                \"prev\": \"Prev\",\n                \"next\": \"Next\",\n                \"all\": \"All\",\n                \"inspector\": \"Inspector\",\n                \"skip\": \"Goto page\",\n                \"empty\": \"Nothing to show\"\n            },\n            \"colorSelector\": {\n                addUserColorButton: \"ADD TO SWATCHES\",\n                userColorsTitle: \"USER COLORS\"\n            },\n            \"switch\": {\n                on: \"on\",\n                off: \"off\"\n            }\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    $.extend(Metro.locales, {\n        'pt-BR': {\n            \"calendar\": {\n                \"months\": [\n                    \"Janeiro\", \"Fevereiro\", \"Março\", \"Abril\", \"Maio\", \"Junho\", \"Julho\", \"Agosto\", \"Setembro\", \"Outubro\", \"Novembro\", \"Dezembro\",\n                    \"Jan\", \"Fev\", \"Mar\", \"Abr\", \"Maio\", \"Jun\", \"Jul\", \"Ago\", \"Set\", \"Out\", \"Nov\", \"Dez\"\n                ],\n                \"days\": [\n                    \"Domingo\", \"Segunda\", \"Terça\", \"Quarta\", \"Quinta\", \"Sexta\", \"Sábado\",\n                    \"Do\", \"Se\", \"Te\", \"Qa\", \"Qi\", \"Se\", \"Sa\",\n                    \"Dom\", \"Seg\", \"Ter\", \"Qua\", \"Qui\", \"Sex\", \"Sab\"\n                ],\n                \"time\": {\n                    \"days\": \"DIAS\",\n                    \"hours\": \"HORAS\",\n                    \"minutes\": \"MINUTOS\",\n                    \"seconds\": \"SEGUNDOS\",\n                    \"month\": \"MÊS\",\n                    \"day\": \"DIA\",\n                    \"year\": \"ANO\"\n                },\n                \"weekStart\": 1\n            },\n            \"buttons\": {\n                \"ok\": \"OK\",\n                \"cancel\": \"Cancelar\",\n                \"done\": \"Feito\",\n                \"today\": \"Hoje\",\n                \"now\": \"Agora\",\n                \"clear\": \"Limpar\",\n                \"help\": \"Ajuda\",\n                \"yes\": \"Sim\",\n                \"no\": \"Não\",\n                \"random\": \"Aleatório\",\n                \"save\": \"Salvar\",\n                \"reset\": \"Restaurar\"\n            },\n            \"table\": {\n                \"rowsCount\": \"Show entries:\",\n                \"search\": \"Search:\",\n                \"info\": \"Showing $1 to $2 of $3 entries\",\n                \"prev\": \"Prev\",\n                \"next\": \"Next\",\n                \"all\": \"All\",\n                \"inspector\": \"Inspector\",\n                \"skip\": \"Goto page\",\n                \"empty\": \"Nothing to show\"\n            },\n            \"colorSelector\": {\n                addUserColorButton: \"ADD TO SWATCHES\",\n                userColorsTitle: \"USER COLORS\"\n            },\n            \"switch\": {\n                on: \"on\",\n                off: \"off\"\n            }\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    $.extend(Metro.locales, {\n        'ru-RU': {\n            \"calendar\": {\n                \"months\": [\n                    \"Январь\", \"Февраль\", \"Март\", \"Апрель\", \"Май\", \"Июнь\", \"Июль\", \"Август\", \"Сентябрь\", \"Октябрь\", \"Ноябрь\", \"Декабрь\",\n                    \"Янв\", \"Фев\", \"Мар\", \"Апр\", \"Май\", \"Июн\", \"Июл\", \"Авг\", \"Сен\", \"Окт\", \"Ноя\", \"Дек\"\n                ],\n                \"days\": [\n                    \"Воскресенье\", \"Понедельник\", \"Вторник\", \"Среда\", \"Четверг\", \"Пятница\", \"Суббота\",\n                    \"Вс\", \"Пн\", \"Вт\", \"Ср\", \"Чт\", \"Пт\", \"Сб\",\n                    \"Вос\", \"Пон\", \"Вто\", \"Сре\", \"Чет\", \"Пят\", \"Суб\"\n                ],\n                \"time\": {\n                    \"days\": \"ДНИ\",\n                    \"hours\": \"ЧАСЫ\",\n                    \"minutes\": \"МИН\",\n                    \"seconds\": \"СЕК\",\n                    \"month\": \"МЕС\",\n                    \"day\": \"ДЕНЬ\",\n                    \"year\": \"ГОД\"\n                },\n                \"weekStart\": 1\n            },\n            \"buttons\": {\n                \"ok\": \"ОК\",\n                \"cancel\": \"Отмена\",\n                \"done\": \"Готово\",\n                \"today\": \"Сегодня\",\n                \"now\": \"Сейчас\",\n                \"clear\": \"Очистить\",\n                \"help\": \"Помощь\",\n                \"yes\": \"Да\",\n                \"no\": \"Нет\",\n                \"random\": \"Случайно\",\n                \"save\": \"Сохранить\",\n                \"reset\": \"Сброс\"\n            },\n            \"table\": {\n                \"rowsCount\": \"Показать записей:\",\n                \"search\": \"Поиск:\",\n                \"info\": \"Показаны $1 с $2 по $3 записей\",\n                \"prev\": \"Предыдущие\",\n                \"next\": \"Следующие\",\n                \"all\": \"Все\",\n                \"inspector\": \"Инспектор\",\n                \"skip\": \"Перейти на страницу\",\n                \"empty\": \"Нет записей\"\n            },\n            \"colorSelector\": {\n                addUserColorButton: \"ДОБАВИТЬ В ОБРАЗЦЫ\",\n                userColorsTitle: \"ЦВЕТА ПОЛЬЗОВАТЕЛЯ\"\n            },\n            \"switch\": {\n                on: \"вкл\",\n                off: \"выкл\"\n            }\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    $.extend(Metro.locales, {\n        'tr-TR': {\n            \"calendar\": {\n                \"months\": [\n                    \"Ocak\", \"Şubat\", \"Mart\", \"Nisan\", \"Mayıs\", \"Haziran\", \"Temmuz\", \"Ağustos\", \"Eylül\", \"Ekim\", \"Kasım\", \"Aralık\",\n                    \"Oca\", \"Şub\", \"Mar\", \"Nis\", \"May\", \"Haz\", \"Tem\", \"Ağu\", \"Eyl\", \"Eki\", \"Kas\", \"Ara\"\n                ],\n                \"days\": [\n                    \"Pazar\", \"Pazartesi\", \"Salı\", \"Çarşamba\", \"Perşembe\", \"Cuma\", \"Cumartesi\",\n                    \"Pa\", \"Pz\", \"Sa\", \"Ça\", \"Pe\", \"Cu\", \"Ct\",\n                    \"Paz\", \"Pzt\", \"Sal\", \"Çar\", \"Per\", \"Cum\", \"Cmt\"\n                ],\n                \"time\": {\n                    \"days\": \"GÜN\",\n                    \"hours\": \"SAAT\",\n                    \"minutes\": \"DAK\",\n                    \"seconds\": \"SAN\",\n                    \"month\": \"AY\",\n                    \"day\": \"GÜN\",\n                    \"year\": \"YIL\"\n                },\n                \"weekStart\": 1\n            },\n            \"buttons\": {\n                \"ok\": \"Tamam\",\n                \"cancel\": \"Vazgeç\",\n                \"done\": \"Bitti\",\n                \"today\": \"Bugün\",\n                \"now\": \"Şimdi\",\n                \"clear\": \"Temizle\",\n                \"help\": \"Yardım\",\n                \"yes\": \"Evet\",\n                \"no\": \"Hayır\",\n                \"random\": \"Rasgele\",\n                \"save\": \"Kurtarmak\",\n                \"reset\": \"Sıfırla\"\n            },\n            \"table\": {\n                \"rowsCount\": \"Show entries:\",\n                \"search\": \"Search:\",\n                \"info\": \"Showing $1 to $2 of $3 entries\",\n                \"prev\": \"Prev\",\n                \"next\": \"Next\",\n                \"all\": \"All\",\n                \"inspector\": \"Inspector\",\n                \"skip\": \"Goto page\",\n                \"empty\": \"Nothing to show\"\n            },\n            \"colorSelector\": {\n                addUserColorButton: \"ADD TO SWATCHES\",\n                userColorsTitle: \"USER COLORS\"\n            },\n            \"switch\": {\n                on: \"on\",\n                off: \"off\"\n            }\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    $.extend(Metro.locales, {\n        'uk-UA': {\n            \"calendar\": {\n                \"months\": [\n                    \"Січень\", \"Лютий\", \"Березень\", \"Квітень\", \"Травень\", \"Червень\", \"Липень\", \"Серпень\", \"Вересень\", \"Жовтень\", \"Листопад\", \"Грудень\",\n                    \"Січ\", \"Лют\", \"Бер\", \"Кві\", \"Тра\", \"Чер\", \"Лип\", \"Сер\", \"Вер\", \"Жов\", \"Лис\", \"Гру\"\n                ],\n                \"days\": [\n                    \"Неділя\", \"Понеділок\", \"Вівторок\", \"Середа\", \"Четвер\", \"П’ятниця\", \"Субота\",\n                    \"Нд\", \"Пн\", \"Вт\", \"Ср\", \"Чт\", \"Пт\", \"Сб\",\n                    \"Нед\", \"Пон\", \"Вiв\", \"Сер\", \"Чет\", \"Пят\", \"Суб\"\n                ],\n                \"time\": {\n                    \"days\": \"ДНІ\",\n                    \"hours\": \"ГОД\",\n                    \"minutes\": \"ХВИЛ\",\n                    \"seconds\": \"СЕК\",\n                    \"month\": \"МІС\",\n                    \"day\": \"ДЕНЬ\",\n                    \"year\": \"РІК\"\n                },\n                \"weekStart\": 1\n            },\n            \"buttons\": {\n                \"ok\": \"ОК\",\n                \"cancel\": \"Відміна\",\n                \"done\": \"Готово\",\n                \"today\": \"Сьогодні\",\n                \"now\": \"Зараз\",\n                \"clear\": \"Очистити\",\n                \"help\": \"Допомога\",\n                \"yes\": \"Так\",\n                \"no\": \"Ні\",\n                \"random\": \"Випадково\",\n                \"save\": \"Зберегти\",\n                \"reset\": \"Скинути\"\n            },\n            \"table\": {\n                \"rowsCount\": \"Показати записів:\",\n                \"search\": \"Пошук:\",\n                \"info\": \"Показано $1 з $2 по $3 записів\",\n                \"prev\": \"Попередні\",\n                \"next\": \"Наступні\",\n                \"all\": \"Усі\",\n                \"inspector\": \"Інспектор\",\n                \"skip\": \"Перейти до сторінки\",\n                \"empty\": \"Нема записів\"\n            },\n            \"colorSelector\": {\n                addUserColorButton: \"ДОДАТИ В ЗРАЗКИ\",\n                userColorsTitle: \"КОЛІРИ КОРИСТУВАЧА\"\n            },\n            \"switch\": {\n                on: \"увм\",\n                off: \"вім\"\n            }\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    $.extend(Metro.locales, {\n        'zh-CN': {\n            \"calendar\": {\n                \"months\": [\n                    \"一月\", \"二月\", \"三月\", \"四月\", \"五月\", \"六月\", \"七月\", \"八月\", \"九月\", \"十月\", \"十一月\", \"十二月\",\n                    \"1月\", \"2月\", \"3月\", \"4月\", \"5月\", \"6月\", \"7月\", \"8月\", \"9月\", \"10月\", \"11月\", \"12月\"\n                ],\n                \"days\": [\n                    \"星期日\", \"星期一\", \"星期二\", \"星期三\", \"星期四\", \"星期五\", \"星期六\",\n                    \"日\", \"一\", \"二\", \"三\", \"四\", \"五\", \"六\",\n                    \"周日\", \"周一\", \"周二\", \"周三\", \"周四\", \"周五\", \"周六\"\n                ],\n                \"time\": {\n                    \"days\": \"天\",\n                    \"hours\": \"时\",\n                    \"minutes\": \"分\",\n                    \"seconds\": \"秒\",\n                    \"month\": \"月\",\n                    \"day\": \"日\",\n                    \"year\": \"年\"\n                },\n                \"weekStart\": 1\n            },\n            \"buttons\": {\n                \"ok\": \"确认\",\n                \"cancel\": \"取消\",\n                \"done\": \"完成\",\n                \"today\": \"今天\",\n                \"now\": \"现在\",\n                \"clear\": \"清除\",\n                \"help\": \"帮助\",\n                \"yes\": \"是\",\n                \"no\": \"否\",\n                \"random\": \"随机\",\n                \"save\": \"保存\",\n                \"reset\": \"重啟\"\n            },\n            \"table\": {\n                \"rowsCount\": \"Show entries:\",\n                \"search\": \"Search:\",\n                \"info\": \"Showing $1 to $2 of $3 entries\",\n                \"prev\": \"Prev\",\n                \"next\": \"Next\",\n                \"all\": \"All\",\n                \"inspector\": \"Inspector\",\n                \"skip\": \"Goto page\",\n                \"empty\": \"Nothing to show\"\n            },\n            \"colorSelector\": {\n                addUserColorButton: \"ADD TO SWATCHES\",\n                userColorsTitle: \"USER COLORS\"\n            },\n            \"switch\": {\n                on: \"on\",\n                off: \"off\"\n            }\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    $.extend(Metro.locales, {\n        'zh-TW': {\n            \"calendar\": {\n                \"months\": [\n                    \"一月\", \"二月\", \"三月\", \"四月\", \"五月\", \"六月\", \"七月\", \"八月\", \"九月\", \"十月\", \"十一月\", \"十二月\",\n                    \"1月\", \"2月\", \"3月\", \"4月\", \"5月\", \"6月\", \"7月\", \"8月\", \"9月\", \"10月\", \"11月\", \"12月\"\n                ],\n                \"days\": [\n                    \"星期日\", \"星期一\", \"星期二\", \"星期三\", \"星期四\", \"星期五\", \"星期六\",\n                    \"日\", \"一\", \"二\", \"三\", \"四\", \"五\", \"六\",\n                    \"週日\", \"週一\", \"週二\", \"週三\", \"週四\", \"週五\", \"週六\"\n                ],\n                \"time\": {\n                    \"days\": \"天\",\n                    \"hours\": \"時\",\n                    \"minutes\": \"分\",\n                    \"seconds\": \"秒\",\n                    \"month\": \"月\",\n                    \"day\": \"日\",\n                    \"year\": \"年\"\n                },\n                \"weekStart\": 1\n            },\n            \"buttons\": {\n                \"ok\": \"確認\",\n                \"cancel\": \"取消\",\n                \"done\": \"完成\",\n                \"today\": \"今天\",\n                \"now\": \"現在\",\n                \"clear\": \"清除\",\n                \"help\": \"幫助\",\n                \"yes\": \"是\",\n                \"no\": \"否\",\n                \"random\": \"隨機\",\n                \"save\": \"保存\",\n                \"reset\": \"重啟\"\n            },\n            \"table\": {\n                \"rowsCount\": \"Show entries:\",\n                \"search\": \"Search:\",\n                \"info\": \"Showing $1 to $2 of $3 entries\",\n                \"prev\": \"Prev\",\n                \"next\": \"Next\",\n                \"all\": \"All\",\n                \"inspector\": \"Inspector\",\n                \"skip\": \"Goto page\",\n                \"empty\": \"Nothing to show\"\n            },\n            \"colorSelector\": {\n                addUserColorButton: \"ADD TO SWATCHES\",\n                userColorsTitle: \"USER COLORS\"\n            },\n            \"switch\": {\n                on: \"on\",\n                off: \"off\"\n            }\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function() {\n    'use strict';\n\n    if (typeof Array.prototype.shuffle !== \"function\") {\n        Array.prototype.shuffle = function () {\n            var currentIndex = this.length, temporaryValue, randomIndex;\n\n            while (0 !== currentIndex) {\n\n                randomIndex = Math.floor(Math.random() * currentIndex);\n                currentIndex -= 1;\n\n                temporaryValue = this[currentIndex];\n                this[currentIndex] = this[randomIndex];\n                this[randomIndex] = temporaryValue;\n            }\n\n            return this;\n        };\n    }\n\n    if (typeof Array.prototype.clone !== \"function\") {\n        Array.prototype.clone = function () {\n            return this.slice(0);\n        };\n    }\n\n    if (typeof Array.prototype.unique !== \"function\") {\n        Array.prototype.unique = function () {\n            var a = this.concat();\n            for (var i = 0; i < a.length; ++i) {\n                for (var j = i + 1; j < a.length; ++j) {\n                    if (a[i] === a[j])\n                        a.splice(j--, 1);\n                }\n            }\n\n            return a;\n        };\n    }\n\n}());\r\n\r\n(function() {\n    'use strict';\n\n    /**\n     * Number.prototype.format(n, x, s, c)\n     *\n     * @param  n: length of decimal\n     * @param  x: length of whole part\n     * @param  s: sections delimiter\n     * @param  c: decimal delimiter\n     */\n    Number.prototype.format = function(n, x, s, c) {\n        var re = '\\\\d(?=(\\\\d{' + (x || 3) + '})+' + (n > 0 ? '\\\\D' : '$') + ')',\n            num = this.toFixed(Math.max(0, ~~n));\n\n        return (c ? num.replace('.', c) : num).replace(new RegExp(re, 'g'), '$&' + (s || ','));\n    };\n}());\r\n\r\n(function() {\n    'use strict';\n\n    String.prototype.toArray = function(delimiter, type, format, locale){\n        var str = this;\n        var a;\n\n        type = type || \"string\";\n        delimiter = delimiter || \",\";\n        format = format === undefined || format === null ? false : format;\n\n        a = (\"\"+str).split(delimiter);\n\n        return a.map(function(s){\n            var result;\n\n            switch (type) {\n                case \"int\":\n                case \"integer\": result = isNaN(s) ? s.trim() : parseInt(s); break;\n                case \"number\":\n                case \"float\": result = isNaN(s) ? s : parseFloat(s); break;\n                case \"date\": result = !format ? datetime(s) : Datetime.from(s, format, locale || 'en-US'); break;\n                default: result = s.trim();\n            }\n\n            return result;\n        });\n    };\n\n    String.prototype.capitalize = function(){\n        var str = this;\n        return str.substr(0, 1).toUpperCase() + str.substr(1)\n    }\n}());\r\n\r\n(function(Metro, $) {\n    'use strict';\n    Metro.utils = {\n        isVisible: function(element){\n            var el = $(element)[0];\n            return this.getStyleOne(el, \"display\") !== \"none\"\n                && this.getStyleOne(el, \"visibility\") !== \"hidden\"\n                && el.offsetParent !== null;\n        },\n\n        isUrl: function (val) {\n            /* eslint-disable-next-line */\n            return /^(\\.\\/|\\.\\.\\/|ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@\\-\\/]))?/.test(val);\n        },\n\n        isTag: function(val){\n            /* eslint-disable-next-line */\n            return /^<\\/?[\\w\\s=\"/.':;#-\\/\\?]+>/gi.test(val);\n        },\n\n        isEmbedObject: function(val){\n            var embed = [\"iframe\", \"object\", \"embed\", \"video\"];\n            var result = false;\n            $.each(embed, function(){\n                if (typeof val === \"string\" && val.toLowerCase() === this) {\n                    result = true;\n                } else if (val.nodeType !== undefined && val.tagName.toLowerCase() === this) {\n                    result = true;\n                }\n            });\n            return result;\n        },\n\n        isVideoUrl: function(val){\n            return /youtu\\.be|youtube|twitch|vimeo/gi.test(val);\n        },\n\n        isDate: function(val, format, locale){\n            var result;\n\n            if (this.isDateObject(val)) {\n                return true;\n            }\n\n            try {\n                result = format ? Datetime.from(val, format, locale || \"en-US\") : datetime(val)\n                return Datetime.isDatetime(result);\n            } catch (e) {\n                return false;\n            }\n        },\n\n        isDateObject: function(v){\n            return typeof v === 'object' && v.getMonth !== undefined;\n        },\n\n        isInt: function(n){\n            return !isNaN(n) && +n % 1 === 0;\n        },\n\n        isFloat: function(n){\n            return (!isNaN(n) && +n % 1 !== 0) || /^\\d*\\.\\d+$/.test(n);\n        },\n\n        isFunc: function(f){\n            return this.isType(f, 'function');\n        },\n\n        isObject: function(o){\n            return this.isType(o, 'object');\n        },\n\n        isObject2: function(o){\n            return typeof o === \"object\" && !Array.isArray(o);\n        },\n\n        isType: function(o, t){\n            if (!this.isValue(o)) {\n                return false;\n            }\n\n            if (typeof o === t) {\n                return o;\n            }\n\n            if ((\"\"+t).toLowerCase() === 'tag' && this.isTag(o)) {\n                return o;\n            }\n\n            if ((\"\"+t).toLowerCase() === 'url' && this.isUrl(o)) {\n                return o;\n            }\n\n            if ((\"\"+t).toLowerCase() === 'array' && Array.isArray(o)) {\n                return o;\n            }\n\n            if (this.isTag(o) || this.isUrl(o)) {\n                return false;\n            }\n\n            if (typeof window[o] === t) {\n                return window[o];\n            }\n\n            if (typeof o === 'string' && o.indexOf(\".\") === -1) {\n                return false;\n            }\n\n            if (typeof o === 'string' && /[/\\s([]+/gm.test(o)) {\n                return false;\n            }\n\n            if (typeof o === \"number\" && t.toLowerCase() !== \"number\") {\n                return false;\n            }\n\n            var ns = o.split(\".\");\n            var i, context = window;\n\n            for(i = 0; i < ns.length; i++) {\n                context = context[ns[i]];\n            }\n\n            return typeof context === t ? context : false;\n        },\n\n        $: function(){\n            return window.useJQuery ? jQuery : m4q;\n        },\n\n        isMetroObject: function(el, type){\n            var $el = $(el), el_obj = Metro.getPlugin(el, type);\n\n            if ($el.length === 0) {\n                console.warn(type + ' ' + el + ' not found!');\n                return false;\n            }\n\n            if (el_obj === undefined) {\n                console.warn('Element not contain role '+ type +'! Please add attribute data-role=\"'+type+'\" to element ' + el);\n                return false;\n            }\n\n            return true;\n        },\n\n        isJQuery: function(el){\n            return (typeof jQuery !== \"undefined\" && el instanceof jQuery);\n        },\n\n        isM4Q: function(el){\n            return (typeof m4q !== \"undefined\" && el instanceof m4q);\n        },\n\n        isQ: function(el){\n            return this.isJQuery(el) || this.isM4Q(el);\n        },\n\n        embedUrl: function(val){\n            if (val.indexOf(\"youtu.be\") !== -1) {\n                val = \"https://www.youtube.com/embed/\" + val.split(\"/\").pop();\n            }\n            return \"<div class='embed-container'><iframe src='\"+val+\"'></iframe></div>\";\n        },\n\n        elementId: function(prefix){\n            return prefix+\"-\"+(new Date()).getTime()+$.random(1, 1000);\n        },\n\n        secondsToTime: function(s) {\n            var days = Math.floor((s % 31536000) / 86400);\n            var hours = Math.floor(((s % 31536000) % 86400) / 3600);\n            var minutes = Math.floor((((s % 31536000) % 86400) % 3600) / 60);\n            var seconds = Math.round((((s % 31536000) % 86400) % 3600) % 60);\n\n            return {\n                \"d\": days,\n                \"h\": hours,\n                \"m\": minutes,\n                \"s\": seconds\n            };\n        },\n\n        secondsToFormattedString: function(time){\n            var sec_num = parseInt(time, 10);\n            var hours   = Math.floor(sec_num / 3600);\n            var minutes = Math.floor((sec_num - (hours * 3600)) / 60);\n            var seconds = sec_num - (hours * 3600) - (minutes * 60);\n\n            return [\n                Cake.lpad(hours, 2, \"0\"),\n                Cake.lpad(minutes, 2, \"0\"),\n                Cake.lpad(seconds, 2, \"0\")\n            ].join(\":\");\n        },\n\n        func: function(f){\n            /* jshint -W054 */\n            return new Function(\"a\", f);\n        },\n\n        exec: function(f, args, context){\n            var result;\n            if (f === undefined || f === null) {return false;}\n            var func = this.isFunc(f);\n\n            if (func === false) {\n                func = this.func(f);\n            }\n\n            try {\n                result = func.apply(context, args);\n            } catch (err) {\n                result = null;\n                if (window.METRO_THROWS === true) {\n                    throw err;\n                }\n            }\n            return result;\n        },\n\n        isOutsider: function(element) {\n            var el = $(element);\n            var inViewport;\n            var clone = el.clone();\n\n            clone.removeAttr(\"data-role\").css({\n                visibility: \"hidden\",\n                position: \"absolute\",\n                display: \"block\"\n            });\n            el.parent().append(clone);\n\n            inViewport = this.inViewport(clone[0]);\n\n            clone.remove();\n\n            return !inViewport;\n        },\n\n        inViewport: function(el){\n            var rect = this.rect(el);\n\n            return (\n                rect.top >= 0 &&\n                rect.left >= 0 &&\n                rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\n                rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n            );\n        },\n\n        rect: function(el){\n            return el.getBoundingClientRect();\n        },\n\n        getCursorPosition: function(el, e){\n            var a = this.rect(el);\n            return {\n                x: this.pageXY(e).x - a.left - window.pageXOffset,\n                y: this.pageXY(e).y - a.top - window.pageYOffset\n            };\n        },\n\n        getCursorPositionX: function(el, e){\n            return this.getCursorPosition(el, e).x;\n        },\n\n        getCursorPositionY: function(el, e){\n            return this.getCursorPosition(el, e).y;\n        },\n\n        objectLength: function(obj){\n            return Object.keys(obj).length;\n        },\n\n        percent: function(total, part, round_value){\n            if (total === 0) {\n                return 0;\n            }\n            var result = part * 100 / total;\n            return round_value === true ? Math.round(result) : Math.round(result * 100) / 100;\n        },\n\n        objectShift: function(obj){\n            var min = 0;\n            $.each(obj, function(i){\n                if (min === 0) {\n                    min = i;\n                } else {\n                    if (min > i) {\n                        min = i;\n                    }\n                }\n            });\n            delete obj[min];\n\n            return obj;\n        },\n\n        objectDelete: function(obj, key){\n            if (obj[key] !== undefined) delete obj[key];\n        },\n\n        arrayDeleteByMultipleKeys: function(arr, keys){\n            keys.forEach(function(ind){\n                delete arr[ind];\n            });\n            return arr.filter(function(item){\n                return item !== undefined;\n            });\n        },\n\n        arrayDelete: function(arr, val){\n            var i = arr.indexOf(val);\n            if (i > -1) arr.splice(i, 1);\n        },\n\n        arrayDeleteByKey: function(arr, key){\n            arr.splice(key, 1);\n        },\n\n        nvl: function(data, other){\n            return data === undefined || data === null ? other : data;\n        },\n\n        objectClone: function(obj){\n            var copy = {};\n            for(var key in obj) {\n                if ($.hasProp(obj, key)) {\n                    copy[key] = obj[key];\n                }\n            }\n            return copy;\n        },\n\n        github: function(repo, callback){\n            var that = this;\n            $.json('https://api.github.com/repos/' + repo).then(function(data){\n                that.exec(callback, [data]);\n            });\n        },\n\n        detectIE: function() {\n            var ua = window.navigator.userAgent;\n            var msie = ua.indexOf('MSIE ');\n            if (msie > 0) {\n                // IE 10 or older => return version number\n                return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\n            }\n\n            var trident = ua.indexOf('Trident/');\n            if (trident > 0) {\n                // IE 11 => return version number\n                var rv = ua.indexOf('rv:');\n                return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\n            }\n\n            var edge = ua.indexOf('Edge/');\n            if (edge > 0) {\n                // Edge (IE 12+) => return version number\n                return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);\n            }\n\n            // other browser\n            return false;\n        },\n\n        detectChrome: function(){\n            return /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);\n        },\n\n        pageHeight: function(){\n            var body = document.body,\n                html = document.documentElement;\n\n            return Math.max( body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight );\n        },\n\n        cleanPreCode: function(selector){\n            var els = Array.prototype.slice.call(document.querySelectorAll(selector), 0);\n\n            els.forEach(function(el){\n                var txt = el.textContent\n                    .replace(/^[\\r\\n]+/, \"\")\t// strip leading newline\n                    .replace(/\\s+$/g, \"\");\n\n                if (/^\\S/gm.test(txt)) {\n                    el.textContent = txt;\n                    return;\n                }\n\n                var mat, str, re = /^[\\t ]+/gm, len, min = 1e3;\n\n                /* jshint -W084 */\n                /* eslint-disable-next-line */\n                while (mat = re.exec(txt)) {\n                    len = mat[0].length;\n\n                    if (len < min) {\n                        min = len;\n                        str = mat[0];\n                    }\n                }\n\n                if (min === 1e3)\n                    return;\n\n                el.textContent = txt.replace(new RegExp(\"^\" + str, 'gm'), \"\").trim();\n            });\n        },\n\n        coords: function(element){\n            var el = $(element)[0];\n            var box = el.getBoundingClientRect();\n\n            return {\n                top: box.top + window.pageYOffset,\n                left: box.left + window.pageXOffset\n            };\n        },\n\n        positionXY: function(e, t){\n            switch (t) {\n                case 'client': return this.clientXY(e);\n                case 'screen': return this.screenXY(e);\n                case 'page': return this.pageXY(e);\n                default: return {x: 0, y: 0};\n            }\n        },\n\n        /**\n         *\n         * @param {TouchEvent|Event|MouseEvent} e\n         * @returns {{x: (*), y: (*)}}\n         */\n        clientXY: function(e){\n            return {\n                x: e.changedTouches ? e.changedTouches[0].clientX : e.clientX,\n                y: e.changedTouches ? e.changedTouches[0].clientY : e.clientY\n            };\n        },\n\n        /**\n         *\n         * @param {TouchEvent|Event|MouseEvent} e\n         * @returns {{x: (*), y: (*)}}\n         */\n        screenXY: function(e){\n            return {\n                x: e.changedTouches ? e.changedTouches[0].screenX : e.screenX,\n                y: e.changedTouches ? e.changedTouches[0].screenY : e.screenY\n            };\n        },\n\n        /**\n         *\n         * @param {TouchEvent|Event|MouseEvent} e\n         * @returns {{x: (*), y: (*)}}\n         */\n        pageXY: function(e){\n            return {\n                x: e.changedTouches ? e.changedTouches[0].pageX : e.pageX,\n                y: e.changedTouches ? e.changedTouches[0].pageY : e.pageY\n            };\n        },\n\n        isRightMouse: function(e){\n            return \"which\" in e ? e.which === 3 : \"button\" in e ? e.button === 2 : undefined;\n        },\n\n        hiddenElementSize: function(el, includeMargin){\n            var width, height, clone = $(el).clone(true);\n\n            clone.removeAttr(\"data-role\").css({\n                visibility: \"hidden\",\n                position: \"absolute\",\n                display: \"block\"\n            });\n            $(\"body\").append(clone);\n\n            if (!this.isValue(includeMargin)) {\n                includeMargin = false;\n            }\n\n            width = clone.outerWidth(includeMargin);\n            height = clone.outerHeight(includeMargin);\n            clone.remove();\n            return {\n                width: width,\n                height: height\n            };\n        },\n\n        getStyle: function(element, pseudo){\n            var el = $(element)[0];\n            return window.getComputedStyle(el, pseudo);\n        },\n\n        getStyleOne: function(el, property){\n            return this.getStyle(el).getPropertyValue(property);\n        },\n\n        getInlineStyles: function(element){\n            var i, l, styles = {}, el = $(element)[0];\n            for (i = 0, l = el.style.length; i < l; i++) {\n                var s = el.style[i];\n                styles[s] = el.style[s];\n            }\n\n            return styles;\n        },\n\n        encodeURI: function(str){\n            return encodeURI(str).replace(/%5B/g, '[').replace(/%5D/g, ']');\n        },\n\n        updateURIParameter: function(uri, key, value) {\n            var re = new RegExp(\"([?&])\" + key + \"=.*?(&|$)\", \"i\");\n            var separator = uri.indexOf('?') !== -1 ? \"&\" : \"?\";\n            if (uri.match(re)) {\n                return uri.replace(re, '$1' + key + \"=\" + value + '$2');\n            }\n            else {\n                return uri + separator + key + \"=\" + value;\n            }\n        },\n\n        getURIParameter: function(url, name){\n            if (!url) url = window.location.href;\n            /* eslint-disable-next-line */\n            name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n            var regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\n                results = regex.exec(url);\n            if (!results) return null;\n            if (!results[2]) return '';\n            return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n        },\n\n        getLocales: function(){\n            return Object.keys(Metro.locales);\n        },\n\n        addLocale: function(locale){\n            Metro.locales = $.extend( {}, Metro.locales, locale );\n        },\n\n        aspectRatioH: function(width, a){\n            if (a === \"16/9\") return width * 9 / 16;\n            if (a === \"21/9\") return width * 9 / 21;\n            if (a === \"4/3\") return width * 3 / 4;\n        },\n\n        aspectRatioW: function(height, a){\n            if (a === \"16/9\") return height * 16 / 9;\n            if (a === \"21/9\") return height * 21 / 9;\n            if (a === \"4/3\") return height * 4 / 3;\n        },\n\n        valueInObject: function(obj, value){\n            return Object.values(obj).indexOf(value) > -1;\n        },\n\n        keyInObject: function(obj, key){\n            return Object.keys(obj).indexOf(key) > -1;\n        },\n\n        inObject: function(obj, key, val){\n            return obj[key] !== undefined && obj[key] === val;\n        },\n\n        newCssSheet: function(media){\n            var style = document.createElement(\"style\");\n\n            if (media !== undefined) {\n                style.setAttribute(\"media\", media);\n            }\n\n            style.appendChild(document.createTextNode(\"\"));\n\n            document.head.appendChild(style);\n\n            return style.sheet;\n        },\n\n        addCssRule: function(sheet, selector, rules, index){\n            sheet.insertRule(selector + \"{\" + rules + \"}\", index);\n        },\n\n        media: function(query){\n            return window.matchMedia(query).matches;\n        },\n\n        mediaModes: function(){\n            return window.METRO_MEDIA;\n        },\n\n        mediaExist: function(media){\n            return window.METRO_MEDIA.indexOf(media) > -1;\n        },\n\n        inMedia: function(media){\n            return window.METRO_MEDIA.indexOf(media) > -1 && window.METRO_MEDIA.indexOf(media) === window.METRO_MEDIA.length - 1;\n        },\n\n        isValue: function(val){\n            return val !== undefined && val !== null && val !== \"\";\n        },\n\n        isNull: function(val){\n            return val === undefined || val === null;\n        },\n\n        isNegative: function(val){\n            return parseFloat(val) < 0;\n        },\n\n        isPositive: function(val){\n            return parseFloat(val) > 0;\n        },\n\n        isZero: function(val){\n            return (parseFloat(val.toFixed(2))) === 0.00;\n        },\n\n        between: function(val, bottom, top, equals){\n            return equals === true ? val >= bottom && val <= top : val > bottom && val < top;\n        },\n\n        parseMoney: function(val){\n            return Number(parseFloat(val.replace(/[^0-9-.]/g, '')));\n        },\n\n        parseCard: function(val){\n            return val.replace(/[^0-9]/g, '');\n        },\n\n        parsePhone: function(val){\n            return this.parseCard(val);\n        },\n\n        parseNumber: function(val, thousand, decimal){\n            return val.replace(new RegExp('\\\\'+thousand, \"g\"), \"\").replace(new RegExp('\\\\'+decimal, 'g'), \".\");\n        },\n\n        nearest: function(val, precision, down){\n            val /= precision;\n            val = Math[down === true ? 'floor' : 'ceil'](val) * precision;\n            return val;\n        },\n\n        bool: function(value){\n            switch(value){\n                case true:\n                case \"true\":\n                case 1:\n                case \"1\":\n                case \"on\":\n                case \"yes\":\n                    return true;\n                default:\n                    return false;\n            }\n        },\n\n        copy: function(element){\n            var body = document.body, range, sel;\n            var el = $(element)[0];\n\n            if (document.createRange && window.getSelection) {\n                range = document.createRange();\n                sel = window.getSelection();\n                sel.removeAllRanges();\n                try {\n                    range.selectNodeContents(el);\n                    sel.addRange(range);\n                } catch (e) {\n                    range.selectNode(el);\n                    sel.addRange(range);\n                }\n            } else if (body[\"createTextRange\"]) {\n                range = body[\"createTextRange\"]();\n                range[\"moveToElementText\"](el);\n                range.select();\n            }\n\n            document.execCommand(\"Copy\");\n\n            if (window.getSelection) {\n                if (window.getSelection().empty) {  // Chrome\n                    window.getSelection().empty();\n                } else if (window.getSelection().removeAllRanges) {  // Firefox\n                    window.getSelection().removeAllRanges();\n                }\n            } else if (document[\"selection\"]) {  // IE?\n                document[\"selection\"].empty();\n            }\n        },\n\n        decCount: function(v){\n            return v % 1 === 0 ? 0 : v.toString().split(\".\")[1].length;\n        }\n    };\n\n    if (window.METRO_GLOBAL_COMMON === true) {\n        window.Utils = Metro.utils;\n    }\n}(Metro, m4q));\r\n\r\n(function(Metro, $){\n    'use strict';\n    var Utils = Metro.utils;\n    var AccordionDefaultConfig = {\n        accordionDeferred: 0,\n        showMarker: true,\n        material: false,\n        duration: METRO_ANIMATION_DURATION,\n        oneFrame: true,\n        showActive: true,\n        activeFrameClass: \"\",\n        activeHeadingClass: \"\",\n        activeContentClass: \"\",\n        clsFrame: \"\",\n        clsHeading: \"\",\n        clsContent: \"\",\n        clsAccordion: \"\",\n        clsActiveFrame: \"\",\n        clsActiveFrameHeading: \"\",\n        clsActiveFrameContent: \"\",\n        onFrameOpen: Metro.noop,\n        onFrameBeforeOpen: Metro.noop_true,\n        onFrameClose: Metro.noop,\n        onFrameBeforeClose: Metro.noop_true,\n        onAccordionCreate: Metro.noop\n    };\n\n    Metro.accordionSetup = function(options){\n        AccordionDefaultConfig = $.extend({}, AccordionDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroAccordionSetup\"] !== undefined) {\n        Metro.accordionSetup(window[\"metroAccordionSetup\"]);\n    }\n\n    Metro.Component('accordion', {\n        init: function( options, elem ) {\n            this._super(elem, options, AccordionDefaultConfig);\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent('accordionCreate', {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var that = this, element = this.element, o = this.options;\n            var frames = element.children(\".frame\");\n            var active = element.children(\".frame.active\");\n            var frame_to_open;\n\n            element\n                .addClass(\"accordion\")\n                .addClass(o.clsAccordion)\n            ;\n\n            frames\n                .addClass(o.clsFrame)\n                .each(function(){\n                    var $el = $(this);\n                    $el.children(\".heading\").addClass(o.clsHeading);\n                    $el.children(\".content\").addClass(o.clsContent);\n                })\n            ;\n\n            if (o.showMarker === true) {\n                element.addClass(\"marker-on\");\n            }\n\n            if (o.material === true) {\n                element.addClass(\"material\");\n            }\n\n            if (active.length === 0) {\n                frame_to_open = frames[0];\n            } else {\n                frame_to_open = active[0];\n            }\n\n            this._hideAll();\n\n            if (o.showActive === true) {\n                if (o.oneFrame === true) {\n                    this._openFrame(frame_to_open);\n                } else {\n                    $.each(active, function(){\n                        that._openFrame(this);\n                    });\n                }\n            }\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var active = element.children(\".frame.active\");\n\n            element.on(Metro.events.click, \".heading\", function(){\n                var heading = $(this);\n                var frame = heading.parent();\n\n                if (heading.closest(\".accordion\")[0] !== element[0]) {\n                    return false;\n                }\n\n                if (frame.hasClass(\"active\")) {\n                    if (active.length === 1 && o.oneFrame) {\n                        /* eslint-disable-next-line */\n\n                    } else {\n                        that._closeFrame(frame);\n                    }\n                } else {\n                    that._openFrame(frame);\n                }\n            });\n        },\n\n        _openFrame: function(f){\n            var element = this.element, o = this.options;\n            var frame = $(f);\n\n            if (Utils.exec(o.onFrameBeforeOpen, [frame[0]], element[0]) === false) {\n                return false;\n            }\n\n            if (o.oneFrame === true) {\n                this._closeAll(frame[0]);\n            }\n\n            frame.addClass(\"active \" + o.activeFrameClass).addClass(o.clsActiveFrame);\n            frame.children(\".heading\").addClass(o.activeHeadingClass).addClass(o.clsActiveFrameHeading);\n            frame.children(\".content\").addClass(o.activeContentClass).addClass(o.clsActiveFrameContent).slideDown(o.duration);\n\n            this._fireEvent(\"frameOpen\", {\n                frame: frame[0]\n            });\n        },\n\n        _closeFrame: function(f){\n            var element = this.element, o = this.options;\n            var frame = $(f);\n\n            if (!frame.hasClass(\"active\")) {\n                return ;\n            }\n\n            if (Utils.exec(o.onFrameBeforeClose, [frame[0]], element[0]) === false) {\n                return ;\n            }\n\n            frame.removeClass(\"active \" + o.activeFrameClass).removeClass(o.clsActiveFrame);\n            frame.children(\".heading\").removeClass(o.activeHeadingClass).removeClass(o.clsActiveFrameHeading);\n            frame.children(\".content\").removeClass(o.activeContentClass).removeClass(o.clsActiveFrameContent).slideUp(o.duration);\n\n            this._fireEvent(\"frameClose\", {\n                frame: frame[0]\n            });\n        },\n\n        _closeAll: function(skip){\n            var that = this, element = this.element;\n            var frames = element.children(\".frame\");\n\n            $.each(frames, function(){\n                if (skip === this) return;\n                that._closeFrame(this);\n            });\n        },\n\n        _hideAll: function(){\n            var element = this.element;\n            var frames = element.children(\".frame\");\n\n            $.each(frames, function(){\n                $(this).children(\".content\").hide();\n            });\n        },\n\n        _openAll: function(){\n            var that = this, element = this.element;\n            var frames = element.children(\".frame\");\n\n            $.each(frames, function(){\n                that._openFrame(this);\n            });\n        },\n\n        open: function(i){\n            var frame = this.element.children(\".frame\").eq(i);\n            this._openFrame(frame);\n        },\n\n        /* eslint-disable-next-line */\n        changeAttribute: function(attr, newVal){\n        },\n\n        destroy: function(){\n            var element = this.element;\n            element.off(Metro.events.click, \".heading\");\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var ActivityDefaultConfig = {\n        activityDeferred: 0,\n        type: \"ring\",\n        style: \"color\",\n        size: 64,\n        radius: 20,\n        onActivityCreate: Metro.noop\n    };\n\n    Metro.activitySetup = function(options){\n        ActivityDefaultConfig = $.extend({}, ActivityDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroActivitySetup\"] !== undefined) {\n        Metro.activitySetup(window[\"metroActivitySetup\"]);\n    }\n\n    Metro.Component('activity', {\n        init: function( options, elem ) {\n            this._super(elem, options, ActivityDefaultConfig);\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n            var i, wrap;\n\n            element\n                .html('')\n                .addClass(o.style + \"-style\")\n                .addClass(\"activity-\" + o.type);\n\n            function _metro(){\n                for(i = 0; i < 5 ; i++) {\n                    $(\"<div/>\").addClass('circle').appendTo(element);\n                }\n            }\n\n            function _square(){\n                for(i = 0; i < 4 ; i++) {\n                    $(\"<div/>\").addClass('square').appendTo(element);\n                }\n            }\n\n            function _cycle(){\n                $(\"<div/>\").addClass('cycle').appendTo(element);\n            }\n\n            function _ring(){\n                for(i = 0; i < 5 ; i++) {\n                    wrap = $(\"<div/>\").addClass('wrap').appendTo(element);\n                    $(\"<div/>\").addClass('circle').appendTo(wrap);\n                }\n            }\n\n            function _simple(){\n                $('<svg class=\"circular\"><circle class=\"path\" cx=\"'+o.size/2+'\" cy=\"'+o.size/2+'\" r=\"'+o.radius+'\" fill=\"none\" stroke-width=\"2\" stroke-miterlimit=\"10\"/></svg>').appendTo(element);\n            }\n\n            function _atom(){\n                for(i = 0; i < 3 ; i++) {\n                    $(\"<span/>\").addClass('electron').appendTo(element);\n                }\n            }\n\n            function _bars(){\n                for(i = 0; i < 6 ; i++) {\n                    $(\"<span/>\").addClass('bar').appendTo(element);\n                }\n            }\n\n            switch (o.type) {\n                case 'metro': _metro(); break;\n                case 'square': _square(); break;\n                case 'cycle': _cycle(); break;\n                case 'simple': _simple(); break;\n                case 'atom': _atom(); break;\n                case 'bars': _bars(); break;\n                default: _ring();\n            }\n\n            this._fireEvent(\"activity-create\", {\n                element: element\n            })\n        },\n\n        /*eslint-disable-next-line*/\n        changeAttribute: function(attributeName){\n        },\n\n        destroy: function(){\n            return this.element;\n        }\n    });\n\n    Metro.activity = {\n        open: function(options){\n            var o = options || {};\n            var activity = '<div data-role=\"activity\" data-type=\"'+( o.type ? o.type : 'cycle' )+'\" data-style=\"'+( o.style ? o.style : 'color' )+'\"></div>';\n            var text = o.text ? '<div class=\"text-center\">'+o.text+'</div>' : '';\n\n            return Metro.dialog.create({\n                content: activity + text,\n                defaultAction: false,\n                clsContent: \"d-flex flex-column flex-justify-center flex-align-center bg-transparent no-shadow w-auto\",\n                clsDialog: \"no-border no-shadow bg-transparent global-dialog\",\n                autoHide: o.autoHide ? o.autoHide : 0,\n                overlayClickClose: o.overlayClickClose === true,\n                overlayColor: o.overlayColor ? o.overlayColor : '#000000',\n                overlayAlpha: o.overlayAlpha ? o.overlayAlpha : 0.5,\n                clsOverlay: \"global-overlay\"\n            });\n        },\n\n        close: function(a){\n            Metro.dialog.close(a);\n        }\n    };\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var AdblockDefaultConfig = {\n        adblockDeferred: 0,\n        checkInterval: 1000,\n        fireOnce: true,\n        checkStop: 10,\n        localhost: false,\n        onAlert: Metro.noop,\n        onFishingStart: Metro.noop,\n        onFishingDone: Metro.noop\n    };\n\n    Metro.adblockSetup = function(options){\n        AdblockDefaultConfig = $.extend({}, AdblockDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroAdblockSetup\"] !== undefined) {\n        Metro.adblockSetup(window[\"metroAdblockSetup\"]);\n    }\n\n    var Adblock = {\n        bite: function(){\n            var classes = \"adblock-bite adsense google-adsense dblclick advert topad top_ads topAds textads sponsoredtextlink_container show_ads right-banner rekl mpu module-ad mid_ad mediaget horizontal_ad headerAd contentAd brand-link bottombanner bottom_ad_block block_ad bannertop banner-right banner-body b-banner b-article-aside__banner b-advert adwrapper adverts advertisment advertisement:not(body) advertise advert_list adtable adsense adpic adlist adleft adinfo adi adholder adframe addiv ad_text ad_space ad_right ad_links ad_body ad_block ad_Right adTitle adText\";\n            $(\"<div>\")\n                .addClass(classes.split(\" \").shuffle().join(\" \"))\n                .css({\n                    position: \"fixed\",\n                    height: 1,\n                    width: 1,\n                    overflow: \"hidden\",\n                    visibility: \"visible\",\n                    top: 0,\n                    left: 0\n                })\n                .append($(\"<a href='https://dblclick.net'>\").html('dblclick.net'))\n                .appendTo('body');\n\n            if (Adblock.options.adblockDeferred) {\n                setTimeout(function () {\n                    Adblock.fishing();\n                }, Adblock.options.adblockDeferred);\n            } else this.fishing();\n        },\n\n        fishing: function(){\n            var o = Adblock.options;\n            var checks = typeof o.fireOnce === \"number\" ? o.fireOnce : 0;\n            var checkStop = o.checkStop;\n            var interval = false;\n            var run = function(){\n                var a = $(\".adsense.google-adsense.dblclick.advert.adblock-bite\");\n                var b = a.find(\"a\");\n                var done = function(){\n                    clearInterval(interval);\n\n                    Utils.exec(o.onFishingDone);\n                    $(window).fire(\"fishing-done\");\n\n                    a.remove();\n                };\n\n                if (!o.localhost && $.localhost) {\n                    done();\n                    return ;\n                }\n\n                if (   !a.length\n                    || !b.length\n                    || a.css(\"display\").indexOf('none') > -1\n                    || b.css(\"display\").indexOf('none') > -1\n                ) {\n\n                    Utils.exec(Adblock.options.onAlert);\n                    $(window).fire(\"adblock-alert\");\n\n                    if (Adblock.options.fireOnce === true) {\n                        done();\n                    } else {\n                        checks--;\n                        if (checks === 0) {\n                            done();\n                        }\n                    }\n                } else {\n                    if (checkStop !== false) {\n                        checkStop--;\n                        if (checkStop === 0) {\n                            done();\n                        }\n                    }\n                }\n            };\n\n            Utils.exec(o.onFishingStart);\n            $(window).fire(\"fishing-start\");\n\n            interval = setInterval(function(){\n                run();\n            }, Adblock.options.checkInterval);\n\n            run();\n        }\n    };\n\n    Metro.Adblock = Adblock;\n\n    $(function(){\n        Adblock.options = $.extend({}, AdblockDefaultConfig);\n        $(window).on(\"metro-initiated\", function(){\n            Adblock.bite();\n        });\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var AnimationDefaultConfig = {\n        duration: METRO_ANIMATION_DURATION,\n        ease: \"linear\"\n    }\n\n    Metro.animations = {\n\n        switchIn: function(el){\n            $(el)\n                .hide()\n                .css({\n                    left: 0,\n                    top: 0\n                })\n                .show();\n        },\n\n        switchOut: function(el){\n            $(el).hide();\n        },\n\n        switch: function(current, next){\n            this.switchOut(current);\n            this.switchIn(next);\n        },\n\n        slideUpIn: function(el, o){\n            var op, $el = $(el);\n            var h = $el.parent().outerHeight(true);\n\n            op = $.extend({}, AnimationDefaultConfig, o);\n\n            $el\n                .css({\n                    top: h,\n                    left: 0,\n                    zIndex: 2\n                })\n                .animate({\n                    draw: {\n                        top: 0,\n                        opacity: 1\n                    },\n                    dur: op.duration,\n                    ease: op.ease\n                });\n        },\n\n        slideUpOut: function(el, o){\n            var op, $el = $(el);\n            var h = $el.parent().outerHeight(true);\n\n            op = $.extend({}, AnimationDefaultConfig, o);\n\n            $el\n                .css({\n                    zIndex: 1\n                })\n                .animate({\n                    draw: {\n                        top: -h,\n                        opacity: 0\n                    },\n                    dur: op.duration,\n                    ease: op.ease\n                });\n        },\n\n        slideUp: function(current, next, o){\n            this.slideUpOut(current, o);\n            this.slideUpIn(next, o);\n        },\n\n        slideDownIn: function(el, o){\n            var op, $el = $(el);\n            var h = $el.parent().outerHeight(true);\n\n            op = $.extend({}, AnimationDefaultConfig, o);\n\n            $el\n                .css({\n                    left: 0,\n                    top: -h,\n                    zIndex: 2\n                })\n                .animate({\n                    draw: {\n                        top: 0,\n                        opacity: 1\n                    },\n                    dur: op.duration,\n                    ease: op.ease\n                });\n        },\n\n        slideDownOut: function(el, o){\n            var op, $el = $(el);\n            var h = $el.parent().outerHeight(true);\n\n            op = $.extend({}, AnimationDefaultConfig, o);\n\n            $el\n                .css({\n                    zIndex: 1\n                })\n                .animate({\n                    draw: {\n                        top: h,\n                        opacity: 0\n                    },\n                    dur: op.duration,\n                    ease: op.ease\n                });\n        },\n\n        slideDown: function(current, next, o){\n            this.slideDownOut(current, o);\n            this.slideDownIn(next, o);\n        },\n\n        slideLeftIn: function(el, o){\n            var op, $el = $(el);\n            var w = $el.parent().outerWidth(true);\n\n            op = $.extend({}, AnimationDefaultConfig, o);\n\n            $el\n                .css({\n                    left: w,\n                    zIndex: 2\n                })\n                .animate({\n                    draw: {\n                        left: 0,\n                        opacity: 1\n                    },\n                    dur: op.duration,\n                    ease: op.ease\n                });\n        },\n\n        slideLeftOut: function(el, o){\n            var op, $el = $(el);\n            var w = $el.parent().outerWidth(true);\n\n            op = $.extend({}, AnimationDefaultConfig, o);\n\n            $el\n                .css({\n                    zIndex: 1\n                })\n                .animate({\n                    draw: {\n                        left: -w,\n                        opacity: 0\n                    },\n                    dur: op.duration,\n                    ease: op.ease\n                });\n        },\n\n        slideLeft: function(current, next, o){\n            this.slideLeftOut(current, o);\n            this.slideLeftIn(next, o);\n        },\n\n        slideRightIn: function(el, o){\n            var op, $el = $(el);\n            var w = $el.parent().outerWidth(true);\n\n            op = $.extend({}, AnimationDefaultConfig, o);\n\n            $el\n                .css({\n                    left: -w,\n                    zIndex: 2\n                })\n                .animate({\n                    draw: {\n                        left: 0,\n                        opacity: 1\n                    },\n                    dur: op.duration,\n                    ease: op.ease\n                });\n        },\n\n        slideRightOut: function(el, o){\n            var op, $el = $(el);\n            var w = $el.parent().outerWidth(true);\n\n            op = $.extend({}, AnimationDefaultConfig, o);\n\n            $el\n                .css({\n                    zIndex: 1\n                })\n                .animate({\n                    draw: {\n                        left:  w,\n                        opacity: 0\n                    },\n                    dur: op.duration,\n                    ease: op.ease\n                });\n        },\n\n        slideRight: function(current, next, o){\n            this.slideRightOut(current, o);\n            this.slideRightIn(next, o);\n        },\n\n        fadeIn: function(el, o){\n            var op = $.extend({}, AnimationDefaultConfig, o);\n            var $el = $(el);\n\n            $el\n                .css({\n                    top: 0,\n                    left: 0,\n                    opacity: 0\n                })\n                .animate({\n                    draw: {\n                        opacity: 1\n                    },\n                    dur: op.duration,\n                    ease: op.ease\n                });\n        },\n\n        fadeOut: function(el, o){\n            var op = $.extend({}, AnimationDefaultConfig, o);\n            var $el = $(el);\n\n            $el\n                .animate({\n                    draw: {\n                        opacity: 0\n                    },\n                    dur: op.duration,\n                    ease: op.ease\n                });\n        },\n\n        fade: function(current, next, o){\n            this.fadeOut(current, o);\n            this.fadeIn(next, o);\n        },\n\n        zoomIn: function(el, o){\n            var op = $.extend({}, AnimationDefaultConfig, o);\n            var $el = $(el);\n\n            $el\n                .css({\n                    top: 0,\n                    left: 0,\n                    opacity: 0,\n                    transform: \"scale(3)\",\n                    zIndex: 2\n                })\n                .animate({\n                    draw: {\n                        scale: 1,\n                        opacity: 1\n                    },\n                    dur: op.duration,\n                    ease: op.ease\n                });\n        },\n\n        zoomOut: function(el, o){\n            var op = $.extend({}, AnimationDefaultConfig, o);\n            var $el = $(el);\n\n            $el\n                .css({\n                    zIndex: 1\n                })\n                .animate({\n                    draw: {\n                        scale: 3,\n                        opacity: 0\n                    },\n                    dur: op.duration,\n                    ease: op.ease\n                });\n        },\n\n        zoom: function(current, next, o){\n            this.zoomOut(current, o);\n            this.zoomIn(next, o);\n        },\n\n        swirlIn: function(el, o){\n            var op = $.extend({}, AnimationDefaultConfig, o);\n            var $el = $(el);\n\n            $el\n                .css({\n                    top: 0,\n                    left: 0,\n                    opacity: 0,\n                    transform: \"scale(3) rotate(180deg)\",\n                    zIndex: 2\n                })\n                .animate({\n                    draw: {\n                        scale: 1,\n                        rotate: 0,\n                        opacity: 1\n                    },\n                    dur: op.duration,\n                    ease: op.ease\n                });\n        },\n\n        swirlOut: function(el, o){\n            var op = $.extend({}, AnimationDefaultConfig, o);\n            var $el = $(el);\n\n            $el\n                .css({\n                    zIndex: 1\n                })\n                .animate({\n                    draw: {\n                        scale: 3,\n                        rotate: \"180deg\",\n                        opacity: 0\n                    },\n                    dur: op.duration,\n                    ease: op.ease\n                });\n        },\n\n        swirl: function(current, next, o){\n            this.swirlOut(current, o);\n            this.swirlIn(next, o);\n        }\n    };\n\n    if (window.METRO_GLOBAL_COMMON === true) {\n        window.Animations = Metro.animations;\n    }\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var Utils = Metro.utils;\n    var AppBarDefaultConfig = {\n        appbarDeferred: 0,\n        expand: false,\n        expandPoint: null,\n        duration: 100,\n        onMenuOpen: Metro.noop,\n        onMenuClose: Metro.noop,\n        onBeforeMenuOpen: Metro.noop,\n        onBeforeMenuClose: Metro.noop,\n        onMenuCollapse: Metro.noop,\n        onMenuExpand: Metro.noop,\n        onAppBarCreate: Metro.noop\n    };\n\n    Metro.appBarSetup = function (options) {\n        AppBarDefaultConfig = $.extend({}, AppBarDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroAppBarSetup\"] !== undefined) {\n        Metro.appBarSetup(window[\"metroAppBarSetup\"]);\n    }\n\n    Metro.Component('app-bar', {\n        init: function (options, elem) {\n            this._super(elem, options, AppBarDefaultConfig, {\n                id: Utils.elementId('app-bar')\n            });\n\n            return this;\n        },\n\n        _create: function () {\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"app-bar-create\", {\n                element: element\n            })\n        },\n\n        _createStructure: function () {\n            var element = this.element, o = this.options;\n            var hamburger, menu, elementColor = Utils.getStyleOne(element, \"background-color\");\n\n            element.addClass(\"app-bar\");\n\n            hamburger = element.find(\".hamburger\");\n            if (hamburger.length === 0) {\n                hamburger = $(\"<button>\").attr(\"type\", \"button\").addClass(\"hamburger menu-down\");\n                for (var i = 0; i < 3; i++) {\n                    $(\"<span>\").addClass(\"line\").appendTo(hamburger);\n                }\n\n                if (elementColor === \"rgba(0, 0, 0, 0)\" || Metro.colors.isLight(elementColor) === true) {\n                    hamburger.addClass(\"dark\");\n                }\n            }\n\n            element.prepend(hamburger);\n            menu = element.find(\".app-bar-menu\");\n\n            if (menu.length === 0) {\n                hamburger.css(\"display\", \"none\");\n            } else {\n                Utils.addCssRule(Metro.sheet, \".app-bar-menu li\", \"list-style: none!important;\"); // This special for IE11 and Edge\n            }\n\n            if (hamburger.css('display') === 'block') {\n                menu.hide().addClass(\"collapsed\");\n                hamburger.removeClass(\"hidden\");\n            } else {\n                hamburger.addClass(\"hidden\");\n            }\n\n            if (o.expand === true) {\n                element.addClass(\"app-bar-expand\");\n                hamburger.addClass(\"hidden\");\n            } else {\n                if (Utils.isValue(o.expandPoint) && Utils.mediaExist(o.expandPoint)) {\n                    element.addClass(\"app-bar-expand\");\n                    hamburger.addClass(\"hidden\");\n                }\n            }\n        },\n\n        _createEvents: function () {\n            var that = this, element = this.element, o = this.options;\n            var menu = element.find(\".app-bar-menu\");\n            var hamburger = element.find(\".hamburger\");\n\n            element.on(Metro.events.click, \".hamburger\", function () {\n                if (menu.length === 0) return;\n                var collapsed = menu.hasClass(\"collapsed\");\n                if (collapsed) {\n                    that.open();\n                } else {\n                    that.close();\n                }\n            });\n\n            $(window).on(Metro.events.resize, function () {\n\n                if (o.expand !== true) {\n                    if (Utils.isValue(o.expandPoint) && Utils.mediaExist(o.expandPoint)) {\n                        element.addClass(\"app-bar-expand\");\n                        that._fireEvent(\"menu-expand\");\n                    } else {\n                        element.removeClass(\"app-bar-expand\");\n                        that._fireEvent(\"menu-collapse\");\n                    }\n                }\n\n                if (menu.length === 0) return;\n\n                if (hamburger.css('display') !== 'block') {\n                    menu.show(function () {\n                        $(this).removeStyleProperty(\"display\");\n                    });\n                    hamburger.addClass(\"hidden\");\n                } else {\n                    hamburger.removeClass(\"hidden\");\n                    if (hamburger.hasClass(\"active\")) {\n                        menu.show().removeClass(\"collapsed\");\n                    } else {\n                        menu.hide().addClass(\"collapsed\");\n                    }\n                }\n            }, {ns: this.id});\n        },\n\n        close: function () {\n            var that = this, element = this.element, o = this.options;\n            var menu = element.find(\".app-bar-menu\");\n            var hamburger = element.find(\".hamburger\");\n\n            that._fireEvent(\"before-menu-close\", {\n                menu: menu[0]\n            });\n\n            menu.slideUp(o.duration, function () {\n                menu.addClass(\"collapsed\").removeClass(\"opened\");\n                hamburger.removeClass(\"active\");\n\n                that._fireEvent(\"menu-close\", {\n                    menu: menu[0]\n                });\n            });\n        },\n\n        open: function () {\n            var that = this, element = this.element, o = this.options;\n            var menu = element.find(\".app-bar-menu\");\n            var hamburger = element.find(\".hamburger\");\n\n            that._fireEvent(\"before-menu-open\", {\n                menu: menu[0]\n            });\n\n            menu.slideDown(o.duration, function () {\n                menu.removeClass(\"collapsed\").addClass(\"opened\");\n                hamburger.addClass(\"active\");\n\n                that._fireEvent(\"menu-open\", {\n                    menu: menu[0]\n                });\n            });\n        },\n\n        /* eslint-disable-next-line */\n        changeAttribute: function (attributeName) {\n        },\n\n        destroy: function () {\n            var element = this.element;\n            element.off(Metro.events.click, \".hamburger\");\n            $(window).off(Metro.events.resize, {ns: this.id});\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var AudioButtonDefaultConfig = {\n        audioVolume: 0.5,\n        audioSrc: \"\",\n        onAudioStart: Metro.noop,\n        onAudioEnd: Metro.noop,\n        onAudioButtonCreate: Metro.noop\n    };\n\n    Metro.audioButtonSetup = function (options) {\n        AudioButtonDefaultConfig = $.extend({}, AudioButtonDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroAudioButtonSetup\"] !== undefined) {\n        Metro.audioButtonSetup(window[\"metroAudioButtonSetup\"]);\n    }\n\n    Metro.Component('audio-button', {\n        init: function( options, elem ) {\n\n            this._super(elem, options, AudioButtonDefaultConfig, {\n                audio: null,\n                canPlay: null,\n                id: Utils.elementId(\"audioButton\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent('audioButtonCreate', {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var o = this.options;\n            this.audio = new Audio(o.audioSrc);\n            this.audio.volume = o.audioVolume;\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var audio = this.audio;\n\n            audio.addEventListener('loadeddata', function(){\n                that.canPlay = true;\n            });\n\n            audio.addEventListener('ended', function(){\n                that._fireEvent(\"audioEnd\", {\n                    src: o.audioSrc,\n                    audio: audio\n                });\n            })\n\n            element.on(Metro.events.click, function(){\n                that.play();\n            }, {ns: this.id});\n        },\n\n        play: function(cb){\n            var element = this.element, o = this.options;\n            var audio = this.audio;\n\n            if (o.audioSrc !== \"\" && this.audio.duration && this.canPlay) {\n\n                this._fireEvent(\"audioStart\", {\n                    src: o.audioSrc,\n                    audio: audio\n                });\n\n                audio.pause();\n                audio.currentTime = 0;\n                audio.play();\n\n                Utils.exec(cb, [audio], element[0]);\n            }\n        },\n\n        stop: function(cb){\n            var element = this.element, o = this.options;\n            var audio = this.audio;\n\n            audio.pause();\n            audio.currentTime = 0;\n\n            this._fireEvent(\"audioEnd\", {\n                src: o.audioSrc,\n                audio: audio\n            });\n\n            Utils.exec(cb, [audio], element[0]);\n        },\n\n        changeAttribute: function(attributeName){\n            var element = this.element, o = this.options;\n            var audio = this.audio;\n\n            var changeSrc = function(){\n                var src = element.attr('data-audio-src');\n                if (src && src.trim() !== \"\") {\n                    o.audioSrc = src;\n                    audio.src = src;\n                }\n            }\n\n            var changeVolume = function(){\n                var volume = parseFloat(element.attr('data-audio-volume'));\n                if (isNaN(volume)) {\n                    return ;\n                }\n                o.audioVolume = volume;\n                audio.volume = volume;\n            }\n\n            if (attributeName === 'data-audio-src') {\n                changeSrc();\n            }\n\n            if (attributeName === 'data-audio-volume') {\n                changeVolume();\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n\n            element.off(Metro.events.click, {ns: this.id});\n        }\n    });\n\n    Metro[\"playSound\"] = function(data){\n        var audio;\n        var src = typeof data === \"string\" ? data : data.audioSrc;\n        var volume = data && data.audioVolume ? data.audioVolume : 0.5;\n\n        if (!src) {\n            return;\n        }\n\n        audio = new Audio(src);\n        audio.volume = parseFloat(volume);\n\n        audio.addEventListener('loadeddata', function(){\n            if (data && data.onAudioStart)\n                Utils.exec(data.onAudioStart, [src], this);\n            this.play();\n        });\n\n        audio.addEventListener('ended', function(){\n            if (data && data.onAudioEnd)\n                Utils.exec(data.onAudioEnd, [null], this);\n        });\n    };\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var AudioPlayerDefaultConfig = {\n        audioDeferred: 0,\n        playlist: null,\n        src: null,\n\n        volume: .5,\n        loop: false,\n        autoplay: false,\n\n        showLoop: true,\n        showPlay: true,\n        showStop: true,\n        showMute: true,\n        showFull: true,\n        showStream: true,\n        showVolume: true,\n        showInfo: true,\n\n        showPlaylist: true,\n        showNext: true,\n        showPrev: true,\n        showFirst: true,\n        showLast: true,\n        showForward: true,\n        showBackward: true,\n        showShuffle: true,\n        showRandom: true,\n\n        loopIcon: \"<span class='default-icon-loop'></span>\",\n        stopIcon: \"<span class='default-icon-stop'></span>\",\n        playIcon: \"<span class='default-icon-play'></span>\",\n        pauseIcon: \"<span class='default-icon-pause'></span>\",\n        muteIcon: \"<span class='default-icon-mute'></span>\",\n        volumeLowIcon: \"<span class='default-icon-low-volume'></span>\",\n        volumeMediumIcon: \"<span class='default-icon-medium-volume'></span>\",\n        volumeHighIcon: \"<span class='default-icon-high-volume'></span>\",\n\n        playlistIcon: \"<span class='default-icon-playlist'></span>\",\n        nextIcon: \"<span class='default-icon-next'></span>\",\n        prevIcon: \"<span class='default-icon-prev'></span>\",\n        firstIcon: \"<span class='default-icon-first'></span>\",\n        lastIcon: \"<span class='default-icon-last'></span>\",\n        forwardIcon: \"<span class='default-icon-forward'></span>\",\n        backwardIcon: \"<span class='default-icon-backward'></span>\",\n        shuffleIcon: \"<span class='default-icon-shuffle'></span>\",\n        randomIcon: \"<span class='default-icon-random'></span>\",\n\n        onPlay: Metro.noop,\n        onPause: Metro.noop,\n        onStop: Metro.noop,\n        onEnd: Metro.noop,\n        onMetadata: Metro.noop,\n        onTime: Metro.noop,\n        onAudioPlayerCreate: Metro.noop\n    };\n\n    Metro.audioPlayerSetup = function(options){\n        AudioPlayerDefaultConfig = $.extend({}, AudioPlayerDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroAudioPlayerSetup\"] !== undefined) {\n        Metro.audioPlayerSetup(window[\"metroAudioPlayerSetup\"]);\n    }\n\n    Metro.Component('audio-player', {\n        init: function( options, elem ) {\n            this._super(elem, options, AudioPlayerDefaultConfig, {\n                preloader: null,\n                player: null,\n                audio: elem,\n                stream: null,\n                volume: null,\n                volumeBackup: 0,\n                muted: false\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n\n            this._createPlayer();\n            this._createControls();\n            this._createEvents();\n\n            if (o.autoplay === true) {\n                this.play();\n            }\n\n            this._fireEvent(\"audio-player-create\", {\n                element: element,\n                player: this.player\n            })\n        },\n\n        _createPlayer: function(){\n            var element = this.element, o = this.options, audio = this.audio;\n\n            var prev = element.prev();\n            var parent = element.parent();\n            var player = $(\"<div>\").addClass(\"media-player audio-player \" + element[0].className);\n\n            if (prev.length === 0) {\n                parent.prepend(player);\n            } else {\n                player.insertAfter(prev);\n            }\n\n            element.appendTo(player);\n\n            $.each(['muted', 'autoplay', 'controls', 'height', 'width', 'loop', 'poster', 'preload'], function(){\n                element.removeAttr(this);\n            });\n\n            element.attr(\"preload\", \"auto\");\n\n            audio.volume = o.volume;\n\n            if (o.src !== null) {\n                this._setSource(o.src);\n            }\n\n            element[0].className = \"\";\n\n            this.player = player;\n        },\n\n        _setSource: function(src){\n            var element = this.element;\n\n            element.find(\"source\").remove();\n            element.removeAttr(\"src\");\n            if (Array.isArray(src)) {\n                $.each(src, function(){\n                    var item = this;\n                    if (item.src === undefined) return ;\n                    $(\"<source>\").attr('src', item.src).attr('type', item.type !== undefined ? item.type : '').appendTo(element);\n                });\n            } else {\n                element.attr(\"src\", src);\n            }\n        },\n\n        _createControls: function(){\n            var that = this, element = this.element, o = this.options, audio = this.elem;\n\n            var controls = $(\"<div>\").addClass(\"controls\").addClass(o.clsControls).insertAfter(element);\n\n\n            var stream = $(\"<div>\").addClass(\"stream\").appendTo(controls);\n            var streamSlider = $(\"<input>\").addClass(\"stream-slider ultra-thin cycle-marker\").appendTo(stream);\n            var preloader = $(\"<div>\").addClass(\"load-audio\").appendTo(stream);\n\n            var volume = $(\"<div>\").addClass(\"volume\").appendTo(controls);\n            var volumeSlider = $(\"<input>\").addClass(\"volume-slider ultra-thin cycle-marker\").appendTo(volume);\n\n            var infoBox = $(\"<div>\").addClass(\"info-box\").appendTo(controls);\n\n            if (o.showInfo !== true) {\n                infoBox.hide();\n            }\n\n            preloader.activity({\n                type: \"metro\",\n                style: \"color\"\n            });\n\n            preloader.hide(0);\n\n            this.preloader = preloader;\n\n            Metro.makePlugin(streamSlider, \"slider\", {\n                clsMarker: \"bg-red\",\n                clsHint: \"bg-cyan fg-white\",\n                clsComplete: \"bg-cyan\",\n                hint: true,\n                onStart: function(){\n                    if (!audio.paused) audio.pause();\n                },\n                onStop: function(val){\n                    if (audio.seekable.length > 0) {\n                        audio.currentTime = (that.duration * val / 100).toFixed(0);\n                    }\n                    if (audio.paused && audio.currentTime > 0) {\n                        audio.play();\n                    }\n                }\n            });\n\n            this.stream = streamSlider;\n\n            if (o.showStream !== true) {\n                stream.hide();\n            }\n\n            Metro.makePlugin(volumeSlider, \"slider\", {\n                clsMarker: \"bg-red\",\n                clsHint: \"bg-cyan fg-white\",\n                hint: true,\n                value: o.volume * 100,\n                onChangeValue: function(val){\n                    audio.volume = val / 100;\n                }\n            });\n\n            this.volume = volumeSlider;\n\n            if (o.showVolume !== true) {\n                volume.hide();\n            }\n\n            var loop;\n\n            if (o.showLoop === true) loop = $(\"<button>\").attr(\"type\", \"button\").addClass(\"button square loop\").html(o.loopIcon).appendTo(controls);\n            if (o.showPlay === true) $(\"<button>\").attr(\"type\", \"button\").addClass(\"button square play\").html(o.playIcon).appendTo(controls);\n            if (o.showStop === true) $(\"<button>\").attr(\"type\", \"button\").addClass(\"button square stop\").html(o.stopIcon).appendTo(controls);\n            if (o.showMute === true) $(\"<button>\").attr(\"type\", \"button\").addClass(\"button square mute\").html(o.muteIcon).appendTo(controls);\n\n            if (o.loop === true) {\n                loop.addClass(\"active\");\n                element.attr(\"loop\", \"loop\");\n            }\n\n            this._setVolume();\n\n            if (o.muted) {\n                that.volumeBackup = audio.volume;\n                Metro.getPlugin(that.volume, 'slider').val(0);\n                audio.volume = 0;\n            }\n\n            infoBox.html(\"00:00 / 00:00\");\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options, audio = this.elem, player = this.player;\n\n            element.on(\"loadstart\", function(){\n                that.preloader.fadeIn();\n            });\n\n            element.on(\"loadedmetadata\", function(){\n                that.duration = audio.duration.toFixed(0);\n                that._setInfo(0, that.duration);\n                Utils.exec(o.onMetadata, [audio, player], element[0]);\n            });\n\n            element.on(\"canplay\", function(){\n                that._setBuffer();\n                that.preloader.fadeOut();\n            });\n\n            element.on(\"progress\", function(){\n                that._setBuffer();\n            });\n\n            element.on(\"timeupdate\", function(){\n                var position = Math.round(audio.currentTime * 100 / that.duration);\n                that._setInfo(audio.currentTime, that.duration);\n                Metro.getPlugin(that.stream, 'slider').val(position);\n                Utils.exec(o.onTime, [audio.currentTime, that.duration, audio, player], element[0]);\n            });\n\n            element.on(\"waiting\", function(){\n                that.preloader.fadeIn();\n            });\n\n            element.on(\"loadeddata\", function(){\n\n            });\n\n            element.on(\"play\", function(){\n                player.find(\".play\").html(o.pauseIcon);\n                Utils.exec(o.onPlay, [audio, player], element[0]);\n            });\n\n            element.on(\"pause\", function(){\n                player.find(\".play\").html(o.playIcon);\n                Utils.exec(o.onPause, [audio, player], element[0]);\n            });\n\n            element.on(\"stop\", function(){\n                Metro.getPlugin(that.stream, 'slider').val(0);\n                Utils.exec(o.onStop, [audio, player], element[0]);\n            });\n\n            element.on(\"ended\", function(){\n                Metro.getPlugin(that.stream, 'slider').val(0);\n                Utils.exec(o.onEnd, [audio, player], element[0]);\n            });\n\n            element.on(\"volumechange\", function(){\n                that._setVolume();\n            });\n\n            player.on(Metro.events.click, \".play\", function(){\n                if (audio.paused) {\n                    that.play();\n                } else {\n                    that.pause();\n                }\n            });\n\n            player.on(Metro.events.click, \".stop\", function(){\n                that.stop();\n            });\n\n            player.on(Metro.events.click, \".mute\", function(){\n                that._toggleMute();\n            });\n\n            player.on(Metro.events.click, \".loop\", function(){\n                that._toggleLoop();\n            });\n        },\n\n        _toggleLoop: function(){\n            var loop = this.player.find(\".loop\");\n            if (loop.length === 0) return ;\n            loop.toggleClass(\"active\");\n            if (loop.hasClass(\"active\")) {\n                this.element.attr(\"loop\", \"loop\");\n            } else {\n                this.element.removeAttr(\"loop\");\n            }\n        },\n\n        _toggleMute: function(){\n            this.muted = !this.muted;\n            if (this.muted === false) {\n                this.audio.volume = this.volumeBackup;\n            } else {\n                this.volumeBackup = this.audio.volume;\n                this.audio.volume = 0;\n            }\n            Metro.getPlugin(this.volume, 'slider').val(this.muted === false ? this.volumeBackup * 100 : 0);\n        },\n\n        _setInfo: function(a, b){\n            this.player.find(\".info-box\").html(Utils.secondsToFormattedString(Math.round(a)) + \" / \" + Utils.secondsToFormattedString(Math.round(b)));\n        },\n\n        _setBuffer: function(){\n            var buffer = this.audio.buffered.length ? Math.round(Math.floor(this.audio.buffered.end(0)) / Math.floor(this.audio.duration) * 100) : 0;\n            Metro.getPlugin(this.stream, 'slider').buff(buffer);\n        },\n\n        _setVolume: function(){\n            var audio = this.audio, player = this.player, o = this.options;\n\n            var volumeButton = player.find(\".mute\");\n            var volume = audio.volume * 100;\n            if (volume > 1 && volume < 30) {\n                volumeButton.html(o.volumeLowIcon);\n            } else if (volume >= 30 && volume < 60) {\n                volumeButton.html(o.volumeMediumIcon);\n            } else if (volume >= 60 && volume <= 100) {\n                volumeButton.html(o.volumeHighIcon);\n            } else {\n                volumeButton.html(o.muteIcon);\n            }\n        },\n\n        play: function(src){\n            if (src !== undefined) {\n                this._setSource(src);\n            }\n\n            if (this.element.attr(\"src\") === undefined && this.element.find(\"source\").length === 0) {\n                return ;\n            }\n\n            this.audio.play();\n        },\n\n        pause: function(){\n            this.audio.pause();\n        },\n\n        resume: function(){\n            if (this.audio.paused) {\n                this.play();\n            }\n        },\n\n        stop: function(){\n            this.audio.pause();\n            this.audio.currentTime = 0;\n            Metro.getPlugin(this.stream, 'slider').val(0);\n        },\n\n        setVolume: function(v){\n            if (v === undefined) {\n                return this.audio.volume;\n            }\n\n            if (v > 1) {\n                v /= 100;\n            }\n\n            this.audio.volume = v;\n            Metro.getPlugin(this.volume, 'slider').val(v*100);\n        },\n\n        loop: function(){\n            this._toggleLoop();\n        },\n\n        mute: function(){\n            this._toggleMute();\n        },\n\n        changeSource: function(){\n            var src = JSON.parse(this.element.attr('data-src'));\n            this.play(src);\n        },\n\n        changeVolume: function(){\n            var volume = this.element.attr(\"data-volume\");\n            this.setVolume(volume);\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case \"data-src\": this.changeSource(); break;\n                case \"data-volume\": this.changeVolume(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element, player = this.player;\n\n            element.off(\"all\");\n            player.off(\"all\");\n\n            Metro.getPlugin(this.stream, \"slider\").destroy();\n            Metro.getPlugin(this.volume, \"slider\").destroy();\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var BottomSheetDefaultConfig = {\n        bottomsheetDeferred: 0,\n        mode: \"list\",\n        toggle: null,\n        onOpen: Metro.noop,\n        onClose: Metro.noop,\n        onBottomSheetCreate: Metro.noop\n    };\n\n    Metro.bottomSheetSetup = function(options){\n        BottomSheetDefaultConfig = $.extend({}, BottomSheetDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroBottomSheetSetup\"] !== undefined) {\n        Metro.bottomSheetSetup(window[\"metroBottomSheetSetup\"]);\n    }\n\n    Metro.Component('bottom-sheet', {\n        init: function( options, elem ) {\n            this._super(elem, options, BottomSheetDefaultConfig, {\n                toggle: null\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"bottom-sheet-create\", {\n                element: element\n            })\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n\n            element\n                .addClass(\"bottom-sheet\")\n                .addClass(o.mode+\"-list\");\n\n            if (Utils.isValue(o.toggle) && $(o.toggle).length > 0) {\n                this.toggle = $(o.toggle);\n            }\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element;\n\n            if (Utils.isValue(this.toggle)) {\n                this.toggle.on(Metro.events.click, function(){\n                    that.toggle();\n                });\n            }\n\n            element.on(Metro.events.click, \"li\", function(){\n                that.close();\n            });\n        },\n\n        isOpen: function(){\n            return this.element.hasClass(\"opened\");\n        },\n\n        open: function(mode){\n            var element = this.element;\n\n            if (Utils.isValue(mode)) {\n                element.removeClass(\"list-style grid-style\").addClass(mode+\"-style\");\n            }\n\n            this.element.addClass(\"opened\");\n\n            this._fireEvent(\"open\", {\n                element: element\n            })\n        },\n\n        close: function(){\n            var element = this.element;\n\n            element.removeClass(\"opened\");\n\n            this._fireEvent(\"close\", {\n                element: element\n            })\n        },\n\n        toggle: function(mode){\n            if (this.isOpen()) {\n                this.close();\n            } else {\n                this.open(mode);\n            }\n        },\n\n        /* eslint-disable-next-line */\n        changeAttribute: function(attributeName){\n        },\n\n        destroy: function(){\n            var element = this.element;\n\n            if (Utils.isValue(this.toggle)) {\n                this.toggle.off(Metro.events.click);\n            }\n\n            element.off(Metro.events.click, \"li\");\n            return element;\n        }\n    });\n\n    Metro['bottomsheet'] = {\n        isBottomSheet: function(el){\n            return Utils.isMetroObject(el, \"bottom-sheet\");\n        },\n\n        open: function(el, as){\n            if (!this.isBottomSheet(el)) {\n                return false;\n            }\n            Metro.getPlugin(el, \"bottom-sheet\").open(as);\n        },\n\n        close: function(el){\n            if (!this.isBottomSheet(el)) {\n                return false;\n            }\n            Metro.getPlugin(el, \"bottom-sheet\").close();\n        },\n\n        toggle: function(el, as){\n            if (!this.isBottomSheet(el)) {\n                return false;\n            }\n            if (this.isOpen(el)) {\n                this.close(el);\n            } else {\n                this.open(el, as);\n            }\n        },\n\n        isOpen: function(el){\n            if (!this.isBottomSheet(el)) {\n                return false;\n            }\n            return Metro.getPlugin(el, \"bottom-sheet\").isOpen();\n        }\n    };\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var ButtonGroupDefaultConfig = {\n        buttongroupDeferred: 0,\n        targets: \"button\",\n        clsActive: \"\",\n        requiredButton: false,\n        mode: Metro.groupMode.ONE,\n        onButtonClick: Metro.noop,\n        onButtonGroupCreate: Metro.noop\n    };\n\n    Metro.buttonGroupSetup = function(options){\n        ButtonGroupDefaultConfig = $.extend({}, ButtonGroupDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroButtonGroupSetup\"] !== undefined) {\n        Metro.buttonGroupSetup(window[\"metroButtonGroupSetup\"]);\n    }\n\n    Metro.Component('button-group', {\n        init: function( options, elem ) {\n            this._super(elem, options, ButtonGroupDefaultConfig, {\n                active: null,\n                id: Utils.elementId(\"button-group\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createGroup();\n            this._createEvents();\n\n            this._fireEvent(\"button-group-create\", {\n                element: element\n            })\n        },\n\n        _createGroup: function(){\n            var element = this.element, o = this.options;\n            var buttons, buttons_active;\n\n            element.addClass(\"button-group\");\n\n            buttons = element.find( o.targets );\n            buttons_active = element.find( \".active\" );\n\n            if (o.mode === Metro.groupMode.ONE && buttons_active.length === 0 && o.requiredButton === true) {\n                $(buttons[0]).addClass(\"active\");\n            }\n\n            if (o.mode === Metro.groupMode.ONE && buttons_active.length > 1) {\n                buttons.removeClass(\"active\").removeClass(o.clsActive);\n                $(buttons[0]).addClass(\"active\");\n            }\n\n            element\n                .find( \".active\" )\n                .addClass(\"js-active\")\n                .addClass(o.clsActive);\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n\n            element.on(Metro.events.click, o.targets, function(){\n                var el = $(this);\n\n                that._fireEvent(\"button-click\", {\n                    button: this\n                })\n\n                if (o.mode === Metro.groupMode.ONE && el.hasClass(\"active\")) {\n                    return ;\n                }\n\n                if (o.mode === Metro.groupMode.ONE) {\n                    element.find(o.targets).removeClass(o.clsActive).removeClass(\"active js-active\");\n                    el.addClass(\"active\").addClass(o.clsActive).addClass(\"js-active\");\n                } else {\n                    el.toggleClass(\"active\").toggleClass(o.clsActive).toggleClass(\"js-active\");\n                }\n\n            });\n        },\n\n        /* eslint-disable-next-line */\n        changeAttribute: function(attributeName){\n        },\n\n        destroy: function(){\n            var element = this.element, o = this.options;\n            element.off(Metro.events.click, o.targets);\n            return element;\n        }\n\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var CalendarDefaultConfig = {\n        showGhost: false,\n        events: null,\n        startContent: \"days\",\n        showTime: false,\n        initialTime: null,\n        initialHours: null,\n        initialMinutes: null,\n        labelTimeHours: null,\n        labelTimeMinutes: null,\n\n        animationContent: true,\n        animationSpeed: 10,\n\n        calendarDeferred: 0,\n        dayBorder: false,\n        excludeDay: null,\n        prevMonthIcon: \"<span class='default-icon-chevron-left'></span>\",\n        nextMonthIcon: \"<span class='default-icon-chevron-right'></span>\",\n        prevYearIcon: \"<span class='default-icon-chevron-left'></span>\",\n        nextYearIcon: \"<span class='default-icon-chevron-right'></span>\",\n        compact: false,\n        wide: false,\n        widePoint: null,\n        pickerMode: false,\n        show: null,\n        locale: METRO_LOCALE,\n        weekStart: METRO_WEEK_START,\n        outside: true,\n        buttons: 'cancel, today, clear, done',\n        yearsBefore: 100,\n        yearsAfter: 100,\n        headerFormat: \"dddd, MMM DD\",\n        showHeader: true,\n        showFooter: true,\n        showWeekNumber: false,\n\n        isDialog: false,\n        ripple: false,\n        rippleColor: \"#cccccc\",\n        exclude: null,\n        preset: null,\n        minDate: null,\n        maxDate: null,\n        weekDayClick: false,\n        weekNumberClick: false,\n        multiSelect: false,\n        special: null,\n        format: METRO_DATE_FORMAT,\n        inputFormat: null,\n\n        clsCalendar: \"\",\n        clsCalendarHeader: \"\",\n        clsCalendarContent: \"\",\n        clsCalendarFooter: \"\",\n        clsCalendarMonths: \"\",\n        clsCalendarYears: \"\",\n        clsToday: \"\",\n        clsSelected: \"\",\n        clsExcluded: \"\",\n        clsCancelButton: \"\",\n        clsTodayButton: \"\",\n        clsClearButton: \"\",\n        clsDoneButton: \"\",\n        clsEventCounter: \"\",\n        clsWeekend: \"\",\n        clsCurrentWeek: \"\",\n        clsCalendarTime: \"\",\n        clsTime: \"\",\n        clsTimeHours: \"\",\n        clsTimeMinutes: \"\",\n        clsTimeButton: \"\",\n        clsTimeButtonPlus: \"\",\n        clsTimeButtonMinus: \"\",\n        clsSpecial: \"\",\n        clsEvents: \"\",\n        clsEvent: \"\",\n\n        onCancel: Metro.noop,\n        onToday: Metro.noop,\n        onClear: Metro.noop,\n        onDone: Metro.noop,\n        onDayClick: Metro.noop,\n        onDrawDay: Metro.noop,\n        onDrawMonth: Metro.noop,\n        onDrawYear: Metro.noop,\n        onWeekDayClick: Metro.noop,\n        onWeekNumberClick: Metro.noop,\n        onMonthChange: Metro.noop,\n        onYearChange: Metro.noop,\n        onTimeChange: Metro.noop,\n        onHoursChange: Metro.noop,\n        onMinutesChange: Metro.noop,\n        onCalendarCreate: Metro.noop\n    };\n\n    Metro.calendarSetup = function (options) {\n        CalendarDefaultConfig = $.extend({}, CalendarDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroCalendarSetup\"] !== undefined) {\n        Metro.calendarSetup(window[\"metroCalendarSetup\"]);\n    }\n\n    Metro.Component('calendar', {\n        init: function( options, elem ) {\n\n            var now = datetime().align(\"day\");\n\n            this._super(elem, options, CalendarDefaultConfig, {\n                today: now,\n                show: now,\n                current: {\n                    year: now.year(),\n                    month: now.month(),\n                    day: now.day()\n                },\n                preset: [],\n                selected: [],\n                exclude: [],\n                special: [],\n                excludeDay: [],\n                events: [],\n                min: null,\n                max: null,\n                locale: null,\n                minYear: null,\n                maxYear: null,\n                id: Utils.elementId(\"calendar\"),\n                time: [datetime().hour(), datetime().minute()],\n                content: \"days\",\n                yearDistance: 11,\n                yearGroupStart: now.year()\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n\n            this.content = o.startContent;\n            this.minYear = this.current.year - this.options.yearsBefore;\n            this.maxYear = this.current.year + this.options.yearsAfter;\n\n            element.html(\"\").addClass(\"calendar \" + (o.compact === true ? \"compact\" : \"\")).addClass(o.clsCalendar);\n\n            if (Utils.isValue(o.initialTime)) {\n                this.time = o.initialTime.split(\":\");\n            }\n\n            if (Utils.isValue(o.initialHours) && Utils.between(o.initialHours, 0, 23, true)) {\n                this.time[0] = parseInt(o.initialHours);\n            }\n\n            if (Utils.isValue(o.initialMinutes) && Utils.between(o.initialMinutes, 0, 59, true)) {\n                this.time[1] = parseInt(o.initialMinutes);\n            }\n\n            if (o.dayBorder === true) {\n                element.addClass(\"day-border\");\n            }\n\n            if (Utils.isValue(o.excludeDay)) {\n                this.excludeDay = (\"\"+o.excludeDay).toArray(\",\", \"int\");\n            }\n\n            if (Utils.isValue(o.preset)) {\n                this._dates2array(o.preset, 'selected');\n            }\n\n            if (Utils.isValue(o.exclude)) {\n                this._dates2array(o.exclude, 'exclude');\n            }\n\n            if (Utils.isValue(o.special)) {\n                this._dates2array(o.special, 'special');\n            }\n\n            if (Utils.isValue(o.events)) {\n                this._dates2array(o.events, 'events');\n            }\n\n            if (o.buttons !== false) {\n                if (Array.isArray(o.buttons) === false) {\n                    o.buttons = o.buttons.split(\",\").map(function(item){\n                        return item.trim();\n                    });\n                }\n            }\n\n            this.min = o.minDate ? (o.inputFormat ? Datetime.from(o.minDate, o.inputFormat) : datetime(o.minDate)).align(\"day\") : null;\n            this.max = o.maxDate ? (o.inputFormat ? Datetime.from(o.maxDate, o.inputFormat) : datetime(o.maxDate)).align(\"day\") : null;\n\n            if (o.show) {\n                this.show = (!o.show ? datetime() : o.inputFormat ? Datetime.from(o.show, o.inputFormat) : datetime(o.show)).align(\"day\");\n                this.current = {\n                    year: this.show.year(),\n                    month: this.show.month(),\n                    day: this.show.day()\n                }\n            }\n\n            this.locale = Metro.locales[o.locale] !== undefined ? Metro.locales[o.locale] : Metro.locales[\"en-US\"];\n\n            this._drawCalendar();\n            this._createEvents();\n\n            if (o.wide === true) {\n                element.addClass(\"calendar-wide\");\n            } else {\n                if (!Utils.isNull(o.widePoint) && Utils.mediaExist(o.widePoint)) {\n                    element.addClass(\"calendar-wide\");\n                }\n            }\n\n\n            if (o.ripple === true && Utils.isFunc(element.ripple) !== false) {\n                element.ripple({\n                    rippleTarget: \".button, .prev-month, .next-month, .prev-year, .next-year, .day\",\n                    rippleColor: this.options.rippleColor\n                });\n            }\n\n            this._fireEvent(\"calendar-create\");\n        },\n\n        _dates2array: function(val, category){\n            var that = this, o = this.options;\n            var dates;\n\n            if (Utils.isNull(val)) {\n                return ;\n            }\n\n            dates = typeof val === 'string' ? val.toArray() : Array.isArray(val) ? val : [];\n\n            $.each(dates, function(){\n                var _d, date = this;\n\n                try {\n                    _d = (o.inputFormat ? Datetime.from(date, o.inputFormat) : datetime(date)).align('day').format('YYYY-MM-DD');\n                } catch (e) {\n                    return;\n                }\n\n                that[category].push(_d);\n            });\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n\n            $(window).on(Metro.events.resize, function(){\n                if (o.wide !== true) {\n                    if (!Utils.isNull(o.widePoint) && Utils.mediaExist(o.widePoint)) {\n                        element.addClass(\"calendar-wide\");\n                    } else {\n                        element.removeClass(\"calendar-wide\");\n                    }\n                }\n            }, {ns: this.id});\n\n            element.on(Metro.events.click, \".prev-year-group, .next-year-group\", function(){\n                if ($(this).hasClass(\"prev-year-group\")) {\n                    that.yearGroupStart -= that.yearDistance;\n                } else {\n                    that.yearGroupStart += that.yearDistance;\n                }\n                that._drawContent();\n            });\n\n            element.on(Metro.events.click, \".prev-month, .next-month, .prev-year, .next-year\", function(){\n                var new_date, el = $(this);\n\n                if (el.hasClass(\"prev-month\")) {\n                    new_date = datetime(that.current.year, that.current.month - 1, 1);\n                    if (new_date.year() < that.minYear) {\n                        return ;\n                    }\n                }\n                if (el.hasClass(\"next-month\")) {\n                    new_date = datetime(that.current.year, that.current.month + 1, 1);\n                    if (new_date.year() > that.maxYear) {\n                        return ;\n                    }\n                }\n                if (el.hasClass(\"prev-year\")) {\n                    new_date = datetime(that.current.year - 1, that.current.month, 1);\n                    if (new_date.year() < that.minYear) {\n                        return ;\n                    }\n                }\n                if (el.hasClass(\"next-year\")) {\n                    new_date = datetime(that.current.year + 1, that.current.month, 1);\n                    if (new_date.year() > that.maxYear) {\n                        return ;\n                    }\n                }\n\n                that.current = {\n                    year: new_date.year(),\n                    month: new_date.month(),\n                    day: new_date.day()\n                };\n\n                setTimeout(function(){\n                    that._drawContent();\n                    if (el.hasClass(\"prev-month\") || el.hasClass(\"next-month\")) {\n                        that._fireEvent(\"month-change\", {\n                            current: that.current\n                        });\n                    }\n                    if (el.hasClass(\"prev-year\") || el.hasClass(\"next-year\")) {\n                        that._fireEvent(\"year-change\", {\n                            current: that.current\n                        });\n                    }\n                }, o.ripple ? 300 : 1);\n            });\n\n            element.on(Metro.events.click, \".button.today\", function(){\n                that.toDay();\n                that._fireEvent(\"today\", {\n                    today: that.today.val(),\n                    time: that.time\n                });\n            });\n\n            element.on(Metro.events.click, \".button.clear\", function(){\n                var date = datetime();\n\n                that.selected = [];\n                that.time = [date.hour(), date.minute()];\n                that.yearGroupStart = date.year();\n                that._drawContent();\n                that._fireEvent(\"clear\");\n            });\n\n            element.on(Metro.events.click, \".button.cancel\", function(){\n                that._drawContent();\n                that._fireEvent(\"cancel\");\n            });\n\n            element.on(Metro.events.click, \".button.done\", function(){\n                that._drawContent();\n                that._fireEvent(\"done\", {\n                    selected: that.selected,\n                    time: that.time\n                });\n            });\n\n            if (o.weekDayClick === true) {\n                element.on(Metro.events.click, \".week-days .week-day\", function (e) {\n                    var day, index, days, ii = [];\n\n                    day = $(this);\n                    index = day.index();\n\n                    for (var i = 0; i < 7; i++) {\n                        ii.push(index);\n                        index += o.showWeekNumber ? 8 : 7;\n                    }\n\n                    if (o.multiSelect === true) {\n                        days = element.find(\".day\").filter(function(el){\n                            var $el = $(el);\n                            return ii.indexOf($el.index()) > -1 && !$el.hasClass(\"outside disabled excluded\");\n                        })\n\n                        $.each(days, function () {\n                            var $el = $(this);\n                            var day = $el.data('day');\n\n                            if (that.selected.indexOf(day) === -1) {\n                                that.selected.push(day);\n                                $el.addClass(\"selected\").addClass(o.clsSelected);\n                            } else {\n                                $el.removeClass(\"selected\").removeClass(o.clsSelected);\n                                Utils.arrayDelete(that.selected, day);\n                            }\n                        });\n                    }\n\n                    that._fireEvent(\"week-day-click\", {\n                        selected: that.selected,\n                        day: day[0]\n                    });\n\n                    e.preventDefault();\n                    e.stopPropagation();\n                });\n            }\n\n            if (o.weekNumberClick) {\n                element.on(Metro.events.click, \".week-number\", function (e) {\n                    var $el, wn, index, days;\n\n                    $el = $(this);\n                    wn = $el.text();\n                    index = $el.index();\n\n                    if (wn === \"#\") {\n                        return ;\n                    }\n\n                    if (o.multiSelect === true) {\n                        days = element.find(\".day\").filter(function(el){\n                            var $el = $(el);\n                            var elIndex = $el.index();\n                            return Utils.between(elIndex, index, index + 8, false) && !$el.hasClass(\"outside disabled excluded\");\n                        })\n\n                        $.each(days, function () {\n                            var $el = $(this);\n                            var day = $el.data('day');\n\n                            if (that.selected.indexOf(day) === -1) {\n                                that.selected.push(day);\n                                $el.addClass(\"selected\").addClass(o.clsSelected);\n                            } else {\n                                $el.removeClass(\"selected\").removeClass(o.clsSelected);\n                                Utils.arrayDelete(that.selected, day);\n                            }\n                        });\n                    }\n\n                    that._fireEvent(\"week-number-click\", {\n                        selected: that.selected,\n                        num: wn,\n                        numElement: $el[0]\n                    });\n\n                    e.preventDefault();\n                    e.stopPropagation();\n                });\n            }\n\n            element.on(Metro.events.click, \".day\", function(e){\n                var day = $(this);\n                var index, date;\n\n                date = day.data('day');\n                index = that.selected.indexOf(date);\n\n                if (day.hasClass(\"outside\")) {\n                    date = datetime(date);\n                    that.current = {\n                        year: date.year(),\n                        month: date.month(),\n                        day: date.day()\n                    };\n                    that._drawContent();\n\n                    that._fireEvent(\"month-change\", {\n                        current: that.current\n                    });\n\n                    return ;\n                }\n\n                if (!day.hasClass(\"disabled\")) {\n\n                    if (o.pickerMode === true) {\n                        that.selected = [date];\n                        that.today = datetime(date);\n                        that.current.year = that.today.year();\n                        that.current.month = that.today.month();\n                        that.current.day = that.today.day();\n                        that._drawHeader();\n                        that._drawContent();\n                    } else {\n                        if (index === -1) {\n                            if (o.multiSelect === false) {\n                                element.find(\".day\").removeClass(\"selected\").removeClass(o.clsSelected);\n                                that.selected = [];\n                            }\n                            that.selected.push(date);\n                            day.addClass(\"selected\").addClass(o.clsSelected);\n                        } else {\n                            day.removeClass(\"selected\").removeClass(o.clsSelected);\n                            Utils.arrayDelete(that.selected, date);\n                        }\n                    }\n\n                }\n\n                that._fireEvent(\"day-click\", {\n                    selected: that.selected,\n                    day: day[0],\n                    time: that.time\n                });\n\n                e.preventDefault();\n                e.stopPropagation();\n            });\n\n            element.on(Metro.events.click, \".curr-month\", function(e){\n                that.content = \"months\";\n                that._drawContent();\n\n                e.preventDefault();\n                e.stopPropagation();\n            });\n\n            element.on(Metro.events.click, \".month\", function(e){\n                that.current.month = parseInt($(this).attr(\"data-month\"));\n                that.content = \"days\";\n                that._drawContent();\n\n                that._fireEvent(\"month-change\", {\n                    current: that.current\n                });\n\n                e.preventDefault();\n                e.stopPropagation();\n            });\n\n            element.on(Metro.events.click, \".curr-year\", function(e){\n                if (that.content === \"years\") {\n                    return ;\n                }\n                that.content = \"years\";\n                that._drawContent();\n\n                e.preventDefault();\n                e.stopPropagation();\n            });\n\n            element.on(Metro.events.click, \".year\", function(e){\n                that.current.year = parseInt($(this).attr(\"data-year\"));\n                that.yearGroupStart = that.current.year;\n                that.content = \"months\";\n                that._drawContent();\n\n                that._fireEvent(\"year-change\", {\n                    current: that.current\n                });\n\n                e.preventDefault();\n                e.stopPropagation();\n            });\n        },\n\n        _drawHeader: function(){\n            var element = this.element, o = this.options;\n            var header = element.find(\".calendar-header\");\n\n            if (header.length === 0) {\n                header = $(\"<div>\").addClass(\"calendar-header\").addClass(o.clsCalendarHeader).appendTo(element);\n            }\n\n            header.html(\"\");\n\n            $(\"<div>\").addClass(\"header-year\").html(this.today.year()).appendTo(header);\n            $(\"<div>\").addClass(\"header-day\").html(this.today.format(o.headerFormat, o.locale)).appendTo(header);\n\n            if (o.showHeader === false) {\n                header.hide();\n            }\n        },\n\n        _drawFooter: function(){\n            var element = this.element, o = this.options;\n            var buttons_locale = this.locale['buttons'];\n            var footer = element.find(\".calendar-footer\");\n\n            if (o.buttons === false) {\n                return ;\n            }\n\n            if (footer.length === 0) {\n                footer = $(\"<div>\").addClass(\"calendar-footer\").addClass(o.clsCalendarFooter).appendTo(element);\n            }\n\n            footer.html(\"\");\n\n            $.each(o.buttons, function(){\n                var button = $(\"<button>\").attr(\"type\", \"button\").addClass(\"button \" + this + \" \" + o['cls'+Cake.capitalize(this)+'Button']).html(buttons_locale[this]).appendTo(footer);\n                if (this === 'cancel' || this === 'done') {\n                    button.addClass(\"js-dialog-close\");\n                }\n            });\n\n            if (o.showFooter === false) {\n                footer.hide();\n            }\n        },\n\n        _drawTime: function(){\n            var that = this, element = this.element, o = this.options;\n            var calendarContent = element.find(\".calendar-content\");\n            var time = $(\"<div>\").addClass(\"calendar-time\").addClass(o.clsCalendarTime).appendTo(calendarContent);\n            var inner, hours, minutes, row;\n            var h = \"\"+this.time[0];\n            var m = \"\"+this.time[1];\n            var locale = this.locale['calendar']['time'];\n\n            var onChange = function(val){\n                var value = parseInt(val);\n                if ($(this).attr(\"data-time-part\") === \"hours\") {\n                    that.time[0] = value;\n                    that._fireEvent(\"hours-change\", {\n                        time: that.time,\n                        hours: value\n                    });\n                } else {\n                    that.time[1] = value;\n                    that._fireEvent(\"minutes-change\", {\n                        time: that.time,\n                        minutes: value\n                    });\n                }\n\n                that._fireEvent(\"time-change\", {\n                    time: that.time\n                });\n            }\n\n            time.append( inner = $(\"<div>\").addClass(\"calendar-time__inner\") );\n\n            inner.append( row = $(\"<div>\").addClass(\"calendar-time__inner-row\") );\n            row.append( $(\"<div>\").addClass(\"calendar-time__inner-cell\").append( $(\"<span>\").html(o.labelTimeHours || locale['hours']) ));\n            row.append( $(\"<div>\").addClass(\"calendar-time__inner-cell\").append( $(\"<span>\").html(o.labelTimeMinutes || locale['minutes']) ));\n\n            time.append( inner = $(\"<div>\").addClass(\"calendar-time__inner spinners\").addClass(o.clsTime) );\n            inner.append( hours = $(\"<input type='text' data-cls-spinner-input='\"+o.clsTimeHours+\"' data-time-part='hours' data-buttons-position='right' data-min-value='0' data-max-value='23'>\").addClass(\"hours\").addClass(o.compact ? \"input-small\" : \"input-normal\") );\n            inner.append( minutes = $(\"<input type='text' data-cls-spinner-input='\"+o.clsTimeMinutes+\"' data-time-part='minutes' data-buttons-position='right' data-min-value='0' data-max-value='59'>\").addClass(\"minutes\").addClass(o.compact ? \"input-small\" : \"input-normal\") );\n\n            h = Cake.lpad(h, 2, \"0\");\n            m = Cake.lpad(m, 2, \"0\");\n\n            hours.val(h);\n            minutes.val(m);\n\n            Metro.makePlugin(inner.find(\"input[type=text]\"), \"spinner\", {\n                onChange: onChange,\n                clsSpinnerButton: o.clsTimeButton,\n                clsSpinnerButtonPlus: o.clsTimeButtonPlus,\n                clsSpinnerButtonMinus: o.clsTimeButtonMinus\n            });\n\n            if (o.showTime === false) {\n                time.hide();\n            }\n        },\n\n        _drawContentDays: function(){\n            var that = this, element = this.element, o = this.options;\n            var content = element.find(\".calendar-content\"), toolbar, weekDays, calendarDays;\n            var calendar = datetime(this.current.year, this.current.month, this.current.day).useLocale(o.locale).calendar(o.weekStart);\n            var locale = Datetime.getLocale(o.locale);\n            var showDay = this.show.format(\"YYYY-MM-DD\");\n            var now = datetime();\n\n            if (content.length === 0) {\n                content = $(\"<div>\").addClass(\"calendar-content\").addClass(o.clsCalendarContent).appendTo(element);\n            }\n\n            if (o.showWeekNumber) {\n                content.addClass(\"-week-numbers\");\n            }\n\n            content.empty();\n\n            toolbar = $(\"<div>\").addClass(\"calendar-toolbar\").appendTo(content);\n\n            $(\"<span>\").addClass(\"prev-month\").html(o.prevMonthIcon).appendTo(toolbar);\n            $(\"<span>\").addClass(\"curr-month\").html(locale['months'][this.current.month]).appendTo(toolbar);\n            $(\"<span>\").addClass(\"next-month\").html(o.nextMonthIcon).appendTo(toolbar);\n\n            $(\"<span>\").addClass(\"prev-year\").html(o.prevYearIcon).appendTo(toolbar);\n            $(\"<span>\").addClass(\"curr-year\").html(this.current.year).appendTo(toolbar);\n            $(\"<span>\").addClass(\"next-year\").html(o.nextYearIcon).appendTo(toolbar);\n\n            weekDays = $(\"<div>\").addClass(\"week-days\").appendTo(content);\n            if (o.showWeekNumber) {\n                $(\"<span>\").addClass(\"week-number\").html(\"#\").appendTo(weekDays);\n            }\n            $.each(calendar['weekdays'], function(){\n                $(\"<span>\").addClass(\"week-day\").html(this).appendTo(weekDays);\n            });\n\n            calendarDays = $(\"<div>\").addClass(\"days\").appendTo(content);\n\n            $.each(calendar['days'], function(i){\n                var day = this;\n                var date = datetime(day).align('day');\n                var outsideDate = date.month() !== that.current.month;\n\n                if (o.showWeekNumber && i % 7 === 0) {\n                    $(\"<span>\").addClass(\"week-number\").html(date.weekNumber(o.weekStart)).appendTo(calendarDays);\n                }\n\n                var cell = $(\"<span>\").addClass(\"day\").html(date.day()).appendTo(calendarDays);\n\n                cell.data('day', day);\n\n                if (day === showDay) {\n                    cell.addClass(\"showed\");\n                }\n\n                if (outsideDate) {\n                    cell.addClass(\"outside\");\n                    if (!o.outside) {\n                        cell.empty();\n                    }\n                }\n\n                if (day === calendar['today']) {\n                    cell.addClass(\"today\")\n                }\n\n                if (o.showGhost && date.day() === now.day()) {\n                    cell.addClass(\"coincidental\");\n                }\n\n                if (that.special.length) {\n                    if (that.special.indexOf(day) === -1) {\n                        cell.addClass(\"disabled excluded\").addClass(o.clsExcluded);\n                    } else {\n                        cell.addClass(o.clsSpecial);\n                    }\n                } else {\n                    if (that.selected.indexOf(day) > -1) {\n                        cell.addClass(\"selected\").addClass(o.clsSelected);\n                    }\n                    if (that.exclude.indexOf(day) > -1) {\n                        cell.addClass(\"disabled excluded\").addClass(o.clsExcluded);\n                    }\n                    if (that.min && date.older(that.min)) {\n                        cell.addClass(\"disabled excluded\").addClass(o.clsExcluded);\n                    }\n                    if (that.max && date.younger(that.max)) {\n                        cell.addClass(\"disabled excluded\").addClass(o.clsExcluded);\n                    }\n                }\n\n                if (calendar['weekends'].indexOf(day) !== -1) {\n                    cell.addClass(o.clsWeekend);\n                }\n\n                if (calendar['week'].indexOf(day) !== -1) {\n                    cell.addClass(o.clsCurrentWeek);\n                }\n\n                if (that.events.length) {\n                    var events = $(\"<div>\").addClass(\"events\").addClass(o.clsEvents).appendTo(cell);\n                    $.each(that.events, function(){\n                        if (this === day) {\n                            var event = $(\"<div>\").addClass(\"event\").addClass(o.clsEvent).appendTo(events);\n                            if (!o.clsEvent) {\n                                event.css({\n                                    backgroundColor: Metro.colors.random()\n                                })\n                            }\n                        }\n                    })\n                }\n\n                if (o.animationContent) {\n                    cell.addClass(\"to-animate\");\n                }\n\n                that._fireEvent(\"draw-day\", {\n                    date: date.val(),\n                    day: date.day(),\n                    month: date.month(),\n                    year: date.year(),\n                    cell: cell[0]\n                });\n            });\n\n            this._drawTime();\n            this._animateContent(\".day\");\n        },\n\n        _drawContentMonths: function(){\n            var element = this.element, o = this.options;\n            var content = element.find(\".calendar-content\");\n            var locale = this.locale['calendar']['months'];\n            var toolbar, months, month, yearToday = datetime().year(), monthToday = datetime().month();\n\n            if (content.length === 0) {\n                content = $(\"<div>\").addClass(\"calendar-content\").addClass(o.clsCalendarContent).appendTo(element);\n            }\n\n            content.clear();\n\n            toolbar = $(\"<div>\").addClass(\"calendar-toolbar\").appendTo(content);\n\n            /**\n             * Calendar toolbar\n             */\n\n            $(\"<span>\").addClass(\"prev-year\").html(o.prevYearIcon).appendTo(toolbar);\n            $(\"<span>\").addClass(\"curr-year\").html(this.current.year).appendTo(toolbar);\n            $(\"<span>\").addClass(\"next-year\").html(o.nextYearIcon).appendTo(toolbar);\n\n            content.append( months = $(\"<div>\").addClass(\"months\") );\n\n            for(var i = 12; i < 24; i++) {\n                months.append(\n                    month = $(\"<div>\")\n                        .attr(\"data-month\", i - 12)\n                        .addClass(\"month\")\n                        .addClass(i - 12 === monthToday && this.current.year === yearToday ? \"today\" : \"\")\n                        .html(locale[i])\n                );\n\n                if (o.animationContent) {\n                    month.addClass(\"to-animate\");\n                }\n\n                this._fireEvent(\"draw-month\", {\n                    month: i - 12,\n                    year: this.current.year,\n                    cell: month[0]\n                });\n            }\n\n            this._animateContent(\".months .month\");\n        },\n\n        _drawContentYears: function(){\n            var element = this.element, o = this.options;\n            var content = element.find(\".calendar-content\");\n            var toolbar, years, year;\n\n            if (content.length === 0) {\n                content = $(\"<div>\").addClass(\"calendar-content\").addClass(o.clsCalendarContent).appendTo(element);\n            }\n\n            content.clear();\n\n            toolbar = $(\"<div>\").addClass(\"calendar-toolbar\").appendTo(content);\n\n            /**\n             * Calendar toolbar\n             */\n\n            $(\"<span>\").addClass(\"prev-year-group\").html(o.prevYearIcon).appendTo(toolbar);\n            $(\"<span>\").addClass(\"curr-year\").html(this.yearGroupStart + \" - \" + (this.yearGroupStart + this.yearDistance)).appendTo(toolbar);\n            $(\"<span>\").addClass(\"next-year-group\").html(o.nextYearIcon).appendTo(toolbar);\n\n            content.append( years = $(\"<div>\").addClass(\"years\") );\n\n            for(var i = this.yearGroupStart; i <= this.yearGroupStart + this.yearDistance; i++) {\n                years.append(\n                    year = $(\"<div>\")\n                        .attr(\"data-year\", i)\n                        .addClass(\"year\")\n                        .addClass(i === this.current.year ? \"today\" : \"\")\n                        .html(i)\n                );\n\n                if (o.animationContent) {\n                    year.addClass(\"to-animate\");\n                }\n\n                if (i < o.minYear || i > o.maxYear) {\n                    year.addClass(\"disabled\");\n                }\n\n                this._fireEvent(\"draw-year\", {\n                    year: i,\n                    cell: year[0]\n                });\n            }\n\n            this._animateContent(\".years .year\");\n        },\n\n        _drawContent: function(){\n            switch (this.content) {\n                case \"years\": this._drawContentYears(); break;\n                case \"months\": this._drawContentMonths(); break;\n                default: this._drawContentDays();\n            }\n        },\n\n        _drawCalendar: function(){\n            var that = this;\n            setTimeout(function(){\n                that.element.html(\"\");\n                that._drawHeader();\n                that._drawContent();\n                that._drawFooter();\n            }, 0);\n        },\n\n        _animateContent: function(target, cls){\n            var element = this.element, o = this.options;\n            var content = element.find(\".calendar-content\");\n\n            cls = cls || \"to-animate\";\n\n            content.find(target).each(function(k){\n                var day = $(this);\n                setTimeout(function(){\n                    day.removeClass(cls);\n                }, o.animationSpeed * k);\n            });\n        },\n\n        getTime: function(asString){\n            var h, m;\n\n            asString = asString || false;\n\n            h = Cake.lpad(this.time[0], 2, \"0\");\n            m = Cake.lpad(this.time[1], 2, \"0\");\n\n            return asString ? h +\":\"+ m : this.time;\n        },\n\n        setTime: function(time){\n            if (Array.isArray(time)) {\n                this.time = time;\n            } else {\n                this.time = time.split(\":\");\n            }\n            this._drawCalendar();\n        },\n\n        getPreset: function(){\n            return this.preset;\n        },\n\n        getSelected: function(){\n            return this.selected;\n        },\n\n        getExcluded: function(){\n            return this.exclude;\n        },\n\n        getToday: function(){\n            return this.today;\n        },\n\n        getCurrent: function(){\n            return this.current;\n        },\n\n        clearSelected: function(){\n            this.selected = [];\n            this._drawContent();\n        },\n\n        toDay: function(){\n            this.today = datetime().align(\"day\");\n            this.current = {\n                year: this.today.year(),\n                month: this.today.month(),\n                day: this.today.day()\n            };\n            this.time = [datetime().hour(), datetime().minute()];\n            this.yearGroupStart = datetime().year();\n            this.content = \"days\";\n            this._drawHeader();\n            this._drawContent();\n        },\n\n        setExclude: function(exclude){\n            var element = this.element, o = this.options;\n            if (Utils.isNull(exclude) && Utils.isNull(element.attr(\"data-exclude\"))) {\n                return ;\n            }\n            o.exclude = !Utils.isNull(exclude) ? exclude : element.attr(\"data-exclude\");\n            this._dates2array(o.exclude, 'exclude');\n            this._drawContent();\n        },\n\n        setPreset: function(preset){\n            var element = this.element, o = this.options;\n            if (Utils.isNull(preset) && Utils.isNull(element.attr(\"data-preset\"))) {\n                return ;\n            }\n\n            o.preset = !Utils.isNull(preset) ? preset : element.attr(\"data-preset\");\n\n            this._dates2array(o.preset, 'selected');\n            this._drawContent();\n        },\n\n        setSpecial: function(special){\n            var element = this.element, o = this.options;\n            if (Utils.isNull(special) && Utils.isNull(element.attr(\"data-special\"))) {\n                return ;\n            }\n            o.special = !Utils.isNull(special) ? special : element.attr(\"data-special\");\n            this._dates2array(o.exclude, 'special');\n            this._drawContent();\n        },\n\n        showDate: function(date){\n            return this.setShow(date);\n        },\n\n        setShow: function(show){\n            var element = this.element, o = this.options;\n            var attr = element.attr(\"data-show\");\n\n            if (!show && !attr) {\n                return ;\n            }\n\n            o.show = show ? show : attr;\n\n            if (!o.show) {\n                this.show = datetime();\n            } else {\n                if (typeof o.show === \"string\" && o.inputFormat) {\n                    this.show = Datetime.from(o.show, o.inputFormat);\n                } else {\n                    this.show = datetime(o.show);\n                }\n            }\n\n            this.show = this.show.align(\"day\");\n\n            this.current = {\n                year: this.show.year(),\n                month: this.show.month(),\n                day: this.show.day()\n            }\n\n            this._drawContent();\n        },\n\n        setMinDate: function(date){\n            var element = this.element, o = this.options;\n            var attr = element.attr(\"data-min-date\");\n\n            if (!date && !attr) {\n                return ;\n            }\n\n            o.minDate = date ? date : attr;\n\n            this.min = o.minDate ? (o.inputFormat ? Datetime.from(o.minDate, o.inputFormat) : datetime(o.minDate)).align(\"day\") : null;\n\n            this._drawContent();\n        },\n\n        setMaxDate: function(date){\n            var element = this.element, o = this.options;\n            var attr = element.attr(\"data-max-date\");\n\n            o.maxDate = date ? date : attr;\n\n            this.max = o.maxDate ? (o.inputFormat ? Datetime.from(o.maxDate, o.inputFormat) : datetime(o.maxDate)).align(\"day\") : null;\n\n            this._drawContent();\n        },\n\n        i18n: function(val){\n            var o = this.options;\n            if (val === undefined) {\n                return o.locale;\n            }\n            if (Metro.locales[val] === undefined) {\n                return false;\n            }\n            o.locale = val;\n            this.locale = Metro.locales[o.locale];\n            this._drawCalendar();\n        },\n\n        changeAttrLocale: function(){\n            var element = this.element;\n            this.i18n(element.attr(\"data-locale\"));\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case 'data-exclude': this.setExclude(); break;\n                case 'data-preset': this.setPreset(); break;\n                case 'data-special': this.setSpecial(); break;\n                case 'data-show': this.setShow(); break;\n                case 'data-min-date': this.setMinDate(); break;\n                case 'data-max-date': this.setMaxDate(); break;\n                case 'data-locale': this.changeAttrLocale(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element, o = this.options;\n\n            element.off(Metro.events.click, \".prev-month, .next-month, .prev-year, .next-year\");\n            element.off(Metro.events.click, \".button.today\");\n            element.off(Metro.events.click, \".button.clear\");\n            element.off(Metro.events.click, \".button.cancel\");\n            element.off(Metro.events.click, \".button.done\");\n            element.off(Metro.events.click, \".week-days .day\");\n            element.off(Metro.events.click, \".days-row .day\");\n            element.off(Metro.events.click, \".curr-month\");\n            element.off(Metro.events.click, \".calendar-months li\");\n            element.off(Metro.events.click, \".curr-year\");\n            element.off(Metro.events.click, \".calendar-years li\");\n            element.off(Metro.events.click);\n\n            if (o.ripple === true) {\n                element.data(\"ripple\").destroy();\n            }\n\n            $(window).off(Metro.events.resize, {ns: this.id});\n\n            return element;\n        }\n    });\n\n    $(document).on(Metro.events.click, function(){\n        $('.calendar .calendar-years').each(function(){\n            $(this).removeClass(\"open\");\n        });\n        $('.calendar .calendar-months').each(function(){\n            $(this).removeClass(\"open\");\n        });\n    });\n\n    Metro.defaults.Calendar = CalendarDefaultConfig;\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var CalendarPickerDefaultConfig = {\n        label: \"\",\n        value: '',\n        calendarpickerDeferred: 0,\n        nullValue: true,\n        useNow: false,\n        prepend: \"\",\n        dialogMode: false,\n        dialogPoint: 640,\n        dialogOverlay: true,\n        overlayColor: '#000000',\n        overlayAlpha: .5,\n        locale: METRO_LOCALE,\n        size: \"100%\",\n        format: METRO_DATE_FORMAT,\n        inputFormat: null,\n        clearButton: false,\n        calendarButtonIcon: \"<span class='default-icon-calendar'></span>\",\n        clearButtonIcon: \"<span class='default-icon-cross'></span>\",\n        copyInlineStyles: false,\n        clsPicker: \"\",\n        clsInput: \"\",\n        clsPrepend: \"\",\n        clsLabel: \"\",\n        onDayClick: Metro.noop,\n        onCalendarPickerCreate: Metro.noop,\n        onCalendarShow: Metro.noop,\n        onCalendarHide: Metro.noop,\n        onChange: Metro.noop,\n        onPickerChange: Metro.noop,\n        onMonthChange: Metro.noop,\n        onYearChange: Metro.noop\n    };\n\n    Metro.calendarPickerSetup = function (options) {\n        CalendarPickerDefaultConfig = $.extend({}, CalendarPickerDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroCalendarPickerSetup\"] !== undefined) {\n        Metro.calendarPickerSetup(window[\"metroCalendarPickerSetup\"]);\n    }\n\n    Metro.Component('calendar-picker', {\n        init: function( options, elem ) {\n            this._super(elem, options, $.extend({}, Metro.defaults.Calendar, {\n            }, CalendarPickerDefaultConfig), {\n                value: null,\n                value_date: null,\n                calendar: null,\n                overlay: null,\n                id: Utils.elementId(\"calendar-picker\"),\n                time: [datetime().hour(), datetime().minute()]\n            });\n\n            return this;\n        },\n\n        _create: function(){\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"calendar-picker-create\", {\n                element: this.element\n            });\n        },\n\n        _createStructure: function(){\n            var that = this, element = this.element, o = this.options;\n            var container = $(\"<div>\").addClass(\"input \" + element[0].className + \" calendar-picker\");\n            var buttons = $(\"<div>\").addClass(\"button-group\");\n            var calendarButton, clearButton, cal = $(\"<div>\").addClass(\"drop-shadow\");\n            var curr, _curr, initTime, initHours, initMinutes, elementValue, h, m;\n            var body = $(\"body\");\n\n            element.attr(\"type\", \"text\");\n            element.attr(\"autocomplete\", \"off\");\n            element.attr(\"readonly\", true);\n\n            if (Utils.isValue(o.initialTime)) {\n                this.time = o.initialTime.trim().split(\":\");\n            }\n\n            if (Utils.isValue(o.initialHours)) {\n                this.time[0] = parseInt(o.initialHours);\n            }\n\n            if (Utils.isValue(o.initialHours)) {\n                this.time[1] = parseInt(o.initialMinutes);\n            }\n\n            curr = (\"\"+o.value).trim() !== '' ? o.value : element.val().trim();\n\n            if (!Utils.isValue(curr)) {\n                if (o.useNow) {\n                    this.value = datetime();\n                    this.time = [this.value.hour(), this.value.minute()];\n                }\n            } else {\n                _curr = curr.split(\" \");\n                this.value = (!o.inputFormat ? datetime(_curr[0]) : Datetime.from(_curr[0], o.inputFormat, o.locale)).align(\"day\");\n                if (_curr[1]) {\n                    this.time = _curr[1].trim().split(\":\");\n                }\n            }\n\n            elementValue = !curr && o.nullValue === true ? \"\" : datetime(that.value).format(o.format, o.locale);\n\n            if (o.showTime && this.time && elementValue) {\n                h = Cake.lpad(this.time[0], 2, \"0\");\n                m = Cake.lpad(this.time[1], 2, \"0\");\n                elementValue += \" \" + h + \":\" + m;\n            }\n\n            element.val(elementValue);\n\n            container.insertBefore(element);\n            element.appendTo(container);\n            buttons.appendTo(container);\n            cal.appendTo(o.dialogMode ? body : container);\n\n            if (this.time && this.time.length) {\n                initHours = this.time[0];\n                if (typeof this.time[1] !== \"undefined\")\n                    initMinutes = this.time[1];\n            }\n\n            initTime = o.initialTime;\n\n            if (o.initialHours) {\n                initHours = o.initialHours;\n            }\n\n            if (o.initialHours) {\n                initMinutes = o.initialMinutes;\n            }\n\n            Metro.makePlugin(cal, \"calendar\", {\n                showTime: o.showTime,\n                initialTime: initTime,\n                initialHours: initHours,\n                initialMinutes: initMinutes,\n                clsCalendarTime: o.clsCalendarTime,\n                clsTime: o.clsTime,\n                clsTimeHours: o.clsTimeHours,\n                clsTimeMinutes: o.clsTimeMinutes,\n                clsTimeButton: o.clsTimeButton,\n                clsTimeButtonPlus: o.clsTimeButtonPlus,\n                clsTimeButtonMinus: o.clsTimeButtonMinus,\n\n                wide: o.wide,\n                widePoint: o.widePoint,\n\n                format: o.format,\n                inputFormat: o.inputFormat,\n                pickerMode: true,\n                show: o.value,\n                locale: o.locale,\n                weekStart: o.weekStart,\n                outside: o.outside,\n                buttons: false,\n                headerFormat: o.headerFormat,\n\n                clsCalendar: [o.clsCalendar, \"calendar-for-picker\", (o.dialogMode ? \"dialog-mode\":\"\")].join(\" \"),\n                clsCalendarHeader: o.clsCalendarHeader,\n                clsCalendarContent: o.clsCalendarContent,\n                clsCalendarFooter: \"d-none\",\n                clsCalendarMonths: o.clsCalendarMonths,\n                clsCalendarYears: o.clsCalendarYears,\n                clsToday: o.clsToday,\n                clsSelected: o.clsSelected,\n                clsExcluded: o.clsExcluded,\n\n                ripple: o.ripple,\n                rippleColor: o.rippleColor,\n                exclude: o.exclude,\n                minDate: o.minDate,\n                maxDate: o.maxDate,\n                yearsBefore: o.yearsBefore,\n                yearsAfter: o.yearsAfter,\n                special: o.special,\n                events: o.events,\n                showHeader: false,\n                showFooter: false,\n                multiSelect: false,\n                showWeekNumber: o.showWeekNumber,\n                onDayClick: function(sel, day, time, el){\n                    var date = datetime(sel[0]).align(\"day\");\n                    var elementValue, h, m;\n\n                    that._removeOverlay();\n\n                    that.value = date;\n                    that.time = time;\n\n                    elementValue = date.format(o.format, o.locale);\n\n                    if (o.showTime) {\n                        h = Cake.lpad(time[0], 2, \"0\");\n                        m = Cake.lpad(time[1], 2, \"0\");\n                        elementValue += \" \" + h + \":\" + m;\n                    }\n\n                    element.val(elementValue);\n                    element.trigger(\"change\");\n                    cal.removeClass(\"open open-up\");\n                    cal.hide();\n\n                    that._fireEvent(\"change\", {\n                        val: that.value.val(),\n                        time: that.time\n                    });\n\n                    that._fireEvent(\"day-click\", {\n                        sel: sel,\n                        day: day,\n                        time: time,\n                        el: el\n                    });\n\n                    that._fireEvent(\"picker-change\", {\n                        val: that.value.val(),\n                        time: that.time\n                    });\n                },\n                onTimeChange: function(time){\n                    var elementValue, h, m;\n\n                    that.time = time;\n\n                    if (!that.value) {\n                        that.value = datetime();\n                    }\n                    elementValue = that.value.format(o.format, o.locale);\n\n                    if (o.showTime) {\n                        h = Cake.lpad(time[0], 2, \"0\");\n                        m = Cake.lpad(time[1], 2, \"0\");\n                        elementValue += \" \" + h + \":\" + m;\n                    }\n\n                    element.val(elementValue);\n\n                    that._fireEvent(\"change\", {\n                        val: that.value.val(),\n                        time: that.time\n                    });\n\n                    that._fireEvent(\"picker-change\", {\n                        val: that.value.val(),\n                        time: that.time\n                    });\n                },\n                onMonthChange: o.onMonthChange,\n                onYearChange: o.onYearChange\n            });\n\n            this.calendar = cal;\n\n            if (o.clearButton === true) {\n                clearButton = $(\"<button>\").addClass(\"button input-clear-button\").attr(\"tabindex\", -1).attr(\"type\", \"button\").html(o.clearButtonIcon);\n                clearButton.appendTo(buttons);\n            }\n\n            calendarButton = $(\"<button>\").addClass(\"button\").attr(\"tabindex\", -1).attr(\"type\", \"button\").html(o.calendarButtonIcon);\n            calendarButton.appendTo(buttons);\n\n            if (o.prepend !== \"\") {\n                var prepend = $(\"<div>\").html(o.prepend);\n                prepend.addClass(\"prepend\").addClass(o.clsPrepend).appendTo(container);\n            }\n\n            if (element.attr('dir') === 'rtl' ) {\n                container.addClass(\"rtl\");\n            }\n\n            if (String(o.size).indexOf(\"%\") > -1) {\n                container.css({\n                    width: o.size\n                });\n            } else {\n                container.css({\n                    width: parseInt(o.size) + \"px\"\n                });\n            }\n\n            element[0].className = '';\n\n            if (o.copyInlineStyles === true) {\n                $.each(Utils.getInlineStyles(element), function(key, value){\n                    container.css(key, value);\n                });\n            }\n\n            container.addClass(o.clsPicker);\n            element.addClass(o.clsInput);\n\n            if (o.dialogOverlay === true) {\n                this.overlay = that._overlay();\n            }\n\n            if (o.dialogMode === true) {\n                container.addClass(\"dialog-mode\");\n            } else {\n                if (Utils.media(\"(max-width: \"+o.dialogPoint+\"px)\")) {\n                    container.addClass(\"dialog-mode\");\n                    this.calendar.addClass(\"dialog-mode\");\n                }\n            }\n\n            if (o.label) {\n                var label = $(\"<label>\").addClass(\"label-for-input\").addClass(o.clsLabel).html(o.label).insertBefore(container);\n                if (element.attr(\"id\")) {\n                    label.attr(\"for\", element.attr(\"id\"));\n                }\n                if (element.attr(\"dir\") === \"rtl\") {\n                    label.addClass(\"rtl\");\n                }\n            }\n\n            if (element.is(\":disabled\")) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var container = element.parent();\n            var clear = container.find(\".input-clear-button\");\n            var cal = this.calendar;\n            var cal_plugin = Metro.getPlugin(cal[0], 'calendar');\n            var calendar = this.calendar;\n\n            $(window).on(Metro.events.resize, function(){\n                if (o.dialogMode !== true) {\n                    if (Utils.media(\"(max-width: \" + o.dialogPoint + \"px)\")) {\n                        container.addClass(\"dialog-mode\");\n                        calendar.appendTo(\"body\").addClass(\"dialog-mode\");\n                    } else {\n                        container.removeClass(\"dialog-mode\");\n                        calendar.appendTo(container).removeClass(\"dialog-mode\");\n                    }\n                }\n            }, {ns: this.id});\n\n            if (clear.length > 0) clear.on(Metro.events.click, function(e){\n                element.val(\"\").trigger('change').blur(); // TODO change blur\n                that.value = null;\n                e.preventDefault();\n                e.stopPropagation();\n            });\n\n            container.on(Metro.events.click, \"button, input\", function(e){\n\n                var value = that.value ? that.value : datetime();\n                var presetValue = o.inputFormat ? value.format(o.inputFormat) : value.format(\"YYYY-MM-DD\");\n\n                value.align(\"day\");\n\n                if (cal.hasClass(\"open\") === false && cal.hasClass(\"open-up\") === false) {\n\n                    $(\".calendar-picker .calendar\").removeClass(\"open open-up\").hide();\n\n                    cal_plugin.setPreset([presetValue]);\n                    cal_plugin.setShow(value);\n\n                    if (container.hasClass(\"dialog-mode\")) {\n                        that.overlay.appendTo($('body'));\n                    }\n                    cal.addClass(\"open\");\n                    if (!Utils.inViewport(cal[0])) {\n                        cal.addClass(\"open-up\");\n                    }\n\n                    that._fireEvent(\"calendar-show\", {\n                        calendar: cal\n                    });\n\n                } else {\n\n                    that._removeOverlay();\n                    cal.removeClass(\"open open-up\");\n\n                    that._fireEvent(\"calendar-hide\", {\n                        calendar: cal\n                    });\n\n                }\n                e.preventDefault();\n                e.stopPropagation();\n            });\n\n            element.on(Metro.events.blur, function(){container.removeClass(\"focused\");});\n            element.on(Metro.events.focus, function(){container.addClass(\"focused\");});\n            element.on(Metro.events.change, function(){\n                Utils.exec(o.onChange, [that.value.val()], element[0]);\n            });\n\n            container.on(Metro.events.click, function(e){\n                e.preventDefault();\n                e.stopPropagation();\n            })\n        },\n\n        _overlay: function(){\n            var o = this.options;\n\n            var overlay = $(\"<div>\");\n            overlay.addClass(\"overlay for-calendar-picker\").addClass(o.clsOverlay);\n\n            if (o.overlayColor === 'transparent') {\n                overlay.addClass(\"transparent\");\n            } else {\n                overlay.css({\n                    background: Metro.colors.toRGBA(o.overlayColor, o.overlayAlpha)\n                });\n            }\n\n            return overlay;\n        },\n\n        _removeOverlay: function(){\n            $('body').find('.overlay.for-calendar-picker').remove();\n        },\n\n        clear: function(){\n            this.value = datetime();\n            this.time = [datetime().hour(), datetime().minute()];\n            this.element.val(\"\")\n        },\n\n        val: function(v, f){\n            var element = this.element, o = this.options;\n            var elementValue, h, m;\n\n            if (arguments.length === 0 || Utils.isNull(v))  {\n                return {\n                    date: this.value.val(),\n                    time: this.time\n                };\n            }\n\n            if (v === \"\") {\n                return this.clear();\n            }\n\n            if (f) {\n                o.inputFormat = f;\n            }\n\n            var _curr = v.split(\" \");\n            this.value = !o.inputFormat ? datetime(_curr[0]) : Datetime.from(_curr[0], o.inputFormat, o.locale);\n            if (_curr[1]) {\n                this.time = _curr[1].trim().split(\":\");\n            }\n\n            this.value.align(\"day\");\n            Metro.getPlugin(this.calendar, \"calendar\").setTime(this.time);\n\n            elementValue = this.value.format(o.format);\n\n            if (o.showTime && this.time && elementValue) {\n                h = Cake.lpad(this.time[0], 2, \"0\");\n                m = Cake.lpad(this.time[1], 2, \"0\");\n                elementValue += \" \" + h + \":\" + m;\n            }\n\n            element.val(elementValue);\n            element.trigger(\"change\");\n        },\n\n        disable: function(){\n            this.element.data(\"disabled\", true);\n            this.element.parent().addClass(\"disabled\");\n        },\n\n        enable: function(){\n            this.element.data(\"disabled\", false);\n            this.element.parent().removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        i18n: function(val){\n            var o = this.options;\n            var hidden;\n            var cal = this.calendar;\n            if (val === undefined) {\n                return o.locale;\n            }\n            if (Metro.locales[val] === undefined) {\n                return false;\n            }\n\n            hidden = cal[0].hidden;\n            if (hidden) {\n                cal.css({\n                    visibility: \"hidden\",\n                    display: \"block\"\n                });\n            }\n            Metro.getPlugin(cal[0], 'calendar').i18n(val);\n            if (hidden) {\n                cal.css({\n                    visibility: \"visible\",\n                    display: \"none\"\n                });\n            }\n        },\n\n        getTime: function(asString){\n            var h, m;\n\n            asString = asString || false;\n\n            h = Cake.lpad(this.time[0], 2, \"0\");\n            m = Cake.lpad(this.time[1], 2, \"0\");\n\n            return asString ? h +\":\"+ m : this.time;\n        },\n\n        changeAttribute: function(attributeName, newValue){\n            var that = this;\n            var cal = Metro.getPlugin(this.calendar[0], \"calendar\");\n\n            switch (attributeName) {\n                case \"value\": that.val(newValue); break;\n                case 'disabled': this.toggleState(); break;\n                case 'data-locale': that.i18n(newValue); break;\n                case 'data-special': cal.setSpecial(newValue); break;\n                case 'data-exclude': cal.setExclude(newValue); break;\n                case 'data-min-date': cal.setMinDate(newValue); break;\n                case 'data-max-date': cal.setMaxDate(newValue); break;\n                case 'data-value': that.val(newValue); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n            var container = element.parent();\n            var clear = container.find(\".input-clear-button\");\n\n            $(window).off(Metro.events.resize, {ns: this.id});\n            clear.off(Metro.events.click);\n            container.off(Metro.events.click, \"button, input\");\n            element.off(Metro.events.blur);\n            element.off(Metro.events.focus);\n            element.off(Metro.events.change);\n\n            Metro.getPlugin(this.calendar, \"calendar\").destroy();\n\n            return element;\n        }\n    });\n\n    $(document).on(Metro.events.click, \".overlay.for-calendar-picker\",function(){\n        $(this).remove();\n        $(\".calendar-for-picker.open\").removeClass(\"open open-up\");\n    });\n\n    $(document).on(Metro.events.click, function(){\n        $(\".calendar-picker .calendar\").removeClass(\"open open-up\");\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var effects = [\n        \"slide\", \"slide-v\", \"fade\", \"switch\", \"zoom\", \"swirl\"\n    ];\n    var CarouselDefaultConfig = {\n        carouselDeferred: 0,\n        autoStart: false,\n        width: \"100%\",\n        height: \"16/9\", // 3/4, 21/9\n        effect: effects[0],\n        effectFunc: \"linear\",\n        direction: \"left\", //left, right\n        duration: METRO_ANIMATION_DURATION,\n        period: 5000,\n        stopOnMouse: true,\n\n        controls: true,\n        bullets: true,\n        bulletsStyle: \"square\", // square, circle, rect, diamond\n        bulletsSize: \"default\", // default, mini, small, large\n\n        controlsOnMouse: false,\n        controlsOutside: false,\n        bulletsPosition: \"default\", // default, left, right\n\n        controlPrev: '&#x23F4',\n        controlNext: '&#x23F5',\n        clsCarousel: \"\",\n        clsSlides: \"\",\n        clsSlide: \"\",\n        clsControls: \"\",\n        clsControlNext: \"\",\n        clsControlPrev: \"\",\n        clsBullets: \"\",\n        clsBullet: \"\",\n        clsBulletOn: \"\",\n        clsThumbOn: \"\",\n\n        onStop: Metro.noop,\n        onStart: Metro.noop,\n        onPlay: Metro.noop,\n        onSlideClick: Metro.noop,\n        onBulletClick: Metro.noop,\n        onThumbClick: Metro.noop,\n        onMouseEnter: Metro.noop,\n        onMouseLeave: Metro.noop,\n        onNextClick: Metro.noop,\n        onPrevClick: Metro.noop,\n        onSlideShow: Metro.noop,\n        onSlideHide: Metro.noop,\n        onCarouselCreate: Metro.noop\n    };\n\n    Metro.carouselSetup = function (options) {\n        CarouselDefaultConfig = $.extend({}, CarouselDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroCarouselSetup\"] !== undefined) {\n        Metro.carouselSetup(window[\"metroCarouselSetup\"]);\n    }\n\n    Metro.Component('carousel', {\n        init: function( options, elem ) {\n            this._super(elem, options, CarouselDefaultConfig, {\n                height: 0,\n                width: 0,\n                slides: [],\n                current: null,\n                currentIndex: null,\n                dir: \"left\",\n                interval: false,\n                isAnimate: false,\n                id: Utils.elementId(\"carousel\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n            var slides = element.find(\".slide\");\n            var slides_container = element.find(\".slides\");\n\n            this.dir = this.options.direction;\n\n            element.addClass(\"carousel\").addClass(o.clsCarousel);\n\n            element.css({\n                maxWidth: o.width\n            });\n\n\n            if (o.controlsOutside === true) {\n                element.addClass(\"controls-outside\");\n            }\n\n            if (slides_container.length === 0) {\n                slides_container = $(\"<div>\").addClass(\"slides\").appendTo(element);\n                slides.appendTo(slides_container);\n            }\n\n            slides.addClass(o.clsSlides);\n\n            if (slides.length > 0) {\n\n                this._createSlides();\n                this._createControls();\n                this._createBullets();\n                this._createEvents();\n                this._resize();\n\n                if (o.controlsOnMouse === true) {\n                    element.find(\"[class*=carousel-switch]\").fadeOut(0);\n                    element.find(\".carousel-bullets\").fadeOut(0);\n                }\n\n                if (o.autoStart === true) {\n                    this._start();\n                } else {\n                    this._fireEvent(\"slide-show\", {\n                        current: this.slides[this.currentIndex][0],\n                        prev: undefined\n                    });\n                }\n\n            }\n\n            this._fireEvent(\"carousel-create\", {\n                element: element\n            });\n        },\n\n        _start: function(){\n            var that = this, element = this.element, o = this.options;\n            var period = o.period;\n            var current = this.slides[this.currentIndex];\n\n            if (current.data(\"period\") !== undefined) {\n                period = current.data(\"period\");\n            }\n\n            if (this.slides.length <= 1) {\n                return ;\n            }\n\n            if (this.interval === false) this.interval = setTimeout(function run() {\n                var t = o.direction === 'left' ? 'next' : 'prior';\n                that._slideTo(t, true);\n            }, period);\n\n            this._fireEvent(\"start\", {\n                element: element\n            });\n        },\n\n        _stop: function(){\n            clearInterval(this.interval);\n            this.interval = false;\n        },\n\n        _resize: function(){\n            var element = this.element, o = this.options;\n            var width = element.outerWidth();\n            var height;\n            var medias = [];\n\n            if ([\"16/9\", \"21/9\", \"4/3\"].indexOf(o.height) > -1) {\n                height = Utils.aspectRatioH(width, o.height);\n            } else {\n                if (String(o.height).indexOf(\"@\") > -1) {\n                    medias = o.height.substr(1).toArray(\"|\");\n                    $.each(medias, function(){\n                        var media = this.toArray(\",\");\n                        if (window.matchMedia(media[0]).matches) {\n                            if ([\"16/9\", \"21/9\", \"4/3\"].indexOf(media[1]) > -1) {\n                                height = Utils.aspectRatioH(width, media[1]);\n                            } else {\n                                height = parseInt(media[1]);\n                            }\n                        }\n                    });\n                } else {\n                    height = parseInt(o.height);\n                }\n            }\n\n            element.css({\n                height: height\n            });\n        },\n\n        _createSlides: function(){\n            var that = this, element = this.element, o = this.options;\n            var slides = element.find(\".slide\");\n\n            $.each(slides, function(i){\n                var slide = $(this);\n                if (slide.data(\"cover\") !== undefined) {\n                    slide.css({\n                        backgroundImage: \"url(\"+slide.data('cover')+\")\"\n                    });\n                }\n\n                if (i !== 0) {\n                    switch (o.effect) {\n                        case \"switch\":\n                        case \"slide\":\n                            slide.css(\"left\", \"100%\");\n                            break;\n                        case \"slide-v\":\n                            slide.css(\"top\", \"100%\");\n                            break;\n                        case \"fade\":\n                        case \"zoom\":\n                        case \"swirl\":\n                            slide.css(\"opacity\", \"0\");\n                            break;\n                    }\n                } else {\n                    slide.addClass(\"active-slide\");\n                }\n\n                slide.addClass(o.clsSlide);\n\n                that.slides.push(slide);\n            });\n\n            this.currentIndex = 0;\n            this.current = this.slides[this.currentIndex];\n        },\n\n        _createControls: function(){\n            var element = this.element, o = this.options;\n            var next, prev;\n\n            if (o.controls === false) {\n                return ;\n            }\n\n            next = $('<span/>').addClass('carousel-switch-next').addClass(o.clsControls).addClass(o.clsControlNext).html(\">\");\n            prev = $('<span/>').addClass('carousel-switch-prev').addClass(o.clsControls).addClass(o.clsControlPrev).html(\"<\");\n\n            if (o.controlNext) {\n                next.html(o.controlNext);\n            }\n\n            if (o.controlPrev) {\n                prev.html(o.controlPrev);\n            }\n\n            next.appendTo(element);\n            prev.appendTo(element);\n        },\n\n        _createBullets: function(){\n            var element = this.element, o = this.options;\n            var bullets, i;\n\n            if (o.bullets === false) {\n                return ;\n            }\n\n            bullets = $('<div>').addClass(\"carousel-bullets\").addClass(o.bulletsSize+\"-size\").addClass(\"bullet-style-\"+o.bulletsStyle).addClass(o.clsBullets);\n            if (o.bulletsPosition === 'default' || o.bulletsPosition === 'center') {\n                bullets.addClass(\"flex-justify-center\");\n            } else if (o.bulletsPosition === 'left') {\n                bullets.addClass(\"flex-justify-start\");\n            } else {\n                bullets.addClass(\"flex-justify-end\");\n            }\n\n            for (i = 0; i < this.slides.length; i++) {\n                var bullet = $('<span>').addClass(\"carousel-bullet\").addClass(o.clsBullet).data(\"slide\", i);\n                if (i === 0) {\n                    bullet.addClass('bullet-on').addClass(o.clsBulletOn);\n                }\n                bullet.appendTo(bullets);\n            }\n\n            bullets.appendTo(element);\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n\n            element.on(Metro.events.click, \".carousel-bullet\", function(){\n                var bullet = $(this);\n                if (that.isAnimate === false) {\n                    that._slideToSlide(bullet.data('slide'));\n                    that._fireEvent(\"bullet-click\", {\n                        bullet: bullet\n                    });\n                }\n            });\n\n            element.on(Metro.events.click, \".carousel-switch-next\", function(){\n                if (that.isAnimate === false) {\n                    that._slideTo(\"next\", false);\n                    that._fireEvent(\"next-click\", {\n                        button: this\n                    });\n                }\n            });\n\n            element.on(Metro.events.click, \".carousel-switch-prev\", function(){\n                if (that.isAnimate === false) {\n                    that._slideTo(\"prev\", false);\n                    that._fireEvent(\"prev-click\", {\n                        button: this\n                    });\n                }\n            });\n\n            if (o.stopOnMouse === true && o.autoStart === true) {\n                element.on(Metro.events.enter, function () {\n                    that._stop();\n                    that._fireEvent(\"mouse-enter\", {\n                        element: element\n                    }, false, true);\n                });\n                element.on(Metro.events.leave, function () {\n                    that._start();\n                    that._fireEvent(\"mouse-leave\", {\n                        element: element\n                    }, false, true);\n                });\n            }\n\n            if (o.controlsOnMouse === true) {\n                element.on(Metro.events.enter, function () {\n                    element.find(\"[class*=carousel-switch]\").fadeIn();\n                    element.find(\".carousel-bullets\").fadeIn();\n                });\n                element.on(Metro.events.leave, function () {\n                    element.find(\"[class*=carousel-switch]\").fadeOut();\n                    element.find(\".carousel-bullets\").fadeOut();\n                });\n            }\n\n            element.on(Metro.events.click, \".slide\", function(){\n                var slide = $(this);\n                that._fireEvent(\"slide-click\", {\n                    slide: slide\n                });\n            });\n\n            $(window).on(Metro.events.resize, function(){\n                that._resize();\n            }, {ns: this.id});\n        },\n\n        _slideToSlide: function(index){\n            var element = this.element, o = this.options;\n            var current, next, to;\n\n            if (this.slides[index] === undefined) {\n                return ;\n            }\n\n            if (this.currentIndex === index) {\n                return ;\n            }\n\n            to = index > this.currentIndex ? \"next\" : \"prev\";\n            current = this.slides[this.currentIndex];\n            next = this.slides[index];\n\n            this.currentIndex = index;\n\n            this._effect(current, next, o.effect, to);\n\n            element.find(\".carousel-bullet\").removeClass(\"bullet-on\").removeClass(o.clsBulletOn);\n            element.find(\".carousel-bullet:nth-child(\"+(this.currentIndex+1)+\")\").addClass(\"bullet-on\").addClass(o.clsBulletOn);\n        },\n\n        _slideTo: function(to, interval){\n            var element = this.element, o = this.options;\n            var current, next;\n\n            if (to === undefined) {\n                to = \"next\";\n            }\n\n            current = this.slides[this.currentIndex];\n\n            if (to === \"next\") {\n                this.currentIndex++;\n                if (this.currentIndex >= this.slides.length) {\n                    this.currentIndex = 0;\n                }\n            } else {\n                this.currentIndex--;\n                if (this.currentIndex < 0) {\n                    this.currentIndex = this.slides.length - 1;\n                }\n            }\n\n            next = this.slides[this.currentIndex];\n\n            this._effect(current, next, o.effect, to, interval);\n\n            element.find(\".carousel-bullet\").removeClass(\"bullet-on\").removeClass(o.clsBulletOn);\n            element.find(\".carousel-bullet:nth-child(\"+(this.currentIndex+1)+\")\").addClass(\"bullet-on\").addClass(o.clsBulletOn);\n        },\n\n        _effect: function(current, next, effect, to, interval){\n            var that = this, o = this.options;\n            var duration = o.duration;\n            var func, effectFunc = o.effectFunc;\n            var period = o.period;\n\n            var run = function(f, c, n, o){\n                Metro.animations[f](c, n, o);\n            }\n\n            if (next.data('duration') !== undefined) {\n                duration = next.data('duration');\n            }\n\n            if (next.data('effectFunc') !== undefined) {\n                effectFunc = next.data('effectFunc');\n            }\n\n            if (effect === 'switch') {\n                duration = 0;\n            }\n\n            current.stop(true);\n            next.stop(true);\n            this.isAnimate = true;\n\n            setTimeout(function(){that.isAnimate = false;}, duration + 100);\n\n            if (effect === 'slide') {\n                func = to === 'next' ? 'slideLeft': 'slideRight';\n            } else\n            if (effect === 'slide-v') {\n                func = to === 'next' ? 'slideUp': 'slideDown';\n            } else {\n                func = effect;\n            }\n\n            if (!effects.includes(effect)) {\n                func = \"switch\";\n            }\n\n            run(func, current, next, {duration: duration, ease: effectFunc});\n\n            current.removeClass(\"active-slide\");\n            next.addClass(\"active-slide\");\n\n            setTimeout(function(){\n                that._fireEvent(\"slide-show\", {\n                    current: next[0],\n                    prev: current[0]\n                })\n            }, duration);\n\n            setTimeout(function(){\n                that._fireEvent(\"slide-hide\", {\n                    current: current[0],\n                    next: next[0]\n                })\n            }, duration);\n\n            if (interval === true) {\n\n                if (next.data('period') !== undefined) {\n                    period = next.data('period');\n                }\n\n                this.interval = setTimeout(function run() {\n                    var t = o.direction === 'left' ? 'next' : 'prior';\n                    that._slideTo(t, true);\n                }, period);\n            }\n        },\n\n        toSlide: function(index){\n            this._slideToSlide(index);\n        },\n\n        next: function(){\n            this._slideTo(\"next\");\n        },\n\n        prev: function(){\n            this._slideTo(\"prev\");\n        },\n\n        stop: function () {\n            clearInterval(this.interval);\n            this._fireEvent(\"stop\");\n        },\n\n        play: function(){\n            this._start();\n            this._fireEvent(\"play\");\n        },\n\n        setEffect: function(effect){\n            var element = this.element, o = this.options;\n            var slides = element.find(\".slide\");\n\n            if (!effects.includes(effect)) return ;\n\n            o.effect = effect;\n\n            slides.removeStyleProperty(\"transform\").css({\n                top: 0,\n                left: 0\n            });\n        },\n\n        /* eslint-disable-next-line */\n        changeAttribute: function(attributeName, newValue){\n            if (attributeName === 'data-effect') {\n                this.setEffect(newValue);\n            }\n        },\n\n        destroy: function(){\n            var element = this.element, o = this.options;\n\n            element.off(Metro.events.click, \".carousel-bullet\");\n            element.off(Metro.events.click, \".carousel-switch-next\");\n            element.off(Metro.events.click, \".carousel-switch-prev\");\n\n            if (o.stopOnMouse === true && o.autoStart === true) {\n                element.off(Metro.events.enter);\n                element.off(Metro.events.leave);\n            }\n\n            if (o.controlsOnMouse === true) {\n                element.off(Metro.events.enter);\n                element.off(Metro.events.leave);\n            }\n\n            element.off(Metro.events.click, \".slide\");\n            $(window).off(Metro.events.resize, {ns: this.id});\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var CharmsDefaultConfig = {\n        charmsDeferred: 0,\n        position: \"right\",\n        opacity: 1,\n        clsCharms: \"\",\n        onCharmCreate: Metro.noop,\n        onOpen: Metro.noop,\n        onClose: Metro.noop,\n        onToggle: Metro.noop\n    };\n\n    Metro.charmsSetup = function (options) {\n        CharmsDefaultConfig = $.extend({}, CharmsDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroCharmsSetup\"] !== undefined) {\n        Metro.charmsSetup(window[\"metroCharmsSetup\"]);\n    }\n\n    Metro.Component('charms', {\n        init: function( options, elem ) {\n            this._super(elem, options, CharmsDefaultConfig, {\n                origin: {\n                    background: \"\"\n                }\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"charm-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n\n            element\n                .addClass(\"charms\")\n                .addClass(o.position + \"-side\")\n                .addClass(o.clsCharms);\n\n            this.origin.background = element.css(\"background-color\");\n\n            element.css({\n                backgroundColor: Metro.colors.toRGBA(Utils.getStyleOne(element, \"background-color\"), o.opacity)\n            });\n        },\n\n        _createEvents: function(){\n        },\n\n        open: function(){\n            var element = this.element;\n\n            element.addClass(\"open\");\n\n            this._fireEvent(\"open\");\n        },\n\n        close: function(){\n            var element = this.element;\n\n            element.removeClass(\"open\");\n\n            this._fireEvent(\"close\");\n        },\n\n        toggle: function(){\n            var element = this.element;\n\n            if (element.hasClass(\"open\") === true) {\n                this.close();\n            } else {\n                this.open();\n            }\n\n            this._fireEvent(\"toggle\");\n        },\n\n        opacity: function(v){\n            var element = this.element, o = this.options;\n\n            if (v === undefined) {\n                return o.opacity;\n            }\n\n            var opacity = Math.abs(parseFloat(v));\n            if (opacity < 0 || opacity > 1) {\n                return ;\n            }\n            o.opacity = opacity;\n\n            element.css({\n                backgroundColor: Metro.colors.toRGBA(Utils.getStyleOne(element, \"background-color\"), opacity)\n            });\n        },\n\n        changeOpacity: function(){\n            var element = this.element;\n            this.opacity(element.attr(\"data-opacity\"));\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case \"data-opacity\": this.changeOpacity(); break;\n            }\n        },\n\n        destroy: function(){\n            return this.element;\n        }\n    });\n\n    Metro['charms'] = {\n        check: function(el){\n            if (Utils.isMetroObject(el, \"charms\") === false) {\n                console.warn(\"Element is not a charms component\");\n                return false;\n            }\n            return true;\n        },\n\n        isOpen: function(el){\n            if (this.check(el) === false) return ;\n            return $(el).hasClass(\"open\");\n        },\n\n        open: function(el){\n            if (this.check(el) === false) return ;\n            Metro.getPlugin(el, \"charms\").open();\n        },\n\n        close: function(el){\n            if (this.check(el) === false) return ;\n            Metro.getPlugin(el, \"charms\").close();\n        },\n\n        toggle: function(el){\n            if (this.check(el) === false) return ;\n            Metro.getPlugin(el, \"charms\").toggle();\n        },\n\n        closeAll: function(){\n            $('[data-role*=charms]').each(function() {\n                Metro.getPlugin(this, 'charms').close();\n            });\n        },\n\n        opacity: function(el, opacity){\n            if (this.check(el) === false) return ;\n            Metro.getPlugin(el, \"charms\").opacity(opacity);\n        }\n    };\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var defaultAvatar = \"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD//gA7Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2NjIpLCBxdWFsaXR5ID0gOTAK/9sAQwADAgIDAgIDAwMDBAMDBAUIBQUEBAUKBwcGCAwKDAwLCgsLDQ4SEA0OEQ4LCxAWEBETFBUVFQwPFxgWFBgSFBUU/9sAQwEDBAQFBAUJBQUJFA0LDRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQU/8AAEQgAUABQAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A+t+KKPxo/GgA70Yo/Gj8aADFH4VesdC1HUl3WtjcXCf344yV/PGKW+0HUtNXddWNzbp/fkjIX88YoAofhR+FH40fjQAfhR+FH40fjQAUUUUAFepeAPh5D9li1LVYhK8g3Q27j5VXszDuT6f5HA+FtOXVvEWn2rjMcko3j1UckfkDX0MBgYHAoARVCKFUBVHAA6ClZQwKkZBGCDS0UAec+Pvh3BJay6lpUQimjBeW3QYVx3Kjsfbv/PyqvpuvnvxfpqaT4l1C1QbY0lJUDsrfMB+RoAyKKKKACiiigDa8GXq6f4p02eQgIJQpJ7Bvlz+tfQP4V8yDg17P4A8cw65ZxWV5IE1KMbfmP+uA7j39R+NAHaUfhSUUAL+FeA+OL1NQ8WalNGQU83YCO+0Bf6V6b498cQ6BZyWlrIJNSkXaApz5QP8AEff0FeKk5OTyTQAUUUUAH40fjRU1naTX93DbQIXmlYIijuTQBc0Dw/eeI74W1mm49XkbhUHqTXsHhz4eaXoCpI8YvbscmaYZAP8Asr0H8/etHwv4cg8M6XHaxANIfmllxy7dz9PStigA/Gk/GlooA5bxJ8PdL19XkWMWd43PnwjGT/tL0P8AP3rx/X/D954cvjbXibT1SReVceoNfRFZHijw5B4m0uS1lAWQfNFLjlG7H6etAHz5+NH41NeWk1hdzW06FJonKMp7EGoaACvQfhBowudTudRkXK2y7I8j+Nup/Afzrz6vafhRaCDwmkgHM8zufwO3/wBloA7Kiij8KACkpaSgBaSj8KKAPJvi/owttTttRjXC3K7JMf3l6H8R/KvPq9p+K1qJ/CbyEcwTI4P1O3/2avFqAP/Z\";\n    var ChatDefaultConfig = {\n        chatDeferred: 0,\n        inputTimeFormat: null,\n        timeFormat: \"D MMM hh:mm A\",\n        name: \"John Doe\",\n        avatar: defaultAvatar,\n        welcome: null,\n        welcomeAvatar: defaultAvatar,\n        title: null,\n        width: \"100%\",\n        height: \"auto\",\n        messages: null,\n        sendButtonTitle: \"Send\",\n        readonly: false,\n        locale: METRO_LOCALE,\n\n        clsChat: \"\",\n        clsName: \"\",\n        clsTime: \"\",\n        clsInput: \"\",\n        clsSendButton: \"\",\n        clsMessageLeft: \"default\",\n        clsMessageRight: \"default\",\n\n        onMessage: Metro.noop,\n        onSend: Metro.noop,\n        onSendButtonClick: Metro.noop,\n        onChatCreate: Metro.noop\n    };\n\n    Metro.chatSetup = function (options) {\n        ChatDefaultConfig = $.extend({}, ChatDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroChatSetup\"] !== undefined) {\n        Metro.chatSetup(window[\"metroChatSetup\"]);\n    }\n\n    Metro.Component('chat', {\n        init: function( options, elem ) {\n            this._super(elem, options, ChatDefaultConfig, {\n                input: null,\n                classes: \"primary secondary success alert warning yellow info dark light\".split(\" \"),\n                lastMessage: null\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"chat-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var that = this, element = this.element, o = this.options;\n            var messages, messageInput, input;\n            var customButtons = [\n                {\n                    html: o.sendButtonTitle,\n                    cls: o.clsSendButton+\" js-chat-send-button\",\n                    onclick: o.onSendButtonClick\n                }\n            ];\n\n            element.addClass(\"chat\").addClass(o.clsChat);\n\n            element.css({\n                width: o.width,\n                height: o.height\n            });\n\n            if (Utils.isValue(o.title)) {\n                $(\"<div>\").addClass(\"title\").html(o.title).appendTo(element);\n            }\n\n            messages = $(\"<div>\").addClass(\"messages\");\n            messages.appendTo(element);\n            messageInput = $(\"<div>\").addClass(\"message-input\").appendTo(element);\n            input = $(\"<input type='text'>\");\n            input.appendTo(messageInput);\n            input.input({\n                customButtons: customButtons,\n                clsInput: o.clsInput\n            });\n\n            if (o.welcome) {\n                this.add({\n                    text: o.welcome,\n                    time: datetime(),\n                    position: \"left\",\n                    name: \"Chat Bot\",\n                    avatar: o.welcomeAvatar\n                })\n            }\n\n            if (Utils.isValue(o.messages) && typeof o.messages === \"string\") {\n                o.messages = Utils.isObject(o.messages);\n            }\n\n            if (!Utils.isNull(o.messages) && typeof o.messages === \"object\" && Utils.objectLength(o.messages) > 0) {\n                $.each(o.messages, function(){\n                    that.add(this);\n                });\n            }\n\n            element.find(\".message-input\")[o.readonly ? 'addClass':'removeClass'](\"disabled\");\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var sendButton = element.find(\".js-chat-send-button\");\n            var input = element.find(\"input[type=text]\");\n\n            var send = function(){\n                var msg = \"\"+input.val(), m;\n                if (msg.trim() === \"\") {return false;}\n                m = {\n                    id: Utils.elementId(\"chat-message\"),\n                    name: o.name,\n                    avatar: o.avatar,\n                    text: msg,\n                    position: \"right\",\n                    time: datetime()\n                };\n                that.add(m);\n                input.val(\"\");\n                that._fireEvent(\"send\", {\n                    msg: m\n                });\n                input.focus();\n            };\n\n            sendButton.on(Metro.events.click, function () {\n                send();\n            });\n\n            input.on(Metro.events.keyup, function(e){\n                if (e.keyCode === Metro.keyCode.ENTER) {\n                    send();\n                }\n            })\n        },\n\n        add: function(msg){\n            var that = this, element = this.element, o = this.options;\n            var message, sender, time, item, avatar, text;\n            var messages = element.find(\".messages\");\n            var messageDate;\n\n            messageDate = o.inputTimeFormat ? Datetime.from(msg.time, o.inputTimeFormat, o.locale) : datetime(msg.time);\n\n            message = $(\"<div>\").addClass(\"message\").addClass(msg.position).appendTo(messages);\n            item = $(\"<div>\").addClass(\"message-item\").appendTo(message);\n            avatar = $(\"<img>\").attr(\"src\", msg.avatar).addClass(\"message-avatar\").appendTo(item);\n            text = $(\"<div>\").addClass(\"message-text\").append($(\"<div>\").addClass(\"message-text-inner\").html(Cake.escapeHtml(msg.text))).appendTo(item);\n            time = $(\"<div>\").addClass(\"message-time\").addClass(o.clsTime).text(messageDate.format(o.timeFormat)).appendTo(text);\n            sender = $(\"<div>\").addClass(\"message-sender\").addClass(o.clsName).text(msg.name).appendTo(text);\n\n            if (Utils.isValue(msg.id)) {\n                message.attr(\"id\", msg.id);\n            }\n\n            if (msg.position === 'left' && Utils.isValue(o.clsMessageLeft)) {\n                text.addClass(o.clsMessageLeft);\n            }\n            if (msg.position === 'right' && Utils.isValue(o.clsMessageRight)) {\n                text.addClass(o.clsMessageRight);\n            }\n\n            if (this.lastMessage && this.lastMessage.position === msg.position) {\n                text.addClass(\"--next\");\n                avatar.visible(false);\n                sender.hide();\n            }\n\n            that._fireEvent(\"message\", {\n                msg: msg,\n                el: {\n                    message: message,\n                    sender: sender,\n                    time: time,\n                    item: item,\n                    avatar: avatar,\n                    text: text\n                }\n            });\n\n            messages.animate({\n                draw: {\n                    scrollTop: messages[0].scrollHeight\n                },\n                dur: 1000\n            });\n\n            this.lastMessage = msg;\n\n            return this;\n        },\n\n        addMessages: function(messages){\n            var that = this;\n\n            if (Utils.isValue(messages) && typeof messages === \"string\") {\n                messages = Utils.isObject(messages);\n            }\n\n            if (typeof messages === \"object\" && Utils.objectLength(messages) > 0) {\n                $.each(messages, function(){\n                    that.add(this);\n                });\n            }\n\n            return this;\n        },\n\n        delMessage: function(id){\n            var element = this.element;\n\n            element.find(\".messages\").find(\"#\"+id).remove();\n\n            return this;\n        },\n\n        updMessage: function(msg){\n            var element = this.element;\n            var message = element.find(\".messages\").find(\"#\"+msg.id);\n\n            if (message.length === 0) return this;\n\n            message.find(\".message-text\").html(msg.text);\n            message.find(\".message-time\").html(msg.time);\n\n            return this;\n        },\n\n        clear: function(){\n            var element = this.element;\n            var messages = element.find(\".messages\");\n            messages.html(\"\");\n            this.lastMessage = null;\n        },\n\n        toggleReadonly: function(readonly){\n            var element = this.element, o = this.options;\n            o.readonly = typeof readonly === \"undefined\" ? !o.readonly : readonly;\n            element.find(\".message-input\")[o.readonly ? 'addClass':'removeClass'](\"disabled\");\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case \"data-readonly\": this.toggleReadonly(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n            var sendButton = element.find(\".js-chat-send-button\");\n            var input = element.find(\"input[type=text]\");\n\n            sendButton.off(Metro.events.click);\n            input.off(Metro.events.keyup);\n\n            return element;\n        }\n    });\n\n    Metro.defaults.Chat = ChatDefaultConfig;\n    Metro.defaults.ChatAvatar = defaultAvatar;\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var CheckboxDefaultConfig = {\n        checkboxDeferred: 0,\n        transition: true,\n        style: 1,\n        caption: \"\",\n        captionPosition: \"right\",\n        indeterminate: false,\n        clsCheckbox: \"\",\n        clsCheck: \"\",\n        clsCaption: \"\",\n        onCheckboxCreate: Metro.noop\n    };\n\n    Metro.checkboxSetup = function (options) {\n        CheckboxDefaultConfig = $.extend({}, CheckboxDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroCheckboxSetup\"] !== undefined) {\n        Metro.checkboxSetup(window[\"metroCheckboxSetup\"]);\n    }\n\n    Metro.Component('checkbox', {\n        init: function( options, elem ) {\n            this._super(elem, options, CheckboxDefaultConfig, {\n                origin: {\n                    className: \"\"\n                }\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            this._createStructure();\n            this._createEvents();\n            this._fireEvent(\"checkbox-create\");\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var checkbox;\n            var check = $(\"<span>\").addClass(\"check\");\n            var caption = $(\"<span>\").addClass(\"caption\").html(o.caption);\n\n            element.attr(\"type\", \"checkbox\");\n\n            if (element.attr(\"readonly\") !== undefined) {\n                element.on(\"click\", function(e){\n                    e.preventDefault();\n                })\n            }\n\n            checkbox = element\n                .wrap(\"<label>\")\n                .addClass(\"checkbox \" + element[0].className)\n                .addClass(o.style === 2 ? \"style2\" : \"\");\n\n            check.appendTo(checkbox);\n            caption.appendTo(checkbox);\n\n            if (o.transition === true) {\n                checkbox.addClass(\"transition-on\");\n            }\n\n            if (o.captionPosition === 'left') {\n                checkbox.addClass(\"caption-left\");\n            }\n\n            this.origin.className = element[0].className;\n            element[0].className = '';\n\n            checkbox.addClass(o.clsCheckbox);\n            caption.addClass(o.clsCaption);\n            check.addClass(o.clsCheck);\n\n            if (o.indeterminate) {\n                element[0].indeterminate = true;\n            }\n\n            if (element.is(':disabled')) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        _createEvents: function(){\n            var element = this.element, check = element.siblings(\".check\");\n\n            element.on(\"focus\", function(){\n                check.addClass(\"focused\");\n            });\n\n            element.on(\"blur\", function(){\n                check.removeClass(\"focused\");\n            });\n        },\n\n        indeterminate: function(v){\n            var element = this.element;\n\n            v = Utils.isNull(v) ? true : Utils.bool(v);\n\n            element[0].indeterminate = v;\n            element.attr(\"data-indeterminate\", v);\n        },\n\n        disable: function(){\n            this.element.data(\"disabled\", true);\n            this.element.parent().addClass(\"disabled\");\n        },\n\n        enable: function(){\n            this.element.data(\"disabled\", false);\n            this.element.parent().removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        toggle: function(v){\n            var element = this.element;\n\n            this.indeterminate(false);\n\n            if (!Utils.isValue(v)) {\n                element.prop(\"checked\", !Utils.bool(element.prop(\"checked\")));\n            } else {\n                if (v === -1) {\n                    this.indeterminate(true);\n                } else {\n                    element.prop(\"checked\", v === 1);\n                }\n            }\n            return this;\n        },\n\n        changeAttribute: function(attributeName){\n            var element = this.element, o = this.options;\n            var parent = element.parent();\n\n            var changeStyle = function(){\n                var new_style = parseInt(element.attr(\"data-style\"));\n\n                if (!Utils.isInt(new_style)) return;\n\n                o.style = new_style;\n                parent.removeClass(\"style1 style2\").addClass(\"style\"+new_style);\n            };\n\n            var indeterminateState = function(){\n                element[0].indeterminate = JSON.parse(element.attr(\"data-indeterminate\")) === true;\n            };\n\n            switch (attributeName) {\n                case 'disabled': this.toggleState(); break;\n                case 'data-indeterminate': indeterminateState(); break;\n                case 'data-style': changeStyle(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n            element.off(\"focus\");\n            element.off(\"blur\");\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var ClockDefaultConfig = {\n        clockDeferred: 0,\n        showTime: true,\n        showDate: true,\n        timeFormat: '24',\n        dateFormat: 'american',\n        divider: \"&nbsp;&nbsp;\",\n        leadingZero: true,\n        dateDivider: '-',\n        timeDivider: \":\",\n        onTick: Metro.noop,\n        onSecond: Metro.noop,\n        onClockCreate: Metro.noop\n    };\n\n    Metro.clockSetup = function (options) {\n        ClockDefaultConfig = $.extend({}, ClockDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroClockSetup\"] !== undefined) {\n        Metro.clockSetup(window[\"metroClockSetup\"]);\n    }\n\n    Metro.Component('clock', {\n        init: function( options, elem ) {\n            this._super(elem, options, ClockDefaultConfig, {\n                _clockInterval: null\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var that = this, element = this.element;\n\n            this._fireEvent('clock-create', {\n                element: element\n            });\n\n            this._tick();\n\n            this._clockInterval = setInterval(function(){\n                that._tick();\n            }, 500);\n            this._secondInterval = setInterval(function(){\n                that._second();\n            }, 1000);\n        },\n\n        _addLeadingZero: function(i){\n            if (i<10){i=\"0\" + i;}\n            return i;\n        },\n\n        _second: function(){\n            var timestamp = new Date();\n\n            this._fireEvent('second', {\n                timestamp: timestamp\n            })\n        },\n\n        _tick: function(){\n            var element = this.element, o = this.options;\n            var timestamp = new Date();\n            var result = \"\";\n            var h = timestamp.getHours(),\n                i = timestamp.getMinutes(),\n                s = timestamp.getSeconds(),\n                d = timestamp.getDate(),\n                m = timestamp.getMonth() + 1,\n                y = timestamp.getFullYear(),\n                a = '';\n\n            if (parseInt(o.timeFormat) === 12) {\n                a = \" AM\";\n                if (h > 11) { a = \" PM\"; }\n                if (h > 12) { h = h - 12; }\n                if (h === 0) { h = 12; }\n            }\n\n            i = this._addLeadingZero(i);\n            s = this._addLeadingZero(s);\n\n            if (o.leadingZero) {\n                h = this._addLeadingZero(h);\n                m = this._addLeadingZero(m);\n                d = this._addLeadingZero(d);\n            }\n\n            if (o.showDate) {\n                if (o.dateFormat === 'american') {\n                    result += \"<span class='date-month'>\" + m + \"</span>\";\n                    result += \"<span class='date-divider'>\" + o.dateDivider + \"</span>\";\n                    result += \"<span class='date-day'>\" + d + \"</span>\";\n                    result += \"<span class='date-divider'>\" + o.dateDivider + \"</span>\";\n                    result += \"<span class='date-year'>\" + y + \"</span>\";\n                } else {\n                    result += \"<span class='date-day'>\" + d + \"</span>\";\n                    result += \"<span class='date-divider'>\" + o.dateDivider + \"</span>\";\n                    result += \"<span class='date-month'>\" + m + \"</span>\";\n                    result += \"<span class='date-divider'>\" + o.dateDivider + \"</span>\";\n                    result += \"<span class='date-year'>\" + y + \"</span>\";\n                }\n                result += o.divider;\n            }\n\n            if (o.showTime) {\n                result += \"<span class='clock-hour'>\" + h + \"</span>\";\n                result += \"<span class='clock-divider'>\" + o.timeDivider + \"</span>\";\n                result += \"<span class='clock-minute'>\" + i + \"</span>\";\n                result += \"<span class='clock-divider'>\" + o.timeDivider + \"</span>\";\n                result += \"<span class='clock-second'>\" + s + \"</span>\";\n                result += \"<span class='clock-suffix'>\" + a + \"</span>\";\n            }\n\n            element.html(result);\n\n            this._fireEvent('tick', {\n                timestamp: timestamp\n            })\n        },\n\n        /* eslint-disable-next-line */\n        changeAttribute: function(attributeName){\n        },\n\n        destroy: function(){\n            clearInterval(this._clockInterval);\n            this._clockInterval = null;\n            return this.element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var CollapseDefaultConfig = {\n        collapseDeferred: 0,\n        collapsed: false,\n        toggleElement: false,\n        duration: 100,\n        onExpand: Metro.noop,\n        onCollapse: Metro.noop,\n        onCollapseCreate: Metro.noop\n    };\n\n    Metro.collapseSetup = function (options) {\n        CollapseDefaultConfig = $.extend({}, CollapseDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroCollapseSetup\"] !== undefined) {\n        Metro.collapseSetup(window[\"metroCollapseSetup\"]);\n    }\n\n    Metro.Component('collapse', {\n        init: function( options, elem ) {\n            this._super(elem, options, CollapseDefaultConfig, {\n                toggle: null\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var that = this, element = this.element, o = this.options;\n            var toggle;\n\n            toggle = o.toggleElement !== false ? $(o.toggleElement) : element.siblings('.collapse-toggle').length > 0 ? element.siblings('.collapse-toggle') : element.siblings('a:nth-child(1)');\n\n            if (o.collapsed === true || element.attr(\"collapsed\") === true) {\n                element.hide(0);\n            }\n\n            toggle.on(Metro.events.click, function(e){\n                if (element.css('display') === 'block' && !element.hasClass('keep-open')) {\n                    that._close(element);\n                } else {\n                    that._open(element);\n                }\n\n                if ([\"INPUT\"].indexOf(e.target.tagName) === -1) {\n                    e.preventDefault();\n                }\n                e.stopPropagation();\n            });\n\n            this.toggle = toggle;\n\n            this._fireEvent(\"collapse-create\", {\n                element: element\n            });\n        },\n\n        _close: function(el, immediate){\n            var elem = $(el);\n            var dropdown  = Metro.getPlugin(elem[0], \"collapse\");\n            var options = dropdown.options;\n            var func = immediate ? 'show' : 'slideUp';\n            var dur = immediate ? 0 : options.duration;\n\n            this.toggle.removeClass(\"active-toggle\");\n\n            elem[func](dur, function(){\n                el.trigger(\"onCollapse\", null, el);\n                el.data(\"collapsed\", true);\n                el.addClass(\"collapsed\");\n\n                dropdown._fireEvent(\"collapse\");\n            });\n        },\n\n        _open: function(el, immediate){\n            var elem = $(el);\n            var dropdown  = Metro.getPlugin(elem[0], \"collapse\");\n            var options = dropdown.options;\n            var func = immediate ? 'show' : 'slideDown';\n            var dur = immediate ? 0 : options.duration;\n\n            this.toggle.addClass(\"active-toggle\");\n\n            elem[func](dur, function(){\n                el.trigger(\"onExpand\", null, el);\n                el.data(\"collapsed\", false);\n                el.removeClass(\"collapsed\");\n\n                dropdown._fireEvent(\"expand\");\n            });\n        },\n\n        collapse: function(immediate){\n            this._close(this.element, immediate);\n        },\n\n        expand: function(immediate){\n            this._open(this.element, immediate);\n        },\n\n        close: function(immediate){\n            this._close(this.element, immediate);\n        },\n\n        open: function(immediate){\n            this._open(this.element, immediate);\n        },\n\n        isCollapsed: function(){\n            return this.element.data(\"collapsed\");\n        },\n\n        toggleState: function(){\n            var element = this.element;\n            if (element.attr(\"collapsed\") === true || element.data(\"collapsed\") === true) {\n                this.collapse();\n            } else {\n                this.expand();\n            }\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case \"collapsed\":\n                case \"data-collapsed\": this.toggleState(); break;\n            }\n        },\n\n        destroy: function(){\n            this.toggle.off(Metro.events.click);\n            return this.element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var Utils = Metro.utils;\n    var ColorPickerDefaultConfig = {\n        duration: 100,\n        prepend: \"\",\n        append: \"\",\n        clearButton: false,\n        clearButtonIcon: \"<span class='default-icon-cross'></span>\",\n        pickerButtonIcon: \"<span class='default-icon-equalizer'></span>\",\n        defaultValue: \"rgba(0, 0, 0, 0)\",\n        copyInlineStyles: false,\n        clsPickerButton: \"\",\n        clsClearButton: \"\",\n        onColorSelected: Metro.noop,\n        onColorPickerCreate: Metro.noop\n    };\n\n    Metro.colorPickerSetup = function (options) {\n        ColorPickerDefaultConfig = $.extend({}, ColorPickerDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroColorPickerSetup\"] !== undefined) {\n        Metro.colorPickerSetup(window[\"metroColorPickerSetup\"]);\n    }\n\n    Metro.Component('color-picker', {\n        init: function( options, elem ) {\n            this._super(elem, options, $.extend({}, Metro.defaults.ColorSelector, {\n                showUserColors: false,\n                showValues: \"\"\n            }, ColorPickerDefaultConfig), {\n                value: null,\n                picker: null,\n                colorSelector: null,\n                colorSelectorBox: null,\n                colorExample: null,\n                inputInterval: null,\n                isOpen: false\n            });\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n            var current = element.val();\n\n            if (!Metro.pluginExists(\"color-selector\")) {\n                throw new Error(\"Color selector component required!\");\n            }\n\n            this.value = Metro.colors.isColor(current) ? current : Metro.colors.isColor(o.defaultValue) ? o.defaultValue : \"rgba(0,0,0,0)\";\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent('color-picker-create');\n        },\n\n        _createStructure: function(){\n            var that = this, element = this.element, o = this.options;\n            var picker = element.wrap( $(\"<div>\").addClass(\"color-picker\").addClass(element[0].className) );\n            var buttons, colorExample, colorSelector, colorSelectorBox;\n\n            colorExample = $(\"<div>\").addClass(\"color-example-box\").insertBefore(element);\n\n            buttons = $(\"<div>\").addClass(\"buttons\").appendTo(picker);\n\n            buttons.append(\n                $(\"<button>\")\n                    .addClass(\"button color-picker-button\")\n                    .addClass(o.clsPickerButton)\n                    .attr(\"tabindex\", -1)\n                    .attr(\"type\", \"button\")\n                    .html(o.pickerButtonIcon)\n            );\n\n            if (o.clearButton === true && !element[0].readOnly) {\n                buttons.append(\n                    $(\"<button>\")\n                        .addClass(\"button input-clear-button\")\n                        .addClass(o.clsClearButton)\n                        .attr(\"tabindex\", -1)\n                        .attr(\"type\", \"button\")\n                        .html(o.clearButtonIcon)\n                );\n            }\n\n            if (Utils.isValue(o.prepend)) {\n                picker.prepend($(\"<div>\").addClass(\"prepend\").addClass(o.clsPrepend).html(o.prepend));\n            }\n\n            if (Utils.isValue(o.append)) {\n                picker.append($(\"<div>\").html(o.append).addClass(\"append\").addClass(o.clsAppend));\n            }\n\n            colorSelectorBox = $(\"<div>\").addClass(\"color-selector-box\").appendTo(picker);\n            colorSelector = $(\"<div>\").appendTo(colorSelectorBox);\n\n            this.picker = picker;\n            this.colorExample = colorExample;\n            this.colorSelector = colorSelector;\n            this.colorSelectorBox = colorSelectorBox;\n\n            Metro.makePlugin(colorSelector, 'color-selector', {\n                defaultSwatches: o.defaultSwatches,\n                userColors: o.userColors,\n                returnValueType: o.returnValueType,\n                returnAsString: o.returnAsString,\n                showValues: o.showValues,\n                showAsString: o.showAsString,\n                showUserColors: o.showUserColors,\n                target: o.target,\n                controller: element,\n                locale: o.locale,\n                addUserColorTitle: o.addUserColorTitle,\n                userColorsTitle: o.userColorsTitle,\n                hslMode: o.hslMode,\n                showAlphaChannel: o.showAlphaChannel,\n                inputThreshold: o.inputThreshold,\n                initColor: this.value,\n                readonlyInput: o.readonlyInput,\n                clsSelector: o.clsSelector,\n                clsSwatches: o.clsSwatches,\n                clsSwatch: o.clsSwatch,\n                clsValue: o.clsValue,\n                clsLabel: o.clsLabel,\n                clsInput: o.clsInput,\n                clsUserColorButton: o.clsUserColorButton,\n                clsUserColors: o.clsUserColors,\n                clsUserColorsTitle: o.clsUserColorsTitle,\n                clsUserColor: o.clsUserColor,\n                onColor: o.onColor,\n                onColorSelectorCreate: o.onColorSelectorCreate\n            });\n\n            Metro.makePlugin(colorSelectorBox, 'dropdown', {\n                dropFilter: \".color-picker\",\n                duration: o.duration,\n                toggleElement: [picker],\n                checkDropUp: true,\n                onDrop: function(){\n                    Metro.getPlugin(colorSelector, 'color-selector').val(that.value);\n                }\n            });\n\n            element[0].className = '';\n\n            if (o.copyInlineStyles === true) {\n                $.each(Utils.getInlineStyles(element), function(key, value){\n                    picker.css(key, value);\n                });\n            }\n\n            this._setColor();\n        },\n\n        _clearInputInterval: function(){\n            clearInterval(this.inputInterval);\n            this.inputInterval = false;\n        },\n\n        _setColor: function(){\n            var colorExample = this.colorExample;\n            var color = this.value;\n\n            if (this.value.indexOf(\"cmyk\") !== -1 || this.value.indexOf(\"hsv\") !== -1) {\n                color = Metro.colors.toHEX(this.value);\n            }\n\n            colorExample.css({\n                backgroundColor: color\n            });\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var picker = this.picker,\n                colorSelector = this.colorSelector,\n                colorSelectorBox = this.colorSelector;\n\n            picker.on(Metro.events.click, \".input-clear-button\", function(e){\n                e.preventDefault();\n                e.stopPropagation();\n                element.val(o.defaultValue).trigger(\"change\");\n                Metro.getPlugin(colorSelector, 'color-selector').val(o.defaultValue);\n            });\n\n            element.on(Metro.events.inputchange, function(){\n                that.value = this.value;\n                that._setColor();\n            });\n\n            colorSelectorBox.on(Metro.events.click, function(e){\n                e.stopPropagation();\n            })\n        },\n\n        val: function(v){\n            if (arguments.length === 0 || !Utils.isValue(v)) {\n                return this.value;\n            }\n\n            if (!Metro.colors.isColor(v)) {\n                return ;\n            }\n\n            this.value = v;\n            this.element.val(v).trigger(\"change\");\n            this._setColor();\n        },\n\n        // changeAttribute: function(attr, newValue){\n        // },\n\n        destroy: function(){\n            this.element.remove();\n        }\n    });\n\n    $(document).on(Metro.events.click, function(){\n        $(\".color-picker\").removeClass(\"open\");\n    });\n\n}(Metro, m4q));\n\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var supportedColorTypes = \"hex, rgb, rgba, hsl, hsla, hsv, cmyk\";\n    var Utils = Metro.utils;\n    var ColorSelectorDefaultConfig = {\n        defaultSwatches: \"#FFFFFF,#000000,#FFFB0D,#0532FF,#FF9300,#00F91A,#FF2700,#686868,#EE5464,#D27AEE,#5BA8C4,#E64AA9,#1ba1e2,#6a00ff,#bebebe,#f8f8f8\",\n        userColors: null,\n        returnValueType: \"hex\",\n        returnAsString: true,\n        showValues: supportedColorTypes,\n        showAsString: null,\n        showUserColors: true,\n        controller: null,\n        locale: \"en-US\",\n        addUserColorTitle: null,\n        userColorsTitle: null,\n        hslMode: \"percent\",\n        showAlphaChannel: true,\n        inputThreshold: 300,\n        initColor: null,\n        readonlyInput: false,\n        clsSelector: \"\",\n        clsSwatches: \"\",\n        clsSwatch: \"\",\n        clsValue: \"\",\n        clsLabel: \"\",\n        clsInput: \"\",\n        clsUserColorButton: \"\",\n        clsUserColors: \"\",\n        clsUserColorsTitle: \"\",\n        clsUserColor: \"\",\n        onSelectColor: Metro.noop,\n        onColorSelectorCreate: Metro.noop\n    };\n\n    Metro.colorSelectorSetup = function (options) {\n        ColorSelectorDefaultConfig = $.extend({}, ColorSelectorDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroColorSelectorSetup\"] !== undefined) {\n        Metro.colorSelectorSetup(window[\"metroColorSelectorSetup\"]);\n    }\n\n    Metro.Component('color-selector', {\n        init: function( options, elem ) {\n            this._super(elem, options, ColorSelectorDefaultConfig, {\n                // define instance vars here\n                id: Utils.elementId(\"color-selector\"),\n                defaultSwatches: [],\n                showValues: [],\n                userColors: [],\n                showAsString: [],\n                hue: 0,\n                saturation: 0,\n                lightness: 1,\n                alpha: 1,\n                hsl: null,\n                hsla: null,\n                hsv: null,\n                rgb: null,\n                rgba: null,\n                cmyk: null,\n                hex: null,\n                inputInterval: null,\n                locale: null\n            });\n            return this;\n        },\n\n        _create: function(){\n            var o = this.options;\n\n            if (Utils.isValue(o.defaultSwatches)) this.defaultSwatches = o.defaultSwatches.toArray(\",\").map(function (el){return el.toUpperCase();});\n            if (Utils.isValue(o.showValues)) this.showValues = o.showValues.toArray(\",\");\n            if (Utils.isValue(o.userColors)) this.userColors = o.userColors.toArray(\",\").map(function (el){return el.toUpperCase();});\n            if (Utils.isValue(o.showAsString)) this.showAsString = o.showAsString.toArray(\",\");\n\n            this.locale = Metro.locales[o.locale]['colorSelector'];\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent('color-selector-create');\n        },\n\n        _createStructure: function(){\n            var that = this, element = this.element, o = this.options, locale = this.locale;\n            var colorBox, row, swatches, map, value, inputs, radios,\n                userColorsActions, hueCanvas, shadeCanvas, hueCursor, shadeCursor,\n                colorBlock, alphaCanvas, alphaCursor;\n\n            element.addClass(\"color-selector\").addClass(o.clsSelector);\n\n            element.append( colorBox = $(\"<div>\").addClass(\"color-box\") );\n\n            colorBox.append( row = $(\"<div>\").addClass(\"row\") );\n\n            row.append( swatches = $(\"<div>\").addClass(\"default-swatches\").addClass(o.clsSwatches) );\n            $.each(this.defaultSwatches, function(){\n                swatches.append(\n                    $(\"<button>\")\n                        .attr(\"data-color\", this)\n                        .attr(\"type\", \"button\")\n                        .addClass(\"swatch\")\n                        .addClass(o.clsSwatch)\n                        .css(\"background-color\", this)\n                );\n            });\n\n            colorBox.append( row = $(\"<div>\").addClass(\"row\") );\n\n            row.append( map = $(\"<div>\").addClass(\"color-map\") );\n            map.append( shadeCursor = $(\"<button>\").attr(\"type\", \"button\").addClass(\"cursor color-cursor\") )\n            map.append( shadeCanvas = $(\"<canvas>\").addClass(\"color-canvas\") )\n\n            row.append( map = $(\"<div>\").addClass(\"hue-map\") );\n            map.append( hueCursor = $(\"<button>\").attr(\"type\", \"button\").addClass(\"cursor hue-cursor\") )\n            map.append( hueCanvas = $(\"<canvas>\").addClass(\"hue-canvas\") )\n\n            row.append( map = $(\"<div>\").addClass(\"alpha-map\") );\n            map.append( alphaCursor = $(\"<button>\").attr(\"type\", \"button\").addClass(\"cursor alpha-cursor\") )\n            map.append( alphaCanvas = $(\"<canvas>\").addClass(\"alpha-canvas\") )\n\n            colorBox.append( row = $(\"<div>\").addClass(\"row color-values-block\") );\n\n            row.append( value = $(\"<div>\").addClass(\"color-value-hex\") );\n            value.append( $(\"<input type='radio' name='returnType' value='hex' checked>\").addClass(\"check-color-value-hex\") );\n            value.append( colorBlock = $(\"<div>\").addClass(\"color-block as-string color-hex\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='HEX:'>\").addClass(\"input-small value-hex\") );\n\n            row.append( value = $(\"<div>\").addClass(\"color-value-rgb\") );\n            value.append( $(\"<input type='radio' name='returnType' value='rgb'>\").addClass(\"check-color-value-rgb\") );\n            value.append( colorBlock = $(\"<div>\").addClass(\"color-block color-rgb\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='R:'>\").addClass(\"input-small value-r\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='G:'>\").addClass(\"input-small value-g\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='B:'>\").addClass(\"input-small value-b\") );\n            value.append( colorBlock = $(\"<div>\").addClass(\"color-block as-string color-rgb\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='RGB:'>\").addClass(\"input-small value-rgb\") );\n\n            if (this.showAsString.indexOf(\"rgb\") > -1) {\n                value.find(\".value-r,.value-g,.value-b\").parent().hide();\n            } else {\n                value.find(\".value-rgb\").parent().hide();\n            }\n\n            row.append( value = $(\"<div>\").addClass(\"color-value-rgba\") );\n            value.append( $(\"<input type='radio' name='returnType' value='rgba'>\").addClass(\"check-color-value-rgba\") );\n            value.append( colorBlock = $(\"<div>\").addClass(\"color-block color-rgba\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='R:'>\").addClass(\"input-small value-r\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='G:'>\").addClass(\"input-small value-g\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='B:'>\").addClass(\"input-small value-b\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='A:'>\").addClass(\"input-small value-a\") );\n            value.append( colorBlock = $(\"<div>\").addClass(\"color-block as-string color-rgba\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='RGBA:'>\").addClass(\"input-small value-rgba\") );\n\n            if (this.showAsString.indexOf(\"rgba\") > -1) {\n                value.find(\".value-r,.value-g,.value-b,.value-a\").parent().hide();\n            } else {\n                value.find(\".value-rgba\").parent().hide();\n            }\n\n            row.append( value = $(\"<div>\").addClass(\"color-value-hsl\") );\n            value.append( $(\"<input type='radio' name='returnType' value='hsl'>\").addClass(\"check-color-value-hsl\") );\n            value.append( colorBlock = $(\"<div>\").addClass(\"color-block color-hsl\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='H:'>\").addClass(\"input-small value-h\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='S:'>\").addClass(\"input-small value-s\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='L:'>\").addClass(\"input-small value-l\") );\n            value.append( colorBlock = $(\"<div>\").addClass(\"color-block as-string color-hsl\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='HSL:'>\").addClass(\"input-small value-hsl\") );\n\n            if (this.showAsString.indexOf(\"hsl\") > -1) {\n                value.find(\".value-h,.value-s,.value-l\").parent().hide();\n            } else {\n                value.find(\".value-hsl\").parent().hide();\n            }\n\n            row.append( value = $(\"<div>\").addClass(\"color-value-hsla\") );\n            value.append( $(\"<input type='radio' name='returnType' value='hsla'>\").addClass(\"check-color-value-hsla\") );\n            value.append( colorBlock = $(\"<div>\").addClass(\"color-block color-hsla\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='H:'>\").addClass(\"input-small value-h\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='S:'>\").addClass(\"input-small value-s\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='L:'>\").addClass(\"input-small value-l\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='A:'>\").addClass(\"input-small value-a\") );\n            value.append( colorBlock = $(\"<div>\").addClass(\"color-block as-string color-hsla\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='HSLA:'>\").addClass(\"input-small value-hsla\") );\n\n            if (this.showAsString.indexOf(\"hsla\") > -1) {\n                value.find(\".value-h,.value-s,.value-l,.value-a\").parent().hide();\n            } else {\n                value.find(\".value-hsla\").parent().hide();\n            }\n\n            row.append( value = $(\"<div>\").addClass(\"color-value-hsv\") );\n            value.append( $(\"<input type='radio' name='returnType' value='hsv'>\").addClass(\"check-color-value-hsl\") );\n            value.append( colorBlock = $(\"<div>\").addClass(\"color-block color-hsv\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='H:'>\").addClass(\"input-small value-h\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='S:'>\").addClass(\"input-small value-s\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='V:'>\").addClass(\"input-small value-v\") );\n            value.append( colorBlock = $(\"<div>\").addClass(\"color-block as-string color-hsv\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='HSV:'>\").addClass(\"input-small value-hsv\") );\n\n            if (this.showAsString.indexOf(\"hsv\") > -1) {\n                value.find(\".value-h,.value-s,.value-v\").parent().hide();\n            } else {\n                value.find(\".value-hsv\").parent().hide();\n            }\n\n            row.append( value = $(\"<div>\").addClass(\"color-value-cmyk\") );\n            value.append( $(\"<input type='radio' name='returnType' value='cmyk'>\").addClass(\"check-color-value-cmyk\") );\n            value.append( colorBlock = $(\"<div>\").addClass(\"color-block color-cmyk\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='C:'>\").addClass(\"input-small value-c\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='M:'>\").addClass(\"input-small value-m\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='Y:'>\").addClass(\"input-small value-y\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='K:'>\").addClass(\"input-small value-k\") );\n            value.append( colorBlock = $(\"<div>\").addClass(\"color-block as-string color-cmyk\") );\n            colorBlock.append( $(\"<input type='text' data-prepend='CMYK:'>\").addClass(\"input-small value-cmyk\") );\n\n            if (this.showAsString.indexOf(\"cmyk\") > -1) {\n                value.find(\".value-s,.value-m,.value-y,.value-k\").parent().hide();\n            } else {\n                value.find(\".value-cmyk\").parent().hide();\n            }\n\n            colorBox.append( row = $(\"<div>\").addClass(\"row user-colors-container\") );\n            row.append( $(\"<div>\").addClass(\"user-colors-title\").addClass(o.clsUserColorsTitle).html(o.userColorsTitle || locale['userColorsTitle']) );\n            row.append( $(\"<div>\").addClass(\"user-colors\").addClass(o.clsUserColors) );\n            row.append( userColorsActions = $(\"<div>\").addClass(\"user-colors-actions\") );\n            userColorsActions.append(\n                $(\"<button>\")\n                    .addClass(\"button add-button\")\n                    .addClass(o.clsUserColorButton)\n                    .html(\"<span class='user-swatch'></span><span>\"+(o.addUserColorTitle || locale['addUserColorButton'])+\"</span>\")\n            );\n\n            inputs = colorBox.find(\"input[type=text]\");\n            Metro.makePlugin(inputs, 'input', {\n                clearButton: false,\n                clsPrepend: o.clsLabel,\n                clsComponent: o.clsInput\n            });\n            inputs.addClass(o.clsValue);\n\n            if (o.readonlyInput) {\n                inputs.attr(\"readonly\", true);\n            }\n\n            radios = colorBox.find(\"input[type=radio]\").each(function(){\n                $(this).attr(\"name\", that.id + \"-returnType\");\n            });\n            radios.each(function(){\n                if ($(this).val() === o.returnValueType) {\n                    this.checked = true;\n                }\n            });\n            Metro.makePlugin(radios, 'radio', {\n                style: 2\n            });\n\n            $.each(supportedColorTypes.toArray(\",\"), function(){\n                if (that.showValues.indexOf(this) === -1) element.find(\".color-value-\"+this).hide();\n            });\n\n            if (!o.showUserColors) {\n                element.find(\".user-colors-container\").hide();\n            }\n\n            if (!o.showAlphaChannel) {\n                element.addClass(\"no-alpha-channel\");\n                $.each([\"rgba\", \"hsla\"], function(){\n                    element.find(\".color-value-\"+this).hide();\n                });\n            }\n\n            this._fillUserColors();\n\n            this.hueCanvas = hueCanvas;\n            this.hueCursor = hueCursor;\n            this.shadeCanvas = shadeCanvas;\n            this.shadeCursor = shadeCursor;\n            this.alphaCanvas = alphaCanvas;\n            this.alphaCursor = alphaCursor;\n\n            this._createShadeCanvas();\n            this._createHueCanvas();\n            this._createAlphaCanvas();\n            this._setColorValues();\n            this._updateCursorsColor();\n\n            if (o.initColor && Metro.colors.isColor(o.initColor)) {\n                this._colorToPos(typeof o.initColor === \"string\" ? Metro.colors.parse(o.initColor) : o.initColor);\n            }\n        },\n\n        _createShadeCanvas: function(color){\n            var canvas = this.shadeCanvas[0];\n            var ctx = canvas.getContext('2d');\n\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n            if(!color) color = '#f00';\n\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            ctx.fillStyle = color;\n            ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n            var whiteGradient = ctx.createLinearGradient(0, 0, canvas.width, 0);\n            whiteGradient.addColorStop(0, \"#fff\");\n            whiteGradient.addColorStop(1, \"transparent\");\n            ctx.fillStyle = whiteGradient;\n            ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n            var blackGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);\n            blackGradient.addColorStop(0, \"transparent\");\n            blackGradient.addColorStop(1, \"#000\");\n            ctx.fillStyle = blackGradient;\n            ctx.fillRect(0, 0, canvas.width, canvas.height);\n        },\n\n        _createHueCanvas: function(){\n            var canvas = this.hueCanvas[0];\n            var ctx = canvas.getContext('2d');\n            var hueGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);\n\n            hueGradient.addColorStop(0.00, \"hsl(0,100%,50%)\");\n            hueGradient.addColorStop(0.17, \"hsl(298.8, 100%, 50%)\");\n            hueGradient.addColorStop(0.33, \"hsl(241.2, 100%, 50%)\");\n            hueGradient.addColorStop(0.50, \"hsl(180, 100%, 50%)\");\n            hueGradient.addColorStop(0.67, \"hsl(118.8, 100%, 50%)\");\n            hueGradient.addColorStop(0.83, \"hsl(61.2,100%,50%)\");\n            hueGradient.addColorStop(1.00, \"hsl(360,100%,50%)\");\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            ctx.fillStyle = hueGradient;\n            ctx.fillRect(0, 0, canvas.width, canvas.height);\n        },\n\n        _createAlphaCanvas: function(){\n            var canvas = this.alphaCanvas[0];\n            var ctx = canvas.getContext('2d');\n            var alphaGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);\n            var startColor = new Metro.colorPrimitive.HSLA(this.hue, 1, .5, 1).toString(), endColor = \"rgba(0,0,0,0)\";\n\n            alphaGradient.addColorStop(0.00, startColor);\n            alphaGradient.addColorStop(1.00, endColor);\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            ctx.fillStyle = alphaGradient;\n            ctx.fillRect(0, 0, canvas.width, canvas.height);\n        },\n\n        _updateHueCursor: function(y){\n            this.hueCursor.css({\n                \"top\": y\n            });\n        },\n\n        _updateAlphaCursor: function(y){\n            this.alphaCursor.css({\n                \"top\": y\n            });\n        },\n\n        _getHueColor: function(pageY){\n            var canvas = this.hueCanvas;\n            var offset = canvas.offset();\n            var height = canvas.height();\n            var y, percent, color, hue;\n\n            y = pageY - offset.top;\n\n            if ( y > height ) y = height;\n            if ( y < 0 ) y = 0;\n\n            percent = y / height;\n            hue = 360 - (360 * percent);\n            if (hue === 360) hue = 0;\n            color = \"hsl(\"+ hue +\", 100%, 50%)\";\n            this.hue = hue;\n\n            this._createShadeCanvas(color);\n            this._createAlphaCanvas();\n            this._updateHueCursor(y);\n            this._updateCursorsColor();\n            this._setColorValues();\n        },\n\n        _getAlphaValue: function(pageY){\n            var canvas = this.alphaCanvas;\n            var offset = canvas.offset();\n            var height = canvas.height();\n            var y, percent;\n\n            y = pageY - offset.top;\n\n            if ( y > height ) y = height;\n            if ( y < 0 ) y = 0;\n\n            percent = 1 - y / height;\n            this.alpha = percent.toFixed(2);\n\n            this._updateAlphaCursor(y);\n            this._updateCursorsColor();\n            this._setColorValues();\n        },\n\n        _getShadeColor: function(pageX, pageY){\n            var canvas = this.shadeCanvas;\n            var offset = canvas.offset();\n            var width = canvas.width();\n            var height = canvas.height();\n            var x = pageX - offset.left;\n            var y = pageY - offset.top;\n\n            if(x > width) x = width;\n            if(x < 0) x = 0;\n            if(y > height) y = height;\n            if(y < 0) y = .1;\n\n            var xRatio = x / width * 100;\n            var yRatio = y / height * 100;\n            var hsvValue = 1 - (yRatio / 100);\n            var hsvSaturation = xRatio / 100;\n            var lightness = (hsvValue / 2) * (2 - hsvSaturation);\n            var saturation = (hsvValue * hsvSaturation) / (1 - Math.abs(2 * lightness - 1));\n\n            if (isNaN(lightness)) {\n                lightness = 0;\n            }\n\n            if (isNaN(saturation)) {\n                saturation = 0;\n            }\n\n            this.lightness = lightness;\n            this.saturation = saturation;\n\n            this._updateShadeCursor(x, y);\n            this._updateCursorsColor();\n            this._setColorValues();\n        },\n\n        _updateCursorsColor: function(){\n            this.shadeCursor.css({backgroundColor: Metro.colors.toHEX(new Metro.colorPrimitive.HSL(this.hue, this.saturation, this.lightness))});\n            this.hueCursor.css({backgroundColor: Metro.colors.toHEX(new Metro.colorPrimitive.HSL(this.hue, 1, .5))});\n            this.alphaCursor.css({backgroundColor: Metro.colors.toRGBA(new Metro.colorPrimitive.HSL(this.hue, 1, .5), this.alpha).toString()});\n        },\n\n        _updateShadeCursor: function(x, y){\n            this.shadeCursor.css({\n                top: y,\n                left: x\n            })\n        },\n\n        _colorToPos: function (color){\n            var shadeCanvasRect = this.shadeCanvas[0].getBoundingClientRect();\n            var hueCanvasRect = this.hueCanvas[0].getBoundingClientRect();\n            var alphaCanvasRect = this.alphaCanvas[0].getBoundingClientRect();\n            var hsl = Metro.colors.toHSL(color);\n            var hsla = Metro.colors.toHSLA(color, color.a);\n            var hsv = Metro.colors.toHSV(color);\n            var x = shadeCanvasRect.width * hsv.s;\n            var y = shadeCanvasRect.height * (1 - hsv.v);\n            var hueY = hueCanvasRect.height - ((hsl.h / 360) * hueCanvasRect.height);\n            var alphaY = (1 - hsla.a) * alphaCanvasRect.height;\n\n            this.hue = hsl.h;\n            this.saturation = hsl.s;\n            this.lightness = hsl.l;\n            this.alpha = hsla.a;\n\n            this._updateHueCursor(hueY);\n            this._updateShadeCursor(x, y);\n            this._updateAlphaCursor(alphaY);\n            this._updateCursorsColor();\n            this._createShadeCanvas(\"hsl(\"+ this.hue +\", 100%, 50%)\");\n            this._createAlphaCanvas();\n            this._setColorValues();\n        },\n\n        _setColorValues: function(){\n            var element = this.element, o = this.options;\n            var hsl = Metro.colors.toHSL(new Metro.colorPrimitive.HSL(this.hue, this.saturation, this.lightness));\n            var hsla = Metro.colors.toHSLA(new Metro.colorPrimitive.HSLA(this.hue, this.saturation, this.lightness, this.alpha));\n            var rgb = Metro.colors.toRGB(hsl);\n            var rgba = Metro.colors.toRGBA(rgb, this.alpha);\n            var hsv = Metro.colors.toHSV(hsl);\n            var cmyk = Metro.colors.toCMYK(hsl);\n            var hex = Metro.colors.toHEX(hsl);\n            var controller = $(o.controller);\n            var percent = o.hslMode === \"percent\";\n\n            this.hsl = hsl;\n            this.hsla = hsla;\n            this.hsv = hsv;\n            this.rgb = rgb;\n            this.rgba = rgba;\n            this.hex = hex;\n            this.cmyk = cmyk;\n\n            element.find(\".color-value-hex .value-hex input\").val(hex);\n\n            element.find(\".color-value-rgb .value-r input\").val(rgb.r);\n            element.find(\".color-value-rgb .value-g input\").val(rgb.g);\n            element.find(\".color-value-rgb .value-b input\").val(rgb.b);\n            element.find(\".color-value-rgb .value-rgb input\").val(rgb.toString());\n\n            element.find(\".color-value-rgba .value-r input\").val(rgba.r);\n            element.find(\".color-value-rgba .value-g input\").val(rgba.g);\n            element.find(\".color-value-rgba .value-b input\").val(rgba.b);\n            element.find(\".color-value-rgba .value-a input\").val(rgba.a);\n            element.find(\".color-value-rgba .value-rgba input\").val(rgba.toString());\n\n            element.find(\".color-value-hsl .value-h input\").val(hsl.h.toFixed(0));\n            element.find(\".color-value-hsl .value-s input\").val(percent ? Math.round(hsl.s*100)+\"%\" : hsl.s.toFixed(4));\n            element.find(\".color-value-hsl .value-l input\").val(percent ? Math.round(hsl.l*100)+\"%\" : hsl.l.toFixed(4));\n            element.find(\".color-value-hsl .value-hsl input\").val(hsl.toString());\n\n            element.find(\".color-value-hsla .value-h input\").val(hsla.h.toFixed(0));\n            element.find(\".color-value-hsla .value-s input\").val(percent ? Math.round(hsla.s*100)+\"%\" : hsl.s.toFixed(4));\n            element.find(\".color-value-hsla .value-l input\").val(percent ? Math.round(hsla.l*100)+\"%\" : hsl.l.toFixed(4));\n            element.find(\".color-value-hsla .value-a input\").val(hsla.a);\n            element.find(\".color-value-hsla .value-hsla input\").val(hsla.toString());\n\n            element.find(\".color-value-hsv .value-h input\").val(hsv.h.toFixed(0));\n            element.find(\".color-value-hsv .value-s input\").val(percent ? Math.round(hsv.s*100)+\"%\" : hsv.s.toFixed(4));\n            element.find(\".color-value-hsv .value-v input\").val(percent ? Math.round(hsv.v*100)+\"%\" : hsv.v.toFixed(4));\n            element.find(\".color-value-hsv .value-hsv input\").val(hsv.toString());\n\n            element.find(\".color-value-cmyk .value-c input\").val(cmyk.c.toFixed(0));\n            element.find(\".color-value-cmyk .value-m input\").val(cmyk.m.toFixed(0));\n            element.find(\".color-value-cmyk .value-y input\").val(cmyk.y.toFixed(0));\n            element.find(\".color-value-cmyk .value-k input\").val(cmyk.k.toFixed(0));\n            element.find(\".color-value-cmyk .value-cmyk input\").val(cmyk.toString());\n\n            element.find(\".user-colors-actions .user-swatch\").css({\n                backgroundColor: hex\n            });\n\n            if (controller && controller.length) {\n                controller.val(this.val()).trigger(\"change\");\n            }\n\n            this._fireEvent(\"select-color\", {\n                color: this.val(),\n                primitive: {\n                    hsl: this.hsl,\n                    hsla: this.hsla,\n                    rgb: this.rgb,\n                    rgba: this.rgba,\n                    hsv: this.hsv,\n                    cmyk: this.cmyk,\n                    hex: this.hex\n                }\n            });\n        },\n\n        _clearInputInterval: function(){\n            clearInterval(this.inputInterval);\n            this.inputInterval = false;\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var hueMap = element.find(\".hue-map\");\n            var alphaMap = element.find(\".alpha-map\");\n            var shadeMap = element.find(\".color-map\");\n            var controller = $(o.controller);\n            var colorValues = element.find(\".color-values-block input[type=text]\");\n\n            colorValues.on(Metro.events.inputchange, function(){\n                var input = $(this);\n\n                that._clearInputInterval();\n\n                if (!that.inputInterval) that.inputInterval = setTimeout(function(){\n                    var colorGroup = input.closest(\".color-block\");\n                    var colorType;\n                    var color, parts;\n\n                    if (colorGroup.hasClass(\"color-hex\")) {\n                        colorType = \"hex\";\n                    } else if (colorGroup.hasClass(\"color-rgb\")) {\n                        colorType = \"rgb\";\n                    } else if (colorGroup.hasClass(\"color-rgba\")) {\n                        colorType = \"rgba\";\n                    } else if (colorGroup.hasClass(\"color-hsl\")) {\n                        colorType = \"hsl\";\n                    } else if (colorGroup.hasClass(\"color-hsla\")) {\n                        colorType = \"hsla\";\n                    } else if (colorGroup.hasClass(\"color-hsv\")) {\n                        colorType = \"hsv\";\n                    } else if (colorGroup.hasClass(\"color-cmyk\")) {\n                        colorType = \"cmyk\";\n                    }\n\n                    if (colorGroup.hasClass(\"as-string\")) {\n                        color = input.val();\n                    } else {\n                        parts = [];\n                        $.each(colorGroup.find(\"input\"), function(){\n                            parts.push(this.value);\n                        });\n                        color = colorType + \"(\" +parts.join(\", \")+ \")\";\n                    }\n                    if (color && Metro.colors.isColor(color)) {\n                        that.val(color);\n                    }\n\n                    that._clearInputInterval();\n                }, o.inputThreshold);\n            });\n\n            if (controller && controller.length) {\n                controller.on(Metro.events.inputchange, function(){\n                    that._clearInputInterval();\n                    if (!that.inputInterval) that.inputInterval = setTimeout(function(){\n                        var val = controller.val();\n                        if (val && Metro.colors.isColor(val)) {\n                            that.val(val);\n                        }\n                        that._clearInputInterval();\n                    }, o.inputThreshold);\n                });\n            }\n\n            alphaMap.on(Metro.events.startAll, function(e){\n\n                that._getAlphaValue(Utils.pageXY(e).y);\n                that.alphaCursor.addClass(\"dragging\");\n\n                $(document).on(Metro.events.moveAll, function(e){\n                    e.preventDefault();\n                    that._getAlphaValue(Utils.pageXY(e).y);\n                }, {ns: that.id, passive: false});\n\n                $(document).on(Metro.events.stopAll, function(){\n                    that.alphaCursor.removeClass(\"dragging\");\n                    $(document).off(Metro.events.moveAll, {ns: that.id});\n                    $(document).off(Metro.events.stopAll, {ns: that.id});\n                }, {ns: that.id});\n            });\n\n            hueMap.on(Metro.events.startAll, function(e){\n\n                that._getHueColor(Utils.pageXY(e).y);\n                that.hueCursor.addClass(\"dragging\");\n\n                $(document).on(Metro.events.moveAll, function(e){\n                    e.preventDefault();\n                    that._getHueColor(Utils.pageXY(e).y);\n                }, {ns: that.id, passive: false});\n\n                $(document).on(Metro.events.stopAll, function(){\n                    that.hueCursor.removeClass(\"dragging\");\n                    $(document).off(Metro.events.moveAll, {ns: that.id});\n                    $(document).off(Metro.events.stopAll, {ns: that.id});\n                }, {ns: that.id});\n            });\n\n            shadeMap.on(Metro.events.startAll, function(e){\n\n                that._getShadeColor(Utils.pageXY(e).x, Utils.pageXY(e).y);\n                that.shadeCursor.addClass(\"dragging\");\n\n                $(document).on(Metro.events.moveAll, function(e){\n                    e.preventDefault();\n                    that._getShadeColor(Utils.pageXY(e).x, Utils.pageXY(e).y);\n                }, {ns: that.id, passive: false});\n\n                $(document).on(Metro.events.stopAll, function(){\n                    that.shadeCursor.removeClass(\"dragging\");\n                    $(document).off(Metro.events.moveAll, {ns: that.id});\n                    $(document).off(Metro.events.stopAll, {ns: that.id});\n                }, {ns: that.id})\n            });\n\n            element.on(\"click\", \".swatch\", function(){\n                that._colorToPos($(this).attr(\"data-color\"));\n            });\n\n            element.on(\"click\", \".add-button\", function(){\n                var color = Metro.colors.toHEX(new Metro.colorPrimitive.HSL(that.hue, that.saturation, that.lightness)).toUpperCase();\n\n                if (that.userColors.indexOf(color) > -1) {\n                    return ;\n                }\n\n                that.userColors.push(color);\n\n                element.find(\".user-colors\").append(\n                    $(\"<button>\")\n                        .attr(\"data-color\", color)\n                        .attr(\"type\", \"button\")\n                        .addClass(\"swatch user-swatch\")\n                        .css({\n                            backgroundColor: color\n                        })\n                );\n            });\n\n            element.find(\"input[type=radio]\").on(\"click\", function(){\n                o.returnValueType = $(this).val();\n                that._setColorValues();\n            });\n        },\n\n        val: function(v){\n            var o = this.options;\n\n            if (!Utils.isValue(v) || !Metro.colors.isColor(v)) {\n                var res;\n                switch (o.returnValueType.toLowerCase()) {\n                    case \"rgb\":\n                        res = this.rgb;\n                        break;\n                    case \"rgba\":\n                        res = this.rgba;\n                        break;\n                    case \"hsl\":\n                        res = this.hsl;\n                        break;\n                    case \"hsla\":\n                        res = this.hsla;\n                        break;\n                    case \"hsv\":\n                        res = this.hsv;\n                        break;\n                    case \"cmyk\":\n                        res = this.cmyk;\n                        break;\n                    default: res = this.hex;\n                }\n                return o.returnAsString ? res.toString() : res;\n            }\n\n            if (!Metro.colors.isColor(v)) {\n                return ;\n            }\n\n            this._colorToPos(Metro.colors.parse(v));\n        },\n\n        user: function(v){\n            if (!Utils.isValue(v)) {\n                return this.userColors;\n            }\n\n            if (!Array.isArray(v) && typeof v !== \"string\") {\n                return ;\n            }\n\n            if (typeof v === \"string\") {\n                this.userColors = v.toArray(\",\").map(function (el){return el.toUpperCase();});\n            } else {\n                this.userColors = v.map(function (el){return el.toUpperCase();});\n            }\n\n            this._fillUserColors();\n        },\n\n        _fillUserColors: function(){\n            var colors = this.element.find(\".user-colors\").clear();\n\n            $.each(this.userColors, function(){\n                var color = this;\n                colors.append(\n                    $(\"<button>\")\n                        .attr(\"data-color\", color)\n                        .attr(\"type\", \"button\")\n                        .addClass(\"swatch user-swatch\")\n                        .css({\n                            backgroundColor: color\n                        })\n                )\n            });\n        },\n\n        changeAttribute: function(attr, newValue){\n            var o = this.options;\n\n            if (attr === \"data-return-value-type\") {\n                o.returnValueType = newValue;\n            }\n\n            if (attr === \"data-return-as-string\") {\n                o.returnValueType = Utils.bool(newValue);\n            }\n        },\n\n        destroy: function(){\n            this.element.remove();\n        }\n    });\n\n    Metro.defaults.ColorSelector = ColorSelectorDefaultConfig;\n}(Metro, m4q));\n\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Types = {\n        HEX: \"hex\",\n        HEXA: \"hexa\",\n        RGB: \"rgb\",\n        RGBA: \"rgba\",\n        HSV: \"hsv\",\n        HSL: \"hsl\",\n        HSLA: \"hsla\",\n        CMYK: \"cmyk\",\n        UNKNOWN: \"unknown\"\n    };\n\n    Metro.colorsSetup = function (options) {\n        ColorsDefaultConfig = $.extend({}, ColorsDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroColorsSetup\"] !== undefined) {\n        Metro.colorsSetup(window[\"metroColorsSetup\"]);\n    }\n\n    var ColorsDefaultConfig = {\n        angle: 30,\n        resultType: 'hex',\n        results: 6,\n        baseLight: \"#ffffff\",\n        baseDark: \"self\"\n    };\n\n    // function HEX(r, g, b) {\n    //     this.r = r || \"00\";\n    //     this.g = g || \"00\";\n    //     this.b = b || \"00\";\n    // }\n    //\n    // HEX.prototype.toString = function(){\n    //     return \"#\" + [this.r, this.g, this.b].join(\"\");\n    // }\n\n    // function dec2hex(d){\n    //     return Math.round(parseFloat(d) * 255).toString(16);\n    // }\n    //\n    // function hex2dec(h){\n    //     return (parseInt(h, 16) / 255);\n    // }\n\n    function shift(h, angle){\n        h += angle;\n        while (h >= 360.0) h -= 360.0;\n        while (h < 0.0) h += 360.0;\n        return h;\n    }\n\n    function clamp(val){\n        return Math.min(1, Math.max(0, val));\n    }\n\n    function RGB(r, g, b){\n        this.r = r || 0;\n        this.g = g || 0;\n        this.b = b || 0;\n    }\n\n    RGB.prototype.toString = function(){\n        return \"rgb(\" + [this.r, this.g, this.b].join(\", \") + \")\";\n    }\n\n    function RGBA(r, g, b, a){\n        this.r = r || 0;\n        this.g = g || 0;\n        this.b = b || 0;\n        this.a = a === 0 ? 0 : a || 1;\n    }\n\n    RGBA.prototype.toString = function(){\n        return \"rgba(\" + [this.r, this.g, this.b, parseFloat(this.a).toFixed(2)].join(\", \") + \")\";\n    }\n\n    function HSV(h, s, v){\n        this.h = h || 0;\n        this.s = s || 0;\n        this.v = v || 0;\n    }\n\n    HSV.prototype.toString2 = function(){\n        return \"hsv(\" + [this.h, this.s, this.v].join(\", \") + \")\";\n    }\n\n    HSV.prototype.toString = function(){\n        return \"hsv(\" + [Math.round(this.h), Math.round(this.s*100)+\"%\", Math.round(this.v*100)+\"%\"].join(\", \") + \")\";\n    }\n\n    function HSL(h, s, l){\n        this.h = h || 0;\n        this.s = s || 0;\n        this.l = l || 0;\n    }\n\n    HSL.prototype.toString2 = function(){\n        return \"hsl(\" + [this.h, this.s, this.l].join(\", \") + \")\";\n    }\n\n    HSL.prototype.toString = function(){\n        return \"hsl(\" + [Math.round(this.h), Math.round(this.s*100)+\"%\", Math.round(this.l*100)+\"%\"].join(\", \") + \")\";\n    }\n\n    function HSLA(h, s, l, a){\n        this.h = h || 0;\n        this.s = s || 0;\n        this.l = l || 0;\n        this.a = a === 0 ? 0 : a || 1;\n    }\n\n    HSLA.prototype.toString2 = function(){\n        return \"hsla(\" + [this.h, this.s, this.l, this.a].join(\", \") + \")\";\n    }\n\n    HSLA.prototype.toString = function(){\n        return \"hsla(\" + [Math.round(this.h), Math.round(this.s*100)+\"%\", Math.round(this.l*100)+\"%\", parseFloat(this.a).toFixed(2)].join(\", \") + \")\";\n    }\n\n    function CMYK(c, m, y, k){\n        this.c = c || 0;\n        this.m = m || 0;\n        this.y = y || 0;\n        this.k = k || 0;\n    }\n\n    CMYK.prototype.toString = function(){\n        return \"cmyk(\" + [this.c, this.m, this.y, this.k].join(\", \") + \")\";\n    }\n\n    var Colors = {\n\n        PALETTES: {\n            ALL: \"all\",\n            METRO: \"metro\",\n            STANDARD: \"standard\"\n        },\n\n        metro: {\n            lime: '#a4c400',\n            green: '#60a917',\n            emerald: '#008a00',\n            blue: '#00AFF0',\n            teal: '#00aba9',\n            cyan: '#1ba1e2',\n            cobalt: '#0050ef',\n            indigo: '#6a00ff',\n            violet: '#aa00ff',\n            pink: '#dc4fad',\n            magenta: '#d80073',\n            crimson: '#a20025',\n            red: '#CE352C',\n            orange: '#fa6800',\n            amber: '#f0a30a',\n            yellow: '#fff000',\n            brown: '#825a2c',\n            olive: '#6d8764',\n            steel: '#647687',\n            mauve: '#76608a',\n            taupe: '#87794e'\n        },\n\n        standard: {\n            aliceblue: \"#f0f8ff\",\n            antiquewhite: \"#faebd7\",\n            aqua: \"#00ffff\",\n            aquamarine: \"#7fffd4\",\n            azure: \"#f0ffff\",\n            beige: \"#f5f5dc\",\n            bisque: \"#ffe4c4\",\n            black: \"#000000\",\n            blanchedalmond: \"#ffebcd\",\n            blue: \"#0000ff\",\n            blueviolet: \"#8a2be2\",\n            brown: \"#a52a2a\",\n            burlywood: \"#deb887\",\n            cadetblue: \"#5f9ea0\",\n            chartreuse: \"#7fff00\",\n            chocolate: \"#d2691e\",\n            coral: \"#ff7f50\",\n            cornflowerblue: \"#6495ed\",\n            cornsilk: \"#fff8dc\",\n            crimson: \"#dc143c\",\n            cyan: \"#00ffff\",\n            darkblue: \"#00008b\",\n            darkcyan: \"#008b8b\",\n            darkgoldenrod: \"#b8860b\",\n            darkgray: \"#a9a9a9\",\n            darkgreen: \"#006400\",\n            darkkhaki: \"#bdb76b\",\n            darkmagenta: \"#8b008b\",\n            darkolivegreen: \"#556b2f\",\n            darkorange: \"#ff8c00\",\n            darkorchid: \"#9932cc\",\n            darkred: \"#8b0000\",\n            darksalmon: \"#e9967a\",\n            darkseagreen: \"#8fbc8f\",\n            darkslateblue: \"#483d8b\",\n            darkslategray: \"#2f4f4f\",\n            darkturquoise: \"#00ced1\",\n            darkviolet: \"#9400d3\",\n            deeppink: \"#ff1493\",\n            deepskyblue: \"#00bfff\",\n            dimgray: \"#696969\",\n            dodgerblue: \"#1e90ff\",\n            firebrick: \"#b22222\",\n            floralwhite: \"#fffaf0\",\n            forestgreen: \"#228b22\",\n            fuchsia: \"#ff00ff\",\n            gainsboro: \"#DCDCDC\",\n            ghostwhite: \"#F8F8FF\",\n            gold: \"#ffd700\",\n            goldenrod: \"#daa520\",\n            gray: \"#808080\",\n            green: \"#008000\",\n            greenyellow: \"#adff2f\",\n            honeydew: \"#f0fff0\",\n            hotpink: \"#ff69b4\",\n            indianred: \"#cd5c5c\",\n            indigo: \"#4b0082\",\n            ivory: \"#fffff0\",\n            khaki: \"#f0e68c\",\n            lavender: \"#e6e6fa\",\n            lavenderblush: \"#fff0f5\",\n            lawngreen: \"#7cfc00\",\n            lemonchiffon: \"#fffacd\",\n            lightblue: \"#add8e6\",\n            lightcoral: \"#f08080\",\n            lightcyan: \"#e0ffff\",\n            lightgoldenrodyellow: \"#fafad2\",\n            lightgray: \"#d3d3d3\",\n            lightgreen: \"#90ee90\",\n            lightpink: \"#ffb6c1\",\n            lightsalmon: \"#ffa07a\",\n            lightseagreen: \"#20b2aa\",\n            lightskyblue: \"#87cefa\",\n            lightslategray: \"#778899\",\n            lightsteelblue: \"#b0c4de\",\n            lightyellow: \"#ffffe0\",\n            lime: \"#00ff00\",\n            limegreen: \"#32dc32\",\n            linen: \"#faf0e6\",\n            magenta: \"#ff00ff\",\n            maroon: \"#800000\",\n            mediumaquamarine: \"#66cdaa\",\n            mediumblue: \"#0000cd\",\n            mediumorchid: \"#ba55d3\",\n            mediumpurple: \"#9370db\",\n            mediumseagreen: \"#3cb371\",\n            mediumslateblue: \"#7b68ee\",\n            mediumspringgreen: \"#00fa9a\",\n            mediumturquoise: \"#48d1cc\",\n            mediumvioletred: \"#c71585\",\n            midnightblue: \"#191970\",\n            mintcream: \"#f5fffa\",\n            mistyrose: \"#ffe4e1\",\n            moccasin: \"#ffe4b5\",\n            navajowhite: \"#ffdead\",\n            navy: \"#000080\",\n            oldlace: \"#fdd5e6\",\n            olive: \"#808000\",\n            olivedrab: \"#6b8e23\",\n            orange: \"#ffa500\",\n            orangered: \"#ff4500\",\n            orchid: \"#da70d6\",\n            palegoldenrod: \"#eee8aa\",\n            palegreen: \"#98fb98\",\n            paleturquoise: \"#afeeee\",\n            palevioletred: \"#db7093\",\n            papayawhip: \"#ffefd5\",\n            peachpuff: \"#ffdab9\",\n            peru: \"#cd853f\",\n            pink: \"#ffc0cb\",\n            plum: \"#dda0dd\",\n            powderblue: \"#b0e0e6\",\n            purple: \"#800080\",\n            rebeccapurple: \"#663399\",\n            red: \"#ff0000\",\n            rosybrown: \"#bc8f8f\",\n            royalblue: \"#4169e1\",\n            saddlebrown: \"#8b4513\",\n            salmon: \"#fa8072\",\n            sandybrown: \"#f4a460\",\n            seagreen: \"#2e8b57\",\n            seashell: \"#fff5ee\",\n            sienna: \"#a0522d\",\n            silver: \"#c0c0c0\",\n            slyblue: \"#87ceeb\",\n            slateblue: \"#6a5acd\",\n            slategray: \"#708090\",\n            snow: \"#fffafa\",\n            springgreen: \"#00ff7f\",\n            steelblue: \"#4682b4\",\n            tan: \"#d2b48c\",\n            teal: \"#008080\",\n            thistle: \"#d8bfd8\",\n            tomato: \"#ff6347\",\n            turquoise: \"#40e0d0\",\n            violet: \"#ee82ee\",\n            wheat: \"#f5deb3\",\n            white: \"#ffffff\",\n            whitesmoke: \"#f5f5f5\",\n            yellow: \"#ffff00\",\n            yellowgreen: \"#9acd32\"\n        },\n\n        all: {},\n\n        init: function(){\n            this.all = $.extend( {}, this.standard, this.metro );\n            return this;\n        },\n\n        color: function(name, palette){\n            palette = palette || this.PALETTES.ALL;\n            return this[palette][name] !== undefined ? this[palette][name] : false;\n        },\n\n        palette: function(palette){\n            palette = palette || this.PALETTES.ALL;\n            return Object.keys(this[palette]);\n        },\n\n        expandHexColor: function(hex){\n            if (typeof hex !== \"string\") {\n                throw new Error(\"Value is not a string!\");\n            }\n            if (hex[0] === \"#\" && hex.length === 4) {\n                var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n                return (\n                    \"#\" +\n                    hex.replace(shorthandRegex, function(m, r, g, b) {\n                        return r + r + g + g + b + b;\n                    })\n                );\n            }\n            return hex[0] === \"#\" ? hex : \"#\" + hex;\n        },\n\n        colors: function(palette){\n            palette = palette || this.PALETTES.ALL;\n            return Object.values(this[palette]);\n        },\n\n        random: function(colorType, alpha){\n            colorType = colorType || Types.HEX;\n            alpha = typeof alpha !== \"undefined\" ? alpha : 1;\n\n            var hex, r, g, b;\n\n            r = $.random(0, 255);\n            g = $.random(0, 255);\n            b = $.random(0, 255);\n\n            hex = \"#\" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);\n\n            return colorType === \"hex\" ? hex : this.toColor(hex, colorType, alpha);\n        },\n\n        parse: function(color){\n            var _color = color.toLowerCase().trim();\n\n            var a = _color\n                .replace(/[^%\\d.,]/g, \"\")\n                .split(\",\")\n                .map(function(v) {\n                    if (v.indexOf('%') > -1) {\n                        v = \"\"+parseInt(v)/100;\n                    }\n                    return v.indexOf(\".\") > -1 ? parseFloat(v) : parseInt(v);\n                });\n\n            if (this.metro[_color]) {\n                return this.expandHexColor(this.metro[_color]);\n            }\n\n            if (this.standard[_color]) {\n                return this.expandHexColor(this.standard[_color]);\n            }\n\n            if (_color[0] === \"#\") {\n                return this.expandHexColor(_color);\n            }\n\n            if (_color.indexOf(\"rgba\") === 0 && a.length === 4) {\n                return new RGBA(a[0], a[1], a[2], a[3]);\n            }\n            if (_color.indexOf(\"rgb\") === 0 && a.length === 3) {\n                return new RGB(a[0], a[1], a[2]);\n            }\n            if (_color.indexOf(\"cmyk\") === 0 && a.length === 4) {\n                return new CMYK(a[0], a[1], a[2], a[3]);\n            }\n            if (_color.indexOf(\"hsv\") === 0 && a.length === 3) {\n                return new HSV(a[0], a[1], a[2]);\n            }\n            if (_color.indexOf(\"hsla\") === 0 && a.length === 4) {\n                return new HSLA(a[0], a[1], a[2], a[3]);\n            }\n            if (_color.indexOf(\"hsl\")  === 0 && a.length === 3) {\n                return new HSL(a[0], a[1], a[2]);\n            }\n            return undefined;\n        },\n\n        createColor: function(colorType, from){\n            colorType = colorType || \"hex\";\n            from = from || \"#000000\";\n\n            var baseColor;\n\n            if (typeof from === \"string\") {\n                baseColor = this.parse(from);\n            }\n\n            if (!this.isColor(baseColor)) {\n                baseColor = \"#000000\";\n            }\n\n            return this.toColor(baseColor, colorType.toLowerCase());\n        },\n\n        isDark: function(color){\n            if (!this.isColor(color)) return;\n            var rgb = this.toRGB(color);\n            var YIQ = (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;\n            return YIQ < 128;\n        },\n\n        isLight: function(color){\n            return !this.isDark(color);\n        },\n\n        isHSV: function(color){\n            return color instanceof HSV;\n        },\n\n        isHSL: function(color){\n            return color instanceof HSL;\n        },\n\n        isHSLA: function(color){\n            return color instanceof HSLA;\n        },\n\n        isRGB: function(color){\n            return color instanceof RGB;\n        },\n\n        isRGBA: function(color){\n            return color instanceof RGBA;\n        },\n\n        isCMYK: function(color){\n            return color instanceof CMYK;\n        },\n\n        isHEX: function(color){\n            return /(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(color);\n        },\n\n        isColor: function(val){\n            var color = typeof val === \"string\" ? this.parse(val) : val;\n\n            return !color\n                ? false\n                : this.isHEX(color) ||\n                  this.isRGB(color) ||\n                  this.isRGBA(color) ||\n                  this.isHSV(color) ||\n                  this.isHSL(color) ||\n                  this.isHSLA(color) ||\n                  this.isCMYK(color);\n        },\n\n        check: function(color, type){\n            var that = this, checkFor = typeof type === \"string\" ? [type] : type;\n            var result = false;\n\n            $.each(checkFor, function(){\n                if (that[\"is\"+this.toUpperCase()](color)) {\n                    result = true;\n                }\n            });\n\n            if (!result) {\n                throw new Error(\"Value is not a \" + type + \" color type!\");\n            }\n        },\n\n        colorType: function(color){\n            if (this.isHEX(color)) return Types.HEX;\n            if (this.isRGB(color)) return Types.RGB;\n            if (this.isRGBA(color)) return Types.RGBA;\n            if (this.isHSV(color)) return Types.HSV;\n            if (this.isHSL(color)) return Types.HSL;\n            if (this.isHSLA(color)) return Types.HSLA;\n            if (this.isCMYK(color)) return Types.CMYK;\n\n            return Types.UNKNOWN;\n        },\n\n        equal: function(color1, color2){\n            if (!this.isColor(color1) || !this.isColor(color2)) {\n                return false;\n            }\n\n            return this.toHEX(color1) === this.toHEX(color2);\n        },\n\n        colorToString: function(color){\n            return color.toString();\n        },\n\n        hex2rgb: function(color){\n            if (typeof color !== \"string\") {\n                throw new Error(\"Value is not a string!\")\n            }\n            var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(\n                this.expandHexColor(color)\n            );\n            var rgb = [\n                parseInt(result[1], 16),\n                parseInt(result[2], 16),\n                parseInt(result[3], 16)\n            ];\n            return result ? new RGB(rgb[0], rgb[1], rgb[2]) : null;\n        },\n\n        // TODO can be improved\n        rgb2hex: function(color){\n            this.check(color, \"rgb\");\n            return (\n                \"#\" +\n                ((1 << 24) + (color.r << 16) + (color.g << 8) + color.b).toString(16).slice(1)\n            );\n        },\n\n        rgb2hsv: function(color){\n            this.check(color, \"rgb\");\n            var hsv = new HSV();\n            var h, s, v;\n            var r = color.r / 255,\n                g = color.g / 255,\n                b = color.b / 255;\n\n            var max = Math.max(r, g, b);\n            var min = Math.min(r, g, b);\n            var delta = max - min;\n\n            v = max;\n\n            if (max === 0) {\n                s = 0;\n            } else {\n                s = 1 - min / max;\n            }\n\n            if (max === min) {\n                h = 0;\n            } else if (max === r && g >= b) {\n                h = 60 * ((g - b) / delta);\n            } else if (max === r && g < b) {\n                h = 60 * ((g - b) / delta) + 360;\n            } else if (max === g) {\n                h = 60 * ((b - r) / delta) + 120;\n            } else if (max === b) {\n                h = 60 * ((r - g) / delta) + 240;\n            } else {\n                h = 0;\n            }\n\n            hsv.h = h;\n            hsv.s = s;\n            hsv.v = v;\n\n            return hsv;\n        },\n\n        hsv2rgb: function(color){\n            this.check(color, \"hsv\");\n            var r, g, b;\n            var h = color.h,\n                s = color.s * 100,\n                v = color.v * 100;\n            var Hi = Math.floor(h / 60);\n            var Vmin = ((100 - s) * v) / 100;\n            var alpha = (v - Vmin) * ((h % 60) / 60);\n            var Vinc = Vmin + alpha;\n            var Vdec = v - alpha;\n\n            switch (Hi) {\n                case 0:\n                    r = v;\n                    g = Vinc;\n                    b = Vmin;\n                    break;\n                case 1:\n                    r = Vdec;\n                    g = v;\n                    b = Vmin;\n                    break;\n                case 2:\n                    r = Vmin;\n                    g = v;\n                    b = Vinc;\n                    break;\n                case 3:\n                    r = Vmin;\n                    g = Vdec;\n                    b = v;\n                    break;\n                case 4:\n                    r = Vinc;\n                    g = Vmin;\n                    b = v;\n                    break;\n                case 5:\n                    r = v;\n                    g = Vmin;\n                    b = Vdec;\n                    break;\n            }\n\n            return new RGB(\n                Math.round((r * 255) / 100),\n                Math.round((g * 255) / 100),\n                Math.round((b * 255) / 100)\n            );\n        },\n\n        hsv2hex: function(color){\n            this.check(color, \"hsv\");\n            return this.rgb2hex(this.hsv2rgb(color));\n        },\n\n        hex2hsv: function(color){\n            this.check(color, \"hex\");\n            return this.rgb2hsv(this.hex2rgb(color));\n        },\n\n        rgb2cmyk: function(color){\n            this.check(color, \"rgb\");\n            var cmyk = new CMYK();\n\n            var r = color.r / 255;\n            var g = color.g / 255;\n            var b = color.b / 255;\n\n            cmyk.k = Math.min(1 - r, 1 - g, 1 - b);\n\n            cmyk.c = 1 - cmyk.k === 0 ? 0 : (1 - r - cmyk.k) / (1 - cmyk.k);\n            cmyk.m = 1 - cmyk.k === 0 ? 0 : (1 - g - cmyk.k) / (1 - cmyk.k);\n            cmyk.y = 1 - cmyk.k === 0 ? 0 : (1 - b - cmyk.k) / (1 - cmyk.k);\n\n            cmyk.c = Math.round(cmyk.c * 100);\n            cmyk.m = Math.round(cmyk.m * 100);\n            cmyk.y = Math.round(cmyk.y * 100);\n            cmyk.k = Math.round(cmyk.k * 100);\n\n            return cmyk;\n        },\n\n        cmyk2rgb: function(color){\n            this.check(color, \"cmyk\");\n            var r = Math.floor(255 * (1 - color.c / 100) * (1 - color.k / 100));\n            var g = Math.ceil(255 * (1 - color.m / 100) * (1 - color.k / 100));\n            var b = Math.ceil(255 * (1 - color.y / 100) * (1 - color.k / 100));\n\n            return new RGB(r, g, b);\n        },\n\n        hsv2hsl: function(color){\n            this.check(color, \"hsv\");\n            var h, s, l, d;\n            h = color.h;\n            l = (2 - color.s) * color.v;\n            s = color.s * color.v;\n            if (l === 0) {\n                s = 0;\n            } else {\n                d = l <= 1 ? l : 2 - l;\n                if (d === 0) {\n                    s = 0;\n                } else {\n                    s /= d;\n                }\n            }\n            l /= 2;\n            return new HSL(h, s, l);\n        },\n\n        hsl2hsv: function(color){\n            this.check(color, [\"hsl\", \"hsla\"]);\n            var h, s, v, l;\n            h = color.h;\n            l = color.l * 2;\n            s = color.s * (l <= 1 ? l : 2 - l);\n\n            v = (l + s) / 2;\n\n            if (l + s === 0) {\n                s = 0;\n            } else {\n                s = (2 * s) / (l + s);\n            }\n\n            return new HSV(h, s, v);\n        },\n\n        rgb2websafe: function(color){\n            this.check(color, \"rgb\");\n            return new RGB(\n                Math.round(color.r / 51) * 51,\n                Math.round(color.g / 51) * 51,\n                Math.round(color.b / 51) * 51\n            );\n        },\n\n        rgba2websafe: function(color){\n            this.check(color, \"rgba\");\n            var rgbWebSafe = this.rgb2websafe(color);\n            return new RGBA(rgbWebSafe.r, rgbWebSafe.g, rgbWebSafe.b, color.a);\n        },\n\n        hex2websafe: function(color){\n            this.check(color, \"hex\");\n            return this.rgb2hex(this.rgb2websafe(this.hex2rgb(color)));\n        },\n\n        hsv2websafe: function(color){\n            this.check(color, \"hsv\");\n            return this.rgb2hsv(this.rgb2websafe(this.toRGB(color)));\n        },\n\n        hsl2websafe: function(color){\n           this.check(color, \"hsl\");\n            return this.hsv2hsl(this.rgb2hsv(this.rgb2websafe(this.toRGB(color))));\n        },\n\n        cmyk2websafe: function(color){\n            this.check(color, \"cmyk\");\n            return this.rgb2cmyk(this.rgb2websafe(this.cmyk2rgb(color)));\n        },\n\n        websafe: function(color){\n            if (this.isHEX(color)) return this.hex2websafe(color);\n            if (this.isRGB(color)) return this.rgb2websafe(color);\n            if (this.isRGBA(color)) return this.rgba2websafe(color);\n            if (this.isHSV(color)) return this.hsv2websafe(color);\n            if (this.isHSL(color)) return this.hsl2websafe(color);\n            if (this.isCMYK(color)) return this.cmyk2websafe(color);\n\n            return color;\n        },\n\n        toColor: function(color, type, alpha){\n            var result;\n            switch (type.toLowerCase()) {\n                case \"hex\":\n                    result = this.toHEX(color);\n                    break;\n                case \"rgb\":\n                    result = this.toRGB(color);\n                    break;\n                case \"rgba\":\n                    result = this.toRGBA(color, alpha);\n                    break;\n                case \"hsl\":\n                    result = this.toHSL(color);\n                    break;\n                case \"hsla\":\n                    result = this.toHSLA(color, alpha);\n                    break;\n                case \"hsv\":\n                    result = this.toHSV(color);\n                    break;\n                case \"cmyk\":\n                    result = this.toCMYK(color);\n                    break;\n                default:\n                    result = color;\n            }\n            return result;\n        },\n\n        toHEX: function(val){\n            var color = typeof val === \"string\" ? this.parse(val) : val;\n\n            if (!color) {\n                throw new Error(\"Unknown color format!\");\n            }\n\n            return typeof color === \"string\"\n                ? color\n                : this.rgb2hex(this.toRGB(color));\n        },\n\n        toRGB: function(val){\n            var color = typeof val === \"string\" ? this.parse(val) : val;\n\n            if (this.isRGB(color)) return color;\n            if (this.isRGBA(color)) return new RGB(color.r, color.g, color.b);\n            if (this.isHSV(color)) return this.hsv2rgb(color);\n            if (this.isHSL(color)) return this.hsv2rgb(this.hsl2hsv(color));\n            if (this.isHSLA(color)) return this.hsv2rgb(this.hsl2hsv(color));\n            if (this.isHEX(color)) return this.hex2rgb(color);\n            if (this.isCMYK(color)) return this.cmyk2rgb(color);\n\n            throw new Error(\"Unknown color format!\");\n        },\n\n        toRGBA: function(color, alpha){\n            if (this.isRGBA(color)) {\n                if (alpha) {\n                    color.a = alpha;\n                }\n                return color;\n            }\n            var rgb = this.toRGB(color);\n            return new RGBA(rgb.r, rgb.g, rgb.b, alpha);\n        },\n\n        toHSV: function(color){\n            return this.rgb2hsv(this.toRGB(color));\n        },\n\n        toHSL: function(color){\n            return this.hsv2hsl(this.rgb2hsv(this.toRGB(color)));\n        },\n\n        toHSLA: function(color, alpha){\n            if (this.isHSLA(color)) {\n                if (alpha) {\n                    color.a = alpha;\n                }\n                return color;\n            }\n            var hsla = this.hsv2hsl(this.rgb2hsv(this.toRGB(color)));\n            hsla.a = alpha;\n            return new HSLA(hsla.h, hsla.s, hsla.l, hsla.a);\n        },\n\n        toCMYK: function(color){\n            return this.rgb2cmyk(this.toRGB(color));\n        },\n\n        grayscale: function(color){\n            return this.desaturate(color, 100);\n        },\n\n        lighten: function(color, amount){\n            var hsl, type, alpha;\n\n            if (!this.isColor(color)) {\n                throw new Error(color + \" is not a valid color value!\");\n            }\n\n            amount = (amount === 0) ? 0 : (amount || 10);\n            hsl = this.toHSL(color);\n            hsl.l += amount / 100;\n            hsl.l = clamp(hsl.l);\n\n            type = this.colorType(color).toLowerCase();\n\n            if (type === Types.RGBA || type === Types.HSLA) {\n                alpha = color.a;\n            }\n\n            return this.toColor(hsl, type, alpha);\n        },\n\n        darken: function(color, amount){\n            return this.lighten(color, -amount);\n        },\n\n        spin: function(color, amount){\n            var hsl, type, alpha, hue;\n\n            if (!this.isColor(color)) {\n                throw new Error(color + \" is not a valid color value!\");\n            }\n\n            hsl = this.toHSL(color);\n            hue = (hsl.h + amount) % 360;\n            hsl.h = hue < 0 ? 360 + hue : hue;\n\n            type = this.colorType(color).toLowerCase();\n\n            if (type === Types.RGBA || type === Types.HSLA) {\n                alpha = color.a;\n            }\n\n            return this.toColor(hsl, type, alpha);\n        },\n\n        brighten: function(color, amount){\n            var rgb, type, alpha;\n\n            if (!this.isColor(color)) {\n                throw new Error(color + \" is not a valid color value!\");\n            }\n\n            rgb = this.toRGB(color);\n            rgb.r = Math.max(0, Math.min(255, rgb.r - Math.round(255 * - (amount / 100))));\n            rgb.g = Math.max(0, Math.min(255, rgb.g - Math.round(255 * - (amount / 100))));\n            rgb.b = Math.max(0, Math.min(255, rgb.b - Math.round(255 * - (amount / 100))));\n\n            type = this.colorType(color).toLowerCase();\n\n            if (type === Types.RGBA || type === Types.HSLA) {\n                alpha = color.a;\n            }\n\n            return this.toColor(rgb, type, alpha);\n        },\n\n        saturate: function(color, amount){\n            var hsl, type, alpha;\n\n            if (!this.isColor(color)) {\n                throw new Error(color + \" is not a valid color value!\");\n            }\n\n            hsl = this.toHSL(color);\n            hsl.s += amount / 100;\n            hsl.s = clamp(hsl.s);\n\n            type = this.colorType(color).toLowerCase();\n\n            if (type === Types.RGBA || type === Types.HSLA) {\n                alpha = color.a;\n            }\n\n            return this.toColor(hsl, type, alpha);\n        },\n\n        desaturate: function(color, amount){\n            var hsl, type, alpha;\n\n            if (!this.isColor(color)) {\n                throw new Error(color + \" is not a valid color value!\");\n            }\n\n            hsl = this.toHSL(color);\n            hsl.s -= amount / 100;\n            hsl.s = clamp(hsl.s);\n\n            type = this.colorType(color).toLowerCase();\n\n            if (type === Types.RGBA || type === Types.HSLA) {\n                alpha = color.a;\n            }\n\n            return this.toColor(hsl, type, alpha);\n        },\n\n        hueShift: function(color, hue, saturation, value){\n            var hsv = this.toHSV(color);\n            var type = this.colorType(color).toLowerCase();\n            var h = hsv.h;\n            var alpha;\n            var _h = hue || 0;\n            var _s = saturation || 0;\n            var _v = value || 0;\n\n            h += _h;\n            while (h >= 360.0) h -= 360.0;\n            while (h < 0.0) h += 360.0;\n            hsv.h = h;\n\n            hsv.s += _s;\n            if (hsv.s > 1) {hsv.s = 1;}\n            if (hsv.s < 0) {hsv.s = 0;}\n\n            hsv.v += _v;\n            if (hsv.v > 1) {hsv.v = 1;}\n            if (hsv.v < 0) {hsv.v = 0;}\n\n            if (type === Types.RGBA || type === Types.HSLA) {\n                alpha = color.a;\n            }\n\n            return this.toColor(hsv, type, alpha);\n        },\n\n        shade: function(color, amount){\n            if (!this.isColor(color)) {\n                throw new Error(color + \" is not a valid color value!\");\n            }\n\n            amount /= 100;\n\n            var type = this.colorType(color).toLowerCase();\n            var rgb = this.toRGB(color);\n            var t = amount < 0 ? 0 : 255;\n            var p = amount < 0 ? amount * -1 : amount;\n            var r, g, b, a;\n\n            r = (Math.round((t - rgb.r) * p) + rgb.r);\n            g = (Math.round((t - rgb.g) * p) + rgb.g);\n            b = (Math.round((t - rgb.b) * p) + rgb.b);\n\n            if (type === Types.RGBA || type === Types.HSLA) {\n                a = color.a;\n            }\n\n            return this.toColor(new RGB(r, g, b), type, a);\n        },\n\n        mix: function(color1, color2, amount){\n\n            amount = (amount === 0) ? 0 : (amount || 50);\n\n            var rgb = new RGB(0,0,0);\n            var rgb1 = this.toRGB(color1);\n            var rgb2 = this.toRGB(color2);\n\n            var p = amount / 100;\n\n            rgb.r = Math.round(((rgb2.r - rgb1.r) * p) + rgb1.r);\n            rgb.g = Math.round(((rgb2.g - rgb1.g) * p) + rgb1.g);\n            rgb.b = Math.round(((rgb2.b - rgb1.b) * p) + rgb1.b);\n\n            return this.toHEX(rgb);\n        },\n\n        multiply: function(color1, color2){\n            var rgb1 = this.toRGB(color1);\n            var rgb2 = this.toRGB(color2);\n            var rgb = new RGB();\n\n            rgb1.b = Math.floor(rgb1.b * rgb2.b / 255);\n            rgb1.g = Math.floor(rgb1.g * rgb2.g / 255);\n            rgb1.r = Math.floor(rgb1.r * rgb2.r / 255);\n\n            return this.toHEX(rgb);\n        },\n\n        materialPalette: function(color, options){\n            var opt = $.extend({}, ColorsDefaultConfig, options);\n            var baseLight = opt.baseLight;\n            var baseDark = opt.baseDark === \"self\" || !opt.baseDark ? this.multiply(color, color) : opt.baseDark;\n\n            return {\n                \"50\": this.mix(baseLight, color, 10),\n                \"100\": this.mix(baseLight, color, 30),\n                \"200\": this.mix(baseLight, color, 50),\n                \"300\": this.mix(baseLight, color, 70),\n                \"400\": this.mix(baseLight, color, 85),\n                \"500\": this.mix(baseLight, color, 100),\n                \"600\": this.mix(baseDark, color, 92),\n                \"700\": this.mix(baseDark, color, 83),\n                \"800\": this.mix(baseDark, color, 74),\n                \"900\": this.mix(baseDark, color, 65),\n\n                \"A100\": this.lighten(this.saturate(this.mix(baseDark, color, 15), 80), 65),\n                \"A200\": this.lighten(this.saturate(this.mix(baseDark, color, 15), 80), 55),\n                \"A400\": this.lighten(this.saturate(this.mix(baseLight, color, 100), 55), 10),\n                \"A700\": this.lighten(this.saturate(this.mix(baseDark, color, 83), 65), 10)\n            };\n        },\n\n        monochromatic: function(color, options){\n            var opt = $.extend({}, ColorsDefaultConfig, options);\n            var returnAs = opt.resultType;\n            var results = opt.results;\n            var hsv = this.toHSV(color);\n            var h = hsv.h,\n                s = hsv.s,\n                v = hsv.v;\n            var result = [];\n            var mod = 1 / results;\n            var self = this;\n\n            while (results--) {\n                result.push(new HSV(h, s, v));\n                v = (v + mod) % 1;\n            }\n\n            return result.map(function(el){\n                return self[\"to\"+returnAs.toUpperCase()](el);\n            });\n        },\n\n        complementary: function(color, options){\n            var opt = $.extend({}, ColorsDefaultConfig, options);\n            var hsl = this.toHSL(color);\n            var result;\n            var self = this;\n\n            var returnAs = opt.resultType;\n\n            result = [\n                hsl,\n                new HSL(shift(hsl.h, 180), hsl.s, hsl.l)\n            ];\n\n            return result.map(function(el){\n                return self[\"to\"+returnAs.toUpperCase()](el);\n            });\n        },\n\n        splitComplementary: function(color, options){\n            var opt = $.extend({}, ColorsDefaultConfig, options);\n            var hsl = this.toHSL(color);\n            var h = hsl.h;\n            var result, self = this;\n\n            var returnAs = opt.resultType;\n            var angle = opt.angle;\n\n            result = [\n                hsl,\n                new HSL(shift(h, 180 - angle), hsl.s, hsl.l ),\n                new HSL(shift(h, 180 + angle), hsl.s, hsl.l )\n            ];\n\n            return result.map(function(el){\n                return self[\"to\"+returnAs.toUpperCase()](el);\n            });\n        },\n\n        doubleComplementary: function(color, options){\n            var opt = $.extend({}, ColorsDefaultConfig, options);\n            var returnAs = opt.resultType;\n            var angle = opt.angle;\n            var hsl = this.toHSL(color);\n            var h = hsl.h;\n            var result, self = this;\n\n            result = [\n                hsl,\n                new HSL(shift(h, 180), hsl.s, hsl.l ),\n                new HSL(shift(h, angle), hsl.s, hsl.l ),\n                new HSL(shift(h, 180 + angle), hsl.s, hsl.l )\n            ];\n\n            return result.map(function(el){\n                return self[\"to\"+returnAs.toUpperCase()](el);\n            });\n        },\n\n        square: function(color, options){\n            var opt = $.extend({}, ColorsDefaultConfig, options);\n            var returnAs = opt.resultType;\n            var result = [], i;\n            var hsl = this.toHSL(color);\n            var h = hsl.h , self = this;\n\n            result.push(hsl);\n\n            for (i = 1; i < 4; i++) {\n                h = shift(h, 90.0);\n                result.push(new HSL(h, hsl.s, hsl.l));\n            }\n\n            return result.map(function(el){\n                return self[\"to\"+returnAs.toUpperCase()](el);\n            });\n        },\n\n        tetradic: function(color, options){\n            var opt = $.extend({}, ColorsDefaultConfig, options);\n            var returnAs = opt.resultType;\n            var angle = opt.angle;\n            var result;\n            var hsl = this.toHSL(color);\n            var h = hsl.h;\n            var self = this;\n\n            result = [\n                hsl,\n                new HSL(shift(h, 180), hsl.s, hsl.l),\n                new HSL(shift(h, 180 - angle), hsl.s, hsl.l),\n                new HSL(shift(h, -angle), hsl.s, hsl.l)\n            ];\n\n            return result.map(function(el){\n                return self[\"to\"+returnAs.toUpperCase()](el);\n            });\n        },\n\n        triadic: function(color, options){\n            var opt = $.extend({}, ColorsDefaultConfig, options);\n            var returnAs = opt.resultType;\n            var result;\n            var hsl = this.toHSL(color);\n            var h = hsl.h;\n            var self = this;\n\n            result = [\n                hsl,\n                new HSL(shift(h,120), hsl.s, hsl.l),\n                new HSL(shift(h,240), hsl.s, hsl.l)\n            ];\n\n            return result.map(function(el){\n                return self[\"to\"+returnAs.toUpperCase()](el);\n            });\n        },\n\n        analogous: function(color, options){\n            var opt = $.extend({}, ColorsDefaultConfig, options);\n            var returnAs = opt.resultType;\n            var angle = opt.angle;\n\n            var hsl = this.toHSL(color);\n            var result, self = this;\n\n            result = [\n                hsl,\n                new HSL(shift(hsl.h, -angle), hsl.s, hsl.l),\n                new HSL(shift(hsl.h, +angle), hsl.s, hsl.l)\n            ];\n\n            return result.map(function(el){\n                return self[\"to\"+returnAs.toUpperCase()](el);\n            });\n        },\n\n        createScheme: function(color, name, options){\n            switch (name.toLowerCase()) {\n                case \"analogous\":\n                case \"analog\": return this.analogous(color, options);\n\n                case \"triadic\":\n                case \"triad\": return this.triadic(color, options);\n\n                case \"tetradic\":\n                case \"tetra\": return this.tetradic(color, options);\n\n                case \"monochromatic\":\n                case \"mono\": return this.monochromatic(color, options);\n\n                case \"complementary\":\n                case \"complement\":\n                case \"comp\": return this.complementary(color, options);\n\n                case \"double-complementary\":\n                case \"double-complement\":\n                case \"double\": return this.doubleComplementary(color, options);\n\n                case \"split-complementary\":\n                case \"split-complement\":\n                case \"split\": return this.splitComplementary(color, options);\n\n                case \"square\": return this.square(color, options);\n                case \"material\": return this.materialPalette(color, options);\n            }\n        },\n\n        getScheme: function(){\n            return this.createScheme.apply(this, arguments)\n        },\n\n        add: function(val1, val2, returnAs){\n            var color1 = typeof val1 === \"string\" ? this.parse(val1) : val1;\n            var color2 = typeof val2 === \"string\" ? this.parse(val2) : val2;\n            var c1 = this.toRGBA(color1);\n            var c2 = this.toRGBA(color2);\n            var result = new RGBA();\n            var to = (\"\"+returnAs).toLowerCase() || \"hex\";\n\n            result.r = Math.round((c1.r + c2.r) / 2);\n            result.g = Math.round((c1.g + c2.g) / 2);\n            result.b = Math.round((c1.b + c2.b) / 2);\n            result.a = Math.round((c1.a + c2.a) / 2);\n\n            return this[\"to\"+to.toUpperCase()](result);\n        }\n    };\n\n    var Color = function(color, options){\n        this._setValue(color);\n        this._setOptions(options);\n    }\n\n    Color.prototype = {\n        _setValue: function(color){\n            var _color;\n\n            if (typeof color === \"string\") {\n                _color = Colors.parse(color);\n            } else {\n                _color = color;\n            }\n\n            if (!Colors.isColor(_color)) {\n                _color = \"#000000\";\n            }\n\n            this._value = _color;\n            this._type = Colors.colorType(this._value);\n        },\n\n        _setOptions: function(options){\n            options = typeof options === \"object\" ? options : {};\n            this._options = $.extend({}, ColorsDefaultConfig, options);\n        },\n\n        getOptions: function(){\n            return this._options;\n        },\n\n        setOptions: function(options){\n            this._setOptions(options);\n        },\n\n        setValue: function(color){\n            this._setValue(color);\n        },\n\n        getValue: function(){\n            return this._value;\n        },\n\n        channel: function(ch, val){\n            var currentType = this._type.toUpperCase();\n\n            if ([\"red\", \"green\", \"blue\"].indexOf(ch) > -1) {\n                this.toRGB();\n                this._value[ch[0]] = val;\n                this[\"to\"+currentType]();\n            }\n            if (ch === \"alpha\" && this._value.a) {\n                this._value.a = val;\n            }\n            if ([\"hue\", \"saturation\", \"value\"].indexOf(ch) > -1) {\n                this.toHSV();\n                this._value[ch[0]] = val;\n                this[\"to\"+currentType]();\n            }\n            if ([\"lightness\"].indexOf(ch) > -1) {\n                this.toHSL();\n                this._value[ch[0]] = val;\n                this[\"to\"+currentType]();\n            }\n            if ([\"cyan\", \"magenta\", \"yellow\", \"black\"].indexOf(ch) > -1) {\n                this.toCMYK();\n                this._value[ch[0]] = val;\n                this[\"to\"+currentType]();\n            }\n\n            return this;\n        },\n\n        channels: function(obj){\n            var that = this;\n\n            $.each(obj, function(key, val){\n                that.channel(key, val);\n            });\n\n            return this;\n        },\n\n        toRGB: function() {\n            this._value = Colors.toRGB(this._value);\n            this._type = Types.RGB;\n            return this;\n        },\n\n        rgb: function(){\n            return this._value ? new Color(Colors.toRGB(this._value)) : undefined;\n        },\n\n        toRGBA: function(alpha) {\n            if (Colors.isRGBA(this._value)) {\n                if (alpha) {\n                    this._value = Colors.toRGBA(this._value, alpha);\n                }\n            } else {\n                this._value = Colors.toRGBA(this._value, alpha);\n            }\n            this._type = Types.RGBA;\n            return this;\n        },\n\n        rgba: function(alpha) {\n            return this._value ? new Color(Colors.toRGBA(this._value, alpha)) : undefined;\n        },\n\n        toHEX: function() {\n            this._value = Colors.toHEX(this._value);\n            this._type = Types.HEX;\n            return this;\n        },\n\n        hex: function() {\n            return this._value ? new Color(Colors.toHEX(this._value)) : undefined;\n        },\n\n        toHSV: function() {\n            this._value = Colors.toHSV(this._value);\n            this._type = Types.HSV;\n            return this;\n        },\n\n        hsv: function() {\n            return this._value ? new Color(Colors.toHSV(this._value)) : undefined;\n        },\n\n        toHSL: function() {\n            this._value = Colors.toHSL(this._value);\n            this._type = Types.HSL;\n            return this;\n        },\n\n        hsl: function() {\n            return this._value ? new Color(Colors.toHSL(this._value)) : undefined;\n        },\n\n        toHSLA: function(alpha) {\n            if (Colors.isHSLA(this._value)) {\n                if (alpha) {\n                    this._value = Colors.toHSLA(this._value, alpha);\n                }\n            } else {\n                this._value = Colors.toHSLA(this._value, alpha);\n            }\n            this._type = Types.HSLA;\n            return this;\n        },\n\n        hsla: function(alpha) {\n            return this._value ? new Color(Colors.toHSLA(this._value, alpha)) : undefined;\n        },\n\n        toCMYK: function() {\n            this._value = Colors.toCMYK(this._value);\n            this._type = Types.CMYK;\n            return this;\n        },\n\n        cmyk: function() {\n            return this._value ? new Color(Colors.toCMYK(this._value)) : undefined;\n        },\n\n        toWebsafe: function() {\n            this._value = Colors.websafe(this._value);\n            this._type = Colors.colorType(this._value);\n            return this;\n        },\n\n        websafe: function() {\n            return this._value ? new Color(Colors.websafe(this._value)) : undefined;\n        },\n\n        toString: function() {\n            return this._value ? Colors.colorToString(this._value) : \"undefined\";\n        },\n\n        toDarken: function(amount) {\n            this._value = Colors.darken(this._value, amount);\n            return this;\n        },\n\n        darken: function(amount){\n            return new Color(Colors.darken(this._value, amount));\n        },\n\n        toLighten: function(amount) {\n            this._value = Colors.lighten(this._value, amount);\n            return this;\n        },\n\n        lighten: function(amount){\n            return new Color(Colors.lighten(this._value, amount))\n        },\n\n        isDark: function() {\n            return this._value ? Colors.isDark(this._value) : undefined;\n        },\n\n        isLight: function() {\n            return this._value ? Colors.isLight(this._value) : undefined;\n        },\n\n        toHueShift: function(hue, saturation, value) {\n            this._value = Colors.hueShift(this._value, hue, saturation, value);\n            return this;\n        },\n\n        hueShift: function (hue, saturation, value) {\n            return new Color(Colors.hueShift(this._value, hue, saturation, value));\n        },\n\n        toGrayscale: function() {\n            this._value = Colors.grayscale(this._value, this._type);\n            return this;\n        },\n\n        grayscale: function(){\n            return new Color(Colors.grayscale(this._value, this._type));\n        },\n\n        type: function() {\n            return Colors.colorType(this._value);\n        },\n\n        createScheme: function(name, format, options) {\n            return this._value\n                ? Colors.createScheme(this._value, name, format, options)\n                : undefined;\n        },\n\n        getScheme: function(){\n            return this.createScheme.apply(this, arguments);\n        },\n\n        equal: function(color) {\n            return Colors.equal(this._value, color);\n        },\n\n        toAdd: function(color){\n            this._value = Colors.add(this._value, color, this._type);\n            return this;\n        },\n\n        add: function(color){\n            return new Color(Colors.add(this._value, color, this._type));\n        }\n    }\n\n    Metro.colors = Colors.init();\n    window.Color = Metro.Color = Color;\n    window.ColorPrimitive = Metro.colorPrimitive = {\n        RGB: RGB,\n        RGBA: RGBA,\n        HSV: HSV,\n        HSL: HSL,\n        HSLA: HSLA,\n        CMYK: CMYK\n    };\n\n    if (window.METRO_GLOBAL_COMMON === true) {\n        window.Colors = Metro.colors;\n    }\n\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var cookieDisclaimerDefaults = {\n        name: 'cookies_accepted',\n        template: null,\n        templateSource: null,\n        acceptButton: '.cookie-accept-button',\n        cancelButton: '.cookie-cancel-button',\n        message: 'Our website uses cookies to monitor traffic on our website and ensure that we can provide our customers with the best online experience possible.',\n        duration: \"30days\",\n        clsContainer: \"\",\n        clsMessage: \"\",\n        clsButtons: \"\",\n        clsAcceptButton: \"alert\",\n        clsCancelButton: \"\",\n        onAccept: Metro.noop,\n        onDecline: Metro.noop\n    };\n\n    Metro.cookieDisclaimer = {\n        init: function(options){\n            var that = this, cookie = Metro.cookie;\n\n            this.options = $.extend({}, cookieDisclaimerDefaults, options);\n            this.disclaimer = $(\"<div>\");\n\n            if (cookie.getCookie(this.options.name)) {\n                return ;\n            }\n\n            if (this.options.template) {\n                fetch(this.options.template)\n                    .then(Metro.fetch.text)\n                    .then(function(data){\n                        that.create(data)\n                    });\n            } else if (this.options.templateSource) {\n                this.create($(this.options.templateSource));\n            } else {\n                this.create();\n            }\n        },\n\n        create: function(html){\n            var cookie = Metro.cookie;\n            var o = this.options, wrapper = this.disclaimer, buttons;\n\n            wrapper\n                .addClass(\"cookie-disclaimer-block\")\n                .addClass(o.clsContainer);\n\n            if (!html) {\n                buttons = $(\"<div>\")\n                    .addClass(\"cookie-disclaimer-actions\")\n                    .addClass(o.clsButtons)\n                    .append( $('<button>').addClass('button cookie-accept-button').addClass(o.clsAcceptButton).html('Accept') )\n                    .append( $('<button>').addClass('button cookie-cancel-button').addClass(o.clsCancelButton).html('Cancel') );\n\n                wrapper\n                    .html( $(\"<div>\").addClass(o.clsMessage).html(o.message) )\n                    .append( $(\"<hr>\").addClass('thin') )\n                    .append(buttons);\n\n            } else if (html instanceof $) {\n                wrapper.append(html);\n            } else {\n                wrapper.html(html);\n            }\n\n            wrapper.appendTo($('body'));\n\n            wrapper.on(Metro.events.click, o.acceptButton, function(){\n                var dur = 0;\n                var durations = (\"\"+o.duration).toArray(\" \");\n\n                $.each(durations, function(){\n                    var d = \"\"+this;\n                    if (d.includes(\"day\")) {\n                        dur += parseInt(d)*24*60*60*1000;\n                    } else\n                    if (d.includes(\"hour\")) {\n                        dur += parseInt(d)*60*60*1000;\n                    } else\n                    if (d.includes(\"min\")) {\n                        dur += parseInt(d)*60*1000;\n                    } else\n                    if (d.includes(\"sec\")) {\n                        dur += parseInt(d)*1000;\n                    } else {\n                        dur += parseInt(d);\n                    }\n                })\n\n                cookie.setCookie(o.name, true, dur);\n                Utils.exec(o.onAccept);\n                wrapper.remove();\n            });\n\n            wrapper.on(Metro.events.click, o.cancelButton, function(){\n                Utils.exec(o.onDecline);\n                wrapper.remove();\n            });\n        }\n    };\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var CookieDefaultConfig = {\n        path: \"/\",\n        expires: null,\n        maxAge: null,\n        domain: null,\n        secure: false,\n        samesite: null\n    }\n\n    Metro.cookieSetup = function (options) {\n        CookieDefaultConfig = $.extend({}, CookieDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroCookieSetup\"] !== undefined) {\n        Metro.cookieSetup(window[\"metroCookieSetup\"]);\n    }\n\n    Metro.cookie = {\n        getCookies: function(){\n            var a = document.cookie.toArray(\";\");\n            var o = {};\n            $.each(a, function(){\n                var i = this.split('=');\n                o[i[0]] = i[1];\n            });\n            return o;\n        },\n\n        getCookie: function(name){\n            var cookieName = encodeURIComponent(name) + \"=\";\n            var cookies = document.cookie.toArray(\";\");\n            var i, cookie;\n\n            for(i = 0; i < cookies.length; i++) {\n                cookie = cookies[i];\n                while (cookie.charAt(0) === ' ') {\n                    cookie = cookie.substring(1, cookie.length);\n                }\n                if (cookie.indexOf(cookieName) === 0) {\n                    return decodeURIComponent(cookie.substring(cookieName.length, cookie.length));\n                }\n            }\n            return null;\n        },\n\n        setCookie: function(name, value, options){\n            var date;\n            var cookieName = encodeURIComponent(name);\n            var cookieValue = encodeURIComponent(value);\n            var opt, a = [];\n\n            if (options && typeof options !== \"object\") {\n                date = new Date();\n                date.setTime(date.getTime()+(parseInt(options)));\n                opt = $.extend({}, CookieDefaultConfig, {\n                    expires: date.toUTCString()\n                });\n            } else {\n                opt = $.extend({}, CookieDefaultConfig, options);\n            }\n\n            $.each(opt, function(key, val){\n                if (key !== 'secure' && val) {\n                    a.push(Cake.dashedName(key) + \"=\" + val);\n                }\n                if (key === 'secure' && val === true) {\n                    a.push( \"secure\" );\n                }\n            });\n\n            document.cookie = cookieName + '=' + cookieValue + \"; \" +  a.join(\"; \");\n        },\n\n        delCookie: function(name){\n            this.setCookie(name, false, {\n                maxAge: -1\n            });\n        }\n    };\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var CountdownDefaultConfig = {\n        countdownDeferred: 0,\n        stopOnBlur: true,\n        animate: \"none\",\n        ease: \"linear\",\n        duration: 600,\n        inputFormat: null,\n        locale: METRO_LOCALE,\n        days: 0,\n        hours: 0,\n        minutes: 0,\n        seconds: 0,\n        date: null,\n        start: true,\n        clsCountdown: \"\",\n        clsPart: \"\",\n        clsZero: \"\",\n        clsAlarm: \"\",\n        clsDays: \"\",\n        clsHours: \"\",\n        clsMinutes: \"\",\n        clsSeconds: \"\",\n        onAlarm: Metro.noop,\n        onTick: Metro.noop,\n        onZero: Metro.noop,\n        onBlink: Metro.noop,\n        onCountdownCreate: Metro.noop\n    };\n\n    Metro.countdownSetup = function (options) {\n        CountdownDefaultConfig = $.extend({}, CountdownDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroCountdownSetup\"] !== undefined) {\n        Metro.countdownSetup(window[\"metroCountdownSetup\"]);\n    }\n\n    Metro.Component('countdown', {\n        init: function( options, elem ) {\n            this._super(elem, options, CountdownDefaultConfig, {\n                locale: Metro.locales[\"en-US\"],\n                breakpoint: (new Date()).getTime(),\n                blinkInterval: null,\n                tickInterval: null,\n                zeroDaysFired: false,\n                zeroHoursFired: false,\n                zeroMinutesFired: false,\n                zeroSecondsFired: false,\n                fontSize: parseInt(Utils.getStyleOne(elem, \"font-size\")),\n                current: {\n                    d: 0, h: 0, m: 0, s: 0\n                },\n                inactiveTab: false,\n                id: Utils.elementId(\"countdown\"),\n                duration: 600\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var o = this.options;\n\n            this.locale = Metro.locales[o.locale] !== undefined ? Metro.locales[o.locale] : Metro.locales[\"en-US\"];\n\n            this.duration = (+o.duration <= 0 || +o.duration >= 1000) ? 600 : +o.duration;\n\n            this._build();\n            this._createEvents();\n        },\n\n        _setBreakpoint: function(){\n            var o = this.options;\n            var dm = 86400000, hm = 3600000, mm = 60000, sm = 1000;\n\n            this.breakpoint = datetime().time();\n\n            if (o.date) {\n                this.breakpoint = (o.inputFormat ? Datetime.from(o.date, o.inputFormat) : datetime(o.date)).time();\n            }\n\n            if (parseInt(o.days) > 0) {\n                this.breakpoint += parseInt(o.days) * dm;\n            }\n            if (parseInt(o.hours) > 0) {\n                this.breakpoint += parseInt(o.hours) * hm;\n            }\n            if (parseInt(o.minutes) > 0) {\n                this.breakpoint += parseInt(o.minutes) * mm;\n            }\n            if (parseInt(o.seconds) > 0) {\n                this.breakpoint += parseInt(o.seconds) * sm;\n            }\n        },\n\n        _build: function(){\n            var that = this, element = this.element, o = this.options;\n            var parts = [\"days\", \"hours\", \"minutes\", \"seconds\"];\n            var dm = 24*60*60*1000;\n            var delta_days;\n            var now = datetime().time();\n            var digit;\n\n            if (!element.attr(\"id\")) {\n                element.attr(\"id\", Utils.elementId(\"countdown\"));\n            }\n\n            if (!Utils.isValue(element.attr(\"id\"))) {\n                element.attr(\"id\", Utils.elementId(\"countdown\"));\n            }\n\n            element.addClass(\"countdown\").addClass(o.clsCountdown);\n\n            this._setBreakpoint();\n\n            delta_days = Math.round((that.breakpoint - now) / dm);\n\n            $.each(parts, function(){\n                var part = $(\"<div>\").addClass(\"part \" + this).addClass(o.clsPart).attr(\"data-label\", that.locale[\"calendar\"][\"time\"][this]).appendTo(element);\n\n                if (this === \"days\") {part.addClass(o.clsDays);}\n                if (this === \"hours\") {part.addClass(o.clsHours);}\n                if (this === \"minutes\") {part.addClass(o.clsMinutes);}\n                if (this === \"seconds\") {part.addClass(o.clsSeconds);}\n\n                $(\"<div>\").addClass(\"digit\").appendTo(part);\n                $(\"<div>\").addClass(\"digit\").appendTo(part);\n\n                if (this === \"days\" && delta_days >= 100) {\n\n                    for(var i = 0; i < String(Math.round(delta_days/100)).length; i++) {\n                        $(\"<div>\").addClass(\"digit\").appendTo(part);\n                    }\n                }\n\n            });\n\n            digit = element.find(\".digit\");\n            digit.append($(\"<span class='digit-placeholder'>\").html(\"0\"));\n            digit.append($(\"<span class='digit-value'>\").html(\"0\"));\n\n            this._fireEvent(\"countdown-create\", {\n                element: element\n            })\n\n            if (o.start === true) {\n                this.start();\n            } else {\n                this.tick();\n            }\n        },\n\n        _createEvents: function(){\n            var that = this;\n            $(document).on(\"visibilitychange\", function() {\n                if (document.hidden) {\n                    that.pause();\n                } else {\n                    that.resume();\n                }\n            }, {ns: this.id});\n        },\n\n        blink: function(){\n            var element = this.element;\n            element.toggleClass(\"blink\");\n\n            this._fireEvent(\"blink\", {\n                time: this.current\n            });\n        },\n\n        tick: function(){\n            var element = this.element, o = this.options;\n            var dm = 24*60*60, hm = 60*60, mm = 60, sm = 1;\n            var left, now = datetime().time();\n            var d, h, m, s;\n            var days = element.find(\".days\"),\n                hours = element.find(\".hours\"),\n                minutes = element.find(\".minutes\"),\n                seconds = element.find(\".seconds\");\n\n            left = Math.floor((this.breakpoint - now)/1000);\n\n            if (left <= -1) {\n                this.stop();\n                element.addClass(o.clsAlarm);\n\n                this._fireEvent(\"alarm\", {\n                    time: now\n                });\n\n                return ;\n            }\n\n            d = Math.floor(left / dm);\n\n            left -= d * dm;\n            if (this.current.d !== d) {\n                this.current.d = d;\n                this.draw(\"days\", d);\n            }\n\n            if (d === 0) {\n                if (this.zeroDaysFired === false) {\n                    this.zeroDaysFired = true;\n                    days.addClass(o.clsZero);\n\n                    this._fireEvent(\"zero\", {\n                        part: \"days\",\n                        value: days\n                    });\n                }\n            }\n\n            h = Math.floor(left / hm);\n            left -= h*hm;\n            if (this.current.h !== h) {\n                this.current.h = h;\n                this.draw(\"hours\", h);\n            }\n\n            if (d === 0 && h === 0) {\n                if (this.zeroHoursFired === false) {\n                    this.zeroHoursFired = true;\n                    hours.addClass(o.clsZero);\n\n                    this._fireEvent(\"zero\", {\n                        part: \"hours\",\n                        value: hours\n                    });\n                }\n            }\n\n            m = Math.floor(left / mm);\n            left -= m*mm;\n            if (this.current.m !== m) {\n                this.current.m = m;\n                this.draw(\"minutes\", m);\n            }\n\n            if (d === 0 && h === 0 && m === 0) {\n                if (this.zeroMinutesFired === false) {\n                    this.zeroMinutesFired = true;\n                    minutes.addClass(o.clsZero);\n\n                    this._fireEvent(\"zero\", {\n                        part: \"minutes\",\n                        value: minutes\n                    });\n\n                }\n            }\n\n            s = Math.floor(left / sm);\n            if (this.current.s !== s) {\n                this.current.s = s;\n                this.draw(\"seconds\", s);\n            }\n\n            if (d === 0 && h === 0 && m === 0 && s === 0) {\n                if (this.zeroSecondsFired === false) {\n                    this.zeroSecondsFired = true;\n                    seconds.addClass(o.clsZero);\n\n                    this._fireEvent(\"zero\", {\n                        part: \"seconds\",\n                        value: seconds\n                    });\n\n                }\n            }\n\n            this._fireEvent(\"tick\", {\n                days: d,\n                hours: h,\n                minutes: m,\n                seconds: s\n            });\n        },\n\n        draw: function(part, value){\n            var element = this.element, o = this.options;\n            var digits, digits_length, digit_value, digit_current, digit;\n            var len, i, duration = this.duration;\n\n            var slideDigit = function(digit, value){\n                var digit_copy, height = digit.height();\n\n                digit.siblings(\"-old-digit\").remove();\n                digit_copy = digit.clone().appendTo(digit.parent());\n                digit_copy.css({\n                    top: -1 * height + 'px'\n                });\n\n                digit\n                    .addClass(\"-old-digit\")\n                    .animate({\n                        draw: {\n                            top: height,\n                            opacity: 0\n                        },\n                        dur: duration,\n                        ease: o.ease,\n                        onDone: function(){\n                            $(this).remove();\n                        }\n                    });\n\n                digit_copy\n                    .html(value)\n                    .animate({\n                        draw: {\n                            top: 0,\n                            opacity: 1\n                        },\n                        dur: duration,\n                        ease: o.ease\n                    });\n            };\n\n            var fadeDigit = function(digit, value){\n                var digit_copy;\n                digit.siblings(\"-old-digit\").remove();\n                digit_copy = digit.clone().appendTo(digit.parent());\n                digit_copy.css({\n                    opacity: 0\n                });\n\n                digit\n                    .addClass(\"-old-digit\")\n                    .animate({\n                        draw: {\n                            opacity: 0\n                        },\n                        dur: duration / 2,\n                        ease: o.ease,\n                        onDone: function(){\n                            $(this).remove();\n                        }\n                    });\n\n                digit_copy\n                    .html(value)\n                    .animate({\n                        draw: {\n                            opacity: 1\n                        },\n                        dur: duration,\n                        ease: o.ease\n                    });\n            };\n\n            var zoomDigit = function(digit, value) {\n                var digit_copy, height = digit.height(), fs = parseInt(digit.style(\"font-size\"));\n\n                digit.siblings(\"-old-digit\").remove();\n                digit_copy = digit.clone().appendTo(digit.parent());\n                digit_copy.css({\n                    top: 0,\n                    left: 0,\n                    opacity: 1\n                });\n\n                digit\n                    .addClass(\"-old-digit\")\n                    .animate({\n                        draw: {\n                            top: height,\n                            opacity: 0,\n                            fontSize: 0\n                        },\n                        dur: duration,\n                        ease: o.ease,\n                        onDone: function(){\n                            $(this).remove();\n                        }\n                    });\n\n                digit_copy\n                    .html(value)\n                    .animate({\n                        draw: {\n                            top: 0,\n                            opacity: 1,\n                            fontSize: [0, fs]\n                        },\n                        dur: duration,\n                        ease: o.ease\n                    });\n            };\n\n            value = \"\"+value;\n\n            if (value.length === 1) {\n                value = '0'+value;\n            }\n\n            len = value.length;\n\n            digits = element.find(\".\"+part+\" .digit:not(-old-digit)\");\n            digits_length = digits.length;\n\n            for(i = 0; i < len; i++){\n                digit = digits.eq(digits_length - 1).find(\".digit-value\");\n                digit_value = Math.floor( parseInt(value) / Math.pow(10, i) ) % 10;\n                digit_current = parseInt(digit.text());\n\n                digits_length--;\n\n                if (digit_current === digit_value) {\n                    continue;\n                }\n\n                switch ((\"\"+o.animate).toLowerCase()) {\n                    case \"slide\": slideDigit(digit, digit_value); break;\n                    case \"fade\": fadeDigit(digit, digit_value); break;\n                    case \"zoom\": zoomDigit(digit, digit_value); break;\n                    default: digit.html(digit_value);\n                }\n            }\n        },\n\n        start: function(){\n            var that = this, element = this.element;\n\n            if (element.data(\"paused\") === false) {\n                return;\n            }\n\n            clearInterval(this.blinkInterval);\n            clearInterval(this.tickInterval);\n\n            element.data(\"paused\", false);\n\n            this._setBreakpoint();\n            this.tick();\n\n            this.blinkInterval = setInterval(function(){that.blink();}, 500);\n            this.tickInterval = setInterval(function(){that.tick();}, 1000);\n        },\n\n        stop: function(){\n            var element = this.element;\n            clearInterval(this.blinkInterval);\n            clearInterval(this.tickInterval);\n            element.data(\"paused\", true);\n            element.find(\".digit\").html(\"0\");\n            this.current = {\n                d: 0, h:0, m: 0, s:0\n            };\n        },\n\n        pause: function(){\n            clearInterval(this.blinkInterval);\n            clearInterval(this.tickInterval);\n            this.element.data(\"paused\", true);\n        },\n\n        resume: function(){\n            var that = this;\n\n            this.element.data(\"paused\", false);\n            this.blinkInterval = setInterval(function(){that.blink();}, 500);\n            this.tickInterval = setInterval(function(){that.tick();}, 1000);\n        },\n\n        reset: function(){\n            var that = this, element = this.element, o = this.options;\n\n            clearInterval(this.blinkInterval);\n            clearInterval(this.tickInterval);\n\n            element.find(\".part\").removeClass(o.clsZero);\n            element.find(\".digit\").html(\"0\");\n\n            this._setBreakpoint();\n\n            element.data(\"paused\", false);\n\n            this.tick();\n\n            this.blinkInterval = setInterval(function(){that.blink();}, 500);\n            this.tickInterval = setInterval(function(){that.tick();}, 1000);\n        },\n\n        togglePlay: function(){\n            if (this.element.attr(\"data-pause\") === true) {\n                this.pause();\n            } else {\n                this.start();\n            }\n        },\n\n        isPaused: function(){\n            return this.element.data(\"paused\");\n        },\n\n        getBreakpoint: function(asDate){\n            return asDate === true ? new Date(this.breakpoint) : this.breakpoint;\n        },\n\n        getLeft: function(){\n            var dm = 24*60*60*1000, hm = 60*60*1000, mm = 60*1000, sm = 1000;\n            var now = (new Date()).getTime();\n            var left_seconds = Math.floor(this.breakpoint - now);\n            return {\n                days: Math.round(left_seconds / dm),\n                hours: Math.round(left_seconds / hm),\n                minutes: Math.round(left_seconds / mm),\n                seconds: Math.round(left_seconds / sm)\n            };\n        },\n\n        i18n: function(val){\n            var that = this, element = this.element, o = this.options;\n            var parts = [\"days\", \"hours\", \"minutes\", \"seconds\"];\n\n\n            if (val === undefined) {\n                return o.locale;\n            }\n            if (Metro.locales[val] === undefined) {\n                return false;\n            }\n            o.locale = val;\n            this.locale = Metro.locales[o.locale];\n\n            $.each(parts, function(){\n                var cls = \".part.\" + this;\n                var part = element.find(cls);\n                part.attr(\"data-label\", that.locale[\"calendar\"][\"time\"][this]);\n            });\n        },\n\n        changeAttrLocale: function(){\n            var element = this.element;\n            var locale = element.attr('data-locale');\n            this.i18n(locale);\n        },\n\n        changeAttribute: function(attr, newVal){\n            switch (attr) {\n                case \"data-pause\": this.togglePlay(); break;\n                case \"data-locale\": this.i18n(newVal); break;\n                case \"data-duration\": this.duration = +newVal <= 0 || +newVal >= 1000 ? 600 : +newVal; break;\n            }\n        },\n\n        destroy: function(){\n            clearInterval(this.blinkInterval);\n            clearInterval(this.tickInterval);\n\n            $(document).off(\"visibilitychange\", {ns: this.id});\n\n            return this.element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var CounterDefaultConfig = {\n        startOnViewport: true,\n        counterDeferred: 0,\n        duration: 2000,\n        value: 0,\n        from: 0,\n        timeout: 0,\n        delimiter: \",\",\n        prefix: \"\",\n        suffix: \"\",\n        onStart: Metro.noop,\n        onStop: Metro.noop,\n        onTick: Metro.noop,\n        onCounterCreate: Metro.noop\n    };\n\n    Metro.counterSetup = function (options) {\n        CounterDefaultConfig = $.extend({}, CounterDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroCounterSetup\"] !== undefined) {\n        Metro.counterSetup(window[\"metroCounterSetup\"]);\n    }\n\n    Metro.Component('counter', {\n        init: function( options, elem ) {\n            this._super(elem, options, CounterDefaultConfig, {\n                numbers: [],\n                html: $(elem).html(),\n                started: false,\n                id: Utils.elementId(\"counter\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            this._createEvents();\n            this._fireEvent(\"counter-create\");\n            this._run();\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n\n            $.window().on(\"scroll\", function(){\n                if (o.startOnViewport === true && Utils.inViewport(element[0]) && !that.started) {\n                    that.start();\n                }\n            }, {ns: this.id})\n        },\n\n        _run: function(){\n            var element = this.element, o = this.options;\n\n            this.started = false;\n\n            if (o.startOnViewport !== true) {\n                this.start();\n            } else {\n                if (Utils.inViewport(element[0])) {\n                    this.start();\n                }\n            }\n        },\n\n        startInViewport: function(val, from){\n            var o = this.options;\n\n            if (Utils.isValue(from)) {\n                o.from = +from;\n            }\n\n            if (Utils.isValue(val)) {\n                o.value = +val;\n            }\n            this._run();\n        },\n\n        start: function(val, from){\n            var that = this, element = this.element, o = this.options;\n\n            if (Utils.isValue(from)) {\n                o.from = +from;\n            }\n\n            if (Utils.isValue(val)) {\n                o.value = +val;\n            }\n\n            this.started = true;\n\n            this._fireEvent(\"start\");\n\n            element.animate({\n                draw: {\n                    innerHTML: [o.from, o.value]\n                },\n                defer: o.timeout,\n                dur: o.duration,\n                onFrame: function () {\n                    that._fireEvent(\"tick\", {\n                        value: +this.innerHTML\n                    });\n                    this.innerHTML = o.prefix + Number(this.innerHTML).format(0, 0, o.delimiter) + o.suffix\n                },\n                onDone: function(){\n                    that._fireEvent(\"stop\");\n                }\n            })\n        },\n\n        reset: function(){\n            this.started = false;\n            this.element.html(this.html);\n        },\n\n        changeAttribute: function(attr, val){\n            var o = this.options;\n\n            if (attr === \"data-value\") {\n                o.value = +val;\n            }\n            if (attr === \"data-from\") {\n                o.from = +val;\n            }\n        },\n\n        destroy: function(){\n            $.window().off(\"scroll\", {ns: this.id});\n            return this.element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var CubeDefaultConfig = {\n        cubeDeferred: 0,\n        rules: null,\n        color: null,\n        flashColor: null,\n        flashInterval: 1000,\n        numbers: false,\n        offBefore: true,\n        attenuation: .3,\n        stopOnBlur: false,\n        cells: 4,\n        margin: 8,\n        showAxis: false,\n        axisStyle: \"arrow\", //line\n        cellClick: false,\n        autoRestart: 5000,\n\n        clsCube: \"\",\n        clsCell: \"\",\n        clsSide: \"\",\n        clsSideLeft: \"\",\n        clsSideRight: \"\",\n        clsSideTop: \"\",\n        clsSideLeftCell: \"\",\n        clsSideRightCell: \"\",\n        clsSideTopCell: \"\",\n        clsAxis: \"\",\n        clsAxisX: \"\",\n        clsAxisY: \"\",\n        clsAxisZ: \"\",\n\n        custom: Metro.noop,\n        onTick: Metro.noop,\n        onCubeCreate: Metro.noop\n    };\n\n    Metro.cubeSetup = function (options) {\n        CubeDefaultConfig = $.extend({}, CubeDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroCubeSetup\"] !== undefined) {\n        Metro.cubeSetup(window[\"metroCubeSetup\"]);\n    }\n\n    Metro.cubeDefaultRules = [\n        {\n            on: {'top': [16],      'left': [4],         'right': [1]},\n            off: {'top': [13, 4],   'left': [1, 16],     'right': [13, 4]}\n        },\n        {\n            on: {'top': [12, 15],  'left': [3, 8],      'right': [2, 5]},\n            off: {'top': [9, 6, 3], 'left': [5, 10, 15], 'right': [14, 11, 8]}\n        },\n        {\n            on: {'top': [11],      'left': [7],         'right': [6]},\n            off: {'top': [1, 2, 5], 'left': [9, 13, 14], 'right': [15, 12, 16]}\n        },\n        {\n            on: {'top': [8, 14],   'left': [2, 12],     'right': [9, 3]},\n            off: {'top': [16],      'left': [4],         'right': [1]}\n        },\n        {\n            on: {'top': [10, 7],   'left': [6, 11],     'right': [10, 7]},\n            off: {'top': [12, 15],  'left': [3, 8],      'right': [2, 5]}\n        },\n        {\n            on: {'top': [13, 4],   'left': [1, 16],     'right': [13, 4]},\n            off: {'top': [11],      'left': [7],         'right': [6]}\n        },\n        {\n            on: {'top': [9, 6, 3], 'left': [5, 10, 15], 'right': [14, 11, 8]},\n            off: {'top': [8, 14],   'left': [2, 12],     'right': [9, 3]}\n        },\n        {\n            on: {'top': [1, 2, 5], 'left': [9, 13, 14], 'right': [15, 12, 16]},\n            off: {'top': [10, 7],   'left': [6, 11],     'right': [10, 7]}\n        }\n    ];\n\n    Metro.Component('cube', {\n        init: function( options, elem ) {\n            this._super(elem, options, CubeDefaultConfig, {\n                id: Utils.elementId(\"cube\"),\n                rules: null,\n                interval: false,\n                ruleInterval: false,\n                running: false,\n                intervals: []\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n\n            if (o.rules === null) {\n                this.rules = Metro.cubeDefaultRules;\n            } else {\n                this._parseRules(o.rules);\n            }\n\n            this._createCube();\n            this._createEvents();\n\n            this._fireEvent(\"cube-create\", {\n                element: element\n            });\n        },\n\n        _parseRules: function(rules){\n\n            if (rules === undefined || rules === null) {\n                return false;\n            }\n\n            if (Utils.isObject(rules)) {\n                this.rules = Utils.isObject(rules);\n                return true;\n            } else {\n                try {\n                    this.rules = JSON.parse(rules);\n                    return true;\n                } catch (err) {\n                    console.warn(\"Unknown or empty rules for cell flashing!\");\n                    return false;\n                }\n            }\n        },\n\n        _createCube: function(){\n            var element = this.element, o = this.options;\n            var sides = ['left', 'right', 'top'];\n            var id = Utils.elementId(\"cube\");\n            var cells_count = Math.pow(o.cells, 2);\n\n            element.addClass(\"cube\").addClass(o.clsCube);\n\n            if (!element.attr('id')) {\n                element.attr('id', id);\n            }\n\n            this.id = element.attr('id');\n\n            this._createCssForFlashColor();\n            this._createCssForCellSize();\n\n            $.each(sides, function(){\n                var side, cell, i;\n\n                side = $(\"<div>\").addClass(\"side \" + this+\"-side\").addClass(o.clsSide).appendTo(element);\n\n                if (this === 'left') {side.addClass(o.clsSideLeft);}\n                if (this === 'right') {side.addClass(o.clsSideRight);}\n                if (this === 'top') {side.addClass(o.clsSideTop);}\n\n                for(i = 0; i < cells_count; i++) {\n                    cell = $(\"<div>\").addClass(\"cube-cell\").addClass(\"cell-id-\"+(i+1)).addClass(o.clsCell);\n                    cell.data(\"id\", i + 1).data(\"side\", this);\n                    cell.appendTo(side);\n                    if (o.numbers === true) {\n                        cell.html(i + 1);\n                    }\n                }\n            });\n\n            var cells  = element.find(\".cube-cell\");\n            if (o.color !== null) {\n                if (Metro.colors.isColor(o.color)) {\n                    cells.css({\n                        backgroundColor: o.color,\n                        borderColor: o.color\n                    })\n                } else {\n                    cells.addClass(o.color);\n                }\n            }\n\n            var axis = ['x', 'y', 'z'];\n            $.each(axis, function(){\n                var axis_name = this;\n                var ax = $(\"<div>\").addClass(\"axis \" + o.axisStyle).addClass(\"axis-\"+axis_name).addClass(o.clsAxis);\n                if (axis_name === \"x\") ax.addClass(o.clsAxisX);\n                if (axis_name === \"y\") ax.addClass(o.clsAxisY);\n                if (axis_name === \"z\") ax.addClass(o.clsAxisZ);\n                ax.appendTo(element);\n            });\n\n            if (o.showAxis === false) {\n                element.find(\".axis\").hide();\n            }\n\n            this._run();\n        },\n\n        _run: function(){\n            var that = this, element = this.element, o = this.options;\n            var interval = 0;\n\n            clearInterval(this.interval);\n            element.find(\".cube-cell\").removeClass(\"light\");\n\n            if (o.custom !== Metro.noop) {\n                Utils.exec(o.custom, [element]);\n            } else {\n\n                element.find(\".cube-cell\").removeClass(\"light\");\n\n                that._start();\n\n                interval = Utils.isObject(this.rules) ? Utils.objectLength(this.rules) : 0;\n\n                this.interval = setInterval(function(){\n                    that._start();\n                }, interval * o.flashInterval);\n            }\n        },\n\n        _createCssForCellSize: function(){\n            var element = this.element, o = this.options;\n            var sheet = Metro.sheet;\n            var width;\n            var cell_size;\n\n            if (o.margin === 8 && o.cells === 4) {\n                return ;\n            }\n\n            width = parseInt(Utils.getStyleOne(element, 'width'));\n            cell_size = Math.ceil((width / 2 - o.margin * o.cells * 2) / o.cells);\n            Utils.addCssRule(sheet, \"#\"+element.attr('id')+\" .side .cube-cell\", \"width: \"+cell_size+\"px!important; height: \"+cell_size+\"px!important; margin: \" + o.margin + \"px!important;\");\n        },\n\n        _createCssForFlashColor: function(){\n            var element = this.element, o = this.options;\n            var sheet = Metro.sheet;\n            var rule1;\n            var rule2;\n            var rules1 = [];\n            var rules2 = [];\n            var i;\n\n            if (o.flashColor === null) {\n                return ;\n            }\n\n            rule1 = \"0 0 10px \" + Metro.colors.toRGBA(o.flashColor, 1);\n            rule2 = \"0 0 10px \" + Metro.colors.toRGBA(o.flashColor, o.attenuation);\n\n            for(i = 0; i < 3; i++) {\n                rules1.push(rule1);\n                rules2.push(rule2);\n            }\n\n            Utils.addCssRule(sheet, \"@keyframes pulsar-cell-\"+element.attr('id'), \"0%, 100% { \" + \"box-shadow: \" + rules1.join(\",\") + \"} 50% { \" + \"box-shadow: \" + rules2.join(\",\") + \" }\");\n            Utils.addCssRule(sheet, \"#\"+element.attr('id')+\" .side .cube-cell.light\", \"animation: pulsar-cell-\" + element.attr('id') + \" 2.5s 0s ease-out infinite; \" + \"background-color: \" + o.flashColor + \"!important; border-color: \" + o.flashColor+\"!important;\");\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n\n            $(window).on(Metro.events.blur, function(){\n                if (o.stopOnBlur === true && that.running === true) {\n                    that._stop();\n                }\n            }, {ns: element.attr(\"id\")});\n\n            $(window).on(Metro.events.focus, function(){\n                if (o.stopOnBlur === true && that.running === false) {\n                    that._start();\n                }\n            }, {ns: element.attr(\"id\")});\n\n            element.on(Metro.events.click, \".cube-cell\", function(){\n                if (o.cellClick === true) {\n                    var cell = $(this);\n                    cell.toggleClass(\"light\");\n                }\n            });\n        },\n\n        _start: function(){\n            var that = this, element = this.element;\n\n            element.find(\".cube-cell\").removeClass(\"light\");\n\n            this.running = true;\n\n            $.each(this.rules, function(index, rule){\n                that._execRule(index, rule);\n            });\n        },\n\n        _stop: function(){\n            this.running = false;\n            clearInterval(this.interval);\n            $.each(this.intervals, function(){\n                clearInterval(this);\n            })\n        },\n\n        _tick: function(index, speed){\n            var that = this, o = this.options;\n            if (speed === undefined) {\n                speed = o.flashInterval * index;\n            }\n\n            var interval = setTimeout(function(){\n\n                that._fireEvent(\"tick\", {\n                    index: index\n                });\n\n                clearInterval(interval);\n                Utils.arrayDelete(that.intervals, interval);\n            }, speed);\n            this.intervals.push(interval);\n        },\n\n        _toggle: function(cell, func, time, speed){\n            var that = this;\n            if (speed === undefined) {\n                speed = this.options.flashInterval * time;\n            }\n            var interval = setTimeout(function(){\n                cell[func === 'on' ? 'addClass' : 'removeClass'](\"light\");\n                clearInterval(interval);\n                Utils.arrayDelete(that.intervals, interval);\n            }, speed);\n            this.intervals.push(interval);\n        },\n\n        start: function(){\n            this._start();\n        },\n\n        stop: function(){\n            this._stop();\n        },\n\n        toRule: function(index, speed){\n            var that = this, element = this.element, o = this.options;\n            var rules = this.rules;\n\n            if (rules === null || rules === undefined || rules[index] === undefined) {\n                return ;\n            }\n            clearInterval(this.ruleInterval);\n            this.ruleInterval = false;\n            this.stop();\n            element.find(\".cube-cell\").removeClass(\"light\");\n            for (var i = 0; i <= index; i++) {\n                this._execRule(i, rules[i], speed);\n            }\n            if (Utils.isInt(o.autoRestart) && o.autoRestart > 0) {\n                this.ruleInterval = setTimeout(function(){\n                    that._run();\n                }, o.autoRestart);\n            }\n        },\n\n        _execRule: function(index, rule, speed){\n            var that = this, element = this.element;\n            var sides = ['left', 'right', 'top'];\n\n            this._tick(index, speed);\n\n            $.each(sides, function(){\n                var side_class = \".\"+this+\"-side\";\n                var side_name = this;\n                var cells_on = rule[\"on\"] !== undefined && rule[\"on\"][side_name] !== undefined ? rule[\"on\"][side_name] : false;\n                var cells_off = rule[\"off\"] !== undefined && rule[\"off\"][side_name] !== undefined ? rule[\"off\"][side_name] : false;\n\n                if (cells_on !== false) $.each(cells_on, function(){\n                    var cell_index = this;\n                    var cell = element.find(side_class + \" .cell-id-\"+cell_index);\n\n                    that._toggle(cell, 'on', index, speed);\n                });\n\n                if (cells_off !== false) $.each(cells_off, function(){\n                    var cell_index = this;\n                    var cell = element.find(side_class + \" .cell-id-\"+cell_index);\n\n                    that._toggle(cell, 'off', index, speed);\n                });\n            });\n        },\n\n        rule: function(r){\n            if (r === undefined) {\n                return this.rules;\n            }\n\n            if (this._parseRules(r) !== true) {\n                return ;\n            }\n            this.options.rules = r;\n            this.stop();\n            this.element.find(\".cube-cell\").removeClass(\"light\");\n            this._run();\n        },\n\n        axis: function(show){\n            var func = show === true ? \"show\" : \"hide\";\n            this.element.find(\".axis\")[func]();\n        },\n\n        changeRules: function(){\n            var element = this.element, o = this.options;\n            var rules = element.attr(\"data-rules\");\n            if (this._parseRules(rules) !== true) {\n                return ;\n            }\n            this.stop();\n            element.find(\".cube-cell\").removeClass(\"light\");\n            o.rules = rules;\n            this._run();\n        },\n\n        changeAxisVisibility: function(){\n            var element = this.element;\n            var visibility = JSON.parse(element.attr(\"data-show-axis\")) === true;\n            var func = visibility ? \"show\" : \"hide\";\n            element.find(\".axis\")[func]();\n        },\n\n        changeAxisStyle: function(){\n            var element = this.element;\n            var style = element.attr(\"data-axis-style\");\n\n            element.find(\".axis\").removeClass(\"arrow line no-style\").addClass(style);\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case \"data-rules\": this.changeRules(); break;\n                case \"data-show-axis\": this.changeAxisVisibility(); break;\n                case \"data-axis-style\": this.changeAxisStyle(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n\n            clearInterval(this.interval);\n            this.interval = null;\n\n            $(window).off(Metro.events.blur, {ns: element.attr(\"id\")});\n            $(window).off(Metro.events.focus,{ns: element.attr(\"id\")});\n\n            element.off(Metro.events.click, \".cube-cell\");\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var DatePickerDefaultConfig = {\n        label: \"\",\n        datepickerDeferred: 0,\n        gmt: 0,\n        format: \"YYYY-MM-DD\",\n        inputFormat: null,\n        locale: METRO_LOCALE,\n        value: null,\n        distance: 3,\n        month: true,\n        day: true,\n        year: true,\n        minYear: null,\n        maxYear: null,\n        defaultYearDistance: 100,\n        scrollSpeed: 4,\n        copyInlineStyles: false,\n        clsPicker: \"\",\n        clsPart: \"\",\n        clsMonth: \"\",\n        clsDay: \"\",\n        clsYear: \"\",\n        clsLabel: \"\",\n        clsButton: \"\",\n        clsOkButton: \"\",\n        clsCancelButton: \"\",\n        okButtonIcon: \"<span class='default-icon-check'></span>\",\n        cancelButtonIcon: \"<span class='default-icon-cross'></span>\",\n        onSet: Metro.noop,\n        onOpen: Metro.noop,\n        onClose: Metro.noop,\n        onScroll: Metro.noop,\n        onDatePickerCreate: Metro.noop\n    };\n\n    Metro.datePickerSetup = function (options) {\n        DatePickerDefaultConfig = $.extend({}, DatePickerDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroDatePickerSetup\"] !== undefined) {\n        Metro.datePickerSetup(window[\"metroDatePickerSetup\"]);\n    }\n\n    Metro.Component('date-picker', {\n        init: function( options, elem ) {\n            this._super(elem, options, DatePickerDefaultConfig, {\n                picker: null,\n                isOpen: false,\n                value: datetime(),\n                locale: null,\n                listTimer: {\n                    day: null,\n                    month: null,\n                    year: null\n                }\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n            var date = datetime();\n\n            if (o.distance < 1) {\n                o.distance = 1;\n            }\n\n            if (Utils.isValue(element.val())) {\n                o.value = element.val();\n            }\n\n            if (Utils.isValue(o.value)) {\n                this.value = o.inputFormat ? Datetime.from(o.value, o.inputFormat, o.locale) : datetime(o.value);\n            }\n\n            if (Metro.locales[o.locale] === undefined) {\n                o.locale = METRO_LOCALE;\n            }\n\n            this.locale = Metro.locales[o.locale]['calendar'];\n\n            if (o.minYear === null) {\n                o.minYear = date.year() - o.defaultYearDistance;\n            }\n\n            if (o.maxYear === null) {\n                o.maxYear = date.year() + o.defaultYearDistance;\n            }\n\n            this._createStructure();\n            this._createEvents();\n            this._set();\n\n            this._fireEvent(\"datepicker-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var picker, month, day, year, i, j;\n            var dateWrapper, selectWrapper, selectBlock, actionBlock;\n\n            var id = Utils.elementId(\"datepicker\");\n\n            picker = $(\"<div>\").attr(\"id\", id).addClass(\"wheel-picker date-picker \" + element[0].className).addClass(o.clsPicker);\n\n            picker.insertBefore(element);\n            element.appendTo(picker);\n\n            if (o.label) {\n                var label = $(\"<label>\").addClass(\"label-for-input\").addClass(o.clsLabel).html(o.label).insertBefore(picker);\n                if (element.attr(\"id\")) {\n                    label.attr(\"for\", element.attr(\"id\"));\n                }\n                if (element.attr(\"dir\") === \"rtl\") {\n                    label.addClass(\"rtl\");\n                }\n            }\n\n            dateWrapper = $(\"<div>\").addClass(\"date-wrapper\").appendTo(picker);\n\n            if (o.month === true) {\n                month = $(\"<div>\").addClass(\"month\").addClass(o.clsPart).addClass(o.clsMonth).appendTo(dateWrapper);\n            }\n            if (o.day === true) {\n                day = $(\"<div>\").addClass(\"day\").addClass(o.clsPart).addClass(o.clsDay).appendTo(dateWrapper);\n            }\n            if (o.year === true) {\n                year = $(\"<div>\").addClass(\"year\").addClass(o.clsPart).addClass(o.clsYear).appendTo(dateWrapper);\n            }\n\n            selectWrapper = $(\"<div>\").addClass(\"select-wrapper\").appendTo(picker);\n\n            selectBlock = $(\"<div>\").addClass(\"select-block\").appendTo(selectWrapper);\n\n            if (o.month === true) {\n                month = $(\"<ul>\").addClass(\"sel-month\").appendTo(selectBlock);\n                for (i = 0; i < o.distance; i++) $(\"<li>\").html(\"&nbsp;\").data(\"value\", -1).appendTo(month);\n                for (i = 0; i < 12; i++) {\n                    $(\"<li>\").addClass(\"js-month-\"+i+\" js-month-real-\"+this.locale['months'][i].toLowerCase()).html(this.locale['months'][i]).data(\"value\", i).appendTo(month);\n                }\n                for (i = 0; i < o.distance; i++) $(\"<li>\").html(\"&nbsp;\").data(\"value\", -1).appendTo(month);\n            }\n\n            if (o.day === true) {\n                day = $(\"<ul>\").addClass(\"sel-day\").appendTo(selectBlock);\n                for (i = 0; i < o.distance; i++) $(\"<li>\").html(\"&nbsp;\").data(\"value\", -1).appendTo(day);\n                for (i = 0; i < 31; i++) {\n                    $(\"<li>\").addClass(\"js-day-\"+i+\" js-day-real-\"+(i+1)).html(i + 1).data(\"value\", i + 1).appendTo(day);\n                }\n                for (i = 0; i < o.distance; i++) $(\"<li>\").html(\"&nbsp;\").data(\"value\", -1).appendTo(day);\n            }\n\n            if (o.year === true) {\n                year = $(\"<ul>\").addClass(\"sel-year\").appendTo(selectBlock);\n                for (i = 0; i < o.distance; i++) $(\"<li>\").html(\"&nbsp;\").data(\"value\", -1).appendTo(year);\n                for (i = o.minYear, j = 0; i <= o.maxYear; i++, j++) {\n                    $(\"<li>\").addClass(\"js-year-\"+ j + \" js-year-real-\" + i).html(i).data(\"value\", i).appendTo(year);\n                }\n                for (i = 0; i < o.distance; i++) $(\"<li>\").html(\"&nbsp;\").data(\"value\", -1).appendTo(year);\n            }\n\n            selectBlock.height((o.distance * 2 + 1) * 40);\n\n            actionBlock = $(\"<div>\").addClass(\"action-block\").appendTo(selectWrapper);\n            $(\"<button>\").attr(\"type\", \"button\").addClass(\"button action-ok\").addClass(o.clsButton).addClass(o.clsOkButton).html(o.okButtonIcon).appendTo(actionBlock);\n            $(\"<button>\").attr(\"type\", \"button\").addClass(\"button action-cancel\").addClass(o.clsButton).addClass(o.clsCancelButton).html(o.cancelButtonIcon).appendTo(actionBlock);\n\n\n            element[0].className = '';\n            if (o.copyInlineStyles === true) {\n                for (i = 0; i < element[0].style.length; i++) {\n                    picker.css(element[0].style[i], element.css(element[0].style[i]));\n                }\n            }\n\n            if (element.prop(\"disabled\")) {\n                picker.addClass(\"disabled\");\n            }\n\n            this.picker = picker;\n        },\n\n        _createEvents: function(){\n            var that = this, o = this.options;\n            var picker = this.picker;\n\n            picker.on(Metro.events.start, \".select-block ul\", function(e){\n\n                if (e.changedTouches) {\n                    return ;\n                }\n\n                var target = this;\n                var pageY = Utils.pageXY(e).y;\n\n                $(document).on(Metro.events.move, function(e){\n\n                    target.scrollTop -= o.scrollSpeed * (pageY  > Utils.pageXY(e).y ? -1 : 1);\n\n                    pageY = Utils.pageXY(e).y;\n                }, {ns: picker.attr(\"id\")});\n\n                $(document).on(Metro.events.stop, function(){\n                    $(document).off(Metro.events.move, {ns: picker.attr(\"id\")});\n                    $(document).off(Metro.events.stop, {ns: picker.attr(\"id\")});\n                }, {ns: picker.attr(\"id\")});\n            });\n\n            picker.on(Metro.events.click, function(e){\n                if (that.isOpen === false) that.open();\n                e.stopPropagation();\n            });\n\n            picker.on(Metro.events.click, \".action-ok\", function(e){\n                var m, d, y;\n                var sm = picker.find(\".sel-month li.active\"),\n                    sd = picker.find(\".sel-day li.active\"),\n                    sy = picker.find(\".sel-year li.active\");\n\n                m = sm.length === 0 ? that.value.getMonth() : sm.data(\"value\");\n                d = sd.length === 0 ? that.value.getDate() : sd.data(\"value\");\n                y = sy.length === 0 ? that.value.getFullYear() : sy.data(\"value\");\n\n                that.value = datetime(y, m, d);\n                that._correct();\n                that._set();\n\n                that.close();\n                e.stopPropagation();\n            });\n\n            picker.on(Metro.events.click, \".action-cancel\", function(e){\n                that.close();\n                e.stopPropagation();\n            });\n\n            var scrollLatency = 150;\n            $.each([\"month\", \"day\", \"year\"], function(){\n                var part = this, list = picker.find(\".sel-\"+part);\n\n                list.on(\"scroll\", function(){\n                    if (that.isOpen) {\n                        if (that.listTimer[part]) {\n                            clearTimeout(that.listTimer[part]);\n                            that.listTimer[part] = null;\n                        }\n\n                        if (!that.listTimer[part]) that.listTimer[part] = setTimeout(function () {\n\n                            var target, targetElement, scrollTop;\n\n                            that.listTimer[part] = null;\n\n                            target = Math.round((Math.ceil(list.scrollTop()) / 40));\n\n                            targetElement = list.find(\".js-\" + part + \"-\" + target);\n                            scrollTop = targetElement.position().top - (o.distance * 40);\n\n                            list.find(\".active\").removeClass(\"active\");\n\n                            list[0].scrollTop = scrollTop;\n                            targetElement.addClass(\"active\");\n                            Utils.exec(o.onScroll, [targetElement, list, picker], list[0]);\n\n                        }, scrollLatency);\n                    }\n                })\n            });\n        },\n\n        _correct: function(){\n            var m = this.value.month(),\n                d = this.value.day(),\n                y = this.value.year();\n\n            this.value = datetime(y, m, d);\n        },\n\n        _set: function(){\n            var element = this.element, o = this.options;\n            var picker = this.picker;\n            var m = this.locale['months'][this.value.month()],\n                d = this.value.day(),\n                y = this.value.year();\n\n            if (o.month === true) {\n                picker.find(\".month\").html(m);\n            }\n            if (o.day === true) {\n                picker.find(\".day\").html(d);\n            }\n            if (o.year === true) {\n                picker.find(\".year\").html(y);\n            }\n\n            element.val(this.value.format(o.format, o.locale)).trigger(\"change\");\n\n            this._fireEvent(\"set\", {\n                value: this.value.val(),\n                elementValue: element.val(),\n                picker: picker\n            })\n        },\n\n        open: function(){\n            var o = this.options;\n            var picker = this.picker;\n            var m = this.value.month(), d = this.value.day() - 1, y = this.value.year();\n            var m_list, d_list, y_list;\n            var select_wrapper = picker.find(\".select-wrapper\");\n            var select_wrapper_in_viewport, select_wrapper_rect;\n\n            select_wrapper.parent().removeClass(\"for-top for-bottom\");\n            select_wrapper.show(0);\n            picker.find(\"li\").removeClass(\"active\");\n\n            select_wrapper_in_viewport = Utils.inViewport(select_wrapper[0]);\n            select_wrapper_rect = Utils.rect(select_wrapper[0]);\n\n            if (!select_wrapper_in_viewport && select_wrapper_rect.top > 0) {\n                select_wrapper.parent().addClass(\"for-bottom\");\n            }\n\n            if (!select_wrapper_in_viewport && select_wrapper_rect.top < 0) {\n                select_wrapper.parent().addClass(\"for-top\");\n            }\n\n            if (o.month === true) {\n                m_list = picker.find(\".sel-month\");\n                m_list\n                    .scrollTop(0)\n                    .animate({\n                        draw: {\n                            scrollTop: m_list.find(\"li.js-month-\" + m).addClass(\"active\").position().top - (40 * o.distance)\n                        },\n                        dur: 100\n                    });\n            }\n            if (o.day === true) {\n                d_list = picker.find(\".sel-day\");\n                d_list\n                    .scrollTop(0)\n                    .animate({\n                        draw: {\n                            scrollTop: d_list.find(\"li.js-day-\" + d).addClass(\"active\").position().top - (40 * o.distance)\n                        },\n                        dur: 100\n                    });\n            }\n            if (o.year === true) {\n                y_list = picker.find(\".sel-year\");\n                y_list\n                    .scrollTop(0)\n                    .animate({\n                        draw: {\n                            scrollTop: y_list.find(\"li.js-year-real-\" + y).addClass(\"active\").position().top - (40 * o.distance)\n                        },\n                        dur: 100\n                    });\n            }\n\n            this.isOpen = true;\n\n            this._fireEvent(\"open\", {\n                value: this.value.val(),\n                picker: picker\n            })\n\n        },\n\n        close: function(){\n            var picker = this.picker;\n            picker.find(\".select-wrapper\").hide(0);\n            this.isOpen = false;\n\n            this._fireEvent(\"close\", {\n                value: this.value.val(),\n                picker: picker\n            });\n        },\n\n        val: function(value){\n            var o = this.options;\n\n            if (!Utils.isValue(value)) {\n                return this.element.val();\n            }\n\n            this.value = o.inputFormat ? Datetime.from(value, o.inputFormat, o.locale) : datetime(value);\n\n            this._set();\n        },\n\n        date: function(t, f){\n            if (t === undefined) {\n                return this.value.val();\n            }\n\n            try {\n                this.value = Datetime.from(t, f, this.options.locale);\n                this._set();\n            } catch (e) {\n                return false;\n            }\n        },\n\n        i18n: function(locale){\n            var element = this.element, o = this.options;\n            var month, i;\n\n            o.locale = locale ? locale : element.attr(\"data-locale\");\n            this.locale = Metro.locales[o.locale]['calendar'];\n\n            if (o.month === true) {\n                month =  element.closest(\".date-picker\").find(\".sel-month\").html(\"\");\n                for (i = 0; i < o.distance; i++) $(\"<li>\").html(\"&nbsp;\").data(\"value\", -1).appendTo(month);\n                for (i = 0; i < 12; i++) {\n                    $(\"<li>\").addClass(\"js-month-\"+i+\" js-month-real-\"+this.locale['months'][i].toLowerCase()).html(this.locale['months'][i]).data(\"value\", i).appendTo(month);\n                }\n                for (i = 0; i < o.distance; i++) $(\"<li>\").html(\"&nbsp;\").data(\"value\", -1).appendTo(month);\n            }\n\n            this._set();\n        },\n\n\n        disable: function(){\n            this.element.data(\"disabled\", true);\n            this.element.parent().addClass(\"disabled\");\n        },\n\n        enable: function(){\n            this.element.data(\"disabled\", false);\n            this.element.parent().removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        changeAttribute: function(attr, newValue){\n            switch (attr) {\n                case \"disabled\": this.toggleState(); break;\n                case \"data-value\": this.val(newValue); break;\n                case \"data-locale\": this.i18n(newValue); break;\n                case \"data-format\":\n                    this.options.format = newValue;\n                    this._set();\n                    break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element, picker = this.picker;\n\n            $.each([\"moth\", \"day\", \"year\"], function(){\n                picker.find(\".sel-\"+this).off(\"scroll\");\n            });\n\n            picker.off(Metro.events.start, \".select-block ul\");\n            picker.off(Metro.events.click);\n            picker.off(Metro.events.click, \".action-ok\");\n            picker.off(Metro.events.click, \".action-cancel\");\n\n            return element;\n        }\n    });\n\n    $(document).on(Metro.events.click, function(){\n        $.each($(\".date-picker\"), function(){\n            $(this).find(\"input\").each(function(){\n                Metro.getPlugin(this, \"datepicker\").close();\n            });\n        });\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var DialogDefaultConfig = {\n        dialogDeferred: 0,\n        closeButton: false,\n        leaveOverlayOnClose: false,\n        toTop: false,\n        toBottom: false,\n        locale: METRO_LOCALE,\n        title: \"\",\n        content: \"\",\n        actions: {},\n        actionsAlign: \"right\",\n        defaultAction: true,\n        overlay: true,\n        overlayColor: '#000000',\n        overlayAlpha: .5,\n        overlayClickClose: false,\n        width: '480',\n        height: 'auto',\n        shadow: true,\n        closeAction: true,\n        clsDialog: \"\",\n        clsTitle: \"\",\n        clsContent: \"\",\n        clsAction: \"\",\n        clsDefaultAction: \"\",\n        clsOverlay: \"\",\n        autoHide: 0,\n        removeOnClose: false,\n        show: false,\n\n        _runtime: false,\n\n        onShow: Metro.noop,\n        onHide: Metro.noop,\n        onOpen: Metro.noop,\n        onClose: Metro.noop,\n        onDialogCreate: Metro.noop\n    };\n\n    Metro.dialogSetup = function (options) {\n        DialogDefaultConfig = $.extend({}, DialogDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroDialogSetup\"] !== undefined) {\n        Metro.dialogSetup(window[\"metroDialogSetup\"]);\n    }\n\n    Metro.Component('dialog', {\n        _counter: 0,\n\n        init: function( options, elem ) {\n            this._super(elem, options, DialogDefaultConfig, {\n                interval: null,\n                overlay: null,\n                id: Utils.elementId(\"dialog\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var o = this.options;\n            this.locale = Metro.locales[o.locale] !== undefined ? Metro.locales[o.locale] : Metro.locales[\"en-US\"];\n            this._build();\n        },\n\n        _build: function(){\n            var that = this, element = this.element, o = this.options;\n            var body = $(\"body\");\n            var overlay;\n\n            element.addClass(\"dialog\");\n\n            if (o.shadow === true) {\n                element.addClass(\"shadow-on\");\n            }\n\n            if (o.title !== \"\") {\n                this.setTitle(o.title);\n            }\n\n            if (o.content !== \"\") {\n                this.setContent(o.content);\n            }\n\n            if (o.defaultAction === true || (o.actions !== false && typeof o.actions === 'object' && Utils.objectLength(o.actions) > 0)) {\n                var buttons = element.find(\".dialog-actions\");\n                var button;\n\n                if (buttons.length === 0) {\n                    buttons = $(\"<div>\").addClass(\"dialog-actions\").addClass(\"text-\"+o.actionsAlign).appendTo(element);\n                }\n\n                if (o.defaultAction === true && (Utils.objectLength(o.actions) === 0 && element.find(\".dialog-actions > *\").length === 0)) {\n                    button = $(\"<button>\").addClass(\"button js-dialog-close\").addClass(o.clsDefaultAction).html(this.locale[\"buttons\"][\"ok\"]);\n                    button.appendTo(buttons);\n                }\n\n                if (Utils.isObject(o.actions)) $.each(Utils.isObject(o.actions), function(){\n                    var item = this;\n                    button = $(\"<button>\").addClass(\"button\").addClass(item.cls).html(item.caption);\n                    if (item.onclick !== undefined) button.on(Metro.events.click, function(){\n                        Utils.exec(item.onclick, [element]);\n                    });\n                    button.appendTo(buttons);\n                });\n            }\n\n            if (o.overlay === true) {\n                overlay  = this._overlay();\n                this.overlay = overlay;\n            }\n\n            if (o.closeAction === true) {\n                element.on(Metro.events.click, \".js-dialog-close\", function(){\n                    that.close();\n                });\n            }\n\n            var closer = element.find(\"closer\");\n            if (closer.length === 0) {\n                closer = $(\"<span>\").addClass(\"button square closer js-dialog-close\");\n                closer.appendTo(element);\n            }\n            if (o.closeButton !== true) {\n                closer.hide();\n            }\n\n            element.css({\n                width: o.width,\n                height: o.height,\n                visibility: \"hidden\",\n                top: '100%',\n                left: ( $(window).width() - element.outerWidth() ) / 2\n            });\n\n            element.addClass(o.clsDialog);\n            element.find(\".dialog-title\").addClass(o.clsTitle);\n            element.find(\".dialog-content\").addClass(o.clsContent);\n            element.find(\".dialog-actions\").addClass(o.clsAction);\n\n            element.appendTo(body);\n\n            if (o.show) {\n                this.open();\n            }\n\n            $(window).on(Metro.events.resize, function(){\n                that.setPosition();\n            }, {ns: this.id});\n\n            this._fireEvent(\"dialog-create\", {\n                element: element\n            });\n        },\n\n        _overlay: function(){\n            var o = this.options;\n\n            var overlay = $(\"<div>\");\n            overlay.addClass(\"overlay\").addClass(o.clsOverlay);\n\n            if (o.overlayColor === 'transparent') {\n                overlay.addClass(\"transparent\");\n            } else {\n                overlay.css({\n                    background: Metro.colors.toRGBA(o.overlayColor, o.overlayAlpha)\n                });\n            }\n\n            return overlay;\n        },\n\n        hide: function(callback){\n            var element = this.element, o = this.options;\n            var timeout = 0;\n            if (o.onHide !== Metro.noop) {\n                timeout = 500;\n\n                this._fireEvent(\"hide\");\n            }\n            setTimeout(function(){\n                Utils.exec(callback, null, element[0]);\n                element.css({\n                    visibility: \"hidden\",\n                    top: \"100%\"\n                });\n            }, timeout);\n        },\n\n        show: function(callback){\n            var element = this.element;\n            this.setPosition();\n            element.css({\n                visibility: \"visible\"\n            });\n\n            this._fireEvent(\"show\");\n\n            Utils.exec(callback, null, element[0]);\n        },\n\n        setPosition: function(){\n            var element = this.element, o = this.options;\n            var top, bottom;\n            if (o.toTop !== true && o.toBottom !== true) {\n                top = ( $(window).height() - element.outerHeight() ) / 2;\n                if (top < 0) {\n                    top = 0;\n                }\n                bottom = \"auto\";\n            } else {\n                if (o.toTop === true) {\n                    top = 0;\n                    bottom = \"auto\";\n                }\n                if (o.toTop !== true && o.toBottom === true) {\n                    bottom = 0;\n                    top = \"auto\";\n                }\n            }\n            element.css({\n                top: top,\n                bottom: bottom,\n                left: ( $(window).width() - element.outerWidth() ) / 2\n            });\n        },\n\n        setContent: function(c){\n            var element = this.element;\n            var content = element.find(\".dialog-content\");\n            if (content.length === 0) {\n                content = $(\"<div>\").addClass(\"dialog-content\");\n                content.appendTo(element);\n            }\n\n            if (!Utils.isQ(c) && Utils.isFunc(c)) {\n                c = Utils.exec(c);\n            }\n\n            if (Utils.isQ(c)) {\n                c.appendTo(content);\n            } else {\n                content.html(c);\n            }\n        },\n\n        setTitle: function(t){\n            var element = this.element;\n            var title = element.find(\".dialog-title\");\n            if (title.length === 0) {\n                title = $(\"<div>\").addClass(\"dialog-title\");\n                title.appendTo(element);\n            }\n            title.html(t);\n        },\n\n        close: function(){\n            var that = this, element = this.element, o = this.options;\n\n            if (!Utils.bool(o.leaveOverlayOnClose)) {\n                $('body').find('.overlay').remove();\n            }\n\n            this.hide(function(){\n                element.data(\"open\", false);\n\n                that._fireEvent(\"close\")\n\n                if (o.removeOnClose === true) {\n                    element.remove();\n                }\n            });\n        },\n\n        open: function(){\n            var that = this, element = this.element, o = this.options;\n\n            if (o.overlay === true && $(\".overlay\").length === 0) {\n                this.overlay.appendTo($(\"body\"));\n                if (o.overlayClickClose === true) {\n                    this.overlay.on(Metro.events.click, function(){\n                        that.close();\n                    });\n                }\n            }\n\n            this.show(function(){\n\n                that._fireEvent(\"open\");\n\n                element.data(\"open\", true);\n                if (parseInt(o.autoHide) > 0) {\n                    setTimeout(function(){\n                        that.close();\n                    }, parseInt(o.autoHide));\n                }\n            });\n        },\n\n        toggle: function(){\n            var element = this.element;\n            if (element.data('open')) {\n                this.close();\n            } else {\n                this.open();\n            }\n        },\n\n        isOpen: function(){\n            return this.element.data('open') === true;\n        },\n\n        /* eslint-disable-next-line */\n        changeAttribute: function(attributeName){\n        },\n\n        destroy: function(){\n            var element = this.element;\n\n            element.off(Metro.events.click, \".js-dialog-close\");\n            element.find(\".button\").off(Metro.events.click);\n            $(window).off(Metro.events.resize,{ns: this.id});\n\n            return element;\n        }\n    });\n\n    Metro.dialog = {\n        isDialog: function(el){\n            return Utils.isMetroObject(el, \"dialog\");\n        },\n\n        open: function(el, content, title){\n            if (!this.isDialog(el)) {\n                return false;\n            }\n            var dialog = Metro.getPlugin(el, \"dialog\");\n            if (title !== undefined) {\n                dialog.setTitle(title);\n            }\n            if (content !== undefined) {\n                dialog.setContent(content);\n            }\n            dialog.open();\n        },\n\n        close: function(el){\n            if (!this.isDialog(el)) {\n                return false;\n            }\n            Metro.getPlugin($(el)[0], \"dialog\").close();\n        },\n\n        toggle: function(el){\n            if (!this.isDialog(el)) {\n                return false;\n            }\n            Metro.getPlugin($(el)[0], \"dialog\").toggle();\n        },\n\n        isOpen: function(el){\n            if (!this.isDialog(el)) {\n                return false;\n            }\n            Metro.getPlugin($(el)[0], \"dialog\").isOpen();\n        },\n\n        remove: function(el){\n            if (!this.isDialog(el)) {\n                return false;\n            }\n            var dialog = Metro.getPlugin($(el)[0], \"dialog\");\n            dialog.options.removeOnClose = true;\n            dialog.close();\n        },\n\n        create: function(options){\n            var dlg;\n\n            dlg = $(\"<div>\").appendTo($(\"body\"));\n\n            var dlg_options = $.extend({}, {\n                show: true,\n                closeAction: true,\n                removeOnClose: true\n            }, (options !== undefined ? options : {}));\n\n            dlg_options._runtime = true;\n\n            return Metro.makePlugin(dlg, \"dialog\", dlg_options);\n        }\n    };\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var DonutDefaultConfig = {\n        donutDeferred: 0,\n        size: 100,\n        hole: .8,\n        value: 0,\n        background: \"#ffffff\",\n        color: \"\",\n        stroke: \"#d1d8e7\",\n        fill: \"#49649f\",\n        fontSize: 0,\n        total: 100,\n        cap: \"%\",\n        showText: true,\n        showValue: false,\n        animate: 0,\n        onChange: Metro.noop,\n        onDrawValue: function(v){return v},\n        onDonutCreate: Metro.noop\n    };\n\n    Metro.donutSetup = function (options) {\n        DonutDefaultConfig = $.extend({}, DonutDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroDonutSetup\"] !== undefined) {\n        Metro.donutSetup(window[\"metroDonutSetup\"]);\n    }\n\n    Metro.Component('donut', {\n        init: function( options, elem ) {\n            this._super(elem, options, DonutDefaultConfig, {\n                value: 0,\n                animation_change_interval: null\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n\n            element.addClass(\"donut\");\n\n            this._setElementSize();\n            this._draw();\n            this._addEvents();\n            this.val(o.value);\n\n            this._fireEvent(\"donut-create\", {\n                element: element\n            });\n        },\n\n        _setElementSize: function(){\n            var element = this.element, o = this.options;\n            var width = o.size;\n\n            element.css({\n                width: width,\n                background: o.background\n            });\n\n            element.css({\n                height: element.width()\n            });\n        },\n\n        _draw: function(){\n            var element = this.element, o = this.options;\n            var html = \"\";\n            var radius = element.width() / 2\n            var r = radius  * (1 - (1 - o.hole) / 2);\n            var width = radius * (1 - o.hole);\n            var transform = 'rotate(-90 ' + radius + ',' + radius + ')';\n            var fontSize = o.fontSize === 0 ? r * o.hole * 0.6 : o.fontSize;\n\n            html += \"<svg>\";\n            html += \"   <circle class='donut-back' r='\"+(r)+\"px' cx='\"+(radius)+\"px' cy='\"+(radius)+\"px' transform='\"+(transform)+\"' fill='none' stroke='\"+(o.stroke)+\"' stroke-width='\"+(width)+\"'/>\";\n            html += \"   <circle class='donut-fill' r='\"+(r)+\"px' cx='\"+(radius)+\"px' cy='\"+(radius)+\"px' transform='\"+(transform)+\"' fill='none' stroke='\"+(o.fill)+\"' stroke-width='\"+(width)+\"'/>\";\n\n            if (o.showText === true)\n                html += \"   <text class='donut-title' x='\"+(radius)+\"px' y='\"+(radius)+\"px' dy='\"+(fontSize/3)+\"px' text-anchor='middle' fill='\"+(o.color !== \"\" ? o.color: o.fill)+\"' font-size='\"+(fontSize)+\"px'></text>\";\n\n            html += \"</svg>\";\n\n            element.html(html);\n        },\n\n        _addEvents: function(){\n            var that = this;\n\n            $(window).on(\"resize\", function(){\n                that._setElementSize();\n                that._draw();\n                that.val(that.value);\n            })\n        },\n\n        _setValue: function(v){\n            var element = this.element, o = this.options;\n\n            var fill = element.find(\".donut-fill\");\n            var title = element.find(\".donut-title\");\n            var radius = element.width() / 2\n            var r = radius  * (1 - (1 - o.hole) / 2);\n            var circumference = Math.round(2 * Math.PI * r);\n            var title_value = (o.showValue ? v : Utils.percent(o.total, v, true))/*  + (o.cap)*/;\n            var fill_value = Math.round(((+v * circumference) / o.total));// + ' ' + circumference;\n\n            var sda = fill.attr(\"stroke-dasharray\");\n            if (typeof sda === \"undefined\") {\n                sda = 0;\n            } else {\n                sda = +sda.split(\" \")[0];\n            }\n            var delta = fill_value - sda;\n\n            fill.animate({\n                draw: function(t, p){\n                    $(this).attr(\"stroke-dasharray\", (sda + delta * p ) + ' ' + circumference);\n                },\n                dur: o.animate\n            })\n\n            title.html(Metro.utils.exec(o.onDrawValue, [title_value + o.cap]));\n\n            // title.animate({\n            //     draw: {\n            //         innerHTML: title_value\n            //     },\n            //     dur: o.animate,\n            //     onFrame: function(){\n            //         this.innerHTML = Metro.utils.exec(o.onDrawValue, [this.innerHTML + o.cap]);\n            //     }\n            // });\n        },\n\n        val: function(v){\n            var o = this.options;\n\n            if (v === undefined) {\n                return this.value\n            }\n\n            if (parseInt(v) < 0 || parseInt(v) > o.total) {\n                return false;\n            }\n\n            this._setValue(v);\n\n            this.value = v;\n\n            this._fireEvent(\"change\", {\n                value: this.value\n            });\n        },\n\n        setColor: function(obj){\n            var validKeys = [\"background, fill, stroke, color\"]\n\n            $.each(obj, function(key, val){\n                if (validKeys.indexOf(key) !== -1) {\n                    this.options[key] = val\n                }\n            })\n\n            this._draw();\n            this.val(this.value);\n\n            return this;\n        },\n\n        changeValue: function(){\n            this.val(this.element.attr(\"data-value\"));\n        },\n\n        changeAttribute: function(attr, val){\n            switch (attr) {\n                case \"data-value\": this.changeValue(); break;\n                case \"data-background\": this.setColor({\"background\": val}); break;\n                case \"data-fill\": this.setColor({\"fill\": val}); break;\n                case \"data-stroke\": this.setColor({\"stroke\": val}); break;\n                case \"data-color\": this.setColor({\"color\": val}); break;\n            }\n        },\n\n        destroy: function(){\n            return this.element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n/* eslint-disable */\n(function(Metro, $) {\n    'use strict';\n\n    var DoubleSelectBoxDefaultConfig = {\n        height: \"auto\",\n        multiSelect: false,\n\n        moveRightIcon: \"<span>&rsaquo;</span>\",\n        moveRightAllIcon: \"<span>&raquo;</span>\",\n        moveLeftIcon: \"<span>&lsaquo;</span>\",\n        moveLeftAllIcon: \"<span>&laquo;</span>\",\n\n        clsBox: \"\",\n        clsMoveButton: \"\",\n        clsMoveRightButton: \"\",\n        clsMoveRightAllButton: \"\",\n        clsMoveLeftButton: \"\",\n        clsMoveLeftAllButton: \"\",\n        clsListLeft: \"\",\n        clsListRight: \"\",\n\n        onDoubleSelectBoxCreate: Metro.noop\n    };\n\n    Metro.doubleSelectBoxSetup = function (options) {\n        DoubleSelectBoxDefaultConfig = $.extend({}, DoubleSelectBoxDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroDoubleSelectBoxSetup\"] !== undefined) {\n        Metro.doubleSelectBoxSetup(window[\"metroDoubleSelectBoxSetup\"]);\n    }\n\n    Metro.Component('double-select-box', {\n        init: function( options, elem ) {\n            this._super(elem, options, DoubleSelectBoxDefaultConfig, {\n                // define instance vars here\n                select1: null,\n                select2: null,\n                list1: null,\n                list2: null\n            });\n            return this;\n        },\n\n        _create: function(){\n            var that = this, element = this.element, o = this.options;\n\n            if (element.children(\"select\").length !== 2) {\n                throw new Error(\"Component DoubleSelectBox required two select elements!\")\n            }\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent('double-select-box-create');\n        },\n\n        _drawList: function(){\n            var that = this;\n\n            this.list1.clear();\n            this.select1.find(\"option\").each(function(i, option){\n                var $op = $(option);\n                var html = $op.attr(\"data-template\") ? $op.attr(\"data-template\").replace(/\\$1/g, $op.text()) : $op.text();\n\n                that.list1.append(\n                    $(\"<li>\").html(html).attr(\"data-value\", option.value).data(\"option\", option)\n                )\n            });\n\n            this.list2.clear();\n            this.select2.find(\"option\").each(function(i, option){\n                var $op = $(option);\n                var html = $op.attr(\"data-template\") ? $op.attr(\"data-template\").replace(/\\$1/g, $op.text()) : $op.text();\n\n                that.list2.append(\n                    $(\"<li>\").html(html).attr(\"data-value\", option.value).data(\"option\", option)\n                )\n            });\n        },\n\n        _createStructure: function(){\n            var that = this, element = this.element, o = this.options;\n            var selects = element.children(\"select\");\n            var select1 = selects.eq(0);\n            var select2 = selects.eq(1);\n            var controls = $(\"<div>\").addClass(\"controls\").insertBefore(select2);\n            var list1, list2;\n\n            element.addClass(\"double-select-box\").addClass(o.clsBox).css({\n                height: o.height\n            });\n\n            selects.prop(\"multiple\", true);\n\n            controls.append(\n                $([\n                    $(\"<button>\").attr(\"type\", \"button\").addClass(\"button --move-right\").addClass(o.clsMoveButton).addClass(o.clsMoveRightButton).html(o.moveRightIcon),\n                    $(\"<button>\").attr(\"type\", \"button\").addClass(\"button --move-right-all\").addClass(o.clsMoveButton).addClass(o.clsMoveRightAllButton).html(o.moveRightAllIcon),\n                    $(\"<button>\").attr(\"type\", \"button\").addClass(\"button --move-left-all\").addClass(o.clsMoveButton).addClass(o.clsMoveLeftAllButton).html(o.moveLeftAllIcon),\n                    $(\"<button>\").attr(\"type\", \"button\").addClass(\"button --move-left\").addClass(o.clsMoveButton).addClass(o.clsMoveLeftButton).html(o.moveLeftIcon),\n                ])\n            )\n\n            list1 = $(\"<ul>\").addClass(\"--list1\").addClass(o.clsListLeft).insertBefore(select1);\n            list2 = $(\"<ul>\").addClass(\"--list2\").addClass(o.clsListRight).insertBefore(select2);\n\n\n            this.select1 = select1;\n            this.select2 = select2;\n            this.list1 = list1;\n            this.list2 = list2;\n\n            this._drawList();\n        },\n\n        _moveItems: function(items, targets){\n            $.each(items, function(){\n                var $item = $(this);\n                var option = $item.data('option');\n\n                $(option).appendTo(targets[0]);\n                $item.removeClass(\"active\").appendTo(targets[1]);\n            })\n        },\n\n        _move: function(dir, scope){\n            var that = this;\n\n            if (scope === 'selected') {\n                if (dir === 'ltr') { // left to right\n                    that._moveItems(this.list1.find(\"li.active\"), [that.select2, that.list2]);\n                } else {\n                    that._moveItems(this.list2.find(\"li.active\"), [that.select1, that.list1]);\n                }\n            } else {\n                if (dir === 'ltr') { // left to right\n                    that._moveItems(this.list1.find(\"li\"), [that.select2, that.list2]);\n                } else {\n                    that._moveItems(this.list2.find(\"li\"), [that.select1, that.list1]);\n                }\n            }\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var items = element.find(\"li\");\n\n            items.on(\"click\", function(){\n                var $el = $(this);\n\n                if (o.multiSelect === false) {\n                    that.list1.find(\"li\").removeClass(\"active\");\n                    that.list2.find(\"li\").removeClass(\"active\");\n                }\n\n                $el.addClass(\"active\");\n            });\n\n            items.on(\"dblclick\", function(){\n                var $el = $(this);\n                var dir = $el.parent().hasClass(\"--list1\") ? 'ltr' : 'rtl';\n                var scope = 'selected';\n\n                that.list1.find(\"li\").removeClass(\"active\");\n                that.list2.find(\"li\").removeClass(\"active\");\n\n                $el.addClass(\"active\");\n\n                that._move(dir, scope);\n            });\n\n            element.on(\"click\", \"button\", function(){\n                var btn = $(this)\n                if (btn.hasClass(\"--move-right\")) {\n                    that._move('ltr', 'selected');\n                } else if (btn.hasClass(\"--move-right-all\")) {\n                    that._move('ltr', 'all');\n                } else if (btn.hasClass(\"--move-left\")) {\n                    that._move('rtl', 'selected');\n                } else if (btn.hasClass(\"--move-left-all\")) {\n                    that._move('rtl', 'all');\n                } else {\n                    throw new Error(\"Pressed unregistered button!\")\n                }\n            });\n        },\n\n        changeAttribute: function(attr, newValue){\n        },\n\n        destroy: function(){\n            this.element.remove();\n        }\n    });\n}(Metro, m4q));\n/* eslint-enable */\n\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var DoubleSliderDefaultConfig = {\n        doublesliderDeferred: 0,\n        roundValue: true,\n        min: 0,\n        max: 100,\n        accuracy: 0,\n        showMinMax: false,\n        minMaxPosition: Metro.position.TOP,\n        valueMin: null,\n        valueMax: null,\n        hint: false,\n        hintAlways: false,\n        hintPositionMin: Metro.position.TOP,\n        hintPositionMax: Metro.position.TOP,\n        hintMaskMin: \"$1\",\n        hintMaskMax: \"$1\",\n        target: null,\n        size: 0,\n\n        clsSlider: \"\",\n        clsBackside: \"\",\n        clsComplete: \"\",\n        clsMarker: \"\",\n        clsMarkerMin: \"\",\n        clsMarkerMax: \"\",\n        clsHint: \"\",\n        clsHintMin: \"\",\n        clsHintMax: \"\",\n        clsMinMax: \"\",\n        clsMin: \"\",\n        clsMax: \"\",\n\n        onStart: Metro.noop,\n        onStop: Metro.noop,\n        onMove: Metro.noop,\n        onChange: Metro.noop,\n        onChangeValue: Metro.noop,\n        onFocus: Metro.noop,\n        onBlur: Metro.noop,\n        onDoubleSliderCreate: Metro.noop\n    };\n\n    Metro.doubleSliderSetup = function (options) {\n        DoubleSliderDefaultConfig = $.extend({}, DoubleSliderDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroDoubleSliderSetup\"] !== undefined) {\n        Metro.doubleSliderSetup(window[\"metroDoubleSliderSetup\"]);\n    }\n\n    Metro.Component('double-slider', {\n        init: function( options, elem ) {\n            this._super(elem, options, DoubleSliderDefaultConfig, {\n                slider: null,\n                valueMin: null,\n                valueMax: null,\n                keyInterval: false,\n                id: Utils.elementId(\"slider\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n\n            this.valueMin = Utils.isValue(o.valueMin) ? +o.valueMin : +o.min;\n            this.valueMax = Utils.isValue(o.valueMax) ? +o.valueMax : +o.max;\n\n            this._createSlider();\n            this._createEvents();\n\n            this.val(this.valueMin, this.valueMax);\n\n            this._fireEvent(\"double-slider-create\", {\n                element: element\n            })\n        },\n\n        _createSlider: function(){\n            var element = this.element, o = this.options;\n            var slider_wrapper = $(\"<div>\").addClass(\"slider-wrapper\");\n            var slider = $(\"<div>\").addClass(\"slider\").addClass(o.clsSlider).addClass(this.elem.className);\n            var backside = $(\"<div>\").addClass(\"backside\").addClass(o.clsBackside);\n            var complete = $(\"<div>\").addClass(\"complete\").addClass(o.clsComplete);\n            var markerMin = $(\"<button>\").attr(\"type\", \"button\").addClass(\"marker marker-min\").addClass(o.clsMarker).addClass(o.clsMarkerMin);\n            var markerMax = $(\"<button>\").attr(\"type\", \"button\").addClass(\"marker marker-max\").addClass(o.clsMarker).addClass(o.clsMarkerMax);\n            var hintMin = $(\"<div>\").addClass(\"hint hint-min\").addClass(o.hintPositionMin + \"-side\").addClass(o.clsHint).addClass(o.clsHintMin);\n            var hintMax = $(\"<div>\").addClass(\"hint hint-max\").addClass(o.hintPositionMax + \"-side\").addClass(o.clsHint).addClass(o.clsHintMax);\n            var i;\n\n            if (o.size > 0) {\n                slider.outerWidth(o.size);\n            }\n\n            slider.insertBefore(element);\n            element.appendTo(slider);\n            slider_wrapper.insertBefore(slider);\n            slider.appendTo(slider_wrapper);\n\n            backside.appendTo(slider);\n            complete.appendTo(slider);\n            markerMin.appendTo(slider);\n            markerMax.appendTo(slider);\n            hintMin.appendTo(markerMin);\n            hintMax.appendTo(markerMax);\n\n            if (o.hintAlways === true) {\n                $([hintMin, hintMax]).css({\n                    display: \"block\"\n                }).addClass(\"permanent-hint\");\n            }\n\n            if (o.showMinMax === true) {\n                var min_max_wrapper = $(\"<div>\").addClass(\"slider-min-max\").addClass(o.clsMinMax);\n                $(\"<span>\").addClass(\"slider-text-min\").addClass(o.clsMin).html(o.min).appendTo(min_max_wrapper);\n                $(\"<span>\").addClass(\"slider-text-max\").addClass(o.clsMax).html(o.max).appendTo(min_max_wrapper);\n                if (o.minMaxPosition === Metro.position.TOP) {\n                    min_max_wrapper.insertBefore(slider);\n                } else {\n                    min_max_wrapper.insertAfter(slider);\n                }\n            }\n\n            element[0].className = '';\n            if (o.copyInlineStyles === true) {\n                for (i = 0; i < element[0].style.length; i++) {\n                    slider.css(element[0].style[i], element.css(element[0].style[i]));\n                }\n            }\n\n            if (element.is(\":disabled\")) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n\n            this.slider = slider;\n        },\n\n        _createEvents: function(){\n            var that = this, slider = this.slider, o = this.options;\n            var marker = slider.find(\".marker\");\n\n            marker.on(Metro.events.startAll, function(){\n                var _marker = $(this);\n                var hint = _marker.find(\".hint\");\n                if (o.hint === true && o.hintAlways !== true) {\n                    hint.fadeIn(300);\n                }\n\n                $(document).on(Metro.events.moveAll, function(e){\n                    that._move(e);\n                    that._fireEvent(\"move\", {\n                        min: that.valueMin,\n                        max: that.valueMax\n                    });\n\n                }, {ns: that.id});\n\n                $(document).on(Metro.events.stopAll, function(){\n                    $(document).off(Metro.events.moveAll, {ns: that.id});\n                    $(document).off(Metro.events.stopAll, {ns: that.id});\n\n                    if (o.hintAlways !== true) {\n                        hint.fadeOut(300);\n                    }\n\n                    that._fireEvent(\"stop\", {\n                        min: that.valueMin,\n                        max: that.valueMax\n                    });\n                }, {ns: that.id});\n\n                that._fireEvent(\"start\", {\n                    min: that.valueMin,\n                    max: that.valueMax\n                });\n            });\n\n            marker.on(Metro.events.focus, function(){\n                that._fireEvent(\"focus\", {\n                    min: that.valueMin,\n                    max: that.valueMax\n                });\n            });\n\n            marker.on(Metro.events.blur, function(){\n                that._fireEvent(\"blur\", {\n                    min: that.valueMin,\n                    max: that.valueMax\n                });\n            });\n\n            $(window).on(Metro.events.resize,function(){\n                that.val(that.valueMin, that.valueMax);\n            }, {ns: that.id});\n        },\n\n        _convert: function(v, how){\n            var slider = this.slider, o = this.options;\n            var length = slider.outerWidth() - slider.find(\".marker\").outerWidth();\n            switch (how) {\n                case \"pix2prc\": return ( v * 100 / length );\n                case \"pix2val\": return ( this._convert(v, 'pix2prc') * ((o.max - o.min) / 100) + o.min );\n                case \"val2prc\": return ( (v - o.min)/( (o.max - o.min) / 100 )  );\n                case \"prc2pix\": return ( v / ( 100 / length ));\n                case \"val2pix\": return ( this._convert(this._convert(v, 'val2prc'), 'prc2pix') );\n            }\n\n            return 0;\n        },\n\n        _correct: function(value){\n            var res = value;\n            var accuracy  = this.options.accuracy;\n            var min = this.options.min, max = this.options.max;\n            var _dec = function(v){\n                return v % 1 === 0 ? 0 : v.toString().split(\".\")[1].length;\n            };\n\n            if (accuracy === 0 || isNaN(accuracy)) {\n                return res;\n            }\n\n            res = Math.round(value/accuracy)*accuracy;\n\n            if (res < min) {\n                res = min;\n            }\n\n            if (res > max) {\n                res = max;\n            }\n\n            return res.toFixed(_dec(accuracy));\n        },\n\n        _move: function(e){\n            var target = $(e.target).closest(\".marker\");\n            var isMin = target.hasClass(\"marker-min\");\n            var slider = this.slider;\n            var offset = slider.offset(),\n                marker_size = slider.find(\".marker\").outerWidth(),\n                markerMin = slider.find(\".marker-min\"),\n                markerMax = slider.find(\".marker-max\"),\n                length = slider.outerWidth(),\n                cPix, cStart, cStop;\n\n            cPix = Utils.pageXY(e).x - offset.left - marker_size / 2;\n\n            if (isMin) {\n                cStart = 0;\n                cStop = parseInt(markerMax.css(\"left\")) - marker_size;\n            } else {\n                cStart = parseInt(markerMin.css(\"left\")) + marker_size;\n                cStop = length - marker_size;\n            }\n\n            if (cPix < cStart || cPix > cStop) {\n                return ;\n            }\n\n            this[isMin ? \"valueMin\" : \"valueMax\"] = this._correct(this._convert(cPix, 'pix2val'));\n\n            this._redraw();\n        },\n\n        _hint: function(){\n            var that = this, o = this.options, slider = this.slider, hint = slider.find(\".hint\");\n\n            hint.each(function(){\n                var _hint = $(this);\n                var isMin = _hint.hasClass(\"hint-min\");\n                var _mask = isMin ? o.hintMaskMin : o.hintMaskMax;\n                var value = +(isMin ? that.valueMin : that.valueMax) || 0;\n                _hint.text(_mask.replace(\"$1\", value.toFixed(Utils.decCount(o.accuracy))))\n            });\n        },\n\n        _value: function(){\n            var element = this.element, o = this.options;\n            var v1 = +this.valueMin || 0, v2 = +this.valueMax || 0;\n            var value;\n\n            if (o.roundValue) {\n                v1 = v1.toFixed(Utils.decCount(o.accuracy));\n                v2 = v2.toFixed(Utils.decCount(o.accuracy));\n            }\n\n            value = [v1, v2].join(\", \");\n\n            if (element[0].tagName === \"INPUT\") {\n                element.val(value);\n            }\n\n            if (o.target !== null) {\n                var target = $(o.target);\n                if (target.length !== 0) {\n\n                    $.each(target, function(){\n                        var t = $(this);\n                        if (this.tagName === \"INPUT\") {\n                            t.val(value);\n                        } else {\n                            t.text(value);\n                        }\n                        t.trigger(\"change\");\n                    });\n                }\n            }\n\n            this._fireEvent(\"change-value\", {\n                val: value\n            });\n\n            this._fireEvent(\"change\", {\n                val: value\n            });\n        },\n\n        _marker: function(){\n            var slider = this.slider;\n            var markerMin = slider.find(\".marker-min\");\n            var markerMax = slider.find(\".marker-max\");\n            var complete = slider.find(\".complete\");\n            var marker_size = parseInt(Utils.getStyleOne(markerMin, \"width\"));\n            var slider_visible = Utils.isVisible(slider);\n\n            if (slider_visible) {\n                $([markerMin, markerMax]).css({\n                    'margin-top': 0,\n                    'margin-left': 0\n                });\n            }\n\n            if (slider_visible) {\n                markerMin.css('left', this._convert(this.valueMin, 'val2pix'));\n                markerMax.css('left', this._convert(this.valueMax, 'val2pix'));\n            } else {\n                markerMin.css({\n                    'left': (this._convert(this.valueMin, 'val2prc')) + \"%\",\n                    'margin-top': this._convert(this.valueMin, 'val2prc') === 0 ? 0 : -1 * marker_size / 2\n                });\n                markerMax.css({\n                    'left': (this._convert(this.valueMax, 'val2prc')) + \"%\",\n                    'margin-top': this._convert(this.valueMax, 'val2prc') === 0 ? 0 : -1 * marker_size / 2\n                });\n            }\n\n            complete.css({\n                \"left\": this._convert(this.valueMin, 'val2pix'),\n                \"width\": this._convert(this.valueMax, 'val2pix') - this._convert(this.valueMin, 'val2pix')\n            });\n        },\n\n        _redraw: function(){\n            this._marker();\n            this._value();\n            this._hint();\n        },\n\n        val: function(vMin, vMax){\n            var o = this.options;\n\n            if (!Utils.isValue(vMin) && !Utils.isValue(vMax)) {\n                return [this.valueMin, this.valueMax];\n            }\n\n            if (vMin < o.min) vMin = o.min;\n            if (vMax < o.min) vMax = o.min;\n\n            if (vMin > o.max) vMin = o.max;\n            if (vMax > o.max) vMax = o.max;\n\n            this.valueMin = this._correct(vMin);\n            this.valueMax = this._correct(vMax);\n\n            this._redraw();\n        },\n\n        changeValue: function(){\n            var element = this.element;\n            var valMin = +element.attr(\"data-value-min\");\n            var valMax = +element.attr(\"data-value-max\");\n            this.val(valMin, valMax);\n        },\n\n        disable: function(){\n            var element = this.element;\n            element.data(\"disabled\", true);\n            element.parent().addClass(\"disabled\");\n        },\n\n        enable: function(){\n            var element = this.element;\n            element.data(\"disabled\", false);\n            element.parent().removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case \"data-value-min\": this.changeValue(); break;\n                case \"data-value-max\": this.changeValue(); break;\n                case 'disabled': this.toggleState(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element, slider = this.slider;\n            var marker = slider.find(\".marker\");\n\n            marker.off(Metro.events.startAll);\n            marker.off(Metro.events.focus);\n            marker.off(Metro.events.blur);\n            marker.off(Metro.events.keydown);\n            marker.off(Metro.events.keyup);\n            slider.off(Metro.events.click);\n            $(window).off(Metro.events.resize, {ns: this.id});\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var DragItemsDefaultConfig = {\n        dragitemsDeferred: 0,\n        target: null,\n        dragItem: \"li\",\n        dragMarker: \".drag-item-marker\",\n        drawDragMarker: false,\n        clsDragItemAvatar: \"\",\n        clsDragItem: \"\",\n        canDrag: true,\n        onDragStartItem: Metro.noop,\n        onDragMoveItem: Metro.noop,\n        onDragDropItem: Metro.noop,\n        onTarget: Metro.noop,\n        onTargetIn: Metro.noop, //TODO\n        onTargetOut: Metro.noop, //TODO\n        onDragItemsCreate: Metro.noop\n    };\n\n    Metro.dragItemsSetup = function (options) {\n        DragItemsDefaultConfig = $.extend({}, DragItemsDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroDragItemsSetup\"] !== undefined) {\n        Metro.dragItemsSetup(window[\"metroDragItemsSetup\"]);\n    }\n\n    Metro.Component('drag-items', {\n        init: function( options, elem ) {\n            this._super(elem, options, DragItemsDefaultConfig, {\n                id: Utils.elementId(\"dragItems\"),\n                canDrag: false\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"drag-items-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n\n            element.addClass(\"drag-items-target\");\n\n            if (o.drawDragMarker === true) {\n                element.find(o.dragItem).each(function(){\n                    $(\"<span>\").addClass(\"drag-item-marker\").appendTo(this);\n                })\n            }\n\n            o.canDrag ? this.on() : this.off();\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var doc = $.document(), body = $.body();\n            var offset, shift = {top: 0, left: 0}, width, height;\n\n            var move = function(e, avatar, dragItem){\n                var x = Utils.pageXY(e).x, y = Utils.pageXY(e).y;\n                var _top = y - shift.top;\n                var _left = x - shift.left;\n\n                avatar.css({\n                    top: _top,\n                    left: _left\n                });\n\n                var target = document.elementsFromPoint(x, y).filter(function(el){\n                    return $(el).hasClass('drag-items-target');\n                });\n\n                if (target.length === 0) {\n                    return;\n                }\n\n                that._fireEvent(\"target\", {\n                    target: target\n                });\n\n                var sibling = document.elementsFromPoint(x, y).filter(function(el){\n                    var $el = $(el);\n                    return $.matches(el, o.dragItem) && !$el.hasClass(\"dragged-item-avatar\");\n                })[0];\n\n                if (!Utils.isValue(sibling)) {\n                    dragItem.appendTo(target);\n                } else {\n                    var $sibling = $(sibling);\n                    var $sibling_offset = $sibling.offset();\n                    var offsetY = y - $sibling_offset.top;\n                    var offsetX = x - $sibling_offset.left;\n                    var side;\n                    var dim = {w: $sibling.width(), h: $sibling.height()};\n\n                    if (offsetX < dim.w / 3 && (offsetY < dim.h / 2 || offsetY > dim.h / 2)) {\n                        side = 'left';\n                    } else if (offsetX > dim.w * 2 / 3 && (offsetY < dim.h / 2 || offsetY > dim.h / 2)) {\n                        side = 'right';\n                    } else if (offsetX > dim.w / 3 && offsetX < dim.w * 2 / 3 && offsetY > dim.h / 2) {\n                        side = 'bottom';\n                    } else {\n                        side = \"top\";\n                    }\n\n                    if (!$sibling.hasClass(\"dragged-item\")) {\n                        if (side === \"top\" || side === \"left\") {\n                            dragItem.insertBefore($sibling);\n                        } else {\n                            dragItem.insertAfter($sibling);\n                        }\n                    }\n                }\n            };\n\n            element.on(Metro.events.startAll, (o.drawDragMarker ? o.dragMarker : o.dragItem), function(e_start){\n                var dragItem = $(e_start.target).closest(o.dragItem);\n                var avatar;\n\n                if (Utils.isRightMouse(e_start)) {\n                    return ;\n                }\n\n                if (that.canDrag !== true) {\n                    return ;\n                }\n\n                dragItem.addClass(\"dragged-item\").addClass(o.clsDragItem);\n                avatar = $(\"<div>\").addClass(\"dragged-item-avatar\").addClass(o.clsDragItemAvatar);\n                offset = dragItem.offset();\n                width = dragItem.width();\n                height = dragItem.height();\n                shift.top = Utils.pageXY(e_start).y - offset.top;\n                shift.left = Utils.pageXY(e_start).x - offset.left;\n\n                avatar.css({\n                    top: offset.top,\n                    left: offset.left,\n                    width: width,\n                    height: height\n                }).appendTo(body);\n\n                that._fireEvent(\"drag-start-item\", {\n                    dragItem: dragItem[0],\n                    avatar: avatar[0]\n                });\n\n                doc.on(Metro.events.moveAll, function(e_move){\n\n                    move(e_move, avatar, dragItem);\n\n                    that._fireEvent(\"drag-move-item\", {\n                        dragItem: dragItem[0],\n                        avatar: avatar[0]\n                    });\n\n                    e_move.preventDefault();\n\n                }, {ns: that.id, passive: false});\n\n                doc.on(Metro.events.stopAll, function(){\n\n                    that._fireEvent(\"drag-drop-item\", {\n                        dragItem: dragItem[0],\n                        avatar: avatar[0]\n                    });\n\n                    dragItem.removeClass(\"dragged-item\").removeClass(o.clsDragItem);\n                    avatar.remove();\n\n                    doc.off(Metro.events.moveAll, {ns: that.id});\n                    doc.off(Metro.events.stopAll, {ns: that.id});\n\n                }, {ns: that.id});\n\n                if (o.drawDragMarker) {\n                    e_start.preventDefault();\n                    e_start.stopPropagation();\n                }\n            });\n        },\n\n        on: function(){\n            this.canDrag = true;\n            this.element.find(\".drag-item-marker\").show();\n        },\n\n        off: function(){\n            this.canDrag = false;\n            this.element.find(\".drag-item-marker\").hide();\n        },\n\n        toggle: function(){\n            this.canDrag = this.canDrag ? this.off() : this.on();\n        },\n\n        changeAttribute: function(attributeName){\n            var that = this, element = this.element, o = this.options;\n            var changeCanDrag = function(){\n                o.canDtag = JSON.parse(element.attr(\"data-can-drag\"));\n                o.canDtag ? that.on() : that.off();\n            };\n\n            if (attributeName === \"data-can-drag\") {\n                changeCanDrag();\n            }\n        },\n\n        destroy: function(){\n            var element = this.element, o = this.options;\n            element.off(Metro.events.startAll, (o.drawDragMarker ? o.dragMarker : o.dragItem));\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var DraggableDefaultConfig = {\n        dragContext: null,\n        draggableDeferred: 0,\n        dragElement: 'self',\n        dragArea: \"parent\",\n        timeout: 0,\n        boundaryRestriction: true,\n        onCanDrag: Metro.noop_true,\n        onDragStart: Metro.noop,\n        onDragStop: Metro.noop,\n        onDragMove: Metro.noop,\n        onDraggableCreate: Metro.noop\n    };\n\n    Metro.draggableSetup = function (options) {\n        DraggableDefaultConfig = $.extend({}, DraggableDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroDraggableSetup\"] !== undefined) {\n        Metro.draggableSetup(window[\"metroDraggableSetup\"]);\n    }\n\n    Metro.Component('draggable', {\n        init: function( options, elem ) {\n            this._super(elem, options, DraggableDefaultConfig, {\n                drag: false,\n                move: false,\n                backup: {\n                    cursor: 'default',\n                    zIndex: '0'\n                },\n                dragArea: null,\n                dragElement: null,\n                id: Utils.elementId(\"draggable\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"draggable-create\", {\n                element: this.element\n            });\n        },\n\n        _createStructure: function(){\n            var that = this, element = this.element, o = this.options;\n            var offset = element.offset();\n            var dragElement  = o.dragElement !== 'self' ? element.find(o.dragElement) : element;\n\n            element.data(\"canDrag\", true);\n\n            this.dragElement = dragElement;\n\n            dragElement[0].ondragstart = function(){return false;};\n\n            element.css(\"position\", \"absolute\");\n\n            if (o.dragArea === 'document' || o.dragArea === 'window') {\n                o.dragArea = \"body\";\n            }\n\n            setImmediate(function(){\n                that.dragArea = o.dragArea === 'parent' ? element.parent() : $(o.dragArea);\n                if (o.dragArea !== 'parent') {\n                    element.appendTo(that.dragArea);\n                    element.css({\n                        top: offset.top,\n                        left: offset.left\n                    });\n                }\n            });\n\n            if (!element.attr(\"id\")) {\n                element.attr(\"id\", Utils.elementId(\"draggable\"));\n            }\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var position = {\n                x: 0,\n                y: 0\n            };\n\n            this.dragElement.on(Metro.events.startAll, function(e){\n\n                var coord = o.dragArea !== \"parent\" ? element.offset() : element.position(),\n                    shiftX = Utils.pageXY(e).x - coord.left,\n                    shiftY = Utils.pageXY(e).y - coord.top;\n\n                var moveElement = function(e){\n                    var top = Utils.pageXY(e).y - shiftY;\n                    var left = Utils.pageXY(e).x - shiftX;\n\n                    if (o.boundaryRestriction) {\n                        if (top < 0) top = 0;\n                        if (left < 0) left = 0;\n\n                        if (top > that.dragArea.outerHeight() - element.outerHeight()) top = that.dragArea.outerHeight() - element.outerHeight();\n                        if (left > that.dragArea.outerWidth() - element.outerWidth()) left = that.dragArea.outerWidth() - element.outerWidth();\n                    }\n\n                    position.y = top;\n                    position.x = left;\n\n                    element.css({\n                        left: left,\n                        top: top\n                    });\n                };\n\n\n                if (element.data(\"canDrag\") === false || Utils.exec(o.onCanDrag, [element]) !== true) {\n                    return ;\n                }\n\n                if (Metro.isTouchable === false && e.which !== 1) {\n                    return ;\n                }\n\n                that.drag = true;\n\n                that.backup.cursor = element.css(\"cursor\");\n                that.backup.zIndex = element.css(\"z-index\");\n\n                element.addClass(\"draggable\");\n\n                moveElement(e);\n\n                that._fireEvent(\"drag-start\", {\n                    position: position,\n                    context: o.dragContext\n                });\n\n                $(document).on(Metro.events.moveAll, function(e){\n                    e.preventDefault();\n                    moveElement(e);\n\n                    that._fireEvent(\"drag-move\", {\n                        position: position,\n                        context: o.dragContext\n                    });\n\n                }, {ns: that.id, passive: false});\n\n                $(document).on(Metro.events.stopAll, function(){\n                    // element.css({\n                    //     cursor: that.backup.cursor,\n                    //     zIndex: that.backup.zIndex\n                    // });\n                    element.removeClass(\"draggable\");\n\n                    if (that.drag) {\n                        $(document).off(Metro.events.moveAll, {ns: that.id});\n                        $(document).off(Metro.events.stopAll, {ns: that.id});\n                    }\n\n                    that.drag = false;\n                    that.move = false;\n\n                    that._fireEvent(\"drag-stop\", {\n                        position: position,\n                        context: o.dragContext\n                    });\n\n                }, {ns: that.id});\n            });\n        },\n\n        off: function(){\n            this.element.data(\"canDrag\", false);\n        },\n\n        on: function(){\n            this.element.data(\"canDrag\", true);\n        },\n\n        /* eslint-disable-next-line */\n        changeAttribute: function(attributeName, newValue){\n        },\n\n        destroy: function(){\n            var element = this.element;\n            this.dragElement.off(Metro.events.startAll);\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var DropdownDefaultConfig = {\n        dropdownDeferred: 0,\n        dropFilter: null,\n        toggleElement: null,\n        noClose: false,\n        duration: 50,\n        checkDropUp: false,\n        dropUp: false,\n        onDrop: Metro.noop,\n        onUp: Metro.noop,\n        onDropdownCreate: Metro.noop\n    };\n\n    Metro.dropdownSetup = function (options) {\n        DropdownDefaultConfig = $.extend({}, DropdownDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroDropdownSetup\"] !== undefined) {\n        Metro.dropdownSetup(window[\"metroDropdownSetup\"]);\n    }\n\n    Metro.Component('dropdown', {\n        init: function( options, elem ) {\n            this._super(elem, options, DropdownDefaultConfig, {\n                _toggle: null,\n                displayOrigin: null,\n                isOpen: false\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var that = this, element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"dropdown-create\", {\n                element: element\n            });\n\n            if (element.hasClass(\"open\")) {\n                element.removeClass(\"open\");\n                setTimeout(function(){\n                    that.open(true);\n                },0);\n            }\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var toggle;\n\n            if (o.dropUp) {\n                element.addClass(\"drop-up\");\n            }\n\n            toggle = o.toggleElement !== null ? $(o.toggleElement) : element.siblings('.dropdown-toggle').length > 0 ? element.siblings('.dropdown-toggle') : element.prev();\n\n            this.displayOrigin = Utils.getStyleOne(element, \"display\");\n\n            if (element.hasClass(\"v-menu\")) {\n                element.addClass(\"for-dropdown\");\n            }\n\n            element.css(\"display\", \"none\");\n\n            this._toggle = toggle;\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var toggle = this._toggle, parent = element.parent();\n\n            toggle.on(Metro.events.click, function(e){\n                parent.siblings(parent[0].tagName).removeClass(\"active-container\");\n                $(\".active-container\").removeClass(\"active-container\");\n\n                if (element.css('display') !== 'none' && !element.hasClass('keep-open')) {\n                    that._close(element);\n                } else {\n                    $('[data-role*=dropdown]').each(function(i, el){\n                        if (!element.parents('[data-role*=dropdown]').is(el) && !$(el).hasClass('keep-open') && $(el).css('display') !== 'none') {\n                            if (!Utils.isValue(o.dropFilter)) {\n                                that._close(el);\n                            } else {\n                                if ($(el).closest(o.dropFilter).length > 0) {\n                                    that._close(el);\n                                }\n                            }\n                        }\n                    });\n                    if (element.hasClass('horizontal')) {\n                        element.css({\n                            'visibility': 'hidden',\n                            'display': 'block'\n                        });\n                        var children_width = 0;\n                        $.each(element.children('li'), function(){\n                            children_width += $(this).outerWidth(true);\n                        });\n\n                        element.css({\n                            'visibility': 'visible',\n                            'display': 'none'\n                        });\n                        element.css('width', children_width);\n                    }\n                    that._open(element);\n                    parent.addClass(\"active-container\");\n                }\n                e.preventDefault();\n                e.stopPropagation();\n            });\n\n            if (o.noClose === true) {\n                element.addClass(\"keep-open\").on(Metro.events.click, function (e) {\n                    //e.preventDefault();\n                    e.stopPropagation();\n                });\n            }\n\n            $(element).find('li.disabled a').on(Metro.events.click, function(e){\n                e.preventDefault();\n            });\n        },\n\n        _close: function(el, immediate){\n            el = $(el);\n\n            var dropdown  = Metro.getPlugin(el, \"dropdown\");\n            var toggle = dropdown._toggle;\n            var options = dropdown.options;\n            var func = \"slideUp\";\n\n            toggle.removeClass('active-toggle').removeClass(\"active-control\");\n            dropdown.element.parent().removeClass(\"active-container\");\n\n            if (immediate) {\n                func = 'hide'\n            }\n\n            el[func](immediate ? 0 : options.duration, function(){\n                dropdown._fireEvent(\"close\");\n                dropdown._fireEvent(\"up\");\n\n                if (!options.dropUp && options.checkDropUp) {\n                    dropdown.element.removeClass(\"drop-up\");\n                }\n            });\n\n            this.isOpen = false;\n        },\n\n        // TODO Add control: if no space for drop-down and no space for drop-up, element will must drop-down\n        _open: function(el, immediate){\n            el = $(el);\n\n            var dropdown  = Metro.getPlugin(el, \"dropdown\");\n            var toggle = dropdown._toggle;\n            var options = dropdown.options;\n            var func = \"slideDown\";\n\n            toggle.addClass('active-toggle').addClass(\"active-control\");\n\n            el[func](immediate ? 0 : options.duration, function(){\n\n                if (!options.dropUp && options.checkDropUp) {\n                    // dropdown.element.removeClass(\"drop-up\");\n                    if (!Utils.inViewport(dropdown.element[0])) {\n                        dropdown.element.addClass(\"drop-up\");\n\n                        if (!Utils.inViewport(dropdown.element[0])) {\n                            dropdown.element.removeClass(\"drop-up\");\n                        }\n                    }\n                }\n\n                dropdown._fireEvent(\"open\");\n                dropdown._fireEvent(\"drop\");\n            });\n\n            // this._fireEvent(\"drop\");\n\n            this.isOpen = true;\n        },\n\n        close: function(immediate){\n            this._close(this.element, immediate);\n        },\n\n        open: function(immediate){\n            this._open(this.element, immediate);\n        },\n\n        toggle: function(){\n            if (this.isOpen)\n                this.close();\n            else\n                this.open();\n        },\n\n        /* eslint-disable-next-line */\n        changeAttribute: function(){\n        },\n\n        destroy: function(){\n            this._toggle.off(Metro.events.click);\n        }\n    });\n\n    $(document).on(Metro.events.click, function(){\n        $('[data-role*=dropdown]').each(function(){\n            var el = $(this);\n\n            if (el.css('display')!=='none' && !el.hasClass('keep-open') && !el.hasClass('stay-open') && !el.hasClass('ignore-document-click')) {\n                Metro.getPlugin(el, 'dropdown').close();\n            }\n        });\n    });\n}(Metro, m4q));\r\n\r\n(function (Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var Export = {\n\n        init: function () {\n            return this;\n        },\n\n        options: {\n            csvDelimiter: \"\\t\",\n            csvNewLine: \"\\r\\n\",\n            includeHeader: true\n        },\n\n        setup: function (options) {\n            this.options = $.extend({}, this.options, options);\n            return this;\n        },\n\n        base64: function (data) {\n            return window.btoa(unescape(encodeURIComponent(data)));\n        },\n\n        b64toBlob: function (b64Data, contentType, sliceSize) {\n            contentType = contentType || '';\n            sliceSize = sliceSize || 512;\n\n            var byteCharacters = window.atob(b64Data);\n            var byteArrays = [];\n\n            var offset;\n            for (offset = 0; offset < byteCharacters.length; offset += sliceSize) {\n                var slice = byteCharacters.slice(offset, offset + sliceSize);\n\n                var byteNumbers = new Array(slice.length);\n                var i;\n                for (i = 0; i < slice.length; i = i + 1) {\n                    byteNumbers[i] = slice.charCodeAt(i);\n                }\n\n                var byteArray = new window.Uint8Array(byteNumbers);\n\n                byteArrays.push(byteArray);\n            }\n\n            return new Blob(byteArrays, {\n                type: contentType\n            });\n        },\n\n        tableToCSV: function (table, filename, options) {\n            var o;\n            var body, head, data = \"\";\n            var i, j, row, cell;\n\n            o = $.extend({}, this.options, options);\n\n            table = $(table)[0];\n\n            if (Utils.bool(o.includeHeader)) {\n\n                head = table.querySelectorAll(\"thead\")[0];\n\n                for (i = 0; i < head.rows.length; i++) {\n                    row = head.rows[i];\n                    for (j = 0; j < row.cells.length; j++) {\n                        cell = row.cells[j];\n                        data += (j ? o.csvDelimiter : '') + cell.textContent.trim();\n                    }\n                    data += o.csvNewLine;\n                }\n            }\n\n            body = table.querySelectorAll(\"tbody\")[0];\n\n            for (i = 0; i < body.rows.length; i++) {\n                row = body.rows[i];\n                for (j = 0; j < row.cells.length; j++) {\n                    cell = row.cells[j];\n                    data += (j ? o.csvDelimiter : '') + cell.textContent.trim();\n                }\n                data += o.csvNewLine;\n            }\n\n            if (Utils.isValue(filename)) {\n                return this.createDownload(this.base64(\"\\uFEFF\" + data), 'application/csv', filename);\n            }\n\n            return data;\n        },\n\n        createDownload: function (data, contentType, filename) {\n            var blob, anchor, url;\n\n            anchor = document.createElement('a');\n            anchor.style.display = \"none\";\n            document.body.appendChild(anchor);\n\n            blob = this.b64toBlob(data, contentType);\n\n            url = window.URL.createObjectURL(blob);\n            anchor.href = url;\n            anchor.download = filename || Utils.elementId(\"download\");\n            anchor.click();\n            window.URL.revokeObjectURL(url);\n            document.body.removeChild(anchor);\n            return true;\n        },\n\n        arrayToCsv: function(array, filename, options){\n            var o, data = \"\", i, row;\n\n            o = $.extend({}, this.options, options);\n\n            for (i = 0; i < array.length; i++) {\n                row = array[i];\n\n                if (typeof row !== \"object\") {\n                    data += row + o.csvNewLine;\n                } else {\n                    $.each(row, function(key, val){\n                        data += (key ? o.csvDelimiter : '') + val.toString();\n                    });\n                    data += o.csvNewLine;\n                }\n            }\n\n            if (Utils.isValue(filename)) {\n                return this.createDownload(this.base64(\"\\uFEFF\" + data), 'application/csv', filename);\n            }\n\n            return data;\n        }\n    };\n\n    Metro.export = Export.init();\n\n    if (window.METRO_GLOBAL_COMMON === true) {\n        window.Export = Metro.export;\n    }\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var FileDefaultConfig = {\n        fileDeferred: 0,\n        label: \"\",\n        mode: \"input\",\n        buttonTitle: \"Choose file(s)\",\n        filesTitle: \"file(s) selected\",\n        dropTitle: \"<strong>Choose a file(s)</strong> or drop it here\",\n        dropIcon: \"<span class='default-icon-upload'></span>\",\n        prepend: \"\",\n        clsComponent: \"\",\n        clsPrepend: \"\",\n        clsButton: \"\",\n        clsCaption: \"\",\n        clsLabel: \"\",\n        copyInlineStyles: false,\n        onSelect: Metro.noop,\n        onFileCreate: Metro.noop\n    };\n\n    Metro.fileSetup = function (options) {\n        FileDefaultConfig = $.extend({}, FileDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroFileSetup\"] !== undefined) {\n        Metro.fileSetup(window[\"metroFileSetup\"]);\n    }\n\n    Metro.Component('file', {\n        init: function( options, elem ) {\n            this._super(elem, options, FileDefaultConfig);\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"file-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var container = $(\"<label>\").addClass((o.mode === \"input\" ? \" file \" : o.mode === \"button\" ? \" file-button \" : \" drop-zone \") + element[0].className).addClass(o.clsComponent);\n            var caption = $(\"<span>\").addClass(\"caption\").addClass(o.clsCaption);\n            var files = $(\"<span>\").addClass(\"files\").addClass(o.clsCaption);\n            var icon, button;\n\n\n            container.insertBefore(element);\n            element.appendTo(container);\n\n            if (o.mode === 'drop' || o.mode === 'dropzone') {\n                icon = $(o.dropIcon).addClass(\"icon\").appendTo(container);\n                caption.html(o.dropTitle).insertAfter(icon);\n                files.html(\"0\" + \" \" + o.filesTitle).insertAfter(caption);\n            } else if (o.mode === 'button') {\n\n                button = $(\"<span>\").addClass(\"button\").attr(\"tabindex\", -1).html(o.buttonTitle);\n                button.appendTo(container);\n                button.addClass(o.clsButton);\n\n            } else {\n                caption.insertBefore(element);\n\n                button = $(\"<span>\").addClass(\"button\").attr(\"tabindex\", -1).html(o.buttonTitle);\n                button.appendTo(container);\n                button.addClass(o.clsButton);\n\n                if (element.attr('dir') === 'rtl' ) {\n                    container.addClass(\"rtl\");\n                }\n\n                if (o.prepend !== \"\") {\n                    var prepend = $(\"<div>\").html(o.prepend);\n                    prepend.addClass(\"prepend\").addClass(o.clsPrepend).appendTo(container);\n                }\n            }\n\n            element[0].className = '';\n\n            if (o.copyInlineStyles === true) {\n                for (var i = 0, l = element[0].style.length; i < l; i++) {\n                    container.css(element[0].style[i], element.css(element[0].style[i]));\n                }\n            }\n\n            if (o.label) {\n                var label = $(\"<label>\").addClass(\"label-for-input\").addClass(o.clsLabel).html(o.label).insertBefore(container);\n                if (element.attr(\"id\")) {\n                    label.attr(\"for\", element.attr(\"id\"));\n                }\n                if (element.attr(\"dir\") === \"rtl\") {\n                    label.addClass(\"rtl\");\n                }\n            }\n\n            if (element.is(\":disabled\")) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var container = element.closest(\"label\");\n            var caption = container.find(\".caption\");\n            var files = container.find(\".files\");\n            var form = element.closest(\"form\");\n\n            if (form.length) {\n                form.on(\"reset\", function(){\n                    that.clear();\n                })\n            }\n\n            container.on(Metro.events.click, \"button\", function(){\n                element[0].click();\n            });\n\n            element.on(Metro.events.change, function(){\n                var fi = this;\n                var file_names = [];\n                var entry;\n\n                // if (fi.files.length === 0) {\n                //     return ;\n                // }\n\n                Array.from(fi.files).forEach(function(file){\n                    file_names.push(file.name);\n                });\n\n                if (o.mode === \"input\") {\n\n                    entry = file_names.join(\", \");\n\n                    caption.html(entry);\n                    caption.attr('title', entry);\n                } else {\n                    files.html(element[0].files.length + \" \" +o.filesTitle);\n                }\n\n                that._fireEvent(\"select\", {\n                    files: fi.files\n                });\n            });\n\n            element.on(Metro.events.focus, function(){container.addClass(\"focused\");});\n            element.on(Metro.events.blur, function(){container.removeClass(\"focused\");});\n\n            if (o.mode !== \"input\") {\n                container.on('drag dragstart dragend dragover dragenter dragleave drop', function(e){\n                    e.preventDefault();\n                });\n\n                container.on('dragenter dragover', function(){\n                    container.addClass(\"drop-on\");\n                });\n\n                container.on('dragleave', function(){\n                    container.removeClass(\"drop-on\");\n                });\n\n                container.on('drop', function(e){\n                    element[0].files = e.dataTransfer.files;\n                    files.html(element[0].files.length + \" \" +o.filesTitle);\n                    container.removeClass(\"drop-on\");\n                    element.trigger(\"change\");\n                });\n            }\n        },\n\n        clear: function(){\n            var element = this.element, o = this.options;\n            if (o.mode === \"input\") {\n                element.siblings(\".caption\").html(\"\");\n            } else {\n                element.siblings(\".caption\").html(o.dropTitle);\n                element.siblings(\".files\").html(\"0\" + \" \" + o.filesTitle);\n            }\n\n            element.val(\"\");\n        },\n\n        disable: function(){\n            this.element.data(\"disabled\", true);\n            this.element.parent().addClass(\"disabled\");\n        },\n\n        enable: function(){\n            this.element.data(\"disabled\", false);\n            this.element.parent().removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        toggleDir: function(){\n            if (this.element.attr(\"dir\") === 'rtl') {\n                this.element.parent().addClass(\"rtl\");\n            } else {\n                this.element.parent().removeClass(\"rtl\");\n            }\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case 'disabled': this.toggleState(); break;\n                case 'dir': this.toggleDir(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n            var parent = element.parent();\n            element.off(Metro.events.change);\n            parent.off(Metro.events.click, \"button\");\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var Utils = Metro.utils;\n    var GradientBoxDefaultConfig = {\n        gradientType: \"linear\", // linear, radial\n        gradientShape: \"\",\n        gradientPosition: \"\",\n        gradientSize: \"\",\n        gradientColors: \"#000, #fff\",\n        gradientRepeat: false,\n        onGradientBoxCreate: Metro.noop\n    };\n\n    Metro.gradientBoxSetup = function (options) {\n        GradientBoxDefaultConfig = $.extend({}, GradientBoxDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroGradientBoxSetup\"] !== undefined) {\n        Metro.gradientBoxSetup(window[\"metroGradientBoxSetup\"]);\n    }\n\n    Metro.Component('gradient-box', {\n        init: function( options, elem ) {\n            this._super(elem, options, GradientBoxDefaultConfig, {\n                // define instance vars here\n                colors: [],\n                shape: \"\",\n                size: \"\",\n                position: \"\",\n                type: \"linear\",\n                func: \"linear-gradient\",\n                repeat: false\n            });\n            return this;\n        },\n\n        _create: function(){\n            var o = this.options;\n\n            this.colors = o.gradientColors.toArray(\",\");\n            this.type = o.gradientType.toLowerCase();\n            this.shape = o.gradientShape.toLowerCase();\n            this.size = o.gradientSize.toLowerCase();\n            this.repeat = o.gradientRepeat;\n            this.func = (this.repeat ? \"repeating-\" : \"\") + this.type + \"-gradient\";\n\n\n            if (this.type === \"linear\") {\n                if ( !o.gradientPosition ) {\n                    this.position = \"to bottom\";\n                } else {\n                    this.position = isNaN(o.gradientPosition) === false ? o.gradientPosition + \"deg\" : o.gradientPosition;\n\n                    if (this.position.indexOf(\"deg\") === -1 && this.position.indexOf(\"to \") === -1) {\n                        this.position = \"to \" + this.position;\n                    }\n                }\n            } else {\n                this.position = o.gradientPosition.toLowerCase();\n                if (this.position && this.position.indexOf(\"at \") === -1) {\n                    this.position = \"at \" + this.position;\n                }\n            }\n\n            this._createStructure();\n            this._setGradient();\n            this._fireEvent('gradient-box-create');\n        },\n\n        _createStructure: function(){\n            this.element.addClass(\"gradient-box\");\n        },\n\n        _setGradient: function (){\n            var element = this.element;\n            var gradientRule, gradientOptions = [];\n\n            if (this.type === \"radial\" && this.shape) {\n                gradientOptions.push(this.shape);\n            }\n\n            if (this.type === \"radial\" && this.size) {\n                gradientOptions.push(this.size);\n            }\n\n            if (this.position) {\n                gradientOptions.push((this.position.indexOf(\"at\") === -1 ? \"at \" : \"\") + this.position);\n            }\n\n            gradientRule = this.func + \"(\" + (gradientOptions.length ? gradientOptions.join(\" \") + \", \" : \"\") + this.colors.join(\", \") + \")\";\n\n            element.css({\n                background: gradientRule\n            });\n        },\n\n        changeAttribute: function(attr, newValue){\n            if (attr.indexOf(\"data-gradient-\") === -1) {\n                return ;\n            }\n\n            switch (attr) {\n                case \"data-gradient-type\": this.type = newValue; this.func = newValue.toLowerCase() + \"-gradient\"; break;\n                case \"data-gradient-colors\": this.colors = newValue ? newValue.toArray(\",\") : [\"#fff\", \"#000\"]; break;\n                case \"data-gradient-shape\": this.shape = newValue.toLowerCase(); break;\n                case \"data-gradient-size\": this.size = newValue.toLowerCase(); break;\n                case \"data-gradient-position\": this.position = newValue.toLowerCase(); break;\n                case \"data-gradient-repeat\": this.repeat = Utils.bool(newValue); break;\n            }\n\n            this._setGradient();\n        },\n\n        destroy: function(){\n            return this.element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var GravatarDefaultConfig = {\n        gravatarDeferred: 0,\n        email: \"\",\n        size: 80,\n        default: \"mp\",\n        onGravatarCreate: Metro.noop\n    };\n\n    Metro.gravatarSetup = function (options) {\n        GravatarDefaultConfig = $.extend({}, GravatarDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroGravatarSetup\"] !== undefined) {\n        Metro.gravatarSetup(window[\"metroGravatarSetup\"]);\n    }\n\n    Metro.Component('gravatar', {\n        init: function( options, elem ) {\n            this._super(elem, options, GravatarDefaultConfig);\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this.get();\n\n            this._fireEvent(\"gravatar-create\", {\n                element: element\n            });\n        },\n\n        getImage: function(email, size, def, is_object){\n            var image = $(\"<img>\").attr('alt', email);\n\n            image.attr(\"src\", this.getImageSrc(email, size));\n\n            return is_object === true ? image : image[0];\n        },\n\n        getImageSrc: function(email, size, def){\n            if (email === undefined || email.trim() === '') {\n                return \"\";\n            }\n\n            size = size || 80;\n            def = Metro.utils.encodeURI(def) || '404';\n\n            return \"//www.gravatar.com/avatar/\" + Metro.md5((email.toLowerCase()).trim()) + '?size=' + size + '&d=' + def;\n        },\n\n        get: function(){\n            var element = this.element, o = this.options;\n            var img = element[0].tagName === 'IMG' ? element : element.find(\"img\");\n\n            if (img.length === 0) {\n                return;\n            }\n            img.attr(\"src\", this.getImageSrc(o.email, o.size, o.default));\n\n            return this;\n        },\n\n        resize: function(new_size){\n            this.options.size = new_size !== undefined ? new_size : this.element.attr(\"data-size\");\n            this.get();\n        },\n\n        email: function(new_email){\n            this.options.email = new_email !== undefined ? new_email : this.element.attr(\"data-email\");\n            this.get();\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case 'data-size': this.resize(); break;\n                case 'data-email': this.email(); break;\n            }\n        },\n\n        destroy: function(){\n            return this.element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var HintDefaultConfig = {\n        hintDeferred: 0,\n        hintHide: 5000,\n        clsHint: \"\",\n        hintText: \"\",\n        hintPosition: Metro.position.TOP,\n        hintOffset: 4,\n        onHintShow: Metro.noop,\n        onHintHide: Metro.noop,\n        onHintCreate: Metro.noop\n    };\n\n    Metro.hintSetup = function (options) {\n        HintDefaultConfig = $.extend({}, HintDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroHintSetup\"] !== undefined) {\n        Metro.hintSetup(window[\"metroHintSetup\"]);\n    }\n\n    Metro.Component('hint', {\n        init: function( options, elem ) {\n            this._super(elem, options, HintDefaultConfig, {\n                hint: null,\n                hint_size: {\n                    width: 0,\n                    height: 0\n                },\n                id: Utils.elementId(\"hint\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            this._createEvents();\n            this._fireEvent(\"hint-create\", {\n                element: this.element\n            });\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var over = false;\n\n            element.on(Metro.events.enter, function(){\n                over = true;\n                setTimeout(function(){\n                    if (!over) return;\n\n                    that.createHint();\n                    if (+o.hintHide > 0) {\n                        setTimeout(function(){\n                            that.removeHint();\n                        }, o.hintHide);\n                    }\n                }, o.hintDeferred);\n            });\n\n            element.on(Metro.events.leave, function(){\n                over = false;\n                that.removeHint();\n            });\n\n            $(window).on(Metro.events.scroll+\" \"+Metro.events.resize, function(){\n                if (that.hint !== null) that.setPosition();\n            }, {ns: this.id});\n        },\n\n        createHint: function(){\n            var elem = this.elem, element = this.element, o = this.options;\n            var hint = $(\"<div>\").addClass(\"hint\").addClass(o.clsHint).html(o.hintText);\n\n            this.hint = hint;\n            this.hint_size = Utils.hiddenElementSize(hint);\n\n            $(\".hint:not(.permanent-hint)\").remove();\n\n            if (elem.tagName === 'TD' || elem.tagName === 'TH') {\n                var wrp = $(\"<div/>\").css(\"display\", \"inline-block\").html(element.html());\n                element.html(wrp);\n                this.element = wrp;\n            }\n\n            this.setPosition();\n\n            hint.appendTo($('body'));\n\n            this._fireEvent(\"hint-show\", {\n                hint: hint[0]\n            })\n        },\n\n        setPosition: function(){\n            var hint = this.hint, hint_size = this.hint_size, o = this.options, element = this.element;\n\n            if (o.hintPosition === Metro.position.BOTTOM) {\n                hint.addClass('bottom');\n                hint.css({\n                    top: element.offset().top - $(window).scrollTop() + element.outerHeight() + o.hintOffset,\n                    left: element.offset().left + element.outerWidth()/2 - hint_size.width/2  - $(window).scrollLeft()\n                });\n            } else if (o.hintPosition === Metro.position.RIGHT) {\n                hint.addClass('right');\n                hint.css({\n                    top: element.offset().top + element.outerHeight()/2 - hint_size.height/2 - $(window).scrollTop(),\n                    left: element.offset().left + element.outerWidth() - $(window).scrollLeft() + o.hintOffset\n                });\n            } else if (o.hintPosition === Metro.position.LEFT) {\n                hint.addClass('left');\n                hint.css({\n                    top: element.offset().top + element.outerHeight()/2 - hint_size.height/2 - $(window).scrollTop(),\n                    left: element.offset().left - hint_size.width - $(window).scrollLeft() - o.hintOffset\n                });\n            } else {\n                hint.addClass('top');\n                hint.css({\n                    top: element.offset().top - $(window).scrollTop() - hint_size.height - o.hintOffset,\n                    left: element.offset().left - $(window).scrollLeft() + element.outerWidth()/2 - hint_size.width/2\n                });\n            }\n        },\n\n        removeHint: function(){\n            var that = this;\n            var hint = this.hint;\n            var options = this.options;\n            var timeout = options.onHintHide === Metro.noop ? 0 : 300;\n\n            if (hint !== null) {\n\n                this._fireEvent(\"hint-hide\", {\n                    hint: hint[0]\n                });\n\n                setTimeout(function(){\n                    hint.hide(0, function(){\n                        hint.remove();\n                        that.hint = null;\n                    });\n                }, timeout);\n            }\n        },\n\n        changeText: function(){\n            this.options.hintText = this.element.attr(\"data-hint-text\");\n        },\n\n        changeAttribute: function(attributeName){\n            if (attributeName === \"data-hint-text\") {\n                this.changeText();\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n            this.removeHint();\n            element.off(Metro.events.enter + \"-hint\");\n            element.off(Metro.events.leave + \"-hint\");\n            $(window).off(Metro.events.scroll + \"-hint\");\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var Hotkey = {\n        specialKeys: {\n            8: \"backspace\", 9: \"tab\", 13: \"return\", 16: \"shift\", 17: \"ctrl\", 18: \"alt\", 19: \"pause\",\n            20: \"capslock\", 27: \"esc\", 32: \"space\", 33: \"pageup\", 34: \"pagedown\", 35: \"end\", 36: \"home\",\n            37: \"left\", 38: \"up\", 39: \"right\", 40: \"down\", 45: \"insert\", 46: \"del\",\n            96: \"0\", 97: \"1\", 98: \"2\", 99: \"3\", 100: \"4\", 101: \"5\", 102: \"6\", 103: \"7\",\n            104: \"8\", 105: \"9\", 106: \"*\", 107: \"+\", 109: \"-\", 110: \".\", 111 : \"/\",\n            112: \"f1\", 113: \"f2\", 114: \"f3\", 115: \"f4\", 116: \"f5\", 117: \"f6\", 118: \"f7\", 119: \"f8\",\n            120: \"f9\", 121: \"f10\", 122: \"f11\", 123: \"f12\", 144: \"numlock\", 145: \"scroll\", 188: \",\", 190: \".\",\n            191: \"/\", 224: \"meta\" },\n\n        shiftNums: {\n            \"~\":\"`\", \"!\":\"1\", \"@\":\"2\", \"#\":\"3\", \"$\":\"4\", \"%\":\"5\", \"^\":\"6\", \"&\":\"7\",\n            \"*\":\"8\", \"(\":\"9\", \")\":\"0\", \"_\":\"-\", \"+\":\"=\", \":\":\";\", \"\\\"\":\"'\", \"<\":\",\",\n            \">\":\".\",  \"?\":\"/\",   \"|\":\"\\\\\"\n        },\n\n        shiftNumsInverse: {\n            \"`\": \"~\", \"1\": \"!\", \"2\": \"@\", \"3\": \"#\", \"4\": \"$\", \"5\": \"%\", \"6\": \"^\", \"7\": \"&\",\n            \"8\": \"*\", \"9\": \"(\", \"0\": \")\", \"-\": \"_\", \"=\": \"+\", \";\": \": \", \"'\": \"\\\"\", \",\": \"<\",\n            \".\": \">\",  \"/\": \"?\",  \"\\\\\": \"|\"\n        },\n\n        textAcceptingInputTypes: [\n            \"text\", \"password\", \"number\", \"email\", \"url\", \"range\", \"date\", \"month\", \"week\", \"time\", \"datetime\",\n            \"datetime-local\", \"search\", \"color\", \"tel\"\n        ],\n\n        getKey: function(e){\n            var key, k = e.keyCode, char = String.fromCharCode( k ).toLowerCase();\n            if( e.shiftKey ){\n                key = Hotkey.shiftNums[ char ] ? Hotkey.shiftNums[ char ] : char;\n            }\n            else {\n                key = Hotkey.specialKeys[ k ] === undefined\n                    ? char\n                    : Hotkey.specialKeys[ k ];\n            }\n\n            return Hotkey.getModifier(e).length ? Hotkey.getModifier(e).join(\"+\") + \"+\" + key : key;\n        },\n\n        getModifier: function(e){\n            var m = [];\n            if (e.altKey) {m.push(\"alt\");}\n            if (e.ctrlKey) {m.push(\"ctrl\");}\n            if (e.shiftKey) {m.push(\"shift\");}\n            return m;\n        }\n    };\n\n    function bindKey(key, fn){\n        return this.each(function(){\n            $(this).on(Metro.events.keyup+\".hotkey-method-\"+key, function(e){\n                var _key = Hotkey.getKey(e);\n                var el = $(this);\n                var href = \"\"+el.attr(\"href\");\n\n                if (key !== _key) {\n                    return;\n                }\n\n                if (el.is(\"a\")) {\n                    if (href && href.trim() !== \"#\") {\n                        window.location.href = href;\n                    }\n                }\n\n                Utils.exec(fn, [e, _key, key], this);\n            })\n        })\n    }\n\n    $.fn.hotkey = bindKey;\n\n    if (window.METRO_JQUERY && window.jquery_present) {\n        jQuery.fn.hotkey = bindKey;\n    }\n\n    // TODO keyup or keydown ?\n    $(document).on(Metro.events.keyup + \".hotkey-data\", function(e){\n        var el, fn, key, href;\n\n        if (\n            (METRO_HOTKEYS_FILTER_INPUT_ACCEPTING_ELEMENTS && /textarea|input|select/i.test(e.target.nodeName)) ||\n            (METRO_HOTKEYS_FILTER_CONTENT_EDITABLE && $(e.target).attr('contenteditable')) ||\n            (METRO_HOTKEYS_FILTER_TEXT_INPUTS && Hotkey.textAcceptingInputTypes.indexOf(e.target.type) > -1)\n        )\n        {\n            return;\n        }\n\n        key = Hotkey.getKey(e);\n\n        if (Utils.keyInObject(Metro.hotkeys, key)) {\n            el = $(Metro.hotkeys[key][0]);\n            fn = Metro.hotkeys[key][1];\n            href = (\"\"+el.attr(\"href\")).trim();\n\n            if (fn) {\n                Utils.exec(fn);\n            } else {\n                if (el.is(\"a\") && href && href.length > 0 && href.trim() !== \"#\") {\n                    window.location.href = href;\n                } else {\n                    el.click();\n                }\n            }\n        }\n    });\n\n    // TODO add destroy\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var HtmlContainerDefaultConfig = {\n        htmlcontainerDeferred: 0,\n        method: \"get\",\n        htmlSource: null,\n        requestData: null,\n        requestOptions: null,\n        insertMode: \"default\", // replace, append, prepend\n        onHtmlLoad: Metro.noop,\n        onHtmlLoadFail: Metro.noop,\n        onHtmlLoadDone: Metro.noop,\n        onHtmlContainerCreate: Metro.noop\n    };\n\n    Metro.htmlContainerSetup = function (options) {\n        HtmlContainerDefaultConfig = $.extend({}, HtmlContainerDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroHtmlContainerSetup\"] !== undefined) {\n        Metro.htmlContainerSetup(window[\"metroHtmlContainerSetup\"]);\n    }\n\n    Metro.Component('html-container', {\n        init: function( options, elem ) {\n            this._super(elem, options, HtmlContainerDefaultConfig, {\n                data: null,\n                opt: {},\n                htmlSource: ''\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n\n            if (typeof o.requestData === 'string') {\n                o.requestData = JSON.parse(o.requestData);\n            }\n\n            if (Utils.isObject(o.requestData)) {\n                this.data = Utils.isObject(o.requestData);\n            }\n\n            if (typeof o.requestOptions === 'string') {\n                o.requestOptions = JSON.parse(o.requestOptions);\n            }\n\n            if (Utils.isObject(o.requestOptions)) {\n                this.opt = Utils.isObject(o.requestOptions);\n            }\n\n            o.method = o.method.toUpperCase();\n\n            if (Utils.isValue(o.htmlSource)) {\n                this.htmlSource = o.htmlSource;\n                this._load();\n            }\n\n            this._fireEvent(\"html-container-create\", {\n                element: element\n            });\n        },\n\n        _load: function(){\n            var that = this, element = this.element, o = this.options;\n            var fetchData = {\n                method: o.method\n            };\n\n            if (this.data) fetchData['body'] = this.data;\n            if (this.opt) fetchData['headers'] = this.opt;\n\n            fetch(this.htmlSource, fetchData)\n            .then(Metro.fetch.status)\n            .then(Metro.fetch.text)\n            .then(function(data){\n                var _data = $(data);\n\n                if (_data.length === 0) {\n                    _data = $(\"<div>\").html(data);\n                }\n\n                switch (o.insertMode.toLowerCase()) {\n                    case \"prepend\": element.prepend(_data); break;\n                    case \"append\": element.append(_data); break;\n                    case \"replace\": _data.insertBefore(element).script(); element.remove(); break;\n                    default: {\n                        element.html(_data);\n                    }\n                }\n                that._fireEvent(\"html-load\", {\n                    data: data,\n                    source: o.htmlSource,\n                    requestData: that.data,\n                    requestOptions: that.opt\n                });\n            })\n            .catch(function(error){\n                that._fireEvent(\"html-load-fail\", {\n                    error: error\n                });\n            });\n        },\n\n        load: function(source, data, opt){\n            if (source) {\n                this.htmlSource = source;\n            }\n\n            if (data) {\n                this.data = Utils.isObject(data);\n            }\n\n            if (opt) {\n                this.opt = Utils.isObject(opt);\n            }\n\n            this._load();\n        },\n\n        changeAttribute: function(attributeName){\n            var that = this, element = this.element, o = this.options;\n\n            var changeHTMLSource = function(){\n                var html = element.attr(\"data-html-source\");\n                if (Utils.isNull(html)) {\n                    return ;\n                }\n                if (html.trim() === \"\") {\n                    element.html(\"\");\n                }\n                o.htmlSource = html;\n                that._load();\n            };\n\n            var changeInsertMode = function(){\n                var attr = element.attr(\"data-insert-mode\");\n                if (Utils.isValue(attr)) {\n                    o.insertMode = attr;\n                }\n            };\n\n            var changeRequestData = function(){\n                var data = element.attr(\"data-request-data\");\n                that.load(o.htmlSource, data);\n            };\n\n            switch (attributeName) {\n                case \"data-html-source\": changeHTMLSource(); break;\n                case \"data-insert-mode\": changeInsertMode(); break;\n                case \"data-request-data\": changeRequestData(); break;\n            }\n        },\n\n        destroy: function(){}\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var ImageBoxDefaultConfig = {\n        image: null,\n        size: \"cover\",\n        repeat: false,\n        color: \"transparent\",\n        attachment: \"scroll\",\n        origin: \"border\",\n        onImageBoxCreate: Metro.noop\n    };\n\n    Metro.imageBoxSetup = function (options) {\n        ImageBoxDefaultConfig = $.extend({}, ImageBoxDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroImageBoxSetup\"] !== undefined) {\n        Metro.imageBoxSetup(window[\"metroImageBoxSetup\"]);\n    }\n\n    Metro.Component('image-box', {\n        init: function( options, elem ) {\n            this._super(elem, options, ImageBoxDefaultConfig, {\n                // define instance vars here\n            });\n            return this;\n        },\n\n        _create: function(){\n            this._createStructure();\n\n            this._fireEvent('image-box-create');\n        },\n\n        _createStructure: function(){\n            var element = this.element;\n\n            element.addClass(\"image-box\");\n\n            this._drawImage();\n        },\n\n        _drawImage: function(){\n            var element = this.element, o = this.options;\n            var image = new Image();\n            var portrait;\n\n            if (!element.attr(\"data-original\"))\n                element.attr(\"data-original\", o.image);\n\n            element.css({\n                backgroundImage: \"url(\"+o.image+\")\",\n                backgroundSize: o.size,\n                backgroundRepeat: o.repeat ? \"repeat\" : \"no-repeat\",\n                backgroundColor: o.color,\n                backgroundAttachment: o.attachment,\n                backgroundOrigin: o.origin\n            });\n\n            image.src = o.image;\n            image.onload = function(){\n                portrait = this.height >= this.width;\n                element\n                    .removeClass(\"image-box__portrait image-box__landscape\")\n                    .addClass(\"image-box__\" + (portrait ? \"portrait\" : \"landscape\"));\n            }\n        },\n\n        changeAttribute: function(attr, newValue){\n            var attrName = attr.replace(\"data-\", \"\");\n\n            if ([\"image\", \"size\", \"repeat\", \"color\", \"attachment\", \"origin\"].indexOf(attrName) > -1) {\n                this.options[attrName] = newValue;\n                this._drawImage();\n            }\n        },\n\n        destroy: function(){\n            return this.element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var ImageCompareDefaultConfig = {\n        imagecompareDeferred: 0,\n        width: \"100%\",\n        height: \"auto\",\n        onSliderMove: Metro.noop,\n        onImageCompareCreate: Metro.noop\n    };\n\n    Metro.imageCompareSetup = function (options) {\n        ImageCompareDefaultConfig = $.extend({}, ImageCompareDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroImageCompareSetup\"] !== undefined) {\n        Metro.imageCompareSetup(window[\"metroImageCompareSetup\"]);\n    }\n\n    Metro.Component('image-compare', {\n        init: function( options, elem ) {\n            this._super(elem, options, ImageCompareDefaultConfig, {\n                id: Utils.elementId(\"image-compare\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"image-compare-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var container, container_overlay, slider;\n            var images, element_width, element_height;\n\n            if (!Utils.isValue(element.attr(\"id\"))) {\n                element.attr(\"id\", Utils.elementId(\"image-compare\"));\n            }\n\n            element.addClass(\"image-compare\").css({\n                width: o.width\n            });\n\n            element_width = element.width();\n\n            switch (o.height) {\n                case \"16/9\": element_height = Utils.aspectRatioH(element_width, o.height); break;\n                case \"21/9\": element_height = Utils.aspectRatioH(element_width, o.height); break;\n                case \"4/3\": element_height = Utils.aspectRatioH(element_width, o.height); break;\n                case \"auto\": element_height = Utils.aspectRatioH(element_width, \"16/9\"); break;\n                default: element_height = o.height;\n            }\n\n            element.css({\n                height: element_height\n            });\n\n            container = $(\"<div>\").addClass(\"image-container\").appendTo(element);\n            container_overlay = $(\"<div>\").addClass(\"image-container-overlay\").appendTo(element).css({\n                width: element_width / 2\n            });\n\n            slider = $(\"<div>\").addClass(\"image-slider\").appendTo(element);\n            slider.css({\n                top: element_height / 2 - slider.height() / 2,\n                left: element_width / 2 - slider.width() / 2\n            });\n\n            images = element.find(\"img\");\n\n            $.each(images, function(i){\n                var img = $(\"<div>\").addClass(\"image-wrapper\");\n                img.css({\n                    width: element_width,\n                    height: element_height,\n                    backgroundImage: \"url(\"+this.src+\")\"\n                });\n                img.appendTo(i === 0 ? container : container_overlay);\n            });\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n\n            var overlay = element.find(\".image-container-overlay\");\n            var slider = element.find(\".image-slider\");\n\n            slider.on(Metro.events.startAll, function(){\n                var w = element.width();\n                $(document).on(Metro.events.moveAll, function(e){\n                    var x = Utils.getCursorPositionX(element[0], e), left_pos;\n                    if (x < 0) x = 0;\n                    if (x > w) x = w;\n                    overlay.css({\n                        width: x\n                    });\n                    left_pos = x - slider.width() / 2;\n                    slider.css({\n                        left: left_pos\n                    });\n\n                    that._fireEvent(\"slider-move\", {\n                        x: x,\n                        l: left_pos\n                    });\n                }, {ns: that.id});\n\n                $(document).on(Metro.events.stopAll, function(){\n                    $(document).off(Metro.events.moveAll, {ns: that.id});\n                    $(document).off(Metro.events.stopAll, {ns: that.id});\n                }, {ns: that.id})\n            });\n\n            $(window).on(Metro.events.resize, function(){\n                var element_width = element.width(), element_height;\n\n                if (o.width !== \"100%\") {\n                    return ;\n                }\n\n                switch (o.height) {\n                    case \"16/9\": element_height = Utils.aspectRatioH(element_width, o.height); break;\n                    case \"21/9\": element_height = Utils.aspectRatioH(element_width, o.height); break;\n                    case \"4/3\": element_height = Utils.aspectRatioH(element_width, o.height); break;\n                    case \"auto\": element_height = Utils.aspectRatioH(element_width, \"16/9\"); break;\n                    default: element_height = o.height;\n                }\n\n                element.css({\n                    height: element_height\n                });\n\n                $.each(element.find(\".image-wrapper\"), function(){\n                    $(this).css({\n                        width: element_width,\n                        height: element_height\n                    })\n                });\n\n                element.find(\".image-container-overlay\").css({\n                    width: element_width / 2\n                });\n\n                slider.css({\n                    top: element_height / 2 - slider.height() / 2,\n                    left: element_width / 2 - slider.width() / 2\n                });\n\n            }, {ns: this.id});\n        },\n\n        /* eslint-disable-next-line */\n        changeAttribute: function(attributeName){\n        },\n\n        destroy: function(){\n            var element = this.element;\n\n            element.off(Metro.events.start);\n            $(window).off(Metro.events.resize, {ns: this.id});\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var Utils = Metro.utils;\n    var ImageGridDefaultConfig = {\n        useBackground: false,\n        backgroundSize: \"cover\",\n        backgroundPosition: \"top left\",\n\n        clsImageGrid: \"\",\n        clsImageGridItem: \"\",\n        clsImageGridImage: \"\",\n\n        onItemClick: Metro.noop,\n        onDrawItem: Metro.noop,\n        onImageGridCreate: Metro.noop\n    };\n\n    Metro.imageGridSetup = function (options) {\n        ImageGridDefaultConfig = $.extend({}, ImageGridDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroImageGridSetup\"] !== undefined) {\n        Metro.imageGridSetup(window[\"metroImageGridSetup\"]);\n    }\n\n    Metro.Component('image-grid', {\n        init: function( options, elem ) {\n            this._super(elem, options, ImageGridDefaultConfig, {\n                // define instance vars here\n                items: []\n            });\n            return this;\n        },\n\n        _create: function(){\n            this.items = this.element.children(\"img\");\n            this._createStructure();\n            this._createEvents();\n            this._fireEvent('image-grid-create');\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n\n            element.addClass(\"image-grid\").addClass(o.clsImageGrid);\n\n            this._createItems();\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element;\n\n            element.on(Metro.events.click, \".image-grid__item\", function(){\n                that._fireEvent(\"item-click\", {\n                    item: this\n                });\n            });\n        },\n\n        _createItems: function(){\n            var that = this, element = this.element, o = this.options;\n            var items = this.items;\n\n            element.clear();\n\n            items.each(function(){\n                var el = $(this);\n                var src = this.src;\n                var wrapper = $(\"<div>\").addClass(\"image-grid__item\").addClass(o.clsImageGridItem).appendTo(element);\n                var img = new Image();\n\n                img.src = src;\n                img.onload = function(){\n                    var port = this.height >= this.width;\n                    wrapper.addClass(port ? \"image-grid__item-portrait\" : \"image-grid__item-landscape\");\n                    el.addClass(o.clsImageGridImage).appendTo(wrapper);\n\n                    if (o.useBackground) {\n                        wrapper\n                            .css({\n                                background: \"url(\"+src+\")\",\n                                backgroundRepeat: \"no-repeat\",\n                                backgroundSize: o.backgroundSize,\n                                backgroundPosition: o.backgroundPosition\n                            })\n                            .attr(\"data-original\", el.attr(\"data-original\") || src)\n                            .attr(\"data-title\", el.attr(\"alt\") || el.attr(\"data-title\") || \"\");\n                        el.visible(false);\n                    }\n\n                    that._fireEvent(\"draw-item\", {\n                        item: wrapper[0],\n                        image: el[0]\n                    });\n                }\n            });\n        },\n\n        changeAttribute: function(attr, val){\n            var o = this.options;\n\n            if (attr === \"data-use-background\") {\n                o.useBackground = Utils.bool(val);\n                this._createItems();\n            }\n\n            if (attr === \"data-background-size\") {\n                o.backgroundSize = val;\n                this._createItems();\n            }\n\n            if (attr === \"data-background-position\") {\n                o.backgroundPosition = val;\n                this._createItems();\n            }\n        },\n\n        destroy: function(){\n            this.element.remove();\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var ImageMagnifierDefaultConfig = {\n        imagemagnifierDeferred: 0,\n        width: \"100%\",\n        height: \"auto\",\n        lensSize: 100,\n        lensType: \"square\", // square, circle\n        magnifierZoom: 2,\n        magnifierMode: \"glass\", // glass, zoom\n        magnifierZoomElement: null,\n\n        clsMagnifier: \"\",\n        clsLens: \"\",\n        clsZoom: \"\",\n\n        onMagnifierMove: Metro.noop,\n        onImageMagnifierCreate: Metro.noop\n    };\n\n    Metro.imageMagnifierSetup = function (options) {\n        ImageMagnifierDefaultConfig = $.extend({}, ImageMagnifierDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroImageMagnifierSetup\"] !== undefined) {\n        Metro.imageMagnifierSetup(window[\"metroImageMagnifierSetup\"]);\n    }\n\n    Metro.Component('image-magnifier', {\n        init: function( options, elem ) {\n            this._super(elem, options, ImageMagnifierDefaultConfig, {\n                zoomElement: null,\n                id: Utils.elementId(\"image-magnifier\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"image-magnifier-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var magnifier, element_width, element_height;\n            var image = element.find(\"img\");\n\n            if (image.length === 0) {\n                throw new Error(\"Image not defined\");\n            }\n\n            if (!Utils.isValue(element.attr(\"id\"))) {\n                element.attr(\"id\", Utils.elementId(\"image-magnifier\"));\n            }\n\n            element.addClass(\"image-magnifier\").css({\n                width: o.width\n            }).addClass(o.clsMagnifier);\n\n            element_width = element.width();\n\n            switch (o.height) {\n                case \"16/9\": element_height = Utils.aspectRatioH(element_width, o.height); break;\n                case \"21/9\": element_height = Utils.aspectRatioH(element_width, o.height); break;\n                case \"4/3\": element_height = Utils.aspectRatioH(element_width, o.height); break;\n                case \"auto\": element_height = Utils.aspectRatioH(element_width, \"16/9\"); break;\n                default: element_height = o.height;\n            }\n\n            element.css({\n                height: element_height\n            });\n\n            var x = element_width / 2 - o.lensSize / 2;\n            var y = element_height / 2 - o.lensSize / 2;\n\n            if (o.magnifierMode === \"glass\") {\n\n                magnifier = $(\"<div>\").addClass(\"image-magnifier-glass\").appendTo(element);\n                magnifier.css({\n                    width: o.lensSize,\n                    height: o.lensSize,\n                    borderRadius: o.lensType !== \"circle\" ? 0 : \"50%\",\n                    top: y,\n                    left: x,\n                    backgroundImage: \"url(\" + image[0].src + \")\",\n                    backgroundRepeat: \"no-repeat\",\n                    backgroundPosition: \"-\" + ((x * o.magnifierZoom) - o.lensSize / 4 + 4) + \"px -\" + ((y * o.magnifierZoom) - o.lensSize / 4 + 4) + \"px\",\n                    backgroundSize: (image[0].width * o.magnifierZoom) + \"px \" + (image[0].height * o.magnifierZoom) + \"px\"\n                }).addClass(o.clsLens);\n\n            } else {\n\n                magnifier = $(\"<div>\").addClass(\"image-magnifier-glass\").appendTo(element);\n                magnifier.css({\n                    width: o.lensSize,\n                    height: o.lensSize,\n                    borderRadius: 0,\n                    borderWidth: 1,\n                    top: y,\n                    left: x\n                }).addClass(o.clsLens);\n\n                if (!Utils.isValue(o.magnifierZoomElement) || $(o.magnifierZoomElement).length === 0) {\n                    this.zoomElement = $(\"<div>\").insertAfter(element);\n                } else {\n                    this.zoomElement = $(o.magnifierZoomElement);\n                }\n\n                var zoom_element_width = magnifier[0].offsetWidth * o.magnifierZoom;\n                var zoom_element_height = magnifier[0].offsetHeight * o.magnifierZoom;\n                var cx = zoom_element_width / o.lensSize;\n                var cy = zoom_element_height / o.lensSize;\n\n                this.zoomElement.css({\n                    width: zoom_element_width,\n                    height: zoom_element_height,\n                    backgroundImage: \"url(\" + image[0].src + \")\",\n                    backgroundRepeat: \"no-repeat\",\n                    backgroundPosition: \"-\" + (x * cx) + \"px -\" + (y * cy) + \"px\",\n                    backgroundSize: (image[0].width * cx) + \"px \" + (image[0].height * cy) + \"px\"\n                }).addClass(o.clsZoom);\n            }\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var glass = element.find(\".image-magnifier-glass\");\n            var glass_size = glass[0].offsetWidth / 2;\n            var image = element.find(\"img\")[0];\n            var zoomElement = this.zoomElement;\n            var cx, cy;\n\n            $(window).on(Metro.events.resize, function(){\n                var x = element.width() / 2 - o.lensSize / 2;\n                var y = element.height() / 2 - o.lensSize / 2;\n\n                if (o.magnifierMode === \"glass\") {\n                    glass.css({\n                        backgroundPosition: \"-\" + ((x * o.magnifierZoom) - o.lensSize / 4 + 4) + \"px -\" + ((y * o.magnifierZoom) - o.lensSize / 4 + 4) + \"px\",\n                        backgroundSize: (image.width * o.magnifierZoom) + \"px \" + (image.height * o.magnifierZoom) + \"px\"\n                    });\n                }\n            }, {ns: this.id})\n\n            if (o.magnifierMode !== \"glass\") {\n                cx = zoomElement[0].offsetWidth / glass_size / 2;\n                cy = zoomElement[0].offsetHeight / glass_size / 2;\n\n                zoomElement.css({\n                    backgroundSize: (image.width * cx) + \"px \" + (image.height * cy) + \"px\"\n                });\n            }\n\n            var lens_move = function(pos){\n                var x, y;\n                var magic = 4, zoom = parseInt(o.magnifierZoom);\n\n                if (o.magnifierMode === \"glass\") {\n\n                    x = pos.x;\n                    y = pos.y;\n\n                    if (x > image.width - (glass_size / zoom)) {\n                        x = image.width - (glass_size / zoom);\n                    }\n                    if (x < glass_size / zoom) {\n                        x = glass_size / zoom;\n                    }\n                    if (y > image.height - (glass_size / zoom)) {\n                        y = image.height - (glass_size / zoom);\n                    }\n                    if (y < glass_size / zoom) {\n                        y = glass_size / zoom;\n                    }\n\n                    glass.css({\n                        top: y - glass_size,\n                        left: x - glass_size,\n                        backgroundPosition: \"-\" + ((x * zoom) - glass_size + magic) + \"px -\" + ((y * zoom) - glass_size + magic) + \"px\"\n                    });\n                } else {\n\n                    x = pos.x - (glass_size);\n                    y = pos.y - (glass_size);\n\n                    if (x > image.width - glass_size * 2) {x = image.width - glass_size * 2;}\n                    if (x < 0) {x = 0;}\n                    if (y > image.height - glass_size * 2) {y = image.height - glass_size * 2;}\n                    if (y < 0) {y = 0;}\n\n                    glass.css({\n                        top: y,\n                        left: x\n                    });\n\n                    zoomElement.css({\n                        backgroundPosition: \"-\" + (x * cx) + \"px -\" + (y * cy) + \"px\"\n                    });\n                }\n            };\n\n            element.on(Metro.events.move, function(e){\n                var pos = Utils.getCursorPosition(image, e);\n\n                lens_move(pos);\n\n                that._fireEvent(\"magnifier-move\", {\n                    pos: pos,\n                    glass: glass[0],\n                    zoomElement: zoomElement ? zoomElement[0] : undefined\n                });\n\n                e.preventDefault();\n            });\n\n            element.on(Metro.events.leave, function(){\n                var x = element.width() / 2 - o.lensSize / 2;\n                var y = element.height() / 2 - o.lensSize / 2;\n\n                glass.animate({\n                    draw: {\n                        top: y,\n                        left: x\n                    }\n                });\n\n                lens_move({\n                    x: x + o.lensSize / 2, y: y + o.lensSize / 2\n                });\n            });\n        },\n\n        /* eslint-disable-next-line */\n        changeAttribute: function(attributeName){\n        },\n\n        destroy: function(){\n            var element = this.element;\n            element.off(Metro.events.move);\n            element.off(Metro.events.leave);\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var ImagePlaceholderDefaultConfig = {\n        size: \"100x100\",\n        width: null,\n        height: null,\n        color: \"#f8f8f8\",\n        textColor: \"#292929\",\n        font: \"12px sans-serif\",\n        text: \"\",\n        showText: true,\n        onImagePlaceholderCreate: Metro.noop\n    };\n\n    Metro.imagePlaceholderSetup = function (options) {\n        ImagePlaceholderDefaultConfig = $.extend({}, ImagePlaceholderDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroImagePlaceholderSetup\"] !== undefined) {\n        Metro.imagePlaceholderSetup(window[\"metroImagePlaceholderSetup\"]);\n    }\n\n    Metro.Component('image-placeholder', {\n        init: function( options, elem ) {\n            this._super(elem, options, ImagePlaceholderDefaultConfig, {\n                // define instance vars here\n                width: 0,\n                height: 0\n            });\n            return this;\n        },\n\n        _create: function(){\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent('image-placeholder-create');\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var size = o.size.toArray(\"x\");\n\n            this.width = o.width ? o.width : size[0];\n            this.height = o.height ? o.height : size[1];\n\n            element.attr(\"src\", this._createPlaceholder());\n        },\n\n        _createEvents: function(){\n        },\n\n        _createPlaceholder: function(){\n            var o = this.options;\n            var canvas = document.createElement(\"canvas\"),\n                context = canvas.getContext(\"2d\");\n\n            var width = this.width, height = this.height;\n\n            canvas.width = parseInt(width);\n            canvas.height = parseInt(height);\n\n            // background\n            context.clearRect(0, 0, width, height);\n            context.fillStyle = o.color;\n            context.fillRect(0, 0, width, height);\n\n            // text\n            context.fillStyle = o.textColor;\n            context.font = o.font;\n\n            context.translate(width / 2, height / 2);\n            context.textAlign = 'center';\n            context.textBaseline = 'middle';\n\n            if (o.showText)\n                context.fillText(o.text ? o.text : width + \" \\u00d7 \" + height, 0, 0);\n\n            return canvas.toDataURL();\n        },\n\n        // changeAttribute: function(attr, newValue){\n        // },\n\n        destroy: function(){\n            this.element.remove();\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var InfoBoxDefaultConfig = {\n        infoboxDeferred: 0,\n        type: \"\",\n        width: 480,\n        height: \"auto\",\n        overlay: true,\n        overlayColor: '#000000',\n        overlayAlpha: .5,\n        overlayClickClose: false,\n        autoHide: 0,\n        removeOnClose: false,\n        closeButton: true,\n        clsBox: \"\",\n        clsBoxContent: \"\",\n        clsOverlay: \"\",\n        onOpen: Metro.noop,\n        onClose: Metro.noop,\n        onInfoBoxCreate: Metro.noop\n    };\n\n    Metro.infoBoxSetup = function (options) {\n        InfoBoxDefaultConfig = $.extend({}, InfoBoxDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroInfoBoxSetup\"] !== undefined) {\n        Metro.infoBoxSetup(window[\"metroInfoBoxSetup\"]);\n    }\n\n    Metro.Component('info-box', {\n        init: function( options, elem ) {\n            this._super(elem, options, InfoBoxDefaultConfig, {\n                overlay: null,\n                id: Utils.elementId(\"info-box\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"info-box-create\", {\n                element: element\n            });\n        },\n\n        _overlay: function(){\n            var o = this.options;\n\n            var overlay = $(\"<div>\");\n            overlay.addClass(\"overlay\").addClass(o.clsOverlay);\n\n            if (o.overlayColor === 'transparent') {\n                overlay.addClass(\"transparent\");\n            } else {\n                overlay.css({\n                    background: Metro.colors.toRGBA(o.overlayColor, o.overlayAlpha)\n                });\n            }\n\n            return overlay;\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var closer, content;\n\n            if (o.overlay === true) {\n                this.overlay = this._overlay();\n            }\n\n            element.addClass(\"info-box\").addClass(o.type).addClass(o.clsBox);\n\n            closer = element.find(\"closer\");\n            if (closer.length === 0) {\n                closer = $(\"<span>\").addClass(\"button square closer\");\n                closer.appendTo(element);\n            }\n\n            if (o.closeButton !== true) {\n                closer.hide();\n            }\n\n            content = element.find(\".info-box-content\");\n            if (content.length > 0) {\n                content.addClass(o.clsBoxContent);\n            }\n\n            element.css({\n                width: o.width,\n                height: o.height,\n                visibility: \"hidden\",\n                top: '100%',\n                left: ( $(window).width() - element.outerWidth() ) / 2\n            });\n\n            element.appendTo($('body'));\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element;\n\n            element.on(Metro.events.click, \".closer\", function(){\n                that.close();\n            });\n\n            element.on(Metro.events.click, \".js-dialog-close\", function(){\n                that.close();\n            });\n\n            $(window).on(Metro.events.resize, function(){\n                that.reposition();\n            }, {ns: this.id});\n        },\n\n        _setPosition: function(){\n            var element = this.element;\n            element.css({\n                top: ( $(window).height() - element.outerHeight() ) / 2,\n                left: ( $(window).width() - element.outerWidth() ) / 2\n            });\n        },\n\n        reposition: function(){\n            this._setPosition();\n        },\n\n        setContent: function(c){\n            var element = this.element;\n            var content = element.find(\".info-box-content\");\n            if (content.length === 0) {\n                return ;\n            }\n            content.html(c);\n            this.reposition();\n        },\n\n        setType: function(t){\n            var element = this.element;\n            element.removeClass(\"success info alert warning\").addClass(t);\n        },\n\n        open: function(){\n            var that = this, element = this.element, o = this.options;\n\n            // if (o.overlay === true) {\n            //     this.overlay.appendTo($(\"body\"));\n            // }\n            if (o.overlay === true && $(\".overlay\").length === 0) {\n                this.overlay.appendTo($(\"body\"));\n                if (o.overlayClickClose === true) {\n                    this.overlay.on(Metro.events.click, function(){\n                        that.close();\n                    });\n                }\n            }\n\n            this._setPosition();\n\n            element.css({\n                visibility: \"visible\"\n            });\n\n            this._fireEvent(\"open\");\n\n            element.data(\"open\", true);\n\n            if (parseInt(o.autoHide) > 0) {\n                setTimeout(function(){\n                    that.close();\n                }, parseInt(o.autoHide));\n            }\n        },\n\n        close: function(){\n            var element = this.element, o = this.options;\n\n            if (o.overlay === true) {\n                $('body').find('.overlay').remove();\n            }\n\n            element.css({\n                visibility: \"hidden\",\n                top: \"100%\"\n            });\n\n            this._fireEvent(\"close\");\n\n            element.data(\"open\", false);\n\n            if (o.removeOnClose === true) {\n                this.destroy();\n                element.remove();\n            }\n        },\n\n        isOpen: function(){\n            return this.element.data(\"open\") === true;\n        },\n\n        /* eslint-disable-next-line */\n        changeAttribute: function(attributeName){\n        },\n\n        destroy: function(){\n            var element = this.element;\n\n            element.off(\"all\");\n            $(window).off(Metro.events.resize, {ns: this.id});\n\n            return element;\n        }\n    });\n\n    Metro['infobox'] = {\n        isInfoBox: function(el){\n            return Utils.isMetroObject(el, \"infobox\");\n        },\n\n        open: function(el, c, t){\n            if (!this.isInfoBox(el)) {\n                return false;\n            }\n            var ib = Metro.getPlugin(el, \"infobox\");\n            if (c !== undefined) {\n                ib.setContent(c);\n            }\n            if (t !== undefined) {\n                ib.setType(t);\n            }\n            ib.open();\n        },\n\n        close: function(el){\n            if (!this.isInfoBox(el)) {\n                return false;\n            }\n            var ib = Metro.getPlugin(el, \"infobox\");\n            ib.close();\n        },\n\n        setContent: function(el, c){\n            if (!this.isInfoBox(el)) {\n                return false;\n            }\n\n            if (c === undefined) {\n                c = \"\";\n            }\n\n            var ib = Metro.getPlugin(el, \"infobox\");\n            ib.setContent(c);\n            ib.reposition();\n        },\n\n        setType: function(el, t){\n            if (!this.isInfoBox(el)) {\n                return false;\n            }\n\n            var ib = Metro.getPlugin(el, \"infobox\");\n            ib.setType(t);\n            ib.reposition();\n        },\n\n        isOpen: function(el){\n            if (!this.isInfoBox(el)) {\n                return false;\n            }\n            var ib = Metro.getPlugin(el, \"infobox\");\n            return ib.isOpen();\n        },\n\n        create: function(c, t, o, open){\n            var $$ = Utils.$();\n            var el, ib, box_type;\n\n            box_type = t !== undefined ? t : \"\";\n\n            el = $$(\"<div>\").appendTo($$(\"body\"));\n            $$(\"<div>\").addClass(\"info-box-content\").appendTo(el);\n\n            var ib_options = $$.extend({}, {\n                removeOnClose: true,\n                type: box_type\n            }, (o !== undefined ? o : {}));\n\n            ib_options._runtime = true;\n\n            el.infobox(ib_options);\n\n            ib = Metro.getPlugin(el, 'infobox');\n            ib.setContent(c);\n            if (open !== false) {\n                ib.open();\n            }\n\n            return el;\n        }\n    };\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var Utils = Metro.utils;\n    var InputMaskDefaultConfig = {\n        maskPattern: \".\",\n        mask: null,\n        maskPlaceholder: \"_\",\n        maskEditableStart: 0,\n        thresholdInterval: 300,\n        onChar: Metro.noop,\n        onInputMaskCreate: Metro.noop\n    };\n\n    Metro.inputMaskSetup = function (options) {\n        InputMaskDefaultConfig = $.extend({}, InputMaskDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroInputMaskSetup\"] !== undefined) {\n        Metro.inputMaskSetup(window[\"metroInputMaskSetup\"]);\n    }\n\n    Metro.Component('input-mask', {\n        init: function( options, elem ) {\n            if ($.device) {\n                if (elem.setAttribute) elem.setAttribute(\"placeholder\", options.mask);\n                console.warn(\"The component input-mask can't be initialized, because you run it on a mobile device!\");\n                return ;\n            }\n            this._super(elem, options, InputMaskDefaultConfig, {\n                // define instance vars here\n                pattern: null,\n                mask: \"\",\n                maskArray: [],\n                placeholder: \"\",\n                length: 0,\n                thresholdTimer: null,\n                id: Utils.elementId(\"input-mask\")\n            });\n            return this;\n        },\n\n        _create: function(){\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent('input-mask-create');\n        },\n\n        _createStructure: function(){\n            var o = this.options;\n\n            if (!o.mask) {\n                throw new Error('You must provide a pattern for masked input.')\n            }\n\n            if (typeof o.maskPlaceholder !== 'string' || o.maskPlaceholder.length > 1) {\n                throw new Error('Mask placeholder should be a single character or an empty string.')\n            }\n\n            this.placeholder = o.maskPlaceholder;\n            this.mask = (\"\"+o.mask);\n            this.maskArray = this.mask.split(\"\");\n            this.pattern = new RegExp(\"^\"+o.maskPattern+\"+$\");\n            this.length = this.mask.length;\n\n            this._showValue();\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var editableStart = o.maskEditableStart;\n            var id = this.id;\n\n            var checkEditablePosition = function(pos){\n                if (pos < editableStart) {\n                    setPosition(editableStart);\n                    return false;\n                }\n                return true;\n            }\n\n            var checkEditableChar = function(pos){\n                return pos < that.mask.length && that.mask.charAt(pos) === that.placeholder;\n            }\n\n            var findNextEditablePosition = function (pos){\n                var i, a = that.maskArray;\n\n                for (i = pos; i <= a.length; i++) {\n                    if (a[i] === that.placeholder) {\n                        return i;\n                    }\n                }\n                return pos;\n            }\n\n            var setPosition = function(pos){\n                that.elem.setSelectionRange(pos, pos);\n            }\n\n            var clearThresholdInterval = function(){\n                clearInterval(that.thresholdTimer);\n                that.thresholdTimer = null;\n            }\n\n            element.on(\"change\", function(){\n                if (this.value === \"\") {\n                    this.value = that.mask;\n                    setPosition(editableStart);\n                }\n            }, {ns: id});\n\n            element.on(\"focus click\", function(){\n                checkEditablePosition(this.selectionStart);\n                setPosition(findNextEditablePosition(this.selectionStart));\n            }, {ns: id});\n\n            element.on(\"keydown\", function(e){\n                var pos = this.selectionStart;\n                var val = this.value;\n                var code = e.code, key = e.key;\n\n                if (code === \"ArrowRight\" || code === \"End\") {\n                    return true;\n                } else {\n                    if (pos >= that.length && ([\"Backspace\", \"Home\", \"ArrowLeft\", \"ArrowUp\"].indexOf(code) === -1)) {\n                        // Don't move over mask length\n                        e.preventDefault();\n                    } else if (code === \"Home\" || code === \"ArrowUp\") {\n                        // Goto editable start position\n                        e.preventDefault();\n                        setPosition(editableStart);\n                    } else if (code === \"ArrowLeft\") {\n                        if (pos - 1 < editableStart) {\n                            // Don't move behind a editable start position\n                            e.preventDefault();\n                        }\n                    } else if (code === \"Backspace\") {\n                        e.preventDefault();\n                        if (pos - 1 >= editableStart) {\n                            if (checkEditableChar(pos - 1)) {\n                                if (this.value.charAt(pos - 1) !== that.placeholder) {\n                                    // Replace char if it is not a mask placeholder\n                                    this.value = val.substr(0, pos - 1) + that.placeholder + val.substr(pos);\n                                }\n                            }\n                            // Move to prev char position\n                            setPosition(pos - 1);\n                        }\n                    } else if (code === \"Space\") {\n                        e.preventDefault();\n                        setPosition(pos + 1);\n                    } else if (!that.pattern.test(key)) {\n                        e.preventDefault();\n                    } else {\n                        e.preventDefault();\n                        if (checkEditableChar(pos)) {\n                            this.value = val.substr(0, pos) + (o.onChar === Metro.noop ? key : Utils.exec(o.onChar, [key], this)) + val.substr(pos + 1);\n                            setPosition(findNextEditablePosition(pos + 1));\n                        }\n                    }\n                }\n            }, {ns: id});\n\n            element.on(\"keyup\", function(){\n                var el = this;\n\n                clearThresholdInterval();\n\n                that.thresholdTimer = setInterval(function(){\n                    clearThresholdInterval();\n                    setPosition(findNextEditablePosition(el.selectionStart));\n                }, o.thresholdInterval)\n            }, {ns: id});\n        },\n\n        _showValue: function(){\n            var that = this, elem = this.elem;\n            var a = new Array(this.length);\n            var val;\n            if (!elem.value) {\n                elem.value = this.mask;\n            } else {\n                val = elem.value;\n                $.each(this.maskArray, function(i, v){\n                    if (val[i] !== v && !that.pattern.test(val[i])) {\n                        a[i] = that.placeholder;\n                    } else {\n                        a[i] = val[i];\n                    }\n                });\n                this.elem.value = a.join(\"\");\n            }\n        },\n\n        destroy: function(){\n            var element = this.element, id = this.id;\n\n            element.off(\"change\", {ns: id});\n            element.off(\"focus\", {ns: id});\n            element.off(\"click\", {ns: id});\n            element.off(\"keydown\", {ns: id});\n            element.off(\"keyup\", {ns: id});\n\n            return element;\n        }\n    });\n}(Metro, m4q));\n\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var MaterialInputDefaultConfig = {\n        materialinputDeferred: 0,\n        label: \"\",\n        informer: \"\",\n        icon: \"\",\n\n        permanentLabel: false,\n\n        clsComponent: \"\",\n        clsInput: \"\",\n        clsLabel: \"\",\n        clsInformer: \"\",\n        clsIcon: \"\",\n        clsLine: \"\",\n\n        onInputCreate: Metro.noop\n    };\n\n    Metro.materialInputSetup = function (options) {\n        MaterialInputDefaultConfig = $.extend({}, MaterialInputDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroMaterialInputSetup\"] !== undefined) {\n        Metro.materialInputSetup(window[\"metroMaterialInputSetup\"]);\n    }\n\n    Metro.Component('material-input', {\n        init: function( options, elem ) {\n            this._super(elem, options, MaterialInputDefaultConfig, {\n                history: [],\n                historyIndex: -1\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"input-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var container = $(\"<div>\").addClass(\"input-material \" + element[0].className);\n\n            element[0].className = \"\";\n            element.attr(\"autocomplete\", \"nope\");\n\n            if (element.attr(\"type\") === undefined) {\n                element.attr(\"type\", \"text\");\n            }\n\n            container.insertBefore(element);\n            element.appendTo(container);\n\n            if (Utils.isValue(o.label)) {\n                $(\"<span>\").html(o.label).addClass(\"label\").addClass(o.clsLabel).insertAfter(element);\n            }\n            if (Utils.isValue(o.informer)) {\n                $(\"<span>\").html(o.informer).addClass(\"informer\").addClass(o.clsInformer).insertAfter(element);\n            }\n            if (Utils.isValue(o.icon)) {\n                container.addClass(\"with-icon\");\n                $(\"<span>\").html(o.icon).addClass(\"icon\").addClass(o.clsIcon).insertAfter(element);\n            }\n\n            container.append($(\"<hr>\").addClass(o.clsLine));\n\n            if (o.permanentLabel === true) {\n                container.addClass(\"permanent-label\");\n            }\n\n            container.addClass(o.clsComponent);\n            element.addClass(o.clsInput);\n\n            if (element.is(\":disabled\")) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        _createEvents: function(){\n\n        },\n\n        clear: function(){\n            this.element.val('');\n        },\n\n        disable: function(){\n            this.element.data(\"disabled\", true);\n            this.element.parent().addClass(\"disabled\");\n        },\n\n        enable: function(){\n            this.element.data(\"disabled\", false);\n            this.element.parent().removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        changeAttribute: function(attributeName){\n            if (attributeName === 'disabled') {\n                this.toggleState();\n            }\n        },\n\n        destroy: function(){\n            return this.element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var InputDefaultConfig = {\n        inputDeferred: 0,\n\n        label: \"\",\n\n        autocomplete: null,\n        autocompleteUrl: null,\n        autocompleteUrlMethod: \"GET\",\n        autocompleteUrlKey: null,\n        autocompleteDivider: \",\",\n        autocompleteListHeight: 200,\n\n        history: false,\n        historyPreset: \"\",\n        historyDivider: \"|\",\n        preventSubmit: false,\n        defaultValue: \"\",\n        size: \"default\",\n        prepend: \"\",\n        append: \"\",\n        copyInlineStyles: false,\n        searchButton: false,\n        clearButton: true,\n        revealButton: true,\n        clearButtonIcon: \"<span class='default-icon-cross'></span>\",\n        revealButtonIcon: \"<span class='default-icon-eye'></span>\",\n        searchButtonIcon: \"<span class='default-icon-search'></span>\",\n        customButtons: [],\n        searchButtonClick: 'submit',\n\n        clsComponent: \"\",\n        clsInput: \"\",\n        clsPrepend: \"\",\n        clsAppend: \"\",\n        clsClearButton: \"\",\n        clsRevealButton: \"\",\n        clsCustomButton: \"\",\n        clsSearchButton: \"\",\n        clsLabel: \"\",\n\n        onAutocompleteSelect: Metro.noop,\n        onHistoryChange: Metro.noop,\n        onHistoryUp: Metro.noop,\n        onHistoryDown: Metro.noop,\n        onClearClick: Metro.noop,\n        onRevealClick: Metro.noop,\n        onSearchButtonClick: Metro.noop,\n        onEnterClick: Metro.noop,\n        onInputCreate: Metro.noop\n    };\n\n    Metro.inputSetup = function (options) {\n        InputDefaultConfig = $.extend({}, InputDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroInputSetup\"] !== undefined) {\n        Metro.inputSetup(window[\"metroInputSetup\"]);\n    }\n\n    Metro.Component('input', {\n        init: function( options, elem ) {\n            this._super(elem, options, InputDefaultConfig, {\n                history: [],\n                historyIndex: -1,\n                autocomplete: []\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"input-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var that = this, element = this.element, o = this.options;\n            var container = $(\"<div>\").addClass(\"input \" + element[0].className);\n            var buttons = $(\"<div>\").addClass(\"button-group\");\n            var clearButton, revealButton, searchButton;\n\n            if (Utils.isValue(o.historyPreset)) {\n                $.each(o.historyPreset.toArray(o.historyDivider), function(){\n                    that.history.push(this);\n                });\n                that.historyIndex = that.history.length - 1;\n            }\n\n            if (element.attr(\"type\") === undefined) {\n                element.attr(\"type\", \"text\");\n            }\n\n            container.insertBefore(element);\n            element.appendTo(container);\n            buttons.appendTo(container);\n\n            if (!Utils.isValue(element.val().trim())) {\n                element.val(o.defaultValue);\n            }\n\n            if (o.clearButton === true && !element[0].readOnly) {\n                clearButton = $(\"<button>\").addClass(\"button input-clear-button\").addClass(o.clsClearButton).attr(\"tabindex\", -1).attr(\"type\", \"button\").html(o.clearButtonIcon);\n                clearButton.appendTo(buttons);\n            }\n            if (element.attr('type') === 'password' && o.revealButton === true) {\n                revealButton = $(\"<button>\").addClass(\"button input-reveal-button\").addClass(o.clsRevealButton).attr(\"tabindex\", -1).attr(\"type\", \"button\").html(o.revealButtonIcon);\n                revealButton.appendTo(buttons);\n            }\n            if (o.searchButton === true) {\n                searchButton = $(\"<button>\").addClass(\"button input-search-button\").addClass(o.clsSearchButton).attr(\"tabindex\", -1).attr(\"type\", o.searchButtonClick === 'submit' ? \"submit\" : \"button\").html(o.searchButtonIcon);\n                searchButton.appendTo(buttons);\n            }\n\n            if (Utils.isValue(o.prepend)) {\n                var prepend = $(\"<div>\").html(o.prepend);\n                prepend.addClass(\"prepend\").addClass(o.clsPrepend).appendTo(container);\n            }\n\n            if (Utils.isValue(o.append)) {\n                var append = $(\"<div>\").html(o.append);\n                append.addClass(\"append\").addClass(o.clsAppend).appendTo(container);\n            }\n\n            if (typeof o.customButtons === \"string\") {\n                o.customButtons = Utils.isObject(o.customButtons);\n            }\n\n            if (typeof o.customButtons === \"object\" && Utils.objectLength(o.customButtons) > 0) {\n                $.each(o.customButtons, function(){\n                    var item = this;\n                    var customButton = $(\"<button>\");\n\n                    customButton\n                        .addClass(\"button input-custom-button\")\n                        .addClass(o.clsCustomButton)\n                        .addClass(item.cls)\n                        .attr(\"tabindex\", -1)\n                        .attr(\"type\", \"button\")\n                        .html(item.html);\n\n                    if (item.attr && typeof item.attr === 'object') {\n                        $.each(item.attr, function(k, v){\n                            customButton.attr(Cake.dashedName(k), v);\n                        });\n                    }\n\n                    customButton.data(\"action\", item.onclick);\n\n                    customButton.appendTo(buttons);\n                });\n            }\n\n            if (Utils.isValue(element.attr('data-exclaim'))) {\n                container.attr('data-exclaim', element.attr('data-exclaim'));\n            }\n\n            if (element.attr('dir') === 'rtl' ) {\n                container.addClass(\"rtl\").attr(\"dir\", \"rtl\");\n            }\n\n            element[0].className = '';\n            if (o.copyInlineStyles === true) {\n                for (var i = 0, l = element[0].style.length; i < l; i++) {\n                    container.css(element[0].style[i], element.css(element[0].style[i]));\n                }\n            }\n\n            container.addClass(o.clsComponent);\n            element.addClass(o.clsInput);\n\n            if (o.size !== \"default\") {\n                container.css({\n                    width: o.size\n                });\n            }\n\n            if (!Utils.isNull(o.autocomplete) || !Utils.isNull(o.autocompleteUrl)) {\n                $(\"<div>\").addClass(\"autocomplete-list\").css({\n                    maxHeight: o.autocompleteListHeight,\n                    display: \"none\"\n                }).appendTo(container);\n            }\n\n            if (Utils.isValue(o.autocomplete)) {\n                var autocomplete_obj = Utils.isObject(o.autocomplete);\n\n                if (autocomplete_obj !== false) {\n                    this.autocomplete = autocomplete_obj;\n                } else {\n                    this.autocomplete = o.autocomplete.toArray(o.autocompleteDivider);\n                }\n            }\n\n            if (Utils.isValue(o.autocompleteUrl)) {\n                fetch(o.autocompleteUrl, {\n                    method: o.autocompleteUrlMethod\n                }).then(function(response){\n                    return response.text()\n                }).then(function(data){\n                    var newData = [];\n\n                    try {\n                        newData = JSON.parse(data);\n                        if (o.autocompleteUrlKey) {\n                            newData = newData[o.autocompleteUrlKey];\n                        }\n                    } catch (e) {\n                        newData = data.split(\"\\n\");\n                    }\n\n                    that.autocomplete = that.autocomplete.concat(newData);\n                });\n            }\n\n            if (o.label) {\n                var label = $(\"<label>\").addClass(\"label-for-input\").addClass(o.clsLabel).html(o.label).insertBefore(container);\n                if (element.attr(\"id\")) {\n                    label.attr(\"for\", element.attr(\"id\"));\n                }\n                if (element.attr(\"dir\") === \"rtl\") {\n                    label.addClass(\"rtl\");\n                }\n            }\n\n            if (element.is(\":disabled\")) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var container = element.closest(\".input\");\n            var autocompleteList = container.find(\".autocomplete-list\");\n\n            container.on(Metro.events.click, \".input-clear-button\", function(){\n                var curr = element.val();\n                element.val(Utils.isValue(o.defaultValue) ? o.defaultValue : \"\").fire('clear').fire('change').fire('keyup').focus();\n                if (autocompleteList.length > 0) {\n                    autocompleteList.css({\n                        display: \"none\"\n                    })\n                }\n\n                that._fireEvent(\"clear-click\", {\n                    prev: curr,\n                    val: element.val()\n                });\n\n            });\n\n            container.on(Metro.events.click, \".input-reveal-button\", function(){\n                if (element.attr('type') === 'password') {\n                    element.attr('type', 'text');\n                } else {\n                    element.attr('type', 'password');\n                }\n\n                that._fireEvent(\"reveal-click\", {\n                    val: element.val()\n                });\n\n            });\n\n            container.on(Metro.events.click, \".input-search-button\", function(){\n                if (o.searchButtonClick !== 'submit') {\n\n                    that._fireEvent(\"search-button-click\", {\n                        val: element.val(),\n                        button: this\n                    });\n\n                } else {\n                    this.form.submit();\n                }\n            });\n\n            // container.on(Metro.events.stop, \".input-reveal-button\", function(){\n            //     element.attr('type', 'password').focus();\n            // });\n\n            container.on(Metro.events.click, \".input-custom-button\", function(){\n                var button = $(this);\n                var action = button.data(\"action\");\n                Utils.exec(action, [element.val(), button], this);\n            });\n\n            element.on(Metro.events.keyup, function(e){\n                var val = element.val().trim();\n\n                if (o.history && e.keyCode === Metro.keyCode.ENTER && val !== \"\") {\n                    element.val(\"\");\n                    that.history.push(val);\n                    that.historyIndex = that.history.length - 1;\n\n                    that._fireEvent(\"history-change\", {\n                        val: val,\n                        history: that.history,\n                        historyIndex: that.historyIndex\n                    })\n\n                    if (o.preventSubmit === true) {\n                        e.preventDefault();\n                    }\n                }\n\n                if (o.history && e.keyCode === Metro.keyCode.UP_ARROW) {\n                    that.historyIndex--;\n                    if (that.historyIndex >= 0) {\n                        element.val(\"\");\n                        element.val(that.history[that.historyIndex]);\n\n                        that._fireEvent(\"history-down\", {\n                            val: element.val(),\n                            history: that.history,\n                            historyIndex: that.historyIndex\n                        })\n                    } else {\n                        that.historyIndex = 0;\n                    }\n                    e.preventDefault();\n                }\n\n                if (o.history && e.keyCode === Metro.keyCode.DOWN_ARROW) {\n                    that.historyIndex++;\n                    if (that.historyIndex < that.history.length) {\n                        element.val(\"\");\n                        element.val(that.history[that.historyIndex]);\n\n                        that._fireEvent(\"history-up\", {\n                            val: element.val(),\n                            history: that.history,\n                            historyIndex: that.historyIndex\n                        })\n                    } else {\n                        that.historyIndex = that.history.length - 1;\n                    }\n                    e.preventDefault();\n                }\n            });\n\n            element.on(Metro.events.keydown, function(e){\n                if (e.keyCode === Metro.keyCode.ENTER) {\n                    that._fireEvent(\"enter-click\", {\n                        val: element.val()\n                    });\n                }\n            });\n\n            element.on(Metro.events.blur, function(){\n                container.removeClass(\"focused\");\n            });\n\n            element.on(Metro.events.focus, function(){\n                container.addClass(\"focused\");\n            });\n\n            element.on(Metro.events.input, function(){\n                var val = this.value.toLowerCase();\n                that._drawAutocompleteList(val);\n            });\n\n            container.on(Metro.events.click, \".autocomplete-list .item\", function(){\n                var val = $(this).attr(\"data-autocomplete-value\");\n                element.val(val);\n                autocompleteList.css({\n                    display: \"none\"\n                });\n                element.trigger(\"change\");\n                that._fireEvent(\"autocomplete-select\", {\n                    value: val\n                });\n            });\n        },\n\n        _drawAutocompleteList: function(val){\n            var that = this, element = this.element;\n            var container = element.closest(\".input\");\n            var autocompleteList = container.find(\".autocomplete-list\");\n            var items;\n\n            if (autocompleteList.length === 0) {\n                return;\n            }\n\n            autocompleteList.html(\"\");\n\n            items = this.autocomplete.filter(function(item){\n                return item.toLowerCase().indexOf(val) > -1;\n            });\n\n            autocompleteList.css({\n                display: items.length > 0 ? \"block\" : \"none\"\n            });\n\n            $.each(items, function(){\n                var v = this;\n                var index = v.toLowerCase().indexOf(val), content;\n                var item = $(\"<div>\").addClass(\"item\").attr(\"data-autocomplete-value\", v);\n\n                if (index === 0) {\n                    content = \"<strong>\"+v.substr(0, val.length)+\"</strong>\"+v.substr(val.length);\n                } else {\n                    content = v.substr(0, index) + \"<strong>\"+v.substr(index, val.length)+\"</strong>\"+v.substr(index + val.length);\n                }\n\n                item.html(content).appendTo(autocompleteList);\n\n                that._fireEvent(\"draw-autocomplete-item\", {\n                    item: item\n                })\n            });\n        },\n\n        getHistory: function(){\n            return this.history;\n        },\n\n        getHistoryIndex: function(){\n            return this.historyIndex;\n        },\n\n        setHistoryIndex: function(val){\n            this.historyIndex = val >= this.history.length ? this.history.length - 1 : val;\n        },\n\n        setHistory: function(history, append) {\n            var that = this, o = this.options;\n            if (Utils.isNull(history)) return;\n            if (!Array.isArray(history) && typeof history === 'string') {\n                history = history.toArray(o.historyDivider);\n            }\n            if (append === true) {\n                $.each(history, function () {\n                    that.history.push(this);\n                })\n            } else{\n                this.history = history;\n            }\n            this.historyIndex = this.history.length - 1;\n        },\n\n        clear: function(){\n            this.element.val('');\n        },\n\n        toDefault: function(){\n            this.element.val(Utils.isValue(this.options.defaultValue) ? this.options.defaultValue : \"\");\n        },\n\n        disable: function(){\n            this.element.data(\"disabled\", true);\n            this.element.parent().addClass(\"disabled\");\n        },\n\n        enable: function(){\n            this.element.data(\"disabled\", false);\n            this.element.parent().removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        setAutocompleteList: function(l){\n            var autocomplete_list = Utils.isObject(l);\n            if (autocomplete_list !== false) {\n                this.autocomplete = autocomplete_list;\n            } else if (typeof l === \"string\") {\n                this.autocomplete = l.toArray(this.options.autocompleteDivider);\n            }\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case 'disabled': this.toggleState(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n            var parent = element.parent();\n            var clearBtn = parent.find(\".input-clear-button\");\n            var revealBtn = parent.find(\".input-reveal-button\");\n            var customBtn = parent.find(\".input-custom-button\");\n\n            if (clearBtn.length > 0) {\n                clearBtn.off(Metro.events.click);\n            }\n            if (revealBtn.length > 0) {\n                revealBtn.off(Metro.events.start);\n                revealBtn.off(Metro.events.stop);\n            }\n            if (customBtn.length > 0) {\n                clearBtn.off(Metro.events.click);\n            }\n\n            element.off(Metro.events.blur);\n            element.off(Metro.events.focus);\n\n            return element;\n        }\n    });\n\n    $(document).on(Metro.events.click, function(){\n        $('.input .autocomplete-list').hide();\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var KeylockDefaultConfig = {\n        keylockDeferred: 0,\n\n        stateOnIcon: \"<span>&times;</span>\",\n        stateOffIcon: \"<span>&checkmark;</span>\",\n\n        transition: true,\n\n        onCaption: \"\",\n        offCaption: \"\",\n        captionPosition: \"right\",\n\n        clsKeylock: \"\",\n        clsStateOn: \"\",\n        clsStateOff: \"\",\n        clsCaption: \"\",\n        clsIcon: \"\",\n        clsOnCaption: \"\",\n        clsOffCaption: \"\",\n\n        onKeylockCreate: Metro.noop\n    };\n\n    Metro.keylockSetup = function (options) {\n        KeylockDefaultConfig = $.extend({}, KeylockDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroKeylockSetup\"] !== undefined) {\n        Metro.keylockSetup(window[\"metroKeylockSetup\"]);\n    }\n\n    Metro.Component('keylock', {\n        init: function( options, elem ) {\n            this._super(elem, options, KeylockDefaultConfig);\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n            var container;\n            var icon = $(\"<span>\").addClass(\"icon\").addClass(o.clsIcon);\n            var caption = $(\"<span>\").addClass(\"caption\").addClass(o.clsCaption);\n            var stateOnIcon = $(o.stateOnIcon).addClass(\"state-on\").addClass(o.clsStateOn);\n            var stateOffIcon = $(o.stateOffIcon).addClass(\"state-off\").addClass(o.clsStateOff);\n            var onCaption = $(\"<span>\").addClass(\"state-on\").addClass(o.clsOnCaption).html(o.onCaption);\n            var offCaption = $(\"<span>\").addClass(\"state-off\").addClass(o.clsOffCaption).html(o.offCaption);\n\n            element.attr(\"type\", \"checkbox\");\n\n            if (element.attr(\"readonly\") !== undefined) {\n                element.on(\"click\", function(e){\n                    e.preventDefault();\n                })\n            }\n\n            container = element.wrap(\n                $(\"<label>\").addClass(\"keylock\").addClass(o.clsKeylock)\n            );\n\n            icon.appendTo(container);\n            caption.appendTo(container);\n\n            stateOnIcon.appendTo(icon);\n            stateOffIcon.appendTo(icon);\n\n            onCaption.appendTo(caption);\n            offCaption.appendTo(caption);\n\n            if (o.transition === true) {\n                container.addClass(\"transition-on\");\n            }\n\n            if (o.captionPosition === 'left') {\n                container.addClass(\"caption-left\");\n            }\n\n            element[0].className = '';\n\n            if (element.is(':disabled')) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n\n            this._fireEvent(\"keylock-create\");\n        },\n\n        disable: function(){\n            this.element.data(\"disabled\", true);\n            this.element.parent().addClass(\"disabled\");\n        },\n\n        enable: function(){\n            this.element.data(\"disabled\", false);\n            this.element.parent().removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        toggle: function(v){\n            var element = this.element;\n\n            if (!Utils.isValue(v)) {\n                element.prop(\"checked\", !Utils.bool(element.prop(\"checked\")));\n            } else {\n                element.prop(\"checked\", v === 1);\n            }\n\n            return this;\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case 'disabled': this.toggleState(); break;\n            }\n        },\n\n        destroy: function(){\n            return this.element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    //var Utils = Metro.utils;\n    var KeypadDefaultConfig = {\n        keypadDeferred: 0,\n        label: \"\",\n        keySize: 48,\n        keys: \"1, 2, 3, 4, 5, 6, 7, 8, 9, 0\",\n        exceptKeys: \"\",\n        keySeparator: \"\",\n        trimSeparator: false,\n        keyDelimiter: \",\",\n        copyInlineStyles: false,\n        target: null,\n        keyLength: 0,\n        shuffle: false,\n        shuffleCount: 3,\n        position: Metro.position.BOTTOM_LEFT, //top-left, top, top-right, right, bottom-right, bottom, bottom-left, left\n        dynamicPosition: false,\n        serviceButtons: true,\n        showValue: true,\n        open: false,\n        sizeAsKeys: false,\n\n        clsKeypad: \"\",\n        clsInput: \"\",\n        clsKeys: \"\",\n        clsKey: \"\",\n        clsServiceKey: \"\",\n        clsBackspace: \"\",\n        clsClear: \"\",\n        clsLabel: \"\",\n\n        onChange: Metro.noop,\n        onClear: Metro.noop,\n        onBackspace: Metro.noop,\n        onShuffle: Metro.noop,\n        onKey: Metro.noop,\n        onKeypadCreate: Metro.noop\n    };\n\n    Metro.keypadSetup = function (options) {\n        KeypadDefaultConfig = $.extend({}, KeypadDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroKeypadSetup\"] !== undefined) {\n        Metro.keypadSetup(window[\"metroKeypadSetup\"]);\n    }\n\n    Metro.Component('keypad', {\n        init: function( options, elem ) {\n            this._super(elem, options, KeypadDefaultConfig, {\n                value: elem.tagName === 'INPUT' ? elem.value : elem.innerText,\n                positions: [\"top-left\", \"top\", \"top-right\", \"right\", \"bottom-right\", \"bottom\", \"bottom-left\", \"left\"],\n                keypad: null,\n                keys: [],\n                keys_to_work: [],\n                exceptKeys: []\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n\n            this.keys = o.keys.toArray(o.keyDelimiter);\n            this.keys_to_work = this.keys;\n            this.exceptKeys = o.exceptKeys.toArray(o.keyDelimiter);\n\n            this._createKeypad();\n            if (o.shuffle === true) {\n                this.shuffle();\n            }\n            this._createKeys();\n            this._createEvents();\n\n            this._fireEvent(\"keypad-create\", {\n                element: element\n            });\n        },\n\n        _createKeypad: function(){\n            var element = this.element, o = this.options;\n            var parent = element.parent();\n            var keypad, keys;\n\n            if (parent.hasClass(\"input\")) {\n                keypad = parent;\n            } else {\n                keypad = $(\"<div>\").addClass(\"input\").addClass(element[0].className);\n            }\n\n            keypad.addClass(\"keypad\");\n            if (keypad.css(\"position\") === \"static\" || keypad.css(\"position\") === \"\") {\n                keypad.css({\n                    position: \"relative\"\n                });\n            }\n\n            if (element.attr(\"type\") === undefined) {\n                element.attr(\"type\", \"text\");\n            }\n\n            keypad.insertBefore(element);\n\n            element.attr(\"readonly\", true);\n            element.appendTo(keypad);\n\n            keys = $(\"<div>\").addClass(\"keys\").addClass(o.clsKeys);\n            keys.appendTo(keypad);\n            this._setKeysPosition();\n\n            if (o.open === true) {\n                keys.addClass(\"open keep-open\");\n            }\n\n\n            element[0].className = '';\n            if (o.copyInlineStyles === true) {\n                for (var i = 0, l = element[0].style.length; i < l; i++) {\n                    keypad.css(element[0].style[i], element.css(element[0].style[i]));\n                }\n            }\n\n            element.addClass(o.clsInput);\n            keypad.addClass(o.clsKeypad);\n\n            element.on(Metro.events.blur, function(){keypad.removeClass(\"focused\");});\n            element.on(Metro.events.focus, function(){keypad.addClass(\"focused\");});\n\n            if (o.label) {\n                var label = $(\"<label>\").addClass(\"label-for-input\").addClass(o.clsLabel).html(o.label).insertBefore(keypad);\n                if (element.attr(\"id\")) {\n                    label.attr(\"for\", element.attr(\"id\"));\n                }\n                if (element.attr(\"dir\") === \"rtl\") {\n                    label.addClass(\"rtl\");\n                }\n            }\n\n            if (o.disabled === true || element.is(\":disabled\")) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n\n            this.keypad = keypad;\n        },\n\n        _setKeysPosition: function(){\n            var element = this.element, o = this.options;\n            var keypad = element.parent();\n            var keys = keypad.find(\".keys\");\n            keys.removeClass(this.positions.join(\" \")).addClass(o.position)\n        },\n\n        _createKeys: function(){\n            var element = this.element, o = this.options;\n            var keypad = element.parent();\n            var key, keys = keypad.find(\".keys\");\n            var factor = Math.round(Math.sqrt(this.keys.length + 2));\n            var key_size = o.keySize;\n            var width;\n\n            keys.html(\"\");\n\n            $.each(this.keys_to_work, function(){\n                key = $(\"<span>\").addClass(\"key\").addClass(o.clsKey).html(this);\n                key.data(\"key\", this);\n                key.css({\n                    width: o.keySize,\n                    height: o.keySize,\n                    lineHeight: o.keySize - 4\n                }).appendTo(keys);\n            });\n\n            if (o.serviceButtons === true) {\n\n                var service_keys = ['&larr;', '&times;'];\n\n                $.each(service_keys, function () {\n                    key = $(\"<span>\").addClass(\"key service-key\").addClass(o.clsKey).addClass(o.clsServiceKey).html(this);\n                    if (this === '&larr;') {\n                        key.addClass(o.clsBackspace);\n                    }\n                    if (this === '&times;') {\n                        key.addClass(o.clsClear);\n                    }\n                    key.data(\"key\", this);\n                    key.css({\n                        width: o.keySize,\n                        height: o.keySize,\n                        lineHeight: o.keySize - 4\n                    }).appendTo(keys);\n                });\n            }\n\n            width = factor * (key_size + 2) - 6;\n            keys.outerWidth(width);\n\n            if (o.sizeAsKeys === true && ['top-left', 'top', 'top-right', 'bottom-left', 'bottom', 'bottom-right'].indexOf(o.position) !== -1) {\n                keypad.outerWidth(keys.outerWidth());\n            }\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var keypad = element.parent();\n            var keys = keypad.find(\".keys\");\n\n            keys.on(Metro.events.click, \".key\", function(e){\n                var key = $(this);\n                var keyValue = key.data(\"key\");\n                var crop;\n\n                if (key.data('key') !== '&larr;' && key.data('key') !== '&times;') {\n\n                    if (o.keyLength > 0 && (\"\"+that.value).length === o.keyLength) {\n                        return false;\n                    }\n\n                    if (that.exceptKeys.indexOf(keyValue) === -1)\n                        that.value = that.value + (that.value !== \"\" ? o.keySeparator : \"\") + keyValue;\n\n                    if (o.shuffle === true) {\n                        that.shuffle();\n                        that._createKeys();\n                    }\n\n                    if (o.dynamicPosition === true) {\n                        o.position = that.positions[$.random(0, that.positions.length - 1)];\n                        that._setKeysPosition();\n                    }\n\n                    that._fireEvent(\"key\", {\n                        key: key.data(\"key\"),\n                        val: that.value\n                    });\n\n                } else {\n                    if (key.data('key') === '&times;') {\n                        that.value = \"\";\n                        that._fireEvent(\"clear\");\n                    }\n                    if (key.data('key') === '&larr;') {\n                        crop = o.keySeparator && that.value[that.value.length - 1] !== o.keySeparator ? 2 : 1;\n                        that.value = (that.value.substring(0, that.value.length - crop));\n                        that._fireEvent(\"backspace\", {\n                            val: that.value\n                        });\n                    }\n                }\n\n                if (o.showValue === true) {\n                    if (element[0].tagName === \"INPUT\") {\n                        element.val(that.value);\n                    } else {\n                        element.text(that.value);\n                    }\n                }\n\n                that._fireEvent('change', {\n                    val: that.val\n                })\n                // element.trigger('change');\n                // Utils.exec(o.onChange, [that.value], element[0]);\n\n                e.preventDefault();\n                e.stopPropagation();\n            });\n\n            keypad.on(Metro.events.click, function(e){\n                if (o.open === true) {\n                    return ;\n                }\n\n                if (keys.hasClass(\"open\") === true) {\n                    keys.removeClass(\"open\");\n                } else {\n                    keys.addClass(\"open\");\n                }\n\n                e.preventDefault();\n                e.stopPropagation();\n            });\n\n            if (o.target !== null) {\n                element.on(Metro.events.change, function(){\n                    var t = $(o.target);\n                    if (t.length === 0) {\n                        return ;\n                    }\n                    if (t[0].tagName === \"INPUT\") {\n                        t.val(that.value);\n                    } else {\n                        t.text(that.value);\n                    }\n                });\n            }\n        },\n\n        shuffle: function(){\n            var o = this.options;\n            for (var i = 0; i < o.shuffleCount; i++) {\n                this.keys_to_work = this.keys_to_work.shuffle();\n            }\n\n            this._fireEvent(\"shuffle\", {\n                keysToWork: this.keys_to_work,\n                keys: this.keys\n            });\n        },\n\n        shuffleKeys: function(count){\n            if (count === undefined) {\n                count = this.options.shuffleCount;\n            }\n            for (var i = 0; i < count; i++) {\n                this.keys_to_work = this.keys_to_work.shuffle();\n            }\n            this._createKeys();\n        },\n\n        val: function(v){\n            var element = this.element, o = this.options;\n\n            if (typeof v === \"undefined\") {\n                return o.trimSeparator ? this.value.replace(new RegExp(o.keySeparator, \"g\")) : this.value;\n            }\n\n            this.value = \"\"+v;\n\n            if (element[0].tagName === \"INPUT\") {\n                element.val(v);\n                // set cursor to end position\n            } else {\n                element.text(v)\n            }\n\n            return this;\n        },\n\n        open: function(){\n            var element = this.element;\n            var keypad = element.parent();\n            var keys = keypad.find(\".keys\");\n\n            keys.addClass(\"open\");\n        },\n\n        close: function(){\n            var element = this.element;\n            var keypad = element.parent();\n            var keys = keypad.find(\".keys\");\n\n            keys.removeClass(\"open\");\n        },\n\n        disable: function(){\n            this.element.data(\"disabled\", true);\n            this.element.parent().addClass(\"disabled\");\n        },\n\n        enable: function(){\n            this.element.data(\"disabled\", false);\n            this.element.parent().removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        setPosition: function(pos){\n            var new_position = pos !== undefined ? pos : this.element.attr(\"data-position\");\n            if (this.positions.indexOf(new_position) === -1) {\n                return ;\n            }\n            this.options.position = new_position;\n            this._setKeysPosition();\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case 'disabled': this.toggleState(); break;\n                case 'data-position': this.setPosition(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element, keypad = this.keypad, keys = keypad.find(\".keys\");\n\n            keypad.off(Metro.events.click);\n            keys.off(Metro.events.click, \".key\");\n            element.off(Metro.events.change);\n\n            return element;\n        }\n    });\n\n    $(document).on(Metro.events.click, function(){\n        var keypads = $(\".keypad .keys\");\n        $.each(keypads, function(){\n            if (!$(this).hasClass(\"keep-open\")) {\n                $(this).removeClass(\"open\");\n            }\n        });\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var LightboxDefaultConfig = {\n        loop: true,\n        source: \"img\",\n\n        iconClose: \"<span class='default-icon-cross'>\",\n        iconPrev: \"<span class='default-icon-chevron-left'>\",\n        iconNext: \"<span class='default-icon-chevron-right'>\",\n\n        clsNext: \"\",\n        clsPrev: \"\",\n        clsClose: \"\",\n        clsImage: \"\",\n        clsImageContainer: \"\",\n        clsImageWrapper: \"\",\n        clsLightbox: \"\",\n\n        onDrawImage: Metro.noop,\n        onLightboxCreate: Metro.noop\n    };\n\n    Metro.lightboxSetup = function (options) {\n        LightboxDefaultConfig = $.extend({}, LightboxDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroLightboxSetup\"] !== undefined) {\n        Metro.lightboxSetup(window[\"metroLightboxSetup\"]);\n    }\n\n    Metro.Component('lightbox', {\n        init: function( options, elem ) {\n            this._super(elem, options, LightboxDefaultConfig, {\n                // define instance vars here\n                overlay: null,\n                lightbox: null,\n                current: null,\n                items: []\n            });\n            return this;\n        },\n\n        _create: function(){\n            var o = this.options;\n\n            if (!o.source) {\n                o.source = \"img\";\n            }\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent('lightbox-create');\n        },\n\n        _createStructure: function(){\n            var o = this.options;\n            var lightbox, overlay;\n\n            overlay = $(\".lightbox-overlay\");\n\n            if (overlay.length === 0) {\n                overlay = $(\"<div>\").addClass(\"lightbox-overlay\").appendTo(\"body\").hide();\n            }\n\n            lightbox = $(\"<div>\").addClass(\"lightbox\").addClass(o.clsLightbox).appendTo(\"body\").hide();\n\n            $(\"<span>\").addClass(\"lightbox__prev\").addClass(o.clsPrev).html(o.iconPrev).appendTo(lightbox);\n            $(\"<span>\").addClass(\"lightbox__next\").addClass(o.clsNext).html(o.iconNext).appendTo(lightbox);\n            $(\"<span>\").addClass(\"lightbox__closer\").addClass(o.clsClose).html(o.iconClose).appendTo(lightbox);\n            $(\"<div>\").addClass(\"lightbox__image\").addClass(o.clsImageContainer).appendTo(lightbox);\n\n            this.component = lightbox[0];\n            this.lightbox = lightbox;\n            this.overlay = overlay;\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var lightbox = $(this.component);\n\n            element.on(Metro.events.click, o.source, function(){\n                that.open(this);\n            });\n\n            lightbox.on(Metro.events.click, \".lightbox__closer\", function(){\n                that.close();\n            });\n\n            lightbox.on(Metro.events.click, \".lightbox__prev\", function(){\n                that.prev();\n            });\n\n            lightbox.on(Metro.events.click, \".lightbox__next\", function(){\n                that.next();\n            });\n        },\n\n        _setupItems: function(){\n            var element = this.element, o = this.options;\n            var items = element.find(o.source);\n\n            if (items.length === 0) {\n                return ;\n            }\n\n            this.items = items;\n        },\n\n        _goto: function(el){\n            var that = this, o = this.options;\n            var $el = $(el);\n            var img = $(\"<img>\"), src;\n            var imageContainer, imageWrapper, activity;\n\n            imageContainer = this.lightbox.find(\".lightbox__image\");\n\n            imageContainer.find(\".lightbox__image-wrapper\").remove();\n            imageWrapper = $(\"<div>\")\n                .addClass(\"lightbox__image-wrapper\")\n                .addClass(o.clsImageWrapper)\n                .attr(\"data-title\", ($el.attr(\"alt\") || $el.attr(\"data-title\") || \"\"))\n                .appendTo(imageContainer);\n\n            activity = $(\"<div>\").appendTo(imageWrapper);\n\n            Metro.makePlugin(activity, \"activity\", {\n                type: \"cycle\",\n                style: \"color\"\n            });\n\n            this.current = el;\n\n            if (el.tagName === \"IMG\" || el.tagName === \"DIV\") {\n                src = $el.attr(\"data-original\") || $el.attr(\"src\");\n                img.attr(\"src\", src);\n                img[0].onload = function(){\n                    var port = this.height > this.width;\n                    img.addClass(port ? \"lightbox__image-portrait\" : \"lightbox__image-landscape\").addClass(o.clsImage);\n                    img.attr(\"alt\", $el.attr(\"alt\"));\n                    img.appendTo(imageWrapper);\n                    activity.remove();\n                    that._fireEvent(\"draw-image\", {\n                        image: img[0],\n                        item: imageWrapper[0]\n                    });\n                }\n            }\n        },\n\n        _index: function(el){\n            var index = -1;\n\n            this.items.each(function(i){\n                if (this === el) {\n                    index = i;\n                }\n            });\n\n            return index;\n        },\n\n        next: function(){\n            var index, current = this.current;\n\n            index = this._index(current);\n\n            if (index + 1 >= this.items.length) {\n                if (this.options.loop) {\n                    index = -1;\n                } else {\n                    return;\n                }\n            }\n\n            this._goto(this.items[index + 1]);\n        },\n\n        prev: function(){\n            var index, current = this.current;\n\n            index = this._index(current);\n\n            if (index - 1 < 0) {\n                if (this.options.loop) {\n                    index = this.items.length;\n                } else {\n                    return;\n                }\n            }\n\n            this._goto(this.items[index - 1]);\n        },\n\n        open: function(el){\n            this._setupItems();\n\n            this._goto(el);\n\n            this.overlay.show();\n            this.lightbox.show();\n\n            return this;\n        },\n\n        close: function(){\n            this.overlay.hide();\n            this.lightbox.hide();\n        },\n\n        changeAttribute: function(){\n        },\n\n        destroy: function(){\n            this.element.remove();\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var ListDefaultConfig = {\n        locale: METRO_LOCALE,\n        listDeferred: 0,\n        templateBeginToken: \"<%\",\n        templateEndToken: \"%>\",\n        paginationDistance: 5,\n        paginationShortMode: true,\n        thousandSeparator: \",\",\n        decimalSeparator: \",\",\n        itemTag: \"li\",\n        defaultTemplateTag: \"div\",\n        sortClass: null,\n        sortDir: \"asc\",\n        sortInitial: true,\n        filterClass: null,\n        filter: null,\n        filterString: \"\",\n        filters: null,\n        source: null,\n        showItemsSteps: false,\n        showSearch: false,\n        showListInfo: false,\n        showPagination: false,\n        showActivity: true,\n        muteList: true,\n        items: -1,\n        itemsSteps: \"all, 10,25,50,100\",\n        itemsAllTitle: \"Show all\",\n        listItemsCountTitle: \"Show entries:\",\n        listSearchTitle: \"Search:\",\n        listInfoTitle: \"Showing $1 to $2 of $3 entries\",\n        paginationPrevTitle: \"Prev\",\n        paginationNextTitle: \"Next\",\n        activityType: \"cycle\",\n        activityStyle: \"color\",\n        activityTimeout: 100,\n        searchWrapper: null,\n        rowsWrapper: null,\n        infoWrapper: null,\n        paginationWrapper: null,\n        clsComponent: \"\",\n        clsList: \"\",\n        clsListItem: \"\",\n        clsListTop: \"\",\n        clsItemsCount: \"\",\n        clsSearch: \"\",\n        clsListBottom: \"\",\n        clsListInfo: \"\",\n        clsListPagination: \"\",\n        clsPagination: \"\",\n        clsTemplateTag: \"\",\n        onDraw: Metro.noop,\n        onDrawItem: Metro.noop,\n        onSortStart: Metro.noop,\n        onSortStop: Metro.noop,\n        onSortItemSwitch: Metro.noop,\n        onSearch: Metro.noop,\n        onRowsCountChange: Metro.noop,\n        onDataLoad: Metro.noop,\n        onDataLoaded: Metro.noop,\n        onDataLoadError: Metro.noop,\n        onFilterItemAccepted: Metro.noop,\n        onFilterItemDeclined: Metro.noop,\n        onListCreate: Metro.noop\n    };\n\n    Metro.listSetup = function (options) {\n        ListDefaultConfig = $.extend({}, ListDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroListSetup\"] !== undefined) {\n        Metro.listSetup(window[\"metroListSetup\"]);\n    }\n\n    Metro.Component('list', {\n        init: function( options, elem ) {\n            this._super(elem, options, ListDefaultConfig, {\n                currentPage: 1,\n                pagesCount: 1,\n                filterString: \"\",\n                data: null,\n                activity: null,\n                busy: false,\n                filters: [],\n                wrapperInfo: null,\n                wrapperSearch: null,\n                wrapperRows: null,\n                wrapperPagination: null,\n                filterIndex: null,\n                filtersIndexes: [],\n                itemTemplate: null,\n\n                sort: {\n                    dir: \"asc\",\n                    colIndex: 0\n                },\n\n                header: null,\n                items: []\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var that = this, o = this.options;\n\n            if (o.source) {\n                that._fireEvent(\"data-load\", {\n                    source: o.source\n                });\n\n                fetch(o.source)\n                    .then(Metro.fetch.status)\n                    .then(Metro.fetch.json)\n                    .then(function(data){\n                        that._fireEvent(\"data-loaded\", {\n                            source: o.source,\n                            data: data\n                        });\n                        that._build(data);\n                    })\n                    .catch(function(error){\n                        that._fireEvent(\"data-load-error\", {\n                            source: o.source,\n                            error: error\n                        });\n                    });\n\n            } else {\n                that._build();\n            }\n        },\n\n        _build: function(data){\n            if (Utils.isValue(data)) {\n                this._createItemsFromJSON(data);\n            } else {\n                this._createItemsFromHTML()\n            }\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"list-create\");\n        },\n\n        _createItemsFromHTML: function(){\n            var that = this, element = this.element, o = this.options;\n            var clsTemplateTag = (\"\"+o.clsTemplateTag).toArray(\",\")\n\n            this.items = [];\n\n            $.each(element.children(o.itemTag), function(){\n                var tagChildren = $(this).children(\"*\");\n\n                if (clsTemplateTag.length) {\n                    if (clsTemplateTag.length === 1) {\n                        tagChildren.addClass(clsTemplateTag[0]);\n                    } else {\n                        tagChildren.each(function (i, child) {\n                            $(child).addClass(clsTemplateTag[i] ? clsTemplateTag[i] : clsTemplateTag[clsTemplateTag.length - 1]);\n                        })\n                    }\n                }\n                that.items.push(this);\n            });\n        },\n\n        _createItemsFromJSON: function(source){\n            var that = this, o = this.options;\n            var clsTemplateTag = (\"\"+o.clsTemplateTag).toArray(\",\")\n\n            this.items = [];\n\n            if (Utils.isValue(source.template)) {\n                this.itemTemplate = source.template;\n            }\n\n            if (Utils.isValue(source.header)) {\n                this.header = source.header;\n            }\n\n            if (Utils.isValue(source.data)) {\n                $.each(source.data, function(){\n                    var item = '', row = this;\n                    var li = document.createElement(o.itemTag);\n                    var tpl = that.itemTemplate;\n                    var tagChildren;\n\n                    if (!Utils.isValue(tpl)) {\n                        for (var i in row) {\n                            item += \"<\"+o.defaultTemplateTag+\">\"+row[i]+\"</\"+o.defaultTemplateTag+\">\";\n                        }\n                    } else {\n                        item = Metro.template(tpl, row, {\n                            beginToken: o.templateBeginToken,\n                            endToken: o.templateEndToken\n                        });\n                    }\n\n                    li.innerHTML = item;\n                    tagChildren = $(li).children(\"*\");\n\n                    if (clsTemplateTag.length) {\n                        if (clsTemplateTag.length === 1) {\n                            tagChildren.addClass(clsTemplateTag[0]);\n                        } else {\n                            tagChildren.each(function (i, child) {\n                                $(child).addClass(clsTemplateTag[i] ? clsTemplateTag[i] : clsTemplateTag[clsTemplateTag.length - 1]);\n                            })\n                        }\n                    }\n\n                    that.items.push(li);\n                });\n            }\n        },\n\n        _createTopBlock: function (){\n            var that = this, element = this.element, o = this.options;\n            var top_block = $(\"<div>\").addClass(\"list-top\").addClass(o.clsListTop).insertBefore(element);\n            var search_block, search_input, rows_block, rows_select;\n\n            search_block = Utils.isValue(this.wrapperSearch) ? this.wrapperSearch : $(\"<div>\").addClass(\"list-search-block\").addClass(o.clsSearch).appendTo(top_block);\n\n            search_input = $(\"<input>\").attr(\"type\", \"text\").appendTo(search_block);\n            search_input.input({\n                prepend: o.listSearchTitle\n            });\n\n            if (o.showSearch !== true) {\n                search_block.hide();\n            }\n\n            rows_block = Utils.isValue(this.wrapperRows) ? this.wrapperRows : $(\"<div>\").addClass(\"list-rows-block\").addClass(o.clsItemsCount).appendTo(top_block);\n\n            rows_select = $(\"<select>\").appendTo(rows_block);\n            $.each(o.itemsSteps.toArray(), function () {\n                var option = $(\"<option>\").attr(\"value\", this === \"all\" ? -1 : this).text(this === \"all\" ? o.itemsAllTitle : this).appendTo(rows_select);\n                if (+this === +o.items) option.attr(\"selected\", \"selected\");\n            });\n            rows_select.select({\n                filter: false,\n                prepend: o.listItemsCountTitle,\n                onChange: function (val) {\n                    if (+val === +o.items) return;\n                    o.items = parseInt(val);\n                    that.currentPage = 1;\n                    that._draw();\n\n                    that._fireEvent(\"rows-count-change\", {\n                        val: val\n                    });\n                }\n            });\n\n            if (o.showItemsSteps !== true) {\n                rows_block.hide();\n            }\n\n            return top_block;\n        },\n\n        _createBottomBlock: function (){\n            var element = this.element, o = this.options;\n            var bottom_block = $(\"<div>\").addClass(\"list-bottom\").addClass(o.clsListBottom).insertAfter(element);\n            var info, pagination;\n\n            info = $(\"<div>\").addClass(\"list-info\").addClass(o.clsListInfo).appendTo(bottom_block);\n            if (o.showListInfo !== true) {\n                info.hide();\n            }\n\n            pagination = $(\"<div>\").addClass(\"list-pagination\").addClass(o.clsListPagination).appendTo(bottom_block);\n            if (o.showPagination !== true) {\n                pagination.hide();\n            }\n\n            return bottom_block;\n        },\n\n        _createStructure: function(){\n            var that = this, element = this.element, o = this.options;\n            var list_component;\n            var w_search = $(o.searchWrapper),\n                w_info = $(o.infoWrapper),\n                w_rows = $(o.rowsWrapper),\n                w_paging = $(o.paginationWrapper);\n\n            if (w_search.length > 0) {this.wrapperSearch = w_search;}\n            if (w_info.length > 0) {this.wrapperInfo = w_info;}\n            if (w_rows.length > 0) {this.wrapperRows = w_rows;}\n            if (w_paging.length > 0) {this.wrapperPagination = w_paging;}\n\n            if (!element.parent().hasClass(\"list-component\")) {\n                list_component = $(\"<div>\").addClass(\"list-component\").insertBefore(element);\n                element.appendTo(list_component);\n            } else {\n                list_component = element.parent();\n            }\n\n            list_component.addClass(o.clsComponent);\n\n            this.activity =  $(\"<div>\").addClass(\"list-progress\").appendTo(list_component);\n            $(\"<div>\").activity({\n                type: o.activityType,\n                style: o.activityStyle\n            }).appendTo(this.activity);\n\n            if (o.showActivity !== true) {\n                this.activity.css({\n                    visibility: \"hidden\"\n                })\n            }\n\n            // element.html(\"\").addClass(o.clsList);\n            element.addClass(o.clsList);\n\n            this._createTopBlock();\n            this._createBottomBlock();\n\n            if (Utils.isValue(o.filterString)) {\n                this.filterString = o.filterString;\n            }\n\n            var filter_func;\n\n            if (Utils.isValue(o.filter)) {\n                filter_func = Utils.isFunc(o.filter);\n                if (filter_func === false) {\n                    filter_func = Utils.func(o.filter);\n                }\n                that.filterIndex = that.addFilter(filter_func);\n            }\n\n            if (Utils.isValue(o.filters) && typeof o.filters === 'string') {\n                $.each(o.filters.toArray(), function(){\n                    filter_func = Utils.isFunc(this);\n                    if (filter_func !== false) {\n                        that.filtersIndexes.push(that.addFilter(filter_func));\n                    }\n                });\n            }\n\n            this.currentPage = 1;\n\n            if (o.sortInitial !== false)\n                this.sorting(o.sortClass, o.sortDir, true);\n            else\n                this.draw();\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element;\n            var component = element.parent();\n            var search = component.find(\".list-search-block input\");\n            var customSearch;\n\n            search.on(Metro.events.inputchange, function(){\n                that.filterString = this.value.trim().toLowerCase();\n                if (that.filterString[that.filterString.length - 1] === \":\") {\n                    return ;\n                }\n                that.currentPage = 1;\n                that._draw();\n            });\n\n            if (Utils.isValue(this.wrapperSearch)) {\n                customSearch = this.wrapperSearch.find(\"input\");\n                if (customSearch.length > 0) {\n                    customSearch.on(Metro.events.inputchange, function(){\n                        that.filterString = this.value.trim().toLowerCase();\n                        if (that.filterString[that.filterString.length - 1] === \":\") {\n                            return ;\n                        }\n                        that.currentPage = 1;\n                        that._draw();\n                    });\n                }\n            }\n\n            function pageLinkClick(l){\n                var link = $(l);\n                var item = link.parent();\n\n                if (item.hasClass(\"active\")) {\n                    return ;\n                }\n\n                if (item.hasClass(\"service\")) {\n                    if (link.data(\"page\") === \"prev\") {\n                        that.currentPage--;\n                        if (that.currentPage === 0) {\n                            that.currentPage = 1;\n                        }\n                    } else {\n                        that.currentPage++;\n                        if (that.currentPage > that.pagesCount) {\n                            that.currentPage = that.pagesCount;\n                        }\n                    }\n                } else {\n                    that.currentPage = link.data(\"page\");\n                }\n\n                that._draw();\n            }\n\n            component.on(Metro.events.click, \".pagination .page-link\", function(){\n                pageLinkClick(this)\n            });\n\n            if (Utils.isValue(this.wrapperPagination)) {\n                this.wrapperPagination.on(Metro.events.click, \".pagination .page-link\", function(){\n                    pageLinkClick(this)\n                });\n            }\n        },\n\n        _info: function(start, stop, length){\n            var element = this.element, o = this.options;\n            var component = element.parent();\n            var info = Utils.isValue(this.wrapperInfo) ? this.wrapperInfo : component.find(\".list-info\");\n            var text;\n\n            if (info.length === 0) {\n                return ;\n            }\n\n            if (stop > length) {\n                stop = length;\n            }\n\n            if (this.items.length === 0) {\n                start = stop = length = 0;\n            }\n\n            text = o.listInfoTitle;\n            text = text.replace(\"$1\", start);\n            text = text.replace(\"$2\", stop);\n            text = text.replace(\"$3\", length);\n            info.html(text);\n        },\n\n        _paging: function(length){\n            var element = this.element, o = this.options;\n            var component = element.parent();\n            this.pagesCount = Math.ceil(length / o.items); // Костыль\n            Metro.pagination({\n                length: length,\n                rows: o.items,\n                current: this.currentPage,\n                target: Utils.isValue(this.wrapperPagination) ? this.wrapperPagination : component.find(\".list-pagination\"),\n                claPagination: o.clsPagination,\n                prevTitle: o.paginationPrevTitle,\n                nextTitle: o.paginationNextTitle,\n                distance: o.paginationShortMode === true ? o.paginationDistance : 0\n            });\n        },\n\n        _filter: function(){\n            var that = this,\n                o = this.options,\n                items, i, data, inset, c1, result;\n\n            if (Utils.isValue(this.filterString) || this.filters.length > 0) {\n                items = this.items.filter(function(item){\n                    data = \"\";\n\n                    if (Utils.isValue(o.filterClass)) {\n                        inset = item.getElementsByClassName(o.filterClass);\n\n                        if (inset.length > 0) for (i = 0; i < inset.length; i++) {\n                            data += inset[i].textContent;\n                        }\n                    } else {\n                        data = item.textContent;\n                    }\n\n                    c1 = data.replace(/[\\n\\r]+|[\\s]{2,}/g, ' ').trim().toLowerCase();\n                    result = Utils.isValue(that.filterString) ? c1.indexOf(that.filterString) > -1 : true;\n\n                    if (result === true && that.filters.length > 0) {\n                        for (i = 0; i < that.filters.length; i++) {\n                            if (Utils.exec(that.filters[i], [item]) !== true) {\n                                result = false;\n                                break;\n                            }\n                        }\n                    }\n\n                    if (result) {\n\n                        that._fireEvent(\"filter-item-accepted\", {\n                            item: item\n                        });\n\n                    } else {\n\n                        that._fireEvent(\"filter-item-declined\", {\n                            item: item\n                        });\n\n                    }\n\n                    return result;\n                });\n\n                that._fireEvent(\"search\", {\n                    search: that.filterString,\n                    items: items\n                });\n\n            } else {\n                items = this.items;\n            }\n\n            return items;\n        },\n\n        _draw: function(cb){\n            var element = this.element, o = this.options;\n            var i;\n            var start = o.items === -1 ? 0 : o.items * (this.currentPage - 1),\n                stop = o.items === -1 ? this.items.length - 1 : start + o.items - 1;\n            var items;\n\n            items = this._filter();\n\n            element.children(o.itemTag).remove();\n\n            for (i = start; i <= stop; i++) {\n                if (Utils.isValue(items[i])) {\n                    $(items[i]).addClass(o.clsListItem).appendTo(element);\n                }\n\n                this._fireEvent(\"draw-item\", {\n                    item: items[i]\n                });\n\n            }\n\n            this._info(start + 1, stop + 1, items.length);\n            this._paging(items.length);\n\n            this.activity.hide();\n\n            this._fireEvent(\"draw\");\n\n            if (cb !== undefined) {\n                Utils.exec(cb, [element], element[0])\n            }\n        },\n\n        _getItemContent: function(item){\n            var o = this.options, $item = $(item);\n            var i, inset, data;\n            var format, formatMask = Utils.isValue($item.data(\"formatMask\")) ? $item.data(\"formatMask\") : null;\n\n            if (Utils.isValue(o.sortClass)) {\n                data = \"\";\n                inset = $(item).find(\".\"+o.sortClass);\n\n                if (inset.length > 0) for (i = 0; i < inset.length; i++) {\n                    data += inset[i].textContent;\n                }\n                format = inset.length > 0 ? inset[0].getAttribute(\"data-format\") : \"\";\n            } else {\n                data = item.textContent;\n                format = item.getAttribute(\"data-format\");\n            }\n\n            data = (\"\"+data).toLowerCase().replace(/[\\n\\r]+|[\\s]{2,}/g, ' ').trim();\n\n            if (Utils.isValue(format)) {\n\n                if (['number', 'int', 'integer', 'float', 'money'].indexOf(format) !== -1 && (o.thousandSeparator !== \",\" || o.decimalSeparator !== \".\" )) {\n                    data = Utils.parseNumber(data, o.thousandSeparator, o.decimalSeparator);\n                }\n\n                switch (format) {\n                    case \"date\": data = formatMask ? Datetime.from(data, formatMask, o.locale) : datetime(data); break;\n                    case \"number\": data = Number(data); break;\n                    case \"int\":\n                    case \"integer\": data = parseInt(data); break;\n                    case \"float\": data = parseFloat(data); break;\n                    case \"money\": data = Utils.parseMoney(data); break;\n                    case \"card\": data = Utils.parseCard(data); break;\n                    case \"phone\": data = Utils.parsePhone(data); break;\n                }\n            }\n\n            return data;\n        },\n\n        deleteItem: function(value){\n            var i, deleteIndexes = [], item;\n            var is_func = Utils.isFunc(value);\n\n            for (i = 0; i < this.items.length; i++) {\n                item = this.items[i];\n\n                if (is_func) {\n                    if (Utils.exec(value, [item])) {\n                        deleteIndexes.push(i);\n                    }\n                } else {\n                    if (item.textContent.includes(value)) {\n                        deleteIndexes.push(i);\n                    }\n                }\n            }\n\n            this.items = Utils.arrayDeleteByMultipleKeys(this.items, deleteIndexes);\n\n            return this;\n        },\n\n        draw: function(){\n            return this._draw();\n        },\n\n        sorting: function(source, dir, redraw){\n            var that = this, o = this.options;\n\n            if (Utils.isValue(source)) {\n                o.sortClass = source;\n            }\n            if (Utils.isValue(dir) && [\"asc\", \"desc\"].indexOf(dir) > -1) {\n                o.sortDir= dir;\n            }\n\n            this._fireEvent(\"sort-start\", {\n                items: this.items\n            });\n\n            this.items.sort(function(a, b){\n                var c1 = that._getItemContent(a);\n                var c2 = that._getItemContent(b);\n                var result = 0;\n\n                if (c1 < c2) {\n                    result = o.sortDir === \"asc\" ? -1 : 1;\n                }\n                if (c1 > c2) {\n                    result = o.sortDir === \"asc\" ? 1 : -1;\n                }\n\n                if (result !== 0) {\n\n                    that._fireEvent(\"sort-item-switch\", {\n                        a: a,\n                        b: b,\n                        result: result\n                    });\n                }\n\n                return result;\n            });\n\n            this._fireEvent(\"sort-stop\", {\n                items: this.items\n            })\n\n            if (redraw === true) {\n                this._draw();\n            }\n\n            return this;\n        },\n\n        filter: function(val){\n            this.filterString = val.trim().toLowerCase();\n            this.currentPage = 1;\n            this._draw();\n        },\n\n        loadData: function(source){\n            var that = this, element = this.element, o = this.options;\n\n            if (Utils.isValue(source) !== true) {\n                return ;\n            }\n\n            o.source = source;\n\n            this._fireEvent(\"data-load\", {\n                source: o.source\n            });\n\n            fetch(o.source)\n                .then(Metro.fetch.status)\n                .then(Metro.fetch.json)\n                .then(function(data){\n                    that._fireEvent(\"data-loaded\", {\n                        source: o.source,\n                        data: data\n                    });\n\n                    that._createItemsFromJSON(data);\n\n                    element.html(\"\");\n\n                    if (Utils.isValue(o.filterString)) {\n                        that.filterString = o.filterString;\n                    }\n\n                    var filter_func;\n\n                    if (Utils.isValue(o.filter)) {\n                        filter_func = Utils.isFunc(o.filter);\n                        if (filter_func === false) {\n                            filter_func = Utils.func(o.filter);\n                        }\n                        that.filterIndex = that.addFilter(filter_func);\n                    }\n\n                    if (Utils.isValue(o.filters) && typeof o.filters === 'string') {\n                        $.each(o.filters.toArray(), function(){\n                            filter_func = Utils.isFunc(this);\n                            if (filter_func !== false) {\n                                that.filtersIndexes.push(that.addFilter(filter_func));\n                            }\n                        });\n                    }\n\n                    that.currentPage = 1;\n\n                    that.sorting(o.sortClass, o.sortDir, true);\n                })\n                .catch(function(error){\n                    that._fireEvent(\"data-load-error\", {\n                        source: o.source,\n                        error: error\n                    });\n                });\n\n        },\n\n        next: function(){\n            if (this.items.length === 0) return ;\n            this.currentPage++;\n            if (this.currentPage > this.pagesCount) {\n                this.currentPage = this.pagesCount;\n                return ;\n            }\n            this._draw();\n        },\n\n        prev: function(){\n            if (this.items.length === 0) return ;\n            this.currentPage--;\n            if (this.currentPage === 0) {\n                this.currentPage = 1;\n                return ;\n            }\n            this._draw();\n        },\n\n        first: function(){\n            if (this.items.length === 0) return ;\n            this.currentPage = 1;\n            this._draw();\n        },\n\n        last: function(){\n            if (this.items.length === 0) return ;\n            this.currentPage = this.pagesCount;\n            this._draw();\n        },\n\n        page: function(num){\n            if (num <= 0) {\n                num = 1;\n            }\n\n            if (num > this.pagesCount) {\n                num = this.pagesCount;\n            }\n\n            this.currentPage = num;\n            this._draw();\n        },\n\n        addFilter: function(f, redraw){\n            var func = Utils.isFunc(f);\n            if (func === false) {\n                return ;\n            }\n            this.filters.push(func);\n\n            if (redraw === true) {\n                this.currentPage = 1;\n                this.draw();\n            }\n\n            return this.filters.length - 1;\n        },\n\n        removeFilter: function(key, redraw){\n            Utils.arrayDeleteByKey(this.filters, key);\n            if (redraw === true) {\n                this.currentPage = 1;\n                this.draw();\n            }\n            return this;\n        },\n\n        removeFilters: function(redraw){\n            this.filters = [];\n            if (redraw === true) {\n                this.currentPage = 1;\n                this.draw();\n            }\n        },\n\n        getFilters: function(){\n            return this.filters;\n        },\n\n        getFilterIndex: function(){\n            return this.filterIndex;\n        },\n\n        getFiltersIndexes: function(){\n            return this.filtersIndexes;\n        },\n\n        changeAttribute: function(attributeName){\n            var that = this, element = this.element, o = this.options;\n\n            var changeSortDir = function(){\n                var dir = element.attr(\"data-sort-dir\");\n                if (!Utils.isValue(dir)) {\n                    return ;\n                }\n                o.sortDir = dir;\n                that.sorting(o.sortClass, o.sortDir, true);\n            };\n\n            var changeSortClass = function(){\n                var target = element.attr(\"data-sort-source\");\n                if (!Utils.isValue(target)) {\n                    return ;\n                }\n                o.sortClass = target;\n                that.sorting(o.sortClass, o.sortDir, true);\n            };\n\n            var changeFilterString = function(){\n                var filter = element.attr(\"data-filter-string\");\n                if (!Utils.isValue(filter)) {\n                    return ;\n                }\n                o.filterString = filter;\n                that.filter(o.filterString);\n            };\n\n            switch (attributeName) {\n                case \"data-sort-dir\": changeSortDir(); break;\n                case \"data-sort-source\": changeSortClass(); break;\n                case \"data-filter-string\": changeFilterString(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n            var component = element.parent();\n            var search = component.find(\".list-search-block input\");\n            var customSearch;\n\n            search.off(Metro.events.inputchange);\n            if (Utils.isValue(this.wrapperSearch)) {\n                customSearch = this.wrapperSearch.find(\"input\");\n                if (customSearch.length > 0) {\n                    customSearch.off(Metro.events.inputchange);\n                }\n            }\n\n            component.off(Metro.events.click, \".pagination .page-link\");\n\n            if (Utils.isValue(this.wrapperPagination)) {\n                this.wrapperPagination.off(Metro.events.click, \".pagination .page-link\");\n            }\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var ListViewDefaultConfig = {\n        listviewDeferred: 0,\n        selectable: false,\n        checkStyle: 1,\n        duration: 100,\n        view: Metro.listView.LIST,\n        selectCurrent: true,\n        structure: {},\n        onNodeInsert: Metro.noop,\n        onNodeDelete: Metro.noop,\n        onNodeClean: Metro.noop,\n        onCollapseNode: Metro.noop,\n        onExpandNode: Metro.noop,\n        onGroupNodeClick: Metro.noop,\n        onNodeClick: Metro.noop,\n        onNodeDblclick: Metro.noop,\n        onListViewCreate: Metro.noop\n    };\n\n    Metro.listViewSetup = function (options) {\n        ListViewDefaultConfig = $.extend({}, ListViewDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroListViewSetup\"] !== undefined) {\n        Metro.listViewSetup(window[\"metroListViewSetup\"]);\n    }\n\n    Metro.Component('listview', {\n        init: function( options, elem ) {\n            this._super(elem, options, ListViewDefaultConfig);\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createView();\n            this._createEvents();\n\n            this._fireEvent(\"listview-create\", {\n                element: element\n            });\n        },\n\n        _createIcon: function(data){\n            var icon, src;\n\n            src = Utils.isTag(data) ? $(data) : $(\"<img>\").attr(\"src\", data);\n            icon = $(\"<span>\").addClass(\"icon\");\n            icon.html(src.outerHTML());\n\n            return icon;\n        },\n\n        _createCaption: function(data){\n            return $(\"<div>\").addClass(\"caption\").html(data);\n        },\n\n        _createContent: function(data){\n            return $(\"<div>\").addClass(\"content\").html(data);\n        },\n\n        _createToggle: function(){\n            return $(\"<span>\").addClass(\"node-toggle\");\n        },\n\n        _createNode: function(data){\n            var that = this, o = this.options;\n            var node;\n\n            node = $(\"<li>\");\n\n            if (data.caption !== undefined || data.content !== undefined ) {\n                var d = $(\"<div>\").addClass(\"data\");\n                node.prepend(d);\n                if (data.caption !== undefined) d.append(that._createCaption(data.caption));\n                if (data.content !== undefined) d.append(that._createContent(data.content));\n            }\n\n            if (data.icon !== undefined) {\n                node.prepend(this._createIcon(data.icon));\n            }\n\n            if (Utils.objectLength(o.structure) > 0) $.each(o.structure, function(key, val){\n                if (data[key] !== undefined) {\n                    $(\"<div>\").addClass(\"node-data item-data-\"+key).addClass(data[val]).html(data[key]).appendTo(node);\n                }\n            });\n\n            return node;\n        },\n\n        _createView: function(){\n            var that = this, element = this.element, o = this.options;\n            var nodes = element.find(\"li\");\n            var struct_length = Utils.objectLength(o.structure);\n\n            element.addClass(\"listview\");\n            element.find(\"ul\").addClass(\"listview\");\n\n            $.each(nodes, function(){\n                var node = $(this);\n\n                if (node.data(\"caption\") !== undefined || node.data(\"content\") !== undefined) {\n                    var data = $(\"<div>\").addClass(\"data\");\n                    node.prepend(data);\n                    if (node.data(\"caption\") !== undefined) data.append(that._createCaption(node.data(\"caption\")));\n                    if (node.data(\"content\") !== undefined) data.append(that._createContent(node.data(\"content\")));\n                }\n\n                if (node.data('icon') !== undefined) {\n                    node.prepend(that._createIcon(node.data('icon')));\n                }\n\n                if (node.children(\"ul\").length > 0) {\n                    node.addClass(\"node-group\");\n                    node.append(that._createToggle());\n                    if (node.data(\"collapsed\") !== true) node.addClass(\"expanded\");\n                } else {\n                    node.addClass(\"node\");\n                }\n\n                if (node.hasClass(\"node\")) {\n                    var cb = $(\"<input type='checkbox' data-role='checkbox' data-style='\"+o.checkStyle+\"'>\");\n                    cb.data(\"node\", node);\n                    node.prepend(cb);\n                }\n\n                if (struct_length > 0) $.each(o.structure, function(key){\n                    if (node.data(key) !== undefined) {\n                        $(\"<div>\").addClass(\"node-data item-data-\"+key).addClass(node.data(key)).html(node.data(key)).appendTo(node);\n                    }\n                });\n            });\n\n            this.toggleSelectable();\n\n            this.view(o.view);\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n\n            element.on(Metro.events.dblclick, \".node\", function(){\n                var node = $(this);\n                that._fireEvent(\"node-dblclick\", {\n                    node: node\n                });\n            });\n\n            element.on(Metro.events.click, \".node\", function(){\n                var node = $(this);\n                element.find(\".node\").removeClass(\"current\");\n                node.toggleClass(\"current\");\n                if (o.selectCurrent === true) {\n                    element.find(\".node\").removeClass(\"current-select\");\n                    node.toggleClass(\"current-select\");\n                }\n                that._fireEvent(\"node-click\", {\n                    node: node\n                });\n            });\n\n            element.on(Metro.events.click, \".node-toggle\", function(){\n                var node = $(this).closest(\"li\");\n                that.toggleNode(node);\n            });\n\n            element.on(Metro.events.click, \".node-group > .data > .caption\", function(){\n                var node = $(this).closest(\"li\");\n                element.find(\".node-group\").removeClass(\"current-group\");\n                node.addClass(\"current-group\");\n\n                that._fireEvent(\"group-node-click\", {\n                    node: node\n                });\n\n            });\n\n            element.on(Metro.events.dblclick, \".node-group > .data > .caption\", function(){\n                var node = $(this).closest(\"li\");\n                that.toggleNode(node);\n\n                that._fireEvent(\"node-dbl-click\", {\n                    node: node\n                });\n            });\n        },\n\n        view: function(v){\n            var element = this.element, o = this.options;\n\n            if (v === undefined) {\n                return o.view;\n            }\n\n            o.view = v;\n\n            $.each(Metro.listView, function(i, v){\n                element.removeClass(\"view-\"+v);\n                element.find(\"ul\").removeClass(\"view-\"+v);\n            });\n\n            element.addClass(\"view-\" + o.view);\n            element.find(\"ul\").addClass(\"view-\" + o.view);\n        },\n\n        toggleNode: function(node){\n            var o = this.options;\n            var func;\n\n            node=$(node);\n\n            if (!node.hasClass(\"node-group\")) {\n                return ;\n            }\n\n            node.toggleClass(\"expanded\");\n\n            func = node.hasClass(\"expanded\") !== true ? \"slideUp\" : \"slideDown\";\n\n            this._fireEvent(\"collapse-node\", {\n                node: node\n            });\n\n            node.children(\"ul\")[func](o.duration);\n        },\n\n        toggleSelectable: function(){\n            var element = this.element, o = this.options;\n            var func = o.selectable === true ? \"addClass\" : \"removeClass\";\n            element[func](\"selectable\");\n            element.find(\"ul\")[func](\"selectable\");\n        },\n\n        add: function(node, data){\n            var element = this.element, o = this.options;\n            var target;\n            var new_node;\n            var toggle;\n\n            if (node === null) {\n                target = element;\n            } else {\n\n                node=$(node);\n\n                if (!node.hasClass(\"node-group\")) {\n                    return ;\n                }\n\n                target = node.children(\"ul\");\n                if (target.length === 0) {\n                    target = $(\"<ul>\").addClass(\"listview\").addClass(\"view-\"+o.view).appendTo(node);\n                    toggle = this._createToggle();\n                    toggle.appendTo(node);\n                    node.addClass(\"expanded\");\n                }\n            }\n\n            new_node = this._createNode(data);\n\n            new_node.addClass(\"node\").appendTo(target);\n\n            var cb = $(\"<input type='checkbox'>\");\n            cb.data(\"node\", new_node);\n            new_node.prepend(cb);\n            Metro.makePlugin(cb, \"checkbox\", {});\n\n            this._fireEvent(\"node-insert\", {\n                newNode: new_node,\n                parentNode: node,\n                list: target\n            });\n\n            return new_node;\n        },\n\n        addGroup: function(data){\n            var element = this.element, o = this.options;\n            var node;\n\n            delete data['icon'];\n\n            node = this._createNode(data);\n            node.addClass(\"node-group\").appendTo(element);\n            node.append(this._createToggle());\n            node.addClass(\"expanded\");\n            node.append($(\"<ul>\").addClass(\"listview\").addClass(\"view-\"+o.view));\n\n            this._fireEvent(\"node-insert\", {\n                newNode: node,\n                parentNode: null,\n                list: element\n            })\n\n            return node;\n        },\n\n        insertBefore: function(node, data){\n            var new_node, parent_node, list;\n\n            node=$(node);\n\n            if (!node.length) {return;}\n\n            new_node = this._createNode(data);\n            new_node.addClass(\"node\").insertBefore(node);\n            parent_node = new_node.closest(\".node\");\n            list = new_node.closest(\"ul\");\n\n            this._fireEvent(\"node-insert\", {\n                newNode: new_node,\n                parentNode: parent_node,\n                list: list\n            });\n\n            return new_node;\n        },\n\n        insertAfter: function(node, data){\n            var new_node, parent_node, list;\n\n            node=$(node);\n\n            if (!node.length) {return;}\n\n            new_node = this._createNode(data);\n            new_node.addClass(\"node\").insertAfter(node);\n            parent_node = new_node.closest(\".node\");\n            list = new_node.closest(\"ul\");\n\n            this._fireEvent(\"node-insert\", {\n                newNode: new_node,\n                parentNode: parent_node,\n                list: list\n            });\n\n            return new_node;\n        },\n\n        del: function(node){\n            var element = this.element;\n\n            node=$(node);\n\n            if (!node.length) {return;}\n\n            var parent_list = node.closest(\"ul\");\n            var parent_node = parent_list.closest(\"li\");\n            node.remove();\n            if (parent_list.children().length === 0 && !parent_list.is(element)) {\n                parent_list.remove();\n                parent_node.removeClass(\"expanded\");\n                parent_node.children(\".node-toggle\").remove();\n            }\n\n            this._fireEvent(\"node-delete\", {\n                node: node\n            });\n        },\n\n        clean: function(node){\n            node=$(node);\n\n            if (!node.length) {return;}\n\n            node.children(\"ul\").remove();\n            node.removeClass(\"expanded\");\n            node.children(\".node-toggle\").remove();\n\n            this._fireEvent(\"node-clean\", {\n                node: node\n            });\n        },\n\n        getSelected: function(){\n            var element = this.element;\n            var nodes = [];\n\n            $.each(element.find(\":checked\"), function(){\n                var check = $(this);\n                nodes.push(check.closest(\".node\")[0])\n            });\n\n            return nodes;\n        },\n\n        clearSelected: function(){\n            this.element.find(\":checked\").prop(\"checked\", false);\n            this.element.trigger('change');\n        },\n\n        selectAll: function(mode){\n            this.element.find(\".node > .checkbox input\").prop(\"checked\", mode !== false);\n            this.element.trigger('change');\n        },\n\n        selectByAttribute: function(attributeName, attributeValue, select) {\n            if (select !== false) {\n                select = true;\n            }\n            this.element.find('li[' + attributeName + '=\"' + attributeValue + '\"]' + ' > .checkbox input').prop(\"checked\", select);\n            this.element.trigger('change');\n        },\n\n        changeAttribute: function(attributeName){\n            var that = this, element = this.element, o = this.options;\n\n            var changeView = function(){\n                var new_view = \"view-\"+element.attr(\"data-view\");\n                that.view(new_view);\n            };\n\n            var changeSelectable = function(){\n                o.selectable = JSON.parse(element.attr(\"data-selectable\")) === true;\n                that.toggleSelectable();\n            };\n\n            switch (attributeName) {\n                case \"data-view\": changeView(); break;\n                case \"data-selectable\": changeSelectable(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n\n            element.off(Metro.events.click, \".node\");\n            element.off(Metro.events.click, \".node-toggle\");\n            element.off(Metro.events.click, \".node-group > .data > .caption\");\n            element.off(Metro.events.dblclick, \".node-group > .data > .caption\");\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var MarqueeDefaultConfig = {\n        items: null,\n        backgroundColor: \"#fff\",\n        color: \"#000\",\n        borderSize: 0,\n        borderColor: \"transparent\",\n        loop: true,\n        height: \"auto\",\n        width: \"auto\",\n        duration: 10000,\n        direction: \"left\",\n        ease: \"linear\",\n        mode: \"default\", // default || accent\n        accentPause: 2000,\n        firstPause: 1000,\n        stopOnHover: false,\n\n        clsMarquee: \"\",\n        clsMarqueeItem: \"\",\n\n        onMarqueeItem: Metro.noop,\n        onMarqueeItemComplete: Metro.noop,\n        onMarqueeComplete: Metro.noop,\n        onMarqueeCreate: Metro.noop\n    };\n\n    Metro.marqueeSetup = function (options) {\n        MarqueeDefaultConfig = $.extend({}, MarqueeDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroMarqueeSetup\"] !== undefined) {\n        Metro.marqueeSetup(window[\"metroMarqueeSetup\"]);\n    }\n\n    Metro.Component('marquee', {\n        init: function( options, elem ) {\n            this._super(elem, options, MarqueeDefaultConfig, {\n                // define instance vars here\n                items: [],\n                running: false,\n                current: -1\n            });\n            return this;\n        },\n\n        _create: function(){\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent('marquee-create');\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n\n            element.addClass(\"marquee\").addClass(o.clsMarquee);\n\n            element.css({\n                height: o.height,\n                width: o.width,\n                backgroundColor: Metro.colors.isColor(o.backgroundColor) ? o.backgroundColor : MarqueeDefaultConfig.backgroundColor,\n                color: Metro.colors.isColor(o.color) ? o.color : MarqueeDefaultConfig.color,\n                borderStyle: \"solid\",\n                borderWidth: o.borderSize,\n                borderColor: Metro.colors.isColor(o.borderColor) ? o.borderColor : MarqueeDefaultConfig.borderColor\n            });\n\n            this.setItems(o.items);\n\n            if (this.items.length) {\n                this.current = 0;\n            }\n\n            if (this.items.length) this.start();\n        },\n\n        setItems: function(items, replace){\n            var element = this.element, o = this.options;\n            var dir = o.direction.toLowerCase(), h;\n\n            items = Metro.utils.isObject(items);\n\n            if (items && replace) {\n                element.clear();\n            }\n\n            if (items !== false) {\n                $.each(items, function(){\n                    var el = $(this);\n\n                    if (el.length)\n                        el.appendTo(element);\n                    else\n                        element.append( $(\"<div>\").html(this) );\n                })\n            }\n\n            this.items = element.children(\"*\").addClass(\"marquee__item\").addClass(o.clsMarqueeItem).items();\n\n            if (dir === \"left\" || dir === \"right\") {\n                $(this.items).addClass(\"moveLeftRight\");\n            } else {\n                $(this.items).addClass(\"moveUpDown\");\n            }\n\n            if (o.height === \"auto\") {\n                h = 0;\n                $(this.items).each(function(){\n                    if ( +$(this).outerHeight(true) > h) {\n                        h = +$(this).outerHeight(true);\n                    }\n                });\n                element.height(h);\n            }\n            return this\n        },\n\n\n        setItem: function(index, value){\n            var target = $(this.items[index]), h, o = this.options, element = this.element;\n\n            if (!target.length) {\n                return;\n            }\n\n            target.html(value)\n\n            if (o.height === \"auto\") {\n                h = 0;\n                $(this.items).each(function(){\n                    if ( +$(this).outerHeight(true) > h) {\n                        h = +$(this).outerHeight(true);\n                    }\n                });\n                element.height(h);\n            }\n            return this\n        },\n\n        addItem: function(item, index){\n            var element = this.element;\n            var ins, $item = $(item), trg;\n\n            ins = $item.length ? $item : $(\"<div>\").html(item);\n\n            if (Metro.utils.isNull(index)) {\n                element.append(ins);\n            } else {\n                trg = this.items[index]\n                if (trg) {\n                    ins.insertBefore(trg);\n                } else {\n                    element.append(ins);\n                }\n            }\n            return this\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n\n            element.on(Metro.events.enter, function(){\n                if (o.stopOnHover)\n                    $.pauseAll(that.items);\n            })\n\n            element.on(Metro.events.leave, function(){\n                if (o.stopOnHover)\n                    $.resumeAll(that.items);\n            })\n        },\n\n        start: function(){\n            var element = this.element, o = this.options;\n            var chain = [], dir = o.direction.toLowerCase(), mode = o.mode.toLowerCase();\n            var magic = 20;\n            var ease = o.ease.toArray(\",\");\n            var dur = +o.duration;\n\n            if (mode === \"default\") {\n                $.each(this.items, function (i) {\n                    var el = $(this);\n                    var draw;\n\n                    if (el.attr(\"data-direction\")) {\n                        dir = el.attr(\"data-direction\").toLowerCase();\n                    }\n\n                    if (el.attr(\"data-duration\")) {\n                        dur = +el.attr(\"data-duration\");\n                    }\n\n                    if ([\"left\", \"right\"].indexOf(dir) > -1) {\n                        draw = {\n                            left: dir === \"left\" ? [element.width(), -$(this).width() - magic] : [-$(this).width() - magic, element.width()]\n                        }\n                    } else {\n                        draw = {\n                            top: dir === \"up\" ? [element.height(), -$(this).height() - magic] : [-$(this).height() - magic, element.height()]\n                        }\n                    }\n\n                    chain.push({\n                        el: this,\n                        draw: draw,\n                        dur: dur,\n                        ease: \"linear\",\n                        defer: i === 0 ? +o.firstPause : 0\n                    });\n                });\n            } else {\n                $.each(this.items, function(i){\n                    var el = $(this);\n                    var half, draw1, draw2;\n                    dur = o.duration / 2;\n\n                    if (el.attr(\"data-direction\")) {\n                        dir = el.attr(\"data-direction\").toLowerCase();\n                    }\n\n                    if (el.attr(\"data-duration\")) {\n                        dur = +el.attr(\"data-duration\") / 2;\n                    }\n\n                    if (el.attr(\"data-ease\")) {\n                        ease = el.attr(\"data-ease\").toArray(\",\");\n                    }\n\n                    if ([\"left\", \"right\"].indexOf(dir) > -1) {\n                        half = element.width() / 2 - $(this).width() / 2;\n                        draw1 = {\n                            left: dir === \"left\" ? [element.width(), half] : [-$(this).width() - magic, half]\n                        }\n                        draw2 = {\n                            left: dir === \"left\" ? [half, -$(this).width() - magic] : [half, element.width() + magic]\n                        }\n                    } else {\n                        half = element.height() / 2 - $(this).height() / 2;\n                        draw1 = {\n                            top: dir === \"up\" ? [element.height(), half] : [-$(this).height() - magic, half]\n                        }\n                        draw2 = {\n                            top: dir === \"up\" ? [half, -$(this).height() - magic] : [half, element.height() + magic]\n                        }\n                    }\n\n                    chain.push({\n                        el: this,\n                        draw: draw1,\n                        dur: dur,\n                        ease: ease[0] || \"linear\",\n                        defer: i === 0 ? +o.firstPause : 0\n                    });\n                    chain.push({\n                        el: this,\n                        draw: draw2,\n                        dur: dur,\n                        ease: ease[1] ? ease[1] : ease[0] ? ease[0] : \"linear\",\n                        defer: +o.accentPause\n                    });\n                });\n            }\n\n            this.running = true;\n\n            $.chain(chain, {\n                loop: o.loop,\n                onChainItem: Metro.utils.isFunc(o.onMarqueeItem),\n                onChainItemComplete: Metro.utils.isFunc(o.onMarqueeItemComplete),\n                onChainComplete: Metro.utils.isFunc(o.onMarqueeComplete)\n            });\n            return this\n        },\n\n        stop: function(){\n            this.running = false;\n            $.stopAll(this.items);\n            return this\n        },\n\n        changeAttribute: function(){\n        },\n\n        destroy: function(){\n            this.element.remove();\n        }\n    });\n}(Metro, m4q));\n\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var MasterDefaultConfig = {\n        masterDeferred: 0,\n        effect: \"slide\", // slide, fade, switch, slowdown, custom\n        effectFunc: \"linear\",\n        duration: METRO_ANIMATION_DURATION,\n\n        controlPrev: \"<span class='default-icon-left-arrow'></span>\",\n        controlNext: \"<span class='default-icon-right-arrow'></span>\",\n        controlTitle: \"Master, page $1 of $2\",\n        backgroundImage: \"\",\n\n        clsMaster: \"\",\n        clsControls: \"\",\n        clsControlPrev: \"\",\n        clsControlNext: \"\",\n        clsControlTitle: \"\",\n        clsPages: \"\",\n        clsPage: \"\",\n\n        onBeforePage: Metro.noop_true,\n        onBeforeNext: Metro.noop_true,\n        onBeforePrev: Metro.noop_true,\n        onNextPage: Metro.noop,\n        onPrevPage: Metro.noop,\n        onMasterCreate: Metro.noop\n    };\n\n    Metro.masterSetup = function (options) {\n        MasterDefaultConfig = $.extend({}, MasterDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroMasterSetup\"] !== undefined) {\n        Metro.masterSetup(window[\"metroMasterSetup\"]);\n    }\n\n    Metro.Component('master', {\n        init: function( options, elem ) {\n            this._super(elem, options, MasterDefaultConfig, {\n                pages: [],\n                currentIndex: 0,\n                isAnimate: false,\n                id: Utils.elementId(\"master\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n\n            element.addClass(\"master\").addClass(o.clsMaster);\n            element.css({\n                backgroundImage: \"url(\"+o.backgroundImage+\")\"\n            });\n\n            this._createControls();\n            this._createPages();\n            this._createEvents();\n\n            this._fireEvent(\"master-create\", {\n                element: element\n            });\n        },\n\n        _createControls: function(){\n            var element = this.element, o = this.options;\n            var controls_position = ['top', 'bottom'];\n            var controls, title, pages = element.find(\".page\");\n\n            title = String(o.controlTitle).replace(\"$1\", \"1\");\n            title = String(title).replace(\"$2\", pages.length);\n\n            $.each(controls_position, function(){\n                controls = $(\"<div>\").addClass(\"controls controls-\"+this).addClass(o.clsControls).appendTo(element);\n                $(\"<span>\").addClass(\"prev\").addClass(o.clsControlPrev).html(o.controlPrev).appendTo(controls);\n                $(\"<span>\").addClass(\"next\").addClass(o.clsControlNext).html(o.controlNext).appendTo(controls);\n                $(\"<span>\").addClass(\"title\").addClass(o.clsControlTitle).html(title).appendTo(controls);\n            });\n\n            this._enableControl(\"prev\", false);\n        },\n\n        _enableControl: function(type, state){\n            var control = this.element.find(\".controls .\" + type);\n            if (state === true) {\n                control.removeClass(\"disabled\");\n            } else {\n                control.addClass(\"disabled\");\n            }\n        },\n\n        _setTitle: function(){\n            var title = this.element.find(\".controls .title\");\n\n            var title_str = this.options.controlTitle.replace(\"$1\", this.currentIndex + 1);\n            title_str = title_str.replace(\"$2\", String(this.pages.length));\n\n            title.html(title_str);\n        },\n\n        _createPages: function(){\n            var that = this, element = this.element, o = this.options;\n            var pages = element.find(\".pages\");\n            var page = element.find(\".page\");\n\n            if (pages.length === 0) {\n                pages = $(\"<div>\").addClass(\"pages\").appendTo(element);\n            }\n\n            pages.addClass(o.clsPages);\n\n            $.each(page, function(){\n                var p = $(this);\n                if (p.data(\"cover\") !== undefined) {\n                    element.css({\n                        backgroundImage: \"url(\"+p.data('cover')+\")\"\n                    });\n                } else {\n                    element.css({\n                        backgroundImage: \"url(\"+o.backgroundImage+\")\"\n                    });\n                }\n\n                p.css({\n                    left: \"100%\"\n                });\n\n                p.addClass(o.clsPage).hide(0);\n\n                that.pages.push(p);\n            });\n\n            page.appendTo(pages);\n\n            this.currentIndex = 0;\n            if (this.pages[this.currentIndex] !== undefined) {\n                if (this.pages[this.currentIndex].data(\"cover\") !== undefined ) {\n                    element.css({\n                        backgroundImage: \"url(\"+this.pages[this.currentIndex].data('cover')+\")\"\n                    });\n                }\n                this.pages[this.currentIndex].css(\"left\", \"0\").show(0);\n                setTimeout(function(){\n                    pages.css({\n                        height: that.pages[0].outerHeight(true) + 2\n                    });\n                }, 0);\n            }\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n\n            element.on(Metro.events.click, \".controls .prev\", function(){\n                if (that.isAnimate === true) {\n                    return ;\n                }\n                if (\n                    Utils.exec(o.onBeforePrev, [that.currentIndex, that.pages[that.currentIndex], element]) === true &&\n                    Utils.exec(o.onBeforePage, [\"prev\", that.currentIndex, that.pages[that.currentIndex], element]) === true\n                ) {\n                    that.prev();\n                }\n            });\n\n            element.on(Metro.events.click, \".controls .next\", function(){\n                if (that.isAnimate === true) {\n                    return ;\n                }\n                if (\n                    Utils.exec(o.onBeforeNext, [that.currentIndex, that.pages[that.currentIndex], element]) === true &&\n                    Utils.exec(o.onBeforePage, [\"next\", that.currentIndex, that.pages[that.currentIndex], element]) === true\n                ) {\n                    that.next();\n                }\n            });\n\n            $(window).on(Metro.events.resize, function(){\n                element.find(\".pages\").height(that.pages[that.currentIndex].outerHeight(true) + 2);\n            }, {ns: this.id});\n        },\n\n        _slideToPage: function(index){\n            var current, next, to;\n\n            if (this.pages[index] === undefined) {\n                return ;\n            }\n\n            if (this.currentIndex === index) {\n                return ;\n            }\n\n            to = index > this.currentIndex ? \"next\" : \"prev\";\n            current = this.pages[this.currentIndex];\n            next = this.pages[index];\n\n            this.currentIndex = index;\n\n            this._effect(current, next, to);\n        },\n\n        _slideTo: function(to){\n            var current, next, forward = to.toLowerCase() === 'next';\n\n            current = this.pages[this.currentIndex];\n\n            if (forward ) {\n                if (this.currentIndex + 1 >= this.pages.length) {\n                    return ;\n                }\n                this.currentIndex++;\n            } else {\n                if (this.currentIndex - 1 < 0) {\n                    return ;\n                }\n                this.currentIndex--;\n            }\n\n            next = this.pages[this.currentIndex];\n\n            this._fireEvent(forward ? \"next-page\" : \"prev-page\", {\n                current: current,\n                next: next,\n                forward: forward\n            });\n\n            this._effect(current, next, to);\n        },\n\n        _effect: function(current, next, to){\n            var that = this, element = this.element, o = this.options;\n            var out = element.width();\n            var pages = element.find(\".pages\");\n\n            this._setTitle();\n\n            if (this.currentIndex === this.pages.length - 1) {\n                this._enableControl(\"next\", false);\n            } else {\n                this._enableControl(\"next\", true);\n            }\n\n            if (this.currentIndex === 0) {\n                this._enableControl(\"prev\", false);\n            } else {\n                this._enableControl(\"prev\", true);\n            }\n\n            setTimeout(function(){\n                that.isAnimate = true;\n                pages.animate({\n                    draw: {\n                        height: next.outerHeight(true) + 2\n                    }\n                });\n            },0);\n\n            pages.css(\"overflow\", \"hidden\");\n\n            function finish(){\n                if (next.data(\"cover\") !== undefined) {\n                    element.css({\n                        backgroundImage: \"url(\"+next.data('cover')+\")\"\n                    });\n                } else {\n                    element.css({\n                        backgroundImage: \"url(\"+o.backgroundImage+\")\"\n                    });\n                }\n                pages.css(\"overflow\", \"initial\");\n                that.isAnimate = false;\n            }\n\n            function _slide(){\n                current\n                    .stop(true)\n                    .animate({\n                        draw: {\n                            left: to === \"next\" ? -out : out\n                        },\n                        dur: o.duration,\n                        ease: o.effectFunc,\n                        onDone: function(){\n                            current.hide(0);\n                        }\n                    });\n\n                next\n                    .stop(true)\n                    .css({\n                        left: to === \"next\" ? out : -out\n                    })\n                    .show(0)\n                    .animate({\n                        draw: {\n                            left: 0\n                        },\n                        dur: o.duration,\n                        ease: o.effectFunc,\n                        onDone: function(){\n                            finish();\n                        }\n                    });\n            }\n\n            function _switch(){\n                current.hide();\n\n                next.css({\n                    top: 0,\n                    left: 0,\n                    opacity: 0\n                }).show(function(){\n                    finish();\n                });\n            }\n\n            function _fade(){\n                current.fadeOut(o.duration);\n\n                next.css({\n                    top: 0,\n                    left: 0,\n                    opacity: 0\n                }).fadeIn(o.duration, \"linear\", function(){\n                    finish();\n                });\n            }\n\n            switch (o.effect) {\n                case \"fade\": _fade(); break;\n                case \"switch\": _switch(); break;\n                default: _slide();\n            }\n        },\n\n        toPage: function(index){\n            this._slideToPage(index);\n        },\n\n        next: function(){\n            this._slideTo(\"next\");\n        },\n\n        prev: function(){\n            this._slideTo(\"prev\");\n        },\n\n        changeEffect: function(){\n            this.options.effect = this.element.attr(\"data-effect\");\n        },\n\n        changeEffectFunc: function(){\n            this.options.effectFunc = this.element.attr(\"data-effect-func\");\n        },\n\n        changeEffectDuration: function(){\n            this.options.duration = this.element.attr(\"data-duration\");\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case \"data-effect\": this.changeEffect(); break;\n                case \"data-effect-func\": this.changeEffectFunc(); break;\n                case \"data-duration\": this.changeEffectDuration(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n\n            element.off(Metro.events.click, \".controls .prev\");\n            element.off(Metro.events.click, \".controls .next\");\n            $(window).off(Metro.events.resize,{ns: this.id});\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro) {\n    'use strict';\n    Metro.md5 = function (string) {\n        function RotateLeft(lValue, iShiftBits) {\n            return (lValue<<iShiftBits) | (lValue>>>(32-iShiftBits));\n        }\n\n        function AddUnsigned(lX,lY) {\n            var lX4,lY4,lX8,lY8,lResult;\n            lX8 = (lX & 0x80000000);\n            lY8 = (lY & 0x80000000);\n            lX4 = (lX & 0x40000000);\n            lY4 = (lY & 0x40000000);\n            lResult = (lX & 0x3FFFFFFF)+(lY & 0x3FFFFFFF);\n            if (lX4 & lY4) {\n                return (lResult ^ 0x80000000 ^ lX8 ^ lY8);\n            }\n            if (lX4 | lY4) {\n                if (lResult & 0x40000000) {\n                    return (lResult ^ 0xC0000000 ^ lX8 ^ lY8);\n                } else {\n                    return (lResult ^ 0x40000000 ^ lX8 ^ lY8);\n                }\n            } else {\n                return (lResult ^ lX8 ^ lY8);\n            }\n        }\n\n        function F(x,y,z) { return (x & y) | ((~x) & z); }\n        function G(x,y,z) { return (x & z) | (y & (~z)); }\n        function H(x,y,z) { return (x ^ y ^ z); }\n        function I(x,y,z) { return (y ^ (x | (~z))); }\n\n        function FF(a,b,c,d,x,s,ac) {\n            a = AddUnsigned(a, AddUnsigned(AddUnsigned(F(b, c, d), x), ac));\n            return AddUnsigned(RotateLeft(a, s), b);\n        }\n\n        function GG(a,b,c,d,x,s,ac) {\n            a = AddUnsigned(a, AddUnsigned(AddUnsigned(G(b, c, d), x), ac));\n            return AddUnsigned(RotateLeft(a, s), b);\n        }\n\n        function HH(a,b,c,d,x,s,ac) {\n            a = AddUnsigned(a, AddUnsigned(AddUnsigned(H(b, c, d), x), ac));\n            return AddUnsigned(RotateLeft(a, s), b);\n        }\n\n        function II(a,b,c,d,x,s,ac) {\n            a = AddUnsigned(a, AddUnsigned(AddUnsigned(I(b, c, d), x), ac));\n            return AddUnsigned(RotateLeft(a, s), b);\n        }\n\n        function ConvertToWordArray(string) {\n            var lWordCount;\n            var lMessageLength = string.length;\n            var lNumberOfWords_temp1=lMessageLength + 8;\n            var lNumberOfWords_temp2=(lNumberOfWords_temp1-(lNumberOfWords_temp1 % 64))/64;\n            var lNumberOfWords = (lNumberOfWords_temp2+1)*16;\n            var lWordArray=Array(lNumberOfWords-1);\n            var lBytePosition = 0;\n            var lByteCount = 0;\n            while ( lByteCount < lMessageLength ) {\n                lWordCount = (lByteCount-(lByteCount % 4))/4;\n                lBytePosition = (lByteCount % 4)*8;\n                lWordArray[lWordCount] = (lWordArray[lWordCount] | (string.charCodeAt(lByteCount)<<lBytePosition));\n                lByteCount++;\n            }\n            lWordCount = (lByteCount-(lByteCount % 4))/4;\n            lBytePosition = (lByteCount % 4)*8;\n            lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80<<lBytePosition);\n            lWordArray[lNumberOfWords-2] = lMessageLength<<3;\n            lWordArray[lNumberOfWords-1] = lMessageLength>>>29;\n            return lWordArray;\n        }\n\n        function WordToHex(lValue) {\n            var WordToHexValue=\"\",WordToHexValue_temp=\"\",lByte,lCount;\n            for (lCount = 0;lCount<=3;lCount++) {\n                lByte = (lValue>>>(lCount*8)) & 255;\n                WordToHexValue_temp = \"0\" + lByte.toString(16);\n                WordToHexValue = WordToHexValue + WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2);\n            }\n            return WordToHexValue;\n        }\n\n        function Utf8Encode(string) {\n            string = string.replace(/\\r\\n/g,\"\\n\");\n            var utftext = \"\";\n\n            for (var n = 0; n < string.length; n++) {\n\n                var c = string.charCodeAt(n);\n\n                if (c < 128) {\n                    utftext += String.fromCharCode(c);\n                }\n                else if((c > 127) && (c < 2048)) {\n                    utftext += String.fromCharCode((c >> 6) | 192);\n                    utftext += String.fromCharCode((c & 63) | 128);\n                }\n                else {\n                    utftext += String.fromCharCode((c >> 12) | 224);\n                    utftext += String.fromCharCode(((c >> 6) & 63) | 128);\n                    utftext += String.fromCharCode((c & 63) | 128);\n                }\n\n            }\n\n            return utftext;\n        }\n\n        var x=[];\n        var k,AA,BB,CC,DD,a,b,c,d;\n        var S11=7, S12=12, S13=17, S14=22;\n        var S21=5, S22=9 , S23=14, S24=20;\n        var S31=4, S32=11, S33=16, S34=23;\n        var S41=6, S42=10, S43=15, S44=21;\n\n        string = Utf8Encode(string);\n\n        x = ConvertToWordArray(string);\n\n        a = 0x67452301; b = 0xEFCDAB89; c = 0x98BADCFE; d = 0x10325476;\n\n        for (k=0;k<x.length;k+=16) {\n            AA=a; BB=b; CC=c; DD=d;\n            a=FF(a,b,c,d,x[k], S11,0xD76AA478);\n            d=FF(d,a,b,c,x[k+1], S12,0xE8C7B756);\n            c=FF(c,d,a,b,x[k+2], S13,0x242070DB);\n            b=FF(b,c,d,a,x[k+3], S14,0xC1BDCEEE);\n            a=FF(a,b,c,d,x[k+4], S11,0xF57C0FAF);\n            d=FF(d,a,b,c,x[k+5], S12,0x4787C62A);\n            c=FF(c,d,a,b,x[k+6], S13,0xA8304613);\n            b=FF(b,c,d,a,x[k+7], S14,0xFD469501);\n            a=FF(a,b,c,d,x[k+8], S11,0x698098D8);\n            d=FF(d,a,b,c,x[k+9], S12,0x8B44F7AF);\n            c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);\n            b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);\n            a=FF(a,b,c,d,x[k+12],S11,0x6B901122);\n            d=FF(d,a,b,c,x[k+13],S12,0xFD987193);\n            c=FF(c,d,a,b,x[k+14],S13,0xA679438E);\n            b=FF(b,c,d,a,x[k+15],S14,0x49B40821);\n            a=GG(a,b,c,d,x[k+1], S21,0xF61E2562);\n            d=GG(d,a,b,c,x[k+6], S22,0xC040B340);\n            c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);\n            b=GG(b,c,d,a,x[k], S24,0xE9B6C7AA);\n            a=GG(a,b,c,d,x[k+5], S21,0xD62F105D);\n            d=GG(d,a,b,c,x[k+10],S22,0x2441453);\n            c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);\n            b=GG(b,c,d,a,x[k+4], S24,0xE7D3FBC8);\n            a=GG(a,b,c,d,x[k+9], S21,0x21E1CDE6);\n            d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);\n            c=GG(c,d,a,b,x[k+3], S23,0xF4D50D87);\n            b=GG(b,c,d,a,x[k+8], S24,0x455A14ED);\n            a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);\n            d=GG(d,a,b,c,x[k+2], S22,0xFCEFA3F8);\n            c=GG(c,d,a,b,x[k+7], S23,0x676F02D9);\n            b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);\n            a=HH(a,b,c,d,x[k+5], S31,0xFFFA3942);\n            d=HH(d,a,b,c,x[k+8], S32,0x8771F681);\n            c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);\n            b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);\n            a=HH(a,b,c,d,x[k+1], S31,0xA4BEEA44);\n            d=HH(d,a,b,c,x[k+4], S32,0x4BDECFA9);\n            c=HH(c,d,a,b,x[k+7], S33,0xF6BB4B60);\n            b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);\n            a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);\n            d=HH(d,a,b,c,x[k], S32,0xEAA127FA);\n            c=HH(c,d,a,b,x[k+3], S33,0xD4EF3085);\n            b=HH(b,c,d,a,x[k+6], S34,0x4881D05);\n            a=HH(a,b,c,d,x[k+9], S31,0xD9D4D039);\n            d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);\n            c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);\n            b=HH(b,c,d,a,x[k+2], S34,0xC4AC5665);\n            a=II(a,b,c,d,x[k], S41,0xF4292244);\n            d=II(d,a,b,c,x[k+7], S42,0x432AFF97);\n            c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);\n            b=II(b,c,d,a,x[k+5], S44,0xFC93A039);\n            a=II(a,b,c,d,x[k+12],S41,0x655B59C3);\n            d=II(d,a,b,c,x[k+3], S42,0x8F0CCC92);\n            c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);\n            b=II(b,c,d,a,x[k+1], S44,0x85845DD1);\n            a=II(a,b,c,d,x[k+8], S41,0x6FA87E4F);\n            d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);\n            c=II(c,d,a,b,x[k+6], S43,0xA3014314);\n            b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);\n            a=II(a,b,c,d,x[k+4], S41,0xF7537E82);\n            d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);\n            c=II(c,d,a,b,x[k+2], S43,0x2AD7D2BB);\n            b=II(b,c,d,a,x[k+9], S44,0xEB86D391);\n            a=AddUnsigned(a,AA);\n            b=AddUnsigned(b,BB);\n            c=AddUnsigned(c,CC);\n            d=AddUnsigned(d,DD);\n        }\n\n        var temp = WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);\n\n        return temp.toLowerCase();\n    };\n\n    if (window.METRO_GLOBAL_COMMON === true) {\n        window.md5 = Metro.md5;\n    }\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var NavigationViewDefaultConfig = {\n        navviewDeferred: 0,\n        compact: \"md\",\n        expand: \"lg\",\n        toggle: null,\n        activeState: false,\n        onMenuItemClick: Metro.noop,\n        onNavviewCreate: Metro.noop\n    };\n\n    Metro.navViewSetup = function (options) {\n        NavigationViewDefaultConfig = $.extend({}, NavigationViewDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroNavViewSetup\"] !== undefined) {\n        Metro.navViewSetup(window[\"metroNavViewSetup\"]);\n    }\n\n    Metro.Component('nav-view', {\n        init: function( options, elem ) {\n            this._super(elem, options, NavigationViewDefaultConfig, {\n                pane: null,\n                content: null,\n                paneToggle: null,\n                id: Utils.elementId(\"navview\"),\n                menuScrollDistance: 0,\n                menuScrollStep: 0\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"navview-create\");\n        },\n\n        _calcMenuHeight: function(){\n            var element = this.element, pane, menu_container;\n            var elements_height = 0;\n\n            pane = element.children(\".navview-pane\");\n            if (pane.length === 0) {\n                return;\n            }\n\n            menu_container = pane.children(\".navview-menu-container\");\n\n            if (menu_container.length === 0) {\n                return ;\n            }\n\n            $.each(menu_container.prevAll(), function(){\n                elements_height += $(this).outerHeight(true);\n            });\n\n            $.each(menu_container.nextAll(), function(){\n                elements_height += $(this).outerHeight(true);\n            });\n\n            menu_container.css({\n                height: \"calc(100% - \"+(elements_height)+\"px)\"\n            });\n\n            this.menuScrollStep = 48;\n            this.menuScrollDistance = Utils.nearest(menu_container[0].scrollHeight - menu_container.height(), 48);\n        },\n\n        _recalc: function(){\n            var that = this, element = this.element;\n            setTimeout(function(){\n                if (that.pane.width() === 48) {\n                    element.addClass(\"js-compact\");\n                } else {\n                    element.removeClass(\"js-compact\");\n                }\n                that._calcMenuHeight();\n            }, 200);\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var pane, content, toggle, menu/*, menu_container, menu_h, menu_container_h*/;\n\n            element\n                .addClass(\"navview\")\n                .addClass(o.compact !== false ? \"navview-compact-\"+o.compact : \"\")\n                .addClass(o.expand !== false ? \"navview-expand-\"+o.expand : \"\");\n\n            pane = element.children(\".navview-pane\");\n            content = element.children(\".navview-content\");\n            toggle = $(o.toggle);\n            menu = pane.children(\".navview-menu\");\n\n            if (menu.length) {\n                menu.prevAll().reverse().wrapAll($(\"<div>\").addClass(\"navview-container\"));\n                menu.wrap($(\"<div>\").addClass(\"navview-menu-container\"));\n            }\n\n            this.pane = pane.length > 0 ? pane : null;\n            this.content = content.length > 0 ? content : null;\n            this.paneToggle = toggle.length > 0 ? toggle : null;\n\n            this._recalc();\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var menu_container = element.find(\".navview-menu-container\");\n            var menu = menu_container.children(\".navview-menu\");\n\n            menu_container.on(\"mousewheel\", function(e){\n                var pane_width = element.find(\".navview-pane\").width();\n                var dir = e.deltaY > 0 ? -1 : 1;\n                var step = that.menuScrollStep;\n                var distance = that.menuScrollDistance;\n                var top = parseInt(menu.css('top'));\n\n                if (pane_width > 48 /*|| !element.hasClass(\"compacted\") */) {\n                    return false;\n                }\n\n                if(dir === -1 && Math.abs(top) <= distance) {\n                    menu.css('top', parseInt(menu.css('top')) + step * dir);\n                }\n\n                if(dir === 1 && top <= -step) {\n                    menu.css('top', parseInt(menu.css('top')) + step * dir);\n                }\n            });\n\n            element.on(Metro.events.click, \".pull-button, .holder\", function(){\n                that.pullClick(this);\n            });\n\n            element.on(Metro.events.click, \".navview-menu li\", function(){\n                if (o.activeState === true) {\n                    element.find(\".navview-menu li\").removeClass(\"active\");\n                    $(this).toggleClass(\"active\");\n                }\n            });\n\n            element.on(Metro.events.click, \".navview-menu li > a\", function(){\n\n                that._fireEvent(\"menu-item-click\", {\n                    item: this\n                });\n\n            });\n\n            if (this.paneToggle !== null) {\n                this.paneToggle.on(Metro.events.click, function(){\n                    that.pane.toggleClass(\"open\");\n                })\n            }\n\n            $(window).on(Metro.events.resize, function(){\n                var menu_h, menu_container_h,\n                    menu_container = element.children(\".navview-menu-container\"),\n                    menu;\n\n                if (that.pane.hasClass(\"open\")) {\n                    that._recalc();\n                    return ;\n                }\n\n                element.removeClass(\"expanded\");\n                that.pane.removeClass(\"open\");\n\n                if ($(this).width() <= Metro.media_sizes[(\"\"+o.compact).toUpperCase()]) {\n                    element.removeClass(\"compacted\");\n                }\n\n                if (menu_container.length) {\n                    menu = menu_container.children(\".navview-menu\");\n                    setTimeout(function () {\n                        menu_h = menu.height();\n                        menu_container_h = menu_container.height();\n                        that.menuScrollStep = menu.children(\":not(.item-separator), :not(.item-header)\")[0].clientHeight;\n                        that.menuScrollDistance = menu_h > menu_container_h ? Utils.nearest(menu_h - menu_container_h, that.menuScrollStep) : 0;\n                    }, 0);\n                }\n\n                that._recalc();\n\n            }, {ns: this.id})\n        },\n\n        _togglePaneMode: function(){\n            var element = this.element;\n            var pane = this.pane;\n            var pane_compact = pane.width() < 280;\n\n            if ((pane_compact || element.hasClass(\"expanded\")) && !element.hasClass(\"compacted\")) {\n                element.toggleClass(\"expanded\");\n            } else\n\n            if (element.hasClass(\"compacted\") || !pane_compact) {\n                element.toggleClass(\"compacted\");\n            }\n\n        },\n\n        pullClick: function(el){\n            var that = this;\n            var input;\n\n            var target = $(el);\n\n            if (target && target.hasClass(\"holder\")) {\n                input = target.parent().find(\"input\");\n                setTimeout(function(){\n                    input.focus();\n                }, 200);\n            }\n\n            if (that.pane.hasClass(\"open\")) {\n                that.close();\n            } else {\n                this._togglePaneMode();\n            }\n\n            this._recalc();\n\n            return true;\n        },\n\n        open: function(){\n            this.pane.addClass(\"open\");\n        },\n\n        close: function(){\n            this.pane.removeClass(\"open\");\n        },\n\n        toggle: function(){\n            var pane = this.pane;\n            pane.hasClass(\"open\") ? pane.removeClass(\"open\") : pane.addClass(\"open\");\n        },\n\n        toggleMode: function(){\n            this._togglePaneMode();\n        },\n\n        /* eslint-disable-next-line */\n        changeAttribute: function(attributeName){\n        },\n\n        destroy: function(){\n            var element = this.element;\n\n            element.off(Metro.events.click, \".pull-button, .holder\");\n            element.off(Metro.events.click, \".navview-menu li\");\n            element.off(Metro.events.click, \".navview-menu li > a\");\n\n            if (this.paneToggle !== null) {\n                this.paneToggle.off(Metro.events.click);\n            }\n\n            $(window).off(Metro.events.resize,{ns: this.id});\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var NotifyDefaultConfig = {\n        container: null,\n        width: 220,\n        timeout: METRO_TIMEOUT,\n        duration: METRO_ANIMATION_DURATION,\n        distance: \"max\",\n        animation: \"linear\",\n        onClick: Metro.noop,\n        onClose: Metro.noop,\n        onShow: Metro.noop,\n        onAppend: Metro.noop,\n        onNotifyCreate: Metro.noop\n\n    };\n\n    Metro.notifySetup = function(options){\n        NotifyDefaultConfig = $.extend({}, NotifyDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroNotifySetup\"] !== undefined) {\n        Metro.notifySetup(window[\"metroNotifySetup\"]);\n    }\n\n    var Notify = {\n\n        container: null,\n\n        options: {\n        },\n\n        notifies: [],\n\n        setup: function(options){\n            this.options = $.extend({}, NotifyDefaultConfig, options);\n\n            return this;\n        },\n\n        reset: function(){\n            var reset_options = {\n                width: 220,\n                timeout: METRO_TIMEOUT,\n                duration: METRO_ANIMATION_DURATION,\n                distance: \"max\",\n                animation: \"linear\"\n            };\n            this.options = $.extend({}, NotifyDefaultConfig, reset_options);\n        },\n\n        _createContainer: function(){\n\n            var container = $(\"<div>\").addClass(\"notify-container\");\n            $(\"body\").prepend(container);\n\n            return container;\n        },\n\n        create: function(message, title, options){\n            var notify, that = this, o = this.options;\n            var m, t, id = Utils.elementId(\"notify\");\n\n            if (Utils.isNull(options)) {\n                options = {};\n            }\n\n            if (!Utils.isValue(message)) {\n                return false;\n            }\n\n            notify = $(\"<div>\").addClass(\"notify\").attr(\"id\", id);\n            notify.css({\n                width: o.width\n            });\n\n            if (title) {\n                t = $(\"<div>\").addClass(\"notify-title\").html(title);\n                notify.prepend(t);\n            }\n            m = $(\"<div>\").addClass(\"notify-message\").html(message);\n            m.appendTo(notify);\n\n            // Set options\n            /*\n            * keepOpen, cls, width, callback\n            * */\n            if (options !== undefined) {\n                if (options.cls !== undefined) {\n                    notify.addClass(options.cls);\n                }\n                if (options.width !== undefined) {\n                    notify.css({\n                        width: options.width\n                    });\n                }\n            }\n\n            notify.on(Metro.events.click, function(){\n                Utils.exec(Utils.isValue(options.onClick) ? options.onClick : o.onClick, null, this);\n                that.kill($(this).closest(\".notify\"), Utils.isValue(options.onClose) ? options.onClose : o.onClose);\n            });\n\n            // Show\n            if (Notify.container === null) {\n                Notify.container = Notify._createContainer();\n            }\n            notify.appendTo(Notify.container);\n\n            notify.hide(function(){\n\n                Utils.exec(Utils.isValue(options.onAppend) ? options.onAppend : o.onAppend, null, notify[0]);\n\n                var duration = Utils.isValue(options.duration) ? options.duration : o.duration;\n                var animation = Utils.isValue(options.animation) ? options.animation : o.animation;\n                var distance = Utils.isValue(options.distance) ? options.distance : o.distance;\n\n                if (distance === \"max\" || isNaN(distance)) {\n                    distance = $(window).height();\n                }\n\n                notify\n                    .show()\n                    .animate({\n                        draw: {\n                            marginTop: [distance, 4],\n                            opacity: [0, 1]\n                        },\n                        dur: duration,\n                        ease: animation,\n                        onDone: function(){\n                            Utils.exec(o.onNotifyCreate, null, this);\n\n                            if (options !== undefined && options.keepOpen === true) {\n                                /* eslint-disable-next-line */\n\n                            } else {\n                                setTimeout(function(){\n                                    that.kill(notify, Utils.isValue(options.onClose) ? options.onClose : o.onClose);\n                                }, o.timeout);\n                            }\n\n                            Utils.exec(Utils.isValue(options.onShow) ? options.onShow : o.onShow, null, notify[0]);\n                        }\n                    });\n\n            });\n        },\n\n        kill: function(notify, callback){\n            var that = this, o = this.options;\n            notify.off(Metro.events.click);\n            notify.fadeOut(o.duration, 'linear', function(){\n                Utils.exec(Utils.isValue(callback) ? callback : that.options.onClose, null, notify[0]);\n                notify.remove();\n            });\n        },\n\n        killAll: function(){\n            var that = this;\n            var notifies = $(\".notify\");\n            $.each(notifies, function(){\n                that.kill($(this));\n            });\n        }\n    };\n\n    Metro['notify'] = Notify.setup();\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    Metro.pagination = function(c){\n        var defConf = {\n            length: 0,\n            rows: 0,\n            current: 0,\n            target: \"body\",\n            clsPagination: \"\",\n            prevTitle: \"Prev\",\n            nextTitle: \"Next\",\n            distance: 5\n        }, conf;\n        var pagination;\n        var pagination_wrapper;\n        var i, prev, next;\n        var shortDistance;\n\n        conf = $.extend( {}, defConf, c);\n\n        shortDistance = parseInt(conf.distance);\n        pagination_wrapper = $(conf.target);\n        pagination_wrapper.html(\"\");\n        pagination = $(\"<ul>\").addClass(\"pagination\").addClass(conf.clsPagination).appendTo(pagination_wrapper);\n\n        if (conf.length === 0) {\n            return ;\n        }\n\n        if (conf.rows === -1) {\n            return ;\n        }\n\n        conf.pages = Math.ceil(conf.length / conf.rows);\n\n        var add_item = function(item_title, item_type, data){\n            var li, a;\n\n            li = $(\"<li>\").addClass(\"page-item\").addClass(item_type);\n            a  = $(\"<a>\").addClass(\"page-link\").html(item_title);\n            a.data(\"page\", data);\n            a.appendTo(li);\n\n            return li;\n        };\n\n        prev = add_item(conf.prevTitle, \"service prev-page\", \"prev\");\n        pagination.append(prev);\n\n        pagination.append(add_item(1, conf.current === 1 ? \"active\" : \"\", 1));\n\n        if (shortDistance === 0 || conf.pages <= 7) {\n            for (i = 2; i < conf.pages; i++) {\n                pagination.append(add_item(i, i === conf.current ? \"active\" : \"\", i));\n            }\n        } else {\n            if (conf.current < shortDistance) {\n                for (i = 2; i <= shortDistance; i++) {\n                    pagination.append(add_item(i, i === conf.current ? \"active\" : \"\", i));\n                }\n\n                if (conf.pages > shortDistance) {\n                    pagination.append(add_item(\"...\", \"no-link\", null));\n                }\n            } else if (conf.current <= conf.pages && conf.current > conf.pages - shortDistance + 1) {\n                if (conf.pages > shortDistance) {\n                    pagination.append(add_item(\"...\", \"no-link\", null));\n                }\n\n                for (i = conf.pages - shortDistance + 1; i < conf.pages; i++) {\n                    pagination.append(add_item(i, i === conf.current ? \"active\" : \"\", i));\n                }\n            } else {\n                pagination.append(add_item(\"...\", \"no-link\", null));\n\n                pagination.append(add_item(conf.current - 1, \"\", conf.current - 1));\n                pagination.append(add_item(conf.current, \"active\", conf.current));\n                pagination.append(add_item(conf.current + 1, \"\", conf.current + 1));\n\n                pagination.append(add_item(\"...\", \"no-link\", null));\n            }\n        }\n\n        if (conf.pages > 1 || conf.current < conf.pages) pagination.append(add_item(conf.pages, conf.current === conf.pages ? \"active\" : \"\", conf.pages));\n\n        next = add_item(conf.nextTitle, \"service next-page\", \"next\");\n        pagination.append(next);\n\n        if (conf.current === 1) {\n            prev.addClass(\"disabled\");\n        }\n\n        if (conf.current === conf.pages) {\n            next.addClass(\"disabled\");\n        }\n\n        if (conf.length === 0) {\n            pagination.addClass(\"disabled\");\n            pagination.children().addClass(\"disabled\");\n        }\n\n        return pagination;\n    };\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var PanelDefaultConfig = {\n        panelDeferred: 0,\n        id: null,\n        titleCaption: \"\",\n        titleIcon: \"\",\n        collapsible: false,\n        collapsed: false,\n        collapseDuration: METRO_ANIMATION_DURATION,\n        width: \"auto\",\n        height: \"auto\",\n        draggable: false,\n\n        customButtons: null,\n        clsCustomButton: \"\",\n\n        clsPanel: \"\",\n        clsTitle: \"\",\n        clsTitleCaption: \"\",\n        clsTitleIcon: \"\",\n        clsContent: \"\",\n        clsCollapseToggle: \"\",\n\n        onCollapse: Metro.noop,\n        onExpand: Metro.noop,\n        onDragStart: Metro.noop,\n        onDragStop: Metro.noop,\n        onDragMove: Metro.noop,\n        onPanelCreate: Metro.noop\n    };\n\n    Metro.panelSetup = function (options) {\n        PanelDefaultConfig = $.extend({}, PanelDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroPanelSetup\"] !== undefined) {\n        Metro.panelSetup(window[\"metroPanelSetup\"]);\n    }\n\n    Metro.Component('panel', {\n        init: function( options, elem ) {\n            this._super(elem, options, PanelDefaultConfig);\n\n            return this;\n        },\n\n        _addCustomButtons: function(buttons){\n            var element = this.element, o = this.options;\n            var title = element.closest(\".panel\").find(\".panel-title\");\n            var buttonsContainer, customButtons = [];\n\n            if (typeof buttons === \"string\" && buttons.indexOf(\"{\") > -1) {\n                customButtons = JSON.parse(buttons);\n            } else if (typeof buttons === \"string\" && Utils.isObject(buttons)) {\n                customButtons = Utils.isObject(buttons);\n            } else if (typeof buttons === \"object\" && Utils.objectLength(buttons) > 0) {\n                customButtons = buttons;\n            } else {\n                console.warn(\"Unknown format for custom buttons\", buttons);\n                return ;\n            }\n\n            if (title.length === 0) {\n                console.warn(\"No place for custom buttons\");\n                return ;\n            }\n\n            buttonsContainer = title.find(\".custom-buttons\");\n\n            if (buttonsContainer.length === 0) {\n                buttonsContainer = $(\"<div>\").addClass(\"custom-buttons\").appendTo(title);\n            } else {\n                buttonsContainer.find(\".btn-custom\").off(Metro.events.click);\n                buttonsContainer.html(\"\");\n            }\n\n            $.each(customButtons, function(){\n                var item = this;\n                var customButton = $(\"<span>\");\n\n                customButton\n                    .addClass(\"button btn-custom\")\n                    .addClass(o.clsCustomButton)\n                    .addClass(item.cls)\n                    .attr(\"tabindex\", -1)\n                    .html(item.html);\n\n                if (item.attr && typeof item.attr === 'object') {\n                    $.each(item.attr, function(k, v){\n                        customButton.attr(Cake.dashedName(k), v);\n                    });\n                }\n\n                customButton.data(\"action\", item.onclick);\n\n                buttonsContainer.prepend(customButton);\n            });\n\n            title.on(Metro.events.click, \".btn-custom\", function(e){\n                if (Utils.isRightMouse(e)) return;\n                var button = $(this);\n                var action = button.data(\"action\");\n                Utils.exec(action, [button], this);\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n            var panel = $(\"<div>\").addClass(\"panel\").addClass(o.clsPanel);\n            var id = o.id ? o.id : Utils.elementId(\"panel\");\n            var original_classes = element[0].className;\n            var title;\n\n            panel.attr(\"id\", id).addClass(original_classes);\n            panel.insertBefore(element);\n            element.appendTo(panel);\n\n            element[0].className = '';\n            element.addClass(\"panel-content\").addClass(o.clsContent).appendTo(panel);\n\n            if (o.titleCaption !== \"\" || o.titleIcon !== \"\" || o.collapsible === true) {\n                title = $(\"<div>\").addClass(\"panel-title\").addClass(o.clsTitle);\n\n                if (o.titleCaption !== \"\") {\n                    $(\"<span>\").addClass(\"caption\").addClass(o.clsTitleCaption).html(o.titleCaption).appendTo(title)\n                }\n\n                if (o.titleIcon !== \"\") {\n                    $(o.titleIcon).addClass(\"icon\").addClass(o.clsTitleIcon).appendTo(title)\n                }\n\n                if (o.collapsible === true) {\n                    var collapseToggle = $(\"<span>\").addClass(\"dropdown-toggle marker-center active-toggle\").addClass(o.clsCollapseToggle).appendTo(title);\n                    Metro.makePlugin(element, \"collapse\", {\n                        toggleElement: collapseToggle,\n                        duration: o.collapseDuration,\n                        onCollapse: o.onCollapse,\n                        onExpand: o.onExpand\n                    });\n\n                    if (o.collapsed === true) {\n                        this.collapse();\n                    }\n                }\n\n                title.appendTo(panel);\n            }\n\n            if (title && Utils.isValue(o.customButtons)) {\n                this._addCustomButtons(o.customButtons);\n            }\n\n            if (o.draggable === true) {\n                var dragElement;\n\n                if (title) {\n                    dragElement = title.find(\".caption, .icon\");\n                } else {\n                    dragElement = panel;\n                }\n\n                Metro.makePlugin(panel, \"draggable\", {\n                    dragContext: panel[0],\n                    dragElement: dragElement,\n                    onDragStart: o.onDragStart,\n                    onDragStop: o.onDragStop,\n                    onDragMove: o.onDragMove\n                });\n            }\n\n            if (o.width !== \"auto\" && parseInt(o.width) >= 0) {\n                panel.outerWidth(parseInt(o.width));\n            }\n\n            if (o.height !== \"auto\" && parseInt(o.height) >= 0) {\n                panel.outerHeight(parseInt(o.height));\n                element.css({overflow: \"auto\"});\n            }\n\n            this.panel = panel;\n\n            this._fireEvent(\"panel-create\", {\n                element: element,\n                panel: panel\n            });\n        },\n\n        customButtons: function(buttons){\n            return this._addCustomButtons(buttons);\n        },\n\n        collapse: function(){\n            var element = this.element;\n            if (Utils.isMetroObject(element, 'collapse') === false) {\n                return ;\n            }\n            Metro.getPlugin(element, 'collapse').collapse();\n        },\n\n        open: function(){\n            this.expand();\n        },\n\n        close: function(){\n            this.collapse();\n        },\n\n        expand: function(){\n            var element = this.element;\n            if (Utils.isMetroObject(element, 'collapse') === false) {\n                return ;\n            }\n            Metro.getPlugin(element, 'collapse').expand();\n        },\n\n        /* eslint-disable-next-line */\n        changeAttribute: function(attributeName){\n        },\n\n        destroy: function(){\n            var element = this.element, o = this.options;\n\n            if (o.collapsible === true) {\n                Metro.getPlugin(element, \"collapse\").destroy();\n            }\n\n            if (o.draggable === true) {\n                Metro.getPlugin(element, \"draggable\").destroy();\n            }\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var PopoverDefaultConfig = {\n        popoverDeferred: 0,\n        popoverText: \"\",\n        popoverHide: 3000,\n        popoverTimeout: 10,\n        popoverOffset: 10,\n        popoverTrigger: Metro.popoverEvents.HOVER,\n        popoverPosition: Metro.position.TOP,\n        hideOnLeave: false,\n        closeButton: true,\n        clsPopover: \"\",\n        clsPopoverContent: \"\",\n        onPopoverShow: Metro.noop,\n        onPopoverHide: Metro.noop,\n        onPopoverCreate: Metro.noop\n    };\n\n    Metro.popoverSetup = function (options) {\n        PopoverDefaultConfig = $.extend({}, PopoverDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroPopoverSetup\"] !== undefined) {\n        Metro.popoverSetup(window[\"metroPopoverSetup\"]);\n    }\n\n    Metro.Component('popover', {\n        init: function( options, elem ) {\n            this._super(elem, options, PopoverDefaultConfig, {\n                popover: null,\n                popovered: false,\n                size: {\n                    width: 0,\n                    height: 0\n                },\n                id: Utils.elementId(\"popover\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            this._createEvents();\n            this._fireEvent(\"popover-create\", {\n                element: this.element\n            })\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var event;\n\n            switch (o.popoverTrigger) {\n                case Metro.popoverEvents.CLICK: event = Metro.events.click; break;\n                case Metro.popoverEvents.FOCUS: event = Metro.events.focus; break;\n                default: event = Metro.events.enter;\n            }\n\n            element.on(event, function(){\n                if (that.popover !== null || that.popovered === true) {\n                    return ;\n                }\n                setTimeout(function(){\n                    that.createPopover();\n\n                    that._fireEvent(\"popover-show\", {\n                        popover: that.popover\n                    });\n\n                    if (o.popoverHide > 0) {\n                        setTimeout(function(){\n                            that.removePopover();\n                        }, o.popoverHide);\n                    }\n                }, o.popoverTimeout);\n            });\n\n            if (o.hideOnLeave === true) {\n                element.on(Metro.events.leave, function(){\n                    that.removePopover();\n                });\n            }\n\n            $(window).on(Metro.events.scroll, function(){\n                if (that.popover !== null) that.setPosition();\n            }, {ns: this.id});\n        },\n\n        setPosition: function(){\n            var popover = this.popover, size = this.size, o = this.options, element = this.element;\n\n            if (o.popoverPosition === Metro.position.BOTTOM) {\n                popover.addClass('bottom');\n                popover.css({\n                    top: element.offset().top - $(window).scrollTop() + element.outerHeight() + o.popoverOffset,\n                    left: element.offset().left + element.outerWidth()/2 - size.width/2  - $(window).scrollLeft()\n                });\n            } else if (o.popoverPosition === Metro.position.RIGHT) {\n                popover.addClass('right');\n                popover.css({\n                    top: element.offset().top + element.outerHeight()/2 - size.height/2 - $(window).scrollTop(),\n                    left: element.offset().left + element.outerWidth() - $(window).scrollLeft() + o.popoverOffset\n                });\n            } else if (o.popoverPosition === Metro.position.LEFT) {\n                popover.addClass('left');\n                popover.css({\n                    top: element.offset().top + element.outerHeight()/2 - size.height/2 - $(window).scrollTop(),\n                    left: element.offset().left - size.width - $(window).scrollLeft() - o.popoverOffset\n                });\n            } else {\n                popover.addClass('top');\n                popover.css({\n                    top: element.offset().top - $(window).scrollTop() - size.height - o.popoverOffset,\n                    left: element.offset().left + element.outerWidth()/2 - size.width/2  - $(window).scrollLeft()\n                });\n            }\n        },\n\n        createPopover: function(){\n            var that = this, elem = this.elem, element = this.element, o = this.options;\n            var popover;\n            var neb_pos;\n            var id = Utils.elementId(\"popover\");\n            var closeButton;\n\n            if (this.popovered) {\n                return ;\n            }\n\n            popover = $(\"<div>\").addClass(\"popover neb\").addClass(o.clsPopover);\n            popover.attr(\"id\", id);\n\n            $(\"<div>\").addClass(\"popover-content\").addClass(o.clsPopoverContent).html(o.popoverText).appendTo(popover);\n\n            if (o.popoverHide === 0 && o.closeButton === true) {\n                closeButton = $(\"<button>\").addClass(\"button square small popover-close-button bg-white\").html(\"&times;\").appendTo(popover);\n                closeButton.on(Metro.events.click, function(){\n                    that.removePopover();\n                });\n            }\n\n            switch (o.popoverPosition) {\n                case Metro.position.TOP: neb_pos = \"neb-s\"; break;\n                case Metro.position.BOTTOM: neb_pos = \"neb-n\"; break;\n                case Metro.position.RIGHT: neb_pos = \"neb-w\"; break;\n                case Metro.position.LEFT: neb_pos = \"neb-e\"; break;\n            }\n\n            popover.addClass(neb_pos);\n\n            if (o.closeButton !== true) {\n                popover.on(Metro.events.click, function(){\n                    that.removePopover();\n                });\n            }\n\n            this.popover = popover;\n            this.size = Utils.hiddenElementSize(popover);\n\n            if (elem.tagName === 'TD' || elem.tagName === 'TH') {\n                var wrp = $(\"<div/>\").css(\"display\", \"inline-block\").html(element.html());\n                element.html(wrp);\n                element = wrp;\n            }\n\n            this.setPosition();\n\n            popover.appendTo($('body'));\n\n            this.popovered = true;\n\n            this._fireEvent(\"popover-create\", {\n                popover: popover\n            });\n        },\n\n        removePopover: function(){\n            var that = this;\n            var timeout = this.options.onPopoverHide === Metro.noop ? 0 : 300;\n            var popover = this.popover;\n\n            if (!this.popovered) {\n                return ;\n            }\n\n            this._fireEvent(\"popover-hide\", {\n                popover: popover\n            });\n\n            setTimeout(function(){\n                popover.hide(0, function(){\n                    popover.remove();\n                    that.popover = null;\n                    that.popovered = false;\n                });\n            }, timeout);\n        },\n\n        show: function(){\n            var that = this, o = this.options;\n\n            if (this.popovered === true) {\n                return ;\n            }\n\n            setTimeout(function(){\n                that.createPopover();\n\n                that._fireEvent(\"popover-show\", {\n                    popover: that.popover\n                });\n\n                if (o.popoverHide > 0) {\n                    setTimeout(function(){\n                        that.removePopover();\n                    }, o.popoverHide);\n                }\n            }, o.popoverTimeout);\n        },\n\n        hide: function(){\n            this.removePopover();\n        },\n\n        changeAttribute: function(attributeName){\n            var that = this, element = this.element, o = this.options;\n\n            var changeText = function(){\n                o.popoverText = element.attr(\"data-popover-text\");\n                if (that.popover) {\n                    that.popover.find(\".popover-content\").html(o.popoverText);\n                    that.setPosition();\n                }\n            };\n\n            var changePosition = function(){\n                o.popoverPosition = element.attr(\"data-popover-position\");\n                that.setPosition();\n            };\n\n            switch (attributeName) {\n                case \"data-popover-text\": changeText(); break;\n                case \"data-popover-position\": changePosition(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element, o = this.options;\n            var event;\n\n            switch (o.popoverTrigger) {\n                case Metro.popoverEvents.CLICK: event = Metro.events.click; break;\n                case Metro.popoverEvents.FOCUS: event = Metro.events.focus; break;\n                default: event = Metro.events.enter;\n            }\n\n            element.off(event);\n\n            if (o.hideOnLeave === true) {\n                element.off(Metro.events.leave);\n            }\n\n            $(window).off(Metro.events.scroll,{ns: this.id});\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var ProgressDefaultConfig = {\n        progressDeferred: 0,\n        showValue: false,\n        valuePosition: \"free\", // center, free\n        showLabel: false,\n        labelPosition: \"before\", // before, after\n        labelTemplate: \"\",\n        value: 0,\n        buffer: 0,\n        type: \"bar\",\n        small: false,\n        clsBack: \"\",\n        clsBar: \"\",\n        clsBuffer: \"\",\n        clsValue: \"\",\n        clsLabel: \"\",\n        onValueChange: Metro.noop,\n        onBufferChange: Metro.noop,\n        onComplete: Metro.noop,\n        onBuffered: Metro.noop,\n        onProgressCreate: Metro.noop\n    };\n\n    Metro.progressSetup = function (options) {\n        ProgressDefaultConfig = $.extend({}, ProgressDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroProgressSetup\"] !== undefined) {\n        Metro.progressSetup(window[\"metroProgressSetup\"]);\n    }\n\n    Metro.Component('progress', {\n        init: function( options, elem ) {\n            this._super(elem, options, ProgressDefaultConfig, {\n                value: 0,\n                buffer: 0\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n            var value;\n\n            if (typeof o.type === \"string\") o.type = o.type.toLowerCase();\n\n            element\n                .html(\"\")\n                .addClass(\"progress\");\n\n            function _progress(){\n                $(\"<div>\").addClass(\"bar\").appendTo(element);\n            }\n\n            function _buffer(){\n                $(\"<div>\").addClass(\"bar\").appendTo(element);\n                $(\"<div>\").addClass(\"buffer\").appendTo(element);\n            }\n\n            function _load(){\n                element.addClass(\"with-load\");\n                $(\"<div>\").addClass(\"bar\").appendTo(element);\n                $(\"<div>\").addClass(\"buffer\").appendTo(element);\n                $(\"<div>\").addClass(\"load\").appendTo(element);\n            }\n\n            function _line(){\n                element.addClass(\"line\");\n            }\n\n            switch (o.type) {\n                case \"buffer\": _buffer(); break;\n                case \"load\": _load(); break;\n                case \"line\": _line(); break;\n                default: _progress();\n            }\n\n            if (o.type !== 'line') {\n                value = $(\"<span>\").addClass(\"value\").addClass(o.clsValue).appendTo(element);\n                if (o.valuePosition === \"center\") value.addClass(\"centered\");\n                if (o.showValue === false) value.hide();\n            }\n\n            if (o.small === true) element.addClass(\"small\");\n\n            element.addClass(o.clsBack);\n            element.find(\".bar\").addClass(o.clsBar);\n            element.find(\".buffer\").addClass(o.clsBuffer);\n\n            if (o.showLabel === true) {\n                var label = $(\"<span>\").addClass(\"progress-label\").addClass(o.clsLabel).html(o.labelTemplate === \"\" ? o.value+\"%\" : o.labelTemplate.replace(\"%VAL%\", o.value));\n                if (o.labelPosition === 'before') {\n                    label.insertBefore(element);\n                } else {\n                    label.insertAfter(element);\n                }\n            }\n\n            this.val(o.value);\n            this.buff(o.buffer);\n\n            this._fireEvent(\"progress-create\", {\n                element: element\n            });\n        },\n\n        val: function(v){\n            var that = this, element = this.element, o = this.options;\n            var value = element.find(\".value\");\n\n            if (v === undefined) {\n                return that.value;\n            }\n\n            var bar  = element.find(\".bar\");\n\n            if (bar.length === 0) {\n                return false;\n            }\n\n            this.value = parseInt(v, 10);\n\n            bar.css(\"width\", this.value + \"%\");\n            value.html(this.value+\"%\");\n\n            var diff = element.width() - bar.width();\n            var valuePosition = value.width() > diff ? {left: \"auto\", right: diff + 'px'} : {left: v + '%'};\n\n            if (o.valuePosition === \"free\") value.css(valuePosition);\n\n            if (o.showLabel === true) {\n                var label = element[o.labelPosition === \"before\" ? \"prev\" : \"next\"](\".progress-label\");\n                if (label.length) {\n                    label.html(o.labelTemplate === \"\" ? o.value+\"%\" : o.labelTemplate.replace(\"%VAL%\", o.value));\n                }\n            }\n\n            this._fireEvent(\"value-change\", {\n                val: this.value\n            });\n\n            if (this.value === 100) {\n\n                this._fireEvent(\"complete\", {\n                    val: this.value\n                });\n\n            }\n        },\n\n        buff: function(v){\n            var that = this, element = this.element;\n\n            if (v === undefined) {\n                return that.buffer;\n            }\n\n            var bar  = element.find(\".buffer\");\n\n            if (bar.length === 0) {\n                return false;\n            }\n\n            this.buffer = parseInt(v, 10);\n\n            bar.css(\"width\", this.buffer + \"%\");\n\n            this._fireEvent(\"buffer-change\", {\n                val: this.buffer\n            });\n\n            if (this.buffer === 100) {\n                this._fireEvent(\"buffered\", {\n                    val: this.buffer\n                });\n            }\n        },\n\n        changeValue: function(){\n            this.val(this.element.attr('data-value'));\n        },\n\n        changeBuffer: function(){\n            this.buff(this.element.attr('data-buffer'));\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case 'data-value': this.changeValue(); break;\n                case 'data-buffer': this.changeBuffer(); break;\n            }\n        },\n\n        destroy: function(){\n            return this.element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var RadioDefaultConfig = {\n        radioDeferred: 0,\n        transition: true,\n        style: 1,\n        caption: \"\",\n        captionPosition: \"right\",\n        clsRadio: \"\",\n        clsCheck: \"\",\n        clsCaption: \"\",\n        onRadioCreate: Metro.noop\n    };\n\n    Metro.radioSetup = function (options) {\n        RadioDefaultConfig = $.extend({}, RadioDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroRadioSetup\"] !== undefined) {\n        Metro.radioSetup(window[\"metroRadioSetup\"]);\n    }\n\n    Metro.Component('radio', {\n        init: function( options, elem ) {\n            this._super(elem, options, RadioDefaultConfig, {\n                origin: {\n                    className: \"\"\n                }\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"radio-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var radio = $(\"<label>\").addClass(\"radio \" + element[0].className).addClass(o.style === 2 ? \"style2\" : \"\");\n            var check = $(\"<span>\").addClass(\"check\");\n            var caption = $(\"<span>\").addClass(\"caption\").html(o.caption);\n\n            element.attr(\"type\", \"radio\");\n\n            radio.insertBefore(element);\n            element.appendTo(radio);\n            check.appendTo(radio);\n            caption.appendTo(radio);\n\n            if (o.transition === true) {\n                radio.addClass(\"transition-on\");\n            }\n\n            if (o.captionPosition === 'left') {\n                radio.addClass(\"caption-left\");\n            }\n\n            this.origin.className = element[0].className;\n            element[0].className = '';\n\n            radio.addClass(o.clsRadio);\n            caption.addClass(o.clsCaption);\n            check.addClass(o.clsCheck);\n\n            if (element.is(':disabled')) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        _createEvents: function(){\n            var element = this.element, check = element.siblings(\".check\");\n\n            element.on(\"focus\", function(){\n                check.addClass(\"focused\");\n            });\n\n            element.on(\"blur\", function(){\n                check.removeClass(\"focused\");\n            });\n        },\n\n        disable: function(){\n            this.element.data(\"disabled\", true);\n            this.element.parent().addClass(\"disabled\");\n        },\n\n        enable: function(){\n            this.element.data(\"disabled\", false);\n            this.element.parent().removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        changeAttribute: function(attributeName){\n            var element = this.element, o = this.options;\n            var parent = element.parent();\n\n            var changeStyle = function(){\n                var new_style = parseInt(element.attr(\"data-style\"));\n\n                if (!Utils.isInt(new_style)) return;\n\n                o.style = new_style;\n                parent.removeClass(\"style1 style2\").addClass(\"style\"+new_style);\n            };\n\n            switch (attributeName) {\n                case 'disabled': this.toggleState(); break;\n                case 'data-style': changeStyle(); break;\n            }\n        },\n\n        destroy: function(){\n            return this.element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var RatingDefaultConfig = {\n        ratingDeferred: 0,\n        label: \"\",\n        static: false,\n        title: null,\n        value: 0,\n        values: null,\n        message: \"\",\n        stars: 5,\n        starColor: null,\n        staredColor: null,\n        roundFunc: \"round\", // ceil, floor, round\n        half: true,\n        clsRating: \"\",\n        clsTitle: \"\",\n        clsStars: \"\",\n        clsResult: \"\",\n        clsLabel: \"\",\n        onStarClick: Metro.noop,\n        onRatingCreate: Metro.noop\n    };\n\n    Metro.ratingSetup = function (options) {\n        RatingDefaultConfig = $.extend({}, RatingDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroRatingSetup\"] !== undefined) {\n        Metro.ratingSetup(window[\"metroRatingSetup\"]);\n    }\n\n    Metro.Component('rating', {\n        init: function( options, elem ) {\n            this._super(elem, options, RatingDefaultConfig, {\n                value: 0,\n                originValue: 0,\n                values: [],\n                rate: 0,\n                rating: null\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n            var i;\n\n            if (isNaN(o.value)) {\n                o.value = 0;\n            } else {\n                o.value = parseFloat(o.value).toFixed(1);\n            }\n\n            if (o.values !== null) {\n                if (Array.isArray(o.values)) {\n                    this.values = o.values;\n                } else if (typeof o.values === \"string\") {\n                    this.values = o.values.toArray()\n                }\n            } else {\n                for(i = 1; i <= o.stars; i++) {\n                    this.values.push(i);\n                }\n            }\n\n            this.originValue = o.value;\n            this.value = o.value > 0 ? Math[o.roundFunc](o.value) : 0;\n\n            this._createRating();\n            this._createEvents();\n\n            this._fireEvent(\"rating-create\", {\n                element: element\n            });\n        },\n\n        _createRating: function(){\n            var element = this.element, o = this.options;\n\n            var id = Utils.elementId(\"rating\");\n            var rating = $(\"<div>\").addClass(\"rating \" + String(element[0].className).replace(\"d-block\", \"d-flex\")).addClass(o.clsRating);\n            var i, stars, result, li;\n            var sheet = Metro.sheet;\n            var value = o.static ? Math.floor(this.originValue) : this.value;\n\n            element.val(this.value);\n\n            rating.attr(\"id\", id);\n\n            rating.insertBefore(element);\n            element.appendTo(rating);\n\n            stars = $(\"<ul>\").addClass(\"stars\").addClass(o.clsStars).appendTo(rating);\n\n            for(i = 1; i <= o.stars; i++) {\n                li = $(\"<li>\").data(\"value\", this.values[i-1]).appendTo(stars);\n                if (i <= value) {\n                    li.addClass(\"on\");\n                }\n            }\n\n            result = $(\"<span>\").addClass(\"result\").addClass(o.clsResult).appendTo(rating);\n\n            result.html(o.message);\n\n            if (o.starColor !== null && Metro.colors.isColor(o.starColor)) {\n                Utils.addCssRule(sheet, \"#\" + id + \" .stars:hover li\", \"color: \" + o.starColor + \";\");\n            }\n            if (o.staredColor !== null && Metro.colors.isColor(o.staredColor)) {\n                Utils.addCssRule(sheet, \"#\"+id+\" .stars li.on\", \"color: \"+o.staredColor+\";\");\n                Utils.addCssRule(sheet, \"#\"+id+\" .stars li.half::after\", \"color: \"+o.staredColor+\";\");\n            }\n\n            if (o.title !== null) {\n                var title = $(\"<span>\").addClass(\"title\").addClass(o.clsTitle).html(o.title);\n                rating.prepend(title);\n            }\n\n            if (o.static === true) {\n                rating.addClass(\"static\");\n                if (o.half === true){\n                    var dec = Math.round((this.originValue % 1) * 10);\n                    if (dec > 0 && dec <= 9) {\n                        rating.find('.stars li.on').last().next(\"li\").addClass(\"half half-\" + ( dec * 10));\n                    }\n                }\n            }\n\n            element[0].className = '';\n            if (o.copyInlineStyles === true) {\n                for (i = 0; i < element[0].style.length; i++) {\n                    rating.css(element[0].style[i], element.css(element[0].style[i]));\n                }\n            }\n\n            if (o.label) {\n                var label = $(\"<label>\").addClass(\"label-for-input\").addClass(o.clsLabel).html(o.label).insertBefore(rating);\n                if (element.attr(\"id\")) {\n                    label.attr(\"for\", element.attr(\"id\"));\n                }\n                if (element.attr(\"dir\") === \"rtl\") {\n                    label.addClass(\"rtl\");\n                }\n            }\n\n            if (element.is(\":disabled\")) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n\n            this.rating = rating;\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var rating = this.rating;\n\n            rating.on(Metro.events.click, \".stars li\", function(){\n\n                if (o.static === true) {\n                    return ;\n                }\n\n                var star = $(this);\n                var value = star.data(\"value\");\n                star.addClass(\"scale\");\n                setTimeout(function(){\n                    star.removeClass(\"scale\");\n                }, 300);\n                element.val(value).trigger(\"change\");\n                star.addClass(\"on\");\n                star.prevAll().addClass(\"on\");\n                star.nextAll().removeClass(\"on\");\n\n                that._fireEvent(\"star-click\", {\n                    value: value,\n                    star: star[0]\n                });\n\n            });\n        },\n\n        val: function(v){\n            var that = this, element = this.element, o = this.options;\n            var rating = this.rating;\n\n            if (v === undefined) {\n                return this.value;\n            }\n\n            this.value = v > 0 ? Math[o.roundFunc](v) : 0;\n            element.val(this.value).trigger(\"change\");\n\n            var stars = rating.find(\".stars li\").removeClass(\"on\");\n            $.each(stars, function(){\n                var star = $(this);\n                if (star.data(\"value\") <= that.value) {\n                    star.addClass(\"on\");\n                }\n            });\n\n            return this;\n        },\n\n        msg: function(m){\n            var rating = this.rating;\n            if (m ===  undefined) {\n                return ;\n            }\n            rating.find(\".result\").html(m);\n            return this;\n        },\n\n        static: function (mode) {\n            var o = this.options;\n            var rating = this.rating;\n\n            o.static = mode;\n\n            if (mode === true) {\n                rating.addClass(\"static\");\n            } else {\n                rating.removeClass(\"static\");\n            }\n        },\n\n        changeAttributeValue: function(a){\n            var element = this.element;\n            var value = a === \"value\" ? element.val() : element.attr(\"data-value\");\n            this.val(value);\n        },\n\n        changeAttributeMessage: function(){\n            var element = this.element;\n            var message = element.attr(\"data-message\");\n            this.msg(message);\n        },\n\n        changeAttributeStatic: function(){\n            var element = this.element;\n            var isStatic = JSON.parse(element.attr(\"data-static\")) === true;\n\n            this.static(isStatic);\n        },\n\n        disable: function(){\n            this.element.data(\"disabled\", true);\n            this.element.parent().addClass(\"disabled\");\n        },\n\n        enable: function(){\n            this.element.data(\"disabled\", false);\n            this.element.parent().removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case \"value\":\n                case \"data-value\": this.changeAttributeValue(attributeName); break;\n                case \"disabled\": this.toggleState(); break;\n                case \"data-message\": this.changeAttributeMessage(); break;\n                case \"data-static\": this.changeAttributeStatic(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n            var rating = this.rating;\n\n            rating.off(Metro.events.click, \".stars li\");\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var ResizableDefaultConfig = {\n        resizableDeferred: 0,\n        canResize: true,\n        resizeElement: \".resize-element\",\n        minWidth: 0,\n        minHeight: 0,\n        maxWidth: 0,\n        maxHeight: 0,\n        preserveRatio: false,\n        onResizeStart: Metro.noop,\n        onResizeStop: Metro.noop,\n        onResize: Metro.noop,\n        onResizableCreate: Metro.noop\n    };\n\n    Metro.resizableSetup = function (options) {\n        ResizableDefaultConfig = $.extend({}, ResizableDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroResizableSetup\"] !== undefined) {\n        Metro.resizableSetup(window[\"metroResizableSetup\"]);\n    }\n\n    Metro.Component('resizable', {\n        init: function( options, elem ) {\n            this._super(elem, options, ResizableDefaultConfig, {\n                resizer: null,\n                id: Utils.elementId(\"resizable\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"resizable-create\");\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n\n            element.data(\"canResize\", true);\n            element.addClass(\"resizable-element\");\n\n            if (Utils.isValue(o.resizeElement) && element.find(o.resizeElement).length > 0) {\n                this.resizer = element.find(o.resizeElement);\n            } else {\n                this.resizer = $(\"<span>\").addClass(\"resize-element\").appendTo(element);\n            }\n\n            element.data(\"canResize\", o.canResize);\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n\n            this.resizer.on(Metro.events.start, function(e){\n\n                if (element.data('canResize') === false) {\n                    return ;\n                }\n\n                var startXY = Utils.pageXY(e);\n                var startWidth = parseInt(element.outerWidth());\n                var startHeight = parseInt(element.outerHeight());\n                var size = {width: startWidth, height: startHeight};\n\n                element.addClass(\"stop-pointer\");\n\n                that._fireEvent(\"resize-start\", {\n                    size: size\n                });\n\n                $(document).on(Metro.events.move, function(e){\n                    var moveXY = Utils.pageXY(e);\n                    var size = {\n                        width: startWidth + moveXY.x - startXY.x,\n                        height: startHeight + moveXY.y - startXY.y\n                    };\n\n                    if (o.maxWidth > 0 && size.width > o.maxWidth) {return true;}\n                    if (o.minWidth > 0 && size.width < o.minWidth) {return true;}\n\n                    if (o.maxHeight > 0 && size.height > o.maxHeight) {return true;}\n                    if (o.minHeight > 0 && size.height < o.minHeight) {return true;}\n\n                    element.css(size);\n\n                    that._fireEvent(\"resize\", {\n                        size: size\n                    })\n\n                }, {ns: that.id});\n\n                $(document).on(Metro.events.stop, function(){\n                    element.removeClass(\"stop-pointer\");\n\n                    $(document).off(Metro.events.move, {ns: that.id});\n                    $(document).off(Metro.events.stop, {ns: that.id});\n\n                    var size = {\n                        width: parseInt(element.outerWidth()),\n                        height: parseInt(element.outerHeight())\n                    };\n\n                    that._fireEvent(\"resize-stop\", {\n                        size: size\n                    });\n\n                }, {ns: that.id});\n\n                e.preventDefault();\n                e.stopPropagation();\n            });\n\n        },\n\n        off: function(){\n            this.element.data(\"canResize\", false);\n        },\n\n        on: function(){\n            this.element.data(\"canResize\", true);\n        },\n\n        changeAttribute: function(attributeName){\n            var element = this.element, o = this.options;\n\n            var canResize = function(){\n                o.canResize = JSON.parse(element.attr('data-can-resize')) === true;\n            };\n\n            switch (attributeName) {\n                case \"data-can-resize\": canResize(); break;\n            }\n        },\n\n        destroy: function(){\n            this.resizer.off(Metro.events.start);\n            return this.element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var ResizerDefaultConfig = {\n        resizerDeferred: 0,\n        onMediaPoint: Metro.noop,\n        onMediaPointEnter: Metro.noop,\n        onMediaPointLeave: Metro.noop,\n        onWindowResize: Metro.noop,\n        onElementResize: Metro.noop,\n        onResizerCreate: Metro.noop\n    };\n\n    Metro.resizerSetup = function (options) {\n        ResizerDefaultConfig = $.extend({}, ResizerDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroResizerSetup\"] !== undefined) {\n        Metro.resizerSetup(window[\"metroResizerSetup\"]);\n    }\n\n    Metro.Component('resizer', {\n        init: function( options, elem ) {\n            this._super(elem, options, ResizerDefaultConfig, {\n                size: {width: 0, height: 0},\n                media: window.METRO_MEDIA,\n                id: Utils.elementId(\"resizer\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this.size = {\n                width: element.width(),\n                height: element.height()\n            };\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"resizer-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element;\n            var win = $.window();\n\n            win.on(\"resize\", function(){\n                var windowWidth = win.width(), windowHeight = win.height();\n                var elementWidth = element.width(), elementHeight = element.height();\n                var oldSize = that.size;\n                var point;\n\n                that._fireEvent(\"window-resize\", {\n                    width: windowWidth,\n                    height: windowHeight,\n                    media: window.METRO_MEDIA\n                });\n\n                if (that.size.width !== elementWidth || that.size.height !== elementHeight) {\n                    that.size = {\n                        width: elementWidth,\n                        height: elementHeight\n                    };\n\n                    that._fireEvent(\"element-resize\", {\n                        width: elementWidth,\n                        height: elementHeight,\n                        oldSize: oldSize,\n                        media: window.METRO_MEDIA\n                    });\n\n                }\n\n                if (that.media.length !== window.METRO_MEDIA.length) {\n                    if (that.media.length > window.METRO_MEDIA.length) {\n                        point = that.media.filter(function(x){\n                            return !window.METRO_MEDIA.includes(x);\n                        });\n\n                        that._fireEvent(\"media-point-leave\", {\n                            point: point,\n                            media: window.METRO_MEDIA\n                        });\n\n                    } else {\n                        point = window.METRO_MEDIA.filter(function(x){\n                            return !that.media.includes(x);\n                        });\n\n                        that._fireEvent(\"media-point-enter\", {\n                            point: point,\n                            media: window.METRO_MEDIA\n                        });\n                    }\n\n                    that.media = window.METRO_MEDIA;\n\n                    that._fireEvent(\"media-point\", {\n                        point: point,\n                        media: window.METRO_MEDIA\n                    });\n                }\n            }, {ns: this.id});\n        },\n\n        changeAttribute: function(){\n        },\n\n        destroy: function(){\n            $(window).off(\"resize\", {ns: this.id});\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var RibbonMenuDefaultConfig = {\n        ribbonmenuDeferred: 0,\n        onStatic: Metro.noop,\n        onBeforeTab: Metro.noop_true,\n        onTab: Metro.noop,\n        onRibbonMenuCreate: Metro.noop\n    };\n\n    Metro.ribbonMenuSetup = function (options) {\n        RibbonMenuDefaultConfig = $.extend({}, RibbonMenuDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroRibbonMenuSetup\"] !== undefined) {\n        Metro.ribbonMenuSetup(window[\"metroRibbonMenuSetup\"]);\n    }\n\n    Metro.Component('ribbon-menu', {\n        init: function( options, elem ) {\n            this._super(elem, options, RibbonMenuDefaultConfig);\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"ribbon-menu-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var element = this.element;\n\n            element.addClass(\"ribbon-menu\");\n\n            var tabs = element.find(\".tabs-holder li:not(.static)\");\n            var active_tab = element.find(\".tabs-holder li.active\");\n            if (active_tab.length > 0) {\n                this.open($(active_tab[0]));\n            } else {\n                if (tabs.length > 0) {\n                    this.open($(tabs[0]));\n                }\n            }\n\n            var fluentGroups = element.find(\".ribbon-toggle-group\");\n            $.each(fluentGroups, function(){\n                var g = $(this);\n                g.buttongroup({\n                    clsActive: \"active\"\n                });\n\n                var gw = 0;\n                var btns = g.find(\".ribbon-icon-button\");\n                $.each(btns, function(){\n                    var b = $(this);\n                    var w = b.outerWidth(true);\n                    if (w > gw) gw = w;\n                });\n\n                g.css(\"width\", gw * Math.ceil(btns.length / 3) + 4);\n            });\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n\n            element.on(Metro.events.click, \".tabs-holder li a\", function(e){\n                var link = $(this);\n                var tab = $(this).parent(\"li\");\n\n                if (tab.hasClass(\"static\")) {\n                    if (o.onStatic === Metro.noop && link.attr(\"href\") !== undefined) {\n                        document.location.href = link.attr(\"href\");\n                    } else {\n                        that._fireEvent(\"static\", {\n                            tab: tab[0]\n                        });\n                    }\n                } else {\n                    if (Utils.exec(o.onBeforeTab, [tab[0]], element[0]) === true) {\n                        that.open(tab[0]);\n                    }\n                }\n                e.preventDefault();\n            })\n        },\n\n        open: function(tab){\n            var element = this.element;\n            var $tab = $(tab);\n            var tabs = element.find(\".tabs-holder li\");\n            var sections = element.find(\".content-holder .section\");\n            var target = $tab.children(\"a\").attr(\"href\");\n            var target_section = target !== \"#\" ? element.find(target) : null;\n\n            tabs.removeClass(\"active\");\n            $tab.addClass(\"active\");\n\n            sections.removeClass(\"active\");\n            if (target_section) target_section.addClass(\"active\");\n\n            this._fireEvent(\"tab\", {\n                tab: $tab[0]\n            });\n        },\n\n        changeAttribute: function(){\n        },\n\n        destroy: function(){\n            var element = this.element;\n            element.off(Metro.events.click, \".tabs-holder li a\");\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var RippleDefaultConfig = {\n        rippleDeferred: 0,\n        rippleColor: \"#fff\",\n        rippleAlpha: .4,\n        rippleTarget: \"default\",\n        onRippleCreate: Metro.noop\n    };\n\n    Metro.rippleSetup = function (options) {\n        RippleDefaultConfig = $.extend({}, RippleDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroRippleSetup\"] !== undefined) {\n        Metro.rippleSetup(window[\"metroRippleSetup\"]);\n    }\n\n    var getRipple = function(target, color, alpha, event){\n        var el = $(target);\n        var rect = Utils.rect(el[0]);\n        var x, y;\n        var Colors = Metro.colors;\n\n        if (el.length === 0) {\n            return ;\n        }\n\n        if (!Utils.isValue(color)) {\n            color = \"#fff\";\n        }\n\n        if (!Utils.isValue(alpha)) {\n            alpha = .4;\n        }\n\n        if (el.css('position') === 'static') {\n            el.css('position', 'relative');\n        }\n\n        el.css({\n            overflow: 'hidden'\n        });\n\n        $(\".ripple\").remove();\n\n        var size = Math.max(el.outerWidth(), el.outerHeight());\n\n        // Add the element\n        var ripple = $(\"<span class='ripple'></span>\").css({\n            width: size,\n            height: size\n        });\n\n        el.prepend(ripple);\n\n        if (event) {\n            // Get touch point x, y\n            x = event.pageX - el.offset().left - ripple.width()/2;\n            y = event.pageY - el.offset().top - ripple.height()/2;\n        } else {\n            // Get the center of the element\n            x = rect.width / 2 - ripple.width()/2;\n            y = rect.height / 2 - ripple.height()/2;\n        }\n\n        ripple.css({\n            background: Colors.toRGBA(color, alpha),\n            width: size,\n            height: size,\n            top: y + 'px',\n            left: x + 'px'\n        }).addClass(\"rippleEffect\");\n\n        setTimeout(function(){\n            ripple.remove();\n        }, 400);\n    };\n\n    Metro.Component('ripple', {\n        init: function( options, elem ) {\n            this._super(elem, options, RippleDefaultConfig);\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n            var target = o.rippleTarget === 'default' ? null : o.rippleTarget;\n\n            element.on(Metro.events.click, target, function(e){\n                getRipple(this, o.rippleColor, o.rippleAlpha, e);\n            });\n\n            this._fireEvent(\"riopple-create\", {\n                element: element\n            });\n        },\n\n        changeAttribute: function(attributeName){\n            var element = this.element, o = this.options;\n\n            function changeColor(){\n                var color = element.attr(\"data-ripple-color\");\n                if (!Metro.colors.isColor(color)) {\n                    return;\n                }\n                o.rippleColor = color;\n            }\n\n            function changeAlpha(){\n                var alpha = +element.attr(\"data-ripple-alpha\");\n                if (isNaN(alpha)) {\n                    return;\n                }\n                o.rippleColor = alpha;\n            }\n\n            switch (attributeName) {\n                case \"data-ripple-color\": changeColor(); break;\n                case \"data-ripple-alpha\": changeAlpha(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element, o = this.options;\n            var target = o.rippleTarget === 'default' ? null : o.rippleTarget;\n            element.off(Metro.events.click, target);\n        }\n    });\n\n    Metro.ripple = getRipple;\n}(Metro, m4q));\r\n\r\n/* eslint-disable */\n(function(Metro, $) {\n    'use strict';\n\n    var SearcherDefaultConfig = {\n        onSearcherCreate: Metro.noop\n    };\n\n    Metro.searcherSetup = function (options) {\n        SearcherDefaultConfig = $.extend({}, SearcherDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroSearcherSetup\"] !== undefined) {\n        Metro.searcherSetup(window[\"metroSearcherSetup\"]);\n    }\n\n    Metro.Component('searcher', {\n        init: function( options, elem ) {\n            this._super(elem, options, SearcherDefaultConfig, {\n                // define instance vars here\n            });\n            return this;\n        },\n\n        _create: function(){\n            var that = this, element = this.element, o = this.options;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent('searcher-create');\n        },\n\n        _createStructure: function(){\n            var that = this, element = this.element, o = this.options;\n\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n\n        },\n\n        changeAttribute: function(attr, newValue){\n        },\n\n        destroy: function(){\n            this.element.remove();\n        }\n    });\n}(Metro, m4q));\n/* eslint-enable */\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var SelectDefaultConfig = {\n        label: \"\",\n        size: \"normal\",\n        selectDeferred: 0,\n        clearButton: false,\n        clearButtonIcon: \"<span class='default-icon-cross'></span>\",\n        usePlaceholder: false,\n        placeholder: \"\",\n        addEmptyValue: false,\n        emptyValue: \"\",\n        duration: 0,\n        prepend: \"\",\n        append: \"\",\n        filterPlaceholder: \"Search...\",\n        filter: true,\n        copyInlineStyles: false,\n        dropHeight: 200,\n        dropWidth: null,\n        dropFullSize: false,\n        checkDropUp: true,\n        dropUp: false,\n        showGroupName: false,\n        shortTag: true,\n\n        clsSelect: \"\",\n        clsSelectInput: \"\",\n        clsPrepend: \"\",\n        clsAppend: \"\",\n        clsOption: \"\",\n        clsOptionActive: \"\",\n        clsOptionGroup: \"\",\n        clsDropList: \"\",\n        clsDropContainer: \"\",\n        clsSelectedItem: \"\",\n        clsSelectedItemRemover: \"\",\n        clsLabel: \"\",\n        clsGroupName: \"\",\n\n        onClear: Metro.noop,\n        onChange: Metro.noop,\n        onUp: Metro.noop,\n        onDrop: Metro.noop,\n        onItemSelect: Metro.noop,\n        onItemDeselect: Metro.noop,\n        onSelectCreate: Metro.noop\n    };\n\n    Metro.selectSetup = function (options) {\n        SelectDefaultConfig = $.extend({}, SelectDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroSelectSetup\"] !== undefined) {\n        Metro.selectSetup(window[\"metroSelectSetup\"]);\n    }\n\n    Metro.Component('select', {\n        init: function( options, elem ) {\n            this._super(elem, options, SelectDefaultConfig, {\n                list: null,\n                placeholder: null\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createSelect();\n            this._createEvents();\n\n            this._fireEvent(\"select-create\", {\n                element: element\n            });\n        },\n\n        _setPlaceholder: function(){\n            var element = this.element, o = this.options;\n            var input = element.siblings(\".select-input\");\n            if (o.usePlaceholder === true && (!Utils.isValue(element.val()) || element.val() == o.emptyValue)) {\n                input.html(this.placeholder);\n            }\n        },\n\n        _addTag: function(val, data){\n            var element = this.element, o = this.options;\n            var tag, tagSize, container = element.closest(\".select\");\n            tag = $(\"<div>\").addClass(\"tag\").addClass(o.shortTag ? \"short-tag\" : \"\").addClass(o.clsSelectedItem).html(\"<span class='title'>\"+val+\"</span>\").data(\"option\", data);\n            $(\"<span>\").addClass(\"remover\").addClass(o.clsSelectedItemRemover).html(\"&times;\").appendTo(tag);\n\n            if (container.hasClass(\"input-large\")) {\n                tagSize = \"large\";\n            } else if (container.hasClass(\"input-small\")) {\n                tagSize = \"small\"\n            }\n\n            tag.addClass(tagSize);\n\n            return tag;\n        },\n\n        _addOption: function(item, parent, input, multiple, group){\n            var option = $(item);\n            var l, a;\n            var element = this.element, o = this.options;\n            var html = Utils.isValue(option.attr('data-template')) ? option.attr('data-template').replace(\"$1\", item.text):item.text;\n            var displayValue = option.attr(\"data-display\");\n\n            l = $(\"<li>\").addClass(o.clsOption).data(\"option\", item).attr(\"data-text\", item.text).attr('data-value', item.value ? item.value : \"\");\n            a = $(\"<a>\").html(html);\n\n            if (displayValue) {\n                l.attr(\"data-display\", displayValue);\n                html = displayValue;\n            }\n\n            l.addClass(item.className);\n\n            l.data(\"group\", group);\n\n            if (option.is(\":disabled\")) {\n                l.addClass(\"disabled\");\n            }\n\n            if (option.is(\":selected\")) {\n\n                if (o.showGroupName && group) {\n                    html += \"&nbsp;<span class='selected-item__group-name \"+o.clsGroupName+\"'>\" + group + \"</span>\";\n                }\n\n                if (multiple) {\n                    l.addClass(\"d-none\");\n                    input.append(this._addTag(html, l));\n                } else {\n                    element.val(item.value);\n                    input.html(html);\n                    element.fire(\"change\", {\n                        val: item.value\n                    });\n                    l.addClass(\"active\");\n                }\n            }\n\n            l.append(a).appendTo(parent);\n        },\n\n        _addOptionGroup: function(item, parent, input, multiple){\n            var that = this, o = this.options;\n            var group = $(item);\n\n            $(\"<li>\").html(item.label).addClass(\"group-title\").addClass(o.clsOptionGroup).appendTo(parent);\n\n            $.each(group.children(), function(){\n                that._addOption(this, parent, input, multiple, item.label);\n            })\n        },\n\n        _createOptions: function(){\n            var that = this, element = this.element, o = this.options, select = element.parent();\n            var list = select.find(\"ul\").empty();\n            var selected = element.find(\"option[selected]\").length > 0;\n            var multiple = element[0].multiple;\n            var input = element.siblings(\".select-input\");\n\n            element.siblings(\".select-input\").empty();\n\n            if (o.addEmptyValue === true) {\n                element.prepend($(\"<option \"+(!selected ? 'selected' : '')+\" value='\"+o.emptyValue+\"' class='d-none'></option>\"));\n            }\n\n            $.each(element.children(), function(){\n                if (this.tagName === \"OPTION\") {\n                    that._addOption(this, list, input, multiple, null);\n                } else if (this.tagName === \"OPTGROUP\") {\n                    that._addOptionGroup(this, list, input, multiple);\n                }\n            });\n        },\n\n        _createSelect: function(){\n            var that = this, element = this.element, o = this.options;\n\n            var container = $(\"<label>\").addClass(\"select \" + element[0].className).addClass(o.clsSelect);\n            var multiple = element[0].multiple;\n            var select_id = Utils.elementId(\"select\");\n            var buttons = $(\"<div>\").addClass(\"button-group\");\n            var input, drop_container, drop_container_input, list, filter_input, dropdown_toggle;\n            var checkboxID = Utils.elementId(\"select-focus-trigger\");\n            var checkbox = $(\"<input type='checkbox'>\").addClass(\"select-focus-trigger\").attr(\"id\", checkboxID);\n\n            this.placeholder = $(\"<span>\").addClass(\"placeholder\").html(o.placeholder);\n\n            container.attr(\"id\", select_id).attr(\"for\", checkboxID);\n            container.addClass(\"input-\" + o.size);\n\n            dropdown_toggle = $(\"<span>\").addClass(\"dropdown-toggle\");\n            dropdown_toggle.appendTo(container);\n\n            if (multiple) {\n                container.addClass(\"multiple\");\n            }\n\n            container.insertBefore(element);\n            element.appendTo(container);\n            buttons.appendTo(container);\n            checkbox.appendTo(container);\n\n            input = $(\"<div>\").addClass(\"select-input\").addClass(o.clsSelectInput).attr(\"name\", \"__\" + select_id + \"__\");\n            drop_container = $(\"<div>\").addClass(\"drop-container\").addClass(o.clsDropContainer);\n\n            if (o.dropFullSize === false) {\n                if (o.dropWidth) {\n                    drop_container.css({\n                        width: +o.dropWidth\n                    })\n                }\n            } else {\n                container.addClass(\"drop-full-size\")\n            }\n\n            drop_container_input = $(\"<div>\").appendTo(drop_container);\n            list = $(\"<ul>\").addClass(\"option-list\").addClass(o.clsDropList).css({\n                \"max-height\": o.dropHeight\n            });\n            filter_input = $(\"<input type='text' data-role='input'>\").attr(\"placeholder\", o.filterPlaceholder).appendTo(drop_container_input);\n\n            container.append(input);\n            container.append(drop_container);\n\n            drop_container.append(drop_container_input);\n\n            if (o.filter !== true) {\n                drop_container_input.hide();\n            }\n\n            drop_container.append(list);\n\n            this._createOptions();\n\n            this._setPlaceholder();\n\n            Metro.makePlugin(drop_container, \"dropdown\", {\n                dropFilter: \".select\",\n                duration: o.duration,\n                toggleElement: [container],\n                checkDropUp: o.checkDropUp,\n                dropUp: o.dropUp,\n                onDrop: function(){\n                    var dropped, target;\n                    dropdown_toggle.addClass(\"active-toggle\");\n                    dropped = $(\".select .drop-container\");\n                    $.each(dropped, function(){\n                        var drop = $(this);\n                        if (drop.is(drop_container)) {\n                            return ;\n                        }\n                        var dataDrop = Metro.getPlugin(drop, 'dropdown');\n                        if (dataDrop && dataDrop.close) {\n                            dataDrop.close();\n                        }\n                    });\n\n                    filter_input.val(\"\").trigger(Metro.events.keyup);//.focus();\n\n                    target = list.find(\"li.active\").length > 0 ? $(list.find(\"li.active\")[0]) : undefined;\n                    if (target !== undefined) {\n                        list[0].scrollTop = target.position().top - ( (list.height() - target.height() )/ 2);\n                    }\n\n                    that._fireEvent(\"drop\", {\n                        list: list[0]\n                    });\n                },\n                onUp: function(){\n                    dropdown_toggle.removeClass(\"active-toggle\");\n\n                    that._fireEvent(\"up\", {\n                        list: list[0]\n                    });\n                }\n            });\n\n            this.list = list;\n\n            if (o.clearButton === true && !element[0].readOnly) {\n                var clearButton = $(\"<button>\").addClass(\"button input-clear-button\").addClass(o.clsClearButton).attr(\"tabindex\", -1).attr(\"type\", \"button\").html(o.clearButtonIcon);\n                clearButton.appendTo(buttons);\n            } else {\n                buttons.addClass(\"d-none\");\n            }\n\n            if (o.prepend !== \"\" && !multiple) {\n                var prepend = $(\"<div>\").html(o.prepend);\n                prepend.addClass(\"prepend\").addClass(o.clsPrepend).appendTo(container);\n            }\n\n            if (o.append !== \"\" && !multiple) {\n                var append = $(\"<div>\").html(o.append);\n                append.addClass(\"append\").addClass(o.clsAppend).appendTo(container);\n            }\n\n            if (o.copyInlineStyles === true) {\n                for (var i = 0, l = element[0].style.length; i < l; i++) {\n                    container.css(element[0].style[i], element.css(element[0].style[i]));\n                }\n            }\n\n            if (element.attr('dir') === 'rtl' ) {\n                container.addClass(\"rtl\").attr(\"dir\", \"rtl\");\n            }\n\n            if (o.label) {\n                var label = $(\"<label>\").addClass(\"label-for-input\").addClass(o.clsLabel).html(o.label).insertBefore(container);\n                if (element.attr(\"id\")) {\n                    label.attr(\"for\", element.attr(\"id\"));\n                }\n                if (element.attr(\"dir\") === \"rtl\") {\n                    label.addClass(\"rtl\");\n                }\n            }\n\n            if (element.is(':disabled')) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var container = element.closest(\".select\");\n            var drop_container = container.find(\".drop-container\");\n            var input = element.siblings(\".select-input\");\n            var filter_input = drop_container.find(\"input\");\n            var list = drop_container.find(\"ul\");\n            var clearButton = container.find(\".input-clear-button\");\n            var checkbox = container.find(\".select-focus-trigger\");\n\n            checkbox.on(\"focus\", function(){\n                container.addClass(\"focused\");\n            });\n\n            checkbox.on(\"blur\", function(){\n                container.removeClass(\"focused\");\n            });\n\n            clearButton.on(Metro.events.click, function(e){\n                element.val(o.emptyValue);\n                if (element[0].multiple) {\n                    list.find(\"li\").removeClass(\"d-none\");\n                }\n\n                input.clear();\n                that._setPlaceholder();\n\n                e.preventDefault();\n                e.stopPropagation();\n\n                that._fireEvent(\"clear\");\n                that._fireEvent(\"change\", {\n                    selected: that.getSelected()\n                });\n            });\n\n            element.on(Metro.events.change, function(){\n                that._setPlaceholder();\n            });\n\n            container.on(Metro.events.click, function(){\n                $(\".focused\").removeClass(\"focused\");\n                container.addClass(\"focused\");\n            });\n\n            input.on(Metro.events.click, function(){\n                $(\".focused\").removeClass(\"focused\");\n                container.addClass(\"focused\");\n            });\n\n            list.on(Metro.events.click, \"li\", function(e){\n                if ($(this).hasClass(\"group-title\")) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    return ;\n                }\n                var leaf = $(this);\n                var displayValue = leaf.attr(\"data-display\");\n                var val = leaf.data('value');\n                var group = leaf.data('group');\n                var html = displayValue ? displayValue : leaf.children('a').html();\n                var selected;\n                var option = leaf.data(\"option\");\n                var options = element.find(\"option\");\n\n                if (o.showGroupName && group) {\n                    html += \"&nbsp;<span class='selected-item__group-name \"+o.clsGroupName+\"'>\" + group + \"</span>\";\n                }\n\n                if (element[0].multiple) {\n                    leaf.addClass(\"d-none\");\n                    input.append(that._addTag(html, leaf));\n                } else {\n                    list.find(\"li.active\").removeClass(\"active\").removeClass(o.clsOptionActive);\n                    leaf.addClass(\"active\").addClass(o.clsOptionActive);\n                    input.html(html);\n                    Metro.getPlugin(drop_container, \"dropdown\").close();\n                }\n\n                $.each(options, function(){\n                    if (this === option) {\n                        this.selected = true;\n                    }\n                });\n\n                that._fireEvent(\"item-select\", {\n                    val: val,\n                    option: option,\n                    leaf: leaf[0]\n                });\n\n                selected = that.getSelected();\n\n                that._fireEvent(\"change\", {\n                    selected: selected\n                });\n            });\n\n            input.on(\"click\", \".tag .remover\", function(e){\n                var item = $(this).closest(\".tag\");\n                var leaf = item.data(\"option\");\n                var option = leaf.data('option');\n                var selected;\n\n                leaf.removeClass(\"d-none\");\n                $.each(element.find(\"option\"), function(){\n                    if (this === option) {\n                        this.selected = false;\n                    }\n                });\n                item.remove();\n\n                that._fireEvent(\"item-deselect\", {\n                    option: option\n                });\n\n                selected = that.getSelected();\n\n                that._fireEvent(\"change\", {\n                    selected: selected\n                });\n\n                e.preventDefault();\n                e.stopPropagation();\n            });\n\n            filter_input.on(Metro.events.keyup, function(){\n                var filter = this.value.toUpperCase();\n                var li = list.find(\"li\");\n                var i, a;\n                for (i = 0; i < li.length; i++) {\n                    if ($(li[i]).hasClass(\"group-title\")) continue;\n                    a = li[i].getElementsByTagName(\"a\")[0];\n                    if (a.innerHTML.toUpperCase().indexOf(filter) > -1) {\n                        li[i].style.display = \"\";\n                    } else {\n                        li[i].style.display = \"none\";\n                    }\n                }\n            });\n\n            filter_input.on(Metro.events.click, function(e){\n                e.preventDefault();\n                e.stopPropagation();\n            });\n\n            drop_container.on(Metro.events.click, function(e){\n                e.preventDefault();\n                e.stopPropagation();\n            });\n        },\n\n        disable: function(){\n            this.element.data(\"disabled\", true);\n            this.element.closest(\".select\").addClass(\"disabled\");\n        },\n\n        enable: function(){\n            this.element.data(\"disabled\", false);\n            this.element.closest(\".select\").removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        reset: function(to_default){\n            var element = this.element;\n            var options = element.find(\"option\");\n            var select = element.closest('.select');\n            var selected;\n\n            $.each(options, function(){\n                this.selected = !Utils.isNull(to_default) ? this.defaultSelected : false;\n            });\n\n            this.list.find(\"li\").remove();\n            select.find(\".select-input\").html('');\n\n            this._createOptions();\n\n            selected = this.getSelected();\n\n            this._fireEvent(\"change\", {\n                selected: selected\n            });\n        },\n\n        getSelected: function(){\n            var element = this.element;\n            var result = [];\n\n            element.find(\"option\").each(function(){\n                if (this.selected) result.push(this.value);\n            });\n\n            return result;\n        },\n\n        val: function(val){\n            var that = this, element = this.element, o = this.options;\n            var input = element.siblings(\".select-input\");\n            var options = element.find(\"option\");\n            var list_items = this.list.find(\"li\");\n            var result = [];\n            var multiple = element.attr(\"multiple\") !== undefined;\n            var option;\n            var i, html, list_item, option_value, selected, group;\n\n            if (Utils.isNull(val)) {\n                $.each(options, function(){\n                    if (this.selected) result.push(this.value);\n                });\n                return multiple ? result : result[0];\n            }\n\n            $.each(options, function(){\n                this.selected = false;\n            });\n            list_items.removeClass(\"active\").removeClass(o.clsOptionActive);\n            input.html('');\n\n            if (Array.isArray(val) === false) {\n                val  = [val];\n            }\n\n            $.each(val, function(){\n                for (i = 0; i < options.length; i++) {\n                    option = options[i];\n                    html = Utils.isValue(option.getAttribute('data-template')) ? option.getAttribute('data-template').replace(\"$1\", option.text) : option.text;\n                    if (\"\"+option.value === \"\"+this) {\n                        option.selected = true;\n                        break;\n                    }\n                }\n\n                for(i = 0; i < list_items.length; i++) {\n                    list_item = $(list_items[i]);\n                    group = list_item.data(\"group\");\n                    option_value = list_item.attr(\"data-value\");\n                    if (\"\"+option_value === \"\"+this) {\n\n                        if (o.showGroupName && group) {\n                            html += \"&nbsp;<span class='selected-item__group-name'>\" + group + \"</span>\";\n                        }\n\n                        if (multiple) {\n                            list_item.addClass(\"d-none\");\n                            input.append(that._addTag(html, list_item));\n\n                            // tag = $(\"<div>\").addClass(\"tag\").addClass(o.clsSelectedItem).html(\"<span class='title'>\"+html+\"</span>\").appendTo(input);\n                            // tag.data(\"option\", list_item);\n                            // $(\"<span>\").addClass(\"remover\").addClass(o.clsSelectedItemRemover).html(\"&times;\").appendTo(tag);\n                        } else {\n                            list_item.addClass(\"active\").addClass(o.clsOptionActive);\n                            input.html(html);\n                        }\n                        break;\n                    }\n                }\n            });\n\n            selected = this.getSelected();\n\n            this._fireEvent(\"change\", {\n                selected: selected\n            });\n        },\n\n        options: function(op, selected, delimiter){\n            return this.data(op, selected, delimiter);\n        },\n\n        data: function(op, selected, delimiter){\n            var element = this.element;\n            var option_group, _selected;\n            var _delimiter = delimiter || \",\";\n\n            if (typeof selected === \"string\") {\n                _selected = selected.toArray(_delimiter).map(function(v){\n                    return isNaN(v) ? v : +v;\n                });\n            } else if (Array.isArray(selected)) {\n                _selected = selected.slice().map(function(v){\n                    return isNaN(v) ? v : +v;\n                });\n            } else {\n                _selected = [];\n            }\n\n            element.empty();\n\n            if (typeof op === 'string') {\n                element.html(op);\n            } else if (Utils.isObject2(op)) {\n                $.each(op, function(key, val){\n                    if (Utils.isObject2(val)) {\n                        option_group = $(\"<optgroup label=''>\").attr(\"label\", key).appendTo(element);\n                        $.each(val, function(key2, val2){\n                            var op = $(\"<option>\").attr(\"value\", key2).text(val2).appendTo(option_group);\n                            if (_selected.indexOf(+key2) > -1) {\n                                op.prop(\"selected\", true);\n                            }\n                        });\n                    } else {\n                        var op = $(\"<option>\").attr(\"value\", key).text(val).appendTo(element);\n                        if (_selected.indexOf(key) > -1) {\n                            op.prop(\"selected\", true);\n                        }\n                    }\n                });\n            }\n\n            this._createOptions();\n\n            return this;\n        },\n\n        addOption: function(val, title, selected){\n            var element = this.element;\n            var option = $(\"<option>\").attr(\"value\", val).text(title ? title : val)\n\n            element.append(option)\n\n            if (selected) {\n                option.prop(\"selected\", true)\n            }\n\n            this._createOptions();\n\n            return this;\n        },\n\n        addOptions: function(values){\n            var that = this;\n\n            if (!values) {\n                return this;\n            }\n\n            if (Array.isArray(values)) {\n                $.each(values, function(){\n                    var o = this;\n                    if (Metro.utils.isObject2(o)) {\n                        that.addOption(o.val, o.title, o.selected)\n                    } else {\n                        that.addOption(o)\n                    }\n                })\n            } else if (Metro.utils.isObject2(values)) {\n                $.each(values, function(key, val){\n                    that.addOption(key, val);\n                })\n            }\n\n            return this;\n        },\n\n        removeOption: function(val){\n            var element = this.element;\n            var options = element.find(\"option\")\n\n            options.each(function(){\n                var $el = $(this)\n\n                if ($el.attr(\"value\") == val) {\n                    $el.remove()\n                }\n            })\n\n            this._createOptions();\n\n            return this;\n        },\n\n        removeOptions: function(values){\n            var element = this.element;\n            var options = element.find(\"option\")\n\n            if (!values || !Array.isArray(values)) {\n                return this;\n            }\n\n            options.each(function(){\n                var $el = $(this);\n                var val = $el.attr(\"value\");\n\n                if (values.indexOf(val) > -1) {\n                    $el.remove()\n                }\n            })\n\n            this._createOptions();\n\n            return this;\n        },\n\n        changeAttribute: function(attributeName){\n            if (attributeName === 'disabled') {\n                this.toggleState();\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n            var container = element.closest(\".select\");\n            var drop_container = container.find(\".drop-container\");\n            var input = element.siblings(\".select-input\");\n            var filter_input = drop_container.find(\"input\");\n            var list = drop_container.find(\"ul\");\n            var clearButton = container.find(\".input-clear-button\");\n\n            container.off(Metro.events.click);\n            container.off(Metro.events.click, \".input-clear-button\");\n            input.off(Metro.events.click);\n            filter_input.off(Metro.events.blur);\n            filter_input.off(Metro.events.focus);\n            list.off(Metro.events.click, \"li\");\n            filter_input.off(Metro.events.keyup);\n            drop_container.off(Metro.events.click);\n            clearButton.off(Metro.events.click);\n\n            drop_container.data(\"dropdown\").destroy();\n\n            return element;\n        }\n    });\n\n    $(document).on(Metro.events.click, function(){\n        $(\".select\").removeClass(\"focused\");\n    }, {ns: \"blur-select-elements\"});\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var SidebarDefaultConfig = {\n        menuScrollbar: false,\n        sidebarDeferred: 0,\n        shadow: true,\n        position: \"left\",\n        size: 290,\n        shift: null,\n        staticShift: null,\n        toggle: null,\n        duration: METRO_ANIMATION_DURATION,\n        static: null,\n        menuItemClick: true,\n        closeOutside: true,\n        onOpen: Metro.noop,\n        onClose: Metro.noop,\n        onToggle: Metro.noop,\n        onStaticSet: Metro.noop,\n        onStaticLoss: Metro.noop,\n        onSidebarCreate: Metro.noop\n    };\n\n    Metro.sidebarSetup = function (options) {\n        SidebarDefaultConfig = $.extend({}, SidebarDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroSidebarSetup\"] !== undefined) {\n        Metro.sidebarSetup(window[\"metroSidebarSetup\"]);\n    }\n\n    Metro.Component('sidebar', {\n        init: function( options, elem ) {\n            this._super(elem, options, SidebarDefaultConfig, {\n                toggle_element: null,\n                id: Utils.elementId('sidebar')\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n            $(window).resize();\n            this._checkStatic();\n\n            this._fireEvent(\"sidebar-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var header = element.find(\".sidebar-header\");\n            var sheet = Metro.sheet;\n            var menu = element.find(\".sidebar-menu\");\n\n            element.addClass(\"sidebar\").addClass(\"on-\"+o.position);\n\n            if (o.menuScrollbar === false) {\n                menu.addClass(\"hide-scroll\");\n            }\n\n            if (o.size !== 290) {\n                Utils.addCssRule(sheet, \".sidebar\", \"width: \" + o.size + \"px;\");\n\n                if (o.position === \"left\") {\n                    Utils.addCssRule(sheet, \".sidebar.on-left\", \"left: \" + -o.size + \"px;\");\n                } else {\n                    Utils.addCssRule(sheet, \".sidebar.on-right\", \"right: \" + -o.size + \"px;\");\n                }\n            }\n\n            if (o.shadow === true) {\n                element.addClass(\"sidebar-shadow\");\n            }\n\n            if (o.toggle !== null && $(o.toggle).length > 0) {\n                this.toggle_element = $(o.toggle);\n            }\n\n            if (header.length > 0) {\n                if (header.data(\"image\") !== undefined) {\n                    header.css({\n                        backgroundImage: \"url(\"+header.data(\"image\")+\")\"\n                    });\n                }\n            }\n\n            if (o.static !== null) {\n                if (o.staticShift !== null) {\n                    if (o.position === 'left') {\n                        Utils.addCssRule(sheet, \"@media screen and \" + Metro.media_queries[o.static.toUpperCase()], o.staticShift + \"{margin-left: \" + o.size + \"px; width: calc(100% - \" + o.size + \"px);}\");\n                    } else {\n                        Utils.addCssRule(sheet, \"@media screen and \" + Metro.media_queries[o.static.toUpperCase()], o.staticShift + \"{margin-right: \" + o.size + \"px; width: calc(100% - \" + o.size + \"px);}\");\n                    }\n                }\n            }\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var toggle = this.toggle_element;\n\n            if (toggle !== null) {\n                toggle.on(Metro.events.click, function(e){\n                    that.toggle();\n                    e.stopPropagation();\n                });\n            } else if (o.toggle) {\n                $.document().on(\"click\", o.toggle, function (e) {\n                    that.toggle();\n                    e.stopPropagation();\n                })\n            }\n\n            if (o.static !== null && [\"fs\", \"sm\", \"md\", \"lg\", \"xl\", \"xxl\"].indexOf(o.static) > -1) {\n                $(window).on(Metro.events.resize,function(){\n                    that._checkStatic();\n                }, {ns: this.id});\n            }\n\n            if (o.menuItemClick === true) {\n                element.on(Metro.events.click, \".sidebar-menu li > a\", function(e){\n                    that.close();\n                    e.stopPropagation();\n                });\n            }\n\n            element.on(Metro.events.click, \".sidebar-menu .js-sidebar-close\", function(e){\n                that.close();\n                e.stopPropagation();\n            });\n\n            element.on(Metro.events.click, function(e){\n                e.stopPropagation();\n            });\n\n            $(document).on(Metro.events.click, function(){\n                if (o.closeOutside === true) {\n                    if (that.isOpen()) that.close()\n                }\n            })\n        },\n\n        _checkStatic: function(){\n            var element = this.element, o = this.options;\n            if (Utils.mediaExist(o.static) && !element.hasClass(\"static\")) {\n                element.addClass(\"static\");\n                element.data(\"opened\", false).removeClass('open');\n                if (o.shift !== null) {\n                    $.each(o.shift.split(\",\"), function(){\n                        $(this)\n                            .animate({\n                                draw: {\n                                    left: 0\n                                },\n                                dur: o.duration\n                            })\n                    });\n                }\n\n                this._fireEvent(\"static-set\");\n            }\n            if (!Utils.mediaExist(o.static)) {\n                element.removeClass(\"static\");\n                this._fireEvent(\"static-loss\");\n            }\n        },\n\n        isOpen: function(){\n            return this.element.data(\"opened\") === true;\n        },\n\n        open: function(){\n            var element = this.element, o = this.options;\n\n            if (element.hasClass(\"static\")) {\n                return ;\n            }\n\n            element.data(\"opened\", true).addClass('open');\n\n            if (o.shift !== null) {\n                $(o.shift)\n                    .animate({\n                        draw: {\n                            left: element.outerWidth()\n                        },\n                        dur: o.duration\n                    });\n            }\n\n            this._fireEvent(\"open\");\n        },\n\n        close: function(){\n            var element = this.element, o = this.options;\n\n            if (element.hasClass(\"static\")) {\n                return ;\n            }\n\n            element.data(\"opened\", false).removeClass('open');\n\n            if (o.shift !== null) {\n                $(o.shift)\n                    .animate({\n                        draw: {\n                            left: 0\n                        },\n                        dur: o.duration\n                    });\n            }\n\n            this._fireEvent(\"close\");\n        },\n\n        toggle: function(){\n            if (this.isOpen()) {\n                this.close();\n            } else {\n                this.open();\n            }\n\n            this._fireEvent(\"toggle\");\n        },\n\n        changeAttribute: function(){\n        },\n\n        destroy: function(){\n            var element = this.element, o = this.options;\n            var toggle = this.toggle_element;\n\n            if (toggle !== null) {\n                toggle.off(Metro.events.click);\n            }\n\n            if (o.static !== null && [\"fs\", \"sm\", \"md\", \"lg\", \"xl\", \"xxl\"].indexOf(o.static) > -1) {\n                $(window).off(Metro.events.resize, {ns: this.id});\n            }\n\n            if (o.menuItemClick === true) {\n                element.off(Metro.events.click, \".sidebar-menu li > a\");\n            }\n\n            element.off(Metro.events.click, \".sidebar-menu .js-sidebar-close\");\n\n            return element;\n        }\n    });\n\n    Metro['sidebar'] = {\n        isSidebar: function(el){\n            return Utils.isMetroObject(el, \"sidebar\");\n        },\n\n        open: function(el){\n            if (!this.isSidebar(el)) {\n                return ;\n            }\n            Metro.getPlugin(el, \"sidebar\").open();\n        },\n\n        close: function(el){\n            if (!this.isSidebar(el)) {\n                return ;\n            }\n            Metro.getPlugin(el, \"sidebar\").close();\n        },\n\n        toggle: function(el){\n            if (!this.isSidebar(el)) {\n                return ;\n            }\n            Metro.getPlugin(el, \"sidebar\").toggle();\n        },\n\n        isOpen: function(el){\n            if (!this.isSidebar(el)) {\n                return ;\n            }\n            return Metro.getPlugin(el, \"sidebar\").isOpen();\n        }\n    };\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var SliderDefaultConfig = {\n        sliderDeferred: 0,\n        roundValue: true,\n        min: 0,\n        max: 100,\n        accuracy: 0,\n        showMinMax: false,\n        minMaxPosition: Metro.position.TOP,\n        value: 0,\n        buffer: 0,\n        hint: false,\n        hintAlways: false,\n        hintPosition: Metro.position.TOP,\n        hintMask: \"$1\",\n        vertical: false,\n        target: null,\n        returnType: \"value\", // value or percent\n        size: 0,\n\n        clsSlider: \"\",\n        clsBackside: \"\",\n        clsComplete: \"\",\n        clsBuffer: \"\",\n        clsMarker: \"\",\n        clsHint: \"\",\n        clsMinMax: \"\",\n        clsMin: \"\",\n        clsMax: \"\",\n\n        onStart: Metro.noop,\n        onStop: Metro.noop,\n        onMove: Metro.noop,\n        onSliderClick: Metro.noop,\n        onChange: Metro.noop,\n        onChangeValue: Metro.noop,\n        onChangeBuffer: Metro.noop,\n        onFocus: Metro.noop,\n        onBlur: Metro.noop,\n        onSliderCreate: Metro.noop\n    };\n\n    Metro.sliderSetup = function (options) {\n        SliderDefaultConfig = $.extend({}, SliderDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroSliderSetup\"] !== undefined) {\n        Metro.sliderSetup(window[\"metroSliderSetup\"]);\n    }\n\n    Metro.Component('slider', {\n        init: function( options, elem ) {\n            this._super(elem, options, SliderDefaultConfig, {\n                slider: null,\n                value: 0,\n                percent: 0,\n                pixel: 0,\n                buffer: 0,\n                keyInterval: false,\n                id: Utils.elementId('slider')\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n\n            this._createSlider();\n            this._createEvents();\n            this.buff(o.buffer);\n            this.val(o.value);\n\n            this._fireEvent(\"slider-create\", {\n                element: element\n            });\n        },\n\n        _createSlider: function(){\n            var element = this.element, o = this.options;\n\n            var prev = element.prev();\n            var parent = element.parent();\n            var slider = $(\"<div>\").addClass(\"slider \" + element[0].className).addClass(o.clsSlider);\n            var backside = $(\"<div>\").addClass(\"backside\").addClass(o.clsBackside);\n            var complete = $(\"<div>\").addClass(\"complete\").addClass(o.clsComplete);\n            var buffer = $(\"<div>\").addClass(\"buffer\").addClass(o.clsBuffer);\n            var marker = $(\"<button>\").attr(\"type\", \"button\").addClass(\"marker\").addClass(o.clsMarker);\n            var hint = $(\"<div>\").addClass(\"hint\").addClass(o.hintPosition + \"-side\").addClass(o.clsHint);\n            var i;\n\n            if (o.size > 0) {\n                if (o.vertical === true) {\n                    slider.outerHeight(o.size);\n                } else {\n                    slider.outerWidth(o.size);\n                }\n            }\n\n            if (o.vertical === true) {\n                slider.addClass(\"vertical-slider\");\n            }\n\n            if (prev.length === 0) {\n                parent.prepend(slider);\n            } else {\n                slider.insertAfter(prev);\n            }\n\n            if (o.hintAlways === true) {\n                hint.css({\n                    display: \"block\"\n                }).addClass(\"permanent-hint\");\n            }\n\n            element.appendTo(slider);\n            backside.appendTo(slider);\n            complete.appendTo(slider);\n            buffer.appendTo(slider);\n            marker.appendTo(slider);\n            hint.appendTo(marker);\n\n            if (o.showMinMax === true) {\n                var min_max_wrapper = $(\"<div>\").addClass(\"slider-min-max\").addClass(o.clsMinMax);\n                $(\"<span>\").addClass(\"slider-text-min\").addClass(o.clsMin).html(o.min).appendTo(min_max_wrapper);\n                $(\"<span>\").addClass(\"slider-text-max\").addClass(o.clsMax).html(o.max).appendTo(min_max_wrapper);\n                if (o.minMaxPosition === Metro.position.TOP) {\n                    min_max_wrapper.insertBefore(slider);\n                } else {\n                    min_max_wrapper.insertAfter(slider);\n                }\n            }\n\n            element[0].className = '';\n            if (o.copyInlineStyles === true) {\n                for (i = 0; i < element[0].style.length; i++) {\n                    slider.css(element[0].style[i], element.css(element[0].style[i]));\n                }\n            }\n\n            if (element.is(\":disabled\")) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n\n            this.slider = slider;\n        },\n\n        _createEvents: function(){\n            var that = this, slider = this.slider, o = this.options;\n            var marker = slider.find(\".marker\");\n            var hint = slider.find(\".hint\");\n\n            marker.on(Metro.events.startAll, function(){\n                if (o.hint === true && o.hintAlways !== true) {\n                    hint.fadeIn(300);\n                }\n\n                $(document).on(Metro.events.moveAll, function(e){\n                    if (e.cancelable) e.preventDefault();\n                    that._move(e);\n\n                    that._fireEvent(\"move\", {\n                        val: that.value,\n                        percent: that.percent\n                    });\n\n                }, {ns: that.id, passive: false});\n\n                $(document).on(Metro.events.stopAll, function(){\n                    $(document).off(Metro.events.moveAll, {ns: that.id});\n                    $(document).off(Metro.events.stopAll, {ns: that.id});\n\n                    if (o.hintAlways !== true) {\n                        hint.fadeOut(300);\n                    }\n\n                    that._fireEvent(\"stop\", {\n                        val: that.value,\n                        percent: that.percent\n                    });\n                }, {ns: that.id});\n\n                that._fireEvent(\"start\", {\n                    val: that.value,\n                    percent: that.percent\n                });\n            });\n\n            marker.on(Metro.events.focus, function(){\n                that._fireEvent(\"focus\", {\n                    val: that.value,\n                    percent: that.percent\n                });\n            });\n\n            marker.on(Metro.events.blur, function(){\n                that._fireEvent(\"blur\", {\n                    val: that.value,\n                    percent: that.percent\n                });\n            });\n\n            marker.on(Metro.events.keydown, function(e){\n\n                var key = e.keyCode ? e.keyCode : e.which;\n\n                if ([37,38,39,40].indexOf(key) === -1) {\n                    return;\n                }\n\n                var step = o.accuracy === 0 ? 1 : o.accuracy;\n\n                if (that.keyInterval) {\n                    return ;\n                }\n                that.keyInterval = setInterval(function(){\n\n                    var val = that.value;\n\n                    if (e.keyCode === 37 || e.keyCode === 40) { // left, down\n                        if (val - step < o.min) {\n                            val = o.min;\n                        } else {\n                            val -= step;\n                        }\n                    }\n\n                    if (e.keyCode === 38 || e.keyCode === 39) { // right, up\n                        if (val + step > o.max) {\n                            val = o.max;\n                        } else {\n                            val += step;\n                        }\n                    }\n\n                    that.value = that._correct(val);\n                    that.percent = that._convert(that.value, 'val2prc');\n                    that.pixel = that._convert(that.percent, 'prc2pix');\n\n                    that._redraw();\n                }, 100);\n\n                e.preventDefault();\n            });\n\n            marker.on(Metro.events.keyup, function(){\n                clearInterval(that.keyInterval);\n                that.keyInterval = false;\n            });\n\n            slider.on(Metro.events.click, function(e){\n                that._move(e);\n\n                that._fireEvent(\"slider-click\", {\n                    val: that.value,\n                    percent: that.percent\n                });\n\n                that._fireEvent(\"stop\", {\n                    val: that.value,\n                    percent: that.percent\n                });\n            });\n\n            $(window).on(Metro.events.resize,function(){\n                that.val(that.value);\n                that.buff(that.buffer);\n            }, {ns: that.id});\n        },\n\n        _convert: function(v, how){\n            var slider = this.slider, o = this.options;\n            var length = (o.vertical === true ? slider.outerHeight() : slider.outerWidth()) - slider.find(\".marker\").outerWidth();\n            switch (how) {\n                case \"pix2prc\": return ( v * 100 / length );\n                case \"pix2val\": return ( this._convert(v, 'pix2prc') * ((o.max - o.min) / 100) + o.min );\n                case \"val2prc\": return ( (v - o.min)/( (o.max - o.min) / 100 )  );\n                case \"prc2pix\": return ( v / ( 100 / length ));\n                case \"val2pix\": return ( this._convert(this._convert(v, 'val2prc'), 'prc2pix') );\n            }\n\n            return 0;\n        },\n\n        _correct: function(value){\n            var res = value;\n            var accuracy  = this.options.accuracy;\n            var min = this.options.min, max = this.options.max;\n\n            if (accuracy === 0 || isNaN(accuracy)) {\n                return res;\n            }\n\n            res = Math.round(value/accuracy)*accuracy;\n\n            if (res < min) {\n                res = min;\n            }\n\n            if (res > max) {\n                res = max;\n            }\n\n            return res.toFixed(Utils.decCount(accuracy));\n        },\n\n        _move: function(e){\n            var slider = this.slider, o = this.options;\n            var offset = slider.offset(),\n                marker_size = slider.find(\".marker\").outerWidth(),\n                length = o.vertical === true ? slider.outerHeight() : slider.outerWidth(),\n                cPos, cPix, cStart = 0, cStop = length - marker_size;\n\n            cPos = o.vertical === true ? Utils.pageXY(e).y - offset.top : Utils.pageXY(e).x - offset.left;\n            cPix = o.vertical === true ? length - cPos - marker_size / 2 : cPos - marker_size / 2;\n\n            if (cPix < cStart || cPix > cStop) {\n                return ;\n            }\n\n            this.value = this._correct(this._convert(cPix, 'pix2val'));\n            this.percent = this._convert(this.value, 'val2prc');\n            this.pixel = this._convert(this.percent, 'prc2pix');\n\n            this._redraw();\n        },\n\n        _hint: function(){\n            var o = this.options, slider = this.slider, hint = slider.find(\".hint\");\n            var value = +this.value || 0;\n            var percent = +this.percent || 0;\n\n            if (o.roundValue) {\n                value = (Utils.isValue(value) ? +value : 0).toFixed(Utils.decCount(o.accuracy));\n                percent = (Utils.isValue(percent) ? +percent : 0).toFixed(Utils.decCount(o.accuracy));\n            }\n\n            hint.text(o.hintMask.replace(\"$1\", value).replace(\"$2\", percent));\n        },\n\n        _value: function(){\n            var element = this.element, o = this.options;\n            var value = o.returnType === 'value' ? this.value : this.percent;\n            var percent = this.percent;\n            var buffer = this.buffer;\n\n            if (o.roundValue) {\n                value = (Utils.isValue(value) ? +value : 0).toFixed(Utils.decCount(o.accuracy));\n                percent = (Utils.isValue(percent) ? +percent : 0).toFixed(Utils.decCount(o.accuracy));\n                buffer = (Utils.isValue(buffer) ? +buffer : 0).toFixed(Utils.decCount(o.accuracy));\n            }\n\n            if (element[0].tagName === \"INPUT\") {\n                element.val(value);\n            }\n\n            if (o.target !== null) {\n                var target = $(o.target);\n                if (target.length !== 0) {\n\n                    $.each(target, function(){\n                        var t = $(this);\n                        if (this.tagName === \"INPUT\") {\n                            t.val(value);\n                        } else {\n                            t.text(value);\n                        }\n                        t.trigger(\"change\");\n                    });\n                }\n            }\n\n            this._fireEvent(\"change-value\", {\n                val: value\n            });\n\n            this._fireEvent(\"change\", {\n                val: value,\n                percent: percent,\n                buffer: buffer\n            });\n        },\n\n        _marker: function(){\n            var slider = this.slider, o = this.options;\n            var marker = slider.find(\".marker\"), complete = slider.find(\".complete\");\n            var length = o.vertical === true ? slider.outerHeight() : slider.outerWidth();\n            var marker_size = parseInt(Utils.getStyleOne(marker, \"width\"));\n            var slider_visible = Utils.isVisible(slider);\n\n            if (slider_visible) {\n                marker.css({\n                    'margin-top': 0,\n                    'margin-left': 0\n                });\n            }\n\n            if (o.vertical === true) {\n                if (slider_visible) {\n                    marker.css('top', length - this.pixel);\n                } else {\n                    marker.css('top', (100 - this.percent) + \"%\");\n                    marker.css('margin-top', marker_size / 2);\n                }\n                complete.css('height', this.percent+\"%\");\n            } else {\n                if (slider_visible) {\n                    marker.css('left', this.pixel);\n                } else {\n                    marker.css('left', this.percent + \"%\");\n                    marker.css('margin-left', this.percent === 0 ? 0 : -1 * marker_size / 2);\n                }\n                complete.css('width', this.percent+\"%\");\n            }\n        },\n\n        _redraw: function(){\n            this._marker();\n            this._value();\n            this._hint();\n        },\n\n        _buffer: function(){\n            var element = this.element, o = this.options;\n            var buffer = this.slider.find(\".buffer\");\n\n            if (o.vertical === true) {\n                buffer.css(\"height\", this.buffer + \"%\");\n            } else {\n                buffer.css(\"width\", this.buffer + \"%\");\n            }\n\n            this._fireEvent(\"change-buffer\", {\n                val: this.buffer\n            });\n\n            this._fireEvent(\"change\", {\n                val: element.val(),\n                percent: this.percent,\n                buffer: this.buffer\n            });\n        },\n\n        val: function(v){\n            var o = this.options;\n\n            if (v === undefined || isNaN(v)) {\n                return this.value;\n            }\n\n            if (v < o.min) {\n                v = o.min;\n            }\n\n            if (v > o.max) {\n                v = o.max;\n            }\n\n            this.value = this._correct(v);\n            this.percent = this._convert(this.value, 'val2prc');\n            this.pixel = this._convert(this.percent, 'prc2pix');\n\n            this._redraw();\n        },\n\n        buff: function(v){\n            var slider = this.slider;\n            var buffer = slider.find(\".buffer\");\n\n            if (v === undefined || isNaN(v)) {\n                return this.buffer;\n            }\n\n            if (buffer.length === 0) {\n                return false;\n            }\n\n            v = parseInt(v);\n\n            if (v > 100) {\n                v = 100;\n            }\n\n            if (v < 0) {\n                v = 0;\n            }\n\n            this.buffer = v;\n            this._buffer();\n        },\n\n        changeValue: function(){\n            var element = this.element, o = this.options;\n            var val = element.attr(\"data-value\");\n            if (val < o.min) {\n                val = o.min\n            }\n            if (val > o.max) {\n                val = o.max\n            }\n            this.val(val);\n        },\n\n        changeBuffer: function(){\n            var element = this.element;\n            var val = parseInt(element.attr(\"data-buffer\"));\n            if (val < 0) {\n                val = 0\n            }\n            if (val > 100) {\n                val = 100\n            }\n            this.buff(val);\n        },\n\n        disable: function(){\n            this.element.data(\"disabled\", true);\n            this.element.parent().addClass(\"disabled\");\n        },\n\n        enable: function(){\n            this.element.data(\"disabled\", false);\n            this.element.parent().removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case \"data-value\": this.changeValue(); break;\n                case \"data-buffer\": this.changeBuffer(); break;\n                case 'disabled': this.toggleState(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element, slider = this.slider;\n            var marker = slider.find(\".marker\");\n\n            marker.off(Metro.events.startAll);\n            marker.off(Metro.events.focus);\n            marker.off(Metro.events.blur);\n            marker.off(Metro.events.keydown);\n            marker.off(Metro.events.keyup);\n            slider.off(Metro.events.click);\n            $(window).off(Metro.events.resize, {ns: this.id});\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var SorterDefaultConfig = {\n        sorterDeferred: 0,\n        thousandSeparator: \",\",\n        decimalSeparator: \",\",\n        sortTarget: null,\n        sortSource: null,\n        sortDir: \"asc\",\n        sortStart: true,\n        saveInitial: true,\n        onSortStart: Metro.noop,\n        onSortStop: Metro.noop,\n        onSortItemSwitch: Metro.noop,\n        onSorterCreate: Metro.noop\n    };\n\n    Metro.sorterSetup = function (options) {\n        SorterDefaultConfig = $.extend({}, SorterDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroSorterSetup\"] !== undefined) {\n        Metro.sorterSetup(window[\"metroSorterSetup\"]);\n    }\n\n    Metro.Component('sorter', {\n        init: function( options, elem ) {\n            this._super(elem, options, SorterDefaultConfig, {\n                initial: []\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n\n            this._fireEvent(\"sorter-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n\n            if (o.sortTarget === null) {\n                o.sortTarget = element.children()[0].tagName;\n            }\n\n            this.initial = element.find(o.sortTarget).get();\n\n            if (o.sortStart === true) {\n                this.sort(o.sortDir);\n            }\n        },\n\n        _getItemContent: function(item){\n            var o = this.options;\n            var data, inset, i, format;\n\n            if (Utils.isValue(o.sortSource)) {\n                data = \"\";\n                inset = item.getElementsByClassName(o.sortSource);\n\n                if (inset.length > 0) for (i = 0; i < inset.length; i++) {\n                    data += inset[i].textContent;\n                }\n                format = inset[0].dataset.format;\n            } else {\n                data = item.textContent;\n                format = item.dataset.format;\n            }\n\n            data = (\"\"+data).toLowerCase().replace(/[\\n\\r]+|[\\s]{2,}/g, ' ').trim();\n\n            if (Utils.isValue(format)) {\n\n                if (['number', 'int', 'float', 'money'].indexOf(format) !== -1 && (o.thousandSeparator !== \",\" || o.decimalSeparator !== \".\" )) {\n                    data = Utils.parseNumber(data, o.thousandSeparator, o.decimalSeparator);\n                }\n\n                switch (format) {\n                    case \"date\": data = Utils.isDate(data) ? new Date(data) : \"\"; break;\n                    case \"number\": data = Number(data); break;\n                    case \"int\": data = parseInt(data); break;\n                    case \"float\": data = parseFloat(data); break;\n                    case \"money\": data = Utils.parseMoney(data); break;\n                    case \"card\": data = Utils.parseCard(data); break;\n                    case \"phone\": data = Utils.parsePhone(data); break;\n                }\n            }\n\n            return data;\n        },\n\n        sort: function(dir){\n            var that = this, element = this.element, o = this.options;\n            var items;\n            var id = Utils.elementId(\"temp\");\n            var prev;\n\n            if (dir !== undefined) {\n                o.sortDir = dir;\n            }\n\n            items = element.find(o.sortTarget).get();\n\n            if (items.length === 0) {\n                return ;\n            }\n\n            prev = $(\"<div>\").attr(\"id\", id).insertBefore($(element.find(o.sortTarget)[0]));\n\n            this._fireEvent(\"sort-start\", {\n                items: items\n            });\n\n            items.sort(function(a, b){\n                var c1 = that._getItemContent(a);\n                var c2 = that._getItemContent(b);\n                var result = 0;\n\n                if (c1 < c2 ) {\n                    result = -1;\n                }\n\n                if (c1 > c2 ) {\n                    result = 1;\n                }\n\n                if (result !== 0) {\n                    that._fireEvent(\"sort-item-switch\", {\n                        a: a,\n                        b: b,\n                        result: result\n                    });\n                }\n\n                return result;\n            });\n\n            if (o.sortDir === \"desc\") {\n                items.reverse();\n            }\n\n            element.find(o.sortTarget).remove();\n\n            $.each(items, function(){\n                var $this = $(this);\n                $this.insertAfter(prev);\n                prev = $this;\n            });\n\n            $(\"#\"+id).remove();\n\n            this._fireEvent(\"sort-stop\", {\n                items: items\n            });\n        },\n\n        reset: function(){\n            var element = this.element, o = this.options;\n            var items;\n            var id = Utils.elementId('sorter');\n            var prev;\n\n            items = this.initial;\n\n            if (items.length === 0) {\n                return ;\n            }\n\n            prev = $(\"<div>\").attr(\"id\", id).insertBefore($(element.find(o.sortTarget)[0]));\n\n            element.find(o.sortTarget).remove();\n\n            $.each(items, function(){\n                var $this = $(this);\n                $this.insertAfter(prev);\n                prev = $this;\n            });\n\n            $(\"#\"+id).remove();\n        },\n\n        changeAttribute: function(attributeName){\n            var that = this, element = this.element, o = this.options;\n\n            var changeSortDir = function() {\n                var dir = element.attr(\"data-sort-dir\").trim();\n                if (dir === \"\") return;\n                o.sortDir = dir;\n                that.sort();\n            };\n\n            var changeSortContent = function(){\n                var content = element.attr(\"data-sort-content\").trim();\n                if (content === \"\") return ;\n                o.sortContent = content;\n                that.sort();\n            };\n\n            switch (attributeName) {\n                case \"data-sort-dir\": changeSortDir(); break;\n                case \"data-sort-content\": changeSortContent(); break;\n            }\n        },\n\n        destroy: function(){\n            return this.element;\n        }\n    });\n\n    Metro['sorter'] = {\n        create: function(el, op){\n            return Utils.$()(el).sorter(op);\n        },\n\n        isSorter: function(el){\n            return Utils.isMetroObject(el, \"sorter\");\n        },\n\n        sort: function(el, dir){\n            if (!this.isSorter(el)) {\n                return false;\n            }\n            if (dir === undefined) {\n                dir = \"asc\";\n            }\n            Metro.getPlugin(el, \"sorter\").sort(dir);\n        },\n\n        reset: function(el){\n            if (!this.isSorter(el)) {\n                return false;\n            }\n            Metro.getPlugin(el, \"sorter\").reset();\n        }\n    };\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var SpinnerDefaultConfig = {\n        spinnerDeferred: 0,\n        label: \"\",\n        step: 1,\n        plusIcon: \"<span class='default-icon-plus'></span>\",\n        minusIcon: \"<span class='default-icon-minus'></span>\",\n        buttonsPosition: \"default\",\n        defaultValue: 0,\n        minValue: null,\n        maxValue: null,\n        fixed: 0,\n        repeatThreshold: 1000,\n        hideCursor: false,\n        clsSpinner: \"\",\n        clsSpinnerInput: \"\",\n        clsSpinnerButton: \"\",\n        clsSpinnerButtonPlus: \"\",\n        clsSpinnerButtonMinus: \"\",\n        clsLabel: \"\",\n        onBeforeChange: Metro.noop_true,\n        onChange: Metro.noop,\n        onPlusClick: Metro.noop,\n        onMinusClick: Metro.noop,\n        onArrowUp: Metro.noop,\n        onArrowDown: Metro.noop,\n        onButtonClick: Metro.noop,\n        onArrowClick: Metro.noop,\n        onSpinnerCreate: Metro.noop\n    };\n\n    Metro.spinnerSetup = function (options) {\n        SpinnerDefaultConfig = $.extend({}, SpinnerDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroSpinnerSetup\"] !== undefined) {\n        Metro.spinnerSetup(window[\"metroSpinnerSetup\"]);\n    }\n\n    Metro.Component('spinner', {\n        init: function( options, elem ) {\n            this._super(elem, options, SpinnerDefaultConfig, {\n                repeat_timer: false\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"spinner-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var spinner = $(\"<div>\").addClass(\"spinner\").addClass(\"buttons-\"+o.buttonsPosition).addClass(element[0].className).addClass(o.clsSpinner);\n            var button_plus = $(\"<button>\").attr(\"type\", \"button\").addClass(\"button spinner-button spinner-button-plus\").addClass(o.clsSpinnerButton + \" \" + o.clsSpinnerButtonPlus).html(o.plusIcon);\n            var button_minus = $(\"<button>\").attr(\"type\", \"button\").addClass(\"button spinner-button spinner-button-minus\").addClass(o.clsSpinnerButton + \" \" + o.clsSpinnerButtonMinus).html(o.minusIcon);\n            var init_value = element.val().trim();\n\n            if (!Utils.isValue(init_value)) {\n                element.val(0);\n            }\n\n            element[0].className = '';\n\n            spinner.insertBefore(element);\n            element.appendTo(spinner).addClass(o.clsSpinnerInput);\n\n            element.addClass(\"original-input\");\n\n            button_plus.appendTo(spinner);\n            button_minus.appendTo(spinner);\n\n            if (o.hideCursor === true) {\n                spinner.addClass(\"hide-cursor\");\n            }\n\n            if (o.label) {\n                var label = $(\"<label>\").addClass(\"label-for-input\").addClass(o.clsLabel).html(o.label).insertBefore(spinner);\n                if (element.attr(\"id\")) {\n                    label.attr(\"for\", element.attr(\"id\"));\n                }\n                if (element.attr(\"dir\") === \"rtl\") {\n                    label.addClass(\"rtl\");\n                }\n            }\n\n            if (o.disabled === true || element.is(\":disabled\")) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var spinner = element.closest(\".spinner\");\n            var spinner_buttons = spinner.find(\".spinner-button\");\n            var value;\n\n            var spinnerButtonClick = function(plus, threshold){\n                var events = [plus ? \"plus-click\" : \"minus-click\", plus ? \"arrow-up\" : \"arrow-down\", \"button-click\", \"arrow-click\"];\n                var curr = +element.val();\n                var val = +element.val();\n                var step = +o.step;\n\n                if (plus) {\n                    val += step;\n                } else {\n                    val -= step;\n                }\n\n                that._setValue(val.toFixed(o.fixed), true);\n\n                that._fireEvents(events, {\n                    curr: curr,\n                    val: val,\n                    elementVal: element.val(),\n                    button: plus ? \"plus\" : \"minus\"\n                });\n\n                setTimeout(function(){\n                    if (that.repeat_timer) {\n                        spinnerButtonClick(plus, 100);\n                    }\n                }, threshold);\n            };\n\n            spinner.on(Metro.events.click, function(e){\n                $(\".focused\").removeClass(\"focused\");\n                spinner.addClass(\"focused\");\n\n                e.preventDefault();\n                e.stopPropagation();\n            });\n\n            spinner_buttons.on(Metro.events.startAll, function(e){\n                var plus = $(this).closest(\".spinner-button\").hasClass(\"spinner-button-plus\");\n\n                if (that.repeat_timer) return ;\n\n                that.repeat_timer = true;\n                spinnerButtonClick(plus, o.repeatThreshold);\n\n                e.preventDefault();\n            });\n\n            spinner_buttons.on(Metro.events.stopAll, function(){\n                that.repeat_timer = false;\n            });\n\n            element.on(Metro.events.keydown, function(e){\n                if (e.keyCode === Metro.keyCode.UP_ARROW || e.keyCode === Metro.keyCode.DOWN_ARROW) {\n\n                    if (that.repeat_timer) return ;\n\n                    that.repeat_timer = true;\n                    spinnerButtonClick(e.keyCode === Metro.keyCode.UP_ARROW, o.repeatThreshold);\n\n                } else {\n                    var key = e.key;\n                    if (key === \"Backspace\" || key === \"Delete\" || key === \"ArrowLeft\" || key === \"ArrowRight\" ) {\n                        //\n                    } else\n                    if (isNaN(key) || parseInt(key) < 0 && parseInt(key) > 9) {\n                        e.preventDefault();\n                    }\n\n                    value = parseInt(this.value);\n                }\n            });\n\n            element.on(Metro.events.keyup, function(){\n                var val = parseInt(this.value);\n                if ((o.minValue && val < o.minValue) || (o.maxValue && val > o.maxValue)) {\n                    this.value = value;\n                }\n            });\n\n            spinner.on(Metro.events.keyup, function(){\n                that.repeat_timer = false;\n            });\n        },\n\n        _setValue: function(val, trigger_change){\n            var element = this.element, o = this.options;\n\n            if (Utils.exec(o.onBeforeChange, [val], element[0]) !== true) {\n                return ;\n            }\n\n            if (Utils.isValue(o.maxValue) && val > Number(o.maxValue)) {\n                val =  Number(o.maxValue);\n            }\n\n            if (Utils.isValue(o.minValue) && val < Number(o.minValue)) {\n                val =  Number(o.minValue);\n            }\n\n            element.val(val);\n\n            this._fireEvent(\"change\", {val: val}, false, true);\n\n            if (trigger_change === true) {\n                element.fire(\"change\", {\n                    val: val\n                });\n            }\n        },\n\n        val: function(val){\n            var that = this, element = this.element, o = this.options;\n            if (!Utils.isValue(val)) {\n                return element.val();\n            }\n\n            that._setValue(val.toFixed(o.fixed), true);\n        },\n\n        toDefault: function(){\n            var o = this.options;\n            var val = Utils.isValue(o.defaultValue) ? Number(o.defaultValue) : 0;\n            this._setValue(val.toFixed(o.fixed), true);\n\n            this._fireEvent(\"change\", {\n                val: val\n            });\n        },\n\n        disable: function(){\n            this.element.data(\"disabled\", true);\n            this.element.parent().addClass(\"disabled\");\n        },\n\n        enable: function(){\n            this.element.data(\"disabled\", false);\n            this.element.parent().removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        changeAttribute: function(attributeName){\n            var that = this, element = this.element;\n\n            var changeValue = function(){\n                var val = element.attr('value').trim();\n                if (Utils.isValue(val)) {\n                    that._setValue(Number(val), false);\n                }\n            };\n\n            switch (attributeName) {\n                case 'disabled': this.toggleState(); break;\n                case 'value': changeValue(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n            var spinner = element.closest(\".spinner\");\n            var spinner_buttons = spinner.find(\".spinner-button\");\n\n            spinner.off(Metro.events.click);\n            spinner_buttons.off(Metro.events.start);\n            spinner_buttons.off(Metro.events.stop);\n            element.off(Metro.events.keydown);\n            spinner.off(Metro.events.keyup);\n\n            return element;\n        }\n    });\n\n    $(document).on(Metro.events.click, function(){\n        $(\".spinner\").removeClass(\"focused\");\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var Storage = Metro.storage;\n    var SplitterDefaultConfig = {\n        splitterDeferred: 0,\n        splitMode: \"horizontal\", // horizontal or vertical\n        splitSizes: null,\n        gutterSize: 4,\n        minSizes: null,\n        children: \"*\",\n        gutterClick: \"expand\", // TODO expand or collapse\n        saveState: false,\n        onResizeStart: Metro.noop,\n        onResizeStop: Metro.noop,\n        onResizeSplit: Metro.noop,\n        onResizeWindow: Metro.noop,\n        onSplitterCreate: Metro.noop\n    };\n\n    Metro.splitterSetup = function (options) {\n        SplitterDefaultConfig = $.extend({}, SplitterDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroSplitterSetup\"] !== undefined) {\n        Metro.splitterSetup(window[\"metroSplitterSetup\"]);\n    }\n\n    Metro.Component('splitter', {\n        init: function( options, elem ) {\n            this._super(elem, options, SplitterDefaultConfig, {\n                storage: Utils.isValue(Storage) ? Storage : null,\n                storageKey: \"SPLITTER:\",\n                id: Utils.elementId(\"splitter\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"splitter-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var children = element.children(o.children).addClass(\"split-block\");\n            var i, children_sizes = [];\n            var resizeProp = o.splitMode === \"horizontal\" ? \"width\" : \"height\";\n\n            element.addClass(\"splitter\");\n            if (o.splitMode.toLowerCase() === \"vertical\") {\n                element.addClass(\"vertical\");\n            }\n\n            for (i = 0; i < children.length - 1; i++) {\n                $(\"<div>\").addClass(\"gutter\").css(resizeProp, o.gutterSize).insertAfter($(children[i]));\n            }\n\n            this._setSize();\n\n            if (Utils.isValue(o.minSizes)) {\n                if ((\"\"+o.minSizes).includes(\",\")) {\n                    children_sizes = o.minSizes.toArray();\n                    for (i = 0; i < children_sizes.length; i++) {\n                        $(children[i]).data(\"min-size\", children_sizes[i]);\n                        children[i].style.setProperty('min-'+resizeProp, (\"\"+children_sizes[i]).includes(\"%\") ? children_sizes[i] : (\"\"+children_sizes[i]).replace(\"px\", \"\")+\"px\", 'important');\n                    }\n                } else {\n                    $.each(children, function(){\n                        this.style.setProperty('min-'+resizeProp, (\"\"+o.minSizes).includes(\"%\") ? o.minSizes : (\"\"+o.minSizes).replace(\"px\", \"\")+\"px\", 'important');\n                    });\n                }\n            }\n\n            if (o.saveState && this.storage !== null) {\n                this._getSize();\n            }\n        },\n\n        _setSize: function(){\n            var element = this.element, o = this.options;\n            var gutters, children_sizes, i;\n            var children = element.children(\".split-block\");\n\n            gutters = element.children(\".gutter\");\n\n            if (!Utils.isValue(o.splitSizes)) {\n                children.css({\n                    flexBasis: \"calc(\"+(100/children.length)+\"% - \"+(gutters.length * o.gutterSize)+\"px)\"\n                })\n            } else {\n                children_sizes = o.splitSizes.toArray();\n                for(i = 0; i < children_sizes.length; i++) {\n                    $(children[i]).css({\n                        flexBasis: \"calc(\"+children_sizes[i]+\"% - \"+(gutters.length * o.gutterSize)+\"px)\"\n                    });\n                }\n            }\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var gutters = element.children(\".gutter\");\n\n            gutters.on(Metro.events.startAll, function(e){\n                var w = o.splitMode === \"horizontal\" ? element.width() : element.height();\n                var gutter = $(this);\n                var prev_block = gutter.prev(\".split-block\");\n                var next_block = gutter.next(\".split-block\");\n                var prev_block_size = 100 * (o.splitMode === \"horizontal\" ? prev_block.outerWidth(true) : prev_block.outerHeight(true)) / w;\n                var next_block_size = 100 * (o.splitMode === \"horizontal\" ? next_block.outerWidth(true) : next_block.outerHeight(true)) / w;\n                var start_pos = Utils.getCursorPosition(element[0], e);\n\n                gutter.addClass(\"active\");\n\n                prev_block.addClass(\"stop-pointer\");\n                next_block.addClass(\"stop-pointer\");\n\n                that._fireEvent(\"resize-start\", {\n                    pos: start_pos,\n                    gutter: gutter[0],\n                    prevBlock: prev_block[0],\n                    nextBlock: next_block[0]\n                });\n\n                $(window).on(Metro.events.moveAll, function(e){\n                    var pos = Utils.getCursorPosition(element[0], e);\n                    var new_pos;\n\n                    if (o.splitMode === \"horizontal\") {\n                        new_pos = (pos.x * 100 / w) - (start_pos.x * 100 / w);\n\n                    } else {\n                        new_pos = (pos.y * 100 / w) - (start_pos.y * 100 / w);\n                    }\n\n                    prev_block.css(\"flex-basis\", \"calc(\" + (prev_block_size + new_pos) + \"% - \"+(gutters.length * o.gutterSize)+\"px)\");\n                    next_block.css(\"flex-basis\", \"calc(\" + (next_block_size - new_pos) + \"% - \"+(gutters.length * o.gutterSize)+\"px)\");\n\n                    that._fireEvent(\"resize-split\", {\n                        pos: pos,\n                        gutter: gutter[0],\n                        prevBlock: prev_block[0],\n                        nextBlock: next_block[0]\n                    });\n\n                }, {ns: that.id});\n\n                $(window).on(Metro.events.stopAll, function(e){\n                    var cur_pos;\n\n                    prev_block.removeClass(\"stop-pointer\");\n                    next_block.removeClass(\"stop-pointer\");\n\n                    that._saveSize();\n\n                    gutter.removeClass(\"active\");\n\n                    $(window).off(Metro.events.moveAll,{ns: that.id});\n                    $(window).off(Metro.events.stopAll,{ns: that.id});\n\n                    cur_pos = Utils.getCursorPosition(element[0], e);\n\n                    that._fireEvent(\"resize-stop\", {\n                        pos: cur_pos,\n                        gutter: gutter[0],\n                        prevBlock: prev_block[0],\n                        nextBlock: next_block[0]\n                    });\n\n                }, {ns: that.id})\n            });\n\n            $(window).on(Metro.events.resize, function(){\n                var gutter = element.children(\".gutter\");\n                var prev_block = gutter.prev(\".split-block\");\n                var next_block = gutter.next(\".split-block\");\n\n                that._fireEvent(\"resize-window\", {\n                    prevBlock: prev_block[0],\n                    nextBlock: next_block[0]\n                });\n\n            }, {ns: that.id});\n        },\n\n        _saveSize: function(){\n            var element = this.element, o = this.options;\n            var storage = this.storage, itemsSize = [];\n            var id = element.attr(\"id\") || this.id;\n\n            if (o.saveState === true && storage !== null) {\n\n                $.each(element.children(\".split-block\"), function(){\n                    var item = $(this);\n                    itemsSize.push(item.css(\"flex-basis\"));\n                });\n\n                if (storage)\n                    storage.setItem(this.storageKey + id, itemsSize);\n            }\n\n        },\n\n        _getSize: function(){\n            var element = this.element, o = this.options;\n            var storage = this.storage, itemsSize = [];\n            var id = element.attr(\"id\") || this.id;\n\n            if (o.saveState === true && storage !== null) {\n\n                itemsSize = storage.getItem(this.storageKey + id);\n\n                $.each(element.children(\".split-block\"), function(i, v){\n                    var item = $(v);\n                    if (Utils.isValue(itemsSize) && Utils.isValue(itemsSize[i])) item.css(\"flex-basis\", itemsSize[i]);\n                });\n            }\n        },\n\n        size: function(size){\n            var that = this, o = this.options;\n            if (Utils.isValue(size)) {\n                o.splitSizes = size;\n                that._setSize();\n            }\n            return this;\n        },\n\n        changeAttribute: function(attributeName){\n            var that = this, element = this.element;\n\n            function changeSize(){\n                var size = element.attr(\"data-split-sizes\");\n                that.size(size);\n            }\n\n            if (attributeName === 'data-split-sizes') {\n                changeSize();\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n            var gutters = element.children(\".gutter\");\n            gutters.off(Metro.events.start);\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var StepperDefaultConfig = {\n        stepperDeferred: 0,\n        view: Metro.stepperView.SQUARE, // square, cycle, diamond\n        steps: 3,\n        step: 1,\n        stepClick: false,\n        clsStepper: \"\",\n        clsStep: \"\",\n        clsComplete: \"\",\n        clsCurrent: \"\",\n        onStep: Metro.noop,\n        onStepClick: Metro.noop,\n        onStepperCreate: Metro.noop\n    };\n\n    Metro.stepperSetup = function (options) {\n        StepperDefaultConfig = $.extend({}, StepperDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroStepperSetup\"] !== undefined) {\n        Metro.stepperSetup(window[\"metroStepperSetup\"]);\n    }\n\n    Metro.Component('stepper', {\n        init: function( options, elem ) {\n            this._super(elem, options, StepperDefaultConfig, {\n                current: 0\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n\n            if (o.step <= 0) {\n                o.step = 1;\n            }\n\n            this._createStepper();\n            this._createEvents();\n\n            this._fireEvent(\"stepper-create\", {\n                element: element\n            });\n        },\n\n        _createStepper: function(){\n            var element = this.element, o = this.options;\n            var i;\n\n            element.addClass(\"stepper\").addClass(o.view).addClass(o.clsStepper);\n\n            for(i = 1; i <= o.steps; i++) {\n                $(\"<span>\").addClass(\"step\").addClass(o.clsStep).data(\"step\", i).html(\"<span>\"+i+\"</span>\").appendTo(element);\n            }\n\n            this.current = 1;\n            this.toStep(o.step);\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n\n            element.on(Metro.events.click, \".step\", function(){\n                var step = $(this).data(\"step\");\n                if (o.stepClick === true) {\n                    that.toStep(step);\n\n                    that._fireEvent(\"step-click\", {\n                        step: step\n                    });\n                }\n            });\n        },\n\n        next: function(){\n            var element = this.element;\n            var steps = element.find(\".step\");\n\n            if (this.current + 1 > steps.length) {\n                return ;\n            }\n\n            this.current++;\n\n            this.toStep(this.current);\n        },\n\n        prev: function(){\n            if (this.current - 1 === 0) {\n                return ;\n            }\n\n            this.current--;\n\n            this.toStep(this.current);\n        },\n\n        last: function(){\n            var element = this.element;\n\n            this.toStep(element.find(\".step\").length);\n        },\n\n        first: function(){\n            this.toStep(1);\n        },\n\n        toStep: function(step){\n            var element = this.element, o = this.options;\n            var target = $(element.find(\".step\").get(step - 1));\n            var prevStep = this.current;\n\n            if (target.length === 0) {\n                return ;\n            }\n\n            this.current = step;\n\n            element.find(\".step\")\n                .removeClass(\"complete current\")\n                .removeClass(o.clsCurrent)\n                .removeClass(o.clsComplete);\n\n            target.addClass(\"current\").addClass(o.clsCurrent);\n            target.prevAll().addClass(\"complete\").addClass(o.clsComplete);\n\n            this._fireEvent(\"step\", {\n                step: this.current,\n                prev: prevStep\n            });\n\n        },\n\n        changeAttribute: function(){\n        },\n\n        destroy: function(){\n            var element = this.element;\n            element.off(Metro.events.click, \".step\");\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro) {\n    'use strict';\n    var Utils = Metro.utils;\n\n    var MetroStorage = function(type){\n        return new MetroStorage.init(type);\n    };\n\n    MetroStorage.prototype = {\n        setKey: function(key){\n            this.key = key\n        },\n\n        getKey: function(){\n            return this.key;\n        },\n\n        setItem: function(key, value){\n            this.storage.setItem(this.key + \":\" + key, JSON.stringify(value));\n        },\n\n        getItem: function(key, default_value, reviver){\n            var result, value;\n\n            value = this.storage.getItem(this.key + \":\" + key);\n\n            try {\n                result = JSON.parse(value, reviver);\n            } catch (e) {\n                result = null;\n            }\n            return Utils.nvl(result, default_value);\n        },\n\n        getItemPart: function(key, sub_key, default_value, reviver){\n            var i;\n            var val = this.getItem(key, default_value, reviver);\n\n            sub_key = sub_key.split(\"->\");\n            for(i = 0; i < sub_key.length; i++) {\n                val = val[sub_key[i]];\n            }\n            return val;\n        },\n\n        delItem: function(key){\n            this.storage.removeItem(this.key + \":\" + key)\n        },\n\n        size: function(unit){\n            var divider;\n            switch (unit) {\n                case 'm':\n                case 'M': {\n                    divider = 1024 * 1024;\n                    break;\n                }\n                case 'k':\n                case 'K': {\n                    divider = 1024;\n                    break;\n                }\n                default: divider = 1;\n            }\n            return JSON.stringify(this.storage).length / divider;\n        }\n    };\n\n    MetroStorage.init = function(type){\n\n        this.key = \"\";\n        this.storage = type ? type : window.localStorage;\n\n        return this;\n    };\n\n    MetroStorage.init.prototype = MetroStorage.prototype;\n\n    Metro.storage = MetroStorage(window.localStorage);\n    Metro.session = MetroStorage(window.sessionStorage);\n}(Metro));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var StreamerDefaultConfig = {\n        streamerDeferred: 0,\n        wheel: true,\n        wheelStep: 20,\n        duration: METRO_ANIMATION_DURATION,\n        defaultClosedIcon: \"\",\n        defaultOpenIcon: \"\",\n        changeUri: true,\n        encodeLink: true,\n        closed: false,\n        chromeNotice: false,\n        startFrom: null,\n        slideToStart: true,\n        startSlideSleep: 1000,\n        source: null,\n        data: null,\n        eventClick: \"select\",\n        selectGlobal: true,\n        streamSelect: false,\n        excludeSelectElement: null,\n        excludeClickElement: null,\n        excludeElement: null,\n        excludeSelectClass: \"\",\n        excludeClickClass: \"\",\n        excludeClass: \"\",\n\n        onDataLoad: Metro.noop,\n        onDataLoaded: Metro.noop,\n        onDataLoadError: Metro.noop,\n\n        onDrawEvent: Metro.noop,\n        onDrawGlobalEvent: Metro.noop,\n        onDrawStream: Metro.noop,\n\n        onStreamClick: Metro.noop,\n        onStreamSelect: Metro.noop,\n        onEventClick: Metro.noop,\n        onEventSelect: Metro.noop,\n        onEventsScroll: Metro.noop,\n        onStreamerCreate: Metro.noop\n    };\n\n    Metro.streamerSetup = function (options) {\n        StreamerDefaultConfig = $.extend({}, StreamerDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroStreamerSetup\"] !== undefined) {\n        Metro.streamerSetup(window[\"metroStreamerSetup\"]);\n    }\n\n    Metro.Component('streamer', {\n        init: function( options, elem ) {\n            this._super(elem, options, StreamerDefaultConfig, {\n                data: null,\n                scroll: 0,\n                scrollDir: \"left\",\n                events: null\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n\n            element.addClass(\"streamer\");\n\n            if (element.attr(\"id\") === undefined) {\n                element.attr(\"id\", Utils.elementId(\"streamer\"));\n            }\n\n            if (o.source === null && o.data === null) {\n                return false;\n            }\n\n            $(\"<div>\").addClass(\"streams\").appendTo(element);\n            $(\"<div>\").addClass(\"events-area\").appendTo(element);\n\n            if (o.source !== null) {\n\n                this._fireEvent(\"data-load\", {\n                    source: o.source\n                });\n\n                this._loadSource();\n            } else {\n                this.data = o.data;\n                this.build();\n            }\n\n            if (o.chromeNotice === true && Utils.detectChrome() === true && $.touchable === false) {\n                $(\"<p>\").addClass(\"text-small text-muted\").html(\"*) In Chrome browser please press and hold Shift and turn the mouse wheel.\").insertAfter(element);\n            }\n        },\n\n        _loadSource: function(){\n            var that = this, o = this.options;\n\n            fetch(o.source)\n                .then(Metro.fetch.status)\n                .then(Metro.fetch.json)\n                .then(function(data){\n                    that._fireEvent(\"data-loaded\", {\n                        source: o.source,\n                        data: data\n                    });\n\n                    that.data = data;\n                    that.build();\n                })\n                .catch(function (error) {\n                    that._fireEvent(\"data-load-error\", {\n                        source: o.source,\n                        error: error\n                    });\n                });\n        },\n\n        build: function(){\n            var that = this, element = this.element, o = this.options, data = this.data;\n            var streams = element.find(\".streams\").html(\"\");\n            var events_area = element.find(\".events-area\").html(\"\");\n            var fake_timeline;\n            var timeline = $(\"<ul>\").addClass(\"streamer-timeline\").html(\"\").appendTo(events_area);\n            var streamer_events = $(\"<div>\").addClass(\"streamer-events\").appendTo(events_area);\n            var event_group_main = $(\"<div>\").addClass(\"event-group\").appendTo(streamer_events);\n            var StreamerIDS = Utils.getURIParameter(null, \"StreamerIDS\");\n\n            if (StreamerIDS !== null && o.encodeLink === true) {\n                StreamerIDS = atob(StreamerIDS);\n            }\n\n            var StreamerIDS_i = StreamerIDS ? StreamerIDS.split(\"|\")[0] : null;\n            var StreamerIDS_a = StreamerIDS ? StreamerIDS.split(\"|\")[1].split(\",\") : [];\n\n            if (data.actions !== undefined) {\n                var actions = $(\"<div>\").addClass(\"streamer-actions\").appendTo(streams);\n                $.each(data.actions, function(){\n                    var item = this;\n                    var button = $(\"<button>\").addClass(\"streamer-action\").addClass(item.cls).html(item.html);\n                    if (item.onclick !== undefined) button.on(Metro.events.click, function(){\n                        Utils.exec(item.onclick, [element]);\n                    });\n                    button.appendTo(actions);\n                });\n            }\n\n            // Create timeline\n\n            timeline.html(\"\");\n\n            if (data.timeline === undefined) {\n                data.timeline = {\n                    start: \"09:00\",\n                    stop: \"18:00\",\n                    step: 20\n                }\n            }\n\n            var start = new Date(), stop = new Date();\n            var start_time_array = data.timeline.start ? data.timeline.start.split(\":\") : [9,0];\n            var stop_time_array = data.timeline.stop ? data.timeline.stop.split(\":\") : [18,0];\n            var step = data.timeline.step ? parseInt(data.timeline.step) * 60 : 1200;\n\n            start.setHours(start_time_array[0]);\n            start.setMinutes(start_time_array[1]);\n            start.setSeconds(0);\n\n            stop.setHours(stop_time_array[0]);\n            stop.setMinutes(stop_time_array[1]);\n            stop.setSeconds(0);\n\n            var i, t, h, v, m, j, fm, li, fli, fli_w;\n\n            for (i = start.getTime()/1000; i <= stop.getTime()/1000; i += step) {\n                t = new Date(i * 1000);\n                h = t.getHours();\n                m = t.getMinutes();\n                v = Cake.lpad(h, 2, \"0\")+\":\"+Cake.lpad(m, 2, \"0\");\n\n                li = $(\"<li>\").data(\"time\", v).addClass(\"js-time-point-\" + v.replace(\":\", \"-\")).html(\"<em>\"+v+\"</em>\").appendTo(timeline);\n\n                fli_w = li.width() / parseInt(data.timeline.step);\n                fake_timeline = $(\"<ul>\").addClass(\"streamer-fake-timeline\").html(\"\").appendTo(li);\n                for(j = 0; j < parseInt(data.timeline.step); j++) {\n                    fm = m + j;\n                    v = Cake.lpad(h, 2, \"0\")+\":\"+Cake.lpad(fm, 2, \"0\");\n                    fli = $(\"<li>\").data(\"time\", v).addClass(\"js-fake-time-point-\" + v.replace(\":\", \"-\")).html(\"|\").appendTo(fake_timeline);\n                    fli.css({\n                        width: fli_w\n                    })\n                }\n            }\n\n            // -- End timeline creator\n\n            if (data.streams !== undefined) {\n                $.each(data.streams, function(stream_index){\n                    var stream_height = 75, rows = 0;\n                    var stream_item = this;\n                    var stream = $(\"<div>\").addClass(\"stream\").addClass(this.cls).appendTo(streams);\n                    stream\n                        .addClass(stream_item.cls)\n                        .data(\"one\", false)\n                        .data(\"data\", stream_item.data);\n\n                    $(\"<div>\").addClass(\"stream-title\").html(stream_item.title).appendTo(stream);\n                    $(\"<div>\").addClass(\"stream-secondary\").html(stream_item.secondary).appendTo(stream);\n                    $(stream_item.icon).addClass(\"stream-icon\").appendTo(stream);\n\n                    var bg = Metro.colors.toHEX(Utils.getStyleOne(stream, \"background-color\"));\n                    var fg = Metro.colors.toHEX(Utils.getStyleOne(stream, \"color\"));\n\n                    var stream_events = $(\"<div>\").addClass(\"stream-events\")\n                        .data(\"background-color\", bg)\n                        .data(\"text-color\", fg)\n                        .appendTo(event_group_main);\n\n                    if (stream_item.events !== undefined) {\n                        $.each(stream_item.events, function(event_index){\n                            var event_item = this;\n                            var row = event_item.row === undefined ? 1 : parseInt(event_item.row);\n                            var _icon;\n                            var sid = stream_index+\":\"+event_index;\n                            var custom_html = event_item.custom !== undefined ? event_item.custom : \"\";\n                            var custom_html_open = event_item.custom_open !== undefined ? event_item.custom_open : \"\";\n                            var custom_html_close = event_item.custom_close !== undefined ? event_item.custom_close : \"\";\n                            var event;\n\n                            if (event_item.skip !== undefined && Utils.bool(event_item.skip)) {\n                                return ;\n                            }\n\n                            event = $(\"<div>\")\n                                .data(\"origin\", event_item)\n                                .data(\"sid\", sid)\n                                .data(\"data\", event_item.data)\n                                .data(\"time\", event_item.time)\n                                .data(\"target\", event_item.target)\n                                .addClass(\"stream-event\")\n                                .addClass(\"size-\"+event_item.size+([\"half\", \"one-third\"].includes(event_item.size) ? \"\" : \"x\"))\n                                .addClass(event_item.cls)\n                                .appendTo(stream_events);\n\n\n                            var time_point = timeline.find(\".js-fake-time-point-\"+this.time.replace(\":\", \"-\"));\n                            var left = time_point.offset().left - stream_events.offset().left;\n                            var top = 75 * (row - 1);\n\n                            if (row > rows) {\n                                rows = row;\n                            }\n\n                            event.css({\n                                position: \"absolute\",\n                                left: left,\n                                top: top\n                            });\n\n\n                            if (Utils.isNull(event_item.html)) {\n\n                                var slide = $(\"<div>\").addClass(\"stream-event-slide\").appendTo(event);\n                                var slide_logo = $(\"<div>\").addClass(\"slide-logo\").appendTo(slide);\n                                var slide_data = $(\"<div>\").addClass(\"slide-data\").appendTo(slide);\n\n                                if (event_item.icon !== undefined) {\n                                    if (Utils.isTag(event_item.icon)) {\n                                        $(event_item.icon).addClass(\"icon\").appendTo(slide_logo);\n                                    } else {\n                                        $(\"<img>\").addClass(\"icon\").attr(\"src\", event_item.icon).appendTo(slide_logo);\n                                    }\n                                }\n\n                                $(\"<span>\").addClass(\"time\").css({\n                                    backgroundColor: bg,\n                                    color: fg\n                                }).html(event_item.time).appendTo(slide_logo);\n\n                                $(\"<div>\").addClass(\"title\").html(event_item.title).appendTo(slide_data);\n                                $(\"<div>\").addClass(\"subtitle\").html(event_item.subtitle).appendTo(slide_data);\n                                $(\"<div>\").addClass(\"desc\").html(event_item.desc).appendTo(slide_data);\n\n                                if (o.closed === false && (element.attr(\"id\") === StreamerIDS_i && StreamerIDS_a.indexOf(sid) !== -1) || event_item.selected === true || parseInt(event_item.selected) === 1) {\n                                    event.addClass(\"selected\");\n                                }\n\n                                if (o.closed === true || event_item.closed === true || parseInt(event_item.closed) === 1) {\n                                    _icon = event_item.closedIcon !== undefined ? Utils.isTag(event_item.closedIcon) ? event_item.closedIcon : \"<span>\" + event_item.closedIcon + \"</span>\" : Utils.isTag(o.defaultClosedIcon) ? o.defaultClosedIcon : \"<span>\" + o.defaultClosedIcon + \"</span>\";\n                                    $(_icon).addClass(\"state-icon\").addClass(event_item.clsClosedIcon).appendTo(slide);\n                                    event\n                                        .data(\"closed\", true)\n                                        .data(\"target\", event_item.target);\n                                    event.append(custom_html_open);\n                                } else {\n                                    _icon = event_item.openIcon !== undefined ? Utils.isTag(event_item.openIcon) ? event_item.openIcon : \"<span>\" + event_item.openIcon + \"</span>\" : Utils.isTag(o.defaultOpenIcon) ? o.defaultOpenIcon : \"<span>\" + o.defaultOpenIcon + \"</span>\";\n                                    $(_icon).addClass(\"state-icon\").addClass(event_item.clsOpenIcon).appendTo(slide);\n                                    event\n                                        .data(\"closed\", false);\n                                    event.append(custom_html_close);\n                                }\n\n                                event.append(custom_html);\n                            } else {\n                                event.html(event_item.html);\n                            }\n\n                            that._fireEvent(\"draw-event\", {\n                                event: event[0]\n                            });\n\n                        });\n\n                        var last_child = stream_events.find(\".stream-event\").last();\n                        if (last_child.length > 0) stream_events.outerWidth(last_child[0].offsetLeft + last_child.outerWidth());\n                    }\n\n                    stream_events.css({\n                        height: stream_height * rows\n                    });\n\n                    element.find(\".stream\").eq(stream_events.index()).css({\n                        height: stream_height * rows\n                    });\n\n                    that._fireEvent(\"draw-stream\", {\n                        stream: stream[0]\n                    });\n\n                });\n            }\n\n            if (data.global !== undefined) {\n                var streamer_events_left = streamer_events.offset().left;\n                $.each(['before', 'after'], function(){\n                    var global_item = this;\n                    if (data.global[global_item] !== undefined) {\n                        $.each(data.global[global_item], function(){\n                            var event_item = this;\n                            var group = $(\"<div>\").addClass(\"event-group\").addClass(\"size-\"+event_item.size+([\"half\", \"one-third\"].includes(event_item.size) ? \"\" : \"x\"));\n                            var events = $(\"<div>\").addClass(\"stream-events global-stream\").appendTo(group);\n                            var event = $(\"<div>\").addClass(\"stream-event\").appendTo(events);\n                            event\n                                .addClass(\"global-event\")\n                                .addClass(event_item.cls)\n                                .data(\"time\", event_item.time)\n                                .data(\"origin\", event_item)\n                                .data(\"data\", event_item.data);\n\n                            $(\"<div>\").addClass(\"event-title\").html(event_item.title).appendTo(event);\n                            $(\"<div>\").addClass(\"event-subtitle\").html(event_item.subtitle).appendTo(event);\n                            $(\"<div>\").addClass(\"event-html\").html(event_item.html).appendTo(event);\n\n                            var left, t = timeline.find(\".js-fake-time-point-\"+this.time.replace(\":\", \"-\"));\n\n                            if (t.length > 0) {\n                                // left = t[0].offsetLeft - streams.find(\".stream\").outerWidth();\n                                left = t.offset().left - streamer_events_left;\n                            }\n                            group.css({\n                                position: \"absolute\",\n                                left: left,\n                                height: \"100%\"\n                            }).appendTo(streamer_events);\n\n                            that._fireEvent(\"draw-global-event\", {\n                                event: event[0]\n                            });\n\n                        });\n                    }\n                });\n            }\n\n            element.data(\"stream\", -1);\n            element.find(\".events-area\").scrollLeft(0);\n\n            this.events = element.find(\".stream-event\");\n\n            this._createEvents();\n\n            if (o.startFrom !== null && o.slideToStart === true) {\n                setTimeout(function(){\n                    that.slideTo(o.startFrom);\n                }, o.startSlideSleep);\n            }\n\n            this._fireEvent(\"streamer-create\");\n\n            this._fireScroll();\n        },\n\n        _fireScroll: function(){\n            var that = this, element = this.element;\n            var scrollable = element.find(\".events-area\");\n            var oldScroll = this.scroll;\n\n            if (scrollable.length === 0) {\n                return undefined;\n            }\n\n            this.scrollDir = this.scroll < scrollable[0].scrollLeft ? \"left\" : \"right\";\n            this.scroll = scrollable[0].scrollLeft;\n\n            this._fireEvent(\"events-scroll\", {\n                scrollLeft: scrollable[0].scrollLeft,\n                oldScroll: oldScroll,\n                scrollDir: that.scrollDir,\n                events: $.toArray(this.events)\n            });\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n\n            function disableScroll() {\n                var scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n                var scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;\n\n                window.onscroll = function() {\n                    window.scrollTo(scrollLeft, scrollTop);\n                };\n            }\n\n            function enableScroll() {\n                window.onscroll = function() {};\n            }\n\n            element.off(Metro.events.click, \".stream-event\").on(Metro.events.click, \".stream-event\", function(e){\n                var event = $(this);\n\n                if (o.excludeClass !== \"\" && event.hasClass(o.excludeClass)) {\n                    return ;\n                }\n\n                if (o.excludeElement !== null && $(e.target).is(o.excludeElement)) {\n                    return ;\n                }\n\n                if (o.closed === false && event.data(\"closed\") !== true && o.eventClick === 'select') {\n                    if (o.excludeSelectClass !== \"\" && event.hasClass(o.excludeSelectClass)) {\n                        /* eslint-disable-next-line */\n\n                    } else {\n                        if (o.excludeSelectElement !== null && $(e.target).is(o.excludeSelectElement)) {\n                            /* eslint-disable-next-line */\n\n                        } else {\n                            if (event.hasClass(\"global-event\")) {\n                                if (o.selectGlobal === true) {\n                                    event.toggleClass(\"selected\");\n                                }\n                            } else {\n                                event.toggleClass(\"selected\");\n                            }\n                            if (o.changeUri === true) {\n                                that._changeURI();\n                            }\n\n                            that._fireEvent(\"event-select\", {\n                                event: event[0],\n                                selected: event.hasClass(\"selected\")\n                            });\n                        }\n                    }\n                } else {\n                    if (o.excludeClickClass !== \"\" && event.hasClass(o.excludeClickClass)) {\n                        /* eslint-disable-next-line */\n\n                    } else {\n\n                        if (o.excludeClickElement !== null && $(e.target).is(o.excludeClickElement)) {\n                            /* eslint-disable-next-line */\n\n                        } else {\n\n                            that._fireEvent(\"event-click\", {\n                                event: event[0]\n                            });\n\n                            if (o.closed === true || event.data(\"closed\") === true) {\n                                var target = event.data(\"target\");\n                                if (target) {\n                                    window.location.href = target;\n                                }\n                            }\n\n                        }\n                    }\n                }\n            });\n\n            element.off(Metro.events.click, \".stream\").on(Metro.events.click, \".stream\", function(){\n                var stream = $(this);\n                var index = stream.index();\n\n                if (o.streamSelect === false) {\n                    return;\n                }\n\n                if (element.data(\"stream\") === index) {\n                    element.find(\".stream-event\").removeClass(\"disabled\");\n                    element.data(\"stream\", -1);\n                } else {\n                    element.data(\"stream\", index);\n                    element.find(\".stream-event\").addClass(\"disabled\");\n                    that.enableStream(stream);\n                    that._fireEvent(\"stream-select\", {\n                        stream: stream\n                    });\n                }\n\n                that._fireEvent(\"stream-click\", {\n                    stream: stream\n                });\n            });\n\n            if (o.wheel === true) {\n                element.find(\".events-area\")\n                    .off(Metro.events.mousewheel)\n                    .on(Metro.events.mousewheel, function(e) {\n\n                    if (e.deltaY === undefined) {\n                        return ;\n                    }\n\n                    var scroll, scrollable = $(this);\n                    var dir = e.deltaY > 0 ? -1 : 1;\n                    var step = o.wheelStep;\n\n\n                    scroll = scrollable.scrollLeft() - ( dir * step);\n                    scrollable.scrollLeft(scroll);\n\n                });\n\n                element.find(\".events-area\").off(\"mouseenter\").on(\"mouseenter\", function() {\n                    disableScroll();\n                });\n\n                element.find(\".events-area\").off(\"mouseleave\").on(\"mouseleave\", function() {\n                    enableScroll();\n                });\n            }\n\n            element.find(\".events-area\").last().off(\"scroll\").on(\"scroll\", function(){\n                that._fireScroll();\n            });\n\n            if ($.touchable === true) {\n                element.off(Metro.events.click, \".stream\").on(Metro.events.click, \".stream\", function(){\n                    var stream = $(this);\n                    stream.toggleClass(\"focused\");\n                    $.each(element.find(\".stream\"), function () {\n                        if ($(this).is(stream)) return ;\n                        $(this).removeClass(\"focused\");\n                    })\n                })\n            }\n        },\n\n        _changeURI: function(){\n            var link = this.getLink();\n            history.pushState({}, document.title, link);\n        },\n\n        slideTo: function(time){\n            var element = this.element, o = this.options;\n            var target;\n            if (time === undefined) {\n                target = $(element.find(\".streamer-timeline li\")[0]);\n            } else {\n                target = $(element.find(\".streamer-timeline .js-time-point-\" + time.replace(\":\", \"-\"))[0]);\n            }\n\n            element\n                .find(\".events-area\")\n                .animate({\n                    draw: {\n                        scrollLeft: target[0].offsetLeft - element.find(\".streams .stream\").outerWidth()\n                    },\n                    dur: o.duration\n                });\n        },\n\n        enableStream: function(stream){\n            var element = this.element;\n            var index = stream.index()-1;\n            stream.removeClass(\"disabled\").data(\"streamDisabled\", false);\n            element.find(\".stream-events\").eq(index).find(\".stream-event\").removeClass(\"disabled\");\n        },\n\n        disableStream: function(stream){\n            var element = this.element;\n            var index = stream.index()-1;\n            stream.addClass(\"disabled\").data(\"streamDisabled\", true);\n            element.find(\".stream-events\").eq(index).find(\".stream-event\").addClass(\"disabled\");\n        },\n\n        toggleStream: function(stream){\n            if (stream.data(\"streamDisabled\") === true) {\n                this.enableStream(stream);\n            } else {\n                this.disableStream(stream);\n            }\n        },\n\n        getLink: function(){\n            var element = this.element, o = this.options;\n            var events = element.find(\".stream-event\");\n            var a = [];\n            var link;\n            var origin = window.location.href;\n\n            $.each(events, function(){\n                var event = $(this);\n                if (event.data(\"sid\") === undefined || !event.hasClass(\"selected\")) {\n                    return;\n                }\n\n                a.push(event.data(\"sid\"));\n            });\n\n            link = element.attr(\"id\") + \"|\" + a.join(\",\");\n\n            if (o.encodeLink === true) {\n                link = btoa(link);\n            }\n\n            return Utils.updateURIParameter(origin, \"StreamerIDS\", link);\n        },\n\n        getTimes: function(){\n            var element = this.element;\n            var times = element.find(\".streamer-timeline > li\");\n            var result = [];\n            $.each(times, function(){\n                result.push($(this).data(\"time\"));\n            });\n            return result;\n        },\n\n        getEvents: function(event_type, include_global){\n            var element = this.element;\n            var items, events = [];\n\n            switch (event_type) {\n                case \"selected\": items = element.find(\".stream-event.selected\"); break;\n                case \"non-selected\": items = element.find(\".stream-event:not(.selected)\"); break;\n                default: items = element.find(\".stream-event\");\n            }\n\n            $.each(items, function(){\n                var item = $(this);\n                var origin;\n\n                if (include_global !== true && item.parent().hasClass(\"global-stream\")) return ;\n\n                origin = item.data(\"origin\");\n\n                events.push(origin);\n            });\n\n            return events;\n        },\n\n        source: function(s){\n            var element = this.element;\n\n            if (s === undefined) {\n                return this.options.source;\n            }\n\n            element.attr(\"data-source\", s);\n\n            this.options.source = s;\n            this.changeSource();\n        },\n\n        dataSet: function(s){\n            if (s === undefined) {\n                return this.options.data;\n            }\n\n            this.options.data = s;\n            this.changeData(s);\n        },\n\n        getStreamerData: function(){\n            return this.data;\n        },\n\n        toggleEvent: function(event){\n            var o = this.options;\n            event = $(event);\n\n            if (event.hasClass(\"global-event\") && o.selectGlobal !== true) {\n                return ;\n            }\n\n            if (event.hasClass(\"selected\")) {\n                this.selectEvent(event, false);\n            } else {\n                this.selectEvent(event, true);\n            }\n        },\n\n        selectEvent: function(event, state){\n            var that = this, o = this.options;\n            if (state === undefined) {\n                state = true;\n            }\n            event = $(event);\n\n            if (event.hasClass(\"global-event\") && o.selectGlobal !== true) {\n                return ;\n            }\n\n            if (state === true) event.addClass(\"selected\"); else event.removeClass(\"selected\");\n\n            if (o.changeUri === true) {\n                that._changeURI();\n            }\n\n            this._fireEvent(\"event-select\", {\n                event: event[0],\n                selected: state\n            });\n        },\n\n        changeSource: function(){\n            var element = this.element, o = this.options;\n            var new_source = element.attr(\"data-source\");\n\n            if (String(new_source).trim() === \"\") {\n                return ;\n            }\n\n            o.source = new_source;\n\n            this._fireEvent(\"data-load\", {\n                source: o.source\n            });\n\n            this._loadSource();\n\n            // $.json(o.source).then(function(data){\n            //\n            //     that._fireEvent(\"data-loaded\", {\n            //         source: o.source,\n            //         data: data\n            //     });\n            //\n            //     that.data = data;\n            //     that.build();\n            // }, function(xhr){\n            //\n            //     that._fireEvent(\"data-load-error\", {\n            //         source: o.source,\n            //         xhr: xhr\n            //     });\n            // });\n\n            this._fireEvent(\"source-change\");\n        },\n\n        changeData: function(data){\n            var element = this.element, o = this.options;\n            var old_data = this.data;\n\n            o.data =  typeof data === 'object' ? data : JSON.parse(element.attr(\"data-data\"));\n\n            this.data = o.data;\n\n            this.build();\n\n            this._fireEvent(\"data-change\", {\n                oldData: old_data,\n                newData: o.data\n            });\n        },\n\n        changeStreamSelectOption: function(){\n            var element = this.element, o = this.options;\n\n            o.streamSelect = element.attr(\"data-stream-select\").toLowerCase() === \"true\";\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case 'data-source': this.changeSource(); break;\n                case 'data-data': this.changeData(); break;\n                case 'data-stream-select': this.changeStreamSelectOption(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n\n            element.off(Metro.events.click, \".stream-event\");\n            element.off(Metro.events.click, \".stream\");\n            element.find(\".events-area\").off(Metro.events.mousewheel);\n            element.find(\".events-area\").last().off(\"scroll\");\n            // element.off(Metro.events.click, \".stream\");\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var SwitchDefaultConfig = {\n        switchDeferred: 0,\n        material: false,\n        transition: true,\n        caption: \"\",\n        captionPosition: \"right\",\n        clsSwitch: \"\",\n        clsCheck: \"\",\n        clsCaption: \"\",\n        textOn: \"\",\n        textOff: \"\",\n        locale: METRO_LOCALE,\n        showOnOff: false,\n        onSwitchCreate: Metro.noop\n    };\n\n    Metro.switchSetup = function (options) {\n        SwitchDefaultConfig = $.extend({}, SwitchDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroSwitchSetup\"] !== undefined) {\n        Metro.switchSetup(window[\"metroSwitchSetup\"]);\n    }\n\n    Metro.Component('switch', {\n        init: function( options, elem ) {\n            this._super(elem, options, SwitchDefaultConfig, {\n                locale: null\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n            var container ;\n            var check = $(\"<span>\").addClass(\"check\");\n            var caption = $(\"<span>\").addClass(\"caption\").html(o.caption);\n\n            element.attr(\"type\", \"checkbox\");\n\n            if (element.attr(\"readonly\") !== undefined) {\n                element.on(\"click\", function(e){\n                    e.preventDefault();\n                })\n            }\n\n            container = element.wrap(\n                $(\"<label>\").addClass((o.material === true ? \" switch-material \" : \" switch \") + element[0].className)\n            );\n\n            this.component = container;\n\n            check.appendTo(container);\n            caption.appendTo(container);\n\n            if (o.transition === true) {\n                container.addClass(\"transition-on\");\n            }\n\n            if (o.captionPosition === 'left') {\n                container.addClass(\"caption-left\");\n            }\n\n            element[0].className = '';\n\n            container.addClass(o.clsSwitch);\n            caption.addClass(o.clsCaption);\n            check.addClass(o.clsCheck);\n\n            if (element.is(':disabled')) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n\n            this.i18n(o.locale);\n            this._fireEvent(\"switch-create\");\n        },\n\n        disable: function(){\n            this.element.prop(\"disabled\", true);\n        },\n\n        enable: function(){\n            this.element.prop(\"disabled\", false);\n        },\n\n        toggleState: function(){\n            var element = this.element;\n\n            if (!element.is(\":disabled\")) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        toggle: function(v){\n            var element = this.element;\n\n            if (element.is(\":disabled\")) return this;\n\n            if (!Utils.isValue(v)) {\n                element.prop(\"checked\", !Utils.bool(element.prop(\"checked\")));\n            } else {\n                element.prop(\"checked\", v === 1);\n            }\n\n            return this;\n        },\n\n        changeLocale: function(where, val){\n            var element = this.element, o = this.options;\n            var check = element.siblings(\".check\");\n\n            o[\"text\"+Cake.capitalize(where)] = val\n\n            check.attr(\"data-\"+where, val);\n        },\n\n        i18n: function(locale){\n            var element = this.element, o = this.options;\n            var check = element.siblings(\".check\");\n            var on, off;\n\n            o.locale = locale;\n            this.locale = Metro.locales[o.locale] !== undefined ? Metro.locales[o.locale] : Metro.locales[\"en-US\"];\n\n            if (o.showOnOff) {\n                on = element.attr(\"data-on\") || o.textOn || this.locale.switch.on;\n                off = element.attr(\"data-off\") || o.textOff || this.locale.switch.off;\n\n                check.attr(\"data-on\", on);\n                check.attr(\"data-off\", off);\n            } else {\n                check.removeAttr(\"data-on\");\n                check.removeAttr(\"data-off\");\n            }\n        },\n\n        changeAttribute: function(attr, newVal){\n            switch (attr) {\n                case 'data-on':\n                case 'data-text-on': this.changeLocale('on', newVal); break;\n                case 'data-off':\n                case 'data-text-off': this.changeLocale('off', newVal); break;\n            }\n        },\n\n        destroy: function(){\n            return this.element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var Utils = Metro.utils;\n    var TableDefaultConfig = {\n        useCurrentSlice: false,\n        showInspectorButton: false,\n        inspectorButtonIcon: \"<span class='default-icon-equalizer'>\",\n        tableDeferred: 0,\n        templateBeginToken: \"<%\",\n        templateEndToken: \"%>\",\n        paginationDistance: 5,\n\n        locale: METRO_LOCALE,\n\n        horizontalScroll: false,\n        horizontalScrollStop: null,\n        check: false,\n        checkType: \"checkbox\",\n        checkStyle: 1,\n        checkColIndex: 0,\n        checkName: null,\n        checkStoreKey: \"TABLE:$1:KEYS\",\n        rownum: false,\n        rownumTitle: \"#\",\n\n        filters: null,\n        filtersOperator: \"and\",\n\n        head: null,\n        body: null,\n        static: false,\n        source: null,\n\n        searchMinLength: 1,\n        searchThreshold: 500,\n        searchFields: null,\n\n        showRowsSteps: true,\n        showSearch: true,\n        showTableInfo: true,\n        showPagination: true,\n        paginationShortMode: true,\n        showActivity: true,\n        muteTable: true,\n        showSkip: false,\n\n        rows: 10,\n        rowsSteps: \"10,25,50,100\",\n\n        staticView: false,\n        viewSaveMode: \"client\",\n        viewSavePath: \"TABLE:$1:OPTIONS\",\n\n        sortDir: \"asc\",\n        decimalSeparator: \".\",\n        thousandSeparator: \",\",\n\n        tableRowsCountTitle: null,\n        tableSearchTitle: null,\n        tableInfoTitle: null,\n        paginationPrevTitle: null,\n        paginationNextTitle: null,\n        allRecordsTitle: null,\n        inspectorTitle: null,\n        tableSkipTitle: null,\n        emptyTableTitle: null,\n\n        activityType: \"atom\",\n        activityStyle: \"color\",\n        activityTimeout: 100,\n\n        searchWrapper: null,\n        rowsWrapper: null,\n        infoWrapper: null,\n        paginationWrapper: null,\n        skipWrapper: null,\n\n        cellWrapper: true,\n\n        clsComponent: \"\",\n        clsTableContainer: \"\",\n        clsTable: \"\",\n\n        clsHead: \"\",\n        clsHeadRow: \"\",\n        clsHeadCell: \"\",\n\n        clsBody: \"\",\n        clsBodyRow: \"\",\n        clsBodyCell: \"\",\n        clsCellWrapper: \"\",\n\n        clsFooter: \"\",\n        clsFooterRow: \"\",\n        clsFooterCell: \"\",\n\n        clsTableTop: \"\",\n        clsRowsCount: \"\",\n        clsSearch: \"\",\n\n        clsTableBottom: \"\",\n        clsTableInfo: \"\",\n        clsTablePagination: \"\",\n\n        clsPagination: \"\",\n        clsTableSkip: \"\",\n        clsTableSkipInput: \"\",\n        clsTableSkipButton: \"\",\n\n        clsEvenRow: \"\",\n        clsOddRow: \"\",\n        clsRow: \"\",\n\n        clsEmptyTableTitle: \"\",\n\n        onDraw: Metro.noop,\n        onDrawRow: Metro.noop,\n        onDrawCell: Metro.noop,\n        onAppendRow: Metro.noop,\n        onAppendCell: Metro.noop,\n        onSortStart: Metro.noop,\n        onSortStop: Metro.noop,\n        onSortItemSwitch: Metro.noop,\n        onSearch: Metro.noop,\n        onRowsCountChange: Metro.noop,\n        onDataLoad: Metro.noop,\n        onDataLoadError: Metro.noop,\n        onDataLoaded: Metro.noop,\n        onDataLoadEnd: Metro.noop,\n        onDataSaveError: Metro.noop,\n        onFilterRowAccepted: Metro.noop,\n        onFilterRowDeclined: Metro.noop,\n        onCheckClick: Metro.noop,\n        onCheckClickAll: Metro.noop,\n        onCheckDraw: Metro.noop,\n        onViewSave: Metro.noop,\n        onViewGet: Metro.noop,\n        onViewCreated: Metro.noop,\n        onTableCreate: Metro.noop,\n        onSkip: Metro.noop\n    };\n\n    Metro.tableSetup = function(options){\n        TableDefaultConfig = $.extend({}, TableDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroTableSetup\"] !== undefined) {\n        Metro.tableSetup(window[\"metroTableSetup\"]);\n    }\n\n    Metro.Component('table', {\n        init: function( options, elem ) {\n            this._super(elem, options, TableDefaultConfig, {\n                currentPage: 1,\n                pagesCount: 1,\n                searchString: \"\",\n                data: null,\n                activity: null,\n                loadActivity: null,\n                busy: false,\n                filters: [],\n                wrapperInfo: null,\n                wrapperSearch: null,\n                wrapperRows: null,\n                wrapperPagination: null,\n                wrapperSkip: null,\n                filterIndex: null,\n                filtersIndexes: [],\n                component: null,\n                inspector: null,\n                view: {},\n                viewDefault: {},\n                locale: Metro.locales[\"en-US\"],\n                input_interval: null,\n                searchFields: [],\n                id: Utils.elementId('table'),\n                sort: {\n                    dir: \"asc\",\n                    colIndex: 0\n                },\n                service: [],\n                heads: [],\n                items: [],\n                foots: [],\n                filteredItems: [],\n                currentSlice: [],\n                index: {}\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var that = this, element = this.element, o = this.options;\n            var id = Utils.elementId(\"table\");\n            var table_component, table_container, activity;\n\n            if (!Utils.isValue(element.attr(\"id\"))) {\n                element.attr(\"id\", id);\n            }\n\n            if (Utils.isValue(Metro.locales[o.locale])) {\n                this.locale = Metro.locales[o.locale];\n            }\n\n            if (Utils.isValue(o.searchFields)) {\n                this.searchFields = o.searchFields.toArray();\n            }\n\n            if (Utils.isValue(o.head)) {\n                var _head = o.head;\n                o.head = Utils.isObject(o.head);\n                if (!o.head) {\n                    console.warn(\"Head \"+_head+\" defined but not exists!\");\n                    o.head = null;\n                }\n            }\n\n            if (Utils.isValue(o.body)) {\n                var _body = o.body;\n                o.body = Utils.isObject(o.body);\n                if (!o.body) {\n                    console.warn(\"Body \"+_body+\" defined but not exists!\");\n                    o.body = null;\n                }\n            }\n\n            if (o.static === true) {\n                o.showPagination = false;\n                o.showRowsSteps = false;\n                o.showSearch = false;\n                o.showTableInfo = false;\n                o.showSkip = false;\n                o.rows = -1;\n            }\n\n            table_component = $(\"<div>\").addClass(\"table-component\");\n            table_component.insertBefore(element);\n\n            table_container = $(\"<div>\").addClass(\"table-container\").addClass(o.clsTableContainer).appendTo(table_component);\n            element.appendTo(table_container);\n\n            if (o.horizontalScroll === true) {\n                table_container.addClass(\"horizontal-scroll\");\n            }\n            if (!Utils.isNull(o.horizontalScrollStop) && Utils.mediaExist(o.horizontalScrollStop)) {\n                table_container.removeClass(\"horizontal-scroll\");\n            }\n\n            table_component.addClass(o.clsComponent);\n\n            this.activity =  $(\"<div>\").addClass(\"table-progress\").appendTo(table_component);\n\n            activity = $(\"<div>\").appendTo(this.activity);\n            Metro.makePlugin(activity, \"activity\", {\n                type: o.activityType,\n                style: o.activityStyle\n            });\n\n            if (o.showActivity !== true) {\n                this.activity.css({\n                    visibility: \"hidden\"\n                })\n            }\n\n            this.component = table_component[0];\n\n            if (o.source !== null) {\n\n                this._fireEvent(\"data-load\", {\n                    source: o.source\n                });\n\n                var objSource = Utils.isObject(o.source);\n\n                if (objSource !== false && $.isPlainObject(objSource)) {\n                    that._build(objSource);\n                } else {\n                    this.activity.show(function () {\n                        fetch(o.source)\n                            .then(Metro.fetch.status)\n                            .then(Metro.fetch.json)\n                            .then(function(data){\n                                that.activity.hide();\n                                if (typeof data !== \"object\") {\n                                    throw new Error(\"Data for table is not a object\");\n                                }\n\n                                that._fireEvent(\"data-loaded\", {\n                                    source: o.source,\n                                    data: data\n                                });\n\n                                that._build(data);\n                            })\n                            .catch(function(error){\n                                that.activity.hide();\n\n                                that._fireEvent(\"data-load-error\", {\n                                    source: o.source,\n                                    error: error\n                                });\n                            });\n                    });\n                }\n            } else {\n                that._build();\n            }\n        },\n\n        _createIndex: function(){\n            var that = this, colIndex = this.options.checkColIndex;\n            setImmediate(function(){\n                that.items.forEach(function(v, i){\n                    that.index[v[colIndex]] = i;\n                });\n            });\n        },\n\n        _build: function(data){\n            var that = this, element = this.element, o = this.options;\n            var view, id = element.attr(\"id\"), viewPath;\n\n            o.rows = +o.rows;\n\n            this.items = [];\n            this.heads = [];\n            this.foots = [];\n\n            if (Array.isArray(o.head)) {\n                this.heads = o.head;\n            }\n\n            if (Array.isArray(o.body)) {\n                this.items = o.body;\n            }\n\n            if (Utils.isValue(data)) {\n                this._createItemsFromJSON(data);\n            } else {\n                this._createItemsFromHTML()\n            }\n\n            // Create index\n            this._createIndex();\n\n            this.view = this._createView();\n            this.viewDefault = Utils.objectClone(this.view);\n\n            viewPath = o.viewSavePath.replace(\"$1\", id);\n\n            if (o.viewSaveMode.toLowerCase() === \"client\") {\n\n                view = Metro.storage.getItem(viewPath);\n                if (Utils.isValue(view) && Utils.objectLength(view) === Utils.objectLength(this.view)) {\n                    this.view = view;\n\n                    this._fireEvent(\"view-get\", {\n                        source: \"client\",\n                        view: view\n                    });\n                }\n                this._final();\n\n            } else {\n\n                fetch(viewPath)\n                    .then(Metro.fetch.status)\n                    .then(Metro.fetch.json)\n                    .then(function(view){\n                        if (Utils.isValue(view) && Utils.objectLength(view) === Utils.objectLength(that.view)) {\n                            that.view = view;\n                            that._fireEvent(\"view-get\", {\n                                source: \"server\",\n                                view: view\n                            });\n                        }\n                        that._final();\n                    })\n                    .catch(function(error){\n                        that._final();\n                        console.warn(\"Warning! Error loading view for table \" + element.attr('id') + \": \" + error);\n                    });\n            }\n        },\n\n        _final: function(){\n            var element = this.element, o = this.options;\n            var id = element.attr(\"id\");\n\n            Metro.storage.delItem(o.checkStoreKey.replace(\"$1\", id));\n\n            this._service();\n            this._createStructure();\n            this._createInspector();\n            this._createEvents();\n\n            this._fireEvent(\"table-create\", {\n                element: element\n            });\n        },\n\n        _service: function(){\n            var o = this.options;\n\n            this.service = [\n                {\n                    // Rownum\n                    title: o.rownumTitle,\n                    format: undefined,\n                    name: undefined,\n                    sortable: false,\n                    sortDir: undefined,\n                    clsColumn: \"rownum-cell \" + (o.rownum !== true ? \"d-none\" : \"\"),\n                    cls: \"rownum-cell \" + (o.rownum !== true ? \"d-none\" : \"\"),\n                    colspan: undefined,\n                    type: \"rownum\"\n                },\n                {\n                    // Check\n                    title: o.checkType === \"checkbox\" ? \"<input type='checkbox' data-role='checkbox' class='table-service-check-all' data-style='\"+o.checkStyle+\"'>\" : \"\",\n                    format: undefined,\n                    name: undefined,\n                    sortable: false,\n                    sortDir: undefined,\n                    clsColumn: \"check-cell \" + (o.check !== true ? \"d-none\" : \"\"),\n                    cls: \"check-cell \"+(o.check !== true ? \"d-none\" : \"\"),\n                    colspan: undefined,\n                    type: \"rowcheck\"\n                }\n            ];\n        },\n\n        _createView: function(){\n            var view;\n\n            view = {};\n\n            $.each(this.heads, function(i){\n\n                if (Utils.isValue(this.cls)) {this.cls = this.cls.replace(\"hidden\", \"\");}\n                if (Utils.isValue(this.clsColumn)) {this.clsColumn = this.clsColumn.replace(\"hidden\", \"\");}\n\n                view[i] = {\n                    \"index\": i,\n                    \"index-view\": i,\n                    \"show\": !Utils.isValue(this.show) ? true : this.show,\n                    \"size\": Utils.isValue(this.size) ? this.size : \"\"\n                }\n            });\n\n            this._fireEvent(\"view-created\", {\n                view: view\n            });\n\n            return view;\n        },\n\n        _createInspectorItems: function(table){\n            var that = this, o = this.options;\n            var j, tds = [], row;\n            var cells = this.heads;\n\n            table.html(\"\");\n\n            for (j = 0; j < cells.length; j++){\n                tds[j] = null;\n            }\n\n            $.each(cells, function(i){\n                row = $(\"<tr>\");\n                row.data('index', i);\n                row.data('index-view', i);\n                $(\"<td>\").html(\"<input type='checkbox' data-style='\"+o.checkStyle+\"' data-role='checkbox' name='column_show_check[]' value='\"+i+\"' \"+(Utils.bool(that.view[i]['show']) ? \"checked\" : \"\")+\">\").appendTo(row);\n                $(\"<td>\").html(this.title).appendTo(row);\n                $(\"<td>\").html(\"<input type='number' data-role='spinner' name='column_size' value='\"+that.view[i]['size']+\"' data-index='\"+i+\"'>\").appendTo(row);\n                $(\"<td>\").html(\"\" +\n                    \"<button class='button square js-table-inspector-field-up' type='button'><span class='mif-arrow-up'></span></button>\" +\n                    \"<button class='button square js-table-inspector-field-down' type='button'><span class='mif-arrow-down'></span></button>\" +\n                    \"\").appendTo(row);\n                tds[that.view[i]['index-view']] = row;\n            });\n\n            //\n            for (j = 0; j < cells.length; j++){\n                tds[j].appendTo(table);\n            }\n        },\n\n        _createInspector: function(){\n            var o = this.options;\n            var inspector, table_wrap, table, tbody, actions;\n\n            inspector = $(\"<div data-role='draggable' data-drag-element='.table-inspector-header' data-drag-area='body'>\").addClass(\"table-inspector\");\n            inspector.attr(\"for\", this.element.attr(\"id\"));\n\n            $(\"<div class='table-inspector-header'>\"+(o.inspectorTitle || this.locale.table[\"inspector\"])+\"</div>\").appendTo(inspector);\n\n            table_wrap = $(\"<div>\").addClass(\"table-wrap\").appendTo(inspector);\n\n            table = $(\"<table>\").addClass(\"table subcompact\");\n            tbody = $(\"<tbody>\").appendTo(table);\n\n            table.appendTo(table_wrap);\n\n            this._createInspectorItems(tbody);\n\n            actions = $(\"<div class='table-inspector-actions'>\").appendTo(inspector);\n            $(\"<button class='button primary js-table-inspector-save' type='button'>\").html(this.locale.buttons.save).appendTo(actions);\n            $(\"<button class='button secondary js-table-inspector-reset ml-2 mr-2' type='button'>\").html(this.locale.buttons.reset).appendTo(actions);\n            $(\"<button class='button link js-table-inspector-cancel place-right' type='button'>\").html(this.locale.buttons.cancel).appendTo(actions);\n\n            inspector.data(\"open\", false);\n            this.inspector = inspector;\n\n            $(\"body\").append(inspector);\n\n            this._createInspectorEvents();\n        },\n\n        _resetInspector: function(){\n            var inspector = this.inspector;\n            var table = inspector.find(\"table tbody\");\n            this._createInspectorItems(table);\n            this._createInspectorEvents();\n        },\n\n        _createHeadsFromHTML: function(){\n            var that = this, element = this.element;\n            var head = element.find(\"thead\");\n\n            if (head.length > 0) $.each(head.find(\"tr > *\"), function(){\n                var item = $(this);\n                var dir, head_item, item_class;\n\n                if (Utils.isValue(item.data('sort-dir'))) {\n                    dir = item.data('sort-dir');\n                } else {\n                    if (item.hasClass(\"sort-asc\")) {\n                        dir = \"asc\";\n                    } else if (item.hasClass(\"sort-desc\")) {\n                        dir = \"desc\"\n                    } else {\n                        dir = undefined;\n                    }\n                }\n\n                item_class = item[0].className.replace(\"sortable-column\", \"\");\n                item_class = item_class.replace(\"sort-asc\", \"\");\n                item_class = item_class.replace(\"sort-desc\", \"\");\n                item_class = item_class.replace(\"hidden\", \"\");\n\n                head_item = {\n                    type: \"data\",\n                    title: item.html(),\n                    name: Utils.isValue(item.data(\"name\")) ? item.data(\"name\") : item.text().replace(\" \", \"_\"),\n                    sortable: item.hasClass(\"sortable-column\") || (Utils.isValue(item.data('sortable')) && JSON.parse(item.data('sortable')) === true),\n                    sortDir: dir,\n                    format: Utils.isValue(item.data(\"format\")) ? item.data(\"format\") : \"string\",\n                    formatMask: Utils.isValue(item.data(\"format-mask\")) ? item.data(\"format-mask\") : null,\n                    clsColumn: Utils.isValue(item.data(\"cls-column\")) ? item.data(\"cls-column\") : \"\",\n                    cls: item_class,\n                    colspan: item.attr(\"colspan\"),\n                    size: Utils.isValue(item.data(\"size\")) ? item.data(\"size\") : \"\",\n                    show: !(item.hasClass(\"hidden\") || (Utils.isValue(item.data('show')) && JSON.parse(item.data('show')) === false)),\n\n                    required: Utils.isValue(item.data(\"required\")) ? JSON.parse(item.data(\"required\")) === true  : false,\n                    field: Utils.isValue(item.data(\"field\")) ? item.data(\"field\") : \"input\",\n                    fieldType: Utils.isValue(item.data(\"field-type\")) ? item.data(\"field-type\") : \"text\",\n                    validator: Utils.isValue(item.data(\"validator\")) ? item.data(\"validator\") : null,\n\n                    template: Utils.isValue(item.data(\"template\")) ? item.data(\"template\") : null\n                };\n                that.heads.push(head_item);\n            });\n        },\n\n        _createFootsFromHTML: function(){\n            var that = this, element = this.element;\n            var foot = element.find(\"tfoot\");\n\n            if (foot.length > 0) $.each(foot.find(\"tr > *\"), function(){\n                var item = $(this);\n                var foot_item;\n\n                foot_item = {\n                    title: item.html(),\n                    name: Utils.isValue(item.data(\"name\")) ? item.data(\"name\") : false,\n                    cls: item[0].className,\n                    colspan: item.attr(\"colspan\")\n                };\n\n                that.foots.push(foot_item);\n            });\n        },\n\n        _createItemsFromHTML: function(){\n            var that = this, element = this.element;\n            var body = element.find(\"tbody\");\n\n            if (body.length > 0) $.each(body.find(\"tr\"), function(){\n                var row = $(this);\n                var tr = [];\n                $.each(row.children(\"td\"), function(){\n                    var td = $(this);\n                    tr.push(td.html());\n                });\n                that.items.push(tr);\n            });\n\n            this._createHeadsFromHTML();\n            this._createFootsFromHTML();\n        },\n\n        _createItemsFromJSON: function(source){\n            var that = this;\n\n            if (typeof source === \"string\") {\n                source = JSON.parse(source);\n            }\n\n            if (source.header !== undefined) {\n                that.heads = source.header;\n            } else {\n                this._createHeadsFromHTML();\n            }\n\n            if (source.data !== undefined) {\n                $.each(source.data, function(){\n                    var row = this;\n                    var tr = [];\n                    $.each(row, function(){\n                        var td = this;\n                        tr.push(td);\n                    });\n                    that.items.push(tr);\n                });\n            }\n\n            if (source.footer !== undefined) {\n                this.foots = source.footer;\n            } else {\n                this._createFootsFromHTML();\n            }\n        },\n\n        _createTableHeader: function(){\n            var element = this.element, o = this.options;\n            var head = element.find(\"thead\");\n            var tr, th, tds = [], j, cells;\n            var view = o.staticView ? this._createView() : this.view;\n\n            if (head.length === 0) {\n                head = $(\"<thead>\");\n                element.prepend(head);\n            }\n\n            head.clear().addClass(o.clsHead);\n\n            if (this.heads.length === 0) {\n                return head;\n            }\n\n            tr = $(\"<tr>\").addClass(o.clsHeadRow).appendTo(head);\n\n            $.each(this.service, function(){\n                var item = this, classes = [];\n                th = $(\"<th>\").appendTo(tr);\n                if (Utils.isValue(item.title)) {th.html(item.title);}\n                if (Utils.isValue(item.size)) {th.css({width: item.size});}\n                if (Utils.isValue(item.cls)) {classes.push(item.cls);}\n                classes.push(o.clsHeadCell);\n                th.addClass(classes.join(\" \"));\n            });\n\n            cells = this.heads;\n\n            for (j = 0; j < cells.length; j++){\n                tds[j] = null;\n            }\n\n            $.each(cells, function(cell_index){\n                var item = this;\n                var classes = [];\n\n                th = $(\"<th>\");\n                th.data(\"index\", cell_index);\n\n                if (Utils.isValue(item.title)) {th.html(item.title);}\n                if (Utils.isValue(item.format)) {th.attr(\"data-format\", item.format);}\n                if (Utils.isValue(item.name)) {th.attr(\"data-name\", item.name);}\n                if (Utils.isValue(item.colspan)) {th.attr(\"colspan\", item.colspan);}\n                if (Utils.isValue(view[cell_index]['size'])) {th.css({width: view[cell_index]['size']});}\n                if (item.sortable === true) {\n                    classes.push(\"sortable-column\");\n\n                    if (Utils.isValue(item.sortDir)) {\n                        classes.push(\"sort-\" + item.sortDir);\n                    }\n                }\n                if (Utils.isValue(item.cls)) {\n                    $.each(item.cls.toArray(), function () {\n                        classes.push(this);\n                    });\n                }\n                if (Utils.bool(view[cell_index]['show']) === false) {\n                    if (classes.indexOf('hidden') === -1) classes.push(\"hidden\");\n                }\n\n                classes.push(o.clsHeadCell);\n\n                if (Utils.bool(view[cell_index]['show'])) {\n                    Utils.arrayDelete(classes, \"hidden\");\n                }\n\n                th.addClass(classes.join(\" \"));\n\n                tds[view[cell_index]['index-view']] = th;\n            });\n\n            for (j = 0; j < cells.length; j++){\n                tds[j].appendTo(tr);\n            }\n        },\n\n        _createTableBody: function(){\n            var body, head, element = this.element;\n\n            head  = element.find(\"thead\");\n            body  = element.find(\"tbody\");\n\n            if (body.length === 0) {\n                body = $(\"<tbody>\").addClass(this.options.clsBody);\n                if (head.length !== 0) {\n                    body.insertAfter(head);\n                } else {\n                    element.append(body);\n                }\n            }\n\n            body.clear();\n        },\n\n        _createTableFooter: function(){\n            var element = this.element, o = this.options;\n            var foot = element.find(\"tfoot\");\n            var tr, th;\n\n            if (foot.length === 0) {\n                foot = $(\"<tfoot>\").appendTo(element);\n            }\n\n            foot.clear().addClass(o.clsFooter);\n\n            if (this.foots.length === 0) {\n                return;\n            }\n\n            tr = $(\"<tr>\").addClass(o.clsHeadRow).appendTo(foot);\n            $.each(this.foots, function(){\n                var item = this;\n                th = $(\"<th>\").appendTo(tr);\n\n                if (item.title !== undefined) {\n                    th.html(item.title);\n                }\n\n                if (item.name !== undefined) {\n                    th.addClass(\"foot-column-name-\" + item.name);\n                }\n\n                if (item.cls !== undefined) {\n                    th.addClass(item.cls);\n                }\n\n                if (Utils.isValue(item.colspan)) {\n                    th.attr(\"colspan\", item.colspan);\n                }\n\n                th.appendTo(tr);\n            });\n        },\n\n        _createTopBlock: function (){\n            var that = this, element = this.element, o = this.options;\n            var top_block = $(\"<div>\").addClass(\"table-top\").addClass(o.clsTableTop).insertBefore(element.parent());\n            var search_block, search_input, rows_block, rows_select;\n\n            search_block = Utils.isValue(this.wrapperSearch) ? this.wrapperSearch : $(\"<div>\").addClass(\"table-search-block\").addClass(o.clsSearch).appendTo(top_block);\n            search_block.addClass(o.clsSearch);\n\n            search_input = $(\"<input>\").attr(\"type\", \"text\").appendTo(search_block);\n            Metro.makePlugin(search_input, \"input\", {\n                prepend: o.tableSearchTitle || that.locale.table[\"search\"]\n            });\n\n            if (o.showSearch !== true) {\n                search_block.hide();\n            }\n\n            rows_block = Utils.isValue(this.wrapperRows) ? this.wrapperRows : $(\"<div>\").addClass(\"table-rows-block\").appendTo(top_block);\n            rows_block.addClass(o.clsRowsCount);\n\n            rows_select = $(\"<select>\").appendTo(rows_block);\n            $.each(o.rowsSteps.toArray(), function () {\n                var val = parseInt(this);\n                var option = $(\"<option>\").attr(\"value\", val).text(val === -1 ? (o.allRecordsTitle || that.locale.table[\"all\"]) : val).appendTo(rows_select);\n                if (val === parseInt(o.rows)) {\n                    option.attr(\"selected\", \"selected\");\n                }\n            });\n            Metro.makePlugin(rows_select, \"select\",{\n                filter: false,\n                prepend: o.tableRowsCountTitle || that.locale.table[\"rowsCount\"],\n                onChange: function (val) {\n                    val = parseInt(val);\n                    if (val === parseInt(o.rows)) {\n                        return;\n                    }\n                    o.rows = val;\n                    that.currentPage = 1;\n                    that._draw();\n\n                    that._fireEvent(\"rows-count-change\", {\n                        val: val\n                    });\n                }\n            });\n\n            if (o.showInspectorButton) {\n                $(\"<button>\").addClass(\"button inspector-button\").attr(\"type\", \"button\").html(o.inspectorButtonIcon).insertAfter(rows_block);\n            }\n\n            if (o.showRowsSteps !== true) {\n                rows_block.hide();\n            }\n\n            return top_block;\n        },\n\n        _createBottomBlock: function (){\n            var element = this.element, o = this.options;\n            var bottom_block = $(\"<div>\").addClass(\"table-bottom\").addClass(o.clsTableBottom).insertAfter(element.parent());\n            var info, pagination, skip;\n\n            info = Utils.isValue(this.wrapperInfo) ? this.wrapperInfo : $(\"<div>\").addClass(\"table-info\").appendTo(bottom_block);\n            info.addClass(o.clsTableInfo);\n            if (o.showTableInfo !== true) {\n                info.hide();\n            }\n\n            pagination = Utils.isValue(this.wrapperPagination) ? this.wrapperPagination : $(\"<div>\").addClass(\"table-pagination\").appendTo(bottom_block);\n            pagination.addClass(o.clsTablePagination);\n            if (o.showPagination !== true) {\n                pagination.hide();\n            }\n\n            skip = Utils.isValue(this.wrapperSkip) ? this.wrapperSkip : $(\"<div>\").addClass(\"table-skip\").appendTo(bottom_block);\n            skip.addClass(o.clsTableSkip);\n\n            $(\"<input type='text'>\").addClass(\"input table-skip-input\").addClass(o.clsTableSkipInput).appendTo(skip);\n            $(\"<button>\").addClass(\"button table-skip-button\").addClass(o.clsTableSkipButton).html(o.tableSkipTitle || this.locale.table[\"skip\"]).appendTo(skip);\n\n            if (o.showSkip !== true) {\n                skip.hide();\n            }\n\n            return bottom_block;\n        },\n\n        _createStructure: function(){\n            var that = this, element = this.element, o = this.options;\n            var columns;\n            var w_search = $(o.searchWrapper),\n                w_info = $(o.infoWrapper),\n                w_rows = $(o.rowsWrapper),\n                w_paging = $(o.paginationWrapper),\n                w_skip = $(o.skipWrapper);\n\n            if (w_search.length > 0) {this.wrapperSearch = w_search;}\n            if (w_info.length > 0) {this.wrapperInfo = w_info;}\n            if (w_rows.length > 0) {this.wrapperRows = w_rows;}\n            if (w_paging.length > 0) {this.wrapperPagination = w_paging;}\n            if (w_skip.length > 0) {this.wrapperSkip = w_skip;}\n\n            element.addClass(o.clsTable);\n\n            this._createTableHeader();\n            this._createTableBody();\n            this._createTableFooter();\n\n            this._createTopBlock();\n            this._createBottomBlock();\n\n            var need_sort = false;\n            if (this.heads.length > 0) $.each(this.heads, function(i){\n                var item = this;\n                if (!need_sort && [\"asc\", \"desc\"].indexOf(item.sortDir) > -1) {\n                    need_sort = true;\n                    that.sort.colIndex = i;\n                    that.sort.dir = item.sortDir;\n                }\n            });\n\n            if (need_sort) {\n                columns = element.find(\"thead th\");\n                this._resetSortClass(columns);\n                $(columns.get(this.sort.colIndex + that.service.length)).addClass(\"sort-\"+this.sort.dir);\n                this.sorting();\n            }\n\n            var filter_func;\n\n            if (Utils.isValue(o.filters) && typeof o.filters === 'string') {\n                $.each(o.filters.toArray(), function(){\n                    filter_func = Utils.isFunc(this);\n                    if (filter_func !== false) {\n                        that.filtersIndexes.push(that.addFilter(filter_func));\n                    }\n                });\n            }\n\n            this.currentPage = 1;\n\n            this._draw();\n        },\n\n        _resetSortClass: function(el){\n            $(el).removeClass(\"sort-asc sort-desc\");\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var component = element.closest(\".table-component\");\n            var table_container = component.find(\".table-container\");\n            var search = component.find(\".table-search-block input\");\n            var skip_button = o.skipWrapper ? $(o.skipWrapper).find('.table-skip-button') : component.find(\".table-skip-button\");\n            var skip_input = o.skipWrapper ? $(o.skipWrapper).find('.table-skip-input') : component.find(\".table-skip-input\");\n            var customSearch;\n            var id = element.attr(\"id\");\n            var inspectorButton = component.find(\".inspector-button\");\n\n            inspectorButton.on(Metro.events.click, function(){\n                that.toggleInspector();\n            });\n\n            skip_button.on(Metro.events.click, function(){\n                var skipTo = parseInt(skip_input.val().trim());\n\n                if (isNaN(skipTo) || skipTo <=0 || skipTo > that.pagesCount) {\n                    skip_input.val('');\n                    return false;\n                }\n\n                skip_input.val('');\n\n                that._fireEvent(\"skip\", {\n                    skipTo: skipTo,\n                    skipFrom: that.currentPage\n                });\n\n                that.page(skipTo);\n            });\n\n            $(window).on(Metro.events.resize, function(){\n                if (o.horizontalScroll === true) {\n                    if (!Utils.isNull(o.horizontalScrollStop) && Utils.mediaExist(o.horizontalScrollStop)) {\n                        table_container.removeClass(\"horizontal-scroll\");\n                    } else {\n                        table_container.addClass(\"horizontal-scroll\");\n                    }\n                }\n            }, {ns: this.id});\n\n            element.on(Metro.events.click, \".sortable-column\", function(){\n\n                if (o.muteTable === true) element.addClass(\"disabled\");\n\n                if (that.busy) {\n                    return false;\n                }\n                that.busy = true;\n\n                var col = $(this);\n\n                that.activity.show(function(){\n                    setImmediate(function(){\n                        that.currentPage = 1;\n                        that.sort.colIndex = col.data(\"index\");\n                        if (!col.hasClass(\"sort-asc\") && !col.hasClass(\"sort-desc\")) {\n                            that.sort.dir = o.sortDir;\n                        } else {\n                            if (col.hasClass(\"sort-asc\")) {\n                                that.sort.dir = \"desc\";\n                            } else {\n                                that.sort.dir = \"asc\";\n                            }\n                        }\n                        that._resetSortClass(element.find(\".sortable-column\"));\n                        col.addClass(\"sort-\"+that.sort.dir);\n                        that.sorting();\n                        that._draw(function(){\n                            that.busy = false;\n                            if (o.muteTable === true) element.removeClass(\"disabled\");\n                        });\n                    });\n                });\n            });\n\n            element.on(Metro.events.click, \".table-service-check input\", function(){\n                var check = $(this);\n                var status = check.is(\":checked\");\n                var val = \"\"+check.val();\n                var store_key = o.checkStoreKey.replace(\"$1\", id);\n                var storage = Metro.storage;\n                var data = storage.getItem(store_key);\n                var is_radio = check.attr('type') === 'radio';\n\n                if (is_radio) {\n                    data = [];\n                }\n\n                if (status) {\n                    if (!Utils.isValue(data)) {\n                        data = [val];\n                    } else {\n                        if (Array(data).indexOf(val) === -1) {\n                            data.push(val);\n                        }\n                    }\n                } else {\n                    if (Utils.isValue(data)) {\n                        Utils.arrayDelete(data, val);\n                    } else {\n                        data = [];\n                    }\n                }\n\n                storage.setItem(store_key, data);\n\n                that._fireEvent(\"check-click\", {\n                    check: this,\n                    status: status,\n                    data: data\n                });\n            });\n\n            element.on(Metro.events.click, \".table-service-check-all input\", function(){\n                var checked = $(this).is(\":checked\");\n                var store_key = o.checkStoreKey.replace(\"$1\", id);\n                var storage = Metro.storage;\n                var data, stored_keys;\n\n                if (o.useCurrentSlice === true) {\n                    stored_keys = storage.getItem(store_key, []);\n\n                    if (checked) {\n                        $.each(that.currentSlice, function(){\n                            if (stored_keys.indexOf(\"\"+this[o.checkColIndex]) === -1) {\n                                stored_keys.push(\"\"+this[o.checkColIndex])\n                            }\n                        });\n                    } else {\n                        $.each(that.currentSlice, function(){\n                            var key = \"\"+this[o.checkColIndex];\n                            if (stored_keys.indexOf(key) !== -1) {\n                                Metro.utils.arrayDelete(stored_keys, key)\n                            }\n                        });\n                    }\n                    data = stored_keys\n                } else {\n                    if (checked) {\n                        $.each(that.filteredItems, function () {\n                            if (data.indexOf(this[o.checkColIndex]) !== -1) return;\n                            data.push(\"\" + this[o.checkColIndex]);\n                        });\n                    } else {\n                        data = [];\n                    }\n                }\n\n                storage.setItem(store_key, data);\n\n                that._draw();\n\n                that._fireEvent(\"check-click-all\", {\n                    check: this,\n                    status: checked,\n                    data: data\n                });\n            });\n\n            var _search = function(){\n                that.searchString = this.value.trim().toLowerCase();\n\n                clearInterval(that.input_interval); that.input_interval = false;\n                if (!that.input_interval) that.input_interval = setTimeout(function(){\n                    that.currentPage = 1;\n                    that._draw();\n                    clearInterval(that.input_interval); that.input_interval = false;\n                }, o.searchThreshold);\n            };\n\n            search.on(Metro.events.inputchange, _search);\n\n            if (Utils.isValue(this.wrapperSearch)) {\n                customSearch = this.wrapperSearch.find(\"input\");\n                if (customSearch.length > 0) {\n                    customSearch.on(Metro.events.inputchange, _search);\n                }\n            }\n\n            function pageLinkClick(l){\n                var link = $(l);\n                var item = link.parent();\n                if (that.filteredItems.length === 0) {\n                    return ;\n                }\n\n                if (item.hasClass(\"active\")) {\n                    return ;\n                }\n\n                if (item.hasClass(\"service\")) {\n                    if (link.data(\"page\") === \"prev\") {\n                        that.currentPage--;\n                        if (that.currentPage === 0) {\n                            that.currentPage = 1;\n                        }\n                    } else {\n                        that.currentPage++;\n                        if (that.currentPage > that.pagesCount) {\n                            that.currentPage = that.pagesCount;\n                        }\n                    }\n                } else {\n                    that.currentPage = link.data(\"page\");\n                }\n\n                that._draw();\n            }\n\n            component.on(Metro.events.click, \".pagination .page-link\", function(){\n                pageLinkClick(this)\n            });\n\n            if (Utils.isValue(this.wrapperPagination)) {\n                this.wrapperPagination.on(Metro.events.click, \".pagination .page-link\", function(){\n                    pageLinkClick(this)\n                });\n            }\n\n            this._createInspectorEvents();\n\n            element.on(Metro.events.click, \".js-table-crud-button\", function(){\n\n            });\n        },\n\n        _createInspectorEvents: function(){\n            var that = this, inspector = this.inspector;\n            // Inspector event\n\n            this._removeInspectorEvents();\n\n            inspector.on(Metro.events.click, \".js-table-inspector-field-up\", function(){\n                var button = $(this), tr = button.closest(\"tr\");\n                var tr_prev = tr.prev(\"tr\");\n                var index = tr.data(\"index\");\n                var index_view;\n                if (tr_prev.length === 0) {\n                    return ;\n                }\n                tr.insertBefore(tr_prev);\n                tr.addClass(\"flash\");\n                setTimeout(function(){\n                    tr.removeClass(\"flash\");\n                }, 1000);\n                index_view = tr.index();\n\n                tr.data(\"index-view\", index_view);\n                that.view[index]['index-view'] = index_view;\n\n                $.each(tr.nextAll(), function(){\n                    var t = $(this);\n                    index_view++;\n                    t.data(\"index-view\", index_view);\n                    that.view[t.data(\"index\")]['index-view'] = index_view;\n                });\n\n                that._createTableHeader();\n                that._draw();\n            });\n\n            inspector.on(Metro.events.click, \".js-table-inspector-field-down\", function(){\n                var button = $(this), tr = button.closest(\"tr\");\n                var tr_next = tr.next(\"tr\");\n                var index = tr.data(\"index\");\n                var index_view;\n                if (tr_next.length === 0) {\n                    return ;\n                }\n                tr.insertAfter(tr_next);\n                tr.addClass(\"flash\");\n                setTimeout(function(){\n                    tr.removeClass(\"flash\");\n                }, 1000);\n                index_view = tr.index();\n\n                tr.data(\"index-view\", index_view);\n                that.view[index]['index-view'] = index_view;\n\n                $.each(tr.prevAll(), function(){\n                    var t = $(this);\n                    index_view--;\n                    t.data(\"index-view\", index_view);\n                    that.view[t.data(\"index\")]['index-view'] = index_view;\n                });\n\n                that._createTableHeader();\n                that._draw();\n            });\n\n            inspector.on(Metro.events.click, \"input[type=checkbox]\", function(){\n                var check = $(this);\n                var status = check.is(\":checked\");\n                var index = check.val();\n                var op = ['cls', 'clsColumn'];\n\n                if (status) {\n                    $.each(op, function(){\n                        var a;\n                        a = Utils.isValue(that.heads[index][this]) ? (that.heads[index][this]).toArray(\" \") : [];\n                        Utils.arrayDelete(a, \"hidden\");\n                        that.heads[index][this] = a.join(\" \");\n                        that.view[index]['show'] = true;\n                    });\n                } else {\n                    $.each(op, function(){\n                        var a;\n\n                        a = Utils.isValue(that.heads[index][this]) ? (that.heads[index][this]).toArray(\" \") : [];\n                        if (a.indexOf(\"hidden\") === -1) {\n                            a.push(\"hidden\");\n                        }\n                        that.heads[index][this] = a.join(\" \");\n                        that.view[index]['show'] = false;\n                    });\n                }\n\n                that._createTableHeader();\n                that._draw();\n            });\n\n            inspector.find(\"input[type=number]\").on(Metro.events.inputchange, function(){\n                var input = $(this);\n                var index = input.attr(\"data-index\");\n                var val = parseInt(input.val());\n\n                that.view[index]['size'] = val === 0 ? \"\" : val;\n\n                that._createTableHeader();\n            });\n\n            inspector.on(Metro.events.click, \".js-table-inspector-save\", function(){\n                that._saveTableView();\n                that.openInspector(false);\n            });\n\n            inspector.on(Metro.events.click, \".js-table-inspector-cancel\", function(){\n                that.openInspector(false);\n            });\n\n            inspector.on(Metro.events.click, \".js-table-inspector-reset\", function(){\n                that.resetView();\n            });\n        },\n\n        _removeInspectorEvents: function(){\n            var inspector = this.inspector;\n            inspector.off(Metro.events.click, \".js-table-inspector-field-up\");\n            inspector.off(Metro.events.click, \".js-table-inspector-field-down\");\n            inspector.off(Metro.events.click, \"input[type=checkbox]\");\n            inspector.off(Metro.events.click, \".js-table-inspector-save\");\n            inspector.off(Metro.events.click, \".js-table-inspector-cancel\");\n            inspector.off(Metro.events.click, \".js-table-inspector-reset\");\n            inspector.find(\"input[type=number]\").off(Metro.events.inputchange);\n        },\n\n        _saveTableView: function(){\n            var that = this, element = this.element, o = this.options;\n            var view = this.view;\n            var id = element.attr(\"id\");\n            var viewPath = o.viewSavePath.replace(\"$1\", id);\n            var storage = Metro.storage;\n\n            if (o.viewSaveMode.toLowerCase() === \"client\") {\n                storage.setItem(viewPath, view);\n\n                this._fireEvent(\"view-save\", {\n                    target: \"client\",\n                    path: o.viewSavePath,\n                    view: view\n                });\n            } else {\n                var post_data = {\n                    id : element.attr(\"id\"),\n                    view : view\n                };\n\n                fetch(viewPath, {\n                    method: \"POST\"\n                    , body: JSON.stringify(post_data)\n                    , header: {\n                        \"Content-type\": \"application/json;charset=utf-8\"\n                    }\n                })\n                    .then(Metro.fetch.status)\n                    .then(Metro.fetch.text)\n                    .then(function(data){\n                        that._fireEvent(\"view-save\", {\n                            target: \"server\",\n                            path: o.viewSavePath,\n                            view: view,\n                            post_data: post_data,\n                            response: data\n                        });\n                    })\n                    .catch(function(error){\n                        that._fireEvent(\"data-save-error\", {\n                            source: o.viewSavePath,\n                            error: error,\n                            post_data: post_data\n                        });\n                    });\n            }\n        },\n\n        _info: function(start, stop, length){\n            var element = this.element, o = this.options;\n            var component = element.closest(\".table-component\");\n            var info = Utils.isValue(this.wrapperInfo) ? this.wrapperInfo : component.find(\".table-info\");\n            var text;\n\n            if (info.length === 0) {\n                return ;\n            }\n\n            if (stop > length) {\n                stop = length;\n            }\n\n            if (this.items.length === 0) {\n                start = stop = length = 0;\n            }\n\n            text = o.tableInfoTitle || this.locale.table[\"info\"];\n            text = text.replace(\"$1\", start);\n            text = text.replace(\"$2\", stop);\n            text = text.replace(\"$3\", length);\n            info.html(text);\n        },\n\n        _paging: function(length){\n            var element = this.element, o = this.options;\n            var component = element.closest(\".table-component\");\n            this.pagesCount = Math.ceil(length / o.rows); // Костыль\n            Metro.pagination({\n                length: length,\n                rows: o.rows,\n                current: this.currentPage,\n                target: Utils.isValue(this.wrapperPagination) ? this.wrapperPagination : component.find(\".table-pagination\"),\n                claPagination: o.clsPagination,\n                prevTitle: o.paginationPrevTitle || this.locale.table[\"prev\"],\n                nextTitle: o.paginationNextTitle || this.locale.table[\"next\"],\n                distance: o.paginationShortMode === true ? o.paginationDistance : 0\n            });\n        },\n\n        _filter: function(){\n            var that = this, o = this.options;\n            var items;\n            if ((Utils.isValue(this.searchString) && that.searchString.length >= o.searchMinLength) || this.filters.length > 0) {\n                items = this.items.filter(function(row){\n\n                    var row_data = \"\", result, search_result, i, j = 0;\n\n                    if (that.filters.length > 0) {\n\n                        result = o.filtersOperator.toLowerCase() === \"and\";\n                        for (i = 0; i < that.filters.length; i++) {\n                            if (Utils.isNull(that.filters[i])) continue;\n                            j++;\n                            result = o.filtersOperator.toLowerCase() === \"and\" ?\n                                result && Utils.exec(that.filters[i], [row, that.heads]) :\n                                result || Utils.exec(that.filters[i], [row, that.heads])\n                            ;\n                        }\n\n                        if (j === 0) result = true;\n                    } else {\n                        result = true;\n                    }\n\n                    if (that.searchFields.length > 0) {\n                        $.each(that.heads, function(i, v){\n                            if (that.searchFields.indexOf(v.name) > -1) {\n                                row_data += \"•\"+row[i];\n                            }\n                        })\n                    } else {\n                        row_data = row.join(\"•\");\n                    }\n\n                    row_data = row_data.replace(/[\\n\\r]+|[\\s]{2,}/g, ' ').trim().toLowerCase();\n                    search_result = Utils.isValue(that.searchString) && that.searchString.length >= o.searchMinLength ? ~row_data.indexOf(that.searchString) : true;\n\n                    result = result && search_result;\n\n                    if (result) {\n                        that._fireEvent(\"filter-row-accepted\", {\n                            row: row\n                        });\n                    } else {\n                        that._fireEvent(\"filter-row-declined\", {\n                            row: row\n                        });\n                    }\n\n                    return result;\n                });\n\n            } else {\n                items = this.items;\n            }\n\n            this._fireEvent(\"search\", {\n                search: that.searchString,\n                items: items\n            });\n\n            this.filteredItems = items;\n\n            return items;\n        },\n\n        _draw: function(cb){\n            var that = this, element = this.element, o = this.options;\n            var body = element.find(\"tbody\");\n            var i, j, tr, td, check, cells, tds, is_even_row;\n            var start = parseInt(o.rows) === -1 ? 0 : o.rows * (this.currentPage - 1),\n                stop = parseInt(o.rows) === -1 ? this.items.length - 1 : start + o.rows - 1;\n            var items, checkedItems = [];\n            var stored_keys = Metro.storage.getItem(o.checkStoreKey.replace(\"$1\", element.attr('id')));\n\n            var view = o.staticView ? this.viewDefault : this.view;\n\n            body.html(\"\");\n\n            if (!this.heads.length) {\n                console.warn(\"Heads is not defined for table ID \" + element.attr(\"id\"));\n                return ;\n            }\n\n            items = this._filter();\n\n            this.currentSlice = items.slice(start, stop + 1);\n            checkedItems = [];\n\n            if (items.length > 0) {\n                for (i = start; i <= stop; i++) {\n                    cells = items[i];\n                    tds = [];\n                    if (!Utils.isValue(cells)) {continue;}\n                    tr = $(\"<tr>\").addClass(o.clsBodyRow);\n                    tr.data('original', cells);\n\n                    // Rownum\n\n                    is_even_row = i % 2 === 0;\n\n                    td = $(\"<td>\").html(i + 1);\n                    if (that.service[0].clsColumn !== undefined) {\n                        td.addClass(that.service[0].clsColumn);\n                    }\n                    td.appendTo(tr);\n\n                    // Checkbox\n                    td = $(\"<td>\");\n                    if (o.checkType === \"checkbox\") {\n                        check = $(\"<input type='checkbox' data-style='\"+o.checkStyle+\"' data-role='checkbox' name='\" + (Utils.isValue(o.checkName) ? o.checkName : 'table_row_check') + \"[]' value='\" + items[i][o.checkColIndex] + \"'>\");\n                    } else {\n                        check = $(\"<input type='radio' data-style='\"+o.checkStyle+\"' data-role='radio' name='\" + (Utils.isValue(o.checkName) ? o.checkName : 'table_row_check') + \"' value='\" + items[i][o.checkColIndex] + \"'>\");\n                    }\n\n                    if (Utils.isValue(stored_keys) && Array.isArray(stored_keys) && stored_keys.indexOf(\"\"+items[i][o.checkColIndex]) > -1) {\n                        check.prop(\"checked\", true);\n                        checkedItems.push(cells)\n                    }\n\n                    check.addClass(\"table-service-check\");\n\n                    this._fireEvent(\"check-draw\", {\n                        check: check\n                    });\n\n                    check.appendTo(td);\n                    if (that.service[1].clsColumn !== undefined) {\n                        td.addClass(that.service[1].clsColumn);\n                    }\n                    td.appendTo(tr);\n                    // End of check\n\n                    for (j = 0; j < cells.length; j++){\n                        tds[j] = null;\n                    }\n\n                    $.each(cells, function(cell_index){\n                        var val = this;\n                        var td = $(\"<td>\");\n\n                        if (Utils.isValue(that.heads[cell_index].template)) {\n                            val = that.heads[cell_index].template.replace(/%VAL%/g, val);\n                        }\n\n                        td.html(val);\n\n                        td.addClass(o.clsBodyCell);\n                        if (Utils.isValue(that.heads[cell_index].clsColumn)) {\n                            td.addClass(that.heads[cell_index].clsColumn);\n                        }\n\n                        if (Utils.bool(view[cell_index].show) === false) {\n                            td.addClass(\"hidden\");\n                        }\n\n                        if (Utils.bool(view[cell_index].show)) {\n                            td.removeClass(\"hidden\");\n                        }\n\n                        td.data('original',this);\n\n                        tds[view[cell_index]['index-view']] = td;\n\n                        that._fireEvent(\"draw-cell\", {\n                            td: td,\n                            val: val,\n                            cellIndex: cell_index,\n                            head: that.heads[cell_index],\n                            items: cells\n                        });\n\n                        if (o.cellWrapper === true) {\n                            val = $(\"<div>\").addClass(\"data-wrapper\").addClass(o.clsCellWrapper).html(td.html());\n                            td.html('').append(val);\n                        }\n                    });\n\n                    for (j = 0; j < cells.length; j++){\n                        tds[j].appendTo(tr);\n\n                        that._fireEvent(\"append-cell\", {\n                            td: tds[j],\n                            tr: tr,\n                            index: j\n                        });\n                    }\n\n                    that._fireEvent(\"draw-row\", {\n                        tr: tr,\n                        view: that.view,\n                        heads: that.heads,\n                        items: cells\n                    });\n\n                    tr.addClass(o.clsRow).addClass(is_even_row ? o.clsEvenRow : o.clsOddRow).appendTo(body);\n\n                    that._fireEvent(\"append-row\", {\n                        tr: tr\n                    });\n                }\n\n                $(this.component).find(\".table-service-check-all input\").prop(\"checked\", checkedItems.length);\n            } else {\n                j = 0;\n                $.each(view, function(){\n                    if (this.show) j++;\n                });\n                if (o.check === true) {\n                    j++;\n                }\n                if (o.rownum === true) {\n                    j++;\n                }\n                tr = $(\"<tr>\").addClass(o.clsBodyRow).appendTo(body);\n                td = $(\"<td>\").attr(\"colspan\", j).addClass(\"text-center\").html($(\"<span>\").addClass(o.clsEmptyTableTitle).html(o.emptyTableTitle || that.locale.table[\"empty\"]));\n                td.appendTo(tr);\n            }\n\n            this._info(start + 1, stop + 1, items.length);\n            this._paging(items.length);\n\n            if (this.activity) this.activity.hide();\n\n            this._fireEvent(\"draw\");\n\n            if (cb !== undefined) {\n                Utils.exec(cb, null, element[0])\n            }\n        },\n\n        _getItemContent: function(row){\n            var o = this.options;\n            var result, col = row[this.sort.colIndex];\n            var format = this.heads[this.sort.colIndex].format;\n            var formatMask = !Utils.isNull(this.heads) && !Utils.isNull(this.heads[this.sort.colIndex]) && Utils.isValue(this.heads[this.sort.colIndex]['formatMask']) ? this.heads[this.sort.colIndex]['formatMask'] : \"%Y-%m-%d\";\n            var thousandSeparator = this.heads && this.heads[this.sort.colIndex] && this.heads[this.sort.colIndex][\"thousandSeparator\"] ? this.heads[this.sort.colIndex][\"thousandSeparator\"] : o.thousandSeparator;\n            var decimalSeparator  = this.heads && this.heads[this.sort.colIndex] && this.heads[this.sort.colIndex][\"decimalSeparator\"] ? this.heads[this.sort.colIndex][\"decimalSeparator\"] : o.decimalSeparator;\n\n            result = (\"\"+col).toLowerCase().replace(/[\\n\\r]+|[\\s]{2,}/g, ' ').trim();\n\n            if (Utils.isValue(result) && Utils.isValue(format)) {\n\n                if (['number', 'int', 'float', 'money'].indexOf(format) !== -1) {\n                    result = Utils.parseNumber(result, thousandSeparator, decimalSeparator);\n                }\n\n                switch (format) {\n                    case \"date\": result = formatMask ? Datetime.from(result, formatMask, o.locale) : datetime(result); break;\n                    case \"number\": result = +result; break;\n                    case \"int\": result = parseInt(result); break;\n                    case \"float\": result = parseFloat(result); break;\n                    case \"money\": result = Utils.parseMoney(result); break;\n                    case \"card\": result = Utils.parseCard(result); break;\n                    case \"phone\": result = Utils.parsePhone(result); break;\n                }\n            }\n\n            return result;\n        },\n\n        addItem: function(item, redraw){\n            if (!Array.isArray(item)) {\n                console.warn(\"Item is not an array and can't be added\");\n                return this;\n            }\n            this.items.push(item);\n            if (redraw !== false) this.draw();\n        },\n\n        addItems: function(items, redraw){\n            if (!Array.isArray(items)) {\n                console.warn(\"Items is not an array and can't be added\");\n                return this;\n            }\n            items.forEach(function(item){\n                if (Array.isArray(item))\n                    this.items.push(item, false);\n            });\n            this.draw();\n            if (redraw !== false) this.draw();\n        },\n\n        updateItem: function(key, field, value){\n            var item = this.items[this.index[key]];\n            var fieldIndex = null;\n            if (Utils.isNull(item)) {\n                console.warn('Item is undefined for update');\n                return this;\n            }\n            if (isNaN(field)) {\n                this.heads.forEach(function(v, i){\n                    if (v['name'] === field) {\n                        fieldIndex = i;\n                    }\n                });\n            }\n            if (Utils.isNull(fieldIndex)) {\n                console.warn('Item is undefined for update. Field ' + field + ' not found in data structure');\n                return this;\n            }\n\n            item[fieldIndex] = value;\n            this.items[this.index[key]] = item;\n            return this;\n        },\n\n        getItem: function(key){\n            return this.items[this.index[key]];\n        },\n\n        deleteItem: function(fieldIndex, value){\n            var i, deleteIndexes = [];\n            var is_func = Utils.isFunc(value);\n            for(i = 0; i < this.items.length; i++) {\n                if (is_func) {\n                    if (Utils.exec(value, [this.items[i][fieldIndex]])) {\n                        deleteIndexes.push(i);\n                    }\n                } else {\n                    if (this.items[i][fieldIndex] === value) {\n                        deleteIndexes.push(i);\n                    }\n                }\n            }\n\n            this.items = Utils.arrayDeleteByMultipleKeys(this.items, deleteIndexes);\n\n            return this;\n        },\n\n        deleteItemByName: function(fieldName, value){\n            var i, fieldIndex, deleteIndexes = [];\n            var is_func = Utils.isFunc(value);\n\n            for(i = 0; i < this.heads.length; i++) {\n                if (this.heads[i]['name'] === fieldName) {\n                    fieldIndex = i;\n                    break;\n                }\n            }\n\n            for(i = 0; i < this.items.length; i++) {\n                if (is_func) {\n                    if (Utils.exec(value, [this.items[i][fieldIndex]])) {\n                        deleteIndexes.push(i);\n                    }\n                } else {\n                    if (this.items[i][fieldIndex] === value) {\n                        deleteIndexes.push(i);\n                    }\n                }\n            }\n\n            this.items = Utils.arrayDeleteByMultipleKeys(this.items, deleteIndexes);\n\n            return this;\n        },\n\n        draw: function(){\n            this._draw();\n            return this;\n        },\n\n        sorting: function(dir){\n            var that = this;\n\n            if (Utils.isValue(dir)) {\n                this.sort.dir = dir;\n            }\n\n            this._fireEvent(\"sort-start\", {\n                items: this.items\n            });\n\n            this.items.sort(function(a, b){\n                var c1 = that._getItemContent(a);\n                var c2 = that._getItemContent(b);\n                var result = 0;\n\n                if (c1 < c2) {\n                    result = that.sort.dir === \"asc\" ? -1 : 1;\n                }\n                if (c1 > c2) {\n                    result = that.sort.dir === \"asc\" ? 1 : -1;\n                }\n\n                if (result !== 0) {\n\n                    that._fireEvent(\"sort-item-switch\", {\n                        a: a,\n                        b: b,\n                        result: result\n                    });\n                }\n\n                return result;\n            });\n\n            this._fireEvent(\"sort-stop\", {\n                items: this.items\n            });\n\n            return this;\n        },\n\n        search: function(val){\n            this.searchString = val.trim().toLowerCase();\n            this.currentPage = 1;\n            this._draw();\n            return this;\n        },\n\n        _rebuild: function(review){\n            var that = this, element = this.element;\n            var need_sort = false, sortable_columns;\n\n            this._createIndex();\n\n            if (review === true) {\n                this.view = this._createView();\n            }\n\n            this._createTableHeader();\n            this._createTableBody();\n            this._createTableFooter();\n\n            if (this.heads.length > 0) $.each(this.heads, function(i){\n                var item = this;\n                if (!need_sort && [\"asc\", \"desc\"].indexOf(item.sortDir) > -1) {\n                    need_sort = true;\n                    that.sort.colIndex = i;\n                    that.sort.dir = item.sortDir;\n                }\n            });\n\n            if (need_sort) {\n                sortable_columns = element.find(\".sortable-column\");\n                this._resetSortClass(sortable_columns);\n                $(sortable_columns.get(that.sort.colIndex)).addClass(\"sort-\"+that.sort.dir);\n                this.sorting();\n            }\n\n            that.currentPage = 1;\n\n            that._draw();\n        },\n\n        setHeads: function(data){\n            this.heads = data;\n            return this;\n        },\n\n        setHeadItem: function(name, data){\n            var i, index;\n            for(i = 0; i < this.heads.length; i++) {\n                if (this.heads[i].name === name) {\n                    index = i;\n                    break;\n                }\n            }\n            this.heads[index] = data;\n            return this;\n        },\n\n        setItems: function(data){\n            this.items = data;\n            return this;\n        },\n\n        setData: function(/*obj*/ data){\n            var o = this.options;\n\n            this.items = [];\n            this.heads = [];\n            this.foots = [];\n\n            if (Array.isArray(o.head)) {\n                this.heads = o.head;\n            }\n\n            if (Array.isArray(o.body)) {\n                this.items = o.body;\n            }\n\n            this._createItemsFromJSON(data);\n\n            this._rebuild(true);\n\n            return this;\n        },\n\n        loadData: function(source, review){\n            var that = this, element = this.element, o = this.options;\n\n            if (!Utils.isValue(review)) {\n                review = true;\n            }\n\n            element.html(\"\");\n\n            if (!Utils.isValue(source)) {\n\n                this._rebuild(review);\n\n            } else {\n                o.source = source;\n\n                this._fireEvent(\"data-load\", {\n                    source: o.source\n                });\n\n                that.activity.show(function(){\n                    fetch(o.source)\n                        .then(Metro.fetch.status)\n                        .then(Metro.fetch.json)\n                        .then(function(data){\n                            that.activity.hide();\n                            that.items = [];\n                            that.heads = [];\n                            that.foots = [];\n\n                            that._fireEvent(\"data-loaded\", {\n                                source: o.source,\n                                data: data\n                            });\n\n                            if (Array.isArray(o.head)) {\n                                that.heads = o.head;\n                            }\n\n                            if (Array.isArray(o.body)) {\n                                that.items = o.body;\n                            }\n\n                            that._createItemsFromJSON(data);\n                            that._rebuild(review);\n                            that._resetInspector();\n\n                            that._fireEvent(\"data-load-end\", {\n                                source: o.source,\n                                data: data\n                            });\n                        })\n                        .catch(function(error){\n                            that.activity.hide();\n                            that._fireEvent(\"data-load-error\", {\n                                source: o.source,\n                                error: error\n                            });\n                        })\n                });\n\n            }\n        },\n\n        reload: function(review){\n            this.loadData(this.options.source, review);\n        },\n\n        clear: function(){\n            this.items = [];\n            return this.draw();\n        },\n\n        next: function(){\n            if (this.items.length === 0) return ;\n            this.currentPage++;\n            if (this.currentPage > this.pagesCount) {\n                this.currentPage = this.pagesCount;\n                return ;\n            }\n            this._draw();\n            return this;\n        },\n\n        prev: function(){\n            if (this.items.length === 0) return ;\n            this.currentPage--;\n            if (this.currentPage === 0) {\n                this.currentPage = 1;\n                return ;\n            }\n            this._draw();\n            return this;\n        },\n\n        first: function(){\n            if (this.items.length === 0) return ;\n            this.currentPage = 1;\n            this._draw();\n            return this;\n        },\n\n        last: function(){\n            if (this.items.length === 0) return ;\n            this.currentPage = this.pagesCount;\n            this._draw();\n            return this;\n        },\n\n        page: function(num){\n            if (num <= 0) {\n                num = 1;\n            }\n\n            if (num > this.pagesCount) {\n                num = this.pagesCount;\n            }\n\n            this.currentPage = num;\n            this._draw();\n            return this;\n        },\n\n        addFilter: function(f, redraw){\n            var filterIndex = null, i, func = Utils.isFunc(f);\n            if (func === false) {\n                return ;\n            }\n\n            for(i = 0; i < this.filters.length; i++) {\n                if (Utils.isNull(this.filters[i])) {\n                    filterIndex = i;\n                    this.filters[i] = func;\n                    break;\n                }\n            }\n\n            if (Utils.isNull(filterIndex)) {\n                this.filters.push(func);\n                filterIndex = this.filters.length - 1;\n            }\n\n            if (redraw === true) {\n                this.currentPage = 1;\n                this.draw();\n            }\n\n            return filterIndex\n        },\n\n        removeFilter: function(key, redraw){\n            this.filters[key] = null;\n            if (redraw === true) {\n                this.currentPage = 1;\n                this.draw();\n            }\n            return this;\n        },\n\n        removeFilters: function(redraw){\n            this.filters = [];\n            if (redraw === true) {\n                this.currentPage = 1;\n                this.draw();\n            }\n            return this;\n        },\n\n        getItems: function(){\n            return this.items;\n        },\n\n        getHeads: function(){\n            return this.heads;\n        },\n\n        getView: function(){\n            return this.view;\n        },\n\n        getFilteredItems: function(){\n            return this.filteredItems.length > 0 ? this.filteredItems : this.items;\n        },\n\n        getSelectedItems: function(){\n            var element = this.element, o = this.options;\n            var stored_keys = Metro.storage.getItem(o.checkStoreKey.replace(\"$1\", element.attr(\"id\")));\n            var selected = [];\n\n            if (!Utils.isValue(stored_keys)) {\n                return [];\n            }\n\n            $.each(this.items, function(){\n                if (stored_keys.indexOf(\"\"+this[o.checkColIndex]) !== -1) {\n                    selected.push(this);\n                }\n            });\n            return selected;\n        },\n\n        getStoredKeys: function(){\n            var element = this.element, o = this.options;\n            return Metro.storage.getItem(o.checkStoreKey.replace(\"$1\", element.attr(\"id\")), []);\n        },\n\n        clearSelected: function(redraw){\n            var element = this.element, o = this.options;\n            Metro.storage.setItem(o.checkStoreKey.replace(\"$1\", element.attr(\"id\")), []);\n            element.find(\"table-service-check-all input\").prop(\"checked\", false);\n            if (redraw === true) this._draw();\n        },\n\n        getFilters: function(){\n            return this.filters;\n        },\n\n        getFiltersIndexes: function(){\n            return this.filtersIndexes;\n        },\n\n        openInspector: function(mode){\n            var ins = this.inspector;\n            if (mode) {\n                ins.show(0, function(){\n                    ins.css({\n                        top: ($(window).height()  - ins.outerHeight(true)) / 2 + pageYOffset,\n                        left: ($(window).width() - ins.outerWidth(true)) / 2 + pageXOffset\n                    }).data(\"open\", true);\n                });\n            } else {\n                ins.hide().data(\"open\", false);\n            }\n        },\n\n        closeInspector: function(){\n            this.openInspector(false);\n        },\n\n        toggleInspector: function(){\n            this.openInspector(!this.inspector.data(\"open\"));\n        },\n\n        resetView: function(){\n\n            this.view = this._createView();\n\n            this._createTableHeader();\n            this._createTableFooter();\n            this._draw();\n\n            this._resetInspector();\n            this._saveTableView();\n        },\n\n        rebuildIndex: function(){\n            this._createIndex();\n        },\n\n        getIndex: function(){\n            return this.index;\n        },\n\n        export: function(to, mode, filename, options){\n            var Export = Metro.export;\n            var that = this, o = this.options;\n            var table = document.createElement(\"table\");\n            var head = $(\"<thead>\").appendTo(table);\n            var body = $(\"<tbody>\").appendTo(table);\n            var i, j, cells, tds = [], items, tr, td;\n            var start, stop;\n\n            if (typeof Export.tableToCSV !== 'function') {\n                return ;\n            }\n\n            mode = Utils.isValue(mode) ? mode.toLowerCase() : \"all-filtered\";\n            filename = Utils.isValue(filename) ? filename : Utils.elementId(\"table\")+\"-export.csv\";\n\n            // Create table header\n            tr = $(\"<tr>\");\n            cells = this.heads;\n\n            for (j = 0; j < cells.length; j++){\n                tds[j] = null;\n            }\n\n            $.each(cells, function(cell_index){\n                var item = this;\n                if (Utils.bool(that.view[cell_index]['show']) === false) {\n                    return ;\n                }\n                td = $(\"<th>\");\n                if (Utils.isValue(item.title)) {\n                    td.html(item.title);\n                }\n                tds[that.view[cell_index]['index-view']] = td;\n            });\n\n            for (j = 0; j < cells.length; j++){\n                if (Utils.isValue(tds[j])) tds[j].appendTo(tr);\n            }\n            tr.appendTo(head);\n\n            // Create table data\n            if (mode === \"checked\") {\n                items = this.getSelectedItems();\n                start = 0; stop = items.length - 1;\n            } else if (mode === \"view\") {\n                items = this._filter();\n                start = parseInt(o.rows) === -1 ? 0 : o.rows * (this.currentPage - 1);\n                stop = parseInt(o.rows) === -1 ? items.length - 1 : start + o.rows - 1;\n            } else if (mode === \"all\") {\n                items = this.items;\n                start = 0; stop = items.length - 1;\n            } else {\n                items = this._filter();\n                start = 0; stop = items.length - 1;\n            }\n\n            for (i = start; i <= stop; i++) {\n                if (Utils.isValue(items[i])) {\n                    tr = $(\"<tr>\");\n\n                    cells = items[i];\n\n                    for (j = 0; j < cells.length; j++){\n                        tds[j] = null;\n                    }\n\n                    $.each(cells, function(cell_index){\n                        if (Utils.bool(that.view[cell_index].show) === false) {\n                            return ;\n                        }\n                        td = $(\"<td>\").html(this);\n                        tds[that.view[cell_index]['index-view']] = td;\n                    });\n\n                    for (j = 0; j < cells.length; j++){\n                        if (Utils.isValue(tds[j])) tds[j].appendTo(tr);\n                    }\n\n                    tr.appendTo(body);\n                }\n            }\n\n            // switch (to) {\n            //     default: Export.tableToCSV(table, filename, options);\n            // }\n            Export.tableToCSV(table, filename, options);\n            table.remove();\n        },\n\n        changeAttribute: function(attributeName){\n            var that = this, element = this.element, o = this.options;\n\n            function dataCheck(){\n                o.check = Utils.bool(element.attr(\"data-check\"));\n                that._service();\n                that._createTableHeader();\n                that._draw();\n            }\n\n            function dataRownum(){\n                o.rownum = Utils.bool(element.attr(\"data-rownum\"));\n                that._service();\n                that._createTableHeader();\n                that._draw();\n            }\n\n            switch (attributeName) {\n                case \"data-check\": dataCheck(); break;\n                case \"data-rownum\": dataRownum(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n            var component = element.closest(\".table-component\");\n            var search_input = component.find(\"input\");\n            var rows_select = component.find(\"select\");\n\n            search_input.data(\"input\").destroy();\n            rows_select.data(\"select\").destroy();\n\n            $(window).off(Metro.events.resize, {ns: this.id});\n\n            element.off(Metro.events.click, \".sortable-column\");\n\n            element.off(Metro.events.click, \".table-service-check input\");\n\n            element.off(Metro.events.click, \".table-service-check-all input\");\n\n            search_input.off(Metro.events.inputchange);\n\n            if (Utils.isValue(this.wrapperSearch)) {\n                var customSearch = this.wrapperSearch.find(\"input\");\n                if (customSearch.length > 0) {\n                    customSearch.off(Metro.events.inputchange);\n                }\n            }\n\n            component.off(Metro.events.click, \".pagination .page-link\");\n            if (Utils.isValue(this.wrapperPagination)) {\n                this.wrapperPagination.off(Metro.events.click, \".pagination .page-link\");\n            }\n            element.off(Metro.events.click, \".js-table-crud-button\");\n\n            this._removeInspectorEvents();\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var MaterialTabsDefaultConfig = {\n        wheelStep: 20,\n        materialtabsDeferred: 0,\n        deep: false,\n        fixedTabs: false,\n        duration: 300,\n        appBar: false,\n\n        clsComponent: \"\",\n        clsTabs: \"\",\n        clsTab: \"\",\n        clsTabActive: \"\",\n        clsMarker: \"\",\n\n        onBeforeTabOpen: Metro.noop_true,\n        onTabOpen: Metro.noop,\n        onTabsScroll: Metro.noop,\n        onTabsCreate: Metro.noop\n    };\n\n    Metro.materialTabsSetup = function (options) {\n        MaterialTabsDefaultConfig = $.extend({}, MaterialTabsDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroMaterialTabsSetup\"] !== undefined) {\n        Metro.materialTabsSetup(window[\"metroMaterialTabsSetup\"]);\n    }\n\n    Metro.Component('material-tabs', {\n        init: function( options, elem ) {\n            this._super(elem, options, MaterialTabsDefaultConfig, {\n                marker: null,\n                scroll: 0,\n                scrollDir: \"left\"\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"tabs-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var tabs = element.find(\"li\"), active_tab = element.find(\"li.active\");\n            var wrapper = $(\"<div>\").addClass(\"tabs-material-wrapper\").addClass(o.clsComponent).insertBefore(element);\n\n            if (o.appBar === true) {\n                wrapper.addClass(\"app-bar-present\");\n            }\n            if (o.appBar === \"more\") {\n                wrapper.addClass(\"app-bar-present-more\");\n            }\n\n            element.appendTo(wrapper);\n            element.addClass(\"tabs-material\").addClass(o.clsTabs);\n            tabs.addClass(o.clsTab);\n\n            if (o.deep === true) {\n                element.addClass(\"deep\");\n            }\n\n            if (o.fixedTabs === true) {\n                element.addClass(\"fixed-tabs\");\n            }\n\n            this.marker = element.find(\".tab-marker\");\n\n            if (this.marker.length === 0) {\n                this.marker = $(\"<span>\").addClass(\"tab-marker\").addClass(o.clsMarker).appendTo(element);\n            }\n\n            this.openTab(active_tab.length === 0 ? tabs[0] : active_tab[0]);\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n\n            element.on(Metro.events.click, \"li\", function(e){\n                var tab = $(this);\n                var active_tab = element.find(\"li.active\");\n                var tab_next = tab.index() > active_tab.index();\n                var target = tab.children(\"a\").attr(\"href\");\n\n                e.preventDefault();\n\n                if (Utils.isValue(target) && target[0] === \"#\") {\n                    if (tab.hasClass(\"active\")) return;\n                    if (tab.hasClass(\"disabled\")) return;\n                    if (Utils.exec(o.onBeforeTabOpen, [tab, target, tab_next], this) === false) return;\n                    that.openTab(tab, tab_next);\n                }\n            });\n\n            element.on(Metro.events.scroll, function(){\n                var oldScroll = that.scroll;\n\n                that.scrollDir = that.scroll < element[0].scrollLeft ? \"left\" : \"right\";\n                that.scroll = element[0].scrollLeft;\n\n                that._fireEvent(\"tabs-scroll\", {\n                    scrollLeft: element[0].scrollLeft,\n                    oldScroll: oldScroll,\n                    scrollDir: that.scrollDir\n                });\n\n            });\n\n            element.on(Metro.events.mousewheel, function(e){\n                if (e.deltaY === undefined) {\n                    return ;\n                }\n\n                var scroll, scrollable = $(this);\n                var dir = e.deltaY > 0 ? -1 : 1;\n                var step = o.wheelStep;\n\n\n                scroll = scrollable.scrollLeft() - ( dir * step);\n                scrollable.scrollLeft(scroll);\n            })\n        },\n\n        openTab: function(tab, tab_next){\n            var element = this.element, o = this.options;\n            var tabs = element.find(\"li\");\n            var magic = 52, shift, width, tab_width, target, tab_left, scroll, scrollLeft;\n\n            tab = $(tab);\n\n            $.each(tabs, function(){\n                var target = $(this).find(\"a\").attr(\"href\");\n                if (!Utils.isValue(target)) return;\n                if (target[0] === \"#\" && target.length > 1) {\n                    $(target).hide();\n                }\n            });\n\n            width = element.width();\n            scroll = element.scrollLeft();\n            tab_left = tab.position().left;\n            tab_width = tab.width();\n            shift = tab_left + tab_width;\n\n            tabs.removeClass(\"active\").removeClass(o.clsTabActive);\n            tab.addClass(\"active\").addClass(o.clsTabActive);\n\n            if (shift + magic > width + scroll) {\n                scrollLeft = scroll + (magic * 2);\n            } else if (tab_left < scroll) {\n                scrollLeft = tab_left - magic * 2;\n            } else {\n                scrollLeft = scroll;\n            }\n\n            element.animate({\n                draw: {\n                    scrollLeft: scrollLeft\n                },\n                dur: o.duration\n            });\n\n            this.marker.animate({\n                draw: {\n                    left: tab_left,\n                    width: tab_width\n                },\n                dur: o.duration\n            });\n\n            target = tab.find(\"a\").attr(\"href\");\n            if (Utils.isValue(target)) {\n                if (target[0] === \"#\" && target.length > 1) {\n                    $(target).show();\n                }\n            }\n\n            this._fireEvent(\"tab-open\", {\n                tab: tab[0],\n                target: target,\n                tab_next: tab_next\n            });\n        },\n\n        open: function(tab_num){\n            var element = this.element;\n            var tabs = element.find(\"li\");\n            var active_tab = element.find(\"li.active\");\n            var tab = tabs.eq(tab_num - 1);\n            var tab_next = tabs.index(tab) > tabs.index(active_tab);\n            this.openTab(tab, tab_next);\n        },\n\n        changeAttribute: function(){\n        },\n\n        destroy: function(){\n            var element = this.element;\n\n            element.off(Metro.events.click, \"li\");\n            element.off(Metro.events.scroll);\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var Utils = Metro.utils;\n    var TabsDefaultConfig = {\n        tabsDeferred: 0,\n        expand: false,\n        expandPoint: null,\n        tabsPosition: \"top\",\n        tabsType: \"default\",\n\n        clsTabs: \"\",\n        clsTabsList: \"\",\n        clsTabsListItem: \"\",\n        clsTabsListItemActive: \"\",\n\n        onTab: Metro.noop,\n        onBeforeTab: Metro.noop_true,\n        onTabsCreate: Metro.noop\n    };\n\n    Metro.tabsSetup = function (options) {\n        TabsDefaultConfig = $.extend({}, TabsDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroTabsSetup\"] !== undefined) {\n        Metro.tabsSetup(window[\"metroTabsSetup\"]);\n    }\n\n    Metro.Component('tabs', {\n        init: function( options, elem ) {\n            this._super(elem, options, TabsDefaultConfig, {\n                _targets: [],\n                id: Utils.elementId('tabs')\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n            var tab = element.find(\".active\").length > 0 ? $(element.find(\".active\")[0]) : undefined;\n\n            this._createStructure();\n            this._createEvents();\n            this._open(tab);\n\n            this._fireEvent(\"tabs-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var parent = element.parent();\n            var right_parent = parent.hasClass(\"tabs\");\n            var container = right_parent ? parent : $(\"<div>\").addClass(\"tabs tabs-wrapper\");\n            var expandTitle, hamburger;\n\n            container.addClass(o.tabsPosition.replace([\"-\", \"_\", \"+\"], \" \"));\n\n            element.addClass(\"tabs-list\");\n            if (o.tabsType !== \"default\") {\n                element.addClass(\"tabs-\"+o.tabsType);\n            }\n            if (!right_parent) {\n                container.insertBefore(element);\n                element.appendTo(container);\n            }\n\n            element.data('expanded', false);\n\n            expandTitle = $(\"<div>\").addClass(\"expand-title\"); container.prepend(expandTitle);\n            hamburger = container.find(\".hamburger\");\n            if (hamburger.length === 0) {\n                hamburger = $(\"<button>\").attr(\"type\", \"button\").addClass(\"hamburger menu-down\").appendTo(container);\n                for(var i = 0; i < 3; i++) {\n                    $(\"<span>\").addClass(\"line\").appendTo(hamburger);\n                }\n\n                if (Metro.colors.isLight(Utils.getStyleOne(container, \"background-color\")) === true) {\n                    hamburger.addClass(\"dark\");\n                }\n            }\n\n            container.addClass(o.clsTabs);\n            element.addClass(o.clsTabsList);\n            element.children(\"li\").addClass(o.clsTabsListItem);\n\n            if (o.expand === true && !o.tabsPosition.includes(\"vertical\")) {\n                container.addClass(\"tabs-expand\");\n            } else {\n                if (Utils.isValue(o.expandPoint) && Utils.mediaExist(o.expandPoint) && !o.tabsPosition.includes(\"vertical\")) {\n                    container.addClass(\"tabs-expand\");\n                }\n            }\n\n            if (o.tabsPosition.includes(\"vertical\")) {\n                container.addClass(\"tabs-expand\");\n            }\n\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var container = element.parent();\n\n            $(window).on(Metro.events.resize, function(){\n\n                if (o.tabsPosition.includes(\"vertical\")) {\n                    return ;\n                }\n\n                if (o.expand === true && !o.tabsPosition.includes(\"vertical\")) {\n                    container.addClass(\"tabs-expand\");\n                } else {\n                    if (Utils.isValue(o.expandPoint) && Utils.mediaExist(o.expandPoint) && !o.tabsPosition.includes(\"vertical\")) {\n                        if (!container.hasClass(\"tabs-expand\")) container.addClass(\"tabs-expand\");\n                    } else {\n                        if (container.hasClass(\"tabs-expand\")) container.removeClass(\"tabs-expand\");\n                    }\n                }\n            }, {ns: this.id});\n\n            container.on(Metro.events.click, \".hamburger, .expand-title\", function(){\n                if (element.data('expanded') === false) {\n                    element.addClass(\"expand\");\n                    element.data('expanded', true);\n                    container.find(\".hamburger\").addClass(\"active\");\n                } else {\n                    element.removeClass(\"expand\");\n                    element.data('expanded', false);\n                    container.find(\".hamburger\").removeClass(\"active\");\n                }\n            });\n\n            element.on(Metro.events.click, \"a\", function(e){\n                var link = $(this);\n                var href = link.attr(\"href\").trim();\n                var tab = link.parent(\"li\");\n\n                if (tab.hasClass(\"active\")) {\n                    e.preventDefault();\n                }\n\n                if (element.data('expanded') === true) {\n                    element.removeClass(\"expand\");\n                    element.data('expanded', false);\n                    container.find(\".hamburger\").removeClass(\"active\");\n                }\n\n                if (Utils.exec(o.onBeforeTab, [tab, element], tab[0]) !== true) {\n                    return false;\n                }\n\n                if (Utils.isValue(href) && href[0] === \"#\") {\n                    that._open(tab);\n                    e.preventDefault();\n                }\n            });\n        },\n\n        _collectTargets: function(){\n            var that = this, element = this.element;\n            var tabs = element.find(\"li\");\n\n            this._targets = [];\n\n            $.each(tabs, function(){\n                var target = $(this).find(\"a\").attr(\"href\").trim();\n                if (target.length > 1 && target[0] === \"#\") {\n                    that._targets.push(target);\n                }\n            });\n        },\n\n        _open: function(tab){\n            var element = this.element, o = this.options;\n            var tabs = element.find(\"li\");\n            var expandTitle = element.siblings(\".expand-title\");\n\n\n            if (tabs.length === 0) {\n                return;\n            }\n\n            this._collectTargets();\n\n            if (tab === undefined) {\n                tab = $(tabs[0]);\n            }\n\n            var target = tab.find(\"a\").attr(\"href\");\n\n            if (target === undefined) {\n                return;\n            }\n\n            tabs.removeClass(\"active\").removeClass(o.clsTabsListItemActive);\n            if (tab.parent().hasClass(\"d-menu\")) {\n                tab.parent().parent().addClass(\"active\");\n            } else {\n                tab.addClass(\"active\");\n            }\n\n            $.each(this._targets, function(){\n                var t = $(this);\n                if (t.length > 0) t.hide();\n            });\n\n            if (target !== \"#\" && target[0] === \"#\") {\n                $(target).show();\n            }\n\n            expandTitle.html(tab.find(\"a\").html());\n\n            tab.addClass(o.clsTabsListItemActive);\n\n            this._fireEvent(\"tab\", {\n                tab: tab[0]\n            });\n        },\n\n        next: function(){\n            var element = this.element;\n            var next, active_tab = element.find(\"li.active\");\n\n            next = active_tab.next(\"li\");\n            if (next.length > 0) {\n                this._open(next);\n            }\n        },\n\n        prev: function(){\n            var element = this.element;\n            var next, active_tab = element.find(\"li.active\");\n\n            next = active_tab.prev(\"li\");\n            if (next.length > 0) {\n                this._open(next);\n            }\n        },\n\n        open: function(tab){\n            var element = this.element;\n            var tabs = element.find(\"li\");\n\n            if (!Utils.isValue(tab)) {\n                tab = 1;\n            }\n\n            if (Utils.isInt(tab)) {\n                if (Utils.isValue(tabs[tab-1])) this._open($(tabs[tab-1]));\n            } else {\n                this._open($(tab));\n            }\n        },\n\n        changeAttribute: function(){\n        },\n\n        destroy: function(){\n            var element = this.element;\n            var container = element.parent();\n\n            $(window).off(Metro.events.resize,{ns: this.id});\n\n            container.off(Metro.events.click, \".hamburger, .expand-title\");\n\n            element.off(Metro.events.click, \"a\");\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var Utils = Metro.utils;\n    var TagInputDefaultConfig = {\n        autocomplete: null,\n        autocompleteUnique: true,\n        autocompleteUrl: null,\n        autocompleteUrlMethod: \"GET\",\n        autocompleteUrlKey: null,\n        autocompleteDivider: \",\",\n        autocompleteListHeight: 200,\n\n        label: \"\",\n        size: \"normal\",\n        taginputDeferred: 0,\n        static: false,\n        clearButton: true,\n        clearButtonIcon: \"<span class='default-icon-cross'></span>\",\n\n        randomColor: false,\n        maxTags: 0,\n        tagSeparator: \",\",\n        tagTrigger: \"Enter, Space, Comma\",\n        backspace: true,\n\n        clsComponent: \"\",\n        clsInput: \"\",\n        clsClearButton: \"\",\n        clsTag: \"\",\n        clsTagTitle: \"\",\n        clsTagRemover: \"\",\n        clsLabel: \"\",\n\n        onBeforeTagAdd: Metro.noop_true,\n        onTagAdd: Metro.noop,\n        onBeforeTagRemove: Metro.noop_true,\n        onTagRemove: Metro.noop,\n        onTag: Metro.noop,\n        onClear: Metro.noop,\n        onTagTrigger: Metro.noop,\n        onTagInputCreate: Metro.noop\n    };\n\n    Metro.tagInputSetup = function (options) {\n        TagInputDefaultConfig = $.extend({}, TagInputDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroTagInputSetup\"] !== undefined) {\n        Metro.tagInputSetup(window[\"metroTagInputSetup\"]);\n    }\n\n    Metro.Component('tag-input', {\n        init: function( options, elem ) {\n            this._super(elem, options, TagInputDefaultConfig, {\n                values: [],\n                triggers: [],\n                autocomplete: []\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            this.triggers = (\"\"+this.options.tagTrigger).toArray(\",\");\n\n            if (this.triggers.includes(\"Space\") || this.triggers.includes(\"Spacebar\")) {\n                this.triggers.push(\" \");\n                this.triggers.push(\"Spacebar\");\n            }\n\n            if (this.triggers.includes(\"Comma\")) {\n                this.triggers.push(\",\");\n            }\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"tag-input-create\", {\n                element: this.element\n            });\n        },\n\n        _createStructure: function(){\n            var that = this, element = this.element, o = this.options;\n            var container, input, clearButton;\n            var values = element.val().trim();\n\n            container = $(\"<div>\").addClass(\"tag-input \"  + element[0].className).addClass(o.clsComponent).insertBefore(element);\n            element.appendTo(container);\n\n            container.addClass(\"input-\" + o.size)\n\n            element[0].className = \"\";\n\n            element.addClass(\"original-input\");\n            input = $(\"<input type='text'>\").addClass(\"input-wrapper\").addClass(o.clsInput).attr(\"size\", 1);\n            input.appendTo(container);\n\n            if (o.clearButton !== false && !element[0].readOnly) {\n                container.addClass(\"padding-for-clear\");\n                clearButton = $(\"<button>\").addClass(\"button input-clear-button\").attr(\"tabindex\", -1).attr(\"type\", \"button\").html(o.clearButtonIcon);\n                clearButton.appendTo(container);\n            }\n\n            if (Utils.isValue(values)) {\n                $.each(values.toArray(o.tagSeparator), function(){\n                    that._addTag(this);\n                })\n            }\n\n            if (o.label) {\n                var label = $(\"<label>\").addClass(\"label-for-input\").addClass(o.clsLabel).html(o.label).insertBefore(container);\n                if (element.attr(\"id\")) {\n                    label.attr(\"for\", element.attr(\"id\"));\n                }\n                if (element.attr(\"dir\") === \"rtl\") {\n                    label.addClass(\"rtl\");\n                }\n            }\n\n            if (element.is(\":disabled\")) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n\n            if (o.static === true || element.attr(\"readonly\") !== undefined) {\n                container.addClass(\"static-mode\");\n            }\n\n            if (!Utils.isNull(o.autocomplete) || !Utils.isNull(o.autocompleteUrl)) {\n                $(\"<div>\").addClass(\"autocomplete-list\").css({\n                    maxHeight: o.autocompleteListHeight,\n                    display: \"none\"\n                }).appendTo(container);\n            }\n\n            if (Utils.isValue(o.autocomplete)) {\n                var autocomplete_obj = Utils.isObject(o.autocomplete);\n\n                if (autocomplete_obj !== false) {\n                    this.autocomplete = autocomplete_obj;\n                } else {\n                    this.autocomplete = o.autocomplete.toArray(o.autocompleteDivider);\n                }\n            }\n\n            if (Utils.isValue(o.autocompleteUrl)) {\n                fetch(o.autocompleteUrl, {\n                    method: o.autocompleteUrlMethod\n                }).then(function(response){\n                    return response.text()\n                }).then(function(data){\n                    var newData = [];\n\n                    try {\n                        newData = JSON.parse(data);\n                        if (o.autocompleteUrlKey) {\n                            newData = newData[o.autocompleteUrlKey];\n                        }\n                    } catch (e) {\n                        newData = data.split(\"\\n\");\n                    }\n\n                    that.autocomplete = that.autocomplete.concat(newData);\n                });\n            }\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var container = element.closest(\".tag-input\");\n            var input = container.find(\".input-wrapper\");\n            var autocompleteList = container.find(\".autocomplete-list\");\n\n            input.on(Metro.events.focus, function(){\n                container.addClass(\"focused\");\n            });\n\n            input.on(Metro.events.blur, function(){\n                container.removeClass(\"focused\");\n            });\n\n            input.on(Metro.events.inputchange, function(){\n                input.attr(\"size\", Math.ceil(input.val().length / 2) + 2);\n            });\n\n            input.on(Metro.events.keydown, function(e){\n                var val = input.val().trim();\n                var key = e.key;\n\n                if (key === \"Enter\") e.preventDefault();\n\n                if (o.backspace === true && key === \"Backspace\" && val.length === 0) {\n                    if (that.values.length > 0) {\n                        that.values.splice(-1,1);\n                        element.siblings(\".tag\").last().remove();\n                        element.val(that.values.join(o.tagSeparator));\n                    }\n                    return ;\n                }\n\n                if (val === \"\") {return ;}\n\n                if (!that.triggers.includes(key)) {\n                    return ;\n                }\n\n                that._fireEvent(\"tag-trigger\", {\n                    key: key\n                });\n\n                input.val(\"\");\n                that._addTag(val);\n                input.attr(\"size\", 1);\n            });\n\n            input.on(Metro.events.keyup, function(e){\n                var val = input.val();\n                var key = e.key;\n\n                if (that.triggers.includes(key) && val[val.length - 1] === key) {\n                    input.val(val.slice(0, -1));\n                }\n            });\n\n            container.on(Metro.events.click, \".tag .remover\", function(){\n                var tag = $(this).closest(\".tag\");\n                that._delTag(tag);\n            });\n\n            container.on(Metro.events.click, function(){\n                input.focus();\n            });\n\n            container.on(Metro.events.click, \".input-clear-button\", function(){\n                var val = element.val();\n                that.clear();\n\n                that._fireEvent(\"clear\", {\n                    val: val\n                });\n            });\n\n            input.on(Metro.events.input, function(){\n                var val = this.value.toLowerCase();\n                that._drawAutocompleteList(val);\n            });\n\n            container.on(Metro.events.click, \".autocomplete-list .item\", function(){\n                var val = $(this).attr(\"data-autocomplete-value\");\n\n                input.val(\"\");\n                that._addTag(val);\n                input.attr(\"size\", 1);\n\n                autocompleteList.css({\n                    display: \"none\"\n                });\n                that._fireEvent(\"autocomplete-select\", {\n                    value: val\n                });\n            });\n        },\n\n        _drawAutocompleteList: function(val){\n            var that = this, element = this.element, o = this.options;\n            var container = element.closest(\".tag-input\");\n            var input = container.find(\".input-wrapper\");\n            var autocompleteList = container.find(\".autocomplete-list\");\n            var items;\n\n            if (autocompleteList.length === 0) {\n                return;\n            }\n\n            autocompleteList.html(\"\");\n\n            items = this.autocomplete.filter(function(item){\n                return item.toLowerCase().indexOf(val) > -1;\n            });\n\n            autocompleteList.css({\n                display: items.length > 0 ? \"block\" : \"none\",\n                left: input.position().left\n            });\n\n            $.each(items, function(){\n                if (o.autocompleteUnique && that.values.indexOf(this) !== -1) {\n                    return ;\n                }\n\n                var v = this;\n                var index = v.toLowerCase().indexOf(val), content;\n                var item = $(\"<div>\").addClass(\"item\").attr(\"data-autocomplete-value\", v);\n\n                if (index === 0) {\n                    content = \"<strong>\"+v.substr(0, val.length)+\"</strong>\"+v.substr(val.length);\n                } else {\n                    content = v.substr(0, index) + \"<strong>\"+v.substr(index, val.length)+\"</strong>\"+v.substr(index + val.length);\n                }\n\n                item.html(content).appendTo(autocompleteList);\n\n                that._fireEvent(\"draw-autocomplete-item\", {\n                    item: item\n                })\n            });\n        },\n\n        _addTag: function(val){\n            var element = this.element, o = this.options;\n            var container = element.closest(\".tag-input\");\n            var input = container.find(\".input-wrapper\");\n            var tag, title, remover;\n            var tagSize, tagStatic;\n\n            if (container.hasClass(\"input-large\")) {\n                tagSize = \"large\";\n            } else if (container.hasClass(\"input-small\")) {\n                tagSize = \"small\"\n            }\n\n            if (o.maxTags > 0 && this.values.length === o.maxTags) {\n                return ;\n            }\n\n            if ((\"\"+val).trim() === \"\") {\n                return ;\n            }\n\n            if (!Utils.exec(o.onBeforeTagAdd, [val, this.values], element[0])) {\n                return ;\n            }\n\n\n            tag = $(\"<span>\")\n                .addClass(\"tag\")\n                .addClass(tagSize)\n                .addClass(o.clsTag)\n                .insertBefore(input);\n            tag.data(\"value\", val);\n\n            tagStatic = o.static || container.hasClass(\"static-mode\") || element.readonly || element.disabled || container.hasClass(\"disabled\");\n            if (tagStatic) {\n                tag.addClass(\"static\");\n            }\n\n            title = $(\"<span>\").addClass(\"title\").addClass(o.clsTagTitle).html(val);\n            remover = $(\"<span>\").addClass(\"remover\").addClass(o.clsTagRemover).html(\"&times;\");\n\n            title.appendTo(tag);\n            remover.appendTo(tag);\n\n            if (o.randomColor === true) {\n                var colors = Metro.colors.colors(Metro.colors.PALETTES.ALL), bg, fg, bg_r;\n\n                bg = colors[$.random(0, colors.length - 1)];\n                bg_r = Metro.colors.darken(bg, 15);\n                fg = Metro.colors.isDark(bg) ? \"#ffffff\" : \"#000000\";\n\n                tag.css({\n                    backgroundColor: bg,\n                    color: fg\n                });\n                remover.css({\n                    backgroundColor: bg_r,\n                    color: fg\n                });\n            }\n\n            this.values.push(val);\n            element.val(this.values.join(o.tagSeparator));\n\n            this._fireEvent(\"tag-add\", {\n                tag: tag[0],\n                val: val,\n                values: this.values\n            });\n\n            this._fireEvent(\"tag\", {\n                tag: tag[0],\n                val: val,\n                values: this.values\n            });\n        },\n\n        _delTag: function(tag) {\n            var element = this.element, o = this.options;\n            var val = tag.data(\"value\");\n\n            if (!Utils.exec(o.onBeforeTagRemove, [tag, val, this.values], element[0])) {\n                return ;\n            }\n\n            Utils.arrayDelete(this.values, val);\n            element.val(this.values.join(o.tagSeparator));\n\n            this._fireEvent(\"tag-remove\", {\n                tag: tag[0],\n                val: val,\n                values: this.values\n            });\n\n            this._fireEvent(\"tag\", {\n                tag: tag[0],\n                val: val,\n                values: this.values\n            });\n\n            tag.remove();\n        },\n\n        tags: function(){\n            return this.values;\n        },\n\n        val: function(v){\n            var that = this, element = this.element, o = this.options;\n            var container = element.closest(\".tag-input\");\n            var newValues = [];\n\n            if (!Utils.isValue(v)) {\n                return this.tags();\n            }\n\n            this.values = [];\n            container.find(\".tag\").remove();\n\n            if (typeof v === \"string\") {\n                newValues = (\"\"+v).toArray(o.tagSeparator);\n            } else {\n                if (Array.isArray(v)) {\n                    newValues = v;\n                }\n            }\n\n            $.each(newValues, function(){\n                that._addTag(this);\n            });\n\n            return this;\n        },\n\n        append: function(v){\n            var that = this, o = this.options;\n            var newValues = this.values;\n\n            if (typeof v === \"string\") {\n                newValues = (\"\"+v).toArray(o.tagSeparator);\n            } else {\n                if (Array.isArray(v)) {\n                    newValues = v;\n                }\n            }\n\n            $.each(newValues, function(){\n                that._addTag(this);\n            });\n\n            return this;\n        },\n\n        clear: function(){\n            var element = this.element;\n            var container = element.closest(\".tag-input\");\n\n            this.values = [];\n\n            element.val(\"\").trigger(\"change\");\n\n            container.find(\".tag\").remove();\n\n            return this;\n        },\n\n        disable: function(){\n            this.element.data(\"disabled\", true);\n            this.element.parent().addClass(\"disabled\");\n        },\n\n        enable: function(){\n            this.element.data(\"disabled\", false);\n            this.element.parent().removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        toggleStatic: function(val){\n            var container = this.element.closest(\".tag-input\");\n            var staticMode;\n\n            if (Utils.isValue(val)) {\n                staticMode = Utils.bool(val);\n            } else {\n                staticMode = !container.hasClass(\"static-mode\");\n            }\n\n            if (staticMode) {\n                container.addClass(\"static-mode\");\n            } else {\n                container.removeClass(\"static-mode\");\n            }\n        },\n\n        setAutocompleteList: function(l){\n            var autocomplete_list = Utils.isObject(l);\n            if (autocomplete_list !== false) {\n                this.autocomplete = autocomplete_list;\n            } else if (typeof l === \"string\") {\n                this.autocomplete = l.toArray(this.options.autocompleteDivider);\n            }\n        },\n\n        changeAttribute: function(attributeName){\n            var that = this, element = this.element, o = this.options;\n\n            var changeValue = function(){\n                var val = element.attr(\"value\").trim();\n                that.clear();\n                if (!Utils.isValue(val)) {\n                    return ;\n                }\n                that.val(val.toArray(o.tagSeparator));\n            };\n\n            switch (attributeName) {\n                case \"value\": changeValue(); break;\n                case \"disabled\": this.toggleState(); break;\n                case \"static\": this.toggleStatic(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n            var container = element.closest(\".tag-input\");\n            var input = container.find(\".input-wrapper\");\n\n            input.off(Metro.events.focus);\n            input.off(Metro.events.blur);\n            input.off(Metro.events.keydown);\n            container.off(Metro.events.click, \".tag .remover\");\n            container.off(Metro.events.click);\n\n            return element;\n        }\n    });\n\n    $(document).on(Metro.events.click, function(){\n        $('.tag-input .autocomplete-list').hide();\n    });\n\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var Utils = Metro.utils;\n\n    var Engine = function(html, options, conf) {\n        var ReEx, re = '<%(.+?)%>',\n            reExp = /(^( )?(var|if|for|else|switch|case|break|{|}|;))(.*)?/g,\n            code = 'with(obj) { var r=[];\\n',\n            cursor = 0,\n            result,\n            match;\n        var add = function(line, js) {\n            /* jshint -W030 */\n            js? (code += line.match(reExp) ? line + '\\n' : 'r.push(' + line + ');\\n') :\n                (code += line !== '' ? 'r.push(\"' + line.replace(/\"/g, '\\\\\"') + '\");\\n' : '');\n            return add;\n        };\n\n        if (Utils.isValue(conf)) {\n            if (($.hasProp(conf, 'beginToken'))) {\n                re = re.replace('<%', conf.beginToken);\n            }\n            if (($.hasProp(conf,'endToken'))) {\n                re = re.replace('%>', conf.endToken);\n            }\n        }\n\n        ReEx = new RegExp(re, 'g');\n        match = ReEx.exec(html);\n\n        while(match) {\n            add(html.slice(cursor, match.index))(match[1], true);\n            cursor = match.index + match[0].length;\n            match = ReEx.exec(html);\n        }\n        add(html.substr(cursor, html.length - cursor));\n        code = (code + 'return r.join(\"\"); }').replace(/[\\r\\t\\n]/g, ' ');\n        /* jshint -W054 */\n        try { result = new Function('obj', code).apply(options, [options]); }\n        catch(err) { console.error(\"'\" + err.message + \"'\", \" in \\n\\nCode:\\n\", code, \"\\n\"); }\n        return result;\n    };\n\n    var TemplateDefaultConfig = {\n        templateData: null,\n        onTemplateCompile: Metro.noop,\n        onTemplateCreate: Metro.noop\n    };\n\n    Metro.templateSetup = function (options) {\n        TemplateDefaultConfig = $.extend({}, TemplateDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroTemplateSetup\"] !== undefined) {\n        Metro.templateSetup(window[\"metroTemplateSetup\"]);\n    }\n\n    Metro.Component('template', {\n        init: function( options, elem ) {\n            this._super(elem, options, TemplateDefaultConfig, {\n                template: null,\n                data: {}\n            });\n            return this;\n        },\n\n        _compile: function(){\n            var element = this.element;\n            var template, compiled;\n\n            template = this.template\n                .replace(/(&lt;%)/gm, \"<%\")\n                .replace(/(%&gt;)/gm, \"%>\")\n                .replace(/(&lt;)/gm, \"<\")\n                .replace(/(&gt;)/gm, \">\");\n\n            compiled = Engine(template, this.data);\n            element.html(compiled);\n\n            this._fireEvent('template-compile', {\n                template: template,\n                compiled: compiled,\n                element: element\n            });\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n            this.template = element.html();\n            this.data = Utils.isObject(o.templateData) || {};\n            this._compile();\n            this._fireEvent('template-create', {\n                element: element\n            });\n        },\n\n        buildWith: function(obj){\n            var data = Utils.isObject(obj);\n            if (!data) {\n                return;\n            }\n            this.data = data;\n            this._compile();\n        },\n\n        changeAttribute: function(a, v){\n            if (a === \"data-template-data\") {\n                this.options.templateData = v;\n                this.data = Utils.isObject(v) || {};\n                this._compile();\n            }\n        },\n\n        destroy: function(){\n            return this.element;\n        }\n    });\n\n    Metro.template = Engine;\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var TextareaDefaultConfig = {\n        label: \"\",\n        textareaDeferred: 0,\n        charsCounter: null,\n        charsCounterTemplate: \"$1\",\n        defaultValue: \"\",\n        prepend: \"\",\n        append: \"\",\n        copyInlineStyles: false,\n        clearButton: true,\n        clearButtonIcon: \"<span class='default-icon-cross'></span>\",\n        autoSize: true,\n        maxHeight: 0,\n        clsPrepend: \"\",\n        clsAppend: \"\",\n        clsComponent: \"\",\n        clsTextarea: \"\",\n        clsLabel: \"\",\n        onChange: Metro.noop,\n        onTextareaCreate: Metro.noop\n    };\n\n    Metro.textareaSetup = function (options) {\n        TextareaDefaultConfig = $.extend({}, TextareaDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroTextareaSetup\"] !== undefined) {\n        Metro.textareaSetup(window[\"metroTextareaSetup\"]);\n    }\n\n    Metro.Component('textarea', {\n        init: function( options, elem ) {\n            this._super(elem, options, TextareaDefaultConfig);\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"textarea-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var that = this, element = this.element, elem = this.elem, o = this.options;\n            var container = $(\"<div>\").addClass(\"textarea \" + element[0].className);\n            var fakeTextarea = $(\"<textarea>\").addClass(\"fake-textarea\");\n            var clearButton;\n\n            container.insertBefore(element);\n            element.appendTo(container);\n            fakeTextarea.appendTo(container);\n\n            if (o.clearButton !== false && !element[0].readOnly) {\n                clearButton = $(\"<button>\").addClass(\"button input-clear-button\").attr(\"tabindex\", -1).attr(\"type\", \"button\").html(o.clearButtonIcon);\n                clearButton.appendTo(container);\n            }\n\n            if (element.attr('dir') === 'rtl' ) {\n                container.addClass(\"rtl\").attr(\"dir\", \"rtl\");\n            }\n\n            if (o.prepend !== \"\") {\n                var prepend = $(\"<div>\").html(o.prepend);\n                prepend.addClass(\"prepend\").addClass(o.clsPrepend).appendTo(container);\n            }\n\n            if (o.append !== \"\") {\n                var append = $(\"<div>\").html(o.append);\n                append.addClass(\"append\").addClass(o.clsAppend).appendTo(container);\n                clearButton.css({\n                    right: append.outerWidth() + 4\n                });\n            }\n\n            elem.className = '';\n            if (o.copyInlineStyles === true) {\n                for (var i = 0, l = elem.style.length; i < l; i++) {\n                    container.css(elem.style[i], element.css(elem.style[i]));\n                }\n            }\n\n            if (Utils.isValue(o.defaultValue) && element.val().trim() === \"\") {\n                element.val(o.defaultValue);\n            }\n\n            container.addClass(o.clsComponent);\n            element.addClass(o.clsTextarea);\n\n            if (o.label) {\n                var label = $(\"<label>\").addClass(\"label-for-input\").addClass(o.clsLabel).html(o.label).insertBefore(container);\n                if (element.attr(\"id\")) {\n                    label.attr(\"for\", element.attr(\"id\"));\n                }\n                if (element.attr(\"dir\") === \"rtl\") {\n                    label.addClass(\"rtl\");\n                }\n            }\n\n            if (element.is(':disabled')) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n\n            fakeTextarea.val(element.val());\n\n            if (o.autoSize === true) {\n                container.addClass(\"autosize no-scroll-vertical\");\n\n                setTimeout(function(){\n                    that.resize();\n                }, 100);\n            }\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n            var textarea = element.closest(\".textarea\");\n            var fakeTextarea = textarea.find(\".fake-textarea\");\n            var chars_counter = $(o.charsCounter);\n\n            textarea.on(Metro.events.click, \".input-clear-button\", function(){\n                element.val(Utils.isValue(o.defaultValue) ? o.defaultValue : \"\").trigger('change').trigger('keyup').focus();\n            });\n\n            if (o.autoSize) {\n                element.on(Metro.events.inputchange + \" \" + Metro.events.keyup, function(){\n                    fakeTextarea.val(this.value);\n                    that.resize();\n                });\n            }\n\n            element.on(Metro.events.blur, function(){textarea.removeClass(\"focused\");});\n            element.on(Metro.events.focus, function(){textarea.addClass(\"focused\");});\n\n            element.on(Metro.events.keyup, function(){\n                if (Utils.isValue(o.charsCounter) && chars_counter.length > 0) {\n                    if (chars_counter[0].tagName === \"INPUT\") {\n                        chars_counter.val(that.length());\n                    } else {\n                        chars_counter.html(o.charsCounterTemplate.replace(\"$1\", that.length()));\n                    }\n                }\n\n                that._fireEvent(\"change\", {\n                    val: element.val(),\n                    length: that.length()\n                });\n\n            })\n        },\n\n        resize: function(){\n            var element = this.element, o = this.options,\n                textarea = element.closest(\".textarea\"),\n                fakeTextarea = textarea.find(\".fake-textarea\"),\n                currentHeight = fakeTextarea[0].scrollHeight;\n\n            if (o.maxHeight && currentHeight >= o.maxHeight) {\n                textarea.removeClass(\"no-scroll-vertical\");\n                return ;\n            }\n\n            if (o.maxHeight && currentHeight < o.maxHeight) {\n                textarea.addClass(\"no-scroll-vertical\");\n            }\n\n            fakeTextarea[0].style.cssText = 'height:auto;';\n            fakeTextarea[0].style.cssText = 'height:' + fakeTextarea[0].scrollHeight + 'px';\n            element[0].style.cssText = 'height:' + fakeTextarea[0].scrollHeight + 'px';\n        },\n\n        clear: function(){\n            this.element.val(\"\").trigger('change').trigger('keyup').focus();\n        },\n\n        toDefault: function(){\n            this.element.val(Utils.isValue(this.options.defaultValue) ? this.options.defaultValue : \"\").trigger('change').trigger('keyup').focus();\n        },\n\n        length: function(){\n            var characters = this.elem.value.split('');\n            return characters.length;\n        },\n\n        disable: function(){\n            this.element.data(\"disabled\", true);\n            this.element.parent().addClass(\"disabled\");\n        },\n\n        enable: function(){\n            this.element.data(\"disabled\", false);\n            this.element.parent().removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case 'disabled': this.toggleState(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element, o = this.options;\n            var textarea = element.closest(\".textarea\");\n\n            textarea.off(Metro.events.click, \".input-clear-button\");\n\n            if (o.autoSize) {\n                element.off(Metro.events.inputchange + \" \" + Metro.events.keyup);\n            }\n\n            element.off(Metro.events.blur);\n            element.off(Metro.events.focus);\n\n            element.off(Metro.events.keyup);\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var effects = [\n        \"slide-up\", \"slide-down\", \"slide-left\", \"slide-right\", \"fade\", \"zoom\", \"swirl\", \"switch\"\n    ];\n    var TileDefaultConfig = {\n        tileDeferred: 0,\n        size: \"medium\",\n        cover: \"\",\n        coverPosition: \"center\",\n        effect: \"\", // slide-up, slide-down, slide-left, slide-right, fade, zoom, swirl, switch\n        effectInterval: 3000,\n        effectDuration: 500,\n        target: null,\n        canTransform: true,\n        onTileClick: Metro.noop,\n        onTileCreate: Metro.noop\n    };\n\n    Metro.tileSetup = function (options) {\n        TileDefaultConfig = $.extend({}, TileDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroTileSetup\"] !== undefined) {\n        Metro.tileSetup(window[\"metroTileSetup\"]);\n    }\n\n    Metro.Component('tile', {\n        init: function( options, elem ) {\n            this._super(elem, options, TileDefaultConfig, {\n                effectInterval: false,\n                images: [],\n                slides: [],\n                currentSlide: -1,\n                unload: false\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createTile();\n            this._createEvents();\n\n            this._fireEvent(\"tile-create\", {\n                element: element\n            });\n        },\n\n        _createTile: function(){\n            function switchImage(el, img_src, i){\n                $.setTimeout(function(){\n                    el.fadeOut(500, function(){\n                        el.css(\"background-image\", \"url(\" + img_src + \")\");\n                        el.fadeIn();\n                    });\n                }, i * 300);\n            }\n\n            var that = this, element = this.element, o = this.options;\n            var slides = element.find(\".slide\");\n            var slides2 = element.find(\".slide-front, .slide-back\");\n\n            element.addClass(\"tile-\" + o.size);\n\n            if (o.effect.indexOf(\"hover-\") > -1) {\n                element.addClass(\"effect-\" + o.effect);\n                $.each(slides2, function(){\n                    var slide = $(this);\n\n                    if (slide.data(\"cover\") !== undefined) {\n                        that._setCover(slide, slide.data(\"cover\"), slide.data(\"cover-position\"));\n                    }\n                })\n            }\n\n            if (effects.includes(o.effect) && slides.length > 1) {\n                $.each(slides, function(i){\n                    var slide = $(this);\n\n                    that.slides.push(this);\n\n                    if (slide.data(\"cover\") !== undefined) {\n                        that._setCover(slide, slide.data(\"cover\"), slide.data(\"cover-position\"));\n                    }\n\n                    if (i > 0) {\n                        if ([\"slide-up\", \"slide-down\"].indexOf(o.effect) > -1) slide.css(\"top\", \"100%\");\n                        if ([\"slide-left\", \"slide-right\"].indexOf(o.effect) > -1) slide.css(\"left\", \"100%\");\n                        if ([\"fade\", \"zoom\", \"swirl\", \"switch\"].indexOf(o.effect) > -1) slide.css(\"opacity\", 0);\n                    }\n                });\n\n                this.currentSlide = 0;\n\n                this._runEffects();\n            }\n\n            if (o.cover !== \"\") {\n                this._setCover(element, o.cover);\n            }\n\n            if (o.effect === \"image-set\") {\n                element.addClass(\"image-set\");\n\n                $.each(element.children(\"img\"), function(){\n                    that.images.push(this);\n                    $(this).remove();\n                });\n\n                var temp = this.images.slice();\n\n                for(var i = 0; i < 5; i++) {\n                    var rnd_index = $.random(0, temp.length - 1);\n                    var div = $(\"<div>\").addClass(\"img -js-img-\"+i).css(\"background-image\", \"url(\"+temp[rnd_index].src+\")\");\n                    element.prepend(div);\n                    temp.splice(rnd_index, 1);\n                }\n\n                var a = [0, 1, 4, 3, 2];\n\n                $.setInterval(function(){\n                    var temp = that.images.slice();\n                    var bg = Metro.colors.random();\n\n                    element.css(\"background-color\", bg);\n\n                    for(var i = 0; i < a.length; i++) {\n                        var rnd_index = $.random(0, temp.length - 1);\n                        var div = element.find(\".-js-img-\"+a[i]);\n                        switchImage(div, temp[rnd_index].src, i);\n                        temp.splice(rnd_index, 1);\n                    }\n\n                    a = a.reverse();\n                }, 5000);\n            }\n        },\n\n        _runEffects: function(){\n            var that = this, o = this.options;\n\n            if (this.effectInterval === false) this.effectInterval = $.setInterval(function(){\n                var current, next;\n\n                current = $(that.slides[that.currentSlide]);\n\n                that.currentSlide++;\n                if (that.currentSlide === that.slides.length) {\n                    that.currentSlide = 0;\n                }\n\n                next = that.slides[that.currentSlide];\n\n                if (effects.includes(o.effect)) {\n                    Metro.animations[Cake.camelCase(o.effect)]($(current), $(next), {duration: o.effectDuration});\n                }\n\n            }, o.effectInterval);\n        },\n\n        _stopEffects: function(){\n            $.clearInterval(this.effectInterval);\n            this.effectInterval = false;\n        },\n\n        _setCover: function(to, src, pos){\n            if (!Utils.isValue(pos)) {\n                pos = this.options.coverPosition;\n            }\n            to.css({\n                backgroundImage: \"url(\"+src+\")\",\n                backgroundSize: \"cover\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: pos\n            });\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options;\n\n            element.on(Metro.events.startAll, function(e){\n                var tile = $(this);\n                var dim = {w: element.width(), h: element.height()};\n                var X = Utils.pageXY(e).x - tile.offset().left,\n                    Y = Utils.pageXY(e).y - tile.offset().top;\n                var side;\n\n                if (Utils.isRightMouse(e) === false) {\n\n                    if (X < dim.w * 1 / 3 && (Y < dim.h * 1 / 2 || Y > dim.h * 1 / 2)) {\n                        side = 'left';\n                    } else if (X > dim.w * 2 / 3 && (Y < dim.h * 1 / 2 || Y > dim.h * 1 / 2)) {\n                        side = 'right';\n                    } else if (X > dim.w * 1 / 3 && X < dim.w * 2 / 3 && Y > dim.h / 2) {\n                        side = 'bottom';\n                    } else {\n                        side = \"top\";\n                    }\n\n                    if (o.canTransform === true) tile.addClass(\"transform-\" + side);\n\n                    if (o.target !== null) {\n                        setTimeout(function(){\n                            document.location.href = o.target;\n                        }, 100);\n                    }\n\n                    that._fireEvent(\"tile-click\", {\n                        side: side\n                    });\n                }\n            });\n\n            element.on([Metro.events.stopAll, Metro.events.leave].join(\" \"), function(){\n                $(this)\n                    .removeClass(\"transform-left\")\n                    .removeClass(\"transform-right\")\n                    .removeClass(\"transform-top\")\n                    .removeClass(\"transform-bottom\");\n            });\n        },\n\n        changeAttribute: function(){\n        },\n\n        destroy: function(){\n            var element = this.element;\n\n            element.off(Metro.events.startAll);\n\n            element.off([Metro.events.stopAll, Metro.events.leave].join(\" \"));\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var TimePickerDefaultConfig = {\n        label: \"\",\n        timepickerDeferred: 0,\n        hoursStep: 1,\n        minutesStep: 1,\n        secondsStep: 1,\n        value: null,\n        locale: METRO_LOCALE,\n        distance: 3,\n        hours: true,\n        minutes: true,\n        seconds: true,\n        showLabels: true,\n        scrollSpeed: 4,\n        copyInlineStyles: false,\n        clsPicker: \"\",\n        clsPart: \"\",\n        clsHours: \"\",\n        clsMinutes: \"\",\n        clsSeconds: \"\",\n        clsLabel: \"\",\n        clsButton: \"\",\n        clsOkButton: \"\",\n        clsCancelButton: \"\",\n        okButtonIcon: \"<span class='default-icon-check'></span>\",\n        cancelButtonIcon: \"<span class='default-icon-cross'></span>\",\n        onSet: Metro.noop,\n        onOpen: Metro.noop,\n        onClose: Metro.noop,\n        onScroll: Metro.noop,\n        onTimePickerCreate: Metro.noop\n    };\n\n    Metro.timePickerSetup = function (options) {\n        TimePickerDefaultConfig = $.extend({}, TimePickerDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroTimePickerSetup\"] !== undefined) {\n        Metro.timePickerSetup(window[\"metroTimePickerSetup\"]);\n    }\n\n    Metro.Component('time-picker', {\n        init: function( options, elem ) {\n            this._super(elem, options, TimePickerDefaultConfig, {\n                picker: null,\n                isOpen: false,\n                value: [],\n                locale: Metro.locales[METRO_LOCALE]['calendar'],\n                listTimer: {\n                    hours: null,\n                    minutes: null,\n                    seconds: null\n                },\n                id: Utils.elementId(\"time-picker\")\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n            var i;\n\n            if (o.distance < 1) {\n                o.distance = 1;\n            }\n\n            if (o.hoursStep < 1) {o.hoursStep = 1;}\n            if (o.hoursStep > 23) {o.hoursStep = 23;}\n\n            if (o.minutesStep < 1) {o.minutesStep = 1;}\n            if (o.minutesStep > 59) {o.minutesStep = 59;}\n\n            if (o.secondsStep < 1) {o.secondsStep = 1;}\n            if (o.secondsStep > 59) {o.secondsStep = 59;}\n\n            if (element.val() === \"\" && (!Utils.isValue(o.value))) {\n                o.value = datetime().format(\"HH:mm:ss\");\n            }\n\n            this.value = (element.val() !== \"\" ? element.val() : \"\"+o.value).toArray(\":\");\n\n            for(i = 0; i < 3; i++) {\n                if (this.value[i] === undefined || this.value[i] === null) {\n                    this.value[i] = 0;\n                } else {\n                    this.value[i] = parseInt(this.value[i]);\n                }\n            }\n\n            this._normalizeValue();\n\n            if (Metro.locales[o.locale] === undefined) {\n                o.locale = METRO_LOCALE;\n            }\n\n            this.locale = Metro.locales[o.locale]['calendar'];\n\n            this._createStructure();\n            this._createEvents();\n            this._set();\n\n            this._fireEvent(\"time-picker-create\", {\n                element: element\n            });\n        },\n\n        _normalizeValue: function(){\n            var o = this.options;\n\n            if (o.hoursStep > 1) {\n                this.value[0] = Utils.nearest(this.value[0], o.hoursStep, true);\n            }\n            if (o.minutesStep > 1) {\n                this.value[1] = Utils.nearest(this.value[1], o.minutesStep, true);\n            }\n            if (o.minutesStep > 1) {\n                this.value[2] = Utils.nearest(this.value[2], o.secondsStep, true);\n            }\n        },\n\n        _createStructure: function(){\n            var element = this.element, o = this.options;\n            var picker, hours, minutes, seconds, i;\n            var timeWrapper, selectWrapper, selectBlock, actionBlock;\n\n            picker = $(\"<div>\").addClass(\"wheel-picker time-picker \" + element[0].className).addClass(o.clsPicker);\n\n            picker.insertBefore(element);\n            element.attr(\"readonly\", true).appendTo(picker);\n\n            if (o.label) {\n                var label = $(\"<label>\").addClass(\"label-for-input\").addClass(o.clsLabel).html(o.label).insertBefore(picker);\n                if (element.attr(\"id\")) {\n                    label.attr(\"for\", element.attr(\"id\"));\n                }\n                if (element.attr(\"dir\") === \"rtl\") {\n                    label.addClass(\"rtl\");\n                }\n            }\n\n            timeWrapper = $(\"<div>\").addClass(\"time-wrapper\").appendTo(picker);\n\n            if (o.hours === true) {\n                hours = $(\"<div>\").attr(\"data-title\", this.locale['time']['hours']).addClass(\"hours\").addClass(o.clsPart).addClass(o.clsHours).appendTo(timeWrapper);\n            }\n            if (o.minutes === true) {\n                minutes = $(\"<div>\").attr(\"data-title\", this.locale['time']['minutes']).addClass(\"minutes\").addClass(o.clsPart).addClass(o.clsMinutes).appendTo(timeWrapper);\n            }\n            if (o.seconds === true) {\n                seconds = $(\"<div>\").attr(\"data-title\", this.locale['time']['seconds']).addClass(\"seconds\").addClass(o.clsPart).addClass(o.clsSeconds).appendTo(timeWrapper);\n            }\n\n            selectWrapper = $(\"<div>\").addClass(\"select-wrapper\").appendTo(picker);\n\n            selectBlock = $(\"<div>\").addClass(\"select-block\").appendTo(selectWrapper);\n            if (o.hours === true) {\n                hours = $(\"<ul>\").addClass(\"sel-hours\").appendTo(selectBlock);\n                for (i = 0; i < o.distance; i++) $(\"<li>\").html(\"&nbsp;\").data(\"value\", -1).appendTo(hours);\n                for (i = 0; i < 24; i = i + o.hoursStep) {\n                    $(\"<li>\").addClass(\"js-hours-\"+i).html(Cake.lpad(i, 2, \"0\")).data(\"value\", i).appendTo(hours);\n                }\n                for (i = 0; i < o.distance; i++) $(\"<li>\").html(\"&nbsp;\").data(\"value\", -1).appendTo(hours);\n            }\n            if (o.minutes === true) {\n                minutes = $(\"<ul>\").addClass(\"sel-minutes\").appendTo(selectBlock);\n                for (i = 0; i < o.distance; i++) $(\"<li>\").html(\"&nbsp;\").data(\"value\", -1).appendTo(minutes);\n                for (i = 0; i < 60; i = i + o.minutesStep) {\n                    $(\"<li>\").addClass(\"js-minutes-\"+i).html(Cake.lpad(i, 2, \"0\")).data(\"value\", i).appendTo(minutes);\n                }\n                for (i = 0; i < o.distance; i++) $(\"<li>\").html(\"&nbsp;\").data(\"value\", -1).appendTo(minutes);\n            }\n            if (o.seconds === true) {\n                seconds = $(\"<ul>\").addClass(\"sel-seconds\").appendTo(selectBlock);\n                for (i = 0; i < o.distance; i++) $(\"<li>\").html(\"&nbsp;\").data(\"value\", -1).appendTo(seconds);\n                for (i = 0; i < 60; i = i + o.secondsStep) {\n                    $(\"<li>\").addClass(\"js-seconds-\"+i).html(Cake.lpad(i, 2, \"0\")).data(\"value\", i).appendTo(seconds);\n                }\n                for (i = 0; i < o.distance; i++) $(\"<li>\").html(\"&nbsp;\").data(\"value\", -1).appendTo(seconds);\n            }\n\n            selectBlock.height((o.distance * 2 + 1) * 40);\n\n            actionBlock = $(\"<div>\").addClass(\"action-block\").appendTo(selectWrapper);\n            $(\"<button>\").attr(\"type\", \"button\").addClass(\"button action-ok\").addClass(o.clsButton).addClass(o.clsOkButton).html(o.okButtonIcon).appendTo(actionBlock);\n            $(\"<button>\").attr(\"type\", \"button\").addClass(\"button action-cancel\").addClass(o.clsButton).addClass(o.clsCancelButton).html(o.cancelButtonIcon).appendTo(actionBlock);\n\n\n            element[0].className = '';\n            if (o.copyInlineStyles === true) {\n                for (i = 0; i < element[0].style.length; i++) {\n                    picker.css(element[0].style[i], element.css(element[0].style[i]));\n                }\n            }\n\n            if (o.showLabels === true) {\n                picker.addClass(\"show-labels\");\n            }\n\n            if (element.prop(\"disabled\")) {\n                picker.addClass(\"disabled\");\n            }\n\n            this.picker = picker;\n        },\n\n        _createEvents: function(){\n            var that = this, o = this.options;\n            var picker = this.picker;\n\n            picker.on(Metro.events.start, \".select-block ul\", function(e){\n\n                if (e.changedTouches) {\n                    return ;\n                }\n\n                var target = this;\n                var pageY = Utils.pageXY(e).y;\n\n                $(document).on(Metro.events.move, function(e){\n\n                    target.scrollTop -= o.scrollSpeed * (pageY  > Utils.pageXY(e).y ? -1 : 1);\n\n                    pageY = Utils.pageXY(e).y;\n                }, {ns: that.id});\n\n                $(document).on(Metro.events.stop, function(){\n                    $(document).off(Metro.events.move, {ns: that.id});\n                    $(document).off(Metro.events.stop, {ns: that.id});\n                }, {ns: that.id});\n            });\n\n            picker.on(Metro.events.click, function(e){\n                if (that.isOpen === false) that.open();\n                e.stopPropagation();\n            });\n\n            picker.on(Metro.events.click, \".action-ok\", function(e){\n                var h, m, s;\n                var sh = picker.find(\".sel-hours li.active\"),\n                    sm = picker.find(\".sel-minutes li.active\"),\n                    ss = picker.find(\".sel-seconds li.active\");\n\n                h = sh.length === 0 ? 0 : sh.data(\"value\");\n                m = sm.length === 0 ? 0 : sm.data(\"value\");\n                s = ss.length === 0 ? 0 : ss.data(\"value\");\n\n                that.value = [h, m, s];\n                that._normalizeValue();\n                that._set();\n\n                that.close();\n                e.stopPropagation();\n            });\n\n            picker.on(Metro.events.click, \".action-cancel\", function(e){\n                that.close();\n                e.stopPropagation();\n            });\n\n            var scrollLatency = 150;\n            $.each(['hours', 'minutes', 'seconds'], function(){\n                var part = this, list = picker.find(\".sel-\"+part);\n\n                list.on(\"scroll\", function(){\n                    if (!that.isOpen) {\n                        return ;\n                    }\n\n                    if (that.listTimer[part]) {\n                        clearTimeout(that.listTimer[part]);\n                        that.listTimer[part] = null;\n                    }\n\n                    if (!that.listTimer[part]) that.listTimer[part] = setTimeout(function () {\n\n                        var target, targetElement, scrollTop;\n\n                        that.listTimer[part] = null;\n\n                        target = Math.round((Math.ceil(list.scrollTop()) / 40));\n\n                        if (part === \"hours\" && o.hoursStep) {\n                            target *= parseInt(o.hoursStep);\n                        }\n                        if (part === \"minutes\" && o.minutesStep) {\n                            target *= parseInt(o.minutesStep);\n                        }\n                        if (part === \"seconds\" && o.secondsStep) {\n                            target *= parseInt(o.secondsStep);\n                        }\n\n                        targetElement = list.find(\".js-\" + part + \"-\" + target);\n                        scrollTop = targetElement.position().top - (o.distance * 40);\n\n                        list.find(\".active\").removeClass(\"active\");\n\n                        list[0].scrollTop = scrollTop;\n                        targetElement.addClass(\"active\");\n                        Utils.exec(o.onScroll, [targetElement, list, picker], list[0]);\n\n                    }, scrollLatency);\n\n                })\n            });\n        },\n\n        _set: function(){\n            var element = this.element, o = this.options;\n            var picker = this.picker;\n            var h = \"00\", m = \"00\", s = \"00\";\n\n            if (o.hours === true) {\n                h = parseInt(this.value[0]);\n                picker.find(\".hours\").html(Cake.lpad(h, 2, \"0\"));\n            }\n            if (o.minutes === true) {\n                m = parseInt(this.value[1]);\n                picker.find(\".minutes\").html(Cake.lpad(m, 2, \"0\"));\n            }\n            if (o.seconds === true) {\n                s = parseInt(this.value[2]);\n                picker.find(\".seconds\").html(Cake.lpad(s, 2, \"0\"));\n            }\n\n            element.val([h, m, s].join(\":\")).trigger(\"change\");\n\n            this._fireEvent(\"set\", {\n                val: this.value,\n                elementVal: element.val()\n            });\n\n        },\n\n        open: function(){\n            var o = this.options;\n            var picker = this.picker;\n            var h, m, s;\n            var h_list, m_list, s_list;\n            var items = picker.find(\"li\");\n            var select_wrapper = picker.find(\".select-wrapper\");\n            var select_wrapper_in_viewport, select_wrapper_rect;\n            var h_item, m_item, s_item;\n\n            select_wrapper.parent().removeClass(\"for-top for-bottom\");\n            select_wrapper.show(0);\n            items.removeClass(\"active\");\n\n            select_wrapper_in_viewport = Utils.inViewport(select_wrapper[0]);\n            select_wrapper_rect = Utils.rect(select_wrapper[0]);\n\n            if (!select_wrapper_in_viewport && select_wrapper_rect.top > 0) {\n                select_wrapper.parent().addClass(\"for-bottom\");\n            }\n\n            if (!select_wrapper_in_viewport && select_wrapper_rect.top < 0) {\n                select_wrapper.parent().addClass(\"for-top\");\n            }\n\n            var animateList = function(list, item){\n                list\n                    .scrollTop(0)\n                    .animate({\n                        draw: {\n                            scrollTop: item.position().top - (o.distance * 40) + list.scrollTop()\n                        },\n                        dur: 100\n                    });\n            };\n\n            if (o.hours === true) {\n                h = parseInt(this.value[0]);\n                h_list = picker.find(\".sel-hours\");\n                h_item = h_list.find(\"li.js-hours-\" + h).addClass(\"active\");\n                animateList(h_list, h_item);\n            }\n            if (o.minutes === true) {\n                m = parseInt(this.value[1]);\n                m_list = picker.find(\".sel-minutes\");\n                m_item = m_list.find(\"li.js-minutes-\" + m).addClass(\"active\");\n                animateList(m_list, m_item);\n            }\n            if (o.seconds === true) {\n                s = parseInt(this.value[2]);\n                s_list = picker.find(\".sel-seconds\");\n                s_item = s_list.find(\"li.js-seconds-\" + s).addClass(\"active\");\n                animateList(s_list, s_item);\n            }\n\n            this.isOpen = true;\n\n            this._fireEvent(\"open\", {\n                val: this.value\n            });\n\n        },\n\n        close: function(){\n            var picker = this.picker;\n            picker.find(\".select-wrapper\").hide(0);\n            this.isOpen = false;\n\n            this._fireEvent(\"close\", {\n                val: this.value\n            });\n        },\n\n        _convert: function(t){\n            var result;\n\n            if (Array.isArray(t)) {\n                result = t;\n            } else if (typeof  t.getMonth === 'function') {\n                result = [t.getHours(), t.getMinutes(), t.getSeconds()];\n            } else if (Utils.isObject(t)) {\n                result = [t.h, t.m, t.s];\n            } else {\n                result = t.toArray(\":\");\n            }\n\n            return result;\n        },\n\n        val: function(t){\n            if (t === undefined) {\n                return this.element.val();\n            }\n            this.value = this._convert(t);\n            this._normalizeValue();\n            this._set();\n        },\n\n        time: function(t){\n            if (t === undefined) {\n                return {\n                    h: this.value[0],\n                    m: this.value[1],\n                    s: this.value[2]\n                }\n            }\n\n            this.value = this._convert(t);\n            this._normalizeValue();\n            this._set();\n        },\n\n        date: function(t){\n            if (t === undefined || typeof t.getMonth !== 'function') {\n                return datetime()\n                    .hour(this.value[0])\n                    .minute(this.value[1])\n                    .second(this.value[2])\n                    .ms(0)\n                    .val();\n            }\n\n            this.value = this._convert(t);\n            this._normalizeValue();\n            this._set();\n        },\n\n        disable: function(){\n            this.element.data(\"disabled\", true);\n            this.element.parent().addClass(\"disabled\");\n        },\n\n        enable: function(){\n            this.element.data(\"disabled\", false);\n            this.element.parent().removeClass(\"disabled\");\n        },\n\n        toggleState: function(){\n            if (this.elem.disabled) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        changeAttribute: function(attr, newValue){\n            switch (attr) {\n                case \"data-value\":\n                    this.val(newValue);\n                    break;\n                case \"disabled\":\n                    this.toggleState();\n                    break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element;\n            var picker = this.picker;\n\n            $.each(['hours', 'minutes', 'seconds'], function(){\n                picker.find(\".sel-\"+this).off(\"scroll\");\n            });\n\n            picker.off(Metro.events.start, \".select-block ul\");\n            picker.off(Metro.events.click);\n            picker.off(Metro.events.click, \".action-ok\");\n            picker.off(Metro.events.click, \".action-cancel\");\n\n            return element;\n        }\n\n    });\n\n    $(document).on(Metro.events.click, function(){\n        $.each($(\".time-picker\"), function(){\n            $(this).find(\"input\").each(function(){\n                Metro.getPlugin(this, \"timepicker\").close();\n            });\n        });\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var ToastDefaultConfig = {\n        callback: Metro.noop,\n        timeout: METRO_TIMEOUT,\n        distance: 20,\n        showTop: false,\n        clsToast: \"\"\n    };\n\n    Metro.toastSetup = function(options){\n        ToastDefaultConfig = $.extend({}, ToastDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroToastSetup\"] !== undefined) {\n        Metro.toastSetup(window[\"metroToastSetup\"]);\n    }\n\n    var Toast = {\n        create: function(message, /*callback, timeout, cls, */options){\n            var o, toast, width;\n            var args = Array.from(arguments);\n            var timeout, callback, cls;\n\n            if (!$.isPlainObject(options)) {\n                options = args[4];\n                callback = args[1];\n                timeout = args[2];\n                cls = args[3];\n            }\n\n            o = $.extend({}, ToastDefaultConfig, options);\n\n            toast = $(\"<div>\").addClass(\"toast\").html(message).appendTo($(\"body\"));\n            width = toast.outerWidth();\n            toast.hide();\n\n            timeout = timeout || o.timeout;\n            callback = callback || o.callback;\n            cls = cls || o.clsToast;\n\n            if (o.showTop === true) {\n                toast.addClass(\"show-top\").css({\n                    top: o.distance\n                });\n            } else {\n                toast.css({\n                    bottom: o.distance\n                })\n            }\n\n            toast\n                .css({\n                    'left': '50%',\n                    'margin-left': -(width / 2)\n                })\n                .addClass(o.clsToast)\n                .addClass(cls)\n                .fadeIn(METRO_ANIMATION_DURATION, function(){\n                    setTimeout(function(){\n                        Toast.remove(toast, callback);\n                    }, timeout);\n                });\n        },\n\n        remove: function(toast, cb){\n            if (!toast) return ;\n\n            toast.fadeOut(METRO_ANIMATION_DURATION, function(){\n                toast.remove();\n                Utils.exec(cb, null, toast[0]);\n            });\n        }\n    };\n\n    Metro['toast'] = Toast;\n    Metro['createToast'] = Toast.create;\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var TokenizerDefaultConfig = {\n        textToTokenize: \"\",\n        spaceSymbol: \"\",\n        spaceClass: \"space\",\n        tokenClass: \"\",\n        splitter: \"\",\n        tokenElement: \"span\",\n        useTokenSymbol: true,\n        useTokenIndex: true,\n        clsTokenizer: \"\",\n        clsToken: \"\",\n        clsTokenOdd: \"\",\n        clsTokenEven: \"\",\n        onTokenCreate: Metro.noop,\n        onTokenize: Metro.noop,\n        onTokenizerCreate: Metro.noop\n    };\n\n    Metro.tokenizerSetup = function (options) {\n        TokenizerDefaultConfig = $.extend({}, TokenizerDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroTokenizerSetup\"] !== undefined) {\n        Metro.tokenizerSetup(window[\"metroTokenizerSetup\"]);\n    }\n\n    Metro.Component('tokenizer', {\n        init: function( options, elem ) {\n            this._super(elem, options, TokenizerDefaultConfig, {\n                // define instance vars here\n                originalText: \"\"\n            });\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n            this.originalText = o.textToTokenize ? o.textToTokenize.trim() : element.text().trim().replace(/[\\r\\n\\t]/gi, '').replace(/\\s\\s+/g, \" \");\n\n            this._createStructure();\n            this._fireEvent('tokenizer-create');\n        },\n\n        _tokenize: function(){\n            var that = this, element = this.element, o = this.options;\n            var index = 0, append, prepend;\n\n            element.clear().attr(\"aria-label\", this.originalText);\n\n            $.each(this.originalText.split(o.splitter), function(i){\n                var symbol = this;\n                var isSpace = symbol === \" \";\n                var token;\n\n                token = $(\"<\"+o.tokenElement+\">\")\n                    .html(isSpace ? o.spaceSymbol : symbol)\n                    .attr(\"aria-hidden\", true)\n                    .addClass(isSpace ? o.spaceClass : \"\")\n                    .addClass(isSpace && o.useTokenSymbol ? \"\" : \"ts-\"+symbol.replace(\" \", \"_\"))\n                    .addClass(isSpace && o.useTokenIndex ? \"\" : \"ti-\" + (i + 1))\n                    .addClass(o.tokenClass ? o.tokenClass : \"\")\n                    .addClass(!isSpace ? o.clsToken : \"\");\n\n                if (!isSpace) {\n                    index++;\n                    token.addClass(index % 2 === 0 ? \"te-even\" : \"te-odd\");\n                    token.addClass(index % 2 === 0 ? o.clsTokenEven : o.clsTokenOdd);\n                }\n\n                if (o.prepend) {\n                    prepend = $.isSelector(o.prepend) ? $(o.prepend) : $(\"<span>\").html(o.prepend);\n                    token.prepend(prepend);\n                }\n\n                if (o.append) {\n                    append = $.isSelector(o.append) ? $(o.append) : $(\"<span>\").html(o.append);\n                    token.append(append);\n                }\n\n                element.append(token);\n\n                that._fireEvent(\"token-create\", {\n                    token: token[0]\n                });\n            });\n\n            that._fireEvent(\"tokenize\", {\n                tokens: element.children().items(),\n                originalText: this.originalText\n            });\n        },\n\n        _createStructure: function(){\n            var element = this.element,  o = this.options;\n            element.addClass(o.clsTokenizer);\n            this._tokenize();\n        },\n\n        tokenize: function(v){\n            this.originalText = v;\n            this._tokenize();\n        },\n\n        destroy: function(){\n            this.element.remove();\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var TouchConst = {\n        LEFT : \"left\",\n        RIGHT : \"right\",\n        UP : \"up\",\n        DOWN : \"down\",\n        IN : \"in\",\n        OUT : \"out\",\n        NONE : \"none\",\n        AUTO : \"auto\",\n        SWIPE : \"swipe\",\n        PINCH : \"pinch\",\n        TAP : \"tap\",\n        DOUBLE_TAP : \"doubletap\",\n        LONG_TAP : \"longtap\",\n        HOLD : \"hold\",\n        HORIZONTAL : \"horizontal\",\n        VERTICAL : \"vertical\",\n        ALL_FINGERS : \"all\",\n        DOUBLE_TAP_THRESHOLD : 10,\n        PHASE_START : \"start\",\n        PHASE_MOVE : \"move\",\n        PHASE_END : \"end\",\n        PHASE_CANCEL : \"cancel\",\n        SUPPORTS_TOUCH : 'ontouchstart' in window,\n        SUPPORTS_POINTER_IE10 : window.navigator.msPointerEnabled && !window.navigator.pointerEnabled && !('ontouchstart' in window),\n        SUPPORTS_POINTER : (window.navigator.pointerEnabled || window.navigator.msPointerEnabled) && !('ontouchstart' in window),\n        IN_TOUCH: \"intouch\"\n    };\n\n    var TouchDefaultConfig = {\n        touchDeferred: 0,\n        fingers: 1,\n        threshold: 75,\n        cancelThreshold: null,\n        pinchThreshold: 20,\n        maxTimeThreshold: null,\n        fingerReleaseThreshold: 250,\n        longTapThreshold: 500,\n        doubleTapThreshold: 200,\n        triggerOnTouchEnd: true,\n        triggerOnTouchLeave: false,\n        allowPageScroll: \"auto\",\n        fallbackToMouseEvents: true,\n        excludedElements: \".no-swipe\",\n        preventDefaultEvents: true,\n\n        onSwipe: Metro.noop,\n        onSwipeLeft: Metro.noop,\n        onSwipeRight: Metro.noop,\n        onSwipeUp: Metro.noop,\n        onSwipeDown: Metro.noop,\n        onSwipeStatus: Metro.noop_true, // params: phase, direction, distance, duration, fingerCount, fingerData, currentDirection\n        onPinchIn: Metro.noop,\n        onPinchOut: Metro.noop,\n        onPinchStatus: Metro.noop_true,\n        onTap: Metro.noop,\n        onDoubleTap: Metro.noop,\n        onLongTap: Metro.noop,\n        onHold: Metro.noop,\n\n        onTouchCreate: Metro.noop\n    };\n\n    Metro.touchSetup = function (options) {\n        TouchDefaultConfig = $.extend({}, TouchDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroTouchSetup\"] !== undefined) {\n        Metro.touchSetup(window[\"metroTouchSetup\"]);\n    }\n\n    Metro.Component('touch', {\n        init: function( options, elem ) {\n            this._super(elem, options, TouchDefaultConfig, {\n                useTouchEvents: null,\n                START_EV: null,\n                MOVE_EV: null,\n                END_EV: null,\n                LEAVE_EV: null,\n                CANCEL_EV: null,\n\n                distance: 0,\n                direction: null,\n                currentDirection: null,\n                duration: 0,\n                startTouchesDistance: 0,\n                endTouchesDistance: 0,\n                pinchZoom: 1,\n                pinchDistance: 0,\n                pinchDirection: 0,\n                maximumsMap: null,\n\n                phase: \"start\",\n\n                fingerCount: 0,\n\n                fingerData: {},\n\n                startTime: 0,\n                endTime: 0,\n                previousTouchEndTime: 0,\n                fingerCountAtRelease: 0,\n                doubleTapStartTime: 0,\n\n                singleTapTimeout: null,\n                holdTimeout: null\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var that = this, element = this.element, o = this.options;\n\n            this.useTouchEvents = (TouchConst.SUPPORTS_TOUCH || TouchConst.SUPPORTS_POINTER || !this.options.fallbackToMouseEvents);\n            this.START_EV = this.useTouchEvents ? (TouchConst.SUPPORTS_POINTER ? (TouchConst.SUPPORTS_POINTER_IE10 ? 'MSPointerDown' : 'pointerdown') : 'touchstart') : 'mousedown';\n            this.MOVE_EV = this.useTouchEvents ? (TouchConst.SUPPORTS_POINTER ? (TouchConst.SUPPORTS_POINTER_IE10 ? 'MSPointerMove' : 'pointermove') : 'touchmove') : 'mousemove';\n            this.END_EV = this.useTouchEvents ? (TouchConst.SUPPORTS_POINTER ? (TouchConst.SUPPORTS_POINTER_IE10 ? 'MSPointerUp' : 'pointerup') : 'touchend') : 'mouseup';\n            this.LEAVE_EV = this.useTouchEvents ? (TouchConst.SUPPORTS_POINTER ? 'mouseleave' : null) : 'mouseleave'; //we manually detect leave on touch devices, so null event here\n            this.CANCEL_EV = (TouchConst.SUPPORTS_POINTER ? (TouchConst.SUPPORTS_POINTER_IE10 ? 'MSPointerCancel' : 'pointercancel') : 'touchcancel');\n\n            if (o.allowPageScroll === undefined && (o.onSwipe !== Metro.noop || o.onSwipeStatus !== Metro.noop)) {\n                o.allowPageScroll = TouchConst.NONE;\n            }\n\n            try {\n                element.on(this.START_EV, $.proxy(this.touchStart, that));\n                element.on(this.CANCEL_EV, $.proxy(this.touchCancel, that));\n            } catch (e) {\n                throw new Error('Events not supported ' + this.START_EV + ',' + this.CANCEL_EV + ' on Swipe');\n            }\n\n            this._fireEvent(\"touch-create\", {\n                element: element\n            });\n        },\n\n        touchStart: function(e) {\n            var element = this.element, options = this.options;\n\n            //If we already in a touch event (a finger already in use) then ignore subsequent ones..\n            if (this.getTouchInProgress()) {\n                return;\n            }\n\n            //Check if this element matches any in the excluded elements selectors,  or its parent is excluded, if so, DON'T swipe\n            if ($(e.target).closest(options.excludedElements).length > 0) {\n                return;\n            }\n\n            //As we use Jquery bind for events, we need to target the original event object\n            //If these events are being programmatically triggered, we don't have an original event object, so use the Jq one.\n            var event = e;\n\n            var ret,\n                touches = event.touches,\n                evt = touches ? touches[0] : event;\n\n            this.phase = TouchConst.PHASE_START;\n\n            //If we support touches, get the finger count\n            if (touches) {\n                // get the total number of fingers touching the screen\n                this.fingerCount = touches.length;\n            }\n            //Else this is the desktop, so stop the browser from dragging content\n            else if (options.preventDefaultEvents !== false) {\n                e.preventDefault(); //call this on jq event so we are cross browser\n            }\n\n            //clear vars..\n            this.distance = 0;\n            this.direction = null;\n            this.currentDirection=null;\n            this.pinchDirection = null;\n            this.duration = 0;\n            this.startTouchesDistance = 0;\n            this.endTouchesDistance = 0;\n            this.pinchZoom = 1;\n            this.pinchDistance = 0;\n            this.maximumsMap = this.createMaximumsData();\n            this.cancelMultiFingerRelease();\n\n            //Create the default finger data\n            this.createFingerData(0, evt);\n\n            // check the number of fingers is what we are looking for, or we are capturing pinches\n            if (!touches || (this.fingerCount === options.fingers || options.fingers === TouchConst.ALL_FINGERS) || this.hasPinches()) {\n                // get the coordinates of the touch\n                this.startTime = this.getTimeStamp();\n\n                if (this.fingerCount === 2) {\n                    //Keep track of the initial pinch distance, so we can calculate the diff later\n                    //Store second finger data as start\n                    this.createFingerData(1, touches[1]);\n                    this.startTouchesDistance = this.endTouchesDistance = this.calculateTouchesDistance(this.fingerData[0].start, this.fingerData[1].start);\n                }\n\n                if (options.onSwipeStatus !== Metro.noop || options.onPinchStatus !== Metro.noop) {\n                    ret = this.triggerHandler(event, this.phase);\n                }\n            } else {\n                //A touch with more or less than the fingers we are looking for, so cancel\n                ret = false;\n            }\n\n            //If we have a return value from the users handler, then return and cancel\n            if (ret === false) {\n                this.phase = TouchConst.PHASE_CANCEL;\n                this.triggerHandler(event, this.phase);\n                return ret;\n            } else {\n                if (options.onHold !== Metro.noop) {\n                    this.holdTimeout = setTimeout($.proxy(function() {\n                        //Trigger the event\n                        element.trigger('hold', [event.target]);\n                        //Fire the callback\n                        if (options.onHold !== Metro.noop) { // TODO Remove this if\n                            ret = Utils.exec(options.onHold, [event, event.target], element[0]);\n                            element.fire(\"hold\", {\n                                event: event,\n                                target: event.target\n                            });\n                        }\n                    }, this), options.longTapThreshold);\n                }\n\n                this.setTouchInProgress(true);\n            }\n\n            return null;\n        },\n\n        touchMove: function(e) {\n            //As we use Jquery bind for events, we need to target the original event object\n            //If these events are being programmatically triggered, we don't have an original event object, so use the Jq one.\n            var event = e;\n\n            //If we are ending, cancelling, or within the threshold of 2 fingers being released, don't track anything..\n            if (this.phase === TouchConst.PHASE_END || this.phase === TouchConst.PHASE_CANCEL || this.inMultiFingerRelease())\n                return;\n\n            var ret,\n                touches = event.touches,\n                evt = touches ? touches[0] : event;\n\n            //Update the  finger data\n            var currentFinger = this.updateFingerData(evt);\n            this.endTime = this.getTimeStamp();\n\n            if (touches) {\n                this.fingerCount = touches.length;\n            }\n\n            if (this.options.onHold !== Metro.noop) {\n                clearTimeout(this.holdTimeout);\n            }\n\n            this.phase = TouchConst.PHASE_MOVE;\n\n            //If we have 2 fingers get Touches distance as well\n            if (this.fingerCount === 2) {\n\n                //Keep track of the initial pinch distance, so we can calculate the diff later\n                //We do this here as well as the start event, in case they start with 1 finger, and the press 2 fingers\n                if (this.startTouchesDistance === 0) {\n                    //Create second finger if this is the first time...\n                    this.createFingerData(1, touches[1]);\n\n                    this.startTouchesDistance = this.endTouchesDistance = this.calculateTouchesDistance(this.fingerData[0].start, this.fingerData[1].start);\n                } else {\n                    //Else just update the second finger\n                    this.updateFingerData(touches[1]);\n\n                    this.endTouchesDistance = this.calculateTouchesDistance(this.fingerData[0].end, this.fingerData[1].end);\n                    this.pinchDirection = this.calculatePinchDirection(this.fingerData[0].end, this.fingerData[1].end);\n                }\n\n                this.pinchZoom = this.calculatePinchZoom(this.startTouchesDistance, this.endTouchesDistance);\n                this.pinchDistance = Math.abs(this.startTouchesDistance - this.endTouchesDistance);\n            }\n\n            if ((this.fingerCount === this.options.fingers || this.options.fingers === TouchConst.ALL_FINGERS) || !touches || this.hasPinches()) {\n\n                //The overall direction of the swipe. From start to now.\n                this.direction = this.calculateDirection(currentFinger.start, currentFinger.end);\n\n                //The immediate direction of the swipe, direction between the last movement and this one.\n                this.currentDirection = this.calculateDirection(currentFinger.last, currentFinger.end);\n\n                //Check if we need to prevent default event (page scroll / pinch zoom) or not\n                this.validateDefaultEvent(e, this.currentDirection);\n\n                //Distance and duration are all off the main finger\n                this.distance = this.calculateDistance(currentFinger.start, currentFinger.end);\n                this.duration = this.calculateDuration();\n\n                //Cache the maximum distance we made in this direction\n                this.setMaxDistance(this.direction, this.distance);\n\n                //Trigger status handler\n                ret = this.triggerHandler(event, this.phase);\n\n\n                //If we trigger end events when threshold are met, or trigger events when touch leaves element\n                if (!this.options.triggerOnTouchEnd || this.options.triggerOnTouchLeave) {\n\n                    var inBounds = true;\n\n                    //If checking if we leave the element, run the bounds check (we can use touchleave as its not supported on webkit)\n                    if (this.options.triggerOnTouchLeave) {\n                        var bounds = this.getBounds(this);\n                        inBounds = this.isInBounds(currentFinger.end, bounds);\n                    }\n\n                    //Trigger end handles as we swipe if thresholds met or if we have left the element if the user has asked to check these..\n                    if (!this.options.triggerOnTouchEnd && inBounds) {\n                        this.phase = this.getNextPhase(TouchConst.PHASE_MOVE);\n                    }\n                    //We end if out of bounds here, so set current phase to END, and check if its modified\n                    else if (this.options.triggerOnTouchLeave && !inBounds) {\n                        this.phase = this.getNextPhase(TouchConst.PHASE_END);\n                    }\n\n                    if (this.phase === TouchConst.PHASE_CANCEL || this.phase === TouchConst.PHASE_END) {\n                        this.triggerHandler(event, this.phase);\n                    }\n                }\n            } else {\n                this.phase = TouchConst.PHASE_CANCEL;\n                this.triggerHandler(event, this.phase);\n            }\n\n            if (ret === false) {\n                this.phase = TouchConst.PHASE_CANCEL;\n                this.triggerHandler(event, this.phase);\n            }\n        },\n\n        touchEnd: function(e) {\n            //As we use Jquery bind for events, we need to target the original event object\n            //If these events are being programmatically triggered, we don't have an original event object, so use the Jq one.\n            var event = e,\n                touches = event.touches;\n\n            //If we are still in a touch with the device wait a fraction and see if the other finger comes up\n            //if it does within the threshold, then we treat it as a multi release, not a single release and end the touch / swipe\n            if (touches) {\n                if (touches.length && !this.inMultiFingerRelease()) {\n                    this.startMultiFingerRelease(event);\n                    return true;\n                } else if (touches.length && this.inMultiFingerRelease()) {\n                    return true;\n                }\n            }\n\n            //If a previous finger has been released, check how long ago, if within the threshold, then assume it was a multifinger release.\n            //This is used to allow 2 fingers to release fractionally after each other, whilst maintaining the event as containing 2 fingers, not 1\n            if (this.inMultiFingerRelease()) {\n                this.fingerCount = this.fingerCountAtRelease;\n            }\n\n            //Set end of swipe\n            this.endTime = this.getTimeStamp();\n\n            //Get duration incase move was never fired\n            this.duration = this.calculateDuration();\n\n            //If we trigger handlers at end of swipe OR, we trigger during, but they didnt trigger and we are still in the move phase\n            if (this.didSwipeBackToCancel() || !this.validateSwipeDistance()) {\n                this.phase = TouchConst.PHASE_CANCEL;\n                this.triggerHandler(event, this.phase);\n            } else if (this.options.triggerOnTouchEnd || (this.options.triggerOnTouchEnd === false && this.phase === TouchConst.PHASE_MOVE)) {\n                //call this on jq event so we are cross browser\n                if (this.options.preventDefaultEvents !== false) {\n                    e.preventDefault();\n                }\n                this.phase = TouchConst.PHASE_END;\n                this.triggerHandler(event, this.phase);\n            }\n            //Special cases - A tap should always fire on touch end regardless,\n            //So here we manually trigger the tap end handler by itself\n            //We dont run trigger handler as it will re-trigger events that may have fired already\n            else if (!this.options.triggerOnTouchEnd && this.hasTap()) {\n                //Trigger the pinch events...\n                this.phase = TouchConst.PHASE_END;\n                this.triggerHandlerForGesture(event, this.phase, TouchConst.TAP);\n            } else if (this.phase === TouchConst.PHASE_MOVE) {\n                this.phase = TouchConst.PHASE_CANCEL;\n                this.triggerHandler(event, this.phase);\n            }\n\n            this.setTouchInProgress(false);\n\n            return null;\n        },\n\n        touchCancel: function() {\n            // reset the variables back to default values\n            this.fingerCount = 0;\n            this.endTime = 0;\n            this.startTime = 0;\n            this.startTouchesDistance = 0;\n            this.endTouchesDistance = 0;\n            this.pinchZoom = 1;\n\n            //If we were in progress of tracking a possible multi touch end, then re set it.\n            this.cancelMultiFingerRelease();\n\n            this.setTouchInProgress(false);\n        },\n\n        touchLeave: function(e) {\n            if (this.options.triggerOnTouchLeave) {\n                this.phase = this.getNextPhase(TouchConst.PHASE_END);\n                this.triggerHandler(e, this.phase);\n            }\n        },\n\n        getNextPhase: function(currentPhase) {\n            var options  = this.options;\n            var nextPhase = currentPhase;\n\n            // Ensure we have valid swipe (under time and over distance  and check if we are out of bound...)\n            var validTime = this.validateSwipeTime();\n            var validDistance = this.validateSwipeDistance();\n            var didCancel = this.didSwipeBackToCancel();\n\n            //If we have exceeded our time, then cancel\n            if (!validTime || didCancel) {\n                nextPhase = TouchConst.PHASE_CANCEL;\n            }\n            //Else if we are moving, and have reached distance then end\n            else if (validDistance && currentPhase === TouchConst.PHASE_MOVE && (!options.triggerOnTouchEnd || options.triggerOnTouchLeave)) {\n                nextPhase = TouchConst.PHASE_END;\n            }\n            //Else if we have ended by leaving and didn't reach distance, then cancel\n            else if (!validDistance && currentPhase === TouchConst.PHASE_END && options.triggerOnTouchLeave) {\n                nextPhase = TouchConst.PHASE_CANCEL;\n            }\n\n            return nextPhase;\n        },\n\n        triggerHandler: function(event, phase) {\n            var ret,\n                touches = event.touches;\n\n            // SWIPE GESTURES\n            if (this.didSwipe() || this.hasSwipes()) {\n                ret = this.triggerHandlerForGesture(event, phase, TouchConst.SWIPE);\n            }\n\n            // PINCH GESTURES (if the above didn't cancel)\n            if ((this.didPinch() || this.hasPinches()) && ret !== false) {\n                ret = this.triggerHandlerForGesture(event, phase, TouchConst.PINCH);\n            }\n\n            // CLICK / TAP (if the above didn't cancel)\n            if (this.didDoubleTap() && ret !== false) {\n                //Trigger the tap events...\n                ret = this.triggerHandlerForGesture(event, phase, TouchConst.DOUBLE_TAP);\n            }\n\n            // CLICK / TAP (if the above didn't cancel)\n            else if (this.didLongTap() && ret !== false) {\n                //Trigger the tap events...\n                ret = this.triggerHandlerForGesture(event, phase, TouchConst.LONG_TAP);\n            }\n\n            // CLICK / TAP (if the above didn't cancel)\n            else if (this.didTap() && ret !== false) {\n                //Trigger the tap event..\n                ret = this.triggerHandlerForGesture(event, phase, TouchConst.TAP);\n            }\n\n            // If we are cancelling the gesture, then manually trigger the reset handler\n            if (phase === TouchConst.PHASE_CANCEL) {\n                this.touchCancel(event);\n            }\n\n            // If we are ending the gesture, then manually trigger the reset handler IF all fingers are off\n            if (phase === TouchConst.PHASE_END) {\n                //If we support touch, then check that all fingers are off before we cancel\n                if (touches) {\n                    if (!touches.length) {\n                        this.touchCancel(event);\n                    }\n                } else {\n                    this.touchCancel(event);\n                }\n            }\n\n            return ret;\n        },\n\n        triggerHandlerForGesture: function(event, phase, gesture) {\n\n            var ret, element = this.element, options = this.options;\n\n            //SWIPES....\n            if (gesture === TouchConst.SWIPE) {\n                //Trigger status every time..\n                element.trigger('swipeStatus', [phase, this.direction || null, this.distance || 0, this.duration || 0, this.fingerCount, this.fingerData, this.currentDirection]);\n\n                ret = Utils.exec(options.onSwipeStatus, [event, phase, this.direction || null, this.distance || 0, this.duration || 0, this.fingerCount, this.fingerData, this.currentDirection], element[0]);\n                element.fire(\"swipestatus\", {\n                    event: event,\n                    phase: phase,\n                    direction: this.direction,\n                    distance: this.distance,\n                    duration: this.duration,\n                    fingerCount: this.fingerCount,\n                    fingerData: this.fingerData,\n                    currentDirection: this.currentDirection\n                });\n                if (ret === false) return false;\n\n                if (phase === TouchConst.PHASE_END && this.validateSwipe()) {\n\n                    //Cancel any taps that were in progress...\n                    clearTimeout(this.singleTapTimeout);\n                    clearTimeout(this.holdTimeout);\n\n                    element.trigger('swipe', [this.direction, this.distance, this.duration, this.fingerCount, this.fingerData, this.currentDirection]);\n\n                    ret = Utils.exec(options.onSwipe, [event, this.direction, this.distance, this.duration, this.fingerCount, this.fingerData, this.currentDirection], element[0]);\n                    element.fire(\"swipe\", {\n                        event: event,\n                        direction: this.direction,\n                        distance: this.distance,\n                        duration: this.duration,\n                        fingerCount: this.fingerCount,\n                        fingerData: this.fingerData,\n                        currentDirection: this.currentDirection\n                    });\n\n                    if (ret === false) return false;\n\n                    //trigger direction specific event handlers\n                    switch (this.direction) {\n                        case TouchConst.LEFT:\n                            element.trigger('swipeLeft', [this.direction, this.distance, this.duration, this.fingerCount, this.fingerData, this.currentDirection]);\n                            ret = Utils.exec(options.onSwipeLeft, [event, this.direction, this.distance, this.duration, this.fingerCount, this.fingerData, this.currentDirection], element[0]);\n                            element.fire(\"swipeleft\", {\n                                event: event,\n                                direction: this.direction,\n                                distance: this.distance,\n                                duration: this.duration,\n                                fingerCount: this.fingerCount,\n                                fingerData: this.fingerData,\n                                currentDirection: this.currentDirection\n                            });\n                            break;\n\n                        case TouchConst.RIGHT:\n                            element.trigger('swipeRight', [this.direction, this.distance, this.duration, this.fingerCount, this.fingerData, this.currentDirection]);\n                            ret = Utils.exec(options.onSwipeRight, [event, this.direction, this.distance, this.duration, this.fingerCount, this.fingerData, this.currentDirection], element[0]);\n                            element.fire(\"swiperight\", {\n                                event: event,\n                                direction: this.direction,\n                                distance: this.distance,\n                                duration: this.duration,\n                                fingerCount: this.fingerCount,\n                                fingerData: this.fingerData,\n                                currentDirection: this.currentDirection\n                            });\n                            break;\n\n                        case TouchConst.UP:\n                            element.trigger('swipeUp', [this.direction, this.distance, this.duration, this.fingerCount, this.fingerData, this.currentDirection]);\n                            ret = Utils.exec(options.onSwipeUp, [event, this.direction, this.distance, this.duration, this.fingerCount, this.fingerData, this.currentDirection], element[0]);\n                            element.fire(\"swipeup\", {\n                                event: event,\n                                direction: this.direction,\n                                distance: this.distance,\n                                duration: this.duration,\n                                fingerCount: this.fingerCount,\n                                fingerData: this.fingerData,\n                                currentDirection: this.currentDirection\n                            });\n                            break;\n\n                        case TouchConst.DOWN:\n                            element.trigger('swipeDown', [this.direction, this.distance, this.duration, this.fingerCount, this.fingerData, this.currentDirection]);\n                            ret = Utils.exec(options.onSwipeDown, [event, this.direction, this.distance, this.duration, this.fingerCount, this.fingerData, this.currentDirection], element[0]);\n                            element.fire(\"swipedown\", {\n                                event: event,\n                                direction: this.direction,\n                                distance: this.distance,\n                                duration: this.duration,\n                                fingerCount: this.fingerCount,\n                                fingerData: this.fingerData,\n                                currentDirection: this.currentDirection\n                            });\n                            break;\n                    }\n                }\n            }\n\n\n            //PINCHES....\n            if (gesture === TouchConst.PINCH) {\n                element.trigger('pinchStatus', [phase, this.pinchDirection || null, this.pinchDistance || 0, this.duration || 0, this.fingerCount, this.fingerData, this.pinchZoom]);\n\n                ret = Utils.exec(options.onPinchStatus, [event, phase, this.pinchDirection || null, this.pinchDistance || 0, this.duration || 0, this.fingerCount, this.fingerData, this.pinchZoom], element[0]);\n                element.fire(\"pinchstatus\", {\n                    event: event,\n                    phase: phase,\n                    direction: this.pinchDirection,\n                    distance: this.pinchDistance,\n                    duration: this.duration,\n                    fingerCount: this.fingerCount,\n                    fingerData: this.fingerData,\n                    zoom: this.pinchZoom\n                });\n                if (ret === false) return false;\n\n                if (phase === TouchConst.PHASE_END && this.validatePinch()) {\n\n                    switch (this.pinchDirection) {\n                        case TouchConst.IN:\n                            element.trigger('pinchIn', [this.pinchDirection || null, this.pinchDistance || 0, this.duration || 0, this.fingerCount, this.fingerData, this.pinchZoom]);\n                            ret = Utils.exec(options.onPinchIn, [event, this.pinchDirection || null, this.pinchDistance || 0, this.duration || 0, this.fingerCount, this.fingerData, this.pinchZoom], element[0]);\n                            element.fire(\"pinchin\", {\n                                event: event,\n                                direction: this.pinchDirection,\n                                distance: this.pinchDistance,\n                                duration: this.duration,\n                                fingerCount: this.fingerCount,\n                                fingerData: this.fingerData,\n                                zoom: this.pinchZoom\n                            });\n                            break;\n\n                        case TouchConst.OUT:\n                            element.trigger('pinchOut', [this.pinchDirection || null, this.pinchDistance || 0, this.duration || 0, this.fingerCount, this.fingerData, this.pinchZoom]);\n                            ret = Utils.exec(options.onPinchOut, [event, this.pinchDirection || null, this.pinchDistance || 0, this.duration || 0, this.fingerCount, this.fingerData, this.pinchZoom], element[0]);\n                            element.fire(\"pinchout\", {\n                                event: event,\n                                direction: this.pinchDirection,\n                                distance: this.pinchDistance,\n                                duration: this.duration,\n                                fingerCount: this.fingerCount,\n                                fingerData: this.fingerData,\n                                zoom: this.pinchZoom\n                            });\n                            break;\n                    }\n                }\n            }\n\n            if (gesture === TouchConst.TAP) {\n                if (phase === TouchConst.PHASE_CANCEL || phase === TouchConst.PHASE_END) {\n\n                    clearTimeout(this.singleTapTimeout);\n                    clearTimeout(this.holdTimeout);\n\n                    //If we are also looking for doubelTaps, wait incase this is one...\n                    if (this.hasDoubleTap() && !this.inDoubleTap()) {\n                        this.doubleTapStartTime = this.getTimeStamp();\n\n                        //Now wait for the double tap timeout, and trigger this single tap\n                        //if its not cancelled by a double tap\n                        this.singleTapTimeout = setTimeout($.proxy(function() {\n                            this.doubleTapStartTime = null;\n                            ret = Utils.exec(options.onTap, [event, event.target], element[0]);\n                            element.fire(\"tap\", {\n                                event: event,\n                                target: event.target\n                            });\n                        }, this), options.doubleTapThreshold);\n\n                    } else {\n                        this.doubleTapStartTime = null;\n                        ret = Utils.exec(options.onTap, [event, event.target], element[0]);\n                        element.fire(\"tap\", {\n                            event: event,\n                            target: event.target\n                        });\n                    }\n                }\n            } else if (gesture === TouchConst.DOUBLE_TAP) {\n                if (phase === TouchConst.PHASE_CANCEL || phase === TouchConst.PHASE_END) {\n                    clearTimeout(this.singleTapTimeout);\n                    clearTimeout(this.holdTimeout);\n                    this.doubleTapStartTime = null;\n\n                    ret = Utils.exec(options.onDoubleTap, [event, event.target], element[0]);\n                    element.fire(\"doubletap\", {\n                        event: event,\n                        target: event.target\n                    });\n                }\n            } else if (gesture === TouchConst.LONG_TAP) {\n                if (phase === TouchConst.PHASE_CANCEL || phase === TouchConst.PHASE_END) {\n                    clearTimeout(this.singleTapTimeout);\n                    this.doubleTapStartTime = null;\n\n                    ret = Utils.exec(options.onLongTap, [event, event.target], element[0]);\n                    element.fire(\"longtap\", {\n                        event: event,\n                        target: event.target\n                    });\n                }\n            }\n\n            return ret;\n        },\n\n        validateSwipeDistance: function() {\n            var valid = true;\n            //If we made it past the min swipe distance..\n            if (this.options.threshold !== null) {\n                valid = this.distance >= this.options.threshold;\n            }\n\n            return valid;\n        },\n\n        didSwipeBackToCancel: function() {\n            var options = this.options;\n            var cancelled = false;\n            if (options.cancelThreshold !== null && this.direction !== null) {\n                cancelled = (this.getMaxDistance(this.direction) - this.distance) >= options.cancelThreshold;\n            }\n\n            return cancelled;\n        },\n\n        validatePinchDistance: function() {\n            if (this.options.pinchThreshold !== null) {\n                return this.pinchDistance >= this.options.pinchThreshold;\n            }\n            return true;\n        },\n\n        validateSwipeTime: function() {\n            var result, options = this.options;\n\n            if (options.maxTimeThreshold) {\n                result = this.duration < options.maxTimeThreshold;\n            } else {\n                result = true;\n            }\n\n            return result;\n        },\n\n        validateDefaultEvent: function(e, direction) {\n            var options = this.options;\n\n            //If the option is set, allways allow the event to bubble up (let user handle weirdness)\n            if (options.preventDefaultEvents === false) {\n                return;\n            }\n\n            if (options.allowPageScroll === TouchConst.NONE) {\n                e.preventDefault();\n            } else {\n                var auto = options.allowPageScroll === TouchConst.AUTO;\n\n                switch (direction) {\n                    case TouchConst.LEFT:\n                        if ((options.onSwipeLeft !== Metro.noop && auto) || (!auto && options.allowPageScroll.toLowerCase() !== TouchConst.HORIZONTAL)) {\n                            e.preventDefault();\n                        }\n                        break;\n\n                    case TouchConst.RIGHT:\n                        if ((options.onSwipeRight !== Metro.noop && auto) || (!auto && options.allowPageScroll.toLowerCase() !== TouchConst.HORIZONTAL)) {\n                            e.preventDefault();\n                        }\n                        break;\n\n                    case TouchConst.UP:\n                        if ((options.onSwipeUp !== Metro.noop && auto) || (!auto && options.allowPageScroll.toLowerCase() !== TouchConst.VERTICAL)) {\n                            e.preventDefault();\n                        }\n                        break;\n\n                    case TouchConst.DOWN:\n                        if ((options.onSwipeDown !== Metro.noop && auto) || (!auto && options.allowPageScroll.toLowerCase() !== TouchConst.VERTICAL)) {\n                            e.preventDefault();\n                        }\n                        break;\n\n                    case TouchConst.NONE:\n\n                        break;\n                }\n            }\n        },\n\n        validatePinch: function() {\n            var hasCorrectFingerCount = this.validateFingers();\n            var hasEndPoint = this.validateEndPoint();\n            var hasCorrectDistance = this.validatePinchDistance();\n            return hasCorrectFingerCount && hasEndPoint && hasCorrectDistance;\n        },\n\n        hasPinches: function() {\n            //Enure we dont return 0 or null for false values\n            return !!(this.options.onPinchStatus || this.options.onPinchIn || this.options.onPinchOut);\n        },\n\n        didPinch: function() {\n            //Enure we dont return 0 or null for false values\n            return !!(this.validatePinch() && this.hasPinches());\n        },\n\n        validateSwipe: function() {\n            //Check validity of swipe\n            var hasValidTime = this.validateSwipeTime();\n            var hasValidDistance = this.validateSwipeDistance();\n            var hasCorrectFingerCount = this.validateFingers();\n            var hasEndPoint = this.validateEndPoint();\n            var didCancel = this.didSwipeBackToCancel();\n\n            // if the user swiped more than the minimum length, perform the appropriate action\n            // hasValidDistance is null when no distance is set\n            return !didCancel && hasEndPoint && hasCorrectFingerCount && hasValidDistance && hasValidTime;\n        },\n\n        hasSwipes: function() {\n            var o = this.options;\n            //Enure we dont return 0 or null for false values\n            return !!(\n                o.onSwipe !== Metro.noop\n                || o.onSwipeStatus  !== Metro.noop\n                || o.onSwipeLeft  !== Metro.noop\n                || o.onSwipeRight  !== Metro.noop\n                || o.onSwipeUp  !== Metro.noop\n                || o.onSwipeDown !== Metro.noop\n            );\n        },\n\n        didSwipe: function() {\n            //Enure we dont return 0 or null for false values\n            return !!(this.validateSwipe() && this.hasSwipes());\n        },\n\n        validateFingers: function() {\n            //The number of fingers we want were matched, or on desktop we ignore\n            return ((this.fingerCount === this.options.fingers || this.options.fingers === TouchConst.ALL_FINGERS) || !TouchConst.SUPPORTS_TOUCH);\n        },\n\n        validateEndPoint: function() {\n            //We have an end value for the finger\n            return this.fingerData[0].end.x !== 0;\n        },\n\n        hasTap: function() {\n            //Enure we dont return 0 or null for false values\n            return this.options.onTap !== Metro.noop;\n        },\n\n        hasDoubleTap: function() {\n            //Enure we dont return 0 or null for false values\n            return this.options.onDoubleTap !== Metro.noop;\n        },\n\n        hasLongTap: function() {\n            //Enure we dont return 0 or null for false values\n            return this.options.onLongTap !== Metro.noop;\n        },\n\n        validateDoubleTap: function() {\n            if (this.doubleTapStartTime == null) {\n                return false;\n            }\n            var now = this.getTimeStamp();\n            return (this.hasDoubleTap() && ((now - this.doubleTapStartTime) <= this.options.doubleTapThreshold));\n        },\n\n        inDoubleTap: function() {\n            return this.validateDoubleTap();\n        },\n\n        validateTap: function() {\n            return ((this.fingerCount === 1 || !TouchConst.SUPPORTS_TOUCH) && (isNaN(this.distance) || this.distance < this.options.threshold));\n        },\n\n        validateLongTap: function() {\n            var options = this.options;\n            //slight threshold on moving finger\n            return ((this.duration > options.longTapThreshold) && (this.distance < TouchConst.DOUBLE_TAP_THRESHOLD)); // check double_tab_threshold where from\n        },\n\n        didTap: function() {\n            //Enure we dont return 0 or null for false values\n            return !!(this.validateTap() && this.hasTap());\n        },\n\n        didDoubleTap: function() {\n            //Enure we dont return 0 or null for false values\n            return !!(this.validateDoubleTap() && this.hasDoubleTap());\n        },\n\n        didLongTap: function() {\n            //Enure we dont return 0 or null for false values\n            return !!(this.validateLongTap() && this.hasLongTap());\n        },\n\n        startMultiFingerRelease: function(event) {\n            this.previousTouchEndTime = this.getTimeStamp();\n            this.fingerCountAtRelease = event.touches.length + 1;\n        },\n\n        cancelMultiFingerRelease: function() {\n            this.previousTouchEndTime = 0;\n            this.fingerCountAtRelease = 0;\n        },\n\n        inMultiFingerRelease: function() {\n            var withinThreshold = false;\n\n            if (this.previousTouchEndTime) {\n                var diff = this.getTimeStamp() - this.previousTouchEndTime;\n                if (diff <= this.options.fingerReleaseThreshold) {\n                    withinThreshold = true;\n                }\n            }\n\n            return withinThreshold;\n        },\n\n        getTouchInProgress: function() {\n            var element = this.element;\n            //strict equality to ensure only true and false are returned\n            return (element.data('intouch') === true);\n        },\n\n        setTouchInProgress: function(val) {\n            var element = this.element;\n\n            //If destroy is called in an event handler, we have no el, and we have already cleaned up, so return.\n            if(!element) { return; }\n\n            //Add or remove event listeners depending on touch status\n            if (val === true) {\n                element.on(this.MOVE_EV, $.proxy(this.touchMove, this));\n                element.on(this.END_EV, $.proxy(this.touchEnd, this));\n\n                //we only have leave events on desktop, we manually calcuate leave on touch as its not supported in webkit\n                if (this.LEAVE_EV) {\n                    element.on(this.LEAVE_EV, $.proxy(this.touchLeave, this));\n                }\n            } else {\n\n                element.off(this.MOVE_EV);\n                element.off(this.END_EV);\n\n                //we only have leave events on desktop, we manually calcuate leave on touch as its not supported in webkit\n                if (this.LEAVE_EV) {\n                    element.off(this.LEAVE_EV);\n                }\n            }\n\n            //strict equality to ensure only true and false can update the value\n            element.data('intouch', val === true);\n        },\n\n        createFingerData: function(id, evt) {\n            var f = {\n                start: {\n                    x: 0,\n                    y: 0\n                },\n                last: {\n                    x: 0,\n                    y: 0\n                },\n                end: {\n                    x: 0,\n                    y: 0\n                }\n            };\n            f.start.x = f.last.x = f.end.x = evt.pageX || evt.clientX;\n            f.start.y = f.last.y = f.end.y = evt.pageY || evt.clientY;\n            this.fingerData[id] = f;\n            return f;\n        },\n\n        updateFingerData: function(evt) {\n            var id = evt.identifier !== undefined ? evt.identifier : 0;\n            var f = this.getFingerData(id);\n\n            if (f === null) {\n                f = this.createFingerData(id, evt);\n            }\n\n            f.last.x = f.end.x;\n            f.last.y = f.end.y;\n\n            f.end.x = evt.pageX || evt.clientX;\n            f.end.y = evt.pageY || evt.clientY;\n\n            return f;\n        },\n\n        getFingerData: function(id) {\n            return this.fingerData[id] || null;\n        },\n\n        setMaxDistance: function(direction, distance) {\n            if (direction === TouchConst.NONE) return;\n            distance = Math.max(distance, this.getMaxDistance(direction));\n            this.maximumsMap[direction].distance = distance;\n        },\n\n        getMaxDistance: function(direction) {\n            return (this.maximumsMap[direction]) ? this.maximumsMap[direction].distance : undefined;\n        },\n\n        createMaximumsData: function() {\n            var maxData = {};\n            maxData[TouchConst.LEFT] = this.createMaximumVO(TouchConst.LEFT);\n            maxData[TouchConst.RIGHT] = this.createMaximumVO(TouchConst.RIGHT);\n            maxData[TouchConst.UP] = this.createMaximumVO(TouchConst.UP);\n            maxData[TouchConst.DOWN] = this.createMaximumVO(TouchConst.DOWN);\n\n            return maxData;\n        },\n\n        createMaximumVO: function(dir) {\n            return {\n                direction: dir,\n                distance: 0\n            }\n        },\n\n        calculateDuration: function(){\n            return this.endTime - this.startTime;\n        },\n\n        calculateTouchesDistance: function(startPoint, endPoint){\n            var diffX = Math.abs(startPoint.x - endPoint.x);\n            var diffY = Math.abs(startPoint.y - endPoint.y);\n\n            return Math.round(Math.sqrt(diffX * diffX + diffY * diffY));\n        },\n\n        calculatePinchZoom: function(startDistance, endDistance){\n            var percent = (endDistance / startDistance) * 100; // 1 ? 100\n            return percent.toFixed(2);\n        },\n\n        calculatePinchDirection: function(){\n            if (this.pinchZoom < 1) {\n                return TouchConst.OUT;\n            } else {\n                return TouchConst.IN;\n            }\n        },\n\n        calculateDistance: function(startPoint, endPoint){\n            return Math.round(Math.sqrt(Math.pow(endPoint.x - startPoint.x, 2) + Math.pow(endPoint.y - startPoint.y, 2)));\n        },\n\n        calculateAngle: function(startPoint, endPoint){\n            var x = startPoint.x - endPoint.x;\n            var y = endPoint.y - startPoint.y;\n            var r = Math.atan2(y, x); //radians\n            var angle = Math.round(r * 180 / Math.PI); //degrees\n\n            //ensure value is positive\n            if (angle < 0) {\n                angle = 360 - Math.abs(angle);\n            }\n\n            return angle;\n        },\n\n        calculateDirection: function(startPoint, endPoint){\n            if( this.comparePoints(startPoint, endPoint) ) {\n                return TouchConst.NONE;\n            }\n\n            var angle = this.calculateAngle(startPoint, endPoint);\n\n            if ((angle <= 45) && (angle >= 0)) {\n                return TouchConst.LEFT;\n            } else if ((angle <= 360) && (angle >= 315)) {\n                return TouchConst.LEFT;\n            } else if ((angle >= 135) && (angle <= 225)) {\n                return TouchConst.RIGHT;\n            } else if ((angle > 45) && (angle < 135)) {\n                return TouchConst.DOWN;\n            } else {\n                return TouchConst.UP;\n            }\n        },\n\n        getTimeStamp: function(){\n            return (new Date()).getTime();\n        },\n\n        getBounds: function (el) {\n            el = $(el);\n            var offset = el.offset();\n\n            return {\n                left: offset.left,\n                right: offset.left + el.outerWidth(),\n                top: offset.top,\n                bottom: offset.top + el.outerHeight()\n            };\n        },\n\n        isInBounds: function(point, bounds){\n            return (point.x > bounds.left && point.x < bounds.right && point.y > bounds.top && point.y < bounds.bottom);\n        },\n\n        comparePoints: function(pointA, pointB) {\n            return (pointA.x === pointB.x && pointA.y === pointB.y);\n        },\n\n        removeListeners: function() {\n            var element = this.element;\n\n            element.off(this.START_EV);\n            element.off(this.CANCEL_EV);\n            element.off(this.MOVE_EV);\n            element.off(this.END_EV);\n\n            //we only have leave events on desktop, we manually calculate leave on touch as its not supported in webkit\n            if (this.LEAVE_EV) {\n                element.off(this.LEAVE_EV);\n            }\n\n            this.setTouchInProgress(false);\n        },\n\n        enable: function(){\n            this.disable();\n            this.element.on(this.START_EV, this.touchStart);\n            this.element.on(this.CANCEL_EV, this.touchCancel);\n            return this.element;\n        },\n\n        disable: function(){\n            this.removeListeners();\n            return this.element;\n        },\n\n        changeAttribute: function(){\n        },\n\n        destroy: function(){\n            this.removeListeners();\n        }\n    });\n\n    Metro['touch'] = TouchConst;\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var TreeViewDefaultConfig = {\n        treeviewDeferred: 0,\n        showChildCount: false,\n        duration: 100,\n        onNodeClick: Metro.noop,\n        onNodeDblClick: Metro.noop,\n        onNodeDelete: Metro.noop,\n        onNodeInsert: Metro.noop,\n        onNodeClean: Metro.noop,\n        onCheckClick: Metro.noop,\n        onRadioClick: Metro.noop,\n        onExpandNode: Metro.noop,\n        onCollapseNode: Metro.noop,\n        onTreeViewCreate: Metro.noop\n    };\n\n    Metro.treeViewSetup = function (options) {\n        TreeViewDefaultConfig = $.extend({}, TreeViewDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroTreeViewSetup\"] !== undefined) {\n        Metro.treeViewSetup(window[\"metroTreeViewSetup\"]);\n    }\n\n    Metro.Component('tree-view', {\n        init: function( options, elem ) {\n            this._super(elem, options, TreeViewDefaultConfig);\n            return this;\n        },\n\n        _create: function(){\n            var that = this, element = this.element;\n\n            this._createTree();\n            this._createEvents();\n\n            $.each(element.find(\"input\"), function(){\n                if (!$(this).is(\":checked\")) return;\n                that._recheck(this);\n            });\n\n            this._fireEvent(\"tree-view-create\", {\n                element: element\n            });\n        },\n\n        _createIcon: function(data){\n            var icon, src;\n\n            src = Utils.isTag(data) ? $(data) : $(\"<img src='' alt=''>\").attr(\"src\", data);\n            icon = $(\"<span>\").addClass(\"icon\");\n            icon.html(src.outerHTML());\n\n            return icon;\n        },\n\n        _createCaption: function(data){\n            return $(\"<span>\").addClass(\"caption\").html(data);\n        },\n\n\n        _createToggle: function(){\n            return $(\"<span>\").addClass(\"node-toggle\");\n        },\n\n\n        _createNode: function(data){\n            var node;\n\n            node = $(\"<li>\");\n\n            if (data.caption !== undefined) {\n                node.prepend(this._createCaption(data.caption));\n            }\n\n            if (data.icon !== undefined) {\n                node.prepend(this._createIcon(data.icon));\n            }\n\n            if (data.html !== undefined) {\n                node.append(data.html);\n            }\n\n            return node;\n        },\n\n        _createTree: function(){\n            var that = this, element = this.element, o = this.options;\n            var nodes = element.find(\"li\");\n\n            element.addClass(\"treeview\");\n\n            $.each(nodes, function(){\n                var node = $(this);\n                var caption, icon;\n\n                caption = node.data(\"caption\");\n                icon = node.data(\"icon\");\n\n                if (caption !== undefined) {\n                    if (node.children(\"ul\").length > 0 && o.showChildCount === true) {\n                        caption += \" (\"+node.children(\"ul\").children(\"li\").length+\")\"\n                    }\n                    node.prepend(that._createCaption(caption));\n                }\n\n                if (icon !== undefined) {\n                    node.prepend(that._createIcon(icon));\n                }\n\n                if (node.children(\"ul\").length > 0) {\n\n                    node.addClass(\"tree-node\");\n\n                    node.append(that._createToggle());\n\n                    if (Utils.bool(node.attr(\"data-collapsed\")) !== true) {\n                        node.addClass(\"expanded\");\n                    } else {\n                        node.children(\"ul\").hide();\n                    }\n                }\n\n            });\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element;\n\n            element.on(Metro.events.click, \".node-toggle\", function(e){\n                var toggle = $(this);\n                var node = toggle.parent();\n\n                that.toggleNode(node);\n\n                e.preventDefault();\n            });\n\n            element.on(Metro.events.click, \"li > .caption\", function(e){\n                var node = $(this).parent();\n\n                that.current(node);\n\n                that._fireEvent(\"node-click\", {\n                    node: node[0]\n                });\n\n                e.preventDefault();\n            });\n\n            element.on(Metro.events.dblclick, \"li > .caption\", function(e){\n                var node = $(this).closest(\"li\");\n                var toggle = node.children(\".node-toggle\");\n                var subtree = node.children(\"ul\");\n\n                if (toggle.length > 0 || subtree.length > 0) {\n                    that.toggleNode(node);\n                }\n\n                that._fireEvent(\"node-dbl-click\", {\n                    node: node[0]\n                })\n\n                e.preventDefault();\n            });\n\n            element.on(Metro.events.click, \"input[type=radio]\", function(){\n                var check = $(this);\n                var checked = check.is(\":checked\");\n                var node = check.closest(\"li\");\n\n                that.current(node);\n\n                that._fireEvent(\"radio-click\", {\n                    checked: checked,\n                    check: check[0],\n                    node: node[0]\n                });\n            });\n\n            element.on(Metro.events.click, \"input[type=checkbox]\", function(){\n                var check = $(this);\n                var checked = check.is(\":checked\");\n                var node = check.closest(\"li\");\n\n                that._recheck(check);\n\n                that._fireEvent(\"check-click\", {\n                    checked: checked,\n                    check: check[0],\n                    node: node[0]\n                });\n            });\n        },\n\n        _recheck: function(check){\n            var element = this.element;\n            var checked, node, checks, all_checks;\n\n            check = $(check);\n\n            checked = check.is(\":checked\");\n            node = check.closest(\"li\");\n\n            this.current(node);\n\n            // down\n            checks = check.closest(\"li\").find(\"ul input[type=checkbox]\");\n            checks.attr(\"data-indeterminate\", false);\n            checks.prop(\"checked\", checked);\n            checks.trigger('change');\n\n            all_checks = [];\n\n            $.each(element.find(\"input[type=checkbox]\"), function(){\n                all_checks.push(this);\n            });\n\n            $.each(all_checks.reverse(), function(){\n                var ch = $(this);\n                var children = ch.closest(\"li\").children(\"ul\").find(\"input[type=checkbox]\").length;\n                var children_checked = ch.closest(\"li\").children(\"ul\").find(\"input[type=checkbox]\").filter(function(el){\n                    return el.checked;\n                }).length;\n\n                if (children > 0 && children_checked === 0) {\n                    ch.attr(\"data-indeterminate\", false);\n                    ch.prop(\"checked\", false);\n                    ch.trigger('change');\n                }\n\n                if (children_checked === 0) {\n                    ch.attr(\"data-indeterminate\", false);\n                } else {\n                    if (children_checked > 0 && children > children_checked) {\n                        ch.attr(\"data-indeterminate\", true);\n                    } else if (children === children_checked) {\n                        ch.attr(\"data-indeterminate\", false);\n                        ch.prop(\"checked\", true);\n                        ch.trigger('change');\n                    }\n                }\n            });\n        },\n\n        current: function(node){\n            var element = this.element;\n\n            if (node === undefined) {\n                return element.find(\"li.current\")\n            }\n\n            element.find(\"li\").removeClass(\"current\");\n            node.addClass(\"current\");\n        },\n\n        toggleNode: function(n){\n            var node = $(n);\n            var o = this.options;\n            var func;\n            var toBeExpanded = !node.data(\"collapsed\");//!node.hasClass(\"expanded\");\n\n            node.toggleClass(\"expanded\");\n            node.data(\"collapsed\", toBeExpanded);\n\n            func = toBeExpanded === true ? \"slideUp\" : \"slideDown\";\n\n            if (!toBeExpanded) {\n\n                this._fireEvent(\"expand-node\", {\n                    node: node[0]\n                });\n\n            } else {\n\n                this._fireEvent(\"collapse-node\", {\n                    node: node[0]\n                });\n\n            }\n\n            node.children(\"ul\")[func](o.duration);\n        },\n\n        addTo: function(node, data){\n            var element = this.element;\n            var target;\n            var new_node;\n            var toggle;\n\n            if (node === null) {\n                target = element;\n            } else {\n                node = $(node);\n                target = node.children(\"ul\");\n                if (target.length === 0) {\n                    target = $(\"<ul>\").appendTo(node);\n                    toggle = this._createToggle();\n                    toggle.appendTo(node);\n                    node.addClass(\"expanded\");\n                }\n            }\n\n            new_node = this._createNode(data);\n\n            new_node.appendTo(target);\n\n            this._fireEvent(\"node-insert\", {\n                node: new_node[0],\n                parent: node ? node[0] : null\n            });\n\n            return new_node;\n        },\n\n        insertBefore: function(node, data){\n            var new_node = this._createNode(data);\n\n            if (Utils.isNull(node)) {\n                return this.addTo(node, data);\n            }\n\n            node = $(node);\n            new_node.insertBefore(node);\n\n            this._fireEvent(\"node-insert\", {\n                node: new_node[0],\n                parent: node ? node[0] : null\n            });\n\n            return new_node;\n        },\n\n        insertAfter: function(node, data){\n            var new_node = this._createNode(data);\n\n            if (Utils.isNull(node)) {\n                return this.addTo(node, data);\n            }\n\n            node = $(node);\n            new_node.insertAfter(node);\n\n            this._fireEvent(\"node-insert\", {\n                node: new_node[0],\n                parent: node[0]\n            });\n\n            return new_node;\n        },\n\n        del: function(node){\n            var element = this.element;\n            node = $(node);\n            var parent_list = node.closest(\"ul\");\n            var parent_node = parent_list.closest(\"li\");\n\n            this._fireEvent(\"node-delete\", {\n                node: node[0]\n            });\n\n            node.remove();\n\n            if (parent_list.children().length === 0 && !parent_list.is(element)) {\n                parent_list.remove();\n                parent_node.removeClass(\"expanded\");\n                parent_node.children(\".node-toggle\").remove();\n            }\n        },\n\n        clean: function(node){\n            node = $(node);\n            node.children(\"ul\").remove();\n            node.removeClass(\"expanded\");\n            node.children(\".node-toggle\").remove();\n\n            this._fireEvent(\"node-clean\", {\n                node: node[0]\n            });\n        },\n\n        changeAttribute: function(){\n        },\n\n        destroy: function(){\n            var element = this.element;\n\n            element.off(Metro.events.click, \".node-toggle\");\n            element.off(Metro.events.click, \"li > .caption\");\n            element.off(Metro.events.dblclick, \"li > .caption\");\n            element.off(Metro.events.click, \"input[type=radio]\");\n            element.off(Metro.events.click, \"input[type=checkbox]\");\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var Utils = Metro.utils;\n    var ValidatorFuncs = {\n        required: function(val){\n            if (Array.isArray(val)) {\n                return val.length > 0 ? val : false;\n            } else {\n                return Utils.isValue(val) ? val.trim() : false;\n            }\n        },\n        length: function(val, len){\n            if (Array.isArray(val)) {return val.length === parseInt(len);}\n            if (!Utils.isValue(len) || isNaN(len) || len <= 0) {\n                return false;\n            }\n            return val.trim().length === parseInt(len);\n        },\n        minlength: function(val, len){\n            if (Array.isArray(val)) {return val.length >= parseInt(len);}\n            if (!Utils.isValue(len) || isNaN(len) || len <= 0) {\n                return false;\n            }\n            return val.trim().length >= parseInt(len);\n        },\n        maxlength: function(val, len){\n            if (Array.isArray(val)) {return val.length <= parseInt(len);}\n            if (!Utils.isValue(len) || isNaN(len) || len <= 0) {\n                return false;\n            }\n            return val.trim().length <= parseInt(len);\n        },\n        min: function(val, min_value){\n            if (!Utils.isValue(min_value) || isNaN(min_value)) {\n                return false;\n            }\n            if (!this.number(val)) {\n                return false;\n            }\n            if (isNaN(val)) {\n                return false;\n            }\n            return Number(val) >= Number(min_value);\n        },\n        max: function(val, max_value){\n            if (!Utils.isValue(max_value) || isNaN(max_value)) {\n                return false;\n            }\n            if (!this.number(val)) {\n                return false;\n            }\n            if (isNaN(val)) {\n                return false;\n            }\n            return Number(val) <= Number(max_value);\n        },\n        email: function(val){\n            /* eslint-disable-next-line */\n            return /^[a-z0-9\\u007F-\\uffff!#$%&'*+\\/=?^_`{|}~-]+(?:\\.[a-z0-9\\u007F-\\uffff!#$%&'*+\\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z]{2,}$/i.test(val);\n        },\n        domain: function(val){\n            /* eslint-disable-next-line */\n            return /^((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}$/.test(val);\n        },\n        url: function(val){\n            /* eslint-disable-next-line */\n            var regexp    = /^(?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i;\n            return regexp.test(val);\n        },\n        date: function(val, format, locale){\n            try {\n                if (!format) {\n                    datetime(val);\n                } else {\n                    Datetime.from(val, format, locale);\n                }\n                return true;\n            } catch (e) {\n                return false;\n            }\n        },\n        number: function(val){\n            return !isNaN(val);\n        },\n        integer: function(val){\n            return Utils.isInt(val);\n        },\n        float: function(val){\n            return Utils.isFloat(val);\n        },\n        digits: function(val){\n            return /^\\d+$/.test(val);\n        },\n        hexcolor: function(val){\n            /* eslint-disable-next-line */\n            return /(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(val);\n        },\n        color: function(val){\n            if (!Utils.isValue(val)) return false;\n            return Metro.colors.color(val, Metro.colors.PALETTES.STANDARD) !== false || Metro.colors.isColor(Metro.colors.parse(val));\n        },\n        pattern: function(val, pat){\n            if (!Utils.isValue(val)) return false;\n            if (!Utils.isValue(pat)) return false;\n            var reg = new RegExp(pat);\n            return reg.test(val);\n        },\n        compare: function(val, val2){\n            return val === val2;\n        },\n        not: function(val, not_this){\n            return val !== not_this;\n        },\n        notequals: function(val, val2){\n            if (Utils.isNull(val)) return false;\n            if (Utils.isNull(val2)) return false;\n            return val.trim() !== val2.trim();\n        },\n        equals: function(val, val2){\n            if (Utils.isNull(val)) return false;\n            if (Utils.isNull(val2)) return false;\n            return val.trim() === val2.trim();\n        },\n        custom: function(val, func){\n            if (Utils.isFunc(func) === false) {\n                return false;\n            }\n            return Utils.exec(func, [val]);\n        },\n\n        is_control: function(el){\n            return el.parent().hasClass(\"input\")\n                || el.parent().hasClass(\"select\")\n                || el.parent().hasClass(\"textarea\")\n                || el.parent().hasClass(\"checkbox\")\n                || el.parent().hasClass(\"switch\")\n                || el.parent().hasClass(\"radio\")\n                || el.parent().hasClass(\"spinner\")\n                ;\n        },\n\n        reset_state: function(el){\n            var input = $(el);\n            var is_control = ValidatorFuncs.is_control(input);\n\n            if (is_control) {\n                input.parent().removeClass(\"invalid valid\");\n            } else {\n                input.removeClass(\"invalid valid\");\n            }\n        },\n\n        set_valid_state: function(el){\n            var input = $(el);\n            var is_control = ValidatorFuncs.is_control(input);\n\n            if (is_control) {\n                input.parent().addClass(\"valid\");\n            } else {\n                input.addClass(\"valid\");\n            }\n        },\n\n        set_invalid_state: function(el){\n            var input = $(el);\n            var is_control = ValidatorFuncs.is_control(input);\n\n            if (is_control) {\n                input.parent().addClass(\"invalid\");\n            } else {\n                input.addClass(\"invalid\");\n            }\n        },\n\n        reset: function(form){\n            var that = this;\n            $.each($(form).find(\"[data-validate]\"), function(){\n                that.reset_state(this);\n            });\n\n            return this;\n        },\n\n        validate: function(el, result, cb_ok, cb_error, required_mode){\n            var this_result = true;\n            var input = $(el);\n            var funcs = input.data('validate') !== undefined ? String(input.data('validate')).split(\" \").map(function(s){return s.trim();}) : [];\n            var errors = [];\n            var hasForm = input.closest('form').length > 0;\n            var attr_name, radio_checked;\n\n            if (funcs.length === 0) {\n                return true;\n            }\n\n            this.reset_state(input);\n\n            if (input.attr('type') && input.attr('type').toLowerCase() === \"checkbox\") {\n                if (funcs.indexOf('required') === -1) {\n                    this_result = true;\n                } else {\n                    this_result = input.is(\":checked\");\n                }\n\n                if (this_result === false) {\n                    errors.push('required');\n                }\n\n                if (result !== undefined) {\n                    result.val += this_result ? 0 : 1;\n                }\n            } else if (input.attr('type') && input.attr('type').toLowerCase() === \"radio\") {\n                attr_name = input.attr('name');\n                if (typeof attr_name  === undefined) {\n                    this_result = true;\n                } else {\n                    /*\n                    * Fix with escaped name by nlared https://github.com/nlared\n                    * */\n                    radio_checked = $(\"input[name=\" + attr_name.replace(\"[\", \"\\\\\\[\").replace(\"]\", \"\\\\\\]\") + \"]:checked\"); // eslint-disable-line\n                    this_result = radio_checked.length > 0;\n                }\n                if (result !== undefined) {\n                    result.val += this_result ? 0 : 1;\n                }\n            } else {\n                $.each(funcs, function(){\n                    if (this_result === false) return;\n                    var rule = this.split(\"=\");\n                    var f, a, b;\n\n                    f = rule[0]; rule.shift();\n                    a = rule.join(\"=\");\n\n                    if (['compare', 'equals', 'notequals'].indexOf(f) > -1) {\n                        a = hasForm ? input[0].form.elements[a].value : $(\"[name=\"+a+\"]\").val();\n                    }\n\n                    if (f === 'date') {\n                        a = input.attr(\"data-value-format\");\n                        b = input.attr(\"data-value-locale\");\n                    }\n\n                    if (Utils.isFunc(ValidatorFuncs[f]) === false)  {\n                        this_result = true;\n                    } else {\n                        if (required_mode === true || f === \"required\") {\n                            this_result = ValidatorFuncs[f](input.val(), a, b);\n                        } else {\n                            if (input.val().trim() !== \"\") {\n                                this_result = ValidatorFuncs[f](input.val(), a, b);\n                            } else {\n                                this_result = true;\n                            }\n                        }\n                    }\n\n                    if (this_result === false) {\n                        errors.push(f);\n                    }\n\n                    if (result !== undefined) {\n                        result.val += this_result ? 0 : 1;\n                    }\n                });\n            }\n\n            if (this_result === false) {\n                this.set_invalid_state(input);\n\n                if (result !== undefined) {\n                    result.log.push({\n                        input: input[0],\n                        name: input.attr(\"name\"),\n                        value: input.val(),\n                        funcs: funcs,\n                        errors: errors\n                    });\n                }\n\n                if (cb_error !== undefined) Utils.exec(cb_error, [input, input.val()], input[0]);\n\n            } else {\n                this.set_valid_state(input);\n\n                if (cb_ok !== undefined) Utils.exec(cb_ok, [input, input.val()], input[0]);\n            }\n\n            return this_result;\n        }\n    };\n\n    Metro['validator'] = ValidatorFuncs;\n\n    var ValidatorDefaultConfig = {\n        validatorDeferred: 0,\n        submitTimeout: 200,\n        interactiveCheck: false,\n        clearInvalid: 0,\n        requiredMode: true,\n        useRequiredClass: true,\n        onBeforeSubmit: Metro.noop_true,\n        onSubmit: Metro.noop,\n        onError: Metro.noop,\n        onValidate: Metro.noop,\n        onErrorForm: Metro.noop,\n        onValidateForm: Metro.noop,\n        onValidatorCreate: Metro.noop\n    };\n\n    Metro.validatorSetup = function (options) {\n        ValidatorDefaultConfig = $.extend({}, ValidatorDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroValidatorSetup\"] !== undefined) {\n        Metro.validatorSetup(window[\"metroValidatorSetup\"]);\n    }\n\n    Metro.Component('validator', {\n        name: \"Validator\",\n\n        init: function( options, elem ) {\n            this._super(elem, options, ValidatorDefaultConfig, {\n                _onsubmit: null,\n                _onreset: null,\n                result: []\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var that = this, element = this.element, o = this.options;\n            var inputs = element.find(\"[data-validate]\");\n\n            element\n                .attr(\"novalidate\", 'novalidate');\n\n            $.each(inputs, function(){\n                var input = $(this);\n                var funcs = input.data(\"validate\");\n                var required = funcs.indexOf(\"required\") > -1;\n                if (required && o.useRequiredClass === true) {\n                    if (ValidatorFuncs.is_control(input)) {\n                        input.parent().addClass(\"required\");\n                    } else {\n                        input.addClass(\"required\");\n                    }\n                }\n                if (o.interactiveCheck === true) {\n                    input.on(Metro.events.inputchange, function () {\n                        ValidatorFuncs.validate(this, undefined, undefined, undefined, o.requiredMode);\n                    });\n                }\n            });\n\n            this._onsubmit = null;\n            this._onreset = null;\n\n            if (element[0].onsubmit !== null) {\n                this._onsubmit = element[0].onsubmit;\n                element[0].onsubmit = null;\n            }\n\n            if (element[0].onreset !== null) {\n                this._onreset = element[0].onreset;\n                element[0].onreset = null;\n            }\n\n            element[0].onsubmit = function(){\n                return that._submit();\n            };\n\n            element[0].onreset = function(){\n                return that._reset();\n            };\n\n            this._fireEvent(\"validator-create\", {\n                element: element\n            });\n        },\n\n        _reset: function(){\n            ValidatorFuncs.reset(this.element);\n            if (this._onsubmit !==  null) Utils.exec(this._onsubmit, null, this.element[0]);\n        },\n\n        _submit: function(){\n            var that = this, element = this.element, o = this.options;\n            var form = this.elem;\n            var inputs = element.find(\"[data-validate]\");\n            var submit = element.find(\"input[type=submit], button[type=submit]\");\n            var result = {\n                val: 0,\n                log: []\n            };\n            var formData = $.serializeToArray(element);\n\n            if (submit.length > 0) {\n                submit.attr('disabled', 'disabled').addClass('disabled');\n            }\n\n            $.each(inputs, function(){\n                ValidatorFuncs.validate(this, result, o.onValidate, o.onError, o.requiredMode);\n            });\n\n            submit.removeAttr(\"disabled\").removeClass(\"disabled\");\n\n            result.val += Utils.exec(o.onBeforeSubmit, [formData], this.elem) === false ? 1 : 0;\n\n            if (result.val === 0) {\n\n                this._fireEvent(\"validate-form\", {\n                    data: formData\n                });\n\n                setTimeout(function(){\n                    // TODO need fix event name to equivalent\n                    Utils.exec(o.onSubmit, [formData], form);\n                    element.fire(\"formsubmit\", {\n                        data: formData\n                    });\n                    if (that._onsubmit !==  null) Utils.exec(that._onsubmit, null, form);\n                }, o.submitTimeout);\n            } else {\n\n                this._fireEvent(\"error-form\", {\n                    log: result.log,\n                    data: formData\n                });\n\n                if (o.clearInvalid > 0) {\n                    setTimeout(function(){\n                        $.each(inputs, function(){\n                            var inp  = $(this);\n                            if (ValidatorFuncs.is_control(inp)) {\n                                inp.parent().removeClass(\"invalid\");\n                            } else {\n                                inp.removeClass(\"invalid\");\n                            }\n                        })\n                    }, o.clearInvalid);\n                }\n            }\n\n            return result.val === 0;\n        },\n\n        changeAttribute: function(){\n        }\n    });\n}(Metro, m4q));\r\n\r\n/**\n * Component Vegas based on Vegas by Jay Salvat (http://jaysalvat.com/)\n * Original code https://github.com/jaysalvat/vegas\n * MIT License, Copyright 2018 Jay Salvat\n *\n * Adaptation for Metro 4 by Serhii Pimenov,\n * Copyright 2020 Serhii Pimenov\n */\n\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var VegasDefaultConfig = {\n        duration: 4000,\n        animationDuration: null,\n        transitionDuration: null,\n        transition: \"fade\",\n        animation: null,\n        slides: [],\n        shuffle: false,\n        align: \"center\",\n        valign: \"center\",\n        loop: true,\n        autoplay: true,\n        mute: true,\n        cover: true,\n        preload: true,\n        timer: true,\n        overlay: 2,\n        color: null,\n        volume: 1,\n        onPlay: Metro.noop,\n        onPause: Metro.noop,\n        onEnd: Metro.noop,\n        onWalk: Metro.noop,\n        onNext: Metro.noop,\n        onPrev: Metro.noop,\n        onJump: Metro.noop,\n        onVegasCreate: Metro.noop\n    };\n\n    Metro.vegasSetup = function (options) {\n        VegasDefaultConfig = $.extend({}, VegasDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroVegasSetup\"] !== undefined) {\n        Metro.vegasSetup(window[\"metroVegasSetup\"]);\n    }\n\n    Metro.Component('vegas', {\n\n        videoCache: {},\n\n        init: function( options, elem ) {\n            this.transitions = [\n                \"fade\", \"fade2\",\n                \"slideLeft\", \"slideLeft2\",\n                \"slideRight\", \"slideRight2\",\n                \"slideUp\", \"slideUp2\",\n                \"slideDown\", \"slideDown2\",\n                \"zoomIn\", \"zoomIn2\",\n                \"zoomOut\", \"zoomOut2\",\n                \"swirlLeft\", \"swirlLeft2\",\n                \"swirlRight\", \"swirlRight2\"\n            ];\n            this.animations = [\n                \"kenburns\",\n                \"kenburnsUp\",\n                \"kenburnsDown\",\n                \"kenburnsRight\",\n                \"kenburnsLeft\",\n                \"kenburnsUpLeft\",\n                \"kenburnsUpRight\",\n                \"kenburnsDownLeft\",\n                \"kenburnsDownRight\"\n            ];\n\n            this.support = {\n                objectFit:  'objectFit'  in document.body.style,\n                video: !/(Android|webOS|Phone|iPad|iPod|BlackBerry|Windows Phone)/i.test(navigator.userAgent)\n            }\n\n            this._super(elem, options, VegasDefaultConfig, {\n                slide: 0,\n                slides: null,\n                total: 0,\n                noshow: false,\n                paused: false,\n                ended: false,\n                timer: null,\n                overlay: null,\n                first: true,\n                timeout: false\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n\n            this.slides = Utils.isObject(o.slides) || [];\n            this.total = this.slides.length;\n            this.noshow = this.total < 2;\n            this.paused = !o.autoplay || this.noshow;\n\n            if (o.shuffle) {\n                this.slides.shuffle();\n            }\n\n            if (o.preload) {\n                this._preload();\n            }\n\n            this._createStructure();\n            this._createEvents();\n\n            this._fireEvent(\"vegas-create\", {\n                element: element\n            });\n        },\n\n        _createStructure: function(){\n            var that = this, element = this.element, o = this.options;\n            var isBody = element[0].tagName === 'BODY';\n            var wrapper;\n\n            if (!isBody) {\n                element.css('height', element.css('height')); // it is not clear why this line\n\n                wrapper = $('<div class=\"vegas-wrapper\">')\n                    .css('overflow', element.css('overflow'))\n                    .css('padding',  element.css('padding'));\n\n                if (!element.css('padding')) {\n                    wrapper\n                        .css('padding-top',    element.css('padding-top'))\n                        .css('padding-bottom', element.css('padding-bottom'))\n                        .css('padding-left',   element.css('padding-left'))\n                        .css('padding-right',  element.css('padding-right'));\n                }\n\n                element.children().appendTo(wrapper);\n                element.clear();\n            }\n\n            element.addClass(\"vegas-container\");\n\n            if (!isBody) {\n                element.append(wrapper);\n            }\n\n            if (o.timer) {\n                this.timer = $('<div class=\"vegas-timer\"><div class=\"vegas-timer-progress\">');\n                element.append(this.timer);\n            }\n\n            if (o.overlay) {\n                this.overlay = $('<div class=\"vegas-overlay\">').addClass('overlay' + (typeof o.overlay === 'boolean' || isNaN(o.overlay) ? 2 : +o.overlay));\n                element.append(this.overlay);\n            }\n\n            setTimeout(function(){\n                Utils.exec(o.onPlay, null, element[0]);\n                that._goto(that.slide);\n            },1)\n        },\n\n        _createEvents: function(){\n        },\n\n        _preload: function(){\n            var img, i;\n\n            for (i = 0; i < this.slides.length; i++) {\n\n                var obj = this.slides[i];\n\n                if (obj.src) {\n                    img = new Image();\n                    img.src = this.slides[i].src;\n                }\n\n                if (obj.video) {\n                    if (obj.video instanceof Array) {\n                        this._video(obj.video);\n                    } else {\n                        this._video(obj.video.src);\n                    }\n                }\n            }\n        },\n\n        _slideShow: function () {\n            var that = this, o = this.options;\n\n            if (this.total > 1 && !this.ended && !this.paused && !this.noshow) {\n                this.timeout = setTimeout(function () {\n                    that.next();\n                }, o.duration);\n            }\n        },\n\n        _timer: function (state) {\n            var that = this, o = this.options;\n\n            clearTimeout(this.timeout);\n\n            if (!this.timer) {\n                return;\n            }\n\n            this.timer\n                .removeClass('vegas-timer-running')\n                .find('div')\n                .css('transition-duration', '0ms');\n\n            if (this.ended || this.paused || this.noshow) {\n                return;\n            }\n\n            if (state) {\n                setTimeout(function () {\n                    that.timer\n                        .addClass('vegas-timer-running')\n                        .find('div')\n                        .css('transition-duration', +o.duration - 100 + 'ms');\n                }, 100);\n            }\n        },\n\n        _fadeSoundIn: function(video, duration){\n            var o = this.options;\n\n            $.animate({\n                el: video,\n                draw: {\n                    volume: +o.volume\n                },\n                dur: duration\n            })\n        },\n\n        _fadeSoundOut: function(video, duration){\n            $.animate({\n                el: video,\n                draw: {\n                    volume: 0\n                },\n                dur: duration\n            })\n        },\n\n        _video: function(sources){\n            var video, source;\n            var cacheKey = sources.toString();\n\n            if (this.videoCache[cacheKey]) {\n                return this.videoCache[cacheKey];\n            }\n\n            if (!Array.isArray(sources)) {\n                sources = [sources];\n            }\n\n            video = document.createElement(\"video\");\n            video.preload = true;\n\n            sources.forEach(function(src){\n                source = document.createElement(\"source\");\n                source.src = src;\n                video.appendChild(source);\n            });\n\n            this.videoCache[cacheKey] = video;\n\n            return video;\n        },\n\n        _goto: function(n){\n            var that = this, element = this.element, o = this.options;\n\n            if (typeof this.slides[n] === 'undefined') {\n                n = 0;\n            }\n\n            this.slide = n;\n\n            var $slide, $inner, video, img, $video;\n            var slides = element.children(\".vegas-slide\");\n            var obj = this.slides[n];\n            var cover = o.cover;\n            var transition, animation;\n            var transitionDuration, animationDuration;\n\n            if (this.first) {\n                this.first = false;\n            }\n\n            if (cover !== 'repeat') {\n                if (cover === true) {\n                    cover = 'cover';\n                } else if (cover === false) {\n                    cover = 'contain';\n                }\n            }\n\n            if (o.transition === 'random') {\n                transition = $.random(this.transitions);\n            } else {\n                transition = o.transition ? o.transition : this.transitions[0];\n            }\n\n            if (o.animation === 'random') {\n                animation = $.random(this.animations);\n            } else {\n                animation = o.animation ? o.animation : this.animations[0];\n            }\n\n            if (!o.transitionDuration) {\n                transitionDuration = +o.duration;\n            } else if (o.transitionDuration === 'auto' || +o.transitionDuration > +o.duration) {\n                transitionDuration = +o.duration;\n            } else {\n                transitionDuration = +o.transitionDuration;\n            }\n\n            if (!o.animationDuration) {\n                animationDuration = +o.duration;\n            } else if (o.animationDuration === 'auto' || +o.animationDuration > +o.duration) {\n                animationDuration = +o.duration;\n            } else {\n                animationDuration = +o.animationDuration;\n            }\n\n            $slide = $(\"<div>\").addClass(\"vegas-slide\").addClass('vegas-transition-' + transition);\n\n            if (this.support.video && obj.video) {\n                video = obj.video instanceof Array ? this._video(obj.video) : this._video(obj.video.src);\n                video.loop = obj.video.loop ? obj.video.loop : o.loop;\n                video.muted = obj.video.mute ? obj.video.mute : o.mute;\n\n                if (!video.muted) {\n                    this._fadeSoundIn(video, transitionDuration);\n                } else {\n                    video.pause();\n                }\n\n                $video = $(video)\n                    .addClass('vegas-video')\n                    .css('background-color', o.color || '#000000');\n\n                if (this.support.objectFit) {\n                    $video\n                        .css('object-position', o.align + ' ' + o.valign)\n                        .css('object-fit', cover)\n                        .css('width',  '100%')\n                        .css('height', '100%');\n                } else if (cover === 'contain') {\n                    $video\n                        .css('width',  '100%')\n                        .css('height', '100%');\n                }\n\n                $slide.append($video);\n            } else {\n                img = new Image();\n                $inner = $(\"<div>\").addClass('vegas-slide-inner')\n                    .css({\n                        backgroundImage: 'url(\"'+obj.src+'\")',\n                        backgroundColor: o.color || '#000000',\n                        backgroundPosition: o.align + ' ' + o.valign\n                    });\n\n                if (cover === 'repeat') {\n                    $inner.css('background-repeat', 'repeat');\n                } else {\n                    $inner.css('background-size', cover);\n                }\n\n                if (animation) {\n                    $inner\n                        .addClass('vegas-animation-' + animation)\n                        .css('animation-duration',  animationDuration + 'ms');\n                }\n\n                $slide.append($inner);\n            }\n\n            if (slides.length) {\n                slides.eq(slides.length - 1).after($slide);\n            } else {\n                element.prepend($slide);\n            }\n\n            slides\n                .css('transition', 'all 0ms')\n                .each(function(){\n                    this.className  = 'vegas-slide';\n\n                    if (this.tagName === 'VIDEO') {\n                        this.className += ' vegas-video';\n                    }\n\n                    if (transition) {\n                        this.className += ' vegas-transition-' + transition;\n                        this.className += ' vegas-transition-' + transition + '-in';\n                    }\n                }\n            );\n\n            this._timer(false);\n\n            function go(){\n                that._timer(true);\n                setTimeout(function () {\n                    slides\n                        .css('transition', 'all ' + transitionDuration + 'ms')\n                        .addClass('vegas-transition-' + transition + '-out');\n\n                    slides.each(function () {\n                        var video = slides.find('video').get(0);\n\n                        if (video) {\n                            video.volume = 1;\n                            that._fadeSoundOut(video, transitionDuration);\n                        }\n                    });\n\n                    $slide\n                        .css('transition', 'all ' + transitionDuration + 'ms')\n                        .addClass('vegas-transition-' + transition + '-in');\n\n                    for (var i = 0; i < slides.length - 1; i++) {\n                        slides.eq(i).remove();\n                    }\n\n                    that._fireEvent(\"walk\", {\n                        slide: that.current(true)\n                    });\n\n                    that._slideShow();\n                }, 100);\n            }\n\n            if (video) {\n                if (video.readyState === 4) {\n                    video.currentTime = 0;\n                }\n\n                video.play();\n                go();\n            } else {\n                img.src = obj.src;\n\n                if (img.complete) {\n                    go();\n                } else {\n                    img.onload = go;\n                }\n            }\n        },\n\n        _end: function(){\n            this.ended = this.options.autoplay;\n            this._timer(false);\n\n            this._fireEvent(\"end\", {\n                slide: this.current(true)\n            });\n        },\n\n        play: function(){\n            if (!this.paused) {\n                return ;\n            }\n\n            this._fireEvent(\"play\", {\n                slide: this.current(true)\n            });\n\n            this.paused = false;\n            this.next();\n        },\n\n        pause: function(){\n            this._timer(false);\n            this.paused = true;\n\n            this._fireEvent(\"pause\", {\n                slide: this.current(true)\n            });\n        },\n\n        toggle: function(){\n            this.paused ? this.play() : this.pause();\n        },\n\n        playing: function(){\n            return !this.paused && !this.noshow;\n        },\n\n        current: function (advanced) {\n            if (advanced) {\n                return {\n                    slide: this.slide,\n                    data:  this.slides[this.slide]\n                };\n            }\n            return this.slide;\n        },\n\n        jump: function(n){\n            if (n <= 0 || n > this.slides.length || n === this.slide + 1) {\n                return this;\n            }\n\n            this.slide = n - 1;\n\n            this._fireEvent(\"jump\", {\n                slide: this.current(true)\n            })\n\n            this._goto(this.slide);\n        },\n\n        next: function(){\n            var o = this.options;\n\n            this.slide++;\n\n            if (this.slide >= this.slides.length) {\n                if (!o.loop) {\n                    return this._end();\n                }\n\n                this.slide = 0;\n            }\n\n            this._fireEvent(\"next\", {\n                slide: this.current(true)\n            });\n\n            this._goto(this.slide);\n        },\n\n        prev: function(){\n            var o = this.options;\n\n            this.slide--;\n\n            if (this.slide < 0) {\n                if (!o.loop) {\n                    this.slide++;\n                    return this._end();\n                }\n\n                this.slide = this.slides.length - 1;\n            }\n\n            this._fireEvent(\"prev\", {\n                slide: this.current(true)\n            });\n\n            this._goto(this.slide);\n        },\n\n        changeAttribute: function(attr){\n            var element = this.element, o = this.options;\n            var propName = Cake.camelCase(attr.replace(\"data-\", \"\"));\n\n            if (propName === 'slides') {\n                o.slides = element.attr('data-slides');\n                this.slides = Utils.isObject(o.slides) || [];\n                this.total = this.slides.length;\n                this.noshow = this.total < 2;\n                this.paused = !this.options.autoplay || this.noshow;\n            } else {\n                if (typeof VegasDefaultConfig[propName] !== 'undefined')\n                    o[propName] = JSON.parse(element.attr(attr));\n            }\n        },\n\n        destroy: function(){\n            var element = this.element, o = this.options;\n\n            clearTimeout(this.timeout);\n            element.removeClass('vegas-container');\n            element.find('> .vegas-slide').remove();\n            element.find('> .vegas-wrapper').children().appendTo(element);\n            element.find('> .vegas-wrapper').remove();\n\n            if (o.timer) {\n                this.timer.remove();\n            }\n\n            if (o.overlay) {\n                this.overlay.remove();\n            }\n\n            return element[0];\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var VideoPlayerDefaultConfig = {\n        videoDeferred: 0,\n        src: null,\n\n        poster: \"\",\n        logo: \"\",\n        logoHeight: 32,\n        logoWidth: \"auto\",\n        logoTarget: \"\",\n\n        volume: .5,\n        loop: false,\n        autoplay: false,\n\n        fullScreenMode: Metro.fullScreenMode.DESKTOP,\n        aspectRatio: Metro.aspectRatio.HD,\n\n        controlsHide: 3000,\n\n        showLoop: true,\n        showPlay: true,\n        showStop: true,\n        showMute: true,\n        showFull: true,\n        showStream: true,\n        showVolume: true,\n        showInfo: true,\n\n        loopIcon: \"<span class='default-icon-loop'></span>\",\n        stopIcon: \"<span class='default-icon-stop'></span>\",\n        playIcon: \"<span class='default-icon-play'></span>\",\n        pauseIcon: \"<span class='default-icon-pause'></span>\",\n        muteIcon: \"<span class='default-icon-mute'></span>\",\n        volumeLowIcon: \"<span class='default-icon-low-volume'></span>\",\n        volumeMediumIcon: \"<span class='default-icon-medium-volume'></span>\",\n        volumeHighIcon: \"<span class='default-icon-high-volume'></span>\",\n        screenMoreIcon: \"<span class='default-icon-enlarge'></span>\",\n        screenLessIcon: \"<span class='default-icon-shrink'></span>\",\n\n        onPlay: Metro.noop,\n        onPause: Metro.noop,\n        onStop: Metro.noop,\n        onEnd: Metro.noop,\n        onMetadata: Metro.noop,\n        onTime: Metro.noop,\n        onVideoPlayerCreate: Metro.noop\n    };\n\n    Metro.videoPlayerSetup = function (options) {\n        VideoPlayerDefaultConfig = $.extend({}, VideoPlayerDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroVideoPlayerSetup\"] !== undefined) {\n        Metro.videoPlayerSetup(window[\"metroVideoPlayerSetup\"]);\n    }\n\n    Metro.Component('video-player', {\n        init: function( options, elem ) {\n            this._super(elem, options, VideoPlayerDefaultConfig, {\n                fullscreen: false,\n                preloader: null,\n                player: null,\n                video: elem,\n                stream: null,\n                volume: null,\n                volumeBackup: 0,\n                muted: false,\n                fullScreenInterval: false,\n                isPlaying: false,\n                id: Utils.elementId('video-player')\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element, o = this.options;\n\n            if (Metro.fullScreenEnabled === false) {\n                o.fullScreenMode = Metro.fullScreenMode.WINDOW;\n            }\n\n            this._createPlayer();\n            this._createControls();\n            this._createEvents();\n            this._setAspectRatio();\n\n            if (o.autoplay === true) {\n                this.play();\n            }\n\n            this._fireEvent(\"video-player-create\", {\n                element: element,\n                player: this.player\n            });\n        },\n\n        _createPlayer: function(){\n            var element = this.element, o = this.options, video = this.video;\n            var player = $(\"<div>\").addClass(\"media-player video-player \" + element[0].className);\n            var preloader = $(\"<div>\").addClass(\"preloader\").appendTo(player);\n            var logo = $(\"<a>\").attr(\"href\", o.logoTarget).addClass(\"logo\").appendTo(player);\n\n            player.insertBefore(element);\n            element.appendTo(player);\n\n            $.each(['muted', 'autoplay', 'controls', 'height', 'width', 'loop', 'poster', 'preload'], function(){\n                element.removeAttr(this);\n            });\n\n            element.attr(\"preload\", \"auto\");\n\n            if (o.poster !== \"\") {\n                element.attr(\"poster\", o.poster);\n            }\n\n            video.volume = o.volume;\n\n            preloader.activity({\n                type: \"cycle\",\n                style: \"color\"\n            });\n\n            preloader.hide();\n\n            this.preloader = preloader;\n\n            if (o.logo !== \"\") {\n                $(\"<img>\")\n                    .css({\n                        height: o.logoHeight,\n                        width: o.logoWidth\n                    })\n                    .attr(\"src\", o.logo).appendTo(logo);\n            }\n\n            if (o.src !== null) {\n                this._setSource(o.src);\n            }\n\n            element[0].className = \"\";\n\n            this.player = player;\n        },\n\n        _setSource: function(src){\n            var element = this.element;\n\n            element.find(\"source\").remove();\n            element.removeAttr(\"src\");\n            if (Array.isArray(src)) {\n                $.each(src, function(){\n                    var item = this;\n                    if (item.src === undefined) return ;\n                    $(\"<source>\").attr('src', item.src).attr('type', item.type !== undefined ? item.type : '').appendTo(element);\n                });\n            } else {\n                element.attr(\"src\", src);\n            }\n        },\n\n        _createControls: function(){\n            var that = this, element = this.element, o = this.options, video = this.elem;\n\n            var controls = $(\"<div>\").addClass(\"controls\").addClass(o.clsControls).insertAfter(element);\n\n            var stream = $(\"<div>\").addClass(\"stream\").appendTo(controls);\n            var streamSlider = $(\"<input>\").addClass(\"stream-slider ultra-thin cycle-marker\").appendTo(stream);\n\n            var volume = $(\"<div>\").addClass(\"volume\").appendTo(controls);\n            var volumeSlider = $(\"<input>\").addClass(\"volume-slider ultra-thin cycle-marker\").appendTo(volume);\n\n            var infoBox = $(\"<div>\").addClass(\"info-box\").appendTo(controls);\n\n            if (o.showInfo !== true) {\n                infoBox.hide();\n            }\n\n            Metro.makePlugin(streamSlider, \"slider\", {\n                clsMarker: \"bg-red\",\n                clsHint: \"bg-cyan fg-white\",\n                clsComplete: \"bg-cyan\",\n                hint: true,\n                onStart: function(){\n                    if (!video.paused) video.pause();\n                },\n                onStop: function(val){\n                    if (video.seekable.length > 0) {\n                        video.currentTime = (that.duration * val / 100).toFixed(0);\n                    }\n                    if (video.paused && video.currentTime > 0) {\n                        video.play();\n                    }\n                }\n            });\n\n            this.stream = streamSlider;\n\n            if (o.showStream !== true) {\n                stream.hide();\n            }\n\n            Metro.makePlugin(volumeSlider, \"slider\", {\n                clsMarker: \"bg-red\",\n                clsHint: \"bg-cyan fg-white\",\n                hint: true,\n                value: o.volume * 100,\n                onChangeValue: function(val){\n                    video.volume = val / 100;\n                }\n            });\n\n            this.volume = volumeSlider;\n\n            if (o.showVolume !== true) {\n                volume.hide();\n            }\n\n            var loop;\n\n            if (o.showLoop === true) loop = $(\"<button>\").attr(\"type\", \"button\").addClass(\"button square loop\").html(o.loopIcon).appendTo(controls);\n            if (o.showPlay === true) $(\"<button>\").attr(\"type\", \"button\").addClass(\"button square play\").html(o.playIcon).appendTo(controls);\n            if (o.showStop === true) $(\"<button>\").attr(\"type\", \"button\").addClass(\"button square stop\").html(o.stopIcon).appendTo(controls);\n            if (o.showMute === true) $(\"<button>\").attr(\"type\", \"button\").addClass(\"button square mute\").html(o.muteIcon).appendTo(controls);\n            if (o.showFull === true) $(\"<button>\").attr(\"type\", \"button\").addClass(\"button square full\").html(o.screenMoreIcon).appendTo(controls);\n\n            if (o.loop === true) {\n                loop.addClass(\"active\");\n                element.attr(\"loop\", \"loop\");\n            }\n\n            this._setVolume();\n\n            if (o.muted) {\n                that.volumeBackup = video.volume;\n                Metro.getPlugin(that.volume, 'slider').val(0);\n                video.volume = 0;\n            }\n\n            infoBox.html(\"00:00 / 00:00\");\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element, o = this.options, video = this.elem, player = this.player;\n\n            element.on(\"loadstart\", function(){\n                that.preloader.show();\n            });\n\n            element.on(\"loadedmetadata\", function(){\n                that.duration = video.duration.toFixed(0);\n                that._setInfo(0, that.duration);\n                Utils.exec(o.onMetadata, [video, player], element[0]);\n            });\n\n            element.on(\"canplay\", function(){\n                that._setBuffer();\n                that.preloader.hide();\n            });\n\n            element.on(\"progress\", function(){\n                that._setBuffer();\n            });\n\n            element.on(\"timeupdate\", function(){\n                var position = Math.round(video.currentTime * 100 / that.duration);\n                that._setInfo(video.currentTime, that.duration);\n                Metro.getPlugin(that.stream, 'slider').val(position);\n                Utils.exec(o.onTime, [video.currentTime, that.duration, video, player], element[0]);\n            });\n\n            element.on(\"waiting\", function(){\n                that.preloader.show();\n            });\n\n            element.on(\"loadeddata\", function(){\n\n            });\n\n            element.on(\"play\", function(){\n                player.find(\".play\").html(o.pauseIcon);\n                Utils.exec(o.onPlay, [video, player], element[0]);\n                that._onMouse();\n            });\n\n            element.on(\"pause\", function(){\n                player.find(\".play\").html(o.playIcon);\n                Utils.exec(o.onPause, [video, player], element[0]);\n                that._offMouse();\n            });\n\n            element.on(\"stop\", function(){\n                Metro.getPlugin(that.stream, 'slider').val(0);\n                Utils.exec(o.onStop, [video, player], element[0]);\n                that._offMouse();\n            });\n\n            element.on(\"ended\", function(){\n                Metro.getPlugin(that.stream, 'slider').val(0);\n                Utils.exec(o.onEnd, [video, player], element[0]);\n                that._offMouse();\n            });\n\n            element.on(\"volumechange\", function(){\n                that._setVolume();\n            });\n\n            player.on(Metro.events.click, \".play\", function(){\n                if (video.paused) {\n                    that.play();\n                } else {\n                    that.pause();\n                }\n            });\n\n            player.on(Metro.events.click, \".stop\", function(){\n                that.stop();\n            });\n\n            player.on(Metro.events.click, \".mute\", function(){\n                that._toggleMute();\n            });\n\n            player.on(Metro.events.click, \".loop\", function(){\n                that._toggleLoop();\n            });\n\n            player.on(Metro.events.click, \".full\", function(){\n                that.fullscreen = !that.fullscreen;\n                player.find(\".full\").html(that.fullscreen === true ? o.screenLessIcon : o.screenMoreIcon);\n                if (o.fullScreenMode === Metro.fullScreenMode.WINDOW) {\n                    if (that.fullscreen === true) {\n                        player.addClass(\"full-screen\");\n                    } else {\n                        player.removeClass(\"full-screen\");\n                    }\n                } else {\n                    if (that.fullscreen === true) {\n\n                        Metro.requestFullScreen(video);\n\n                        if (that.fullScreenInterval === false) that.fullScreenInterval = setInterval(function(){\n                            if (Metro.inFullScreen() === false) {\n                                that.fullscreen = false;\n                                clearInterval(that.fullScreenInterval);\n                                that.fullScreenInterval = false;\n                                player.find(\".full\").html(o.screenMoreIcon);\n                            }\n\n                        }, 1000);\n                    } else {\n                        Metro.exitFullScreen();\n                    }\n                }\n\n                // if (that.fullscreen === true) {\n                //     $(document).on(Metro.events.keyup + \".video-player\", function(e){\n                //         if (e.keyCode === 27) {\n                //             player.find(\".full\").click();\n                //         }\n                //     });\n                // } else {\n                //     $(document).off(Metro.events.keyup + \".video-player\");\n                // }\n            });\n\n            $(window).on(Metro.events.keyup, function(e){\n                if (that.fullscreen && e.keyCode === 27) {\n                    player.find(\".full\").click();\n                }\n            }, {ns: this.id});\n\n            $(window).on(Metro.events.resize, function(){\n                that._setAspectRatio();\n            }, {ns: this.id});\n\n        },\n\n        _onMouse: function(){\n            var o = this.options, player = this.player;\n\n            player.on(Metro.events.enter, function(){\n                var controls = player.find(\".controls\");\n                if (o.controlsHide > 0 && controls.style('display') === 'none') {\n                    controls.stop(true).fadeIn(500, function(){\n                        controls.css(\"display\", \"flex\");\n                    });\n                }\n            });\n\n            player.on(Metro.events.leave, function(){\n                var controls = player.find(\".controls\");\n                if (o.controlsHide > 0 && parseInt(controls.style('opacity')) === 1) {\n                    setTimeout(function () {\n                        controls.stop(true).fadeOut(500);\n                    }, o.controlsHide);\n                }\n            });\n        },\n\n        _offMouse: function(){\n            var player = this.player, o = this.options;\n            var controls = player.find(\".controls\");\n\n            player.off(Metro.events.enter);\n            player.off(Metro.events.leave);\n\n            if (o.controlsHide > 0 && controls.style('display') === 'none') {\n                controls.stop(true).fadeIn(500, function(){\n                    controls.css(\"display\", \"flex\");\n                });\n            }\n        },\n\n        _toggleLoop: function(){\n            var loop = this.player.find(\".loop\");\n            if (loop.length === 0) return ;\n            loop.toggleClass(\"active\");\n            if (loop.hasClass(\"active\")) {\n                this.element.attr(\"loop\", \"loop\");\n            } else {\n                this.element.removeAttr(\"loop\");\n            }\n        },\n\n        _toggleMute: function(){\n            this.muted = !this.muted;\n            if (this.muted === false) {\n                this.video.volume = this.volumeBackup;\n            } else {\n                this.volumeBackup = this.video.volume;\n                this.video.volume = 0;\n            }\n            Metro.getPlugin(this.volume, 'slider').val(this.muted === false ? this.volumeBackup * 100 : 0);\n        },\n\n        _setInfo: function(a, b){\n            this.player.find(\".info-box\").html(Utils.secondsToFormattedString(Math.round(a)) + \" / \" + Utils.secondsToFormattedString(Math.round(b)));\n        },\n\n        _setBuffer: function(){\n            var buffer = this.video.buffered.length ? Math.round(Math.floor(this.video.buffered.end(0)) / Math.floor(this.video.duration) * 100) : 0;\n            Metro.getPlugin(this.stream, 'slider').buff(buffer);\n        },\n\n        _setVolume: function(){\n            var video = this.video, player = this.player, o = this.options;\n\n            var volumeButton = player.find(\".mute\");\n            var volume = video.volume * 100;\n            if (volume > 1 && volume < 30) {\n                volumeButton.html(o.volumeLowIcon);\n            } else if (volume >= 30 && volume < 60) {\n                volumeButton.html(o.volumeMediumIcon);\n            } else if (volume >= 60 && volume <= 100) {\n                volumeButton.html(o.volumeHighIcon);\n            } else {\n                volumeButton.html(o.muteIcon);\n            }\n        },\n\n        _setAspectRatio: function(){\n            var player = this.player, o = this.options;\n            var width = player.outerWidth();\n            var height;\n\n            switch (o.aspectRatio) {\n                case Metro.aspectRatio.SD: height = Utils.aspectRatioH(width, \"4/3\"); break;\n                case Metro.aspectRatio.CINEMA: height = Utils.aspectRatioH(width, \"21/9\"); break;\n                default: height = Utils.aspectRatioH(width, \"16/9\");\n            }\n\n            player.outerHeight(height);\n        },\n\n        aspectRatio: function(ratio){\n            this.options.aspectRatio = ratio;\n            this._setAspectRatio();\n        },\n\n        play: function(src){\n            if (src !== undefined) {\n                this._setSource(src);\n            }\n\n            if (this.element.attr(\"src\") === undefined && this.element.find(\"source\").length === 0) {\n                return ;\n            }\n\n            this.isPlaying = true;\n\n            this.video.play();\n        },\n\n        pause: function(){\n            this.isPlaying = false;\n            this.video.pause();\n        },\n\n        resume: function(){\n            if (this.video.paused) {\n                this.play();\n            }\n        },\n\n        stop: function(){\n            this.isPlaying = false;\n            this.video.pause();\n            this.video.currentTime = 0;\n            Metro.getPlugin(this.stream, 'slider').val(0);\n            this._offMouse();\n        },\n\n        setVolume: function(v){\n            if (v === undefined) {\n                return this.video.volume;\n            }\n\n            if (v > 1) {\n                v /= 100;\n            }\n\n            this.video.volume = v;\n            Metro.getPlugin(this.volume[0], 'slider').val(v*100);\n        },\n\n        loop: function(){\n            this._toggleLoop();\n        },\n\n        mute: function(){\n            this._toggleMute();\n        },\n\n        changeAspectRatio: function(){\n            this.options.aspectRatio = this.element.attr(\"data-aspect-ratio\");\n            this._setAspectRatio();\n        },\n\n        changeSource: function(){\n            var src = JSON.parse(this.element.attr('data-src'));\n            this.play(src);\n        },\n\n        changeVolume: function(){\n            var volume = this.element.attr(\"data-volume\");\n            this.setVolume(volume);\n        },\n\n        changeAttribute: function(attributeName){\n            switch (attributeName) {\n                case \"data-aspect-ratio\": this.changeAspectRatio(); break;\n                case \"data-src\": this.changeSource(); break;\n                case \"data-volume\": this.changeVolume(); break;\n            }\n        },\n\n        destroy: function(){\n            var element = this.element, player = this.player;\n\n            Metro.getPlugin(this.stream, \"slider\").destroy();\n            Metro.getPlugin(this.volume, \"slider\").destroy();\n\n            element.off(\"loadstart\");\n            element.off(\"loadedmetadata\");\n            element.off(\"canplay\");\n            element.off(\"progress\");\n            element.off(\"timeupdate\");\n            element.off(\"waiting\");\n            element.off(\"loadeddata\");\n            element.off(\"play\");\n            element.off(\"pause\");\n            element.off(\"stop\");\n            element.off(\"ended\");\n            element.off(\"volumechange\");\n\n            player.off(Metro.events.click, \".play\");\n            player.off(Metro.events.click, \".stop\");\n            player.off(Metro.events.click, \".mute\");\n            player.off(Metro.events.click, \".loop\");\n            player.off(Metro.events.click, \".full\");\n\n            $(window).off(Metro.events.keyup,{ns: this.id});\n            $(window).off(Metro.events.resize,{ns: this.id});\n\n            return element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n\n    var Utils = Metro.utils;\n    var ViewportCheckDefaultConfig = {\n        onViewport: Metro.noop,\n        onViewportEnter: Metro.noop,\n        onViewportLeave: Metro.noop,\n        onViewportCheckCreate: Metro.noop\n    };\n\n    Metro.viewportCheckSetup = function (options) {\n        ViewportCheckDefaultConfig = $.extend({}, ViewportCheckDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroViewportCheckSetup\"] !== undefined) {\n        Metro.viewportCheckSetup(window[\"metroViewportCheckSetup\"]);\n    }\n\n    Metro.Component('viewport-check', {\n        init: function( options, elem ) {\n            this._super(elem, options, ViewportCheckDefaultConfig, {\n                // define instance vars here\n                inViewport: false,\n                id: Utils.elementId(\"viewport-check\")\n            });\n            return this;\n        },\n\n        _create: function(){\n            this.inViewport = Utils.inViewport(this.elem);\n\n            this._createEvents();\n\n            this._fireEvent('viewport-check-create');\n        },\n\n        _createEvents: function(){\n            var that = this, elem = this.elem;\n\n            $(window).on(Metro.events.scroll, function(){\n                var oldState = that.inViewport;\n\n                that.inViewport = Utils.inViewport(elem);\n\n                if (oldState !== that.inViewport) {\n                    if (that.inViewport) {\n                        that._fireEvent(\"viewport-enter\");\n                    } else {\n                        that._fireEvent(\"viewport-leave\");\n                    }\n                }\n\n                that._fireEvent(\"viewport\", {\n                    state: that.inViewport\n                });\n            }, {ns: that.id});\n        },\n\n        state: function(){\n            return this.inViewport;\n        },\n\n        destroy: function(){\n            $(window).off(Metro.events.scroll, {ns: this.id});\n\n            return this.element;\n        }\n    });\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var WindowDefaultConfig = {\n        windowDeferred: 0,\n        hidden: false,\n        width: \"auto\",\n        height: \"auto\",\n        btnClose: true,\n        btnMin: true,\n        btnMax: true,\n        draggable: true,\n        dragElement: \".window-caption .icon, .window-caption .title\",\n        dragArea: \"parent\",\n        shadow: false,\n        icon: \"\",\n        title: \"Window\",\n        content: null,\n        resizable: true,\n        overlay: false,\n        overlayColor: 'transparent',\n        overlayAlpha: .5,\n        modal: false,\n        position: \"absolute\",\n        checkEmbed: true,\n        top: \"auto\",\n        left: \"auto\",\n        place: \"auto\",\n        closeAction: Metro.actions.REMOVE,\n        customButtons: null,\n\n        clsCustomButton: \"\",\n        clsCaption: \"\",\n        clsContent: \"\",\n        clsWindow: \"\",\n\n        _runtime: false,\n\n        minWidth: 0,\n        minHeight: 0,\n        maxWidth: 0,\n        maxHeight: 0,\n        onDragStart: Metro.noop,\n        onDragStop: Metro.noop,\n        onDragMove: Metro.noop,\n        onCaptionDblClick: Metro.noop,\n        onCloseClick: Metro.noop,\n        onMaxClick: Metro.noop,\n        onMinClick: Metro.noop,\n        onResizeStart: Metro.noop,\n        onResizeStop: Metro.noop,\n        onResize: Metro.noop,\n        onWindowCreate: Metro.noop,\n        onShow: Metro.noop,\n        onWindowDestroy: Metro.noop,\n        onCanClose: Metro.noop_true,\n        onClose: Metro.noop\n    };\n\n    Metro.windowSetup = function (options) {\n        WindowDefaultConfig = $.extend({}, WindowDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroWindowSetup\"] !== undefined) {\n        Metro.windowSetup(window[\"metroWindowSetup\"]);\n    }\n\n    Metro.Component('window', {\n        init: function( options, elem ) {\n            this._super(elem, options, WindowDefaultConfig, {\n                win: null,\n                overlay: null,\n                position: {\n                    top: 0,\n                    left: 0\n                },\n                hidden: false,\n                content: null\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var that = this, element = this.element, o = this.options;\n            var win, overlay;\n            var parent = o.dragArea === \"parent\" ? element.parent() : $(o.dragArea);\n            var _content;\n\n            if (o.modal === true) {\n                o.btnMax = false;\n                o.btnMin = false;\n                o.resizable = false;\n            }\n\n            if (Utils.isNull(o.content)) {\n                o.content = element;\n            } else {\n                if (Utils.isUrl(o.content) && Utils.isVideoUrl(o.content)) {\n                    o.content = Utils.embedUrl(o.content);\n                    element.css({\n                        height: \"100%\"\n                    });\n                } else\n\n                if (!Utils.isQ(o.content) && Utils.isFunc(o.content)) {\n                    o.content = Utils.exec(o.content);\n                }\n\n                _content = $(o.content);\n                if (_content.length === 0) {\n                    element.appendText(o.content);\n                } else {\n                    element.append(_content);\n                }\n                o.content = element;\n            }\n\n            if (o._runtime === true) {\n                this._runtime(element, \"window\");\n            }\n\n            win = this._window(o);\n            win.addClass(\"no-visible\");\n\n            parent.append(win);\n\n            if (o.overlay === true) {\n                overlay = this._overlay();\n                overlay.appendTo(win.parent());\n                this.overlay = overlay;\n            }\n\n            this.win = win;\n\n            this._fireEvent(\"window-create\", {\n                win: this.win[0],\n                element: element\n            });\n\n            setTimeout(function(){\n                that._setPosition();\n\n                if (o.hidden !== true) {\n                    that.win.removeClass(\"no-visible\");\n                }\n\n                that._fireEvent(\"show\", {\n                    win: that.win[0],\n                    element: element\n                });\n            }, 100);\n        },\n\n        _setPosition: function(){\n            var o = this.options;\n            var win = this.win;\n            var parent = o.dragArea === \"parent\" ? win.parent() : $(o.dragArea);\n            var top_center = parent.height() / 2 - win[0].offsetHeight / 2;\n            var left_center = parent.width() / 2 - win[0].offsetWidth / 2;\n            var top, left, right, bottom;\n\n            if (o.place !== 'auto') {\n\n                switch (o.place.toLowerCase()) {\n                    case \"top-left\": top = 0; left = 0; right = \"auto\"; bottom = \"auto\"; break;\n                    case \"top-center\": top = 0; left = left_center; right = \"auto\"; bottom = \"auto\"; break;\n                    case \"top-right\": top = 0; right = 0; left = \"auto\"; bottom = \"auto\"; break;\n                    case \"right-center\": top = top_center; right = 0; left = \"auto\"; bottom = \"auto\"; break;\n                    case \"bottom-right\": bottom = 0; right = 0; left = \"auto\"; top = \"auto\"; break;\n                    case \"bottom-center\": bottom = 0; left = left_center; right = \"auto\"; top = \"auto\"; break;\n                    case \"bottom-left\": bottom = 0; left = 0; right = \"auto\"; top = \"auto\"; break;\n                    case \"left-center\": top = top_center; left = 0; right = \"auto\"; bottom = \"auto\"; break;\n                    default: top = top_center; left = left_center; bottom = \"auto\"; right = \"auto\";\n                }\n\n                win.css({\n                    top: top,\n                    left: left,\n                    bottom: bottom,\n                    right: right\n                });\n            }\n        },\n\n        _window: function(o){\n            var that = this;\n            var win, caption, content, icon, title, buttons, btnClose, btnMin, btnMax, resizer, status;\n            var width = o.width, height = o.height;\n\n            win = $(\"<div>\").addClass(\"window\");\n\n            if (o.modal === true) {\n                win.addClass(\"modal\");\n            }\n\n            caption = $(\"<div>\").addClass(\"window-caption\");\n            content = $(\"<div>\").addClass(\"window-content\");\n\n            win.append(caption);\n            win.append(content);\n\n            if (o.status === true) {\n                status = $(\"<div>\").addClass(\"window-status\");\n                win.append(status);\n            }\n\n            if (o.shadow === true) {\n                win.addClass(\"win-shadow\");\n            }\n\n            if (Utils.isValue(o.icon)) {\n                icon = $(\"<span>\").addClass(\"icon\").html(o.icon);\n                icon.appendTo(caption);\n            }\n\n            title = $(\"<span>\").addClass(\"title\").html(Utils.isValue(o.title) ? o.title : \"&nbsp;\");\n            title.appendTo(caption);\n\n            if (!Utils.isNull(o.content)) {\n                if (Utils.isQ(o.content)) {\n                    o.content.appendTo(content);\n                } else {\n                    content.html(o.content);\n                }\n            }\n\n            buttons = $(\"<div>\").addClass(\"buttons\");\n            buttons.appendTo(caption);\n\n            if (o.btnMax === true) {\n                btnMax = $(\"<span>\").addClass(\"button btn-max sys-button\");\n                btnMax.appendTo(buttons);\n            }\n\n            if (o.btnMin === true) {\n                btnMin = $(\"<span>\").addClass(\"button btn-min sys-button\");\n                btnMin.appendTo(buttons);\n            }\n\n            if (o.btnClose === true) {\n                btnClose = $(\"<span>\").addClass(\"button btn-close sys-button\");\n                btnClose.appendTo(buttons);\n            }\n\n            if (Utils.isValue(o.customButtons)) {\n                var customButtons = [];\n\n                if (Utils.isObject(o.customButtons) !== false) {\n                    o.customButtons = Utils.isObject(o.customButtons);\n                }\n\n                if (typeof o.customButtons === \"string\" && o.customButtons.indexOf(\"{\") > -1) {\n                    customButtons = JSON.parse(o.customButtons);\n                } else if (typeof o.customButtons === \"object\" && Utils.objectLength(o.customButtons) > 0) {\n                    customButtons = o.customButtons;\n                } else {\n                    console.warn(\"Unknown format for custom buttons\");\n                }\n\n                $.each(customButtons, function(){\n                    var item = this;\n                    var customButton = $(\"<span>\");\n\n                    customButton\n                        .addClass(\"button btn-custom\")\n                        .addClass(o.clsCustomButton)\n                        .addClass(item.cls)\n                        .attr(\"tabindex\", -1)\n                        .html(item.html);\n\n                    if (item.attr && typeof item.attr === 'object') {\n                        $.each(item.attr, function(k, v){\n                            customButton.attr(Cake.dashedName(k), v);\n                        });\n                    }\n\n                    customButton.data(\"action\", item.onclick);\n\n                    buttons.prepend(customButton);\n                });\n            }\n\n            caption.on(Metro.events.stop, \".btn-custom\", function(e){\n                if (Utils.isRightMouse(e)) return;\n                var button = $(this);\n                var action = button.data(\"action\");\n                Utils.exec(action, [button], this);\n            });\n\n            win.attr(\"id\", o.id === undefined ? Utils.elementId(\"window\") : o.id);\n\n            win.on(Metro.events.dblclick, \".window-caption\", function(e){\n                that.maximized(e);\n            });\n\n            caption.on(Metro.events.click, \".btn-max, .btn-min, .btn-close\", function(e){\n                if (Utils.isRightMouse(e)) return;\n                var target = $(e.target);\n                if (target.hasClass(\"btn-max\")) that.maximized(e);\n                if (target.hasClass(\"btn-min\")) that.minimized(e);\n                if (target.hasClass(\"btn-close\")) that.close(e);\n            });\n\n            if (o.draggable === true) {\n                Metro.makePlugin(win, \"draggable\", {\n                    dragContext: win[0],\n                    dragElement: o.dragElement,\n                    dragArea: o.dragArea,\n                    onDragStart: o.onDragStart,\n                    onDragStop: o.onDragStop,\n                    onDragMove: o.onDragMove\n                });\n            }\n\n            win.addClass(o.clsWindow);\n            caption.addClass(o.clsCaption);\n            content.addClass(o.clsContent);\n\n            if (o.minWidth === 0) {\n                o.minWidth = 34;\n                $.each(buttons.children(\".btn-custom\"), function(){\n                    o.minWidth += Utils.hiddenElementSize(this).width;\n                });\n                if (o.btnMax) o.minWidth += 34;\n                if (o.btnMin) o.minWidth += 34;\n                if (o.btnClose) o.minWidth += 34;\n            }\n\n            if (o.minWidth > 0 && !isNaN(o.width) && o.width < o.minWidth) {\n                width = o.minWidth;\n            }\n            if (o.minHeight > 0 && !isNaN(o.height) && o.height > o.minHeight) {\n                height = o.minHeight;\n            }\n\n            if (o.resizable === true) {\n                resizer = $(\"<span>\").addClass(\"resize-element\");\n                resizer.appendTo(win);\n                win.addClass(\"resizable\");\n\n                Metro.makePlugin(win, \"resizable\", {\n                    minWidth: o.minWidth,\n                    minHeight: o.minHeight,\n                    maxWidth: o.maxWidth,\n                    maxHeight: o.maxHeight,\n                    resizeElement: \".resize-element\",\n                    onResizeStart: o.onResizeStart,\n                    onResizeStop: o.onResizeStop,\n                    onResize: o.onResize\n                });\n            }\n\n            win.css({\n                width: width,\n                height: height,\n                position: o.position,\n                top: o.top,\n                left: o.left\n            });\n\n            return win;\n        },\n\n        _overlay: function(){\n            var o = this.options;\n\n            var overlay = $(\"<div>\");\n            overlay.addClass(\"overlay\");\n\n            if (o.overlayColor === 'transparent') {\n                overlay.addClass(\"transparent\");\n            } else {\n                overlay.css({\n                    background: Metro.colors.toRGBA(o.overlayColor, o.overlayAlpha)\n                });\n            }\n\n            return overlay;\n        },\n\n        width: function(v){\n            var win = this.win;\n\n            if (!Utils.isValue(v)) {\n                return win.width();\n            }\n\n            win.css(\"width\", parseInt(v));\n\n            return this;\n        },\n\n        height: function(v){\n            var win = this.win;\n\n            if (!Utils.isValue(v)) {\n                return win.height();\n            }\n\n            win.css(\"height\", parseInt(v));\n\n            return this;\n        },\n\n        maximized: function(e){\n            var win = this.win, o = this.options;\n            var target = $(e.target);\n\n            if (o.btnMax) {\n                win.removeClass(\"minimized\");\n                win.toggleClass(\"maximized\");\n            }\n\n            if (target.hasClass && target.hasClass(\"title\")) {\n\n                this._fireEvent(\"caption-dbl-click\", {\n                    win: win[0]\n                });\n\n            } else {\n\n                this._fireEvent(\"max-click\", {\n                    win: win[0]\n                });\n\n            }\n        },\n\n        minimized: function(){\n            var win = this.win, o = this.options;\n\n            if (o.btnMin) {\n                win.removeClass(\"maximized\");\n                win.toggleClass(\"minimized\");\n            }\n\n            this._fireEvent(\"min-click\", {\n                win: win[0]\n            });\n        },\n\n        close: function(){\n            var that = this, win = this.win,  o = this.options;\n\n            if (Utils.exec(o.onCanClose, [win]) === false) {\n                return false;\n            }\n\n            var timeout = 0;\n\n            if (o.onClose !== Metro.noop) {\n                timeout = 500;\n            }\n\n            this._fireEvent(\"close\", {\n                win: win[0]\n            });\n\n            setTimeout(function(){\n                if (o.modal === true) {\n                    win.siblings(\".overlay\").remove();\n                }\n\n                that._fireEvent(\"close-click\", {\n                    win: win[0]\n                });\n\n                if (o.closeAction === Metro.actions.REMOVE) {\n                    that._fireEvent(\"window-destroy\", {\n                        win: win[0]\n                    });\n                    win.remove();\n                } else {\n                    that.hide();\n                }\n\n            }, timeout);\n        },\n\n        hide: function(){\n            var win = this.win;\n\n            win.css({\n                display: \"none\"\n            });\n\n            this._fireEvent(\"hide\", {\n                win: win[0]\n            });\n        },\n\n        show: function(){\n            var win = this.win;\n\n            win\n                .removeClass(\"no-visible\")\n                .css({\n                    display: \"flex\"\n                });\n\n            this._fireEvent(\"show\", {\n                win: win[0]\n            });\n\n        },\n\n        toggle: function(){\n            if (this.win.css(\"display\") === \"none\" || this.win.hasClass(\"no-visible\")) {\n                this.show();\n            } else {\n                this.hide();\n            }\n        },\n\n        isOpen: function(){\n            return this.win.hasClass(\"no-visible\");\n        },\n\n        min: function(a){\n            a ? this.win.addClass(\"minimized\") : this.win.removeClass(\"minimized\");\n        },\n\n        max: function(a){\n            a ? this.win.addClass(\"maximized\") : this.win.removeClass(\"maximized\");\n        },\n\n        changeClass: function(a){\n            var element = this.element, win = this.win, o = this.options;\n\n            if (a === \"data-cls-window\") {\n                win[0].className = \"window \" + (o.resizable ? \" resizable \" : \" \") + element.attr(\"data-cls-window\");\n            }\n            if (a === \"data-cls-caption\") {\n                win.find(\".window-caption\")[0].className = \"window-caption \" + element.attr(\"data-cls-caption\");\n            }\n            if (a === \"data-cls-content\") {\n                win.find(\".window-content\")[0].className = \"window-content \" + element.attr(\"data-cls-content\");\n            }\n        },\n\n        toggleShadow: function(){\n            var element = this.element, win = this.win;\n            var flag = JSON.parse(element.attr(\"data-shadow\"));\n            if (flag === true) {\n                win.addClass(\"win-shadow\");\n            } else {\n                win.removeClass(\"win-shadow\");\n            }\n        },\n\n        setContent: function(c){\n            var element = this.element, win = this.win;\n            var content = Utils.isValue(c) ? c : element.attr(\"data-content\");\n            var result;\n\n            if (!Utils.isQ(content) && Utils.isFunc(content)) {\n                result = Utils.exec(content);\n            } else if (Utils.isQ(content)) {\n                result = content.html();\n            } else {\n                result = content;\n            }\n\n            win.find(\".window-content\").html(result);\n        },\n\n        setTitle: function(t){\n            var element = this.element, win = this.win;\n            var title = Utils.isValue(t) ? t : element.attr(\"data-title\");\n            win.find(\".window-caption .title\").html(title);\n        },\n\n        setIcon: function(i){\n            var element = this.element, win = this.win;\n            var icon = Utils.isValue(i) ? i : element.attr(\"data-icon\");\n            win.find(\".window-caption .icon\").html(icon);\n        },\n\n        getIcon: function(){\n            return this.win.find(\".window-caption .icon\").html();\n        },\n\n        getTitle: function(){\n            return this.win.find(\".window-caption .title\").html();\n        },\n\n        toggleDraggable: function(f){\n            var win = this.win;\n            var flag = Utils.bool(f);\n            var drag = Metro.getPlugin(win, \"draggable\");\n            if (flag === true) {\n                drag.on();\n            } else {\n                drag.off();\n            }\n        },\n\n        toggleResizable: function(f){\n            var win = this.win;\n            var flag = Utils.bool(f);\n            var resize = Metro.getPlugin(win, \"resizable\");\n            if (flag === true) {\n                resize.on();\n                win.find(\".resize-element\").removeClass(\"resize-element-disabled\");\n            } else {\n                resize.off();\n                win.find(\".resize-element\").addClass(\"resize-element-disabled\");\n            }\n        },\n\n        changePlace: function (p) {\n            var element = this.element, win = this.win;\n            var place = Utils.isValue(p) ? p : element.attr(\"data-place\");\n            win.addClass(place);\n        },\n\n        pos: function(top, left){\n            var win = this.win;\n            win.css({\n                top: top,\n                left: left\n            });\n            return this;\n        },\n\n        top: function(v){\n            this.win.css({\n                top: v\n            });\n            return this;\n        },\n\n        left: function(v){\n            this.win.css({\n                left: v\n            });\n            return this;\n        },\n\n        changeAttribute: function(attr, value){\n            var changePos = function(a, v){\n                var win = this.win;\n                var pos;\n                if (a === \"data-top\") {\n                    pos = parseInt(v);\n                    if (!isNaN(pos)) {\n                        return ;\n                    }\n                    win.css(\"top\", pos);\n                }\n                if (a === \"data-left\") {\n                    pos = parseInt(v);\n                    if (!isNaN(pos)) {\n                        return ;\n                    }\n                    win.css(\"left\", pos);\n                }\n            };\n\n            var toggleButtons = function(a, v) {\n                var win = this.win;\n                var btnClose = win.find(\".btn-close\");\n                var btnMin = win.find(\".btn-min\");\n                var btnMax = win.find(\".btn-max\");\n                var _v = Utils.bool(v);\n                var func = _v ? \"show\" : \"hide\";\n\n                switch (a) {\n                    case \"data-btn-close\": btnClose[func](); break;\n                    case \"data-btn-min\": btnMin[func](); break;\n                    case \"data-btn-max\": btnMax[func](); break;\n                }\n            };\n\n            var changeSize = function(a, v){\n                var win = this.win;\n                if (a === \"data-width\") {\n                    win.css(\"width\", +v);\n                }\n                if (a === \"data-height\") {\n                    win.css(\"height\", +v);\n                }\n            };\n\n            switch (attr) {\n                case \"data-btn-close\":\n                case \"data-btn-min\":\n                case \"data-btn-max\": toggleButtons(attr, value); break;\n                case \"data-width\":\n                case \"data-height\": changeSize(attr, value); break;\n                case \"data-cls-window\":\n                case \"data-cls-caption\":\n                case \"data-cls-content\": this.changeClass(attr); break;\n                case \"data-shadow\": this.toggleShadow(); break;\n                case \"data-icon\": this.setIcon(); break;\n                case \"data-title\": this.setTitle(); break;\n                case \"data-content\": this.setContent(); break;\n                case \"data-draggable\": this.toggleDraggable(value); break;\n                case \"data-resizable\": this.toggleResizable(value); break;\n                case \"data-top\":\n                case \"data-left\": changePos(attr, value); break;\n                case \"data-place\": this.changePlace(); break;\n            }\n        },\n\n        destroy: function(){\n            return this.element;\n        }\n    });\n\n    Metro['window'] = {\n\n        isWindow: function(el){\n            return Utils.isMetroObject(el, \"window\");\n        },\n\n        min: function(el, a){\n            if (!this.isWindow(el)) {\n                return false;\n            }\n            Metro.getPlugin(el,\"window\").min(a);\n        },\n\n        max: function(el, a){\n            if (!this.isWindow(el)) {\n                return false;\n            }\n            Metro.getPlugin(el, \"window\").max(a);\n        },\n\n        show: function(el){\n            if (!this.isWindow(el)) {\n                return false;\n            }\n            Metro.getPlugin(el, \"window\").show();\n        },\n\n        hide: function(el){\n            if (!this.isWindow(el)) {\n                return false;\n            }\n            Metro.getPlugin(el, \"window\").hide();\n        },\n\n        toggle: function(el){\n            if (!this.isWindow(el)) {\n                return false;\n            }\n            Metro.getPlugin(el, \"window\").toggle();\n        },\n\n        isOpen: function(el){\n            if (!this.isWindow(el)) {\n                return false;\n            }\n            var win = Metro.getPlugin(el,\"window\");\n            return win.isOpen();\n        },\n\n        close: function(el){\n            if (!this.isWindow(el)) {\n                return false;\n            }\n            Metro.getPlugin(el, \"window\").close();\n        },\n\n        pos: function(el, top, left){\n            if (!this.isWindow(el)) {\n                return false;\n            }\n            Metro.getPlugin(el, \"window\").pos(top, left);\n        },\n\n        top: function(el, top){\n            if (!this.isWindow(el)) {\n                return false;\n            }\n            Metro.getPlugin(el, \"window\").top(top);\n        },\n\n        left: function(el, left){\n            if (!this.isWindow(el)) {\n                return false;\n            }\n            Metro.getPlugin(el, \"window\").left(left);\n        },\n\n        width: function(el, width){\n            if (!this.isWindow(el)) {\n                return false;\n            }\n            Metro.getPlugin(el, \"window\").width(width);\n        },\n\n        height: function(el, height){\n            if (!this.isWindow(el)) {\n                return false;\n            }\n            Metro.getPlugin(el, \"window\").height(height);\n        },\n\n        create: function(options, parent){\n            var w;\n\n            w = $(\"<div>\").appendTo(parent ? $(parent) : $(\"body\"));\n\n            var w_options = $.extend({\n                _runtime: true\n            }, (options ? options : {}));\n\n            return Metro.makePlugin(w, \"window\", w_options);\n        }\n    };\n}(Metro, m4q));\r\n\r\n(function(Metro, $) {\n    'use strict';\n    var Utils = Metro.utils;\n    var WizardDefaultConfig = {\n        wizardDeferred: 0,\n        start: 1,\n        finish: 0,\n        iconHelp: \"<span class='default-icon-help'></span>\",\n        iconPrev: \"<span class='default-icon-left-arrow'></span>\",\n        iconNext: \"<span class='default-icon-right-arrow'></span>\",\n        iconFinish: \"<span class='default-icon-check'></span>\",\n\n        buttonMode: \"cycle\", // default, cycle, square\n        buttonOutline: true,\n        duration: 300,\n\n        clsWizard: \"\",\n        clsActions: \"\",\n        clsHelp: \"\",\n        clsPrev: \"\",\n        clsNext: \"\",\n        clsFinish: \"\",\n\n        onPage: Metro.noop,\n        onNextPage: Metro.noop,\n        onPrevPage: Metro.noop,\n        onFirstPage: Metro.noop,\n        onLastPage: Metro.noop,\n        onFinishPage: Metro.noop,\n        onHelpClick: Metro.noop,\n        onPrevClick: Metro.noop,\n        onNextClick: Metro.noop,\n        onFinishClick: Metro.noop,\n        onBeforePrev: Metro.noop_true,\n        onBeforeNext: Metro.noop_true,\n        onWizardCreate: Metro.noop\n    };\n\n    Metro.wizardSetup = function (options) {\n        WizardDefaultConfig = $.extend({}, WizardDefaultConfig, options);\n    };\n\n    if (typeof window[\"metroWizardSetup\"] !== undefined) {\n        Metro.wizardSetup(window[\"metroWizardSetup\"]);\n    }\n\n    Metro.Component('wizard', {\n        init: function( options, elem ) {\n            this._super(elem, options, WizardDefaultConfig, {\n                id: Utils.elementId('wizard')\n            });\n\n            return this;\n        },\n\n        _create: function(){\n            var element = this.element;\n\n            this._createWizard();\n            this._createEvents();\n\n            this._fireEvent(\"wizard-create\", {\n                element: element\n            });\n        },\n\n        _createWizard: function(){\n            var element = this.element, o = this.options;\n            var bar;\n\n            element.addClass(\"wizard\").addClass(o.view).addClass(o.clsWizard);\n\n            bar = $(\"<div>\").addClass(\"action-bar\").addClass(o.clsActions).appendTo(element);\n\n            var buttonMode = o.buttonMode === \"button\" ? \"\" : o.buttonMode;\n            if (o.buttonOutline === true) {\n                buttonMode += \" outline\";\n            }\n\n            if (o.iconHelp !== false) $(\"<button>\").attr(\"type\", \"button\").addClass(\"button wizard-btn-help\").addClass(buttonMode).addClass(o.clsHelp).html(Utils.isTag(o.iconHelp) ? o.iconHelp : $(\"<img>\").attr('src', o.iconHelp)).appendTo(bar);\n            if (o.iconPrev !== false) $(\"<button>\").attr(\"type\", \"button\").addClass(\"button wizard-btn-prev\").addClass(buttonMode).addClass(o.clsPrev).html(Utils.isTag(o.iconPrev) ? o.iconPrev : $(\"<img>\").attr('src', o.iconPrev)).appendTo(bar);\n            if (o.iconNext !== false) $(\"<button>\").attr(\"type\", \"button\").addClass(\"button wizard-btn-next\").addClass(buttonMode).addClass(o.clsNext).html(Utils.isTag(o.iconNext) ? o.iconNext : $(\"<img>\").attr('src', o.iconNext)).appendTo(bar);\n            if (o.iconFinish !== false) $(\"<button>\").attr(\"type\", \"button\").addClass(\"button wizard-btn-finish\").addClass(buttonMode).addClass(o.clsFinish).html(Utils.isTag(o.iconFinish) ? o.iconFinish : $(\"<img>\").attr('src', o.iconFinish)).appendTo(bar);\n\n            this.toPage(o.start);\n\n            this._setHeight();\n        },\n\n        _setHeight: function(){\n            var element = this.element;\n            var pages = element.children(\"section\");\n            var max_height = 0;\n\n            pages.children(\".page-content\").css(\"max-height\", \"none\");\n\n            $.each(pages, function(){\n                var h = $(this).height();\n                if (max_height < parseInt(h)) {\n                    max_height = h;\n                }\n            });\n\n            element.height(max_height);\n        },\n\n        _createEvents: function(){\n            var that = this, element = this.element;\n\n            element.on(Metro.events.click, \".wizard-btn-help\", function(){\n                var pages = element.children(\"section\");\n                var page = pages.get(that.current - 1);\n\n                that._fireEvent(\"help-click\", {\n                    index: that.current,\n                    page: page\n                });\n            });\n\n            element.on(Metro.events.click, \".wizard-btn-prev\", function(){\n                that.prev();\n                var pages = element.children(\"section\");\n                var page = pages.get(that.current - 1);\n\n                that._fireEvent(\"prev-click\", {\n                    index: that.current,\n                    page: page\n                });\n            });\n\n            element.on(Metro.events.click, \".wizard-btn-next\", function(){\n                that.next();\n                var pages = element.children(\"section\");\n                var page = pages.get(that.current - 1);\n\n                that._fireEvent(\"next-click\", {\n                    index: that.current,\n                    page: page\n                });\n            });\n\n            element.on(Metro.events.click, \".wizard-btn-finish\", function(){\n                var pages = element.children(\"section\");\n                var page = pages.get(that.current - 1);\n\n                that._fireEvent(\"finish-click\", {\n                    index: that.current,\n                    page: page\n                });\n            });\n\n            element.on(Metro.events.click, \".complete\", function(){\n                var index = $(this).index() + 1;\n                that.toPage(index);\n            });\n\n            $(window).on(Metro.events.resize, function(){\n                that._setHeight();\n            }, {ns: this.id});\n        },\n\n        next: function(){\n            var that = this, element = this.element, o = this.options;\n            var pages = element.children(\"section\");\n            var page = $(element.children(\"section\").get(this.current - 1));\n\n            if (this.current + 1 > pages.length || Utils.exec(o.onBeforeNext, [this.current, page, element]) === false) {\n                return ;\n            }\n\n            this.current++;\n\n            this.toPage(this.current);\n\n            page = $(element.children(\"section\").get(this.current - 1));\n\n            this._fireEvent(\"next-page\", {\n                index: that.current,\n                page: page[0]\n            });\n        },\n\n        prev: function(){\n            var that = this, element = this.element, o = this.options;\n            var page = $(element.children(\"section\").get(this.current - 1));\n\n            if (this.current - 1 === 0 || Utils.exec(o.onBeforePrev, [this.current, page, element]) === false) {\n                return ;\n            }\n\n            this.current--;\n\n            this.toPage(this.current);\n\n            page = $(element.children(\"section\").get(this.current - 1));\n\n            this._fireEvent(\"prev-page\", {\n                index: that.current,\n                page: page[0]\n            });\n        },\n\n        last: function(){\n            var that = this, element = this.element;\n            var page;\n\n            this.toPage(element.children(\"section\").length);\n\n            page = $(element.children(\"section\").get(this.current - 1));\n\n            this._fireEvent(\"last-page\", {\n                index: that.current,\n                page: page[0]\n            });\n        },\n\n        first: function(){\n            var that = this, element = this.element;\n            var page;\n\n            this.toPage(1);\n\n            page = $(element.children(\"section\").get(0));\n\n            this._fireEvent(\"first-page\", {\n                index: that.current,\n                page: page[0]\n            });\n        },\n\n        toPage: function(page){\n            var element = this.element, o = this.options;\n            var target = $(element.children(\"section\").get(page - 1));\n            var sections = element.children(\"section\");\n            var actions = element.find(\".action-bar\");\n\n            if (target.length === 0) {\n                return ;\n            }\n\n            var finish = element.find(\".wizard-btn-finish\").addClass(\"disabled\");\n            var next = element.find(\".wizard-btn-next\").addClass(\"disabled\");\n            var prev = element.find(\".wizard-btn-prev\").addClass(\"disabled\");\n\n            this.current = page;\n\n            element.children(\"section\")\n                .removeClass(\"complete current\")\n                .removeClass(o.clsCurrent)\n                .removeClass(o.clsComplete);\n\n            target.addClass(\"current\").addClass(o.clsCurrent);\n            target.prevAll().addClass(\"complete\").addClass(o.clsComplete);\n\n            var border_size = element.children(\"section.complete\").length === 0 ? 0 : parseInt(Utils.getStyleOne(element.children(\"section.complete\")[0], \"border-left-width\"));\n\n            actions.animate({\n                draw: {\n                    left: element.children(\"section.complete\").length * border_size + 41\n                },\n                dur: o.duration\n            });\n\n            if (\n                (this.current === sections.length) || (o.finish > 0 && this.current >= o.finish)\n            ) {\n                finish.removeClass(\"disabled\");\n            }\n\n            if (parseInt(o.finish) > 0 && this.current === parseInt(o.finish)) {\n\n                this._fireEvent(\"finish-page\", {\n                    index: this.current,\n                    page: target[0]\n                });\n            }\n\n            if (this.current < sections.length) {\n                next.removeClass(\"disabled\");\n            }\n\n            if (this.current > 1) {\n                prev.removeClass(\"disabled\");\n            }\n\n            this._fireEvent(\"page\", {\n                index: this.current,\n                page: target[0]\n            });\n        },\n\n        changeAttribute: function(){\n        },\n\n        destroy: function(){\n            var element = this.element;\n\n            element.off(Metro.events.click, \".wizard-btn-help\");\n            element.off(Metro.events.click, \".wizard-btn-prev\");\n            element.off(Metro.events.click, \".wizard-btn-next\");\n            element.off(Metro.events.click, \".wizard-btn-finish\");\n            element.off(Metro.events.click, \".complete\");\n            $(window).off(Metro.events.resize,{ns: this.id});\n\n            return element;\n        }\n    });\n}(Metro, m4q));//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvbWV0cm80L2J1aWxkL2pzL21ldHJvLmpzLmpzIiwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esc0NBQXNDLElBQUksR0FBRyxJQUFJLEdBQUcsSUFBSSxHQUFHLElBQUksR0FBRyxJQUFJLEdBQUcsSUFBSSxHQUFHLElBQUk7O0FBRXBGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw0Q0FBNEMsT0FBTztBQUNuRCxtRUFBbUUsT0FBTztBQUMxRSxtRUFBbUUsT0FBTztBQUMxRSxtRUFBbUUsT0FBTztBQUMxRSxtRUFBbUUsT0FBTztBQUMxRSxtRUFBbUUsT0FBTztBQUMxRTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw4Q0FB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O0FBQy9CO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixPQUFPO0FBQy9CO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7O0FBRUQ7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUEsMkJBQTJCLFFBQVE7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUEsK0JBQStCLHdCQUF3QjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdURBQXVELElBQUk7QUFDM0Q7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7O0FBRTNCO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjs7QUFFM0I7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdURBQXVELElBQUk7QUFDM0Q7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDRHQUE0RyxPQUFPO0FBQ25IO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHlHQUF5RyxPQUFPO0FBQ2hIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBLCtEQUErRCxFQUFFLEtBQUssRUFBRTtBQUN4RSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdURBQXVELElBQUk7QUFDM0Q7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxtREFBbUQsSUFBSTtBQUN2RDtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSx5REFBeUQsZUFBZTtBQUN4RSw4REFBOEQsZUFBZTtBQUM3RSx5REFBeUQsY0FBYztBQUN2RSw4REFBOEQsZUFBZTtBQUM3RSw0REFBNEQsd0JBQXdCO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQSxRQUFRO0FBQ1I7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxzQkFBc0Isa0JBQWtCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsUUFBUTtBQUNSO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsNkNBQTZDLFNBQVM7O0FBRXREO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsc0JBQXNCLGVBQWU7QUFDckMsNEJBQTRCLGVBQWU7QUFDM0M7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxnQkFBZ0I7QUFDaEIsZ0JBQWdCO0FBQ2hCLGlCQUFpQjtBQUNqQixrQkFBa0I7QUFDbEIsa0JBQWtCO0FBQ2xCLGtCQUFrQjtBQUNsQjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsaUJBQWlCLFdBQVcsVUFBVTtBQUN0QyxpQkFBaUIsV0FBVyxVQUFVO0FBQ3RDLGtCQUFrQixXQUFXLFVBQVU7QUFDdkMsbUJBQW1CLFdBQVcsVUFBVTtBQUN4QyxxQkFBcUIsVUFBVTtBQUMvQixxQkFBcUIsVUFBVTtBQUMvQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUEsc0JBQXNCLFdBQVc7QUFDakM7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxPQUFPOztBQUVQO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsc0JBQXNCLGdCQUFnQjtBQUN0QztBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBLDZDQUE2Qzs7O0FBRzdDLDJDQUEyQzs7O0FBRzNDO0FBQ0E7QUFDQTs7QUFFQSx5RkFBeUY7QUFDekY7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNB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O0FBQ0E7QUFDQTs7QUFFQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTzs7QUFFUDtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBOztBQUVBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7O0FBRUEsQ0FBQztBQUNEO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0EsaURBQWlELCtCQUErQjtBQUNoRjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJFQUEyRSxFQUFFO0FBQzdFO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFD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LFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVCw0Q0FBNEMsZUFBZTtBQUMzRCxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQsNENBQTRDLGVBQWU7QUFDM0QsS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7O0FBRUEsNENBQTRDLGVBQWU7QUFDM0QsS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiOztBQUVBLDRDQUE0QyxlQUFlO0FBQzNELEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiOztBQUVBLDRDQUE0QyxlQUFlO0FBQzNELEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVCxzREFBc0QsZUFBZTtBQUNyRSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQsNENBQTRDLGVBQWU7QUFDM0QsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBLFNBQVM7QUFDVDtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxDQUFDOztBQUVEOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixVQUFVO0FBQ1Y7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOzs7QUFHRDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkOztBQUVBLDJGQUEyRjtBQUMzRjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBVTtBQUNWLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWLEtBQUs7O0FBRUw7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7O0FBRUEscUJBQXFCLGNBQWM7QUFDbkM7QUFDQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGdCQUFnQixTQUFTO0FBQ3pCO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsNEJBQTRCO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLFFBQVE7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJFQUEyRSxRQUFRO0FBQ25GO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGtCQUFrQjs7QUFFbEI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHdCQUF3QjtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCOztBQUVqQjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsTUFBTTtBQUNOO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsK0RBQStEO0FBQy9ELG1EQUFtRDtBQUNuRDs7O0FBR0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQSw0QkFBNEIseUJBQXlCO0FBQ3JEO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQSxVQUFVO0FBQ1Y7QUFDQSxVQUFVO0FBQ1Y7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1QsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0EsQ0FBQzs7QUFFRDs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxVQUFVO0FBQ1YsMkJBQTJCO0FBQzNCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsY0FBYztBQUNkO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxDQUFDOzs7O0FBSUQ7O0FBRUE7O0FBRUE7QUFDQSwwQkFBMEI7QUFDMUIsNkJBQTZCO0FBQzdCLDZCQUE2Qjs7QUFFN0I7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0EsQ0FBQzs7O0FBR0Q7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLDZGQUE2Rjs7QUFFN0Y7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLHVCQUF1QixnQ0FBZ0M7QUFDdkQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7OztBQUdBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsbURBQW1EO0FBQ25EO0FBQ0EsU0FBUztBQUNULEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsdURBQXVEO0FBQ3ZEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1QsS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1QsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjs7QUFFQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1QsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBOztBQUVBLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQSxDQUFDOzs7QUFHRDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EscUJBQXFCOztBQUVyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLO0FBQ0wsQ0FBQzs7QUFFRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1QsS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFNBQVM7O0FBRVQsZ0JBQWdCLDZCQUE2QjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0EsS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLENBQUM7O0FBRUQ7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFO0FBQ25EO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFVBQVU7QUFDVjtB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O0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdUJBQXVCOztBQUV2QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBOztBQUVBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxTQUFTO0FBQ1QsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1QsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1QsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQSxDQUFDOzs7QUFHRDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLENBQUM7Ozs7QUFJRDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVCxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQSxDQUFDOztBQUVEOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVULE1BQU07O0FBRU47O0FBRUEsK0RBQStEO0FBQy9EO0FBQ0E7QUFD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QUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLOztBQUVMOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLGNBQWM7QUFDMUMsb0NBQW9DLGNBQWM7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBLENBQUM7QUFDRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLGlCQUFpQjtBQUM5Qzs7QUFFQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDRFQUE0RTtBQUM1RTtBQUNBLHFFQUFxRTtBQUNyRSwyR0FBMkc7QUFDM0c7QUFDQTs7QUFFQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSw0REFBNEQsSUFBSTtBQUNoRSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckMsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsdUJBQXVCLGVBQWU7QUFDdEM7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsZ0RBQWdEO0FBQ2hEOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLG1CQUFtQiw2QkFBNkI7QUFDaEQsc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLG1CQUFtQiw2QkFBNkI7QUFDaEQsc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLG1CQUFtQiw2QkFBNkI7QUFDaEQsc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQSxpQ0FBaUM7QUFDakMsNkNBQTZDLE9BQU87QUFDcEQ7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQSx3Q0FBd0M7QUFDeEMsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBLDBDQUEwQyxjQUFjO0FBQ3hELFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLG9EQUFvRDtBQUNwRDtBQUNBLGtCQUFrQixtREFBbUQ7QUFD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Q0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsOENBQThDO0FBQzlDOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGFBQWE7O0FBRWI7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGNBQWM7QUFDZDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBOzs7QUFHQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLGFBQWE7O0FBRWI7O0FBRUEsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQSxjQUFjO0FBQ2Q7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLHNEQUFzRDtBQUN0RCx5REFBeUQ7QUFDekQ7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDhDQUE4QztBQUM5Qzs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDhDQUE4QztBQUM5Qzs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBOztBQUVBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMkNBQTJDO0FBQzNDOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FB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Y0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0Esd0RBQXdEO0FBQ3hELHNEQUFzRDtBQUN0RCx3REFBd0Q7QUFDeEQsa0RBQWtEO0FBQ2xELHlEQUF5RDtBQUN6RCx5REFBeUQ7QUFDekQsNkRBQTZEO0FBQzdEO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsZ0RBQWdELFlBQVk7O0FBRTVEO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7O0FBRUw7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxpREFBaUQ7QUFDakQ7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxrREFBa0Q7QUFDbEQsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQSxTQUFTOztBQUVUOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFF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akIsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhOztBQUViOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxnREFBZ0QsWUFBWTs7QUFFNUQ7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHlDQUF5QztBQUN6Qzs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLDJEQUEyRDtBQUMzRDtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdUNBQXVDO0FBQ3ZDOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx3Q0FBd0M7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGFBQWE7O0FBRWI7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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Q2xCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSwyREFBMkQ7QUFDM0Q7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsOENBQThDO0FBQzlDOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esa0RBQWtEO0FBQ2xEO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBLFlBQVk7O0FBRVo7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsS0FBSzs7QUFFTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGdEQUFnRDtBQUNoRDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUEsMEhBQTBILHlCQUF5QjtBQUNuSjtBQUNBLDJHQUEyRyx5QkFBeUI7QUFDcEk7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFD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OztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxtRUFBbUUseUJBQXlCO0FBQzVGLGNBQWM7QUFDZCxzREFBc0QseUJBQXlCO0FBQy9FOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx5Q0FBeUM7QUFDekM7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVULGVBQWU7O0FBRWY7QUFDQSxtQ0FBbUM7QUFDbkM7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCOztBQUVqQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0EsZ0NBQWdDLEVBQUUsZUFBZSxFQUFFO0FBQ25ELFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQSxjQUFjO0FBQ2Q7QUFDQSxjQUFjO0FBQ2Q7QUFDQSxjQUFjO0FBQ2Q7QUFDQSxjQUFjO0FBQ2Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw0QkFBNEI7QUFDNUIsNEJBQTRCOztBQUU1QjtBQUNBLDRCQUE0QjtBQUM1Qiw0QkFBNEI7O0FBRTVCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLHdCQUF3QixPQUFPO0FBQy9CO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBLGlDQUFpQztBQUNqQztBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLHVDQUF1QztBQUN2QyxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBLHNDQUFzQztBQUN0Qzs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQixj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dUI7O0FBRXJFOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw2Q0FBNkM7QUFDN0M7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsNEJBQTRCLGdCQUFnQiwyQkFBMkI7QUFDdkUsNEJBQTRCLFFBQVE7QUFDcEM7QUFDQTtBQUNBLDRCQUE0QixnQkFBZ0IsMkJBQTJCO0FBQ3ZFOztBQUVBO0FBQ0E7QUFDQSw0QkFBNEIsZ0JBQWdCLDJCQUEyQjtBQUN2RSw0QkFBNEIsUUFBUTtBQUNwQztBQUNBO0FBQ0EsNEJBQTRCLGdCQUFnQiwyQkFBMkI7QUFDdkU7O0FBRUE7QUFDQTtBQUNBLDRCQUE0QixnQkFB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O0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQSwrQ0FBK0MsWUFBWTs7QUFFM0Q7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNB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QUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBLGNBQWM7QUFDZCxxQ0FBcUM7QUFDckM7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsK0NBQStDO0FBQy9DOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsNEJBQTRCLDZCQUE2QjtBQUN6RDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7O0FBRXJCLGlCQUFpQixHQUFHLFlBQVk7O0FBRWhDO0FBQ0EsMkRBQTJELFlBQVk7QUFDdkUsMkRBQTJELFlBQVk7O0FBRXZFO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsaUJBQWlCLEdBQUcsWUFBWTs7QUFFaEM7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhOztBQUViO0FBQ0E7QUFDQSxhQUFhLEdBQUcsWUFBWTtBQUM1QixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsMkRBQTJEO0FBQzNELDJEQUEyRDtBQUMzRCxxREFBcUQ7QUFDckQ7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFD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QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0EsWUFBWTs7QUFFWjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwwQ0FBMEM7QUFDMUM7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0EsYUFBYSxHQUFHLFlBQVk7QUFDNUIsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FB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Q0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLDBDQUEwQztBQUMxQzs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLHFEQUFxRDtBQUNyRDtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHlDQUF5QztBQUN6Qzs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtB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QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMLENBQUM7QUFDRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwyQ0FBMkM7QUFDM0M7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztB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RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7O0FBRUE7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCOztBQUVyQjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCOztBQUVBOztBQUVBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGlCQUFpQjs7QUFFakIsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx1REFBdUQ7QUFDdkQsNERBQTREO0FBQzVELGlFQUFpRTtBQUNqRTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDJDQUEyQztBQUMzQzs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhOztBQUViOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7O0FBRWpCLGFBQWE7O0FBRWI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxjQUFjOztBQUVkOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQzs7QUFFL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7O0FBRUEsK0JBQStCOztBQUUvQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7O0FBRUEsK0JBQStCOztBQUUvQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7O0FBRUEsK0JBQStCOztBQUUvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBOztBQUVBLCtCQUErQjs7QUFFL0I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGdEQUFnRDtBQUNoRCw0REFBNEQ7QUFDNUQ7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDBDQUEwQztBQUMxQzs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7O0FBR1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGlCQUFpQjtBQUNqQixjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7O0FBRWpCLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCOztBQUVBOztBQUVBLGFBQWEsR0FBRyxZQUFZO0FBQzVCLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGNBQWM7O0FBRWQ7QUFDQTtBQUNBOztBQUVBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBO0FB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Q0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx5REFBeUQ7QUFDekQseURBQXlEO0FBQ3pEO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwyQ0FBMkM7QUFDM0M7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUEsU0FBUzs7QUFFVDtBQUNBOztBQUVBLFNBQVM7O0FBRVQ7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHlDQUF5QztBQUN6Qzs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRGQUE0Rjs7QUFFNUY7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBOztBQUVBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxtQ0FBbUM7QUFDbkM7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxjQUFjO0FBQ2Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdURBQXVEO0FBQ3ZELCtEQUErRDtBQUMvRDtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDBDQUEwQztBQUMxQzs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBOztB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QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViLFNBQVM7O0FBRVQ7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHVCQUF1QixvQkFBb0I7QUFDM0M7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMkNBQTJDO0FBQzNDOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7O0FBRWpCO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7O0FBRXJCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsaUJBQWlCO0FBQ2pCLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUEsMkNBQTJDLDBCQUEwQjtBQUNyRTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsMkJBQTJCLGtDQUFrQztBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFD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Q0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLHlEQUF5RDtBQUN6RCxxREFBcUQ7QUFDckQsNEVBQTRFO0FBQzVFO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx5Q0FBeUM7QUFDekM7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0Esc0VBQXNFO0FBQ3RFO0FBQ0Esd0VBQXdFO0FBQ3hFO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx3Q0FBd0M7QUFDeEM7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEIsK0JBQStCO0FB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QUVBO0FBQ0E7O0FBRUEsZ0RBQWdELFlBQVk7O0FBRTVEOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsK0NBQStDO0FBQy9DOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjs7QUFFakIsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0EsY0FBYztBQUNkO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdUNBQXVDO0FBQ3ZDOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUEsK0RBQStEO0FBQy9EO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixPQUFPO0FBQ3RDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0EsYUFBYSxHQUFHLFlBQVk7O0FBRTVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUEsK0NBQStDLFlBQVk7O0FBRTNEOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMkNBQTJDO0FBQzNDOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7O0FBRUE7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsaUNBQWlDOztBQUVqQztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw2RkFBNkY7O0FBRTdGO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFB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QTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDRDQUE0QztBQUM1Qzs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0Esd0NBQXdDO0FBQ3hDOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUEsOEJBQThCOztBQUU5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0hBQXNIO0FBQ3RIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DO0FBQ3BDOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RDtBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBLHFCQUFxQjtBQUNyQjs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7O0FBR0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjs7QUFFckI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3Qjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0IseUJBQXlCOztBQUV6QixzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGNBQWM7QUFDZDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLHNIQUFzSDtBQUN0SCxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQSwyQkFBMkI7O0FBRTNCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYzs7QUFFZDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBLCtEQUErRDtBQUMvRDtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQztBQUN0Qyx1REFBdUQ7O0FBRXZEO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0EsY0FBYztBQUNkO0FBQ0EsY0FBYztBQUNkO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwyQ0FBMkM7QUFDM0M7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOzs7QUFHVDtBQUNBO0FBQ0EsU0FBUzs7O0FBR1Q7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7O0FBRUEsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxhQUFhOztBQUViO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCOztBQUVqQjtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7O0FBRWpCO0FBQ0E7QUFDQTtB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QUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsOENBQThDO0FBQzlDOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGNBQWM7QUFDZDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLGFBQWE7O0FBRWI7O0FBRUEsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCOztBQUVBOztBQUVBO0FBQ0E7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Q0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7O0FBRWpCLGNBQWM7O0FBRWQ7QUFDQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCOztBQUVqQjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTs7QUFFQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCOztBQUVqQjtBQUNBO0FBQ0EsYUFBYTs7QUFFYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0EsY0FBYztBQUNkO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDZEQUE2RDtBQUM3RCx5REFBeUQ7QUFDekQseURBQXlEO0FBQ3pEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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Uzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0EsU0FBUzs7QUFFVDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsWUFBWTs7QUFFM0Q7QUFDQTtBQUNBLEtBQUs7QUFDTCxDQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL21ldHJvNC9idWlsZC9qcy9tZXRyby5qcz9hYjE1Il0sInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIE1ldHJvIDQgQ29tcG9uZW50cyBMaWJyYXJ5IHY0LjUuMCAgKGh0dHBzOi8vbWV0cm91aS5vcmcudWEpXHJcbiAqIENvcHlyaWdodCAyMDEyLTIwMjEgU2VyZ2V5IFBpbWVub3ZcclxuICogQnVpbHQgYXQgMDEvMDgvMjAyMSAxODo1Mzo0M1xyXG4gKiBMaWNlbnNlZCB1bmRlciBNSVRcclxuICovXHJcbi8qIVxuICogRGF0ZXRpbWUgdjEuMC4wLCAoaHR0cHM6Ly9naXRodWIuY29tL29sdG9uL0RhdGV0aW1lSlMuZ2l0KVxuICogQ29weXJpZ2h0IDIwMjEgYnkgU2VyaGlpIFBpbWVub3YgKGh0dHBzOi8vcGltZW5vdi5jb20udWEpXG4gKiBEYXRldGltZS5qcyBpcyBhIG1pbmltYWxpc3QgSmF2YVNjcmlwdCBsaWJyYXJ5IHRoYXQgcGFyc2VzLCB2YWxpZGF0ZXMsIG1hbmlwdWxhdGVzLCBhbmQgZGlzcGxheXMgZGF0ZXMgYW5kIHRpbWVzIGZvciBtb2Rlcm4gYnJvd3NlcnMgd2l0aCBjb21mb3J0YWJsZSBtb2Rlcm4gQVBJLlxuICogQnVpbGQgYXQgMTEvMDEvMjAyMSAyMTowOTo1NVxuICogTGljZW5zZWQgdW5kZXIgTUlUXG4gISovXG4oZnVuY3Rpb24oZ2xvYmFsKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIERFRkFVTFRfRk9STUFUID0gXCJZWVlZLU1NLUREVEhIOm1tOnNzLnNzc1wiO1xuICAgIHZhciBJTlZBTElEX0RBVEUgPSBcIkludmFsaWQgZGF0ZVwiO1xuICAgIHZhciBSRUdFWF9GT1JNQVQgPSAvXFxbKFteXFxdXSspXXxZezEsNH18TXsxLDR9fER7MSwyfXxkezEsNH18SHsxLDJ9fG17MSwyfXxzezEsM30vZztcblxuICAgIGdsb2JhbFsnREFURVRJTUVfTE9DQUxFUyddID0ge1xuICAgICAgICBcImVuXCI6IHtcbiAgICAgICAgICAgIG1vbnRoczogXCJKYW51YXJ5IEZlYnJ1YXJ5IE1hcmNoIEFwcmlsIE1heSBKdW5lIEp1bHkgQXVndXN0IFNlcHRlbWJlciBPY3RvYmVyIE5vdmVtYmVyIERlY2VtYmVyXCIuc3BsaXQoXCIgXCIpLFxuICAgICAgICAgICAgbW9udGhzU2hvcnQ6IFwiSmFuIEZlYiBNYXIgQXByIE1heSBKdW4gSnVsIEF1ZyBTZXAgT2N0IE5vdiBEZWNcIi5zcGxpdChcIiBcIiksXG4gICAgICAgICAgICB3ZWVrZGF5czogXCJTdW5kYXkgTW9uZGF5IFR1ZXNkYXkgV2VkbmVzZGF5IFRodXJzZGF5IEZyaWRheSBTYXR1cmRheVwiLnNwbGl0KFwiIFwiKSxcbiAgICAgICAgICAgIHdlZWtkYXlzU2hvcnQ6IFwiU3VuIE1vbiBUdWUgV2VkIFRodSBGcmkgU2F0XCIuc3BsaXQoXCIgXCIpLFxuICAgICAgICAgICAgd2Vla2RheXNNaW46IFwiU3UgTW8gVHUgV2UgVGggRnIgU2FcIi5zcGxpdChcIiBcIiksXG4gICAgICAgICAgICB3ZWVrU3RhcnQ6IDBcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhciBNID0ge1xuICAgICAgICBtczogXCJNaWxsaXNlY29uZHNcIixcbiAgICAgICAgczogXCJTZWNvbmRzXCIsXG4gICAgICAgIG06IFwiTWludXRlc1wiLFxuICAgICAgICBoOiBcIkhvdXJzXCIsXG4gICAgICAgIEQ6IFwiRGF0ZVwiLFxuICAgICAgICBkOiBcIkRheVwiLFxuICAgICAgICBNOiBcIk1vbnRoXCIsXG4gICAgICAgIFk6IFwiRnVsbFllYXJcIixcbiAgICAgICAgeTogXCJZZWFyXCIsXG4gICAgICAgIHQ6IFwiVGltZVwiXG4gICAgfVxuXG4gICAgdmFyIEMgPSB7XG4gICAgICAgIG1zOiBcIm1zXCIsXG4gICAgICAgIHM6IFwic2Vjb25kXCIsXG4gICAgICAgIG06IFwibWludXRlXCIsXG4gICAgICAgIGg6IFwiaG91clwiLFxuICAgICAgICBEOiBcImRheVwiLFxuICAgICAgICBXOiBcIndlZWtcIixcbiAgICAgICAgZDogXCJ3ZWVrRGF5XCIsXG4gICAgICAgIE06IFwibW9udGhcIixcbiAgICAgICAgWTogXCJ5ZWFyXCIsXG4gICAgICAgIFkyOiBcInllYXIyXCIsXG4gICAgICAgIHQ6IFwidGltZVwiLFxuICAgICAgICBjOiBcImNlbnR1cnlcIixcbiAgICAgICAgcTogXCJxdWFydGVyXCJcbiAgICB9XG5cbiAgICB2YXIgbHBhZCA9IGZ1bmN0aW9uKHN0ciwgcGFkLCBsZW5ndGgpe1xuICAgICAgICB2YXIgX3N0ciA9IFwiXCIrc3RyO1xuICAgICAgICBpZiAobGVuZ3RoICYmIF9zdHIubGVuZ3RoID49IGxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIF9zdHI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIEFycmF5KChsZW5ndGggKyAxKSAtIF9zdHIubGVuZ3RoKS5qb2luKHBhZCkgKyBfc3RyO1xuICAgIH1cblxuICAgIHZhciBub3QgPSBmdW5jdGlvbih2KXtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiB2ID09PSBcInVuZGVmaW5lZFwiIHx8IHYgPT09IG51bGw7XG4gICAgfVxuICAgIHZhciBkYXRldGltZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBhcmdzO1xuXG4gICAgICAgIGlmIChhcmd1bWVudHNbMF0gaW5zdGFuY2VvZiBEYXRldGltZSkge1xuICAgICAgICAgICAgcmV0dXJuIGRhdGV0aW1lKGFyZ3VtZW50c1swXS52YWx1ZSk7XG4gICAgICAgIH1cblxuICAgICAgICBhcmdzID0gW10uc2xpY2UuY2FsbChBcnJheS5pc0FycmF5KGFyZ3VtZW50c1swXSkgPyBhcmd1bWVudHNbMF0gOiBhcmd1bWVudHMpO1xuXG4gICAgICAgIHJldHVybiBuZXcgKEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmFwcGx5KERhdGV0aW1lLCAgW3RoaXNdLmNvbmNhdChhcmdzKSApICk7XG4gICAgfVxuICAgIHZhciBEYXRldGltZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuICAgICAgICB0aGlzLnZhbHVlID0gbmV3IChGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5hcHBseShEYXRlLCAgW3RoaXNdLmNvbmNhdChhcmdzKSApICk7XG4gICAgICAgIHRoaXMubG9jYWxlID0gXCJlblwiO1xuICAgICAgICB0aGlzLndlZWtTdGFydCA9IGdsb2JhbFsnREFURVRJTUVfTE9DQUxFUyddW1wiZW5cIl0ud2Vla1N0YXJ0O1xuICAgICAgICB0aGlzLnV0Y01vZGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5tdXRhYmxlID0gdHJ1ZTtcblxuICAgICAgICBpZiAoaXNOYU4odGhpcy52YWx1ZS5nZXRUaW1lKCkpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoSU5WQUxJRF9EQVRFKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBEYXRldGltZS5ERUZBVUxUX0ZPUk1BVCA9IERFRkFVTFRfRk9STUFUO1xuICAgIERhdGV0aW1lLlJFR0VYX0ZPUk1BVCA9IFJFR0VYX0ZPUk1BVDtcbiAgICBEYXRldGltZS5JTlZBTElEX0RBVEUgPSBJTlZBTElEX0RBVEU7XG5cbiAgICBEYXRldGltZS5scGFkID0gbHBhZDtcbiAgICBEYXRldGltZS5ub3QgPSBub3Q7XG5cbiAgICBEYXRldGltZS5pc0RhdGV0aW1lID0gZnVuY3Rpb24odmFsKXtcbiAgICAgICAgcmV0dXJuIHZhbCBpbnN0YW5jZW9mIERhdGV0aW1lO1xuICAgIH1cblxuICAgIERhdGV0aW1lLm5vdyA9IGZ1bmN0aW9uKGFzRGF0ZSl7XG4gICAgICAgIHJldHVybiBkYXRldGltZSgpW2FzRGF0ZSA/IFwidmFsXCIgOiBcInRpbWVcIl0oKTtcbiAgICB9XG5cbiAgICBEYXRldGltZS5sb2NhbGUgPSBmdW5jdGlvbihuYW1lLCBsb2NhbGUpe1xuICAgICAgICBnbG9iYWxbJ0RBVEVUSU1FX0xPQ0FMRVMnXVtuYW1lXSA9IGxvY2FsZTtcbiAgICB9XG5cbiAgICBEYXRldGltZS5nZXRMb2NhbGUgPSBmdW5jdGlvbihsb2NhbGUpe1xuICAgICAgICByZXR1cm4gZ2xvYmFsWydEQVRFVElNRV9MT0NBTEVTJ11bbG9jYWxlIHx8IFwiZW5cIl0gfHwgZ2xvYmFsWydEQVRFVElNRV9MT0NBTEVTJ11bXCJlblwiXTtcbiAgICB9XG5cbiAgICBEYXRldGltZS5wYXJzZSA9IGZ1bmN0aW9uKHN0cil7XG4gICAgICAgIHJldHVybiBkYXRldGltZShEYXRlLnBhcnNlKHN0cikpO1xuICAgIH1cblxuICAgIERhdGV0aW1lLmFsaWduID0gZnVuY3Rpb24oZCwgYWxpZ24pe1xuICAgICAgICB2YXIgZGF0ZSA9IGQgaW5zdGFuY2VvZiBEYXRldGltZSA/IGQgOiBkYXRldGltZShkKSxcbiAgICAgICAgICAgIHJlc3VsdCwgdGVtcDtcblxuICAgICAgICBzd2l0Y2ggKGFsaWduKSB7XG4gICAgICAgICAgICBjYXNlIEMuczogIHJlc3VsdCA9IGRhdGUubXMoMCk7IGJyZWFrOyAvL3NlY29uZFxuICAgICAgICAgICAgY2FzZSBDLm06ICByZXN1bHQgPSBEYXRldGltZS5hbGlnbihkYXRlLCBDLnMpW0Muc10oMCk7IGJyZWFrOyAvL21pbnV0ZVxuICAgICAgICAgICAgY2FzZSBDLmg6ICByZXN1bHQgPSBEYXRldGltZS5hbGlnbihkYXRlLCBDLm0pW0MubV0oMCk7IGJyZWFrOyAvL2hvdXJcbiAgICAgICAgICAgIGNhc2UgQy5EOiAgcmVzdWx0ID0gRGF0ZXRpbWUuYWxpZ24oZGF0ZSwgQy5oKVtDLmhdKDApOyBicmVhazsgLy9kYXlcbiAgICAgICAgICAgIGNhc2UgQy5NOiAgcmVzdWx0ID0gRGF0ZXRpbWUuYWxpZ24oZGF0ZSwgQy5EKVtDLkRdKDEpOyBicmVhazsgLy9tb250aFxuICAgICAgICAgICAgY2FzZSBDLlk6ICByZXN1bHQgPSBEYXRldGltZS5hbGlnbihkYXRlLCBDLk0pW0MuTV0oMCk7IGJyZWFrOyAvL3llYXJcbiAgICAgICAgICAgIGNhc2UgQy5XOiAge1xuICAgICAgICAgICAgICAgIHRlbXAgPSBkYXRlLndlZWtEYXkoKTtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBEYXRldGltZS5hbGlnbihkYXRlLCBDLkQpLmFkZERheSgtdGVtcCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7IC8vIHdlZWtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6ICAgcmVzdWx0ID0gZGF0ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIERhdGV0aW1lLmFsaWduRW5kID0gZnVuY3Rpb24oZCwgYWxpZ24pe1xuICAgICAgICB2YXIgZGF0ZSA9IGQgaW5zdGFuY2VvZiBEYXRldGltZSA/IGQgOiBkYXRldGltZShkKSxcbiAgICAgICAgICAgIHJlc3VsdCwgdGVtcDtcblxuICAgICAgICBzd2l0Y2ggKGFsaWduKSB7XG4gICAgICAgICAgICBjYXNlIEMubXM6IHJlc3VsdCA9IGRhdGUubXMoOTk5KTsgYnJlYWs7IC8vc2Vjb25kXG4gICAgICAgICAgICBjYXNlIEMuczogIHJlc3VsdCA9IERhdGV0aW1lLmFsaWduRW5kKGRhdGUsIEMubXMpOyBicmVhazsgLy9zZWNvbmRcbiAgICAgICAgICAgIGNhc2UgQy5tOiAgcmVzdWx0ID0gRGF0ZXRpbWUuYWxpZ25FbmQoZGF0ZSwgQy5zKVtDLnNdKDU5KTsgYnJlYWs7IC8vbWludXRlXG4gICAgICAgICAgICBjYXNlIEMuaDogIHJlc3VsdCA9IERhdGV0aW1lLmFsaWduRW5kKGRhdGUsIEMubSlbQy5tXSg1OSk7IGJyZWFrOyAvL2hvdXJcbiAgICAgICAgICAgIGNhc2UgQy5EOiAgcmVzdWx0ID0gRGF0ZXRpbWUuYWxpZ25FbmQoZGF0ZSwgQy5oKVtDLmhdKDIzKTsgYnJlYWs7IC8vZGF5XG4gICAgICAgICAgICBjYXNlIEMuTTogIHJlc3VsdCA9IERhdGV0aW1lLmFsaWduRW5kKGRhdGUsIEMuRClbQy5EXSgxKS5hZGQoMSwgQy5NKS5hZGQoLTEsIEMuRCk7IGJyZWFrOyAvL21vbnRoXG4gICAgICAgICAgICBjYXNlIEMuWTogIHJlc3VsdCA9IERhdGV0aW1lLmFsaWduRW5kKGRhdGUsIEMuRClbQy5NXSgxMSlbQy5EXSgzMSk7IGJyZWFrOyAvL3llYXJcbiAgICAgICAgICAgIGNhc2UgQy5XOiAge1xuICAgICAgICAgICAgICAgIHRlbXAgPSBkYXRlLndlZWtEYXkoKTtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBEYXRldGltZS5hbGlnbkVuZChkYXRlLCAnZGF5JykuYWRkRGF5KDYgLSB0ZW1wKTtcbiAgICAgICAgICAgICAgICBicmVhazsgLy8gd2Vla1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkZWZhdWx0OiAgIHJlc3VsdCA9IGRhdGU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBEYXRldGltZS5leHRlbmQgPSBmdW5jdGlvbih3aGVyZSl7XG4gICAgICAgIHZhciBvcHRpb25zLCBuYW1lLFxuICAgICAgICAgICAgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDtcblxuICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGxlbmd0aDsgaSsrICkge1xuICAgICAgICAgICAgaWYgKCAoIG9wdGlvbnMgPSBhcmd1bWVudHNbIGkgXSApICE9IG51bGwgKSB7XG4gICAgICAgICAgICAgICAgZm9yICggbmFtZSBpbiBvcHRpb25zICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9wdGlvbnMsIG5hbWUpKVxuICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmVbIG5hbWUgXSA9IG9wdGlvbnNbIG5hbWUgXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gd2hlcmU7XG4gICAgfTtcblxuICAgIERhdGV0aW1lLnVzZSA9IGZ1bmN0aW9uKG9iail7XG4gICAgICAgIERhdGV0aW1lLmV4dGVuZChEYXRldGltZS5wcm90b3R5cGUsIG9iaik7XG4gICAgfVxuXG4gICAgRGF0ZXRpbWUudXNlU3RhdGljID0gZnVuY3Rpb24ob2JqKXtcbiAgICAgICAgRGF0ZXRpbWUuZXh0ZW5kKERhdGV0aW1lLCBvYmopO1xuICAgIH1cblxuICAgIERhdGV0aW1lLnByb3RvdHlwZSA9IHtcbiAgICAgICAgaW1tdXRhYmxlOiBmdW5jdGlvbih2KXtcbiAgICAgICAgICAgIHRoaXMubXV0YWJsZSA9ICEobm90KHYpID8gdHJ1ZSA6IHYpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdXRjOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy51dGNNb2RlID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGxvY2FsOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy51dGNNb2RlID0gZmFsc2VcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIHVzZUxvY2FsZTogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICAgIGlmICghRGF0ZXRpbWUuZ2V0TG9jYWxlKHZhbCkpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJMb2NhbGUgXCIgKyB2YWwgKyBcIiBpcyBub3QgZGVmaW5lZCFcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmxvY2FsZSA9IHZhbDtcbiAgICAgICAgICAgIHRoaXMud2Vla1N0YXJ0ID0gRGF0ZXRpbWUuZ2V0TG9jYWxlKHZhbCkud2Vla1N0YXJ0O1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvbmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgYyA9IGRhdGV0aW1lKHRoaXMudmFsdWUpO1xuICAgICAgICAgICAgYy5sb2NhbGUgPSB0aGlzLmxvY2FsZTtcbiAgICAgICAgICAgIGMud2Vla1N0YXJ0ID0gdGhpcy53ZWVrU3RhcnQ7XG4gICAgICAgICAgICBjLm11dGFibGUgPSB0aGlzLm11dGFibGU7XG4gICAgICAgICAgICByZXR1cm4gYztcbiAgICAgICAgfSxcblxuICAgICAgICBhbGlnbjogZnVuY3Rpb24odG8pe1xuICAgICAgICAgICAgaWYgKHRoaXMubXV0YWJsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSBEYXRldGltZS5hbGlnbih0aGlzLCB0bykudmFsKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsb25lKCkuaW1tdXRhYmxlKGZhbHNlKS5hbGlnbih0bykuaW1tdXRhYmxlKCF0aGlzLm11dGFibGUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFsaWduRW5kOiBmdW5jdGlvbih0byl7XG4gICAgICAgICAgICBpZiAodGhpcy5tdXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IERhdGV0aW1lLmFsaWduRW5kKHRoaXMsIHRvKS52YWwoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoKS5pbW11dGFibGUoZmFsc2UpLmFsaWduRW5kKHRvKS5pbW11dGFibGUoIXRoaXMubXV0YWJsZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdmFsOiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgaWYgKCAhKHZhbCBpbnN0YW5jZW9mIERhdGUpIClcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTtcblxuICAgICAgICAgICAgaWYgKHRoaXMubXV0YWJsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWw7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBkYXRldGltZSh2YWwpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHllYXIyOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuICsoXCJcIit0aGlzLnllYXIoKSkuc3Vic3RyKC0yKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfc2V0OiBmdW5jdGlvbihtLCB2KXtcbiAgICAgICAgICAgIHZhciBmbiA9IFwic2V0XCIgKyAodGhpcy51dGNNb2RlICYmIG0gIT09IFwidFwiID8gXCJVVENcIiA6IFwiXCIpICsgTVttXTtcbiAgICAgICAgICAgIGlmICh0aGlzLm11dGFibGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlW2ZuXSh2KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjbG9uZSA9IHRoaXMuY2xvbmUoKTtcbiAgICAgICAgICAgIGNsb25lLnZhbHVlW2ZuXSh2KTtcbiAgICAgICAgICAgIHJldHVybiBjbG9uZTtcbiAgICAgICAgfSxcblxuICAgICAgICBfZ2V0OiBmdW5jdGlvbihtKXtcbiAgICAgICAgICAgIHZhciBmbiA9IFwiZ2V0XCIgKyAodGhpcy51dGNNb2RlICYmIG0gIT09IFwidFwiID8gXCJVVENcIiA6IFwiXCIpICsgTVttXTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlW2ZuXSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF93b3JrOiBmdW5jdGlvbihwYXJ0LCB2YWwpe1xuICAgICAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoIHx8ICh0eXBlb2YgdmFsID09PSBcInVuZGVmaW5lZFwiIHx8IHZhbCA9PT0gbnVsbCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0KHBhcnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NldChwYXJ0LCB2YWwpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG1zOiBmdW5jdGlvbih2YWwpeyByZXR1cm4gdGhpcy5fd29yayhcIm1zXCIsIHZhbCk7fSxcbiAgICAgICAgc2Vjb25kOiBmdW5jdGlvbih2YWwpe3JldHVybiB0aGlzLl93b3JrKFwic1wiLCB2YWwpO30sXG4gICAgICAgIG1pbnV0ZTogZnVuY3Rpb24odmFsKXtyZXR1cm4gdGhpcy5fd29yayhcIm1cIiwgdmFsKTsgfSxcbiAgICAgICAgaG91cjogZnVuY3Rpb24odmFsKXtyZXR1cm4gdGhpcy5fd29yayhcImhcIiwgdmFsKTt9LFxuICAgICAgICBkYXk6IGZ1bmN0aW9uKHZhbCl7cmV0dXJuIHRoaXMuX3dvcmsoXCJEXCIsIHZhbCk7fSxcbiAgICAgICAgbW9udGg6IGZ1bmN0aW9uKHZhbCl7cmV0dXJuIHRoaXMuX3dvcmsoXCJNXCIsIHZhbCk7fSxcbiAgICAgICAgeWVhcjogZnVuY3Rpb24odmFsKXtyZXR1cm4gdGhpcy5fd29yayhcIllcIiwgdmFsKTt9LFxuICAgICAgICB0aW1lOiBmdW5jdGlvbih2YWwpe3JldHVybiB0aGlzLl93b3JrKFwidFwiLCB2YWwpO30sXG5cbiAgICAgICAgd2Vla0RheTogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCB8fCAobm90KHZhbCkpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudXRjTW9kZSA/IHRoaXMudmFsdWUuZ2V0VVRDRGF5KCkgOiB0aGlzLnZhbHVlLmdldERheSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgY3VyciA9IHRoaXMud2Vla0RheSgpO1xuICAgICAgICAgICAgdmFyIGRpZmYgPSB2YWwgLSBjdXJyO1xuXG4gICAgICAgICAgICB0aGlzLmRheSh0aGlzLmRheSgpICsgZGlmZik7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldDogZnVuY3Rpb24odW5pdCl7XG4gICAgICAgICAgICByZXR1cm4gdHlwZW9mIHRoaXNbdW5pdF0gIT09IFwiZnVuY3Rpb25cIiA/IHRoaXMgOiB0aGlzW3VuaXRdKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0OiBmdW5jdGlvbih1bml0LCB2YWwpe1xuICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiB0aGlzW3VuaXRdICE9PSBcImZ1bmN0aW9uXCIgPyB0aGlzIDogdGhpc1t1bml0XSh2YWwpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFkZDogZnVuY3Rpb24odmFsLCB0byl7XG4gICAgICAgICAgICBzd2l0Y2ggKHRvKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBDLmg6IHJldHVybiB0aGlzLnRpbWUodGhpcy50aW1lKCkgKyAodmFsICogNjAgKiA2MCAqIDEwMDApKTtcbiAgICAgICAgICAgICAgICBjYXNlIEMubTogcmV0dXJuIHRoaXMudGltZSh0aGlzLnRpbWUoKSArICh2YWwgKiA2MCAqIDEwMDApKTtcbiAgICAgICAgICAgICAgICBjYXNlIEMuczogcmV0dXJuIHRoaXMudGltZSh0aGlzLnRpbWUoKSArICh2YWwgKiAxMDAwKSk7XG4gICAgICAgICAgICAgICAgY2FzZSBDLm1zOiByZXR1cm4gdGhpcy50aW1lKHRoaXMudGltZSgpICsgKHZhbCkpO1xuICAgICAgICAgICAgICAgIGNhc2UgQy5EOiByZXR1cm4gdGhpcy5kYXkodGhpcy5kYXkoKSArIHZhbCk7XG4gICAgICAgICAgICAgICAgY2FzZSBDLlc6IHJldHVybiB0aGlzLmRheSh0aGlzLmRheSgpICsgdmFsICogNyk7XG4gICAgICAgICAgICAgICAgY2FzZSBDLk06IHJldHVybiB0aGlzLm1vbnRoKHRoaXMubW9udGgoKSArIHZhbCk7XG4gICAgICAgICAgICAgICAgY2FzZSBDLlk6IHJldHVybiB0aGlzLnllYXIodGhpcy55ZWFyKCkgKyB2YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGFkZEhvdXI6IGZ1bmN0aW9uKHYpe3JldHVybiB0aGlzLmFkZCh2LEMuaCk7fSxcbiAgICAgICAgYWRkTWludXRlOiBmdW5jdGlvbih2KXtyZXR1cm4gdGhpcy5hZGQodixDLm0pO30sXG4gICAgICAgIGFkZFNlY29uZDogZnVuY3Rpb24odil7cmV0dXJuIHRoaXMuYWRkKHYsIEMucyk7fSxcbiAgICAgICAgYWRkTXM6IGZ1bmN0aW9uKHYpe3JldHVybiB0aGlzLmFkZCh2LCBDLm1zKTt9LFxuICAgICAgICBhZGREYXk6IGZ1bmN0aW9uKHYpe3JldHVybiB0aGlzLmFkZCh2LEMuRCk7fSxcbiAgICAgICAgYWRkV2VlazogZnVuY3Rpb24odil7cmV0dXJuIHRoaXMuYWRkKHYsQy5XKTt9LFxuICAgICAgICBhZGRNb250aDogZnVuY3Rpb24odil7cmV0dXJuIHRoaXMuYWRkKHYsIEMuTSk7fSxcbiAgICAgICAgYWRkWWVhcjogZnVuY3Rpb24odil7cmV0dXJuIHRoaXMuYWRkKHYsIEMuWSk7fSxcblxuICAgICAgICBmb3JtYXQ6IGZ1bmN0aW9uKGZtdCwgbG9jYWxlKXtcbiAgICAgICAgICAgIHZhciBmb3JtYXQgPSBmbXQgfHwgREVGQVVMVF9GT1JNQVQ7XG4gICAgICAgICAgICB2YXIgbmFtZXMgPSBEYXRldGltZS5nZXRMb2NhbGUobG9jYWxlIHx8IHRoaXMubG9jYWxlKTtcbiAgICAgICAgICAgIHZhciB5ZWFyID0gdGhpcy55ZWFyKCksIHllYXIyID0gdGhpcy55ZWFyMigpLCBtb250aCA9IHRoaXMubW9udGgoKSwgZGF5ID0gdGhpcy5kYXkoKSwgd2Vla0RheSA9IHRoaXMud2Vla0RheSgpO1xuICAgICAgICAgICAgdmFyIGhvdXIgPSB0aGlzLmhvdXIoKSwgbWludXRlID0gdGhpcy5taW51dGUoKSwgc2Vjb25kID0gdGhpcy5zZWNvbmQoKSwgbXMgPSB0aGlzLm1zKCk7XG4gICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHtcbiAgICAgICAgICAgICAgICBZWTogeWVhcjIsXG4gICAgICAgICAgICAgICAgWVlZWTogeWVhcixcbiAgICAgICAgICAgICAgICBNOiBtb250aCArIDEsXG4gICAgICAgICAgICAgICAgTU06IGxwYWQobW9udGggKyAxLCBcIjBcIiwgMiksXG4gICAgICAgICAgICAgICAgTU1NOiBuYW1lcy5tb250aHNTaG9ydFttb250aF0sXG4gICAgICAgICAgICAgICAgTU1NTTogbmFtZXMubW9udGhzW21vbnRoXSxcbiAgICAgICAgICAgICAgICBEOiBkYXksXG4gICAgICAgICAgICAgICAgREQ6IGxwYWQoZGF5LCBcIjBcIiwgMiksXG4gICAgICAgICAgICAgICAgZDogd2Vla0RheSxcbiAgICAgICAgICAgICAgICBkZDogbmFtZXMud2Vla2RheXNNaW5bd2Vla0RheV0sXG4gICAgICAgICAgICAgICAgZGRkOiBuYW1lcy53ZWVrZGF5c1Nob3J0W3dlZWtEYXldLFxuICAgICAgICAgICAgICAgIGRkZGQ6IG5hbWVzLndlZWtkYXlzW3dlZWtEYXldLFxuICAgICAgICAgICAgICAgIEg6IGhvdXIsXG4gICAgICAgICAgICAgICAgSEg6IGxwYWQoaG91ciwgXCIwXCIsIDIpLFxuICAgICAgICAgICAgICAgIG06IG1pbnV0ZSxcbiAgICAgICAgICAgICAgICBtbTogbHBhZChtaW51dGUsXCIwXCIsIDIpLFxuICAgICAgICAgICAgICAgIHM6IHNlY29uZCxcbiAgICAgICAgICAgICAgICBzczogbHBhZChzZWNvbmQsXCIwXCIsIDIpLFxuICAgICAgICAgICAgICAgIHNzczogbHBhZChtcyxcIjBcIiwgMylcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJldHVybiBmb3JtYXQucmVwbGFjZShSRUdFWF9GT1JNQVQsIGZ1bmN0aW9uKG1hdGNoLCAkMSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuICQxIHx8IG1hdGNoZXNbbWF0Y2hdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdmFsdWVPZjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLnZhbHVlT2YoKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLnRvU3RyaW5nKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnbG9iYWwuRGF0ZXRpbWUgPSBEYXRldGltZTtcbiAgICBnbG9iYWwuZGF0ZXRpbWUgPSBkYXRldGltZTtcblxufSh0eXBlb2Ygc2VsZiA9PT0gXCJ1bmRlZmluZWRcIiA/IHR5cGVvZiBnbG9iYWwgPT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiBnbG9iYWwgOiBzZWxmKSk7XG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGZuRm9ybWF0ID0gRGF0ZXRpbWUucHJvdG90eXBlLmZvcm1hdDtcblxuICAgIERhdGV0aW1lLnVzZSh7XG4gICAgICAgIGJ1ZGRoaXN0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMueWVhcigpICsgNTQzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGZvcm1hdDogZnVuY3Rpb24oZm9ybWF0LCBsb2NhbGUpe1xuICAgICAgICAgICAgZm9ybWF0ID0gZm9ybWF0IHx8IERhdGV0aW1lLkRFRkFVTFRfRk9STUFUO1xuICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSB7XG4gICAgICAgICAgICAgICAgQkI6ICh0aGlzLmJ1ZGRoaXN0KCkrXCJcIikuc2xpY2UoLTIpLFxuICAgICAgICAgICAgICAgIEJCQkI6IHRoaXMuYnVkZGhpc3QoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGZvcm1hdC5yZXBsYWNlKC8oXFxbW15cXF1dK10pfEJ7NH18QnsyfS9nLCBmdW5jdGlvbihtYXRjaCwgJDEpe1xuICAgICAgICAgICAgICAgIHJldHVybiAkMSB8fCBtYXRjaGVzW21hdGNoXTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICByZXR1cm4gZm5Gb3JtYXQuYmluZCh0aGlzKShyZXN1bHQsIGxvY2FsZSlcbiAgICAgICAgfVxuICAgIH0pO1xufSgpKTtccihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBEYXRldGltZS51c2Uoe1xuICAgICAgICBjYWxlbmRhcjogZnVuY3Rpb24oaXNvKXtcbiAgICAgICAgICAgIHJldHVybiBEYXRldGltZS5jYWxlbmRhcih0aGlzLCBpc28pO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBEYXRldGltZS51c2VTdGF0aWMoe1xuICAgICAgICBjYWxlbmRhcjogZnVuY3Rpb24oZCwgaXNvKXtcbiAgICAgICAgICAgIHZhciBkYXRlID0gZCBpbnN0YW5jZW9mIERhdGV0aW1lID8gZC5jbG9uZSgpLmFsaWduKFwibW9udGhcIikgOiBkYXRldGltZShkKTtcbiAgICAgICAgICAgIHZhciB3cyA9IGlzbyA9PT0gMCB8fCBpc28gPyBpc28gOiBkYXRlLndlZWtTdGFydDtcbiAgICAgICAgICAgIHZhciB3ZCA9IHdzID8gZGF0ZS5pc29XZWVrRGF5KCkgOiBkYXRlLndlZWtEYXkoKTtcbiAgICAgICAgICAgIHZhciBuYW1lcyA9IERhdGV0aW1lLmdldExvY2FsZShkYXRlLmxvY2FsZSk7XG4gICAgICAgICAgICB2YXIgbm93ID0gZGF0ZXRpbWUoKSwgaTtcblxuICAgICAgICAgICAgdmFyIGdldFdlZWtEYXlzID0gZnVuY3Rpb24gKHdkLCB3cyl7XG4gICAgICAgICAgICAgICAgaWYgKHdzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB3ZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHN1ID0gd2RbMF07XG4gICAgICAgICAgICAgICAgcmV0dXJuIHdkLnNsaWNlKDEpLmNvbmNhdChbc3VdKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICBtb250aDogbmFtZXMubW9udGhzW2RhdGUubW9udGgoKV0sXG4gICAgICAgICAgICAgICAgZGF5czogW10sXG4gICAgICAgICAgICAgICAgd2Vla3N0YXJ0OiBpc28gPyAxIDogMCxcbiAgICAgICAgICAgICAgICB3ZWVrZGF5czogZ2V0V2Vla0RheXMobmFtZXMud2Vla2RheXNNaW4sd3MpLFxuICAgICAgICAgICAgICAgIHRvZGF5OiBub3cuZm9ybWF0KFwiWVlZWS1NTS1ERFwiKSxcbiAgICAgICAgICAgICAgICB3ZWVrZW5kczogW10sXG4gICAgICAgICAgICAgICAgd2VlazogW11cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGRhdGUuYWRkRGF5KHdzID8gLXdkKzEgOiAtd2QpO1xuXG4gICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCA0MjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmRheXMucHVzaChkYXRlLmZvcm1hdChcIllZWVktTU0tRERcIikpO1xuICAgICAgICAgICAgICAgIGRhdGUuYWRkKDEsICdkYXknKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVzdWx0LndlZWtlbmRzID0gcmVzdWx0LmRheXMuZmlsdGVyKGZ1bmN0aW9uKHYsIGkpe1xuICAgICAgICAgICAgICAgIHZhciBkZWYgPSBbMCw2LDcsMTMsMTQsMjAsMjEsMjcsMjgsMzQsMzUsNDFdO1xuICAgICAgICAgICAgICAgIHZhciBpc28gPSBbNSw2LDEyLDEzLDE5LDIwLDI2LDI3LDMzLDM0LDQwLDQxXTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB3cyA9PT0gMCA/IGRlZi5pbmRleE9mKGkpID4gLTEgOiBpc28uaW5kZXhPZihpKSA+IC0xO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGRhdGUgPSBub3cuY2xvbmUoKTtcbiAgICAgICAgICAgIHdkID0gd3MgPyBkYXRlLmlzb1dlZWtEYXkoKSA6IGRhdGUud2Vla0RheSgpO1xuICAgICAgICAgICAgZGF0ZS5hZGREYXkod3MgPyAtd2QrMSA6IC13ZCk7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgNzsgaSsrKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LndlZWsucHVzaChkYXRlLmZvcm1hdChcIllZWVktTU0tRERcIikpO1xuICAgICAgICAgICAgICAgIGRhdGUuYWRkKDEsICdkYXknKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgIH0pO1xufSgpKTtcblxuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBvbGRGb3JtYXQgPSBEYXRldGltZS5wcm90b3R5cGUuZm9ybWF0O1xuXG4gICAgRGF0ZXRpbWUudXNlKHtcbiAgICAgICAgY2VudHVyeTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiBwYXJzZUludCh0aGlzLnllYXIoKSAvIDEwMCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZm9ybWF0OiBmdW5jdGlvbihmb3JtYXQsIGxvY2FsZSl7XG4gICAgICAgICAgICBmb3JtYXQgPSBmb3JtYXQgfHwgRGF0ZXRpbWUuREVGQVVMVF9GT1JNQVQ7XG4gICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHtcbiAgICAgICAgICAgICAgICBDOiB0aGlzLmNlbnR1cnkoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGZvcm1hdC5yZXBsYWNlKC8oXFxbW15cXF1dK10pfEMvZywgZnVuY3Rpb24obWF0Y2gsICQxKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gJDEgfHwgbWF0Y2hlc1ttYXRjaF07XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgcmV0dXJuIG9sZEZvcm1hdC5iaW5kKHRoaXMpKHJlc3VsdCwgbG9jYWxlKVxuICAgICAgICB9XG4gICAgfSlcbn0oKSk7XG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgRGF0ZXRpbWUudXNlKHtcbiAgICAgICAgc2FtZTogZnVuY3Rpb24oZCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50aW1lKCkgPT09IGRhdGV0aW1lKGQpLnRpbWUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgY29tcGFyZTogZnVuY3Rpb24oZCwgYWxpZ24sIG9wZXJhdG9yKXtcbiAgICAgICAgICAgIHZhciBkYXRlID0gZGF0ZXRpbWUoZCk7XG4gICAgICAgICAgICB2YXIgY3VyciA9IGRhdGV0aW1lKHRoaXMudmFsdWUpO1xuICAgICAgICAgICAgdmFyIHQxLCB0MjtcblxuICAgICAgICAgICAgb3BlcmF0b3IgPSBvcGVyYXRvciB8fCBcIj1cIjtcblxuICAgICAgICAgICAgaWYgKFtcIjxcIiwgXCI+XCIsIFwiPj1cIiwgXCI8PVwiLCBcIj1cIiwgXCIhPVwiXS5pbmRleE9mKG9wZXJhdG9yKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICBvcGVyYXRvciA9IFwiPVwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhbGlnbiA9IChhbGlnbiB8fCBcIm1zXCIpLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgICAgIHQxID0gY3Vyci5hbGlnbihhbGlnbikudGltZSgpO1xuICAgICAgICAgICAgdDIgPSBkYXRlLmFsaWduKGFsaWduKS50aW1lKCk7XG5cbiAgICAgICAgICAgIHN3aXRjaCAob3BlcmF0b3IpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiPFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdDEgPCB0MjtcbiAgICAgICAgICAgICAgICBjYXNlIFwiPlwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdDEgPiB0MjtcbiAgICAgICAgICAgICAgICBjYXNlIFwiPD1cIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQxIDw9IHQyO1xuICAgICAgICAgICAgICAgIGNhc2UgXCI+PVwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdDEgPj0gdDI7XG4gICAgICAgICAgICAgICAgY2FzZSBcIj1cIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQxID09PSB0MjtcbiAgICAgICAgICAgICAgICBjYXNlIFwiIT1cIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQxICE9PSB0MjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBiZXR3ZWVuOiBmdW5jdGlvbihkMSwgZDIpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMueW91bmdlcihkMSkgJiYgdGhpcy5vbGRlcihkMik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb2xkZXI6IGZ1bmN0aW9uKGRhdGUsIGFsaWduKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBhcmUoZGF0ZSwgYWxpZ24sIFwiPFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvbGRlck9yRXF1YWw6IGZ1bmN0aW9uKGRhdGUsIGFsaWduKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBhcmUoZGF0ZSwgYWxpZ24sIFwiPD1cIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgeW91bmdlcjogZnVuY3Rpb24oZGF0ZSwgYWxpZ24pe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tcGFyZShkYXRlLCBhbGlnbiwgXCI+XCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHlvdW5nZXJPckVxdWFsOiBmdW5jdGlvbihkYXRlLCBhbGlnbil7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb21wYXJlKGRhdGUsIGFsaWduLCBcIj49XCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGVxdWFsOiBmdW5jdGlvbihkYXRlLCBhbGlnbil7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb21wYXJlKGRhdGUsIGFsaWduLCBcIj1cIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbm90RXF1YWw6IGZ1bmN0aW9uKGRhdGUsIGFsaWduKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBhcmUoZGF0ZSwgYWxpZ24sIFwiIT1cIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlmZjogZnVuY3Rpb24oZCl7XG4gICAgICAgICAgICB2YXIgZGF0ZSA9IGRhdGV0aW1lKGQpO1xuICAgICAgICAgICAgdmFyIGRpZmYgPSBNYXRoLmFicyh0aGlzLnRpbWUoKSAtIGRhdGUudGltZSgpKTtcbiAgICAgICAgICAgIHZhciBkaWZmTW9udGggPSBNYXRoLmFicyh0aGlzLm1vbnRoKCkgLSBkYXRlLm1vbnRoKCkgKyAoMTIgKiAodGhpcy55ZWFyKCkgLSBkYXRlLnllYXIoKSkpKTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBcIm1zXCI6IGRpZmYsXG4gICAgICAgICAgICAgICAgXCJzZWNvbmRcIjogTWF0aC5jZWlsKGRpZmYgLyAxMDAwKSxcbiAgICAgICAgICAgICAgICBcIm1pbnV0ZVwiOiBNYXRoLmNlaWwoZGlmZiAvICgxMDAwICogNjApKSxcbiAgICAgICAgICAgICAgICBcImhvdXJcIjogTWF0aC5jZWlsKGRpZmYgLyAoMTAwMCAqIDYwICogNjApKSxcbiAgICAgICAgICAgICAgICBcImRheVwiOiBNYXRoLmNlaWwoZGlmZiAvICgxMDAwICogNjAgKiA2MCAqIDI0KSksXG4gICAgICAgICAgICAgICAgXCJtb250aFwiOiBkaWZmTW9udGgsXG4gICAgICAgICAgICAgICAgXCJ5ZWFyXCI6IE1hdGguZmxvb3IoZGlmZk1vbnRoIC8gMTIpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlzdGFuY2U6IGZ1bmN0aW9uKGQsIGFsaWduKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRpZmYoZClbYWxpZ25dO1xuICAgICAgICB9XG4gICAgfSlcbn0oKSk7XG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgRGF0ZXRpbWUudXNlKHtcbiAgICAgICAgZGF5T2ZZZWFyOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGRheUNvdW50ID0gWzAsIDMxLCA1OSwgOTAsIDEyMCwgMTUxLCAxODEsIDIxMiwgMjQzLCAyNzMsIDMwNCwgMzM0XTtcbiAgICAgICAgICAgIHZhciBtb250aCA9IHRoaXMubW9udGgoKTtcbiAgICAgICAgICAgIHZhciBkYXkgPSB0aGlzLmRheSgpO1xuICAgICAgICAgICAgcmV0dXJuIGRheUNvdW50W21vbnRoXSArIGRheSArICgobW9udGggPiAxICYmIHRoaXMuaXNMZWFwWWVhcigpKSA/IDEgOiAwKTtcbiAgICAgICAgfVxuICAgIH0pXG59KCkpO1xuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIERhdGV0aW1lLnVzZSh7XG4gICAgICAgIGRheXNJbk1vbnRoOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGN1cnIgPSBkYXRldGltZSh0aGlzLnZhbHVlKTtcbiAgICAgICAgICAgIHJldHVybiBjdXJyLmFkZCgxLCAnbW9udGgnKS5kYXkoMSkuYWRkKC0xLCAnZGF5JykuZGF5KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGF5c0luWWVhcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzTGVhcFllYXIoKSA/IDM2NiA6IDM2NTtcbiAgICAgICAgfSxcblxuICAgICAgICBkYXlzSW5ZZWFyTWFwOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgICAgICAgICAgdmFyIGN1cnIgPSBkYXRldGltZSh0aGlzLnZhbHVlKTtcblxuICAgICAgICAgICAgY3Vyci5tb250aCgwKS5kYXkoMSk7XG5cbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCAxMjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY3Vyci5hZGQoMSwgJ21vbnRoJykuYWRkKC0xLCAnZGF5Jyk7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goY3Vyci5kYXkoKSk7XG4gICAgICAgICAgICAgICAgY3Vyci5kYXkoMSkuYWRkKDEsICdtb250aCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSxcblxuICAgICAgICBkYXlzSW5ZZWFyT2JqOiBmdW5jdGlvbihsb2NhbGUsIHNob3J0TmFtZSl7XG4gICAgICAgICAgICB2YXIgbWFwID0gdGhpcy5kYXlzSW5ZZWFyTWFwKCk7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgICAgICAgICB2YXIgbmFtZXMgPSBEYXRldGltZS5nZXRMb2NhbGUobG9jYWxlIHx8IHRoaXMubG9jYWxlKTtcblxuICAgICAgICAgICAgbWFwLmZvckVhY2goZnVuY3Rpb24odiwgaSl7XG4gICAgICAgICAgICAgICAgcmVzdWx0W25hbWVzW3Nob3J0TmFtZSA/ICdtb250aHNTaG9ydCcgOiAnbW9udGhzJ11baV1dID0gdjtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgfSlcbn0oKSk7XG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgRGF0ZXRpbWUudXNlKHtcbiAgICAgICAgZGVjYWRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IodGhpcy55ZWFyKCkvMTApICogMTA7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVjYWRlU3RhcnQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZGVjYWRlID0gdGhpcy5kZWNhZGUoKTtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLm11dGFibGUgPyB0aGlzIDogdGhpcy5jbG9uZSgpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0LnllYXIoZGVjYWRlKS5tb250aCgwKS5kYXkoMSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVjYWRlRW5kOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGRlY2FkZSA9IHRoaXMuZGVjYWRlKCkgKyA5O1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXMubXV0YWJsZSA/IHRoaXMgOiB0aGlzLmNsb25lKCk7XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQueWVhcihkZWNhZGUpLm1vbnRoKDExKS5kYXkoMzEpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlY2FkZU9mTW9udGg6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgcGFydCA9IHRoaXMuY2xvbmUoKS5hZGQoMSwgXCJtb250aFwiKS5kYXkoMSkuYWRkKC0xLCAnZGF5JykuZGF5KCkgLyAzO1xuICAgICAgICAgICAgdmFyIGRheSA9IHRoaXMuZGF5KCk7XG5cbiAgICAgICAgICAgIGlmIChkYXkgPD0gcGFydCkgcmV0dXJuIDE7XG4gICAgICAgICAgICBpZiAoZGF5IDw9IHBhcnQgKiAyKSByZXR1cm4gMjtcbiAgICAgICAgICAgIHJldHVybiAzO1xuICAgICAgICB9XG4gICAgfSlcbn0oKSk7XG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgRGF0ZXRpbWUudXNlU3RhdGljKHtcbiAgICAgICAgZnJvbTogZnVuY3Rpb24oc3RyLCBmb3JtYXQsIGxvY2FsZSl7XG4gICAgICAgICAgICB2YXIgbm9ybSwgbm9ybUZvcm1hdCwgZkl0ZW1zLCBkSXRlbXM7XG4gICAgICAgICAgICB2YXIgaU1vbnRoLCBpRGF5LCBpWWVhciwgaUhvdXIsIGlNaW51dGUsIGlTZWNvbmQsIGlNcztcbiAgICAgICAgICAgIHZhciB5ZWFyLCBtb250aCwgZGF5LCBob3VyLCBtaW51dGUsIHNlY29uZCwgbXM7XG4gICAgICAgICAgICB2YXIgcGFyc2VkTW9udGg7XG5cbiAgICAgICAgICAgIHZhciBnZXRJbmRleCA9IGZ1bmN0aW9uKHdoZXJlLCB3aGF0KXtcbiAgICAgICAgICAgICAgICByZXR1cm4gd2hlcmUubWFwKGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgfSkuaW5kZXhPZih3aGF0LnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgbW9udGhOYW1lVG9OdW1iZXIgPSBmdW5jdGlvbihtb250aCl7XG4gICAgICAgICAgICAgICAgdmFyIGkgPSAtMTtcbiAgICAgICAgICAgICAgICB2YXIgbmFtZXMgPSBEYXRldGltZS5nZXRMb2NhbGUobG9jYWxlIHx8ICdlbicpO1xuXG4gICAgICAgICAgICAgICAgaWYgKERhdGV0aW1lLm5vdChtb250aCkpIHJldHVybiAtMTtcblxuICAgICAgICAgICAgICAgIGkgPSBnZXRJbmRleChuYW1lcy5tb250aHMsIG1vbnRoKTtcblxuICAgICAgICAgICAgICAgIGlmIChpID09PSAtMSAmJiB0eXBlb2YgbmFtZXNbXCJtb250aHNQYXJlbnRhbFwiXSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgICAgICBpID0gZ2V0SW5kZXgobmFtZXMubW9udGhzUGFyZW50YWwsIG1vbnRoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgbW9udGggPSBtb250aC5zdWJzdHIoMCwgMyk7XG4gICAgICAgICAgICAgICAgICAgIGkgPSBnZXRJbmRleChuYW1lcy5tb250aHNTaG9ydCwgbW9udGgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBpID09PSAtMSA/IC0xIDogaSArIDE7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgZ2V0UGFydEluZGV4ID0gZnVuY3Rpb24ocGFydCl7XG4gICAgICAgICAgICAgICAgdmFyIHBhcnRzID0ge1xuICAgICAgICAgICAgICAgICAgICBcIm1vbnRoXCI6IFtcIk1cIiwgXCJtbVwiLCBcIiVtXCJdLFxuICAgICAgICAgICAgICAgICAgICBcImRheVwiOiBbXCJEXCIsIFwiZGRcIiwgXCIlZFwiXSxcbiAgICAgICAgICAgICAgICAgICAgXCJ5ZWFyXCI6IFtcIllZXCIsIFwiWVlZWVwiLCBcInl5XCIsIFwieXl5eVwiLCBcIiV5XCJdLFxuICAgICAgICAgICAgICAgICAgICBcImhvdXJcIjogW1wiaFwiLCBcImhoXCIsIFwiJWhcIl0sXG4gICAgICAgICAgICAgICAgICAgIFwibWludXRlXCI6IFtcIm1cIiwgXCJtaVwiLCBcImlcIiwgXCJpaVwiLCBcIiVpXCJdLFxuICAgICAgICAgICAgICAgICAgICBcInNlY29uZFwiOiBbXCJzXCIsIFwic3NcIiwgXCIlc1wiXSxcbiAgICAgICAgICAgICAgICAgICAgXCJtc1wiOiBbXCJzc3NcIl1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gLTEsIGtleSwgaW5kZXg7XG5cbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgcGFydHNbcGFydF0ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAga2V5ID0gcGFydHNbcGFydF1baV07XG4gICAgICAgICAgICAgICAgICAgIGluZGV4ID0gZkl0ZW1zLmluZGV4T2Yoa2V5KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gaW5kZXg7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChEYXRldGltZS5ub3QoZm9ybWF0KSB8fCAoXCJcIitmb3JtYXQpLnRyaW0oKSA9PT0gXCJcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRldGltZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbm9ybSA9IHN0ci5yZXBsYWNlKC9bXFwvLC46XFxzXS9nLCAnLScpO1xuICAgICAgICAgICAgbm9ybUZvcm1hdCA9IGZvcm1hdC50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1teYS16QS1aMC05JV0vZywgJy0nKTtcbiAgICAgICAgICAgIGZJdGVtcyA9IG5vcm1Gb3JtYXQuc3BsaXQoJy0nKTtcbiAgICAgICAgICAgIGRJdGVtcyA9IG5vcm0uc3BsaXQoJy0nKTtcblxuICAgICAgICAgICAgaWYgKG5vcm0ucmVwbGFjZSgvLS9nLFwiXCIpLnRyaW0oKSA9PT0gXCJcIikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihEYXRldGltZS5JTlZBTElEX0RBVEUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpTW9udGggPSBnZXRQYXJ0SW5kZXgoXCJtb250aFwiKTtcbiAgICAgICAgICAgIGlEYXkgPSBnZXRQYXJ0SW5kZXgoXCJkYXlcIik7XG4gICAgICAgICAgICBpWWVhciA9IGdldFBhcnRJbmRleChcInllYXJcIik7XG4gICAgICAgICAgICBpSG91ciA9IGdldFBhcnRJbmRleChcImhvdXJcIik7XG4gICAgICAgICAgICBpTWludXRlID0gZ2V0UGFydEluZGV4KFwibWludXRlXCIpO1xuICAgICAgICAgICAgaVNlY29uZCA9IGdldFBhcnRJbmRleChcInNlY29uZFwiKTtcbiAgICAgICAgICAgIGlNcyA9IGdldFBhcnRJbmRleChcIm1zXCIpO1xuXG4gICAgICAgICAgICBpZiAoaU1vbnRoID4gLTEgJiYgZEl0ZW1zW2lNb250aF0pIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNOYU4ocGFyc2VJbnQoZEl0ZW1zW2lNb250aF0pKSkge1xuICAgICAgICAgICAgICAgICAgICBkSXRlbXNbaU1vbnRoXSA9IG1vbnRoTmFtZVRvTnVtYmVyKGRJdGVtc1tpTW9udGhdKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRJdGVtc1tpTW9udGhdID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaU1vbnRoID0gLTE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwYXJzZWRNb250aCA9IHBhcnNlSW50KGRJdGVtc1tpTW9udGhdKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlZE1vbnRoIDwgMSB8fCBwYXJzZWRNb250aCA+IDEyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpTW9udGggPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaU1vbnRoID0gLTE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHllYXIgID0gaVllYXIgPiAtMSAmJiBkSXRlbXNbaVllYXJdID8gZEl0ZW1zW2lZZWFyXSA6IDA7XG4gICAgICAgICAgICBtb250aCA9IGlNb250aCA+IC0xICYmIGRJdGVtc1tpTW9udGhdID8gZEl0ZW1zW2lNb250aF0gOiAxO1xuICAgICAgICAgICAgZGF5ICAgPSBpRGF5ID4gLTEgJiYgZEl0ZW1zW2lEYXldID8gZEl0ZW1zW2lEYXldIDogMTtcblxuICAgICAgICAgICAgaG91ciAgICA9IGlIb3VyID4gLTEgJiYgZEl0ZW1zW2lIb3VyXSA/IGRJdGVtc1tpSG91cl0gOiAwO1xuICAgICAgICAgICAgbWludXRlICA9IGlNaW51dGUgPiAtMSAmJiBkSXRlbXNbaU1pbnV0ZV0gPyBkSXRlbXNbaU1pbnV0ZV0gOiAwO1xuICAgICAgICAgICAgc2Vjb25kICA9IGlTZWNvbmQgPiAtMSAmJiBkSXRlbXNbaVNlY29uZF0gPyBkSXRlbXNbaVNlY29uZF0gOiAwO1xuICAgICAgICAgICAgbXMgID0gaU1zID4gLTEgJiYgZEl0ZW1zW2lNc10gPyBkSXRlbXNbaU1zXSA6IDA7XG5cbiAgICAgICAgICAgIHJldHVybiBkYXRldGltZSh5ZWFyLCBtb250aC0xLCBkYXksIGhvdXIsIG1pbnV0ZSwgc2Vjb25kLCBtcyk7XG4gICAgICAgIH1cbiAgICB9KVxufSgpKTtcbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgZm5Gb3JtYXQgPSBEYXRldGltZS5wcm90b3R5cGUuZm9ybWF0O1xuICAgIHZhciBscGFkID0gRGF0ZXRpbWUubHBhZDtcblxuICAgIERhdGV0aW1lLnVzZSh7XG4gICAgICAgIGFtcG06IGZ1bmN0aW9uKGlzTG93ZXJDYXNlKXtcbiAgICAgICAgICAgIHZhciB2YWwgPSB0aGlzLmhvdXIoKSA8IDEyID8gXCJBTVwiIDogXCJQTVwiO1xuICAgICAgICAgICAgcmV0dXJuIGlzTG93ZXJDYXNlID8gdmFsLnRvTG93ZXJDYXNlKCkgOiB2YWw7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaG91cjEyOiBmdW5jdGlvbihoLCBwKXtcbiAgICAgICAgICAgIHZhciBob3VyID0gaDtcblxuICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ob3VyKCkgJSAxMjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcCA9IHAgfHwgJ2FtJztcblxuICAgICAgICAgICAgaWYgKHAudG9Mb3dlckNhc2UoKSA9PT0gXCJwbVwiKSB7XG4gICAgICAgICAgICAgICAgaG91ciArPSAxMjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaG91cihob3VyKTtcbiAgICAgICAgfSxcblxuICAgICAgICBmb3JtYXQ6IGZ1bmN0aW9uKGZvcm1hdCwgbG9jYWxlKXtcbiAgICAgICAgICAgIHZhciBtYXRjaGVzLCByZXN1bHQsIGgxMiA9IHRoaXMuaG91cjEyKCk7XG5cbiAgICAgICAgICAgIGZvcm1hdCA9IGZvcm1hdCB8fCBEYXRldGltZS5ERUZBVUxUX0ZPUk1BVDtcblxuICAgICAgICAgICAgbWF0Y2hlcyA9IHtcbiAgICAgICAgICAgICAgICBhOiBcIltcIit0aGlzLmFtcG0odHJ1ZSkrXCJdXCIsXG4gICAgICAgICAgICAgICAgQTogXCJbXCIrdGhpcy5hbXBtKGZhbHNlKStcIl1cIixcbiAgICAgICAgICAgICAgICBoOiBoMTIsXG4gICAgICAgICAgICAgICAgaGg6IGxwYWQoaDEyLCBcIjBcIiwgMilcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJlc3VsdCA9IGZvcm1hdC5yZXBsYWNlKC8oXFxbW15cXF1dK10pfGF8QXxoezEsMn0vZywgZnVuY3Rpb24obWF0Y2gsICQxKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gJDEgfHwgbWF0Y2hlc1ttYXRjaF07XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGZuRm9ybWF0LmJpbmQodGhpcykocmVzdWx0LCBsb2NhbGUpXG4gICAgICAgIH1cbiAgICB9KVxufSgpKTtcbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBEYXRldGltZS51c2Uoe1xuICAgICAgICBpc0xlYXBZZWFyOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHllYXIgPSB0aGlzLnllYXIoKTtcbiAgICAgICAgICAgIHJldHVybiAoeWVhciAlIDQgPT09IDAgJiYgeWVhciAlIDEwMCAhPT0gMCkgfHwgeWVhciAlIDQwMCA9PT0gMDtcbiAgICAgICAgfVxuICAgIH0pXG59KCkpO1xuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBmbkZvcm1hdCA9IERhdGV0aW1lLnByb3RvdHlwZS5mb3JtYXQ7XG4gICAgdmFyIGZuQWxpZ24gPSBEYXRldGltZS5hbGlnbjtcbiAgICB2YXIgZm5BbGlnbkVuZCA9IERhdGV0aW1lLmFsaWduRW5kO1xuXG4gICAgRGF0ZXRpbWUudXNlU3RhdGljKHtcbiAgICAgICAgYWxpZ246IGZ1bmN0aW9uKGQsIGFsaWduKXtcbiAgICAgICAgICAgIHZhciBkYXRlID0gZCBpbnN0YW5jZW9mIERhdGV0aW1lID8gZCA6IGRhdGV0aW1lKGQpLFxuICAgICAgICAgICAgICAgIHJlc3VsdCwgdGVtcDtcblxuICAgICAgICAgICAgc3dpdGNoKGFsaWduKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImlzb1dlZWtcIjpcbiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IGRhdGUuaXNvV2Vla0RheSgpO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmbkFsaWduKGRhdGUsICdkYXknKS5hZGREYXkoLXRlbXAgKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7IC8vIGlzb1dlZWtcblxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHJlc3VsdCA9IGZuQWxpZ24uYXBwbHkodGhpcywgW2RhdGUsIGFsaWduXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYWxpZ25FbmQ6IGZ1bmN0aW9uKGQsIGFsaWduKXtcbiAgICAgICAgICAgIHZhciBkYXRlID0gZCBpbnN0YW5jZW9mIERhdGV0aW1lID8gZCA6IGRhdGV0aW1lKGQpLFxuICAgICAgICAgICAgICAgIHJlc3VsdCwgdGVtcDtcblxuICAgICAgICAgICAgc3dpdGNoKGFsaWduKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImlzb1dlZWtcIjpcbiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IGRhdGUuaXNvV2Vla0RheSgpO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmbkFsaWduRW5kKGRhdGUsICdkYXknKS5hZGREYXkoNyAtIHRlbXApO1xuICAgICAgICAgICAgICAgICAgICBicmVhazsgLy8gaXNvV2Vla1xuXG4gICAgICAgICAgICAgICAgZGVmYXVsdDogcmVzdWx0ID0gZm5BbGlnbkVuZC5hcHBseSh0aGlzLCBbZGF0ZSwgYWxpZ25dKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICBEYXRldGltZS51c2Uoe1xuICAgICAgICBpc29XZWVrRGF5OiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgdmFyIHdkID0gKHRoaXMud2Vla0RheSgpICsgNikgJSA3ICsgMTtcblxuICAgICAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoIHx8IChEYXRldGltZS5ub3QodmFsKSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gd2Q7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZERheSh2YWwgLSB3ZCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZm9ybWF0OiBmdW5jdGlvbihmb3JtYXQsIGxvY2FsZSl7XG4gICAgICAgICAgICBmb3JtYXQgPSBmb3JtYXQgfHwgRGF0ZXRpbWUuREVGQVVMVF9GT1JNQVQ7XG4gICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHtcbiAgICAgICAgICAgICAgICBJOiB0aGlzLmlzb1dlZWtEYXkoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGZvcm1hdC5yZXBsYWNlKC8oXFxbW15cXF1dK10pfEl7MSwyfS9nLCBmdW5jdGlvbihtYXRjaCwgJDEpe1xuICAgICAgICAgICAgICAgIHJldHVybiAkMSB8fCBtYXRjaGVzW21hdGNoXTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICByZXR1cm4gZm5Gb3JtYXQuYmluZCh0aGlzKShyZXN1bHQsIGxvY2FsZSlcbiAgICAgICAgfVxuICAgIH0pXG59KCkpO1xuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIERhdGV0aW1lLnVzZVN0YXRpYyh7XG4gICAgICAgIG1heDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBhcnIgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XG5cbiAgICAgICAgICAgIHJldHVybiBhcnIubWFwKGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZXRpbWUoZWwpO1xuICAgICAgICAgICAgfSkuc29ydChmdW5jdGlvbihhLCBiKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gYi50aW1lKCkgLSBhLnRpbWUoKVxuICAgICAgICAgICAgfSlbMF07XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIERhdGV0aW1lLnVzZSh7XG4gICAgICAgIG1heDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiBEYXRldGltZS5tYXguYXBwbHkodGhpcywgW3RoaXNdLmNvbmNhdChbXS5zbGljZS5jYWxsKGFyZ3VtZW50cykpKTtcbiAgICAgICAgfVxuICAgIH0pO1xufSgpKTtcbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBEYXRldGltZS51c2VTdGF0aWMoe1xuICAgICAgICBtaW46IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgYXJyID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuXG4gICAgICAgICAgICByZXR1cm4gYXJyLm1hcChmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGV0aW1lKGVsKTtcbiAgICAgICAgICAgIH0pLnNvcnQoZnVuY3Rpb24oYSwgYil7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGEudGltZSgpIC0gYi50aW1lKClcbiAgICAgICAgICAgIH0pWzBdO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBEYXRldGltZS51c2Uoe1xuICAgICAgICBtaW46IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gRGF0ZXRpbWUubWluLmFwcGx5KHRoaXMsIFt0aGlzXS5jb25jYXQoW10uc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7XG4gICAgICAgIH1cbiAgICB9KVxufSgpKTtcbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgZm5BbGlnbiA9IERhdGV0aW1lLmFsaWduO1xuICAgIHZhciBmbkFsaWduRW5kID0gRGF0ZXRpbWUuYWxpZ25FbmQ7XG4gICAgdmFyIGZuQWRkID0gRGF0ZXRpbWUucHJvdG90eXBlLmFkZDtcblxuICAgIERhdGV0aW1lLnVzZVN0YXRpYyh7XG4gICAgICAgIGFsaWduOiBmdW5jdGlvbihkLCBhbGlnbil7XG4gICAgICAgICAgICB2YXIgZGF0ZSA9IGQgaW5zdGFuY2VvZiBEYXRldGltZSA/IGQgOiBkYXRldGltZShkKSxcbiAgICAgICAgICAgICAgICByZXN1bHQ7XG5cbiAgICAgICAgICAgIHN3aXRjaChhbGlnbikge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJxdWFydGVyXCI6ICByZXN1bHQgPSBEYXRldGltZS5hbGlnbihkYXRlLCAnZGF5JykuZGF5KDEpLm1vbnRoKGRhdGUucXVhcnRlcigpICogMyAtIDMpOyBicmVhazsgLy9xdWFydGVyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDogcmVzdWx0ID0gZm5BbGlnbi5hcHBseSh0aGlzLCBbZGF0ZSwgYWxpZ25dKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSxcblxuICAgICAgICBhbGlnbkVuZDogZnVuY3Rpb24oZCwgYWxpZ24pe1xuICAgICAgICAgICAgdmFyIGRhdGUgPSBkIGluc3RhbmNlb2YgRGF0ZXRpbWUgPyBkIDogZGF0ZXRpbWUoZCksXG4gICAgICAgICAgICAgICAgcmVzdWx0O1xuXG4gICAgICAgICAgICBzd2l0Y2goYWxpZ24pIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwicXVhcnRlclwiOiAgcmVzdWx0ID0gRGF0ZXRpbWUuYWxpZ24oZGF0ZSwgJ3F1YXJ0ZXInKS5hZGQoMywgJ21vbnRoJykuYWRkKC0xLCAnbXMnKTsgYnJlYWs7IC8vcXVhcnRlclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHJlc3VsdCA9IGZuQWxpZ25FbmQuYXBwbHkodGhpcywgW2RhdGUsIGFsaWduXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgRGF0ZXRpbWUudXNlKHtcbiAgICAgICAgcXVhcnRlcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBtb250aCA9IHRoaXMubW9udGgoKTtcblxuICAgICAgICAgICAgaWYgKG1vbnRoIDw9IDIpIHJldHVybiAxO1xuICAgICAgICAgICAgaWYgKG1vbnRoIDw9IDUpIHJldHVybiAyO1xuICAgICAgICAgICAgaWYgKG1vbnRoIDw9IDgpIHJldHVybiAzO1xuICAgICAgICAgICAgcmV0dXJuIDQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYWRkOiBmdW5jdGlvbih2YWwsIHRvKXtcbiAgICAgICAgICAgIGlmICh0byA9PT0gXCJxdWFydGVyXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tb250aCh0aGlzLm1vbnRoKCkgKyB2YWwgKiAzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmbkFkZC5iaW5kKHRoaXMpKHZhbCwgdG8pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFkZFF1YXJ0ZXI6IGZ1bmN0aW9uKHYpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkKHYsIFwicXVhcnRlclwiKTtcbiAgICAgICAgfVxuICAgIH0pXG59KCkpO1xuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIERhdGV0aW1lLnVzZVN0YXRpYyh7XG4gICAgICAgIHNvcnQ6IGZ1bmN0aW9uKGFyciwgb3B0KXtcbiAgICAgICAgICAgIHZhciByZXN1bHQsIF9hcnI7XG4gICAgICAgICAgICB2YXIgbyA9IHt9O1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIG9wdCA9PT0gXCJzdHJpbmdcIiB8fCB0eXBlb2Ygb3B0ICE9PSBcIm9iamVjdFwiIHx8IERhdGV0aW1lLm5vdChvcHQpKSB7XG4gICAgICAgICAgICAgICAgby5mb3JtYXQgPSBEYXRldGltZS5ERUZBVUxUX0ZPUk1BVDtcbiAgICAgICAgICAgICAgICBvLmRpciA9IG9wdCAmJiBvcHQudG9VcHBlckNhc2UoKSA9PT0gXCJERVNDXCIgPyBcIkRFU0NcIiA6IFwiQVNDXCI7XG4gICAgICAgICAgICAgICAgby5yZXR1cm5BcyA9IFwiZGF0ZXRpbWVcIjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgby5mb3JtYXQgPSBvcHQuZm9ybWF0IHx8IERhdGV0aW1lLkRFRkFVTFRfRk9STUFUO1xuICAgICAgICAgICAgICAgIG8uZGlyID0gKG9wdC5kaXIgfHwgXCJBU0NcIikudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgICAgICBvLnJldHVybkFzID0gb3B0LmZvcm1hdCA/IFwic3RyaW5nXCIgOiBvcHQucmV0dXJuQXMgfHwgXCJkYXRldGltZVwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBfYXJyID0gIGFyci5tYXAoZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRldGltZShlbCk7XG4gICAgICAgICAgICB9KS5zb3J0KGZ1bmN0aW9uKGEsIGIpe1xuICAgICAgICAgICAgICAgIHJldHVybiBhLnZhbHVlT2YoKSAtIGIudmFsdWVPZigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChvLmRpciA9PT0gXCJERVNDXCIpIHtcbiAgICAgICAgICAgICAgICBfYXJyLnJldmVyc2UoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3dpdGNoIChvLnJldHVybkFzKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcInN0cmluZ1wiOlxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBfYXJyLm1hcChmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWwuZm9ybWF0KG8uZm9ybWF0KVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGVcIjpcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gX2Fyci5tYXAoZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsLnZhbCgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBkZWZhdWx0OiByZXN1bHQgPSBfYXJyO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgfSlcbn0oKSk7XG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIFJFR0VYX0ZPUk1BVF9TVFJGVElNRSA9IC8oJVthLXpdKS9naTtcbiAgICB2YXIgREVGQVVMVF9GT1JNQVRfU1RSRlRJTUUgPSBcIiVZLSVtLSVkVCVIOiVNOiVTLiVRJXRcIjtcblxuICAgIHZhciBscGFkID0gRGF0ZXRpbWUubHBhZDtcblxuICAgIERhdGV0aW1lLnVzZSh7XG4gICAgICAgIHN0cmZ0aW1lOiBmdW5jdGlvbihmbXQsIGxvY2FsZSl7XG4gICAgICAgICAgICB2YXIgZm9ybWF0ID0gZm10IHx8IERFRkFVTFRfRk9STUFUX1NUUkZUSU1FO1xuICAgICAgICAgICAgdmFyIG5hbWVzID0gRGF0ZXRpbWUuZ2V0TG9jYWxlKGxvY2FsZSB8fCB0aGlzLmxvY2FsZSk7XG4gICAgICAgICAgICB2YXIgeWVhciA9IHRoaXMueWVhcigpLCB5ZWFyMiA9IHRoaXMueWVhcjIoKSwgbW9udGggPSB0aGlzLm1vbnRoKCksIGRheSA9IHRoaXMuZGF5KCksIHdlZWtEYXkgPSB0aGlzLndlZWtEYXkoKTtcbiAgICAgICAgICAgIHZhciBob3VyID0gdGhpcy5ob3VyKCksIGhvdXIxMiA9IHRoaXMuaG91cjEyKCksIG1pbnV0ZSA9IHRoaXMubWludXRlKCksIHNlY29uZCA9IHRoaXMuc2Vjb25kKCksIG1zID0gdGhpcy5tcygpLCB0aW1lID0gdGhpcy50aW1lKCk7XG4gICAgICAgICAgICB2YXIgYURheSA9IGxwYWQoZGF5LCBcIjBcIiwgMiksXG4gICAgICAgICAgICAgICAgYU1vbnRoID0gbHBhZChtb250aCArIDEsIFwiMFwiLCAyKSxcbiAgICAgICAgICAgICAgICBhSG91ciA9IGxwYWQoaG91ciwgXCIwXCIsIDIpLFxuICAgICAgICAgICAgICAgIGFIb3VyMTIgPSBscGFkKGhvdXIxMiwgXCIwXCIsIDIpLFxuICAgICAgICAgICAgICAgIGFNaW51dGUgPSBscGFkKG1pbnV0ZSwgXCIwXCIsIDIpLFxuICAgICAgICAgICAgICAgIGFTZWNvbmQgPSBscGFkKHNlY29uZCwgXCIwXCIsIDIpLFxuICAgICAgICAgICAgICAgIGFNcyA9IGxwYWQobXMsIFwiMFwiLCAzKTtcblxuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgdGh1cnNkYXkgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSBkYXRldGltZSh0aGF0LnZhbHVlKTtcbiAgICAgICAgICAgICAgICB0YXJnZXQuZGF5KHRoYXQuZGF5KCkgLSAoKHRoYXQud2Vla0RheSgpICsgNikgJSA3KSArIDMpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHtcbiAgICAgICAgICAgICAgICAnJWEnOiBuYW1lcy53ZWVrZGF5c1Nob3J0W3dlZWtEYXldLFxuICAgICAgICAgICAgICAgICclQSc6IG5hbWVzLndlZWtkYXlzW3dlZWtEYXldLFxuICAgICAgICAgICAgICAgICclYic6IG5hbWVzLm1vbnRoc1Nob3J0W21vbnRoXSxcbiAgICAgICAgICAgICAgICAnJWgnOiBuYW1lcy5tb250aHNTaG9ydFttb250aF0sXG4gICAgICAgICAgICAgICAgJyVCJzogbmFtZXMubW9udGhzW21vbnRoXSxcbiAgICAgICAgICAgICAgICAnJWMnOiB0aGlzLnRvU3RyaW5nKCkuc3Vic3RyaW5nKDAsIHRoaXMudG9TdHJpbmcoKS5pbmRleE9mKFwiIChcIikpLFxuICAgICAgICAgICAgICAgICclQyc6IHRoaXMuY2VudHVyeSgpLFxuICAgICAgICAgICAgICAgICclZCc6IGFEYXksXG4gICAgICAgICAgICAgICAgJyVEJzogW2FEYXksIGFNb250aCwgeWVhcl0uam9pbihcIi9cIiksXG4gICAgICAgICAgICAgICAgJyVlJzogZGF5LFxuICAgICAgICAgICAgICAgICclRic6IFt5ZWFyLCBhTW9udGgsIGFEYXldLmpvaW4oXCItXCIpLFxuICAgICAgICAgICAgICAgICclRyc6IHRodXJzZGF5KCkueWVhcigpLFxuICAgICAgICAgICAgICAgICclZyc6IChcIlwiK3RodXJzZGF5KCkueWVhcigpKS5zbGljZSgyKSxcbiAgICAgICAgICAgICAgICAnJUgnOiBhSG91cixcbiAgICAgICAgICAgICAgICAnJUknOiBhSG91cjEyLFxuICAgICAgICAgICAgICAgICclaic6IGxwYWQodGhpcy5kYXlPZlllYXIoKSwgXCIwXCIsIDMpLFxuICAgICAgICAgICAgICAgICclayc6IGFIb3VyLFxuICAgICAgICAgICAgICAgICclbCc6IGFIb3VyMTIsXG4gICAgICAgICAgICAgICAgJyVtJzogYU1vbnRoLFxuICAgICAgICAgICAgICAgICclbic6IG1vbnRoICsgMSxcbiAgICAgICAgICAgICAgICAnJU0nOiBhTWludXRlLFxuICAgICAgICAgICAgICAgICclcCc6IHRoaXMuYW1wbSgpLFxuICAgICAgICAgICAgICAgICclUCc6IHRoaXMuYW1wbSh0cnVlKSxcbiAgICAgICAgICAgICAgICAnJXMnOiBNYXRoLnJvdW5kKHRpbWUgLyAxMDAwKSxcbiAgICAgICAgICAgICAgICAnJVMnOiBhU2Vjb25kLFxuICAgICAgICAgICAgICAgICcldSc6IHRoaXMuaXNvV2Vla0RheSgpLFxuICAgICAgICAgICAgICAgICclVic6IHRoaXMuaXNvV2Vla051bWJlcigpLFxuICAgICAgICAgICAgICAgICcldyc6IHdlZWtEYXksXG4gICAgICAgICAgICAgICAgJyV4JzogdGhpcy50b0xvY2FsZURhdGVTdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAnJVgnOiB0aGlzLnRvTG9jYWxlVGltZVN0cmluZygpLFxuICAgICAgICAgICAgICAgICcleSc6IHllYXIyLFxuICAgICAgICAgICAgICAgICclWSc6IHllYXIsXG4gICAgICAgICAgICAgICAgJyV6JzogdGhpcy50aW1lem9uZSgpLnJlcGxhY2UoXCI6XCIsIFwiXCIpLFxuICAgICAgICAgICAgICAgICclWic6IHRoaXMudGltZXpvbmVOYW1lKCksXG4gICAgICAgICAgICAgICAgJyVyJzogW2FIb3VyMTIsIGFNaW51dGUsIGFTZWNvbmRdLmpvaW4oXCI6XCIpICsgXCIgXCIgKyB0aGlzLmFtcG0oKSxcbiAgICAgICAgICAgICAgICAnJVInOiBbYUhvdXIsIGFNaW51dGVdLmpvaW4oXCI6XCIpLFxuICAgICAgICAgICAgICAgIFwiJVRcIjogW2FIb3VyLCBhTWludXRlLCBhU2Vjb25kXS5qb2luKFwiOlwiKSxcbiAgICAgICAgICAgICAgICBcIiVRXCI6IGFNcyxcbiAgICAgICAgICAgICAgICBcIiVxXCI6IG1zLFxuICAgICAgICAgICAgICAgIFwiJXRcIjogdGhpcy50aW1lem9uZSgpXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gZm9ybWF0LnJlcGxhY2UoUkVHRVhfRk9STUFUX1NUUkZUSU1FLCBmdW5jdGlvbihtYXRjaCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChtYXRjaGVzW21hdGNoXSA9PT0gMCB8fCBtYXRjaGVzW21hdGNoXSA/IG1hdGNoZXNbbWF0Y2hdIDogbWF0Y2gpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0oKSk7XG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGZuRm9ybWF0ID0gRGF0ZXRpbWUucHJvdG90eXBlLmZvcm1hdDtcblxuICAgIERhdGV0aW1lLnVzZSh7XG4gICAgICAgIHV0Y09mZnNldDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmdldFRpbWV6b25lT2Zmc2V0KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdGltZXpvbmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50b1RpbWVTdHJpbmcoKS5yZXBsYWNlKC8uK0dNVChbKy1dKShcXGR7Mn0pKFxcZHsyfSkuKy8sICckMSQyOiQzJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdGltZXpvbmVOYW1lOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudG9UaW1lU3RyaW5nKCkucmVwbGFjZSgvLitcXCgoLis/KVxcKSQvLCAnJDEnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBmb3JtYXQ6IGZ1bmN0aW9uKGZvcm1hdCwgbG9jYWxlKXtcbiAgICAgICAgICAgIGZvcm1hdCA9IGZvcm1hdCB8fCBEYXRldGltZS5ERUZBVUxUX0ZPUk1BVDtcblxuICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSB7XG4gICAgICAgICAgICAgICAgWjogdGhpcy51dGNNb2RlID8gXCJaXCIgOiB0aGlzLnRpbWV6b25lKCksXG4gICAgICAgICAgICAgICAgWlo6IHRoaXMudGltZXpvbmUoKS5yZXBsYWNlKFwiOlwiLCBcIlwiKSxcbiAgICAgICAgICAgICAgICBaWlo6IFwiW0dNVF1cIit0aGlzLnRpbWV6b25lKCksXG4gICAgICAgICAgICAgICAgejogdGhpcy50aW1lem9uZU5hbWUoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGZvcm1hdC5yZXBsYWNlKC8oXFxbW15cXF1dK10pfFp7MSwzfXx6L2csIGZ1bmN0aW9uKG1hdGNoLCAkMSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuICQxIHx8IG1hdGNoZXNbbWF0Y2hdO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgcmV0dXJuIGZuRm9ybWF0LmJpbmQodGhpcykocmVzdWx0LCBsb2NhbGUpXG4gICAgICAgIH1cbiAgICB9KVxufSgpKTtcbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBEYXRldGltZS51c2VTdGF0aWMoe1xuICAgICAgICBpc1RvZGF5OiBmdW5jdGlvbihkYXRlKXtcbiAgICAgICAgICAgIHZhciBkID0gZGF0ZXRpbWUoZGF0ZSkuYWxpZ24oXCJkYXlcIik7XG4gICAgICAgICAgICB2YXIgYyA9IGRhdGV0aW1lKCkuYWxpZ24oJ2RheScpO1xuXG4gICAgICAgICAgICByZXR1cm4gZC50aW1lKCkgPT09IGMudGltZSgpO1xuICAgICAgICB9XG4gICAgfSlcblxuICAgIERhdGV0aW1lLnVzZSh7XG4gICAgICAgIGlzVG9kYXk6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gRGF0ZXRpbWUuaXNUb2RheSh0aGlzKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b2RheTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBub3cgPSBkYXRldGltZSgpO1xuICAgICAgICAgICAgaWYgKCF0aGlzLm11dGFibGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbm93O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsKG5vdy52YWwoKSk7XG4gICAgICAgIH1cbiAgICB9KVxufSgpKTtcbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBEYXRldGltZS51c2VTdGF0aWMoe1xuICAgICAgICBpc1RvbW9ycm93OiBmdW5jdGlvbihkYXRlKXtcbiAgICAgICAgICAgIHZhciBkID0gZGF0ZXRpbWUoZGF0ZSkuYWxpZ24oXCJkYXlcIik7XG4gICAgICAgICAgICB2YXIgYyA9IGRhdGV0aW1lKCkuYWxpZ24oJ2RheScpLmFkZCgxLCAnZGF5Jyk7XG5cbiAgICAgICAgICAgIHJldHVybiBkLnRpbWUoKSA9PT0gYy50aW1lKCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIERhdGV0aW1lLnVzZSh7XG4gICAgICAgIGlzVG9tb3Jyb3c6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gRGF0ZXRpbWUuaXNUb21vcnJvdyh0aGlzKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b21vcnJvdzogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5tdXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoKS5hZGQoMSwgJ2RheScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkKDEsICdkYXknKTtcbiAgICAgICAgfVxuICAgIH0pO1xufSgpKTtcbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBEYXRldGltZS51c2Uoe1xuICAgICAgICB0b0RhdGVTdHJpbmc6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS50b0RhdGVTdHJpbmcoKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b0lTT1N0cmluZzogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9KU09OOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUudG9KU09OKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9HTVRTdHJpbmc6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS50b0dNVFN0cmluZygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvTG9jYWxlRGF0ZVN0cmluZzogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLnRvTG9jYWxlRGF0ZVN0cmluZygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvTG9jYWxlU3RyaW5nOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUudG9Mb2NhbGVTdHJpbmcoKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b0xvY2FsZVRpbWVTdHJpbmc6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS50b0xvY2FsZVRpbWVTdHJpbmcoKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b1RpbWVTdHJpbmc6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS50b1RpbWVTdHJpbmcoKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b1VUQ1N0cmluZzogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLnRvVVRDU3RyaW5nKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9EYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHRoaXMudmFsdWUpO1xuICAgICAgICB9XG4gICAgfSk7XG59KCkpO1xuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIERhdGV0aW1lLnVzZVN0YXRpYyh7XG4gICAgICAgIHRpbWVzdGFtcDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDA7XG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgRGF0ZXRpbWUudXNlKHtcbiAgICAgICAgdW5peDogZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgICB2YXIgX3ZhbDtcblxuICAgICAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoIHx8IChEYXRldGltZS5ub3QodmFsKSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcih0aGlzLnZhbHVlT2YoKSAvIDEwMDApXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIF92YWwgPSB2YWwgKiAxMDAwO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5tdXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudGltZShfdmFsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGRhdGV0aW1lKHRoaXMudmFsdWUpLnRpbWUoX3ZhbCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdGltZXN0YW1wOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudW5peCgpO1xuICAgICAgICB9XG4gICAgfSk7XG59KCkpO1xuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBmbkZvcm1hdCA9IERhdGV0aW1lLnByb3RvdHlwZS5mb3JtYXQ7XG4gICAgdmFyIGxwYWQgPSBEYXRldGltZS5scGFkO1xuXG4gICAgRGF0ZXRpbWUudXNlKHtcbiAgICAgICAgd2Vla051bWJlcjogZnVuY3Rpb24gKHdlZWtTdGFydCkge1xuICAgICAgICAgICAgdmFyIG5ZZWFyLCBuZGF5LCBuZXdZZWFyLCBkYXksIGRheW51bSwgd2Vla251bTtcblxuICAgICAgICAgICAgd2Vla1N0YXJ0ID0gK3dlZWtTdGFydCB8fCAwO1xuICAgICAgICAgICAgbmV3WWVhciA9IGRhdGV0aW1lKHRoaXMueWVhcigpLCAwLCAxKTtcbiAgICAgICAgICAgIGRheSA9IG5ld1llYXIud2Vla0RheSgpIC0gd2Vla1N0YXJ0O1xuICAgICAgICAgICAgZGF5ID0gKGRheSA+PSAwID8gZGF5IDogZGF5ICsgNyk7XG4gICAgICAgICAgICBkYXludW0gPSBNYXRoLmZsb29yKFxuICAgICAgICAgICAgICAgICh0aGlzLnRpbWUoKSAtIG5ld1llYXIudGltZSgpIC0gKHRoaXMudXRjT2Zmc2V0KCkgLSBuZXdZZWFyLnV0Y09mZnNldCgpKSAqIDYwMDAwKSAvIDg2NDAwMDAwXG4gICAgICAgICAgICApICsgMTtcblxuICAgICAgICAgICAgaWYoZGF5IDwgNCkge1xuICAgICAgICAgICAgICAgIHdlZWtudW0gPSBNYXRoLmZsb29yKChkYXludW0gKyBkYXkgLSAxKSAvIDcpICsgMTtcbiAgICAgICAgICAgICAgICBpZih3ZWVrbnVtID4gNTIpIHtcbiAgICAgICAgICAgICAgICAgICAgblllYXIgPSBkYXRldGltZSh0aGlzLnllYXIoKSArIDEsIDAsIDEpO1xuICAgICAgICAgICAgICAgICAgICBuZGF5ID0gblllYXIud2Vla0RheSgpIC0gd2Vla1N0YXJ0O1xuICAgICAgICAgICAgICAgICAgICBuZGF5ID0gbmRheSA+PSAwID8gbmRheSA6IG5kYXkgKyA3O1xuICAgICAgICAgICAgICAgICAgICB3ZWVrbnVtID0gbmRheSA8IDQgPyAxIDogNTM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgd2Vla251bSA9IE1hdGguZmxvb3IoKGRheW51bSArIGRheSAtIDEpIC8gNyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gd2Vla251bTtcbiAgICAgICAgfSxcblxuICAgICAgICBpc29XZWVrTnVtYmVyOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMud2Vla051bWJlcigxKTtcbiAgICAgICAgfSxcblxuICAgICAgICB3ZWVrc0luWWVhcjogZnVuY3Rpb24od2Vla1N0YXJ0KXtcbiAgICAgICAgICAgIHZhciBjdXJyID0gZGF0ZXRpbWUodGhpcy52YWx1ZSk7XG4gICAgICAgICAgICByZXR1cm4gY3Vyci5tb250aCgxMSkuZGF5KDMxKS53ZWVrTnVtYmVyKHdlZWtTdGFydCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZm9ybWF0OiBmdW5jdGlvbihmb3JtYXQsIGxvY2FsZSl7XG4gICAgICAgICAgICB2YXIgbWF0Y2hlcywgcmVzdWx0LCB3biA9IHRoaXMud2Vla051bWJlcigpLCB3bmkgPSB0aGlzLmlzb1dlZWtOdW1iZXIoKTtcblxuICAgICAgICAgICAgZm9ybWF0ID0gZm9ybWF0IHx8IERhdGV0aW1lLkRFRkFVTFRfRk9STUFUO1xuXG4gICAgICAgICAgICBtYXRjaGVzID0ge1xuICAgICAgICAgICAgICAgIFc6IHduLFxuICAgICAgICAgICAgICAgIFdXOiBscGFkKHduLCBcIjBcIiwgMiksXG4gICAgICAgICAgICAgICAgV1dXOiB3bmksXG4gICAgICAgICAgICAgICAgV1dXVzogbHBhZCh3bmksIFwiMFwiLCAyKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmVzdWx0ID0gZm9ybWF0LnJlcGxhY2UoLyhcXFtbXlxcXV0rXSl8V3sxLDR9L2csIGZ1bmN0aW9uKG1hdGNoLCAkMSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuICQxIHx8IG1hdGNoZXNbbWF0Y2hdO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBmbkZvcm1hdC5iaW5kKHRoaXMpKHJlc3VsdCwgbG9jYWxlKVxuICAgICAgICB9XG4gICAgfSlcbn0oKSk7XG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgRGF0ZXRpbWUudXNlU3RhdGljKHtcbiAgICAgICAgaXNZZXN0ZXJkYXk6IGZ1bmN0aW9uKGRhdGUpe1xuICAgICAgICAgICAgdmFyIGQgPSBkYXRldGltZShkYXRlKS5hbGlnbihcImRheVwiKTtcbiAgICAgICAgICAgIHZhciBjID0gZGF0ZXRpbWUoKS5hbGlnbignZGF5JykuYWRkKC0xLCAnZGF5Jyk7XG5cbiAgICAgICAgICAgIHJldHVybiBkLnRpbWUoKSA9PT0gYy50aW1lKCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIERhdGV0aW1lLnVzZSh7XG4gICAgICAgIGlzWWVzdGVyZGF5OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIERhdGV0aW1lLmlzWWVzdGVyZGF5KHRoaXMpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHllc3RlcmRheTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5tdXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoKS5hZGQoLTEsICdkYXknKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZCgtMSwgJ2RheScpO1xuICAgICAgICB9XG4gICAgfSlcbn0oKSk7XG5cclxuXHJcbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgZ2V0TG9jYWxlID0gRGF0ZXRpbWUuZ2V0TG9jYWxlO1xuXG4gICAgRGF0ZXRpbWUuZ2V0TG9jYWxlID0gZnVuY3Rpb24obG9jYWxlKXtcbiAgICAgICAgdmFyIGRhdGE7XG5cbiAgICAgICAgaWYgKCFNZXRybykge1xuICAgICAgICAgICAgbG9jYWxlID0gJ2VuJztcbiAgICAgICAgICAgIHJldHVybiBnZXRMb2NhbGUuY2FsbCh0aGlzLCBsb2NhbGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFNZXRyby5sb2NhbGVzW2xvY2FsZV0pIHtcbiAgICAgICAgICAgIGxvY2FsZSA9IFwiZW4tVVNcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIGRhdGEgPSBNZXRyby5sb2NhbGVzW2xvY2FsZV1bJ2NhbGVuZGFyJ107XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG1vbnRoczogZGF0YS5tb250aHMuZmlsdGVyKCBmdW5jdGlvbihlbCwgaSl7IHJldHVybiBpIDwgMTJ9ICksXG4gICAgICAgICAgICBtb250aHNTaG9ydDogZGF0YS5tb250aHMuZmlsdGVyKCBmdW5jdGlvbihlbCwgaSl7IHJldHVybiBpID4gMTF9ICksXG4gICAgICAgICAgICB3ZWVrZGF5czogZGF0YS5kYXlzLmZpbHRlciggZnVuY3Rpb24oZWwsIGkpeyByZXR1cm4gaSA8IDd9ICksXG4gICAgICAgICAgICB3ZWVrZGF5c1Nob3J0OiBkYXRhLmRheXMuZmlsdGVyKCBmdW5jdGlvbihlbCwgaSl7IHJldHVybiBpID4gMTN9ICksXG4gICAgICAgICAgICB3ZWVrZGF5c01pbjogZGF0YS5kYXlzLmZpbHRlciggZnVuY3Rpb24oZWwsIGkpeyByZXR1cm4gaSA+IDYgJiYgaSA8IDE0fSApLFxuICAgICAgICAgICAgd2Vla1N0YXJ0OiBkYXRhLndlZWtTdGFydFxuICAgICAgICB9XG4gICAgfVxufSgpKTtcclxuXHJcbi8qISBcbiAqIENha2Ugc3RyaW5nIGxpYnJhcnkgMS4wLjBcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9vbHRvbi9jYWtlXG4gKlxuICogQ29weXJpZ2h0IDIwMjAtMjAyMSBTZXJoaWkgUGltZW5vdlxuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgaXNOdWxsID0gZnVuY3Rpb24gaXNOdWxsKHZhbCkge1xuICAgICAgcmV0dXJuIHZhbCA9PT0gdW5kZWZpbmVkIHx8IHZhbCA9PT0gbnVsbDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQSByZWd1bGFyIGV4cHJlc3Npb24gc3RyaW5nIG1hdGNoaW5nIGRpZ2l0c1xuICAgICAqL1xuICAgIHZhciBkaWdpdCA9ICdcXFxcZCc7XG4gICAgLyoqXG4gICAgICogQSByZWd1bGFyIGV4cHJlc3Npb24gc3RyaW5nIG1hdGNoaW5nIHdoaXRlc3BhY2VcbiAgICAgKi9cblxuICAgIHZhciB3aGl0ZXNwYWNlID0gXCJcXFxcc1xcXFx1RkVGRlxcXFx4QTBcIjtcbiAgICAvKipcbiAgICAgKiBBIHJlZ3VsYXIgZXhwcmVzc2lvbiBzdHJpbmcgbWF0Y2hpbmcgZGlhY3JpdGljYWwgbWFya1xuICAgICAqL1xuXG4gICAgdmFyIGRpYWNyaXRpY2FsTWFyayA9IFwiXFxcXHUwMzAwLVxcXFx1MDM2RlxcXFx1MUFCMC1cXFxcdTFBRkZcXFxcdTFEQzAtXFxcXHUxREZGXFxcXHUyMEQwLVxcXFx1MjBGRlxcXFx1RkUyMC1cXFxcdUZFMkZcIjtcbiAgICAvKipcbiAgICAgKiBBIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byBtYXRjaCB0aGUgR2VuZXJhbCBQdW5jdHVhdGlvbiBVbmljb2RlIGJsb2NrXG4gICAgICovXG5cbiAgICB2YXIgZ2VuZXJhbFB1bmN0dWF0aW9uQmxvY2sgPSBcIlxcXFx1MjAwMC1cXFxcdTIwNkZcIjtcbiAgICAvKipcbiAgICAgKiBBIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byBtYXRjaCBub24gY2hhcmFjdGVycyBmcm9tIGZyb20gQmFzaWMgTGF0aW4gYW5kIExhdGluLTEgU3VwcGxlbWVudCBVbmljb2RlIGJsb2Nrc1xuICAgICAqL1xuXG4gICAgdmFyIG5vbkNoYXJhY3RlciA9ICdcXFxceDAwLVxcXFx4MkZcXFxceDNBLVxcXFx4NDBcXFxceDVCLVxcXFx4NjBcXFxceDdiLVxcXFx4QkZcXFxceEQ3XFxcXHhGNyc7XG4gICAgLyoqXG4gICAgICogQSByZWd1bGFyIGV4cHJlc3Npb24gdG8gbWF0Y2ggdGhlIGRpbmdiYXQgVW5pY29kZSBibG9ja1xuICAgICAqL1xuXG4gICAgdmFyIGRpbmdiYXRCbG9jayA9IFwiXFxcXHUyNzAwLVxcXFx1MjdCRlwiO1xuICAgIC8qKlxuICAgICAqIEEgcmVndWxhciBleHByZXNzaW9uIHN0cmluZyB0aGF0IG1hdGNoZXMgbG93ZXIgY2FzZSBsZXR0ZXJzOiBMQVRJTlxuICAgICAqL1xuXG4gICAgdmFyIGxvd2VyQ2FzZUxldHRlciA9IFwiYS16XFxcXHhCNVxcXFx4REYtXFxcXHhGNlxcXFx4RjgtXFxcXHhGRlxcXFx1MDEwMVxcXFx1MDEwM1xcXFx1MDEwNVxcXFx1MDEwN1xcXFx1MDEwOVxcXFx1MDEwQlxcXFx1MDEwRFxcXFx1MDEwRlxcXFx1MDExMVxcXFx1MDExM1xcXFx1MDExNVxcXFx1MDExN1xcXFx1MDExOVxcXFx1MDExQlxcXFx1MDExRFxcXFx1MDExRlxcXFx1MDEyMVxcXFx1MDEyM1xcXFx1MDEyNVxcXFx1MDEyN1xcXFx1MDEyOVxcXFx1MDEyQlxcXFx1MDEyRFxcXFx1MDEyRlxcXFx1MDEzMVxcXFx1MDEzM1xcXFx1MDEzNVxcXFx1MDEzN1xcXFx1MDEzOFxcXFx1MDEzQVxcXFx1MDEzQ1xcXFx1MDEzRVxcXFx1MDE0MFxcXFx1MDE0MlxcXFx1MDE0NFxcXFx1MDE0NlxcXFx1MDE0OFxcXFx1MDE0OVxcXFx1MDE0QlxcXFx1MDE0RFxcXFx1MDE0RlxcXFx1MDE1MVxcXFx1MDE1M1xcXFx1MDE1NVxcXFx1MDE1N1xcXFx1MDE1OVxcXFx1MDE1QlxcXFx1MDE1RFxcXFx1MDE1RlxcXFx1MDE2MVxcXFx1MDE2M1xcXFx1MDE2NVxcXFx1MDE2N1xcXFx1MDE2OVxcXFx1MDE2QlxcXFx1MDE2RFxcXFx1MDE2RlxcXFx1MDE3MVxcXFx1MDE3M1xcXFx1MDE3NVxcXFx1MDE3N1xcXFx1MDE3QVxcXFx1MDE3Q1xcXFx1MDE3RS1cXFxcdTAxODBcXFxcdTAxODNcXFxcdTAxODVcXFxcdTAxODhcXFxcdTAxOENcXFxcdTAxOERcXFxcdTAxOTJcXFxcdTAxOTVcXFxcdTAxOTktXFxcXHUwMTlCXFxcXHUwMTlFXFxcXHUwMUExXFxcXHUwMUEzXFxcXHUwMUE1XFxcXHUwMUE4XFxcXHUwMUFBXFxcXHUwMUFCXFxcXHUwMUFEXFxcXHUwMUIwXFxcXHUwMUI0XFxcXHUwMUI2XFxcXHUwMUI5XFxcXHUwMUJBXFxcXHUwMUJELVxcXFx1MDFCRlxcXFx1MDFDNlxcXFx1MDFDOVxcXFx1MDFDQ1xcXFx1MDFDRVxcXFx1MDFEMFxcXFx1MDFEMlxcXFx1MDFENFxcXFx1MDFENlxcXFx1MDFEOFxcXFx1MDFEQVxcXFx1MDFEQ1xcXFx1MDFERFxcXFx1MDFERlxcXFx1MDFFMVxcXFx1MDFFM1xcXFx1MDFFNVxcXFx1MDFFN1xcXFx1MDFFOVxcXFx1MDFFQlxcXFx1MDFFRFxcXFx1MDFFRlxcXFx1MDFGMFxcXFx1MDFGM1xcXFx1MDFGNVxcXFx1MDFGOVxcXFx1MDFGQlxcXFx1MDFGRFxcXFx1MDFGRlxcXFx1MDIwMVxcXFx1MDIwM1xcXFx1MDIwNVxcXFx1MDIwN1xcXFx1MDIwOVxcXFx1MDIwQlxcXFx1MDIwRFxcXFx1MDIwRlxcXFx1MDIxMVxcXFx1MDIxM1xcXFx1MDIxNVxcXFx1MDIxN1xcXFx1MDIxOVxcXFx1MDIxQlxcXFx1MDIxRFxcXFx1MDIxRlxcXFx1MDIyMVxcXFx1MDIyM1xcXFx1MDIyNVxcXFx1MDIyN1xcXFx1MDIyOVxcXFx1MDIyQlxcXFx1MDIyRFxcXFx1MDIyRlxcXFx1MDIzMVxcXFx1MDIzMy1cXFxcdTAyMzlcXFxcdTAyM0NcXFxcdTAyM0ZcXFxcdTAyNDBcXFxcdTAyNDJcXFxcdTAyNDdcXFxcdTAyNDlcXFxcdTAyNEJcXFxcdTAyNERcXFxcdTAyNEZcIjtcbiAgICAvKipcbiAgICAgKiBBIHJlZ3VsYXIgZXhwcmVzc2lvbiBzdHJpbmcgdGhhdCBtYXRjaGVzIHVwcGVyIGNhc2UgbGV0dGVyczogTEFUSU5cbiAgICAgKi9cblxuICAgIHZhciB1cHBlckNhc2VMZXR0ZXIgPSBcIlxcXFx4NDEtXFxcXHg1YVxcXFx4YzAtXFxcXHhkNlxcXFx4ZDgtXFxcXHhkZVxcXFx1MDEwMFxcXFx1MDEwMlxcXFx1MDEwNFxcXFx1MDEwNlxcXFx1MDEwOFxcXFx1MDEwYVxcXFx1MDEwY1xcXFx1MDEwZVxcXFx1MDExMFxcXFx1MDExMlxcXFx1MDExNFxcXFx1MDExNlxcXFx1MDExOFxcXFx1MDExYVxcXFx1MDExY1xcXFx1MDExZVxcXFx1MDEyMFxcXFx1MDEyMlxcXFx1MDEyNFxcXFx1MDEyNlxcXFx1MDEyOFxcXFx1MDEyYVxcXFx1MDEyY1xcXFx1MDEyZVxcXFx1MDEzMFxcXFx1MDEzMlxcXFx1MDEzNFxcXFx1MDEzNlxcXFx1MDEzOVxcXFx1MDEzYlxcXFx1MDEzZFxcXFx1MDEzZlxcXFx1MDE0MVxcXFx1MDE0M1xcXFx1MDE0NVxcXFx1MDE0N1xcXFx1MDE0YVxcXFx1MDE0Y1xcXFx1MDE0ZVxcXFx1MDE1MFxcXFx1MDE1MlxcXFx1MDE1NFxcXFx1MDE1NlxcXFx1MDE1OFxcXFx1MDE1YVxcXFx1MDE1Y1xcXFx1MDE1ZVxcXFx1MDE2MFxcXFx1MDE2MlxcXFx1MDE2NFxcXFx1MDE2NlxcXFx1MDE2OFxcXFx1MDE2YVxcXFx1MDE2Y1xcXFx1MDE2ZVxcXFx1MDE3MFxcXFx1MDE3MlxcXFx1MDE3NFxcXFx1MDE3NlxcXFx1MDE3OFxcXFx1MDE3OVxcXFx1MDE3YlxcXFx1MDE3ZFxcXFx1MDE4MVxcXFx1MDE4MlxcXFx1MDE4NFxcXFx1MDE4NlxcXFx1MDE4N1xcXFx1MDE4OS1cXFxcdTAxOGJcXFxcdTAxOGUtXFxcXHUwMTkxXFxcXHUwMTkzXFxcXHUwMTk0XFxcXHUwMTk2LVxcXFx1MDE5OFxcXFx1MDE5Y1xcXFx1MDE5ZFxcXFx1MDE5ZlxcXFx1MDFhMFxcXFx1MDFhMlxcXFx1MDFhNFxcXFx1MDFhNlxcXFx1MDFhN1xcXFx1MDFhOVxcXFx1MDFhY1xcXFx1MDFhZVxcXFx1MDFhZlxcXFx1MDFiMS1cXFxcdTAxYjNcXFxcdTAxYjVcXFxcdTAxYjdcXFxcdTAxYjhcXFxcdTAxYmNcXFxcdTAxYzRcXFxcdTAxYzVcXFxcdTAxYzdcXFxcdTAxYzhcXFxcdTAxY2FcXFxcdTAxY2JcXFxcdTAxY2RcXFxcdTAxY2ZcXFxcdTAxZDFcXFxcdTAxZDNcXFxcdTAxZDVcXFxcdTAxZDdcXFxcdTAxZDlcXFxcdTAxZGJcXFxcdTAxZGVcXFxcdTAxZTBcXFxcdTAxZTJcXFxcdTAxZTRcXFxcdTAxZTZcXFxcdTAxZThcXFxcdTAxZWFcXFxcdTAxZWNcXFxcdTAxZWVcXFxcdTAxZjFcXFxcdTAxZjJcXFxcdTAxZjRcXFxcdTAxZjYtXFxcXHUwMWY4XFxcXHUwMWZhXFxcXHUwMWZjXFxcXHUwMWZlXFxcXHUwMjAwXFxcXHUwMjAyXFxcXHUwMjA0XFxcXHUwMjA2XFxcXHUwMjA4XFxcXHUwMjBhXFxcXHUwMjBjXFxcXHUwMjBlXFxcXHUwMjEwXFxcXHUwMjEyXFxcXHUwMjE0XFxcXHUwMjE2XFxcXHUwMjE4XFxcXHUwMjFhXFxcXHUwMjFjXFxcXHUwMjFlXFxcXHUwMjIwXFxcXHUwMjIyXFxcXHUwMjI0XFxcXHUwMjI2XFxcXHUwMjI4XFxcXHUwMjJhXFxcXHUwMjJjXFxcXHUwMjJlXFxcXHUwMjMwXFxcXHUwMjMyXFxcXHUwMjNhXFxcXHUwMjNiXFxcXHUwMjNkXFxcXHUwMjNlXFxcXHUwMjQxXFxcXHUwMjQzLVxcXFx1MDI0NlxcXFx1MDI0OFxcXFx1MDI0YVxcXFx1MDI0Y1xcXFx1MDI0ZVwiO1xuXG4gICAgLyoqXG4gICAgICogUmVndWxhciBleHByZXNzaW9uIHRvIG1hdGNoIHdoaXRlc3BhY2VzIGZyb20gdGhlIGxlZnQgc2lkZVxuICAgICAqL1xuXG4gICAgdmFyIFJFR0VYUF9UUklNX0xFRlQgPSBuZXcgUmVnRXhwKCdeWycgKyB3aGl0ZXNwYWNlICsgJ10rJyk7XG4gICAgLyoqXG4gICAgICogUmVndWxhciBleHByZXNzaW9uIHRvIG1hdGNoIHdoaXRlc3BhY2VzIGZyb20gdGhlIHJpZ2h0IHNpZGVcbiAgICAgKi9cblxuICAgIHZhciBSRUdFWFBfVFJJTV9SSUdIVCA9IG5ldyBSZWdFeHAoJ1snICsgd2hpdGVzcGFjZSArICddKyQnKTtcbiAgICAvKipcbiAgICAgKiBSZWd1bGFyIGV4cHJlc3Npb24gdG8gbWF0Y2ggZGlnaXQgY2hhcmFjdGVyc1xuICAgICAqL1xuXG4gICAgdmFyIFJFR0VYUF9ESUdJVCA9IG5ldyBSZWdFeHAoJ14nICsgZGlnaXQgKyAnKyQnKTtcbiAgICAvKipcbiAgICAgKiBSZWd1bGFyIGV4cHJlc3Npb24gdG8gbWF0Y2ggSFRNTCBzcGVjaWFsIGNoYXJhY3RlcnMuXG4gICAgICovXG5cbiAgICB2YXIgUkVHRVhQX0hUTUxfU1BFQ0lBTF9DSEFSQUNURVJTID0gL1s8PiZcIidgXS9nO1xuICAgIHZhciBSRUdFWFBfVEFHUyA9IC8oPChbXj5dKyk+KS9pZztcbiAgICAvKipcbiAgICAgKiBSZWd1bGFyIGV4cHJlc3Npb24gdG8gbWF0Y2ggVW5pY29kZSB3b3Jkc1xuICAgICAqL1xuXG4gICAgdmFyIFJFR0VYUF9XT1JEID0gbmV3IFJlZ0V4cCgnKD86WycgKyB1cHBlckNhc2VMZXR0ZXIgKyAnXVsnICsgZGlhY3JpdGljYWxNYXJrICsgJ10qKT8oPzpbJyArIGxvd2VyQ2FzZUxldHRlciArICddWycgKyBkaWFjcml0aWNhbE1hcmsgKyAnXSopK3xcXFxuKD86WycgKyB1cHBlckNhc2VMZXR0ZXIgKyAnXVsnICsgZGlhY3JpdGljYWxNYXJrICsgJ10qKSsoPyFbJyArIGxvd2VyQ2FzZUxldHRlciArICddKXxcXFxuWycgKyBkaWdpdCArICddK3xcXFxuWycgKyBkaW5nYmF0QmxvY2sgKyAnXXxcXFxuW14nICsgbm9uQ2hhcmFjdGVyICsgZ2VuZXJhbFB1bmN0dWF0aW9uQmxvY2sgKyB3aGl0ZXNwYWNlICsgJ10rJywgJ2cnKTtcbiAgICAvKipcbiAgICAgKiBSZWd1bGFyIGV4cHJlc3Npb24gdG8gbWF0Y2ggd29yZHMgZnJvbSBCYXNpYyBMYXRpbiBhbmQgTGF0aW4tMSBTdXBwbGVtZW50IGJsb2Nrc1xuICAgICAqL1xuXG4gICAgdmFyIFJFR0VYUF9MQVRJTl9XT1JEID0gL1tBLVpcXHhDMC1cXHhENlxceEQ4LVxceERFXT9bYS16XFx4REYtXFx4RjZcXHhGOC1cXHhGRl0rfFtBLVpcXHhDMC1cXHhENlxceEQ4LVxceERFXSsoPyFbYS16XFx4REYtXFx4RjZcXHhGOC1cXHhGRl0pfFxcZCsvZztcbiAgICAvKipcbiAgICAgKiBSZWd1bGFyIGV4cHJlc3Npb24gdG8gbWF0Y2ggYWxwaGEgY2hhcmFjdGVyc1xuICAgICAqL1xuXG4gICAgdmFyIFJFR0VYUF9BTFBIQSA9IG5ldyBSZWdFeHAoJ14oPzpbJyArIGxvd2VyQ2FzZUxldHRlciArIHVwcGVyQ2FzZUxldHRlciArICddWycgKyBkaWFjcml0aWNhbE1hcmsgKyAnXSopKyQnKTtcbiAgICAvKipcbiAgICAgKiBSZWd1bGFyIGV4cHJlc3Npb24gdG8gbWF0Y2ggYWxwaGEgYW5kIGRpZ2l0IGNoYXJhY3RlcnNcbiAgICAgKi9cblxuICAgIHZhciBSRUdFWFBfQUxQSEFfRElHSVQgPSBuZXcgUmVnRXhwKCdeKCg/OlsnICsgbG93ZXJDYXNlTGV0dGVyICsgdXBwZXJDYXNlTGV0dGVyICsgJ11bJyArIGRpYWNyaXRpY2FsTWFyayArICddKil8WycgKyBkaWdpdCArICddKSskJyk7XG4gICAgLyoqXG4gICAgICogUmVndWxhciBleHByZXNzaW9uIHRvIG1hdGNoIEV4dGVuZGVkIEFTQ0lJIGNoYXJhY3RlcnMsIGkuZS4gdGhlIGZpcnN0IDI1NVxuICAgICAqL1xuXG4gICAgdmFyIFJFR0VYUF9FWFRFTkRFRF9BU0NJSSA9IC9eW1xceDAxLVxceEZGXSokLztcblxuICAgIGZ1bmN0aW9uIG52bCh2YWwsIGRlZikge1xuICAgICAgcmV0dXJuIGlzTnVsbCh2YWwpID8gZGVmIDogdmFsO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHRvU3RyKHZhbCkge1xuICAgICAgdmFyIGRlZiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogXCJcIjtcbiAgICAgIGlmIChpc051bGwodmFsKSkgcmV0dXJuIGRlZjtcbiAgICAgIGlmICh0eXBlb2YgdmFsID09PSBcInN0cmluZ1wiKSByZXR1cm4gdmFsO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsKSkgcmV0dXJuIHZhbC5qb2luKFwiXCIpO1xuICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHZhbCk7XG4gICAgfVxuXG4gICAgLypcbiAgICAqIFNwbGl0IHN0cmluZyB0byB3b3Jkcy4gWW91IGNhbiBzZXQgc3BlY2lmaWVkIHBhdHRlciB0byBzcGxpdFxuICAgICogKi9cblxuICAgIGZ1bmN0aW9uIHdvcmRzKHMsIHBhdHRlcm4sIGZsYWdzKSB7XG4gICAgICB2YXIgcmVnZXhwO1xuXG4gICAgICBpZiAoaXNOdWxsKHBhdHRlcm4pKSB7XG4gICAgICAgIHJlZ2V4cCA9IFJFR0VYUF9FWFRFTkRFRF9BU0NJSS50ZXN0KHMpID8gUkVHRVhQX0xBVElOX1dPUkQgOiBSRUdFWFBfV09SRDtcbiAgICAgIH0gZWxzZSBpZiAocGF0dGVybiBpbnN0YW5jZW9mIFJlZ0V4cCkge1xuICAgICAgICByZWdleHAgPSBwYXR0ZXJuO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVnZXhwID0gbmV3IFJlZ0V4cChwYXR0ZXJuLCBudmwoZmxhZ3MsICcnKSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBudmwodG9TdHIocykubWF0Y2gocmVnZXhwKSwgW10pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNhcGl0YWxpemUocywgc3Ryb25nKSB7XG4gICAgICB2YXIgX3MgPSB0b1N0cihzKTtcblxuICAgICAgdmFyIGxhc3QgPSBfcy5zdWJzdHIoMSk7XG5cbiAgICAgIHJldHVybiBfcy5zdWJzdHIoMCwgMSkudG9VcHBlckNhc2UoKSArIChzdHJvbmcgPyBsYXN0LnRvTG93ZXJDYXNlKCkgOiBsYXN0KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjYW1lbENhc2Uocykge1xuICAgICAgcmV0dXJuIHdvcmRzKHRvU3RyKHMpKS5tYXAoZnVuY3Rpb24gKGVsLCBpKSB7XG4gICAgICAgIHJldHVybiBpID09PSAwID8gZWwudG9Mb3dlckNhc2UoKSA6IGNhcGl0YWxpemUoZWwpO1xuICAgICAgfSkuam9pbihcIlwiKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkYXNoZWROYW1lKHMpIHtcbiAgICAgIHJldHVybiB3b3Jkcyh0b1N0cihzKSkubWFwKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICByZXR1cm4gZWwudG9Mb3dlckNhc2UoKTtcbiAgICAgIH0pLmpvaW4oXCItXCIpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRlY2FwaXRhbGl6ZShzKSB7XG4gICAgICB2YXIgX3MgPSB0b1N0cihzKTtcblxuICAgICAgcmV0dXJuIF9zLnN1YnN0cigwLCAxKS50b0xvd2VyQ2FzZSgpICsgX3Muc3Vic3RyKDEpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGtlYmFiKHMpIHtcbiAgICAgIHJldHVybiB3b3Jkcyh0b1N0cihzKSkubWFwKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICByZXR1cm4gZWwudG9Mb3dlckNhc2UoKTtcbiAgICAgIH0pLmpvaW4oXCItXCIpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxvd2VyKHMpIHtcbiAgICAgIHJldHVybiB0b1N0cihzKS50b0xvd2VyQ2FzZSgpO1xuICAgIH1cblxuICAgIC8qXG4gICAgKiBTcGxpdCBzdHJpbmcgdG8gY2hhcnMgYXJyYXkgd2l0aCBpZ25vcmVzXG4gICAgKiAqL1xuXG4gICAgZnVuY3Rpb24gY2hhcnMocykge1xuICAgICAgdmFyIGlnbm9yZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogW107XG4gICAgICByZXR1cm4gdG9TdHIocykuc3BsaXQoXCJcIikuZmlsdGVyKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICByZXR1cm4gIWlnbm9yZS5pbmNsdWRlcyhlbCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZXZlcnNlKHMsIGlnbm9yZSkge1xuICAgICAgcmV0dXJuIGNoYXJzKHRvU3RyKHMpLCBpZ25vcmUpLnJldmVyc2UoKS5qb2luKFwiXCIpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7XG4gICAgICBcIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mXCI7XG5cbiAgICAgIGlmICh0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gXCJzeW1ib2xcIikge1xuICAgICAgICBfdHlwZW9mID0gZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgIHJldHVybiB0eXBlb2Ygb2JqO1xuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX3R5cGVvZiA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iajtcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIF90eXBlb2Yob2JqKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7XG4gICAgICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtcbiAgICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO1xuICAgICAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7XG4gICAgICAgIGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7XG4gICAgICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtcbiAgICAgIGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtcbiAgICAgIHJldHVybiBDb25zdHJ1Y3RvcjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7XG4gICAgICBpZiAoa2V5IGluIG9iaikge1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHtcbiAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgd3JpdGFibGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvYmpba2V5XSA9IHZhbHVlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gb2JqO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHtcbiAgICAgIHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KGFycik7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7XG4gICAgICBpZiAodHlwZW9mIFN5bWJvbCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7XG4gICAgICBpZiAoIW8pIHJldHVybjtcbiAgICAgIGlmICh0eXBlb2YgbyA9PT0gXCJzdHJpbmdcIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7XG4gICAgICB2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7XG4gICAgICBpZiAobiA9PT0gXCJPYmplY3RcIiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO1xuICAgICAgaWYgKG4gPT09IFwiTWFwXCIgfHwgbiA9PT0gXCJTZXRcIikgcmV0dXJuIEFycmF5LmZyb20obyk7XG4gICAgICBpZiAobiA9PT0gXCJBcmd1bWVudHNcIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHtcbiAgICAgIGlmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO1xuXG4gICAgICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIGFycjJbaV0gPSBhcnJbaV07XG5cbiAgICAgIHJldHVybiBhcnIyO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuXCIpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNodWZmbGVBcnJheSAoYSkge1xuICAgICAgdmFyIF9hID0gX3RvQ29uc3VtYWJsZUFycmF5KGEpO1xuXG4gICAgICB2YXIgaSA9IF9hLmxlbmd0aCxcbiAgICAgICAgICB0LFxuICAgICAgICAgIHI7XG5cbiAgICAgIHdoaWxlICgwICE9PSBpKSB7XG4gICAgICAgIHIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBpKTtcbiAgICAgICAgaSAtPSAxO1xuICAgICAgICB0ID0gX2FbaV07XG4gICAgICAgIF9hW2ldID0gX2Fbcl07XG4gICAgICAgIF9hW3JdID0gdDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIF9hO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNodWZmbGUocykge1xuICAgICAgdmFyIF9zID0gdG9TdHIocyk7XG5cbiAgICAgIHJldHVybiBzaHVmZmxlQXJyYXkoX3Muc3BsaXQoXCJcIikpLmpvaW4oXCJcIik7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc25ha2Uocykge1xuICAgICAgcmV0dXJuIHdvcmRzKHRvU3RyKHMpKS5tYXAoZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIHJldHVybiBlbC50b0xvd2VyQ2FzZSgpO1xuICAgICAgfSkuam9pbihcIl9cIik7XG4gICAgfVxuXG4gICAgdmFyIF9zd2FwID0gZnVuY3Rpb24gX3N3YXAoc3dhcHBlZCwgX2NoYXIpIHtcbiAgICAgIHZhciBsYyA9IF9jaGFyLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgIHZhciB1YyA9IF9jaGFyLnRvVXBwZXJDYXNlKCk7XG5cbiAgICAgIHJldHVybiBzd2FwcGVkICsgKF9jaGFyID09PSBsYyA/IHVjIDogbGMpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBzd2FwKHMpIHtcbiAgICAgIHJldHVybiB0b1N0cihzKS5zcGxpdChcIlwiKS5yZWR1Y2UoX3N3YXAsICcnKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0aXRsZShzLCBub1NwbGl0KSB7XG4gICAgICB2YXIgX3MgPSB0b1N0cihzKTtcblxuICAgICAgdmFyIHJlZ2V4cCA9IFJFR0VYUF9FWFRFTkRFRF9BU0NJSS50ZXN0KF9zKSA/IFJFR0VYUF9MQVRJTl9XT1JEIDogUkVHRVhQX1dPUkQ7XG4gICAgICB2YXIgbm9TcGxpdEFycmF5ID0gQXJyYXkuaXNBcnJheShub1NwbGl0KSA/IG5vU3BsaXQgOiBpc051bGwobm9TcGxpdCkgPyBbXSA6IG5vU3BsaXQuc3BsaXQoKTtcbiAgICAgIHJldHVybiBzLnJlcGxhY2UocmVnZXhwLCBmdW5jdGlvbiAodywgaSkge1xuICAgICAgICB2YXIgaXNOb1NwbGl0ID0gaSAmJiBub1NwbGl0QXJyYXkuaW5jbHVkZXMoX3NbaSAtIDFdKTtcbiAgICAgICAgcmV0dXJuIGlzTm9TcGxpdCA/IGxvd2VyKHcpIDogY2FwaXRhbGl6ZSh3KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVwcGVyKHMpIHtcbiAgICAgIHJldHVybiB0b1N0cihzKS50b1VwcGVyQ2FzZSgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHdyYXBUYWcocykge1xuICAgICAgdmFyIHRhZyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogXCJkaXZcIjtcbiAgICAgIHJldHVybiBcIjxcIi5jb25jYXQodGFnLCBcIj5cIikuY29uY2F0KHRvU3RyKHMpLCBcIjwvXCIpLmNvbmNhdCh0YWcsIFwiPlwiKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB3cmFwKHMpIHtcbiAgICAgIHZhciBiZWZvcmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IFwiXCI7XG4gICAgICB2YXIgYWZ0ZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IFwiXCI7XG4gICAgICByZXR1cm4gYmVmb3JlICsgdG9TdHIocykgKyBhZnRlcjtcbiAgICB9XG5cbiAgICAvKlxuICAgICogR2V0IHN0cmluZyBsZW5ndGhcbiAgICAqICovXG5cbiAgICBmdW5jdGlvbiBjb3VudChzKSB7XG4gICAgICByZXR1cm4gdG9TdHIocykubGVuZ3RoO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVuIChhKSB7XG4gICAgICB2YXIgX2EgPSBfdG9Db25zdW1hYmxlQXJyYXkoYSk7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX2EubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgZm9yICh2YXIgaiA9IGkgKyAxOyBqIDwgX2EubGVuZ3RoOyArK2opIHtcbiAgICAgICAgICBpZiAoX2FbaV0gPT09IF9hW2pdKSBfYS5zcGxpY2Uoai0tLCAxKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gX2E7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY291bnRDaGFycyhzLCBpZ25vcmUpIHtcbiAgICAgIHJldHVybiBjaGFycyhzLCBpZ25vcmUpLmxlbmd0aDtcbiAgICB9XG4gICAgZnVuY3Rpb24gY291bnRVbmlxdWVDaGFycyhzLCBpZ25vcmUpIHtcbiAgICAgIHJldHVybiB1bihjaGFycyhzLCBpZ25vcmUpKS5sZW5ndGg7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY291bnRTdWJzdHIocywgc3ViKSB7XG4gICAgICB2YXIgX3MgPSB0b1N0cihzKTtcblxuICAgICAgdmFyIF9zdWIgPSB0b1N0cihzdWIpO1xuXG4gICAgICByZXR1cm4gX3MgPT09ICcnIHx8IF9zdWIgPT09ICcnID8gMCA6IF9zLnNwbGl0KF9zdWIpLmxlbmd0aCAtIDE7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY291bnRXb3JkcyhzLCBwYXR0ZXJuLCBmbGFncykge1xuICAgICAgcmV0dXJuIHdvcmRzKHMsIHBhdHRlcm4sIGZsYWdzKS5sZW5ndGg7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGNvdW50VW5pcXVlV29yZHMocywgcGF0dGVybiwgZmxhZ3MpIHtcbiAgICAgIHJldHVybiB1bih3b3JkcyhzLCBwYXR0ZXJuLCBmbGFncykpLmxlbmd0aDtcbiAgICB9XG5cbiAgICB2YXIgZXNjYXBlQ2hhcmFjdGVyc01hcCA9IHtcbiAgICAgICc8JzogJyZsdDsnLFxuICAgICAgJz4nOiAnJmd0OycsXG4gICAgICAnJic6ICcmYW1wOycsXG4gICAgICAnXCInOiAnJnF1b3Q7JyxcbiAgICAgIFwiJ1wiOiAnJiN4Mjc7JyxcbiAgICAgICdgJzogJyYjeDYwOydcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gcmVwbGFjZVNwZWNpYWxDaGFyYWN0ZXIoY2hhcmFjdGVyKSB7XG4gICAgICByZXR1cm4gZXNjYXBlQ2hhcmFjdGVyc01hcFtjaGFyYWN0ZXJdO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGVzY2FwZUh0bWwocykge1xuICAgICAgcmV0dXJuIHRvU3RyKHMpLnJlcGxhY2UoUkVHRVhQX0hUTUxfU1BFQ0lBTF9DSEFSQUNURVJTLCByZXBsYWNlU3BlY2lhbENoYXJhY3Rlcik7XG4gICAgfVxuXG4gICAgdmFyIHVuZXNjYXBlQ2hhcnNNYXAgPSB7XG4gICAgICAnPCc6IC8oJmx0Oyl8KCYjeDAqM2M7KXwoJiMwKjYwOykvZ2ksXG4gICAgICAnPic6IC8oJmd0Oyl8KCYjeDAqM2U7KXwoJiMwKjYyOykvZ2ksXG4gICAgICAnJic6IC8oJmFtcDspfCgmI3gwKjI2Oyl8KCYjMCozODspL2dpLFxuICAgICAgJ1wiJzogLygmcXVvdDspfCgmI3gwKjIyOyl8KCYjMCozNDspL2dpLFxuICAgICAgXCInXCI6IC8oJiN4MCoyNzspfCgmIzAqMzk7KS9naSxcbiAgICAgICdgJzogLygmI3gwKjYwOyl8KCYjMCo5NjspL2dpXG4gICAgfTtcbiAgICB2YXIgY2hhcnMkMSA9IE9iamVjdC5rZXlzKHVuZXNjYXBlQ2hhcnNNYXApO1xuXG4gICAgZnVuY3Rpb24gcmVkdWNlVW5lc2NhcGVkU3RyaW5nKHN0cmluZywga2V5KSB7XG4gICAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2UodW5lc2NhcGVDaGFyc01hcFtrZXldLCBrZXkpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVuZXNjYXBlSHRtbChzKSB7XG4gICAgICByZXR1cm4gY2hhcnMkMS5yZWR1Y2UocmVkdWNlVW5lc2NhcGVkU3RyaW5nLCB0b1N0cihzKSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdW5pcXVlKHMsIGlnbm9yZSkge1xuICAgICAgcmV0dXJuIHVuKGNoYXJzKHMsIGlnbm9yZSkpLmpvaW4oXCJcIik7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdW5pcXVlV29yZHMocywgcGF0dGVybiwgZmxhZ3MpIHtcbiAgICAgIHJldHVybiB1bih3b3JkcyhzLCBwYXR0ZXJuLCBmbGFncykpLmpvaW4oXCJcIik7XG4gICAgfVxuXG4gICAgLypcbiAgICAqIEdldCBzdWJzdHJpbmcgZnJvbSBzdHJpbmcuXG4gICAgKiAqL1xuXG4gICAgZnVuY3Rpb24gc3Vic3RyKHMsIHN0YXJ0LCBsZW4pIHtcbiAgICAgIHZhciBfcyA9IHRvU3RyKHMpO1xuXG4gICAgICByZXR1cm4gX3Muc3Vic3RyKHN0YXJ0LCBsZW4pO1xuICAgIH1cblxuICAgIC8qXG4gICAgKiBHZXQgTiBmaXJzdCBjaGFycyBmcm9tIHN0cmluZy5cbiAgICAqICovXG5cbiAgICBmdW5jdGlvbiBmaXJzdChzLCBsZW4pIHtcbiAgICAgIHZhciBfcyA9IHRvU3RyKHMpO1xuXG4gICAgICByZXR1cm4gX3MgPyBzdWJzdHIoX3MsIDAsIGxlbikgOiAnJztcbiAgICB9XG5cbiAgICAvKlxuICAgICogR2V0IE4gbGFzdCBjaGFycyBmcm9tIHN0cmluZy5cbiAgICAqICovXG5cbiAgICBmdW5jdGlvbiBsYXN0KHMsIGxlbikge1xuICAgICAgdmFyIF9zID0gdG9TdHIocyk7XG5cbiAgICAgIHJldHVybiBfcyA/IHN1YnN0cihfcywgX3MubGVuZ3RoIC0gbGVuKSA6ICcnO1xuICAgIH1cblxuICAgIHZhciBNQVhfU0FGRV9JTlRFR0VSID0gMHgxZmZmZmZmZmZmZmZmZjtcblxuICAgIGZ1bmN0aW9uIGNsaXAodmFsLCBtaW4pIHtcbiAgICAgIHZhciBtYXggPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IE1BWF9TQUZFX0lOVEVHRVI7XG4gICAgICBpZiAodmFsIDwgbWluKSByZXR1cm4gbWluO1xuICAgICAgaWYgKHZhbCA+IG1heCkgcmV0dXJuIG1heDtcbiAgICAgIHJldHVybiB2YWw7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdG9JbnQodmFsKSB7XG4gICAgICBpZiAodmFsID09PSBJbmZpbml0eSkgcmV0dXJuIE1BWF9TQUZFX0lOVEVHRVI7XG4gICAgICBpZiAodmFsID09PSAtSW5maW5pdHkpIHJldHVybiAtTUFYX1NBRkVfSU5URUdFUjtcbiAgICAgIHJldHVybiB+fnZhbDtcbiAgICB9XG5cbiAgICAvKlxuICAgICogVHJ1bmNhdGVzIGBzdWJqZWN0YCB0byBhIG5ldyBgbGVuZ3RoYCB3aXRoIHNwZWNpZmllZCBlbmRpbmcuXG4gICAgKiAqL1xuXG4gICAgZnVuY3Rpb24gdHJ1bmNhdGUocywgbGVuKSB7XG4gICAgICB2YXIgZW5kID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAnLi4uJztcblxuICAgICAgdmFyIF9zID0gdG9TdHIocyk7XG5cbiAgICAgIHZhciBfbGVuID0gaXNOdWxsKGxlbikgfHwgaXNOYU4obGVuKSA/IF9zLmxlbmd0aCA6IGNsaXAodG9JbnQobGVuKSwgMCwgTUFYX1NBRkVfSU5URUdFUik7XG5cbiAgICAgIHJldHVybiBzdWJzdHIoX3MsIDAsIF9sZW4pICsgKF9zLmxlbmd0aCA9PT0gX2xlbiA/ICcnIDogZW5kKTtcbiAgICB9XG5cbiAgICAvKlxuICAgICogU2xpY2Ugc3RyaW5nIHRvIE4gcGFydHMuXG4gICAgKiAqL1xuXG4gICAgZnVuY3Rpb24gc2xpY2Uocykge1xuICAgICAgdmFyIHBhcnRzID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAxO1xuXG4gICAgICB2YXIgX3MgPSB0b1N0cihzKTtcblxuICAgICAgdmFyIHJlcyA9IFtdO1xuICAgICAgdmFyIGxlbiA9IE1hdGgucm91bmQoX3MubGVuZ3RoIC8gcGFydHMpO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcnRzOyBpKyspIHtcbiAgICAgICAgcmVzLnB1c2goc3Vic3RyKF9zLCBpICogbGVuLCBsZW4pKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlcztcbiAgICB9XG5cbiAgICAvKlxuICAgICogVHJ1bmNhdGVzIGBzdWJqZWN0YCB0byBhIG5ldyBgbGVuZ3RoYCBhbmQgZG9lcyBub3QgYnJlYWsgdGhlIHdvcmRzIHdpdGggc3BlY2lmaWVkIGVuZGluZy5cbiAgICAqICovXG5cbiAgICBmdW5jdGlvbiBwcnVuZShzLCBsZW4pIHtcbiAgICAgIHZhciBlbmQgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IFwiXCI7XG5cbiAgICAgIHZhciBfcyA9IHRvU3RyKHMpO1xuXG4gICAgICB2YXIgX2xlbiA9IGlzTnVsbChsZW4pIHx8IGlzTmFOKGxlbikgPyBfcy5sZW5ndGggOiBjbGlwKHRvSW50KGxlbiksIDAsIE1BWF9TQUZFX0lOVEVHRVIpO1xuXG4gICAgICB2YXIgX3RydW5jYXRlZExlbiA9IDA7XG4gICAgICB2YXIgcGF0dGVybiA9IFJFR0VYUF9FWFRFTkRFRF9BU0NJSS50ZXN0KF9zKSA/IFJFR0VYUF9MQVRJTl9XT1JEIDogUkVHRVhQX1dPUkQ7XG5cbiAgICAgIF9zLnJlcGxhY2UocGF0dGVybiwgZnVuY3Rpb24gKHdvcmQsIG9mZnNldCkge1xuICAgICAgICB2YXIgd29yZExlbmd0aCA9IG9mZnNldCArIHdvcmQubGVuZ3RoO1xuXG4gICAgICAgIGlmICh3b3JkTGVuZ3RoIDw9IF9sZW4gLSBlbmQubGVuZ3RoKSB7XG4gICAgICAgICAgX3RydW5jYXRlZExlbiA9IHdvcmRMZW5ndGg7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gX3Muc3Vic3RyKDAsIF90cnVuY2F0ZWRMZW4pICsgZW5kO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlcGVhdChzLCB0aW1lcykge1xuICAgICAgdmFyIF9zID0gdG9TdHIocyk7XG5cbiAgICAgIHZhciBfdGltZXMgPSBpc051bGwodGltZXMpIHx8IGlzTmFOKHRpbWVzKSA/IF9zLmxlbmd0aCA6IGNsaXAodG9JbnQodGltZXMpLCAwLCBNQVhfU0FGRV9JTlRFR0VSKTtcblxuICAgICAgdmFyIF9vcmlnaW4gPSBfcztcblxuICAgICAgaWYgKHRpbWVzID09PSAwKSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgfVxuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF90aW1lcyAtIDE7IGkrKykge1xuICAgICAgICBfcyArPSBfb3JpZ2luO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gX3M7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcGFkQnVpbGRlcihwYWQsIGxlbikge1xuICAgICAgdmFyIHBhZExlbmd0aCA9IHBhZC5sZW5ndGg7XG4gICAgICB2YXIgbGVuZ3RoID0gbGVuIC0gcGFkTGVuZ3RoO1xuICAgICAgcmV0dXJuIHJlcGVhdChwYWQsIGxlbmd0aCArIDEpLnN1YnN0cigwLCBsZW4pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHBhZChzLCBsZW4pIHtcbiAgICAgIHZhciBwYWQgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6ICcgJztcblxuICAgICAgdmFyIF9zID0gdG9TdHIocyk7XG5cbiAgICAgIHZhciBfbGVuID0gaXNOdWxsKGxlbikgfHwgaXNOYU4obGVuKSA/IF9zLmxlbmd0aCA6IGNsaXAodG9JbnQobGVuKSwgMCwgTUFYX1NBRkVfSU5URUdFUik7XG5cbiAgICAgIHZhciBfcGFkTGVuID0gcGFkLmxlbmd0aDtcblxuICAgICAgdmFyIF9wYWRkaW5nTGVuID0gX2xlbiAtIF9zLmxlbmd0aDtcblxuICAgICAgdmFyIF9zaWRlTGVuID0gdG9JbnQoX3BhZGRpbmdMZW4gLyAyKTsgLy8/XG5cblxuICAgICAgdmFyIF9yZW1haW5pbmdMZW4gPSBfcGFkZGluZ0xlbiAlIDI7IC8vP1xuXG5cbiAgICAgIGlmIChfcGFkZGluZ0xlbiA8PSAwIHx8IF9wYWRMZW4gPT09IDApIHtcbiAgICAgICAgcmV0dXJuIF9zO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcGFkQnVpbGRlcihwYWQsIF9zaWRlTGVuKSArIF9zICsgcGFkQnVpbGRlcihwYWQsIF9zaWRlTGVuICsgX3JlbWFpbmluZ0xlbik7IC8vP1xuICAgIH1cblxuICAgIHZhciBfcGFkID0gZnVuY3Rpb24gX3BhZChzLCBsZW4sIHBhZCwgbGVmdCkge1xuICAgICAgdmFyIF9zID0gdG9TdHIocyk7XG5cbiAgICAgIHZhciBfbGVuID0gaXNOdWxsKGxlbikgfHwgaXNOYU4obGVuKSA/IF9zLmxlbmd0aCA6IGNsaXAodG9JbnQobGVuKSwgMCwgTUFYX1NBRkVfSU5URUdFUik7XG5cbiAgICAgIHZhciBfcGFkTGVuID0gcGFkLmxlbmd0aDtcblxuICAgICAgdmFyIF9wYWRkaW5nTGVuID0gX2xlbiAtIF9zLmxlbmd0aDtcblxuICAgICAgdmFyIF9zaWRlTGVuID0gX3BhZGRpbmdMZW47XG5cbiAgICAgIGlmIChfcGFkZGluZ0xlbiA8PSAwIHx8IF9wYWRMZW4gPT09IDApIHtcbiAgICAgICAgcmV0dXJuIF9zO1xuICAgICAgfVxuXG4gICAgICB2YXIgcGFkcyA9IHBhZEJ1aWxkZXIocGFkLCBfc2lkZUxlbik7XG4gICAgICByZXR1cm4gbGVmdCA/IHBhZHMgKyBfcyA6IF9zICsgcGFkcztcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gbHBhZChzLCBsZW4pIHtcbiAgICAgIHZhciBwYWQgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6ICcgJztcbiAgICAgIHJldHVybiBfcGFkKHMsIGxlbiwgcGFkLCB0cnVlKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gcnBhZChzLCBsZW4pIHtcbiAgICAgIHZhciBwYWQgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6ICcgJztcbiAgICAgIHJldHVybiBfcGFkKHMsIGxlbiwgcGFkLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5zZXJ0KHMpIHtcbiAgICAgIHZhciBzYmogPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6ICcnO1xuICAgICAgdmFyIHBvcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogMDtcblxuICAgICAgdmFyIF9zID0gdG9TdHIocyk7XG5cbiAgICAgIHJldHVybiBfcy5zdWJzdHIoMCwgcG9zKSArIHNiaiArIF9zLnN1YnN0cihwb3MpO1xuICAgIH1cblxuICAgIHZhciByZWR1Y2UgPSBBcnJheS5wcm90b3R5cGUucmVkdWNlO1xuICAgIHZhciByZWR1Y2VSaWdodCA9IEFycmF5LnByb3RvdHlwZS5yZWR1Y2VSaWdodDtcbiAgICBmdW5jdGlvbiB0cmltKHMsIHdzKSB7XG4gICAgICByZXR1cm4gbHRyaW0ocnRyaW0ocywgd3MpLCB3cyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGx0cmltKHMsIHdzKSB7XG4gICAgICB2YXIgX3MgPSB0b1N0cihzKTtcblxuICAgICAgaWYgKGlzTnVsbCh3cykpIHtcbiAgICAgICAgcmV0dXJuIF9zLnJlcGxhY2UoUkVHRVhQX1RSSU1fTEVGVCwgJycpO1xuICAgICAgfVxuXG4gICAgICBpZiAod3MgPT09ICcnIHx8IF9zID09PSAnJykge1xuICAgICAgICByZXR1cm4gX3M7XG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlb2Ygd3MgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgd3MgPSAnJztcbiAgICAgIH1cblxuICAgICAgdmFyIG1hdGNoID0gdHJ1ZTtcbiAgICAgIHJldHVybiByZWR1Y2UuY2FsbChfcywgZnVuY3Rpb24gKHRyaW1tZWQsIF9jaGFyKSB7XG4gICAgICAgIGlmIChtYXRjaCAmJiB3cy5pbmNsdWRlcyhfY2hhcikpIHtcbiAgICAgICAgICByZXR1cm4gdHJpbW1lZDtcbiAgICAgICAgfVxuXG4gICAgICAgIG1hdGNoID0gZmFsc2U7XG4gICAgICAgIHJldHVybiB0cmltbWVkICsgX2NoYXI7XG4gICAgICB9LCAnJyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHJ0cmltKHMsIHdzKSB7XG4gICAgICB2YXIgX3MgPSB0b1N0cihzKTtcblxuICAgICAgaWYgKGlzTnVsbCh3cykpIHtcbiAgICAgICAgcmV0dXJuIF9zLnJlcGxhY2UoUkVHRVhQX1RSSU1fUklHSFQsICcnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHdzID09PSAnJyB8fCBfcyA9PT0gJycpIHtcbiAgICAgICAgcmV0dXJuIF9zO1xuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIHdzICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHdzID0gJyc7XG4gICAgICB9XG5cbiAgICAgIHZhciBtYXRjaCA9IHRydWU7XG4gICAgICByZXR1cm4gcmVkdWNlUmlnaHQuY2FsbChfcywgZnVuY3Rpb24gKHRyaW1tZWQsIF9jaGFyMikge1xuICAgICAgICBpZiAobWF0Y2ggJiYgd3MuaW5jbHVkZXMoX2NoYXIyKSkge1xuICAgICAgICAgIHJldHVybiB0cmltbWVkO1xuICAgICAgICB9XG5cbiAgICAgICAgbWF0Y2ggPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIF9jaGFyMiArIHRyaW1tZWQ7XG4gICAgICB9LCAnJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZW5kc1dpdGgocywgZW5kLCBwb3MpIHtcbiAgICAgIHZhciBfcyA9IHRvU3RyKHMpO1xuXG4gICAgICByZXR1cm4gX3MuZW5kc1dpdGgoZW5kLCBwb3MpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzQWxwaGEocykge1xuICAgICAgcmV0dXJuIFJFR0VYUF9BTFBIQS50ZXN0KHRvU3RyKHMpKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpc0FscGhhRGlnaXQocykge1xuICAgICAgcmV0dXJuIFJFR0VYUF9BTFBIQV9ESUdJVC50ZXN0KHRvU3RyKHMpKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpc0FscGhhRGlnaXQkMShzKSB7XG4gICAgICByZXR1cm4gUkVHRVhQX0RJR0lULnRlc3QodG9TdHIocykpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzQmxhbmsocykge1xuICAgICAgcmV0dXJuIHRyaW0ocykubGVuZ3RoID09PSAwO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzRW1wdHkocykge1xuICAgICAgcmV0dXJuIHRvU3RyKHMpLmxlbmd0aCA9PT0gMDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpc0xvd2VyKHMpIHtcbiAgICAgIHZhciBfcyA9IHRvU3RyKHMpO1xuXG4gICAgICByZXR1cm4gX3MudG9Mb3dlckNhc2UoKSA9PT0gX3M7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNVcHBlcihzKSB7XG4gICAgICB2YXIgX3MgPSB0b1N0cihzKTtcblxuICAgICAgcmV0dXJuIF9zLnRvVXBwZXJDYXNlKCkgPT09IF9zO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN0YXJ0V2l0aChzLCBzdGFydCwgcG9zKSB7XG4gICAgICB2YXIgX3MgPSB0b1N0cihzKTtcblxuICAgICAgcmV0dXJuIF9zLnN0YXJ0c1dpdGgoc3RhcnQsIHBvcyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc3RyaXBUYWdzQWxsKHMpIHtcbiAgICAgIHZhciBfcyA9IHRvU3RyKHMpO1xuXG4gICAgICByZXR1cm4gX3MucmVwbGFjZShSRUdFWFBfVEFHUywgJycpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBzdHJpcFRhZ3Mocykge1xuICAgICAgdmFyIGFsbG93ZWQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IFtdO1xuXG4gICAgICB2YXIgX3MgPSB0b1N0cihzKTtcblxuICAgICAgdmFyIHRhZ3MgPSAvPFxcLz8oW2Etel1bYS16MC05XSopXFxiW14+XSo+L2dpO1xuICAgICAgcmV0dXJuIF9zLnJlcGxhY2UodGFncywgZnVuY3Rpb24gKCQwLCAkMSkge1xuXG4gICAgICAgIHJldHVybiBhbGxvd2VkLmluY2x1ZGVzKCQxKSA/ICQwIDogJyc7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKlxuICAgICogT3JpZ2luYWwgY29kZVxuICAgICogY29weXJpZ2h0IChjKSAyMDA3LXByZXNlbnQgYnkgQWxleGFuZHJ1IE3Eg3LEg8iZdGVhbnUgPGhlbGxvQGFsZXhlaS5ybz5cbiAgICAqIFNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL2FsZXhlaS9zcHJpbnRmLmpzXG4gICAgKiBMaWNlbnNlOiBCU0QtMy1DbGF1c2UgTGljZW5zZVxuICAgICogKi9cbiAgICB2YXIgcmUgPSB7XG4gICAgICBub3Rfc3RyaW5nOiAvW15zXS8sXG4gICAgICBub3RfYm9vbDogL1tedF0vLFxuICAgICAgbm90X3R5cGU6IC9bXlRdLyxcbiAgICAgIG5vdF9wcmltaXRpdmU6IC9bXnZdLyxcbiAgICAgIG51bWJlcjogL1tkaWVmZ10vLFxuICAgICAgbnVtZXJpY19hcmc6IC9bYmNkaWVmZ3V4WF0vLFxuICAgICAganNvbjogL1tqXS8sXG4gICAgICBub3RfanNvbjogL1teal0vLFxuICAgICAgdGV4dDogL15bXlxceDI1XSsvLFxuICAgICAgbW9kdWxvOiAvXlxceDI1ezJ9LyxcbiAgICAgIHBsYWNlaG9sZGVyOiAvXlxceDI1KD86KFsxLTldXFxkKilcXCR8XFwoKFteKV0rKVxcKSk/KFxcKyk/KDB8J1teJF0pPygtKT8oXFxkKyk/KD86XFwuKFxcZCspKT8oW2ItZ2lqb3N0VHV2eFhdKS8sXG4gICAgICBrZXk6IC9eKFthLXpfXVthLXpfXFxkXSopL2ksXG4gICAgICBrZXlfYWNjZXNzOiAvXlxcLihbYS16X11bYS16X1xcZF0qKS9pLFxuICAgICAgaW5kZXhfYWNjZXNzOiAvXlxcWyhcXGQrKVxcXS8sXG4gICAgICBzaWduOiAvXlsrLV0vXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHNwcmludGZfZm9ybWF0KHBhcnNlX3RyZWUsIGFyZ3YpIHtcbiAgICAgIHZhciBjdXJzb3IgPSAxLFxuICAgICAgICAgIHRyZWVfbGVuZ3RoID0gcGFyc2VfdHJlZS5sZW5ndGgsXG4gICAgICAgICAgYXJnLFxuICAgICAgICAgIG91dHB1dCA9ICcnLFxuICAgICAgICAgIHBoLFxuICAgICAgICAgIHBhZCxcbiAgICAgICAgICBwYWRfY2hhcmFjdGVyLFxuICAgICAgICAgIHBhZF9sZW5ndGgsXG4gICAgICAgICAgaXNfcG9zaXRpdmUsXG4gICAgICAgICAgc2lnbjtcblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0cmVlX2xlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmICh0eXBlb2YgcGFyc2VfdHJlZVtpXSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICBvdXRwdXQgKz0gcGFyc2VfdHJlZVtpXTtcbiAgICAgICAgfSBlbHNlIGlmIChfdHlwZW9mKHBhcnNlX3RyZWVbaV0pID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgIHBoID0gcGFyc2VfdHJlZVtpXTsgLy8gY29udmVuaWVuY2UgcHVycG9zZXMgb25seVxuXG4gICAgICAgICAgaWYgKHBoLmtleXMpIHtcbiAgICAgICAgICAgIC8vIGtleXdvcmQgYXJndW1lbnRcbiAgICAgICAgICAgIGFyZyA9IGFyZ3ZbY3Vyc29yXTtcblxuICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBwaC5rZXlzLmxlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICAgIGlmICh0eXBlb2YgYXJnID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHNwcmludGYoJ1tzcHJpbnRmXSBDYW5ub3QgYWNjZXNzIHByb3BlcnR5IFwiJXNcIiBvZiB1bmRlZmluZWQgdmFsdWUgXCIlc1wiJywgcGgua2V5c1trXSwgcGgua2V5c1trIC0gMV0pKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGFyZyA9IGFyZ1twaC5rZXlzW2tdXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgaWYgKHBoLnBhcmFtX25vKSB7XG4gICAgICAgICAgICAvLyBwb3NpdGlvbmFsIGFyZ3VtZW50IChleHBsaWNpdClcbiAgICAgICAgICAgIGFyZyA9IGFyZ3ZbcGgucGFyYW1fbm9dO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBwb3NpdGlvbmFsIGFyZ3VtZW50IChpbXBsaWNpdClcbiAgICAgICAgICAgIGFyZyA9IGFyZ3ZbY3Vyc29yKytdO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChyZS5ub3RfdHlwZS50ZXN0KHBoLnR5cGUpICYmIHJlLm5vdF9wcmltaXRpdmUudGVzdChwaC50eXBlKSAmJiBhcmcgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xuICAgICAgICAgICAgYXJnID0gYXJnKCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHJlLm51bWVyaWNfYXJnLnRlc3QocGgudHlwZSkgJiYgdHlwZW9mIGFyZyAhPT0gJ251bWJlcicgJiYgaXNOYU4oYXJnKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzcHJpbnRmKCdbc3ByaW50Zl0gZXhwZWN0aW5nIG51bWJlciBidXQgZm91bmQgJVQnLCBhcmcpKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAocmUubnVtYmVyLnRlc3QocGgudHlwZSkpIHtcbiAgICAgICAgICAgIGlzX3Bvc2l0aXZlID0gYXJnID49IDA7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgc3dpdGNoIChwaC50eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdiJzpcbiAgICAgICAgICAgICAgYXJnID0gcGFyc2VJbnQoYXJnLCAxMCkudG9TdHJpbmcoMik7XG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdjJzpcbiAgICAgICAgICAgICAgYXJnID0gU3RyaW5nLmZyb21DaGFyQ29kZShwYXJzZUludChhcmcsIDEwKSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdkJzpcbiAgICAgICAgICAgIGNhc2UgJ2knOlxuICAgICAgICAgICAgICBhcmcgPSBwYXJzZUludChhcmcsIDEwKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2onOlxuICAgICAgICAgICAgICBhcmcgPSBKU09OLnN0cmluZ2lmeShhcmcsIG51bGwsIHBoLndpZHRoID8gcGFyc2VJbnQocGgud2lkdGgpIDogMCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdlJzpcbiAgICAgICAgICAgICAgYXJnID0gcGgucHJlY2lzaW9uID8gcGFyc2VGbG9hdChhcmcpLnRvRXhwb25lbnRpYWwocGgucHJlY2lzaW9uKSA6IHBhcnNlRmxvYXQoYXJnKS50b0V4cG9uZW50aWFsKCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdmJzpcbiAgICAgICAgICAgICAgYXJnID0gcGgucHJlY2lzaW9uID8gcGFyc2VGbG9hdChhcmcpLnRvRml4ZWQocGgucHJlY2lzaW9uKSA6IHBhcnNlRmxvYXQoYXJnKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2cnOlxuICAgICAgICAgICAgICBhcmcgPSBwaC5wcmVjaXNpb24gPyBTdHJpbmcoTnVtYmVyKGFyZy50b1ByZWNpc2lvbihwaC5wcmVjaXNpb24pKSkgOiBwYXJzZUZsb2F0KGFyZyk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdvJzpcbiAgICAgICAgICAgICAgYXJnID0gKHBhcnNlSW50KGFyZywgMTApID4+PiAwKS50b1N0cmluZyg4KTtcbiAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ3MnOlxuICAgICAgICAgICAgICBhcmcgPSBTdHJpbmcoYXJnKTtcbiAgICAgICAgICAgICAgYXJnID0gcGgucHJlY2lzaW9uID8gYXJnLnN1YnN0cmluZygwLCBwaC5wcmVjaXNpb24pIDogYXJnO1xuICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAndCc6XG4gICAgICAgICAgICAgIGFyZyA9IFN0cmluZyghIWFyZyk7XG4gICAgICAgICAgICAgIGFyZyA9IHBoLnByZWNpc2lvbiA/IGFyZy5zdWJzdHJpbmcoMCwgcGgucHJlY2lzaW9uKSA6IGFyZztcbiAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ1QnOlxuICAgICAgICAgICAgICBhcmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJnKS5zbGljZSg4LCAtMSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgYXJnID0gcGgucHJlY2lzaW9uID8gYXJnLnN1YnN0cmluZygwLCBwaC5wcmVjaXNpb24pIDogYXJnO1xuICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAndSc6XG4gICAgICAgICAgICAgIGFyZyA9IHBhcnNlSW50KGFyZywgMTApID4+PiAwO1xuICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAndic6XG4gICAgICAgICAgICAgIGFyZyA9IGFyZy52YWx1ZU9mKCk7XG4gICAgICAgICAgICAgIGFyZyA9IHBoLnByZWNpc2lvbiA/IGFyZy5zdWJzdHJpbmcoMCwgcGgucHJlY2lzaW9uKSA6IGFyZztcbiAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ3gnOlxuICAgICAgICAgICAgICBhcmcgPSAocGFyc2VJbnQoYXJnLCAxMCkgPj4+IDApLnRvU3RyaW5nKDE2KTtcbiAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ1gnOlxuICAgICAgICAgICAgICBhcmcgPSAocGFyc2VJbnQoYXJnLCAxMCkgPj4+IDApLnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAocmUuanNvbi50ZXN0KHBoLnR5cGUpKSB7XG4gICAgICAgICAgICBvdXRwdXQgKz0gYXJnO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAocmUubnVtYmVyLnRlc3QocGgudHlwZSkgJiYgKCFpc19wb3NpdGl2ZSB8fCBwaC5zaWduKSkge1xuICAgICAgICAgICAgICBzaWduID0gaXNfcG9zaXRpdmUgPyAnKycgOiAnLSc7XG4gICAgICAgICAgICAgIGFyZyA9IGFyZy50b1N0cmluZygpLnJlcGxhY2UocmUuc2lnbiwgJycpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgc2lnbiA9ICcnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwYWRfY2hhcmFjdGVyID0gcGgucGFkX2NoYXIgPyBwaC5wYWRfY2hhciA9PT0gJzAnID8gJzAnIDogcGgucGFkX2NoYXIuY2hhckF0KDEpIDogJyAnO1xuICAgICAgICAgICAgcGFkX2xlbmd0aCA9IHBoLndpZHRoIC0gKHNpZ24gKyBhcmcpLmxlbmd0aDtcbiAgICAgICAgICAgIHBhZCA9IHBoLndpZHRoID8gcGFkX2xlbmd0aCA+IDAgPyBwYWRfY2hhcmFjdGVyLnJlcGVhdChwYWRfbGVuZ3RoKSA6ICcnIDogJyc7XG4gICAgICAgICAgICBvdXRwdXQgKz0gcGguYWxpZ24gPyBzaWduICsgYXJnICsgcGFkIDogcGFkX2NoYXJhY3RlciA9PT0gJzAnID8gc2lnbiArIHBhZCArIGFyZyA6IHBhZCArIHNpZ24gKyBhcmc7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfVxuXG4gICAgdmFyIHNwcmludGZfY2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG4gICAgZnVuY3Rpb24gc3ByaW50Zl9wYXJzZShmbXQpIHtcbiAgICAgIGlmIChzcHJpbnRmX2NhY2hlW2ZtdF0pIHtcbiAgICAgICAgcmV0dXJuIHNwcmludGZfY2FjaGVbZm10XTtcbiAgICAgIH1cblxuICAgICAgdmFyIF9mbXQgPSBmbXQsXG4gICAgICAgICAgbWF0Y2gsXG4gICAgICAgICAgcGFyc2VfdHJlZSA9IFtdLFxuICAgICAgICAgIGFyZ19uYW1lcyA9IDA7XG5cbiAgICAgIHdoaWxlIChfZm10KSB7XG4gICAgICAgIGlmICgobWF0Y2ggPSByZS50ZXh0LmV4ZWMoX2ZtdCkpICE9PSBudWxsKSB7XG4gICAgICAgICAgcGFyc2VfdHJlZS5wdXNoKG1hdGNoWzBdKTtcbiAgICAgICAgfSBlbHNlIGlmICgobWF0Y2ggPSByZS5tb2R1bG8uZXhlYyhfZm10KSkgIT09IG51bGwpIHtcbiAgICAgICAgICBwYXJzZV90cmVlLnB1c2goJyUnKTtcbiAgICAgICAgfSBlbHNlIGlmICgobWF0Y2ggPSByZS5wbGFjZWhvbGRlci5leGVjKF9mbXQpKSAhPT0gbnVsbCkge1xuICAgICAgICAgIGlmIChtYXRjaFsyXSkge1xuICAgICAgICAgICAgYXJnX25hbWVzIHw9IDE7XG4gICAgICAgICAgICB2YXIgZmllbGRfbGlzdCA9IFtdLFxuICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50X2ZpZWxkID0gbWF0Y2hbMl0sXG4gICAgICAgICAgICAgICAgZmllbGRfbWF0Y2ggPSBbXTtcblxuICAgICAgICAgICAgaWYgKChmaWVsZF9tYXRjaCA9IHJlLmtleS5leGVjKHJlcGxhY2VtZW50X2ZpZWxkKSkgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgZmllbGRfbGlzdC5wdXNoKGZpZWxkX21hdGNoWzFdKTtcblxuICAgICAgICAgICAgICB3aGlsZSAoKHJlcGxhY2VtZW50X2ZpZWxkID0gcmVwbGFjZW1lbnRfZmllbGQuc3Vic3RyaW5nKGZpZWxkX21hdGNoWzBdLmxlbmd0aCkpICE9PSAnJykge1xuICAgICAgICAgICAgICAgIGlmICgoZmllbGRfbWF0Y2ggPSByZS5rZXlfYWNjZXNzLmV4ZWMocmVwbGFjZW1lbnRfZmllbGQpKSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgZmllbGRfbGlzdC5wdXNoKGZpZWxkX21hdGNoWzFdKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKChmaWVsZF9tYXRjaCA9IHJlLmluZGV4X2FjY2Vzcy5leGVjKHJlcGxhY2VtZW50X2ZpZWxkKSkgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgIGZpZWxkX2xpc3QucHVzaChmaWVsZF9tYXRjaFsxXSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcignW3NwcmludGZdIGZhaWxlZCB0byBwYXJzZSBuYW1lZCBhcmd1bWVudCBrZXknKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcignW3NwcmludGZdIGZhaWxlZCB0byBwYXJzZSBuYW1lZCBhcmd1bWVudCBrZXknKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbWF0Y2hbMl0gPSBmaWVsZF9saXN0O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhcmdfbmFtZXMgfD0gMjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoYXJnX25hbWVzID09PSAzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tzcHJpbnRmXSBtaXhpbmcgcG9zaXRpb25hbCBhbmQgbmFtZWQgcGxhY2Vob2xkZXJzIGlzIG5vdCAoeWV0KSBzdXBwb3J0ZWQnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBwYXJzZV90cmVlLnB1c2goe1xuICAgICAgICAgICAgcGxhY2Vob2xkZXI6IG1hdGNoWzBdLFxuICAgICAgICAgICAgcGFyYW1fbm86IG1hdGNoWzFdLFxuICAgICAgICAgICAga2V5czogbWF0Y2hbMl0sXG4gICAgICAgICAgICBzaWduOiBtYXRjaFszXSxcbiAgICAgICAgICAgIHBhZF9jaGFyOiBtYXRjaFs0XSxcbiAgICAgICAgICAgIGFsaWduOiBtYXRjaFs1XSxcbiAgICAgICAgICAgIHdpZHRoOiBtYXRjaFs2XSxcbiAgICAgICAgICAgIHByZWNpc2lvbjogbWF0Y2hbN10sXG4gICAgICAgICAgICB0eXBlOiBtYXRjaFs4XVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcignW3NwcmludGZdIHVuZXhwZWN0ZWQgcGxhY2Vob2xkZXInKTtcbiAgICAgICAgfVxuXG4gICAgICAgIF9mbXQgPSBfZm10LnN1YnN0cmluZyhtYXRjaFswXS5sZW5ndGgpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc3ByaW50Zl9jYWNoZVtmbXRdID0gcGFyc2VfdHJlZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzcHJpbnRmKGtleSkge1xuICAgICAgcmV0dXJuIHNwcmludGZfZm9ybWF0KHNwcmludGZfcGFyc2Uoa2V5KSwgYXJndW1lbnRzKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gdnNwcmludGYoZm10LCBhcmd2KSB7XG4gICAgICByZXR1cm4gc3ByaW50Zi5hcHBseShudWxsLCBbZm10XS5jb25jYXQoYXJndiB8fCBbXSkpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGluY2x1ZGVzKHMsIHN1YiwgcG9zKSB7XG4gICAgICB2YXIgX3MgPSB0b1N0cihzKTtcblxuICAgICAgcmV0dXJuIF9zLmluY2x1ZGVzKHN1YiwgcG9zKTtcbiAgICB9XG5cbiAgICB2YXIgZnVuY3Rpb25zID0ge1xuICAgICAgY2FtZWxDYXNlOiBjYW1lbENhc2UsXG4gICAgICBjYXBpdGFsaXplOiBjYXBpdGFsaXplLFxuICAgICAgY2hhcnM6IGNoYXJzLFxuICAgICAgY291bnQ6IGNvdW50LFxuICAgICAgY291bnRDaGFyczogY291bnRDaGFycyxcbiAgICAgIGNvdW50VW5pcXVlQ2hhcnM6IGNvdW50VW5pcXVlQ2hhcnMsXG4gICAgICBjb3VudFN1YnN0cjogY291bnRTdWJzdHIsXG4gICAgICBjb3VudFdvcmRzOiBjb3VudFdvcmRzLFxuICAgICAgY291bnRVbmlxdWVXb3JkczogY291bnRVbmlxdWVXb3JkcyxcbiAgICAgIGRhc2hlZE5hbWU6IGRhc2hlZE5hbWUsXG4gICAgICBkZWNhcGl0YWxpemU6IGRlY2FwaXRhbGl6ZSxcbiAgICAgIGtlYmFiOiBrZWJhYixcbiAgICAgIGxvd2VyOiBsb3dlcixcbiAgICAgIHJldmVyc2U6IHJldmVyc2UsXG4gICAgICBzaHVmZmxlOiBzaHVmZmxlLFxuICAgICAgc25ha2U6IHNuYWtlLFxuICAgICAgc3dhcDogc3dhcCxcbiAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgIHVwcGVyOiB1cHBlcixcbiAgICAgIHdvcmRzOiB3b3JkcyxcbiAgICAgIHdyYXA6IHdyYXAsXG4gICAgICB3cmFwVGFnOiB3cmFwVGFnLFxuICAgICAgZXNjYXBlSHRtbDogZXNjYXBlSHRtbCxcbiAgICAgIHVuZXNjYXBlSHRtbDogdW5lc2NhcGVIdG1sLFxuICAgICAgdW5pcXVlOiB1bmlxdWUsXG4gICAgICB1bmlxdWVXb3JkczogdW5pcXVlV29yZHMsXG4gICAgICBzdWJzdHI6IHN1YnN0cixcbiAgICAgIGZpcnN0OiBmaXJzdCxcbiAgICAgIGxhc3Q6IGxhc3QsXG4gICAgICB0cnVuY2F0ZTogdHJ1bmNhdGUsXG4gICAgICBzbGljZTogc2xpY2UsXG4gICAgICBwcnVuZTogcHJ1bmUsXG4gICAgICByZXBlYXQ6IHJlcGVhdCxcbiAgICAgIHBhZDogcGFkLFxuICAgICAgbHBhZDogbHBhZCxcbiAgICAgIHJwYWQ6IHJwYWQsXG4gICAgICBpbnNlcnQ6IGluc2VydCxcbiAgICAgIHRyaW06IHRyaW0sXG4gICAgICBsdHJpbTogbHRyaW0sXG4gICAgICBydHJpbTogcnRyaW0sXG4gICAgICBlbmRzV2l0aDogZW5kc1dpdGgsXG4gICAgICBpc0FscGhhOiBpc0FscGhhLFxuICAgICAgaXNBbHBoYURpZ2l0OiBpc0FscGhhRGlnaXQsXG4gICAgICBpc0RpZ2l0OiBpc0FscGhhRGlnaXQkMSxcbiAgICAgIGlzQmxhbms6IGlzQmxhbmssXG4gICAgICBpc0VtcHR5OiBpc0VtcHR5LFxuICAgICAgaXNMb3dlcjogaXNMb3dlcixcbiAgICAgIGlzVXBwZXI6IGlzVXBwZXIsXG4gICAgICBzdGFydFdpdGg6IHN0YXJ0V2l0aCxcbiAgICAgIHN0cmlwVGFnczogc3RyaXBUYWdzLFxuICAgICAgc3RyaXBUYWdzQWxsOiBzdHJpcFRhZ3NBbGwsXG4gICAgICBzcHJpbnRmOiBzcHJpbnRmLFxuICAgICAgdnNwcmludGY6IHZzcHJpbnRmLFxuICAgICAgaW5jbHVkZXM6IGluY2x1ZGVzXG4gICAgfTtcblxuICAgIHZhciBfX2dsb2JhbCA9IG51bGw7XG5cbiAgICBmdW5jdGlvbiBnZXRHbG9iYWxPYmplY3QoKSB7XG4gICAgICBpZiAoX19nbG9iYWwgIT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIF9fZ2xvYmFsO1xuICAgICAgfVxuXG4gICAgICBpZiAoKHR5cGVvZiBnbG9iYWwgPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZihnbG9iYWwpKSA9PT0gJ29iamVjdCcgJiYgZ2xvYmFsLk9iamVjdCA9PT0gT2JqZWN0KSB7XG4gICAgICAgIF9fZ2xvYmFsID0gZ2xvYmFsO1xuICAgICAgfSBlbHNlIGlmICgodHlwZW9mIHNlbGYgPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZihzZWxmKSkgPT09ICdvYmplY3QnICYmIHNlbGYuT2JqZWN0ID09PSBPYmplY3QpIHtcbiAgICAgICAgX19nbG9iYWwgPSBzZWxmO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX19nbG9iYWwgPSBuZXcgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIF9fZ2xvYmFsO1xuICAgIH1cblxuICAgIHZhciBfU3ltYm9sJHRvUHJpbWl0aXZlLCBfU3ltYm9sJHRvU3RyaW5nVGFnO1xuICAgIF9TeW1ib2wkdG9QcmltaXRpdmUgPSBTeW1ib2wudG9QcmltaXRpdmU7XG4gICAgX1N5bWJvbCR0b1N0cmluZ1RhZyA9IFN5bWJvbC50b1N0cmluZ1RhZztcblxuICAgIHZhciBDYWtlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHtcbiAgICAgIGZ1bmN0aW9uIENha2UoKSB7XG4gICAgICAgIHZhciBzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBcIlwiO1xuXG4gICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDYWtlKTtcblxuICAgICAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJfdmFsdWVcIiwgdm9pZCAwKTtcblxuICAgICAgICB0aGlzLl92YWx1ZSA9IFwiXCIgKyBzO1xuICAgICAgfVxuXG4gICAgICBfY3JlYXRlQ2xhc3MoQ2FrZSwgW3tcbiAgICAgICAga2V5OiBfU3ltYm9sJHRvUHJpbWl0aXZlLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoaGludCkge1xuICAgICAgICAgIGlmIChoaW50ID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgICAgICByZXR1cm4gK3RoaXMudmFsdWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcInRvU3RyaW5nXCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiB0b1N0cmluZygpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICAvKiBlc2NhcGUgKi9cblxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwiZXNjYXBlSHRtbFwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZXNjYXBlSHRtbCgpIHtcbiAgICAgICAgICB0aGlzLnZhbHVlID0gZnVuY3Rpb25zLmVzY2FwZUh0bWwodGhpcy52YWx1ZSk7XG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcInVuZXNjYXBlSHRtbFwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdW5lc2NhcGVIdG1sKCkge1xuICAgICAgICAgIHRoaXMudmFsdWUgPSBmdW5jdGlvbnMudW5lc2NhcGVIdG1sKHRoaXMudmFsdWUpO1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIC8qIGVuZCBvZiBlc2NhcGUgKi9cblxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwiY2FtZWxDYXNlXCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjYW1lbENhc2UoKSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IGZ1bmN0aW9ucy5jYW1lbENhc2UodGhpcy52YWx1ZSk7XG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcImNhcGl0YWxpemVcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNhcGl0YWxpemUoc3Ryb25nKSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IGZ1bmN0aW9ucy5jYXBpdGFsaXplKHRoaXMudmFsdWUsIHN0cm9uZyk7XG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcImNoYXJzXCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjaGFycygpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb25zLmNoYXJzKHRoaXMudmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJjb3VudFwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY291bnQoKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9ucy5jb3VudCh0aGlzLnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwiY291bnRDaGFyc1wiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY291bnRDaGFycyhpZ25vcmUpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb25zLmNvdW50Q2hhcnModGhpcy52YWx1ZSwgaWdub3JlKTtcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwiY291bnRVbmlxdWVDaGFyc1wiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY291bnRVbmlxdWVDaGFycyhpZ25vcmUpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb25zLmNvdW50VW5pcXVlQ2hhcnModGhpcy52YWx1ZSwgaWdub3JlKTtcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwiY291bnRTdWJzdHJcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNvdW50U3Vic3RyKHN1Yikge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbnMuY291bnRTdWJzdHIodGhpcy52YWx1ZSwgc3ViKTtcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwiY291bnRXb3Jkc1wiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY291bnRXb3JkcyhwYXR0ZXJuLCBmbGFncykge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbnMuY291bnRXb3Jkcyh0aGlzLnZhbHVlLCBwYXR0ZXJuLCBmbGFncyk7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcImNvdW50VW5pcXVlV29yZHNcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNvdW50VW5pcXVlV29yZHMocGF0dGVybiwgZmxhZ3MpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb25zLmNvdW50VW5pcXVlV29yZHModGhpcy52YWx1ZSwgcGF0dGVybiwgZmxhZ3MpO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJkYXNoZWROYW1lXCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBkYXNoZWROYW1lKCkge1xuICAgICAgICAgIHRoaXMudmFsdWUgPSBmdW5jdGlvbnMuZGFzaGVkTmFtZSh0aGlzLnZhbHVlKTtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwiZGVjYXBpdGFsaXplXCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBkZWNhcGl0YWxpemUoKSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IGZ1bmN0aW9ucy5kZWNhcGl0YWxpemUodGhpcy52YWx1ZSk7XG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcImtlYmFiXCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBrZWJhYigpIHtcbiAgICAgICAgICB0aGlzLnZhbHVlID0gZnVuY3Rpb25zLmtlYmFiKHRoaXMudmFsdWUpO1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJsb3dlclwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gbG93ZXIoKSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IGZ1bmN0aW9ucy5sb3dlcih0aGlzLnZhbHVlKTtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwicmV2ZXJzZVwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmV2ZXJzZSgpIHtcbiAgICAgICAgICB0aGlzLnZhbHVlID0gZnVuY3Rpb25zLnJldmVyc2UodGhpcy52YWx1ZSk7XG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcInNodWZmbGVcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNodWZmbGUoKSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IGZ1bmN0aW9ucy5zaHVmZmxlKHRoaXMudmFsdWUpO1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJzbmFrZVwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc25ha2UoKSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IGZ1bmN0aW9ucy5zbmFrZSh0aGlzLnZhbHVlKTtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwic3dhcFwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc3dhcCgpIHtcbiAgICAgICAgICB0aGlzLnZhbHVlID0gZnVuY3Rpb25zLnN3YXAodGhpcy52YWx1ZSk7XG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcInRpdGxlXCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiB0aXRsZSgpIHtcbiAgICAgICAgICB0aGlzLnZhbHVlID0gZnVuY3Rpb25zLnRpdGxlKHRoaXMudmFsdWUpO1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJ1cHBlclwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdXBwZXIoKSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IGZ1bmN0aW9ucy51cHBlcih0aGlzLnZhbHVlKTtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwid29yZHNcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHdvcmRzKHBhdHRlcm4sIGZsYWdzKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9ucy53b3Jkcyh0aGlzLnZhbHVlLCBwYXR0ZXJuLCBmbGFncyk7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcIndyYXBcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHdyYXAoYSwgYikge1xuICAgICAgICAgIHRoaXMudmFsdWUgPSBmdW5jdGlvbnMud3JhcCh0aGlzLnZhbHVlLCBhLCBiKTtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwid3JhcFRhZ1wiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gd3JhcFRhZyh0KSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IGZ1bmN0aW9ucy53cmFwVGFnKHRoaXMudmFsdWUsIHQpO1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJwYWRcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHBhZChsZW4sIF9wYWQpIHtcbiAgICAgICAgICB0aGlzLnZhbHVlID0gZnVuY3Rpb25zLnBhZCh0aGlzLnZhbHVlLCBsZW4sIF9wYWQpO1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJscGFkXCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBscGFkKGxlbiwgcGFkKSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IGZ1bmN0aW9ucy5scGFkKHRoaXMudmFsdWUsIGxlbiwgcGFkKTtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwicnBhZFwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcnBhZChsZW4sIHBhZCkge1xuICAgICAgICAgIHRoaXMudmFsdWUgPSBmdW5jdGlvbnMucnBhZCh0aGlzLnZhbHVlLCBsZW4sIHBhZCk7XG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcInJlcGVhdFwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVwZWF0KHRpbWVzKSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IGZ1bmN0aW9ucy5yZXBlYXQodGhpcy52YWx1ZSwgdGltZXMpO1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJwcnVuZVwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcHJ1bmUobGVuLCBlbmQpIHtcbiAgICAgICAgICB0aGlzLnZhbHVlID0gZnVuY3Rpb25zLnBydW5lKHRoaXMudmFsdWUsIGxlbiwgZW5kKTtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwic2xpY2VcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNsaWNlKHBhcnRzKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9ucy5zbGljZSh0aGlzLnZhbHVlLCBwYXJ0cyk7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcInRydW5jYXRlXCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiB0cnVuY2F0ZShsZW4sIGVuZCkge1xuICAgICAgICAgIHRoaXMudmFsdWUgPSBmdW5jdGlvbnMudHJ1bmNhdGUodGhpcy52YWx1ZSwgbGVuLCBlbmQpO1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJsYXN0XCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBsYXN0KGxlbikge1xuICAgICAgICAgIHRoaXMudmFsdWUgPSBmdW5jdGlvbnMubGFzdCh0aGlzLnZhbHVlLCBsZW4pO1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJmaXJzdFwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZmlyc3QobGVuKSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IGZ1bmN0aW9ucy5maXJzdCh0aGlzLnZhbHVlLCBsZW4pO1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJzdWJzdHJcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHN1YnN0cihzdGFydCwgbGVuKSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IGZ1bmN0aW9ucy5zdWJzdHIodGhpcy52YWx1ZSwgc3RhcnQsIGxlbik7XG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcInVuaXF1ZVwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdW5pcXVlKGlnbm9yZSkge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbnMudW5pcXVlKHRoaXMudmFsdWUsIGlnbm9yZSk7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcInVuaXF1ZVdvcmRzXCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiB1bmlxdWVXb3JkcyhwYXR0ZXJuLCBmbGFncykge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbnMudW5pcXVlV29yZHModGhpcy52YWx1ZSwgcGF0dGVybiwgZmxhZ3MpO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJpbnNlcnRcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGluc2VydChzYmosIHBvcykge1xuICAgICAgICAgIHRoaXMudmFsdWUgPSBmdW5jdGlvbnMuaW5zZXJ0KHRoaXMudmFsdWUsIHNiaiwgcG9zKTtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwidHJpbVwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdHJpbSh3cykge1xuICAgICAgICAgIHRoaXMudmFsdWUgPSBmdW5jdGlvbnMudHJpbSh0aGlzLnZhbHVlLCB3cyk7XG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcImx0cmltXCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBsdHJpbSh3cykge1xuICAgICAgICAgIHRoaXMudmFsdWUgPSBmdW5jdGlvbnMubHRyaW0odGhpcy52YWx1ZSwgd3MpO1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJydHJpbVwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcnRyaW0od3MpIHtcbiAgICAgICAgICB0aGlzLnZhbHVlID0gZnVuY3Rpb25zLnJ0cmltKHRoaXMudmFsdWUsIHdzKTtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwiZW5kc1dpdGhcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGVuZHNXaXRoKGVuZCwgcG9zKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9ucy5lbmRzV2l0aCh0aGlzLnZhbHVlLCBlbmQsIHBvcyk7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcInN0YXJ0V2l0aFwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc3RhcnRXaXRoKHN0YXJ0LCBwb3MpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb25zLnN0YXJ0V2l0aCh0aGlzLnZhbHVlLCBzdGFydCwgcG9zKTtcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwiaXNBbHBoYVwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNBbHBoYSgpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb25zLmlzQWxwaGEodGhpcy52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcImlzQWxwaGFEaWdpdFwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNBbHBoYURpZ2l0KCkge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbnMuaXNBbHBoYURpZ2l0KHRoaXMudmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJpc0RpZ2l0XCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpc0RpZ2l0KCkge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbnMuaXNEaWdpdCh0aGlzLnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwiaXNCbGFua1wiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNCbGFuaygpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb25zLmlzQmxhbmsodGhpcy52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcImlzRW1wdHlcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlzRW1wdHkoKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9ucy5pc0VtcHR5KHRoaXMudmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJpc0xvd2VyXCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpc0xvd2VyKCkge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbnMuaXNMb3dlcih0aGlzLnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwiaXNVcHBlclwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNVcHBlcigpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb25zLmlzVXBwZXIodGhpcy52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcInN0cmlwVGFnc0FsbFwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc3RyaXBUYWdzQWxsKCkge1xuICAgICAgICAgIHRoaXMudmFsdWUgPSBmdW5jdGlvbnMuc3RyaXBUYWdzQWxsKHRoaXMudmFsdWUpO1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJzdHJpcFRhZ3NcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHN0cmlwVGFncyhhbGxvd2VkKSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IGZ1bmN0aW9ucy5zdHJpcFRhZ3ModGhpcy52YWx1ZSwgYWxsb3dlZCk7XG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiBcInNwcmludGZcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNwcmludGYoYXJncykge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbnMuc3ByaW50Zih0aGlzLnZhbHVlLCBhcmdzKTtcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwidnNwcmludGZcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZzcHJpbnRmKGFyZ3MpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb25zLnZzcHJpbnRmKHRoaXMudmFsdWUsIGFyZ3MpO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJpbmNsdWRlc1wiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaW5jbHVkZXMoc3ViLCBwb3MpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb25zLmluY2x1ZGVzKHRoaXMudmFsdWUsIHN1YiwgcG9zKTtcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IF9TeW1ib2wkdG9TdHJpbmdUYWcsXG4gICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgIHJldHVybiBcIkNha2VcIjtcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6IFwidmFsdWVcIixcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChzKSB7XG4gICAgICAgICAgdGhpcy5fdmFsdWUgPSBzO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogXCJsZW5ndGhcIixcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgfV0pO1xuXG4gICAgICByZXR1cm4gQ2FrZTtcbiAgICB9KCk7XG5cbiAgICB2YXIgY2FrZSA9IGZ1bmN0aW9uIGNha2Uocykge1xuICAgICAgcmV0dXJuIG5ldyBDYWtlKHMpO1xuICAgIH07XG5cbiAgICB2YXIgQ2FrZSQxID0gT2JqZWN0LmFzc2lnbih7fSwgZnVuY3Rpb25zKTtcbiAgICB2YXIgZ2xvYmFsJDEgPSBnZXRHbG9iYWxPYmplY3QoKTtcbiAgICBnbG9iYWwkMS5DYWtlID0gQ2FrZSQxO1xuICAgIGdsb2JhbCQxLmNha2UgPSBjYWtlO1xuXG59KCkpO1xuXHJcblxyXG4oZnVuY3Rpb24gKGdsb2JhbCwgdW5kZWZpbmVkKSB7XG5cbi8vIFNvdXJjZTogc3JjL21vZGUuanNcblxuLyoganNoaW50IC1XMDk3ICovXG4ndXNlIHN0cmljdCc7XG5cbi8vIFNvdXJjZTogc3JjL2Z1bmMuanNcblxuLyogZ2xvYmFsIGRhdGFTZXQgKi9cbi8qIGV4cG9ydGVkIGlzRGFyaywgaXNUb3VjaCwgaXNTaW1wbGUsIGlzSGlkZGVuLCBpc1BsYWluT2JqZWN0LCBpc0VtcHR5T2JqZWN0LCBpc0FycmF5TGlrZSwgc3RyMmFyciwgcGFyc2VVbml0LCBnZXRVbml0LCBzZXRTdHlsZVByb3AsIGFjY2VwdERhdGEsIGRhdGFBdHRyLCBub3JtTmFtZSwgc3RyaXAsIGRhc2hlZE5hbWUsIGlzTG9jYWxob3N0ICovXG5cbnZhciBudW1Qcm9wcyA9IFsnb3BhY2l0eScsICd6SW5kZXgnLCBcIm9yZGVyXCIsIFwiem9vbVwiXTtcblxuZnVuY3Rpb24gaXNTaW1wbGUodil7XG4gICAgcmV0dXJuIHR5cGVvZiB2ID09PSBcInN0cmluZ1wiIHx8IHR5cGVvZiB2ID09PSBcImJvb2xlYW5cIiB8fCB0eXBlb2YgdiA9PT0gXCJudW1iZXJcIjtcbn1cblxuZnVuY3Rpb24gaXNWaXNpYmxlKGVsZW0pIHtcbiAgICByZXR1cm4gISEoIGVsZW0ub2Zmc2V0V2lkdGggfHwgZWxlbS5vZmZzZXRIZWlnaHQgfHwgZWxlbS5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCApO1xufVxuXG5mdW5jdGlvbiBpc0hpZGRlbihlbGVtKSB7XG4gICAgdmFyIHMgPSBnZXRDb21wdXRlZFN0eWxlKGVsZW0pO1xuICAgIHJldHVybiAhaXNWaXNpYmxlKGVsZW0pIHx8ICtzLm9wYWNpdHkgPT09IDAgfHwgZWxlbS5oaWRkZW4gfHwgcy52aXNpYmlsaXR5ID09PSBcImhpZGRlblwiO1xufVxuXG5mdW5jdGlvbiBub3QodmFsdWUpe1xuICAgIHJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsO1xufVxuXG5mdW5jdGlvbiBjYW1lbENhc2Uoc3RyaW5nKXtcbiAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoIC8tKFthLXpdKS9nLCBmdW5jdGlvbihhbGwsIGxldHRlcil7XG4gICAgICAgIHJldHVybiBsZXR0ZXIudG9VcHBlckNhc2UoKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gZGFzaGVkTmFtZShzdHIpe1xuICAgIHJldHVybiBzdHIucmVwbGFjZSgvKFtBLVpdKS9nLCBmdW5jdGlvbih1KSB7IHJldHVybiBcIi1cIiArIHUudG9Mb3dlckNhc2UoKTsgfSk7XG59XG5cbmZ1bmN0aW9uIGlzUGxhaW5PYmplY3QoIG9iaiApIHtcbiAgICB2YXIgcHJvdG87XG4gICAgaWYgKCAhb2JqIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCggb2JqICkgIT09IFwiW29iamVjdCBPYmplY3RdXCIgKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcHJvdG8gPSBvYmoucHJvdG90eXBlICE9PSB1bmRlZmluZWQ7XG4gICAgaWYgKCAhcHJvdG8gKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gcHJvdG8uY29uc3RydWN0b3IgJiYgdHlwZW9mIHByb3RvLmNvbnN0cnVjdG9yID09PSBcImZ1bmN0aW9uXCI7XG59XG5cbmZ1bmN0aW9uIGlzRW1wdHlPYmplY3QoIG9iaiApIHtcbiAgICBmb3IgKHZhciBuYW1lIGluIG9iaiApIHtcbiAgICAgICAgaWYgKGhhc1Byb3Aob2JqLCBuYW1lKSkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gaXNBcnJheUxpa2UgKG8pe1xuICAgIHJldHVybiBvIGluc3RhbmNlb2YgT2JqZWN0ICYmICdsZW5ndGgnIGluIG87XG59XG5cbmZ1bmN0aW9uIHN0cjJhcnIgKHN0ciwgc2VwKSB7XG4gICAgc2VwID0gc2VwIHx8IFwiIFwiO1xuICAgIHJldHVybiBzdHIuc3BsaXQoc2VwKS5tYXAoZnVuY3Rpb24oZWwpe1xuICAgICAgICByZXR1cm4gIChcIlwiK2VsKS50cmltKCk7XG4gICAgfSkuZmlsdGVyKGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgcmV0dXJuIGVsICE9PSBcIlwiO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBwYXJzZVVuaXQoc3RyLCBvdXQpIHtcbiAgICBpZiAoIW91dCkgb3V0ID0gWyAwLCAnJyBdO1xuICAgIHN0ciA9IFN0cmluZyhzdHIpO1xuICAgIG91dFswXSA9IHBhcnNlRmxvYXQoc3RyKTtcbiAgICBvdXRbMV0gPSBzdHIubWF0Y2goL1tcXGQuXFwtK10qXFxzKiguKikvKVsxXSB8fCAnJztcbiAgICByZXR1cm4gb3V0O1xufVxuXG5mdW5jdGlvbiBnZXRVbml0KHZhbCwgdW5kKXtcbiAgICB2YXIgc3BsaXQgPSAvWystXT9cXGQqXFwuP1xcZCsoPzpcXC5cXGQrKT8oPzpbZUVdWystXT9cXGQrKT8oJXxweHxwdHxlbXxyZW18aW58Y218bW18ZXh8Y2h8cGN8dnd8dmh8dm1pbnx2bWF4fGRlZ3xyYWR8dHVybik/JC8uZXhlYyh2YWwpO1xuICAgIHJldHVybiB0eXBlb2Ygc3BsaXRbMV0gIT09IFwidW5kZWZpbmVkXCIgPyBzcGxpdFsxXSA6IHVuZDtcbn1cblxuZnVuY3Rpb24gc2V0U3R5bGVQcm9wKGVsLCBrZXksIHZhbCl7XG4gICAga2V5ID0gY2FtZWxDYXNlKGtleSk7XG5cbiAgICBpZiAoW1wic2Nyb2xsTGVmdFwiLCBcInNjcm9sbFRvcFwiXS5pbmRleE9mKGtleSkgPiAtMSkge1xuICAgICAgICBlbFtrZXldID0gKHBhcnNlSW50KHZhbCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGVsLnN0eWxlW2tleV0gPSBpc05hTih2YWwpIHx8IG51bVByb3BzLmluZGV4T2YoXCJcIitrZXkpID4gLTEgPyB2YWwgOiB2YWwgKyAncHgnO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gYWNjZXB0RGF0YShvd25lcil7XG4gICAgcmV0dXJuIG93bmVyLm5vZGVUeXBlID09PSAxIHx8IG93bmVyLm5vZGVUeXBlID09PSA5IHx8ICEoICtvd25lci5ub2RlVHlwZSApO1xufVxuXG5mdW5jdGlvbiBnZXREYXRhKGRhdGEpe1xuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKGRhdGEpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBkYXRhQXR0cihlbGVtLCBrZXksIGRhdGEpe1xuICAgIHZhciBuYW1lO1xuXG4gICAgaWYgKCBub3QoZGF0YSkgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHtcbiAgICAgICAgbmFtZSA9IFwiZGF0YS1cIiArIGtleS5yZXBsYWNlKCAvW0EtWl0vZywgXCItJCZcIiApLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGRhdGEgPSBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSApO1xuXG4gICAgICAgIGlmICggdHlwZW9mIGRhdGEgPT09IFwic3RyaW5nXCIgKSB7XG4gICAgICAgICAgICBkYXRhID0gZ2V0RGF0YSggZGF0YSApO1xuICAgICAgICAgICAgZGF0YVNldC5zZXQoIGVsZW0sIGtleSwgZGF0YSApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGF0YSA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZGF0YTtcbn1cblxuZnVuY3Rpb24gbm9ybU5hbWUobmFtZSkge1xuICAgIHJldHVybiB0eXBlb2YgbmFtZSAhPT0gXCJzdHJpbmdcIiA/IHVuZGVmaW5lZCA6IG5hbWUucmVwbGFjZSgvLS9nLCBcIlwiKS50b0xvd2VyQ2FzZSgpO1xufVxuXG5mdW5jdGlvbiBzdHJpcChuYW1lLCB3aGF0KSB7XG4gICAgcmV0dXJuIHR5cGVvZiBuYW1lICE9PSBcInN0cmluZ1wiID8gdW5kZWZpbmVkIDogbmFtZS5yZXBsYWNlKHdoYXQsIFwiXCIpO1xufVxuXG5mdW5jdGlvbiBoYXNQcm9wKG9iaiwgcHJvcCl7XG4gICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApO1xufVxuXG5mdW5jdGlvbiBpc0xvY2FsaG9zdChob3N0KXtcbiAgICB2YXIgaG9zdG5hbWUgPSBob3N0IHx8IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZTtcbiAgICByZXR1cm4gKFxuICAgICAgICBob3N0bmFtZSA9PT0gXCJsb2NhbGhvc3RcIiB8fFxuICAgICAgICBob3N0bmFtZSA9PT0gXCIxMjcuMC4wLjFcIiB8fFxuICAgICAgICBob3N0bmFtZSA9PT0gXCJbOjoxXVwiIHx8XG4gICAgICAgIGhvc3RuYW1lID09PSBcIlwiIHx8XG4gICAgICAgIGhvc3RuYW1lLm1hdGNoKC9eMTI3KD86XFwuKD86MjVbMC01XXwyWzAtNF1bMC05XXxbMDFdP1swLTldWzAtOV0/KSl7M30kLykgIT09IG51bGxcbiAgICApO1xufVxuXG5mdW5jdGlvbiBpc1RvdWNoKCkge1xuICAgIHJldHVybiAoKCdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdylcbiAgICAgICAgfHwgKG5hdmlnYXRvci5tYXhUb3VjaFBvaW50cyA+IDApXG4gICAgICAgIHx8IChuYXZpZ2F0b3IubXNNYXhUb3VjaFBvaW50cyA+IDApKTtcbn1cblxuZnVuY3Rpb24gaXNEYXJrKCl7XG4gICAgdmFyIHByZWZlcnNEYXJrU2NoZW1lID0gd2luZG93Lm1hdGNoTWVkaWEoXCIocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspXCIpXG4gICAgcmV0dXJuIHByZWZlcnNEYXJrU2NoZW1lLm1hdGNoZXNcbn1cblxuLy8gU291cmNlOiBzcmMvc2V0aW1tZWRpYXRlLmpzXG5cbi8qIGdsb2JhbCBnbG9iYWwgKi9cbi8qXG4gKiBzZXRJbW1lZGlhdGUgcG9seWZpbGxcbiAqIFZlcnNpb24gMS4wLjVcbiAqIFVybDogaHR0cHM6Ly9naXRodWIuY29tL1l1enVKUy9zZXRJbW1lZGlhdGVcbiAqIENvcHlyaWdodCAoYykgMjAxNiBZdXp1IChodHRwczovL2dpdGh1Yi5jb20vWXV6dUpTKVxuICogTGljZW5zZWQgdW5kZXIgTUlUXG4gKi9cbihmdW5jdGlvbiAoZ2xvYmFsKSB7XG5cbiAgICBpZiAoZ2xvYmFsLnNldEltbWVkaWF0ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIG5leHRIYW5kbGUgPSAxO1xuICAgIHZhciB0YXNrc0J5SGFuZGxlID0ge307XG4gICAgdmFyIGN1cnJlbnRseVJ1bm5pbmdBVGFzayA9IGZhbHNlO1xuICAgIHZhciByZWdpc3RlckltbWVkaWF0ZTtcblxuICAgIGZ1bmN0aW9uIHNldEltbWVkaWF0ZShjYWxsYmFjaykge1xuICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIC8qIGpzaGludCAtVzA1NCAqL1xuICAgICAgICAgICAgY2FsbGJhY2sgPSBuZXcgRnVuY3Rpb24oXCJcIiArIGNhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgYXJnc1tpXSA9IGFyZ3VtZW50c1tpICsgMV07XG4gICAgICAgIH1cbiAgICAgICAgdGFza3NCeUhhbmRsZVtuZXh0SGFuZGxlXSA9IHsgY2FsbGJhY2s6IGNhbGxiYWNrLCBhcmdzOiBhcmdzIH07XG4gICAgICAgIHJlZ2lzdGVySW1tZWRpYXRlKG5leHRIYW5kbGUpO1xuICAgICAgICByZXR1cm4gbmV4dEhhbmRsZSsrO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNsZWFySW1tZWRpYXRlKGhhbmRsZSkge1xuICAgICAgICBkZWxldGUgdGFza3NCeUhhbmRsZVtoYW5kbGVdO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJ1bih0YXNrKSB7XG4gICAgICAgIHZhciBjYWxsYmFjayA9IHRhc2suY2FsbGJhY2s7XG4gICAgICAgIHZhciBhcmdzID0gdGFzay5hcmdzO1xuICAgICAgICBzd2l0Y2ggKGFyZ3MubGVuZ3RoKSB7XG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhhcmdzWzBdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhhcmdzWzBdLCBhcmdzWzFdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkodW5kZWZpbmVkLCBhcmdzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJ1bklmUHJlc2VudChoYW5kbGUpIHtcbiAgICAgICAgaWYgKGN1cnJlbnRseVJ1bm5pbmdBVGFzaykge1xuICAgICAgICAgICAgc2V0VGltZW91dChydW5JZlByZXNlbnQsIDAsIGhhbmRsZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgdGFzayA9IHRhc2tzQnlIYW5kbGVbaGFuZGxlXTtcbiAgICAgICAgICAgIGlmICh0YXNrKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudGx5UnVubmluZ0FUYXNrID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBydW4odGFzayk7XG4gICAgICAgICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbW1lZGlhdGUoaGFuZGxlKTtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudGx5UnVubmluZ0FUYXNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gZ2xvYmFsLnByb2Nlc3NcbiAgICBmdW5jdGlvbiBpbnN0YWxsTmV4dFRpY2tJbXBsZW1lbnRhdGlvbigpIHtcbiAgICAgICAgcmVnaXN0ZXJJbW1lZGlhdGUgPSBmdW5jdGlvbihoYW5kbGUpIHtcbiAgICAgICAgICAgIGdsb2JhbC5wcm9jZXNzLm5leHRUaWNrKGZ1bmN0aW9uICgpIHsgcnVuSWZQcmVzZW50KGhhbmRsZSk7IH0pO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8vIHdlYiB3b3JrZXJzXG4gICAgZnVuY3Rpb24gaW5zdGFsbE1lc3NhZ2VDaGFubmVsSW1wbGVtZW50YXRpb24oKSB7XG4gICAgICAgIHZhciBjaGFubmVsID0gbmV3IE1lc3NhZ2VDaGFubmVsKCk7XG4gICAgICAgIGNoYW5uZWwucG9ydDEub25tZXNzYWdlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciBoYW5kbGUgPSBldmVudC5kYXRhO1xuICAgICAgICAgICAgcnVuSWZQcmVzZW50KGhhbmRsZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmVnaXN0ZXJJbW1lZGlhdGUgPSBmdW5jdGlvbihoYW5kbGUpIHtcbiAgICAgICAgICAgIGNoYW5uZWwucG9ydDIucG9zdE1lc3NhZ2UoaGFuZGxlKTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBCcm93c2Vyc1xuICAgIGZ1bmN0aW9uIGluc3RhbGxQb3N0TWVzc2FnZUltcGxlbWVudGF0aW9uKCkge1xuICAgICAgICB2YXIgbWVzc2FnZVByZWZpeCA9IFwic2V0SW1tZWRpYXRlJFwiICsgTWF0aC5yYW5kb20oKSArIFwiJFwiO1xuICAgICAgICB2YXIgb25HbG9iYWxNZXNzYWdlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChldmVudC5zb3VyY2UgPT09IGdsb2JhbCAmJlxuICAgICAgICAgICAgICAgIHR5cGVvZiBldmVudC5kYXRhID09PSBcInN0cmluZ1wiICYmXG4gICAgICAgICAgICAgICAgZXZlbnQuZGF0YS5pbmRleE9mKG1lc3NhZ2VQcmVmaXgpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcnVuSWZQcmVzZW50KCtldmVudC5kYXRhLnNsaWNlKG1lc3NhZ2VQcmVmaXgubGVuZ3RoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIG9uR2xvYmFsTWVzc2FnZSwgZmFsc2UpO1xuXG4gICAgICAgIHJlZ2lzdGVySW1tZWRpYXRlID0gZnVuY3Rpb24oaGFuZGxlKSB7XG4gICAgICAgICAgICBnbG9iYWwucG9zdE1lc3NhZ2UobWVzc2FnZVByZWZpeCArIGhhbmRsZSwgXCIqXCIpO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIHZhciBhdHRhY2hUbyA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiAmJiBPYmplY3QuZ2V0UHJvdG90eXBlT2YoZ2xvYmFsKTtcbiAgICBhdHRhY2hUbyA9IGF0dGFjaFRvICYmIGF0dGFjaFRvLnNldFRpbWVvdXQgPyBhdHRhY2hUbyA6IGdsb2JhbDtcblxuICAgIGlmICh7fS50b1N0cmluZy5jYWxsKGdsb2JhbC5wcm9jZXNzKSA9PT0gXCJbb2JqZWN0IHByb2Nlc3NdXCIpIHtcblxuICAgICAgICBpbnN0YWxsTmV4dFRpY2tJbXBsZW1lbnRhdGlvbigpO1xuXG4gICAgfSBlbHNlIGlmIChnbG9iYWwuTWVzc2FnZUNoYW5uZWwpIHtcblxuICAgICAgICBpbnN0YWxsTWVzc2FnZUNoYW5uZWxJbXBsZW1lbnRhdGlvbigpO1xuXG4gICAgfSBlbHNlIHtcblxuICAgICAgICBpbnN0YWxsUG9zdE1lc3NhZ2VJbXBsZW1lbnRhdGlvbigpO1xuXG4gICAgfVxuXG4gICAgYXR0YWNoVG8uc2V0SW1tZWRpYXRlID0gc2V0SW1tZWRpYXRlO1xuICAgIGF0dGFjaFRvLmNsZWFySW1tZWRpYXRlID0gY2xlYXJJbW1lZGlhdGU7XG5cbn0odHlwZW9mIHNlbGYgPT09IFwidW5kZWZpbmVkXCIgPyB0eXBlb2YgZ2xvYmFsID09PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDogZ2xvYmFsIDogc2VsZikpO1xuXG4vLyBTb3VyY2U6IHNyYy9jb3JlLmpzXG5cbi8qIGdsb2JhbCBoYXNQcm9wICovXG5cbnZhciBtNHFWZXJzaW9uID0gXCJ2MS4xLjAuIEJ1aWx0IGF0IDA1LzA1LzIwMjEgMjI6NDc6NTZcIjtcblxuLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lICovXG52YXIgbWF0Y2hlcyA9IEVsZW1lbnQucHJvdG90eXBlLm1hdGNoZXNcbiAgICB8fCBFbGVtZW50LnByb3RvdHlwZS5tYXRjaGVzU2VsZWN0b3JcbiAgICB8fCBFbGVtZW50LnByb3RvdHlwZS53ZWJraXRNYXRjaGVzU2VsZWN0b3JcbiAgICB8fCBFbGVtZW50LnByb3RvdHlwZS5tb3pNYXRjaGVzU2VsZWN0b3JcbiAgICB8fCBFbGVtZW50LnByb3RvdHlwZS5tc01hdGNoZXNTZWxlY3RvclxuICAgIHx8IEVsZW1lbnQucHJvdG90eXBlLm9NYXRjaGVzU2VsZWN0b3I7XG5cbnZhciAkID0gZnVuY3Rpb24oc2VsZWN0b3IsIGNvbnRleHQpe1xuICAgIHJldHVybiBuZXcgJC5pbml0KHNlbGVjdG9yLCBjb250ZXh0KTtcbn07XG5cbiQudmVyc2lvbiA9IG00cVZlcnNpb247XG5cbiQuZm4gPSAkLnByb3RvdHlwZSA9IHtcbiAgICB2ZXJzaW9uOiBtNHFWZXJzaW9uLFxuICAgIGNvbnN0cnVjdG9yOiAkLFxuICAgIGxlbmd0aDogMCxcbiAgICB1aWQ6IFwiXCIsXG5cbiAgICBwdXNoOiBbXS5wdXNoLFxuICAgIHNvcnQ6IFtdLnNvcnQsXG4gICAgc3BsaWNlOiBbXS5zcGxpY2UsXG4gICAgaW5kZXhPZjogW10uaW5kZXhPZixcbiAgICByZXZlcnNlOiBbXS5yZXZlcnNlXG59O1xuXG4kLmV4dGVuZCA9ICQuZm4uZXh0ZW5kID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgb3B0aW9ucywgbmFtZSxcbiAgICAgICAgdGFyZ2V0ID0gYXJndW1lbnRzWyAwIF0gfHwge30sXG4gICAgICAgIGkgPSAxLFxuICAgICAgICBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoO1xuXG4gICAgaWYgKCB0eXBlb2YgdGFyZ2V0ICE9PSBcIm9iamVjdFwiICYmIHR5cGVvZiB0YXJnZXQgIT09IFwiZnVuY3Rpb25cIiApIHtcbiAgICAgICAgdGFyZ2V0ID0ge307XG4gICAgfVxuXG4gICAgaWYgKCBpID09PSBsZW5ndGggKSB7XG4gICAgICAgIHRhcmdldCA9IHRoaXM7XG4gICAgICAgIGktLTtcbiAgICB9XG5cbiAgICBmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHtcbiAgICAgICAgaWYgKCAoIG9wdGlvbnMgPSBhcmd1bWVudHNbIGkgXSApICE9IG51bGwgKSB7XG4gICAgICAgICAgICBmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7XG4gICAgICAgICAgICAgICAgaWYgKGhhc1Byb3Aob3B0aW9ucywgbmFtZSkpXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldFsgbmFtZSBdID0gb3B0aW9uc1sgbmFtZSBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRhcmdldDtcbn07XG5cbiQuYXNzaWduID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgb3B0aW9ucywgbmFtZSxcbiAgICAgICAgdGFyZ2V0ID0gYXJndW1lbnRzWyAwIF0gfHwge30sXG4gICAgICAgIGkgPSAxLFxuICAgICAgICBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoO1xuXG4gICAgaWYgKCB0eXBlb2YgdGFyZ2V0ICE9PSBcIm9iamVjdFwiICYmIHR5cGVvZiB0YXJnZXQgIT09IFwiZnVuY3Rpb25cIiApIHtcbiAgICAgICAgdGFyZ2V0ID0ge307XG4gICAgfVxuXG4gICAgaWYgKCBpID09PSBsZW5ndGggKSB7XG4gICAgICAgIHRhcmdldCA9IHRoaXM7XG4gICAgICAgIGktLTtcbiAgICB9XG5cbiAgICBmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHtcbiAgICAgICAgaWYgKCAoIG9wdGlvbnMgPSBhcmd1bWVudHNbIGkgXSApICE9IG51bGwgKSB7XG4gICAgICAgICAgICBmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7XG4gICAgICAgICAgICAgICAgaWYgKGhhc1Byb3Aob3B0aW9ucywgbmFtZSkgJiYgb3B0aW9uc1tuYW1lXSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRbIG5hbWUgXSA9IG9wdGlvbnNbIG5hbWUgXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0YXJnZXQ7XG59O1xuXG4vLyBpZiAodHlwZW9mIHdpbmRvd1tcImhpZGVNNFFWZXJzaW9uXCJdID09PSBcInVuZGVmaW5lZFwiKSBjb25zb2xlLmluZm8oXCJtNHEgXCIgKyAkLnZlcnNpb24pO1xuXG4vLyBTb3VyY2U6IHNyYy9pbnRlcnZhbC5qc1xuXG4vKiBnbG9iYWwgJCAqL1xuXG52YXIgbm93ID0gZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gRGF0ZS5ub3coKTtcbn07XG5cbiQuZXh0ZW5kKHtcblxuICAgIGludGVydmFsSWQ6IC0xLFxuICAgIGludGVydmFsUXVldWU6IFtdLFxuICAgIGludGVydmFsVGlja2luZzogZmFsc2UsXG4gICAgaW50ZXJ2YWxUaWNrSWQ6IG51bGwsXG5cbiAgICBzZXRJbnRlcnZhbDogZnVuY3Rpb24oZm4sIGludCl7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICB0aGlzLmludGVydmFsSWQrKztcblxuICAgICAgICB0aGlzLmludGVydmFsUXVldWUucHVzaCh7XG4gICAgICAgICAgICBpZDogdGhpcy5pbnRlcnZhbElkLFxuICAgICAgICAgICAgZm46IGZuLFxuICAgICAgICAgICAgaW50ZXJ2YWw6IGludCxcbiAgICAgICAgICAgIGxhc3RUaW1lOiBub3coKVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIXRoaXMuaW50ZXJ2YWxUaWNraW5nKSB7XG4gICAgICAgICAgICB2YXIgdGljayA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5pbnRlcnZhbFRpY2tJZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aWNrKTtcbiAgICAgICAgICAgICAgICAkLmVhY2godGhhdC5pbnRlcnZhbFF1ZXVlLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmludGVydmFsIDwgMTcgfHwgbm93KCkgLSBpdGVtLmxhc3RUaW1lID49IGl0ZW0uaW50ZXJ2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZm4oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ubGFzdFRpbWUgPSBub3coKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuaW50ZXJ2YWxUaWNraW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHRpY2soKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmludGVydmFsSWQ7XG4gICAgfSxcblxuICAgIGNsZWFySW50ZXJ2YWw6IGZ1bmN0aW9uKGlkKXtcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHRoaXMuaW50ZXJ2YWxRdWV1ZS5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICBpZiAoaWQgPT09IHRoaXMuaW50ZXJ2YWxRdWV1ZVtpXS5pZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaW50ZXJ2YWxRdWV1ZS5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaW50ZXJ2YWxRdWV1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuaW50ZXJ2YWxUaWNrSWQpO1xuICAgICAgICAgICAgdGhpcy5pbnRlcnZhbFRpY2tpbmcgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXRUaW1lb3V0OiBmdW5jdGlvbihmbiwgaW50ZXJ2YWwpe1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGlkID0gdGhpcy5zZXRJbnRlcnZhbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhhdC5jbGVhckludGVydmFsKGlkKTtcbiAgICAgICAgICAgIGZuKCk7XG4gICAgICAgIH0sIGludGVydmFsKTtcblxuICAgICAgICByZXR1cm4gaWQ7XG4gICAgfSxcblxuICAgIGNsZWFyVGltZW91dDogZnVuY3Rpb24oaWQpe1xuICAgICAgICByZXR1cm4gdGhpcy5jbGVhckludGVydmFsKGlkKTtcbiAgICB9XG59KTtcblxuLy8gU291cmNlOiBzcmMvY29udGFpbnMuanNcblxuLyogZ2xvYmFsICQsIG5vdCwgbWF0Y2hlcywgaXNBcnJheUxpa2UsIGlzVmlzaWJsZSAqL1xuXG4kLmZuLmV4dGVuZCh7XG4gICAgaW5kZXg6IGZ1bmN0aW9uKHNlbCl7XG4gICAgICAgIHZhciBlbCwgX2luZGV4ID0gLTE7XG5cbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gX2luZGV4O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5vdChzZWwpKSB7XG4gICAgICAgICAgICBlbCA9IHRoaXNbMF07XG4gICAgICAgIH0gZWxzZSBpZiAoc2VsIGluc3RhbmNlb2YgJCAmJiBzZWwubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZWwgPSBzZWxbMF07XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHNlbCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgZWwgPSAkKHNlbClbMF07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChub3QoZWwpKSB7XG4gICAgICAgICAgICByZXR1cm4gX2luZGV4O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVsICYmIGVsLnBhcmVudE5vZGUpICQuZWFjaChlbC5wYXJlbnROb2RlLmNoaWxkcmVuLCBmdW5jdGlvbihpKXtcbiAgICAgICAgICAgIGlmICh0aGlzID09PSBlbCkge1xuICAgICAgICAgICAgICAgIF9pbmRleCA9IGk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gX2luZGV4O1xuICAgIH0sXG5cbiAgICBnZXQ6IGZ1bmN0aW9uKGkpe1xuICAgICAgICBpZiAoaSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pdGVtcygpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpIDwgMCA/IHRoaXNbIGkgKyB0aGlzLmxlbmd0aCBdIDogdGhpc1sgaSBdO1xuICAgIH0sXG5cbiAgICBlcTogZnVuY3Rpb24oaSl7XG4gICAgICAgIHJldHVybiAhbm90KGkpICYmIHRoaXMubGVuZ3RoID4gMCA/ICQuZXh0ZW5kKCQodGhpcy5nZXQoaSkpLCB7X3ByZXZPYmo6IHRoaXN9KSA6IHRoaXM7XG4gICAgfSxcblxuICAgIGlzOiBmdW5jdGlvbihzKXtcbiAgICAgICAgdmFyIHJlc3VsdCA9IGZhbHNlO1xuXG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHMgaW5zdGFuY2VvZiAkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zYW1lKHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHMgPT09IFwiOnNlbGVjdGVkXCIpIHtcbiAgICAgICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkKSByZXN1bHQgPSB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZVxuXG4gICAgICAgIGlmIChzID09PSBcIjpjaGVja2VkXCIpIHtcbiAgICAgICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrZWQpIHJlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlXG5cbiAgICAgICAgaWYgKHMgPT09IFwiOnZpc2libGVcIikge1xuICAgICAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKGlzVmlzaWJsZSh0aGlzKSkgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2VcblxuICAgICAgICBpZiAocyA9PT0gXCI6aGlkZGVuXCIpIHtcbiAgICAgICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBzdHlsZXMgPSBnZXRDb21wdXRlZFN0eWxlKHRoaXMpO1xuICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRBdHRyaWJ1dGUoJ3R5cGUnKSA9PT0gJ2hpZGRlbidcbiAgICAgICAgICAgICAgICAgICAgICAgIHx8IHRoaXMuaGlkZGVuXG4gICAgICAgICAgICAgICAgICAgICAgICB8fCBzdHlsZXMuZGlzcGxheSA9PT0gJ25vbmUnXG4gICAgICAgICAgICAgICAgICAgICAgICB8fCBzdHlsZXMudmlzaWJpbGl0eSA9PT0gJ2hpZGRlbidcbiAgICAgICAgICAgICAgICAgICAgICAgIHx8IHBhcnNlSW50KHN0eWxlcy5vcGFjaXR5KSA9PT0gMFxuICAgICAgICAgICAgICAgICkgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2VcblxuICAgICAgICBpZiAodHlwZW9mICBzID09PSBcInN0cmluZ1wiICYmIFsnOnNlbGVjdGVkJ10uaW5kZXhPZihzKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmIChtYXRjaGVzLmNhbGwodGhpcywgcykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlXG5cbiAgICAgICAgaWYgKGlzQXJyYXlMaWtlKHMpKSB7XG4gICAgICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgZWwgPSB0aGlzO1xuICAgICAgICAgICAgICAgICQuZWFjaChzLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2VsID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVsID09PSBzZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2VcblxuICAgICAgICBpZiAodHlwZW9mIHMgPT09IFwib2JqZWN0XCIgJiYgcy5ub2RlVHlwZSA9PT0gMSkge1xuICAgICAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgICh0aGlzID09PSBzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG5cbiAgICBzYW1lOiBmdW5jdGlvbihvKXtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHRydWU7XG5cbiAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mICQpKSB7XG4gICAgICAgICAgICBvID0gJChvKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCAhPT0gby5sZW5ndGgpIHJldHVybiBmYWxzZTtcblxuICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmIChvLml0ZW1zKCkuaW5kZXhPZih0aGlzKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LFxuXG4gICAgbGFzdDogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXEodGhpcy5sZW5ndGggLSAxKTtcbiAgICB9LFxuXG4gICAgZmlyc3Q6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmVxKDApO1xuICAgIH0sXG5cbiAgICBvZGQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciByZXN1bHQgPSB0aGlzLmZpbHRlcihmdW5jdGlvbihlbCwgaSl7XG4gICAgICAgICAgICByZXR1cm4gaSAlIDIgPT09IDA7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gJC5leHRlbmQocmVzdWx0LCB7X3ByZXZPYmo6IHRoaXN9KTtcbiAgICB9LFxuXG4gICAgZXZlbjogZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXMuZmlsdGVyKGZ1bmN0aW9uKGVsLCBpKXtcbiAgICAgICAgICAgIHJldHVybiBpICUgMiAhPT0gMDtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiAkLmV4dGVuZChyZXN1bHQsIHtfcHJldk9iajogdGhpc30pO1xuICAgIH0sXG5cbiAgICBmaWx0ZXI6IGZ1bmN0aW9uKGZuKXtcbiAgICAgICAgaWYgKHR5cGVvZiBmbiA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgdmFyIHNlbCA9IGZuO1xuICAgICAgICAgICAgZm4gPSBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXMuY2FsbChlbCwgc2VsKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gJC5leHRlbmQoJC5tZXJnZSgkKCksIFtdLmZpbHRlci5jYWxsKHRoaXMsIGZuKSksIHtfcHJldk9iajogdGhpc30pO1xuICAgIH0sXG5cbiAgICBmaW5kOiBmdW5jdGlvbihzKXtcbiAgICAgICAgdmFyIHJlcyA9IFtdLCByZXN1bHQ7XG5cbiAgICAgICAgaWYgKHMgaW5zdGFuY2VvZiAkKSByZXR1cm4gcztcblxuICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBlbCA9IHRoaXM7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlbC5xdWVyeVNlbGVjdG9yQWxsID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlcyA9IHJlcy5jb25jYXQoW10uc2xpY2UuY2FsbChlbC5xdWVyeVNlbGVjdG9yQWxsKHMpKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJlc3VsdCA9ICQubWVyZ2UoJCgpLCByZXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICQuZXh0ZW5kKHJlc3VsdCwge19wcmV2T2JqOiB0aGlzfSk7XG4gICAgfSxcblxuICAgIGNvbnRhaW5zOiBmdW5jdGlvbihzKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmluZChzKS5sZW5ndGggPiAwO1xuICAgIH0sXG5cbiAgICBjaGlsZHJlbjogZnVuY3Rpb24ocyl7XG4gICAgICAgIHZhciBpLCByZXMgPSBbXTtcblxuICAgICAgICBpZiAocyBpbnN0YW5jZW9mICQpIHJldHVybiBzO1xuXG4gICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsID0gdGhpcztcbiAgICAgICAgICAgIGZvcihpID0gMDsgaSA8IGVsLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVsLmNoaWxkcmVuW2ldLm5vZGVUeXBlID09PSAxKVxuICAgICAgICAgICAgICAgICAgICByZXMucHVzaChlbC5jaGlsZHJlbltpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXMgPSBzID8gcmVzLmZpbHRlcihmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICByZXR1cm4gbWF0Y2hlcy5jYWxsKGVsLCBzKTtcbiAgICAgICAgfSkgOiByZXM7XG5cbiAgICAgICAgcmV0dXJuICQuZXh0ZW5kKCQubWVyZ2UoJCgpLCByZXMpLCB7X3ByZXZPYmo6IHRoaXN9KTtcbiAgICB9LFxuXG4gICAgcGFyZW50OiBmdW5jdGlvbihzKXtcbiAgICAgICAgdmFyIHJlcyA9IFtdO1xuICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocyBpbnN0YW5jZW9mICQpIHJldHVybiBzO1xuXG4gICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXMuaW5kZXhPZih0aGlzLnBhcmVudE5vZGUpID09PSAtMSkgcmVzLnB1c2godGhpcy5wYXJlbnROb2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJlcyA9IHMgPyByZXMuZmlsdGVyKGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIHJldHVybiBtYXRjaGVzLmNhbGwoZWwsIHMpO1xuICAgICAgICB9KSA6IHJlcztcblxuICAgICAgICByZXR1cm4gJC5leHRlbmQoJC5tZXJnZSgkKCksIHJlcyksIHtfcHJldk9iajogdGhpc30pO1xuICAgIH0sXG5cbiAgICBwYXJlbnRzOiBmdW5jdGlvbihzKXtcbiAgICAgICAgdmFyIHJlcyA9IFtdO1xuXG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzIGluc3RhbmNlb2YgJCkgcmV0dXJuIHM7XG5cbiAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgcGFyID0gdGhpcy5wYXJlbnROb2RlO1xuICAgICAgICAgICAgd2hpbGUgKHBhcikge1xuICAgICAgICAgICAgICAgIGlmIChwYXIubm9kZVR5cGUgPT09IDEgJiYgcmVzLmluZGV4T2YocGFyKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFub3QocykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaGVzLmNhbGwocGFyLCBzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5wdXNoKHBhcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXMucHVzaChwYXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHBhciA9IHBhci5wYXJlbnROb2RlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gJC5leHRlbmQoJC5tZXJnZSgkKCksIHJlcyksIHtfcHJldk9iajogdGhpc30pO1xuICAgIH0sXG5cbiAgICBzaWJsaW5nczogZnVuY3Rpb24ocyl7XG4gICAgICAgIHZhciByZXMgPSBbXTtcblxuICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocyBpbnN0YW5jZW9mICQpIHJldHVybiBzO1xuXG4gICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsID0gdGhpcztcbiAgICAgICAgICAgIGlmIChlbC5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKGVsLnBhcmVudE5vZGUuY2hpbGRyZW4sIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlbCAhPT0gdGhpcykgcmVzLnB1c2godGhpcyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChzKSB7XG4gICAgICAgICAgICByZXMgPSByZXMuZmlsdGVyKGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlcy5jYWxsKGVsLCBzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICQuZXh0ZW5kKCQubWVyZ2UoJCgpLCByZXMpLCB7X3ByZXZPYmo6IHRoaXN9KTtcbiAgICB9LFxuXG4gICAgX3NpYmxpbmdBbGw6IGZ1bmN0aW9uKGRpciwgcyl7XG4gICAgICAgIHZhciByZXMgPSBbXTtcblxuICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocyBpbnN0YW5jZW9mICQpIHJldHVybiBzO1xuXG4gICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsID0gdGhpcztcbiAgICAgICAgICAgIHdoaWxlIChlbCkge1xuICAgICAgICAgICAgICAgIGVsID0gZWxbZGlyXTtcbiAgICAgICAgICAgICAgICBpZiAoIWVsKSBicmVhaztcbiAgICAgICAgICAgICAgICByZXMucHVzaChlbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChzKSB7XG4gICAgICAgICAgICByZXMgPSByZXMuZmlsdGVyKGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlcy5jYWxsKGVsLCBzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICQuZXh0ZW5kKCQubWVyZ2UoJCgpLCByZXMpLCB7X3ByZXZPYmo6IHRoaXN9KTtcbiAgICB9LFxuXG4gICAgX3NpYmxpbmc6IGZ1bmN0aW9uKGRpciwgcyl7XG4gICAgICAgIHZhciByZXMgPSBbXTtcblxuICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocyBpbnN0YW5jZW9mICQpIHJldHVybiBzO1xuXG4gICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsID0gdGhpc1tkaXJdO1xuICAgICAgICAgICAgaWYgKGVsICYmIGVsLm5vZGVUeXBlID09PSAxKSB7XG4gICAgICAgICAgICAgICAgcmVzLnB1c2goZWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAocykge1xuICAgICAgICAgICAgcmVzID0gcmVzLmZpbHRlcihmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXMuY2FsbChlbCwgcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAkLmV4dGVuZCgkLm1lcmdlKCQoKSwgcmVzKSwge19wcmV2T2JqOiB0aGlzfSk7XG4gICAgfSxcblxuICAgIHByZXY6IGZ1bmN0aW9uKHMpe1xuICAgICAgICByZXR1cm4gdGhpcy5fc2libGluZygncHJldmlvdXNFbGVtZW50U2libGluZycsIHMpO1xuICAgIH0sXG5cbiAgICBuZXh0OiBmdW5jdGlvbihzKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NpYmxpbmcoJ25leHRFbGVtZW50U2libGluZycsIHMpO1xuICAgIH0sXG5cbiAgICBwcmV2QWxsOiBmdW5jdGlvbihzKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NpYmxpbmdBbGwoJ3ByZXZpb3VzRWxlbWVudFNpYmxpbmcnLCBzKTtcbiAgICB9LFxuXG4gICAgbmV4dEFsbDogZnVuY3Rpb24ocyl7XG4gICAgICAgIHJldHVybiB0aGlzLl9zaWJsaW5nQWxsKCduZXh0RWxlbWVudFNpYmxpbmcnLCBzKTtcbiAgICB9LFxuXG4gICAgY2xvc2VzdDogZnVuY3Rpb24ocyl7XG4gICAgICAgIHZhciByZXMgPSBbXTtcblxuICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocyBpbnN0YW5jZW9mICQpIHJldHVybiBzO1xuXG4gICAgICAgIGlmICghcykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50KHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWwgPSB0aGlzO1xuICAgICAgICAgICAgd2hpbGUgKGVsKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFlbCkgYnJlYWs7XG4gICAgICAgICAgICAgICAgaWYgKG1hdGNoZXMuY2FsbChlbCwgcykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzLnB1c2goZWwpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbCA9IGVsLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiAkLmV4dGVuZCgkLm1lcmdlKCQoKSwgcmVzLnJldmVyc2UoKSksIHtfcHJldk9iajogdGhpc30pO1xuICAgIH0sXG5cbiAgICBoYXM6IGZ1bmN0aW9uKHNlbGVjdG9yKXtcbiAgICAgICAgdmFyIHJlcyA9IFtdO1xuXG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsID0gJCh0aGlzKTtcbiAgICAgICAgICAgIHZhciBjaGlsZCA9IGVsLmNoaWxkcmVuKHNlbGVjdG9yKTtcbiAgICAgICAgICAgIGlmIChjaGlsZC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcmVzLnB1c2godGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiAkLmV4dGVuZCgkLm1lcmdlKCQoKSwgcmVzKSwge19wcmV2T2JqOiB0aGlzfSk7XG4gICAgfSxcblxuICAgIGJhY2s6IGZ1bmN0aW9uKHRvX3N0YXJ0KXtcbiAgICAgICAgdmFyIHJldDtcbiAgICAgICAgaWYgKHRvX3N0YXJ0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZXQgPSB0aGlzLl9wcmV2T2JqO1xuICAgICAgICAgICAgd2hpbGUgKHJldCkge1xuICAgICAgICAgICAgICAgIGlmICghcmV0Ll9wcmV2T2JqKSBicmVhaztcbiAgICAgICAgICAgICAgICByZXQgPSByZXQuX3ByZXZPYmo7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXQgPSB0aGlzLl9wcmV2T2JqID8gdGhpcy5fcHJldk9iaiA6IHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9XG59KTtcblxuLy8gU291cmNlOiBzcmMvc2NyaXB0LmpzXG5cbi8qIGdsb2JhbCAkLCBub3QgKi9cblxuZnVuY3Rpb24gY3JlYXRlU2NyaXB0KHNjcmlwdCl7XG4gICAgdmFyIHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICBzLnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JztcblxuICAgIGlmIChub3Qoc2NyaXB0KSkgcmV0dXJuICQocyk7XG5cbiAgICB2YXIgX3NjcmlwdCA9ICQoc2NyaXB0KVswXTtcblxuICAgIGlmIChfc2NyaXB0LnNyYykge1xuICAgICAgICBzLnNyYyA9IF9zY3JpcHQuc3JjO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHMudGV4dENvbnRlbnQgPSBfc2NyaXB0LmlubmVyVGV4dDtcbiAgICB9XG5cbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHMpO1xuXG4gICAgaWYgKF9zY3JpcHQucGFyZW50Tm9kZSkgX3NjcmlwdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKF9zY3JpcHQpO1xuXG4gICAgcmV0dXJuIHM7XG59XG5cbiQuZXh0ZW5kKHtcbiAgICBzY3JpcHQ6IGZ1bmN0aW9uKGVsKXtcblxuICAgICAgICBpZiAobm90KGVsKSkge1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVNjcmlwdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIF9lbCA9ICQoZWwpWzBdO1xuXG4gICAgICAgIGlmIChfZWwudGFnTmFtZSAmJiBfZWwudGFnTmFtZSA9PT0gXCJTQ1JJUFRcIikge1xuICAgICAgICAgICAgY3JlYXRlU2NyaXB0KF9lbCk7XG4gICAgICAgIH0gZWxzZSAkLmVhY2goJChfZWwpLmZpbmQoXCJzY3JpcHRcIiksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBjcmVhdGVTY3JpcHQodGhpcyk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pO1xuXG4kLmZuLmV4dGVuZCh7XG4gICAgc2NyaXB0OiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkLnNjcmlwdCh0aGlzKTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG5cbi8vIFNvdXJjZTogc3JjL3Byb3AuanNcblxuLyogZ2xvYmFsICQsIG5vdCAqL1xuXG4kLmZuLmV4dGVuZCh7XG4gICAgX3Byb3A6IGZ1bmN0aW9uKHByb3AsIHZhbHVlKXtcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxlbmd0aCA9PT0gMCA/IHVuZGVmaW5lZCA6IHRoaXNbMF1bcHJvcF07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobm90KHZhbHVlKSkge1xuICAgICAgICAgICAgdmFsdWUgPSAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbCA9IHRoaXM7XG5cbiAgICAgICAgICAgIGVsW3Byb3BdID0gdmFsdWU7XG5cbiAgICAgICAgICAgIGlmIChwcm9wID09PSBcImlubmVySFRNTFwiKSB7XG4gICAgICAgICAgICAgICAgJC5zY3JpcHQoZWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgcHJvcDogZnVuY3Rpb24ocHJvcCwgdmFsdWUpe1xuICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA9PT0gMSA/IHRoaXMuX3Byb3AocHJvcCkgOiB0aGlzLl9wcm9wKHByb3AsIHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIiA/IFwiXCIgOiB2YWx1ZSk7XG4gICAgfSxcblxuICAgIHZhbDogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICBpZiAobm90KHZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGVuZ3RoID09PSAwID8gdW5kZWZpbmVkIDogdGhpc1swXS52YWx1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbCA9ICQodGhpcyk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMudmFsdWUgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGVsLmh0bWwodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgaHRtbDogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIHYgPSBbXTtcblxuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3AoJ2lubmVySFRNTCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgJCkge1xuICAgICAgICAgICAgdmFsdWUuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHYucHVzaCgkKHRoaXMpLm91dGVySFRNTCgpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdi5wdXNoKHZhbHVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoYXQuX3Byb3AoJ2lubmVySFRNTCcsIHYubGVuZ3RoID09PSAxICYmIG5vdCh2WzBdKSA/IFwiXCIgOiB2LmpvaW4oXCJcXG5cIikpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBvdXRlckhUTUw6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLl9wcm9wKCdvdXRlckhUTUwnKTtcbiAgICB9LFxuXG4gICAgdGV4dDogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA9PT0gMCA/IHRoaXMuX3Byb3AoJ3RleHRDb250ZW50JykgOiB0aGlzLl9wcm9wKCd0ZXh0Q29udGVudCcsIHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIiA/IFwiXCIgOiB2YWx1ZSk7XG4gICAgfSxcblxuICAgIGlubmVyVGV4dDogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA9PT0gMCA/IHRoaXMuX3Byb3AoJ2lubmVyVGV4dCcpIDogdGhpcy5fcHJvcCgnaW5uZXJUZXh0JywgdHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiID8gXCJcIiA6IHZhbHVlKTtcbiAgICB9LFxuXG4gICAgZW1wdHk6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5pbm5lckhUTUwgIT09IFwidW5kZWZpbmVkXCIpIHRoaXMuaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGNsZWFyOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5lbXB0eSgpO1xuICAgIH1cbn0pO1xuXG4vLyBTb3VyY2U6IHNyYy9lYWNoLmpzXG5cbi8qIGdsb2JhbCAkLCBpc0FycmF5TGlrZSwgaGFzUHJvcCAqL1xuXG4kLmVhY2ggPSBmdW5jdGlvbihjdHgsIGNiKXtcbiAgICB2YXIgaW5kZXggPSAwO1xuICAgIGlmIChpc0FycmF5TGlrZShjdHgpKSB7XG4gICAgICAgIFtdLmZvckVhY2guY2FsbChjdHgsIGZ1bmN0aW9uKHZhbCwga2V5KSB7XG4gICAgICAgICAgICBjYi5hcHBseSh2YWwsIFtrZXksIHZhbF0pO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBmb3IodmFyIGtleSBpbiBjdHgpIHtcbiAgICAgICAgICAgIGlmIChoYXNQcm9wKGN0eCwga2V5KSlcbiAgICAgICAgICAgICAgICBjYi5hcHBseShjdHhba2V5XSwgW2tleSwgY3R4W2tleV0sICBpbmRleCsrXSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY3R4O1xufTtcblxuJC5mbi5leHRlbmQoe1xuICAgIGVhY2g6IGZ1bmN0aW9uKGNiKXtcbiAgICAgICAgcmV0dXJuICQuZWFjaCh0aGlzLCBjYik7XG4gICAgfVxufSk7XG5cblxuLy8gU291cmNlOiBzcmMvZGF0YS5qc1xuXG4vKiBnbG9iYWwgYWNjZXB0RGF0YSwgY2FtZWxDYXNlLCAkLCBub3QsIGRhdGFBdHRyLCBpc0VtcHR5T2JqZWN0LCBoYXNQcm9wICovXG5cbi8qXG4gKiBEYXRhIHJvdXRpbmVzXG4gKiBVcmw6IGh0dHBzOi8vanF1ZXJ5LmNvbVxuICogQ29weXJpZ2h0IChjKSBDb3B5cmlnaHQgSlMgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzLCBodHRwczovL2pzLmZvdW5kYXRpb24vXG4gKiBMaWNlbnNlZCB1bmRlciBNSVRcbiAqL1xudmFyIERhdGEgPSBmdW5jdGlvbihucyl7XG4gICAgdGhpcy5leHBhbmRvID0gXCJEQVRBU0VUOlVJRDpcIiArIG5zLnRvVXBwZXJDYXNlKCk7XG4gICAgRGF0YS51aWQrKztcbn07XG5cbkRhdGEudWlkID0gLTE7XG5cbkRhdGEucHJvdG90eXBlID0ge1xuICAgIGNhY2hlOiBmdW5jdGlvbihvd25lcil7XG4gICAgICAgIHZhciB2YWx1ZSA9IG93bmVyW3RoaXMuZXhwYW5kb107XG4gICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgIHZhbHVlID0ge307XG4gICAgICAgICAgICBpZiAoYWNjZXB0RGF0YShvd25lcikpIHtcbiAgICAgICAgICAgICAgICBpZiAob3duZXIubm9kZVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgb3duZXJbdGhpcy5leHBhbmRvXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvd25lciwgdGhpcy5leHBhbmRvLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9LFxuXG4gICAgc2V0OiBmdW5jdGlvbihvd25lciwgZGF0YSwgdmFsdWUpe1xuICAgICAgICB2YXIgcHJvcCwgY2FjaGUgPSB0aGlzLmNhY2hlKG93bmVyKTtcblxuICAgICAgICBpZiAodHlwZW9mIGRhdGEgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIGNhY2hlW2NhbWVsQ2FzZShkYXRhKV0gPSB2YWx1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvciAocHJvcCBpbiBkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGhhc1Byb3AoZGF0YSwgcHJvcCkpXG4gICAgICAgICAgICAgICAgICAgIGNhY2hlW2NhbWVsQ2FzZShwcm9wKV0gPSBkYXRhW3Byb3BdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjYWNoZTtcbiAgICB9LFxuXG4gICAgZ2V0OiBmdW5jdGlvbihvd25lciwga2V5KXtcbiAgICAgICAgcmV0dXJuIGtleSA9PT0gdW5kZWZpbmVkID8gdGhpcy5jYWNoZShvd25lcikgOiBvd25lclsgdGhpcy5leHBhbmRvIF0gJiYgb3duZXJbIHRoaXMuZXhwYW5kbyBdWyBjYW1lbENhc2UoIGtleSApIF07XG4gICAgfSxcblxuICAgIGFjY2VzczogZnVuY3Rpb24ob3duZXIsIGtleSwgdmFsdWUpe1xuICAgICAgICBpZiAoa2V5ID09PSB1bmRlZmluZWQgfHwgKChrZXkgJiYgdHlwZW9mIGtleSA9PT0gXCJzdHJpbmdcIikgJiYgdmFsdWUgPT09IHVuZGVmaW5lZCkgKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXQob3duZXIsIGtleSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXQob3duZXIsIGtleSwgdmFsdWUpO1xuICAgICAgICByZXR1cm4gdmFsdWUgIT09IHVuZGVmaW5lZCA/IHZhbHVlIDoga2V5O1xuICAgIH0sXG5cbiAgICByZW1vdmU6IGZ1bmN0aW9uKG93bmVyLCBrZXkpe1xuICAgICAgICB2YXIgaSwgY2FjaGUgPSBvd25lclt0aGlzLmV4cGFuZG9dO1xuICAgICAgICBpZiAoY2FjaGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmICggQXJyYXkuaXNBcnJheSgga2V5ICkgKSB7XG4gICAgICAgICAgICAgICAga2V5ID0ga2V5Lm1hcCggY2FtZWxDYXNlICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGtleSA9IGNhbWVsQ2FzZSgga2V5ICk7XG5cbiAgICAgICAgICAgICAgICBrZXkgPSBrZXkgaW4gY2FjaGUgPyBbIGtleSBdIDogKCBrZXkubWF0Y2goIC9bXlxceDIwXFx0XFxyXFxuXFxmXSsvZyApIHx8IFtdICk7IC8vID8/P1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpID0ga2V5Lmxlbmd0aDtcblxuICAgICAgICAgICAgd2hpbGUgKCBpLS0gKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIGNhY2hlWyBrZXlbIGkgXSBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICgga2V5ID09PSB1bmRlZmluZWQgfHwgaXNFbXB0eU9iamVjdCggY2FjaGUgKSApIHtcbiAgICAgICAgICAgIGlmICggb3duZXIubm9kZVR5cGUgKSB7XG4gICAgICAgICAgICAgICAgb3duZXJbIHRoaXMuZXhwYW5kbyBdID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgb3duZXJbIHRoaXMuZXhwYW5kbyBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICBoYXNEYXRhOiBmdW5jdGlvbihvd25lcil7XG4gICAgICAgIHZhciBjYWNoZSA9IG93bmVyWyB0aGlzLmV4cGFuZG8gXTtcbiAgICAgICAgcmV0dXJuIGNhY2hlICE9PSB1bmRlZmluZWQgJiYgIWlzRW1wdHlPYmplY3QoIGNhY2hlICk7XG4gICAgfVxufTtcblxudmFyIGRhdGFTZXQgPSBuZXcgRGF0YSgnbTRxJyk7XG5cbiQuZXh0ZW5kKHtcbiAgICBoYXNEYXRhOiBmdW5jdGlvbihlbGVtKXtcbiAgICAgICAgcmV0dXJuIGRhdGFTZXQuaGFzRGF0YShlbGVtKTtcbiAgICB9LFxuXG4gICAgZGF0YTogZnVuY3Rpb24oZWxlbSwga2V5LCB2YWwpe1xuICAgICAgICByZXR1cm4gZGF0YVNldC5hY2Nlc3MoZWxlbSwga2V5LCB2YWwpO1xuICAgIH0sXG5cbiAgICByZW1vdmVEYXRhOiBmdW5jdGlvbihlbGVtLCBrZXkpe1xuICAgICAgICByZXR1cm4gZGF0YVNldC5yZW1vdmUoZWxlbSwga2V5KTtcbiAgICB9LFxuXG4gICAgZGF0YVNldDogZnVuY3Rpb24obnMpe1xuICAgICAgICBpZiAobm90KG5zKSkgcmV0dXJuIGRhdGFTZXQ7XG4gICAgICAgIGlmIChbJ0lOVEVSTkFMJywgJ000USddLmluZGV4T2YobnMudG9VcHBlckNhc2UoKSkgPiAtMSkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJZb3UgY2FuIG5vdCB1c2UgcmVzZXJ2ZWQgbmFtZSBmb3IgeW91ciBkYXRhc2V0XCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgRGF0YShucyk7XG4gICAgfVxufSk7XG5cbiQuZm4uZXh0ZW5kKHtcbiAgICBkYXRhOiBmdW5jdGlvbihrZXksIHZhbCl7XG4gICAgICAgIHZhciByZXMsIGVsZW0sIGRhdGEsIGF0dHJzLCBuYW1lLCBpO1xuXG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsZW0gPSB0aGlzWzBdO1xuXG4gICAgICAgIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PT0gMCApIHtcbiAgICAgICAgICAgIGlmICggdGhpcy5sZW5ndGggKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGRhdGFTZXQuZ2V0KCBlbGVtICk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgYXR0cnMgPSBlbGVtLmF0dHJpYnV0ZXM7XG4gICAgICAgICAgICAgICAgICAgIGkgPSBhdHRycy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICggaS0tICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBhdHRyc1sgaSBdICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBhdHRyc1sgaSBdLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBuYW1lLmluZGV4T2YoIFwiZGF0YS1cIiApID09PSAwICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gY2FtZWxDYXNlKCBuYW1lLnNsaWNlKCA1ICkgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YUF0dHIoIGVsZW0sIG5hbWUsIGRhdGFbIG5hbWUgXSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgKSB7XG4gICAgICAgICAgICByZXMgPSBkYXRhU2V0LmdldChlbGVtLCBrZXkpO1xuICAgICAgICAgICAgaWYgKHJlcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlbGVtLmhhc0F0dHJpYnV0ZShcImRhdGEtXCIra2V5KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzID0gZWxlbS5nZXRBdHRyaWJ1dGUoXCJkYXRhLVwiK2tleSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBkYXRhU2V0LnNldCggdGhpcywga2V5LCB2YWwgKTtcbiAgICAgICAgfSApO1xuICAgIH0sXG5cbiAgICByZW1vdmVEYXRhOiBmdW5jdGlvbigga2V5ICkge1xuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGRhdGFTZXQucmVtb3ZlKCB0aGlzLCBrZXkgKTtcbiAgICAgICAgfSApO1xuICAgIH0sXG5cbiAgICBvcmlnaW46IGZ1bmN0aW9uKG5hbWUsIHZhbHVlLCBkZWYpe1xuXG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobm90KG5hbWUpICYmIG5vdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybiAkLmRhdGEodGhpc1swXSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobm90KHZhbHVlKSkge1xuICAgICAgICAgICAgdmFyIHJlcyA9ICQuZGF0YSh0aGlzWzBdLCBcIm9yaWdpbi1cIituYW1lKTtcbiAgICAgICAgICAgIHJldHVybiAhbm90KHJlcykgPyByZXMgOiBkZWY7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmRhdGEoXCJvcmlnaW4tXCIrbmFtZSwgdmFsdWUpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbn0pO1xuXG4vLyBTb3VyY2U6IHNyYy91dGlscy5qc1xuXG4vKiBnbG9iYWwgJCwgbm90LCBpc0RhcmssIGNhbWVsQ2FzZSwgZGFzaGVkTmFtZSwgaXNQbGFpbk9iamVjdCwgaXNFbXB0eU9iamVjdCwgaXNBcnJheUxpa2UsIGFjY2VwdERhdGEsIHBhcnNlVW5pdCwgZ2V0VW5pdCwgaXNWaXNpYmxlLCBpc0hpZGRlbiwgbWF0Y2hlcywgc3RyaXAsIG5vcm1OYW1lLCBoYXNQcm9wLCBpc0xvY2FsaG9zdCwgaXNUb3VjaCAqL1xuXG4kLmV4dGVuZCh7XG5cbiAgICBkZXZpY2U6ICgvYW5kcm9pZHx3ZWJvc3xpcGhvbmV8aXBhZHxpcG9kfGJsYWNrYmVycnl8aWVtb2JpbGV8b3BlcmEgbWluaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpKSksXG4gICAgbG9jYWxob3N0OiBpc0xvY2FsaG9zdCgpLFxuICAgIGlzTG9jYWxob3N0OiBpc0xvY2FsaG9zdCxcbiAgICB0b3VjaGFibGU6IGlzVG91Y2goKSxcbiAgICBkYXJrOiBpc0RhcmsoKSxcblxuICAgIHVuaXF1ZUlkOiBmdW5jdGlvbiAocHJlZml4KSB7XG4gICAgICAgIHZhciBkID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgIGlmIChub3QocHJlZml4KSkge1xuICAgICAgICAgICAgcHJlZml4ID0gJ200cSc7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChwcmVmaXggIT09ICcnID8gcHJlZml4ICsgJy0nIDogJycpICsgJ3h4eHgteHh4eC15eHh4LXh4eHh4eHh4eHh4eCcucmVwbGFjZSgvW3h5XS9nLCBmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgdmFyIHIgPSAoZCArIE1hdGgucmFuZG9tKCkgKiAxNikgJSAxNiB8IDA7XG4gICAgICAgICAgICBkID0gTWF0aC5mbG9vcihkIC8gMTYpO1xuICAgICAgICAgICAgcmV0dXJuIChjID09PSAneCcgPyByIDogKHIgJiAweDMgfCAweDgpKS50b1N0cmluZygxNik7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICB0b0FycmF5OiBmdW5jdGlvbihuKXtcbiAgICAgICAgdmFyIGksIG91dCA9IFtdO1xuXG4gICAgICAgIGZvciAoaSA9IDAgOyBpIDwgbi5sZW5ndGg7IGkrKyApIHtcbiAgICAgICAgICAgIG91dC5wdXNoKG5baV0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG91dDtcbiAgICB9LFxuXG4gICAgaW1wb3J0OiBmdW5jdGlvbihjdHgpe1xuICAgICAgICB2YXIgcmVzID0gW107XG4gICAgICAgIHRoaXMuZWFjaChjdHgsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXMucHVzaCh0aGlzKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLm1lcmdlKCQoKSwgcmVzKTtcbiAgICB9LFxuXG4gICAgbWVyZ2U6IGZ1bmN0aW9uKCBmaXJzdCwgc2Vjb25kICkge1xuICAgICAgICB2YXIgbGVuID0gK3NlY29uZC5sZW5ndGgsXG4gICAgICAgICAgICBqID0gMCxcbiAgICAgICAgICAgIGkgPSBmaXJzdC5sZW5ndGg7XG5cbiAgICAgICAgZm9yICggOyBqIDwgbGVuOyBqKysgKSB7XG4gICAgICAgICAgICBmaXJzdFsgaSsrIF0gPSBzZWNvbmRbIGogXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZpcnN0Lmxlbmd0aCA9IGk7XG5cbiAgICAgICAgcmV0dXJuIGZpcnN0O1xuICAgIH0sXG5cbiAgICB0eXBlOiBmdW5jdGlvbihvYmope1xuICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikucmVwbGFjZSgvXlxcW29iamVjdCAoLispXSQvLCAnJDEnKS50b0xvd2VyQ2FzZSgpO1xuICAgIH0sXG5cbiAgICBzbGVlcDogZnVuY3Rpb24obXMpIHtcbiAgICAgICAgbXMgKz0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSAqL1xuICAgICAgICB3aGlsZSAobmV3IERhdGUoKSA8IG1zKXt9XG4gICAgfSxcblxuICAgIGlzU2VsZWN0b3I6IGZ1bmN0aW9uKHNlbGVjdG9yKXtcbiAgICAgICAgaWYgKHR5cGVvZiBzZWxlY3RvciAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gICAgICAgIH0gY2F0Y2goZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgcmVtb3ZlOiBmdW5jdGlvbihzKXtcbiAgICAgICAgcmV0dXJuICQocykucmVtb3ZlKCk7XG4gICAgfSxcblxuICAgIGNhbWVsQ2FzZTogY2FtZWxDYXNlLFxuICAgIGRhc2hlZE5hbWU6IGRhc2hlZE5hbWUsXG4gICAgaXNQbGFpbk9iamVjdDogaXNQbGFpbk9iamVjdCxcbiAgICBpc0VtcHR5T2JqZWN0OiBpc0VtcHR5T2JqZWN0LFxuICAgIGlzQXJyYXlMaWtlOiBpc0FycmF5TGlrZSxcbiAgICBhY2NlcHREYXRhOiBhY2NlcHREYXRhLFxuICAgIG5vdDogbm90LFxuICAgIHBhcnNlVW5pdDogcGFyc2VVbml0LFxuICAgIGdldFVuaXQ6IGdldFVuaXQsXG4gICAgdW5pdDogcGFyc2VVbml0LFxuICAgIGlzVmlzaWJsZTogaXNWaXNpYmxlLFxuICAgIGlzSGlkZGVuOiBpc0hpZGRlbixcbiAgICBtYXRjaGVzOiBmdW5jdGlvbihlbCwgcykge3JldHVybiBtYXRjaGVzLmNhbGwoZWwsIHMpO30sXG4gICAgcmFuZG9tOiBmdW5jdGlvbihmcm9tLCB0bykge1xuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSAmJiBpc0FycmF5TGlrZShmcm9tKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZyb21bTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKihmcm9tLmxlbmd0aCkpXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKih0by1mcm9tKzEpK2Zyb20pO1xuICAgIH0sXG4gICAgc3RyaXA6IHN0cmlwLFxuICAgIG5vcm1OYW1lOiBub3JtTmFtZSxcbiAgICBoYXNQcm9wOiBoYXNQcm9wLFxuXG4gICAgc2VyaWFsaXplVG9BcnJheTogZnVuY3Rpb24oZm9ybSl7XG4gICAgICAgIHZhciBfZm9ybSA9ICQoZm9ybSlbMF07XG4gICAgICAgIGlmICghX2Zvcm0gfHwgX2Zvcm0ubm9kZU5hbWUgIT09IFwiRk9STVwiKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJFbGVtZW50IGlzIG5vdCBhIEhUTUxGcm9tRWxlbWVudFwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaSwgaiwgcSA9IFtdO1xuICAgICAgICBmb3IgKGkgPSBfZm9ybS5lbGVtZW50cy5sZW5ndGggLSAxOyBpID49IDA7IGkgPSBpIC0gMSkge1xuICAgICAgICAgICAgaWYgKF9mb3JtLmVsZW1lbnRzW2ldLm5hbWUgPT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN3aXRjaCAoX2Zvcm0uZWxlbWVudHNbaV0ubm9kZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdJTlBVVCc6XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2Zvcm0uZWxlbWVudHNbaV0udHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnY2hlY2tib3gnOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAncmFkaW8nOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfZm9ybS5lbGVtZW50c1tpXS5jaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEucHVzaChfZm9ybS5lbGVtZW50c1tpXS5uYW1lICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoX2Zvcm0uZWxlbWVudHNbaV0udmFsdWUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdmaWxlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHEucHVzaChfZm9ybS5lbGVtZW50c1tpXS5uYW1lICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoX2Zvcm0uZWxlbWVudHNbaV0udmFsdWUpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdURVhUQVJFQSc6XG4gICAgICAgICAgICAgICAgICAgIHEucHVzaChfZm9ybS5lbGVtZW50c1tpXS5uYW1lICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoX2Zvcm0uZWxlbWVudHNbaV0udmFsdWUpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnU0VMRUNUJzpcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfZm9ybS5lbGVtZW50c1tpXS50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdzZWxlY3Qtb25lJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxLnB1c2goX2Zvcm0uZWxlbWVudHNbaV0ubmFtZSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KF9mb3JtLmVsZW1lbnRzW2ldLnZhbHVlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdzZWxlY3QtbXVsdGlwbGUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaiA9IF9mb3JtLmVsZW1lbnRzW2ldLm9wdGlvbnMubGVuZ3RoIC0gMTsgaiA+PSAwOyBqID0gaiAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9mb3JtLmVsZW1lbnRzW2ldLm9wdGlvbnNbal0uc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEucHVzaChfZm9ybS5lbGVtZW50c1tpXS5uYW1lICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoX2Zvcm0uZWxlbWVudHNbaV0ub3B0aW9uc1tqXS52YWx1ZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ0JVVFRPTic6XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2Zvcm0uZWxlbWVudHNbaV0udHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAncmVzZXQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3VibWl0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2J1dHRvbic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcS5wdXNoKF9mb3JtLmVsZW1lbnRzW2ldLm5hbWUgKyBcIj1cIiArIGVuY29kZVVSSUNvbXBvbmVudChfZm9ybS5lbGVtZW50c1tpXS52YWx1ZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBxO1xuICAgIH0sXG4gICAgc2VyaWFsaXplOiBmdW5jdGlvbihmb3JtKXtcbiAgICAgICAgcmV0dXJuICQuc2VyaWFsaXplVG9BcnJheShmb3JtKS5qb2luKFwiJlwiKTtcbiAgICB9XG59KTtcblxuJC5mbi5leHRlbmQoe1xuICAgIGl0ZW1zOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gJC50b0FycmF5KHRoaXMpO1xuICAgIH1cbn0pO1xuXG4vLyBTb3VyY2U6IHNyYy9ldmVudHMuanNcblxuLyogZ2xvYmFsICQsIG5vdCwgY2FtZWxDYXNlLCBzdHIyYXJyLCBub3JtTmFtZSwgbWF0Y2hlcywgaXNFbXB0eU9iamVjdCwgaXNQbGFpbk9iamVjdCAqL1xuXG4vLyAoZnVuY3Rpb24gKCkge1xuLy8gICAgIGlmICggdHlwZW9mIHdpbmRvdy5DdXN0b21FdmVudCA9PT0gXCJmdW5jdGlvblwiICkgcmV0dXJuIGZhbHNlO1xuLy9cbi8vICAgICBmdW5jdGlvbiBDdXN0b21FdmVudCAoIGV2ZW50LCBwYXJhbXMgKSB7XG4vLyAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCB7IGJ1YmJsZXM6IGZhbHNlLCBjYW5jZWxhYmxlOiBmYWxzZSwgZGV0YWlsOiBudWxsIH07XG4vLyAgICAgICAgIHZhciBldnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCggJ0N1c3RvbUV2ZW50JyApO1xuLy8gICAgICAgICBldnQuaW5pdEN1c3RvbUV2ZW50KCBldmVudCwgcGFyYW1zLmJ1YmJsZXMsIHBhcmFtcy5jYW5jZWxhYmxlLCBwYXJhbXMuZGV0YWlsICk7XG4vLyAgICAgICAgIHJldHVybiBldnQ7XG4vLyAgICAgfVxuLy9cbi8vICAgICBDdXN0b21FdmVudC5wcm90b3R5cGUgPSB3aW5kb3cuRXZlbnQucHJvdG90eXBlO1xuLy9cbi8vICAgICB3aW5kb3cuQ3VzdG9tRXZlbnQgPSBDdXN0b21FdmVudDtcbi8vIH0pKCk7XG5cbnZhciBvdmVycmlkZGVuU3RvcCA9ICBFdmVudC5wcm90b3R5cGUuc3RvcFByb3BhZ2F0aW9uO1xudmFyIG92ZXJyaWRkZW5QcmV2ZW50ID0gIEV2ZW50LnByb3RvdHlwZS5wcmV2ZW50RGVmYXVsdDtcblxuRXZlbnQucHJvdG90eXBlLnN0b3BQcm9wYWdhdGlvbiA9IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHRydWU7XG4gICAgb3ZlcnJpZGRlblN0b3AuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbn07XG5FdmVudC5wcm90b3R5cGUucHJldmVudERlZmF1bHQgPSBmdW5jdGlvbigpe1xuICAgIHRoaXMuaXNQcmV2ZW50ZWREZWZhdWx0ID0gdHJ1ZTtcbiAgICBvdmVycmlkZGVuUHJldmVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xufTtcblxuRXZlbnQucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbihpbW1lZGlhdGUpe1xuICAgIHJldHVybiBpbW1lZGlhdGUgPyB0aGlzLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpIDogdGhpcy5zdG9wUHJvcGFnYXRpb24oKTtcbn07XG5cbiQuZXh0ZW5kKHtcbiAgICBldmVudHM6IFtdLFxuICAgIGV2ZW50SG9va3M6IHt9LFxuXG4gICAgZXZlbnRVSUQ6IC0xLFxuXG4gICAgLypcbiAgICAqIGVsLCBldmVudE5hbWUsIGhhbmRsZXIsIHNlbGVjdG9yLCBucywgaWQsIG9wdGlvbnNcbiAgICAqICovXG4gICAgc2V0RXZlbnRIYW5kbGVyOiBmdW5jdGlvbihvYmope1xuICAgICAgICB2YXIgaSwgZnJlZUluZGV4ID0gLTEsIGV2ZW50T2JqLCByZXN1bHRJbmRleDtcbiAgICAgICAgaWYgKHRoaXMuZXZlbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGZvcihpID0gMDsgaSA8IHRoaXMuZXZlbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZXZlbnRzW2ldLmhhbmRsZXIgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgZnJlZUluZGV4ID0gaTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZXZlbnRPYmogPSB7XG4gICAgICAgICAgICBlbGVtZW50OiBvYmouZWwsXG4gICAgICAgICAgICBldmVudDogb2JqLmV2ZW50LFxuICAgICAgICAgICAgaGFuZGxlcjogb2JqLmhhbmRsZXIsXG4gICAgICAgICAgICBzZWxlY3Rvcjogb2JqLnNlbGVjdG9yLFxuICAgICAgICAgICAgbnM6IG9iai5ucyxcbiAgICAgICAgICAgIGlkOiBvYmouaWQsXG4gICAgICAgICAgICBvcHRpb25zOiBvYmoub3B0aW9uc1xuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChmcmVlSW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICB0aGlzLmV2ZW50cy5wdXNoKGV2ZW50T2JqKTtcbiAgICAgICAgICAgIHJlc3VsdEluZGV4ID0gdGhpcy5ldmVudHMubGVuZ3RoIC0gMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRzW2ZyZWVJbmRleF0gPSBldmVudE9iajtcbiAgICAgICAgICAgIHJlc3VsdEluZGV4ID0gZnJlZUluZGV4O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdEluZGV4O1xuICAgIH0sXG5cbiAgICBnZXRFdmVudEhhbmRsZXI6IGZ1bmN0aW9uKGluZGV4KXtcbiAgICAgICAgaWYgKHRoaXMuZXZlbnRzW2luZGV4XSAhPT0gdW5kZWZpbmVkICYmIHRoaXMuZXZlbnRzW2luZGV4XSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5ldmVudHNbaW5kZXhdID0gbnVsbDtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmV2ZW50c1tpbmRleF0uaGFuZGxlcjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH0sXG5cbiAgICBvZmY6IGZ1bmN0aW9uKCl7XG4gICAgICAgICQuZWFjaCh0aGlzLmV2ZW50cywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuZXZlbnQsIHRoaXMuaGFuZGxlciwgdHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmV2ZW50cyA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgZ2V0RXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5ldmVudHM7XG4gICAgfSxcblxuICAgIGdldEV2ZW50SG9va3M6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmV2ZW50SG9va3M7XG4gICAgfSxcblxuICAgIGFkZEV2ZW50SG9vazogZnVuY3Rpb24oZXZlbnQsIGhhbmRsZXIsIHR5cGUpe1xuICAgICAgICBpZiAobm90KHR5cGUpKSB7XG4gICAgICAgICAgICB0eXBlID0gXCJiZWZvcmVcIjtcbiAgICAgICAgfVxuICAgICAgICAkLmVhY2goc3RyMmFycihldmVudCksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmV2ZW50SG9va3NbY2FtZWxDYXNlKHR5cGUrXCItXCIrdGhpcyldID0gaGFuZGxlcjtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICByZW1vdmVFdmVudEhvb2s6IGZ1bmN0aW9uKGV2ZW50LCB0eXBlKXtcbiAgICAgICAgaWYgKG5vdCh0eXBlKSkge1xuICAgICAgICAgICAgdHlwZSA9IFwiYmVmb3JlXCI7XG4gICAgICAgIH1cbiAgICAgICAgJC5lYWNoKHN0cjJhcnIoZXZlbnQpLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuZXZlbnRIb29rc1tjYW1lbENhc2UodHlwZStcIi1cIit0aGlzKV07XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgcmVtb3ZlRXZlbnRIb29rczogZnVuY3Rpb24oZXZlbnQpe1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIGlmIChub3QoZXZlbnQpKSB7XG4gICAgICAgICAgICB0aGlzLmV2ZW50SG9va3MgPSB7fTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQuZWFjaChzdHIyYXJyKGV2ZW50KSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhhdC5ldmVudEhvb2tzW2NhbWVsQ2FzZShcImJlZm9yZS1cIit0aGlzKV07XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoYXQuZXZlbnRIb29rc1tjYW1lbENhc2UoXCJhZnRlci1cIit0aGlzKV07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG59KTtcblxuJC5mbi5leHRlbmQoe1xuICAgIG9uOiBmdW5jdGlvbihldmVudHNMaXN0LCBzZWwsIGhhbmRsZXIsIG9wdGlvbnMpe1xuICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIHNlbCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb3B0aW9ucyA9IGhhbmRsZXI7XG4gICAgICAgICAgICBoYW5kbGVyID0gc2VsO1xuICAgICAgICAgICAgc2VsID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFpc1BsYWluT2JqZWN0KG9wdGlvbnMpKSB7XG4gICAgICAgICAgICBvcHRpb25zID0ge307XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWwgPSB0aGlzO1xuICAgICAgICAgICAgJC5lYWNoKHN0cjJhcnIoZXZlbnRzTGlzdCksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGgsIGV2ID0gdGhpcyxcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQgPSBldi5zcGxpdChcIi5cIiksXG4gICAgICAgICAgICAgICAgICAgIG5hbWUgPSBub3JtTmFtZShldmVudFswXSksXG4gICAgICAgICAgICAgICAgICAgIG5zID0gb3B0aW9ucy5ucyA/IG9wdGlvbnMubnMgOiBldmVudFsxXSxcbiAgICAgICAgICAgICAgICAgICAgaW5kZXgsIG9yaWdpbkV2ZW50O1xuXG4gICAgICAgICAgICAgICAgJC5ldmVudFVJRCsrO1xuXG4gICAgICAgICAgICAgICAgaCA9IGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgICAgICAgICAgICAgICAgIHZhciBiZWZvcmVIb29rID0gJC5ldmVudEhvb2tzW2NhbWVsQ2FzZShcImJlZm9yZS1cIituYW1lKV07XG4gICAgICAgICAgICAgICAgICAgIHZhciBhZnRlckhvb2sgPSAkLmV2ZW50SG9va3NbY2FtZWxDYXNlKFwiYWZ0ZXItXCIrbmFtZSldO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYmVmb3JlSG9vayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVIb29rLmNhbGwodGFyZ2V0LCBlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICghc2VsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLmNhbGwoZWwsIGUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRhcmdldCAmJiB0YXJnZXQgIT09IGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoZXMuY2FsbCh0YXJnZXQsIHNlbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5jYWxsKHRhcmdldCwgZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLmlzUHJvcGFnYXRpb25TdG9wcGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGFmdGVySG9vayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZnRlckhvb2suY2FsbCh0YXJnZXQsIGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMub25jZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSArJChlbCkub3JpZ2luKCBcImV2ZW50LVwiK2UudHlwZSsoc2VsID8gXCI6XCIrc2VsOlwiXCIpKyhucyA/IFwiOlwiK25zOlwiXCIpICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKGluZGV4KSkgJC5ldmVudHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaCwgXCJuYW1lXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGhhbmRsZXIubmFtZSAmJiBoYW5kbGVyLm5hbWUgIT09IFwiXCIgPyBoYW5kbGVyLm5hbWUgOiBcImZ1bmNfZXZlbnRfXCIrbmFtZStcIl9cIiskLmV2ZW50VUlEXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBvcmlnaW5FdmVudCA9IG5hbWUrKHNlbCA/IFwiOlwiK3NlbDpcIlwiKSsobnMgPyBcIjpcIituczpcIlwiKTtcblxuICAgICAgICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIobmFtZSwgaCwgIWlzRW1wdHlPYmplY3Qob3B0aW9ucykgPyBvcHRpb25zIDogZmFsc2UpO1xuXG4gICAgICAgICAgICAgICAgaW5kZXggPSAkLnNldEV2ZW50SGFuZGxlcih7XG4gICAgICAgICAgICAgICAgICAgIGVsOiBlbCxcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQ6IG5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXI6IGgsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yOiBzZWwsXG4gICAgICAgICAgICAgICAgICAgIG5zOiBucyxcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICQuZXZlbnRVSUQsXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6ICFpc0VtcHR5T2JqZWN0KG9wdGlvbnMpID8gb3B0aW9ucyA6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgJChlbCkub3JpZ2luKCdldmVudC0nK29yaWdpbkV2ZW50LCBpbmRleCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIG9uZTogZnVuY3Rpb24oZXZlbnRzLCBzZWwsIGhhbmRsZXIsIG9wdGlvbnMpe1xuICAgICAgICBpZiAoIWlzUGxhaW5PYmplY3Qob3B0aW9ucykpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgICAgfVxuXG4gICAgICAgIG9wdGlvbnMub25jZSA9IHRydWU7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMub24uYXBwbHkodGhpcywgW2V2ZW50cywgc2VsLCBoYW5kbGVyLCBvcHRpb25zXSk7XG4gICAgfSxcblxuICAgIG9mZjogZnVuY3Rpb24oZXZlbnRzTGlzdCwgc2VsLCBvcHRpb25zKXtcblxuICAgICAgICBpZiAoaXNQbGFpbk9iamVjdChzZWwpKSB7XG4gICAgICAgICAgICBvcHRpb25zID0gc2VsO1xuICAgICAgICAgICAgc2VsID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghaXNQbGFpbk9iamVjdChvcHRpb25zKSkge1xuICAgICAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5vdChldmVudHNMaXN0KSB8fCBldmVudHNMaXN0LnRvTG93ZXJDYXNlKCkgPT09ICdhbGwnKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGVsID0gdGhpcztcbiAgICAgICAgICAgICAgICAkLmVhY2goJC5ldmVudHMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUuZWxlbWVudCA9PT0gZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoZS5ldmVudCwgZS5oYW5kbGVyLCBlLm9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5oYW5kbGVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoZWwpLm9yaWdpbihcImV2ZW50LVwiK25hbWUrKGUuc2VsZWN0b3IgPyBcIjpcIitlLnNlbGVjdG9yOlwiXCIpKyhlLm5zID8gXCI6XCIrZS5uczpcIlwiKSwgbnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsID0gdGhpcztcbiAgICAgICAgICAgICQuZWFjaChzdHIyYXJyKGV2ZW50c0xpc3QpLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBldk1hcCA9IHRoaXMuc3BsaXQoXCIuXCIpLFxuICAgICAgICAgICAgICAgICAgICBuYW1lID0gbm9ybU5hbWUoZXZNYXBbMF0pLFxuICAgICAgICAgICAgICAgICAgICBucyA9IG9wdGlvbnMubnMgPyBvcHRpb25zLm5zIDogZXZNYXBbMV0sXG4gICAgICAgICAgICAgICAgICAgIG9yaWdpbkV2ZW50LCBpbmRleDtcblxuICAgICAgICAgICAgICAgIG9yaWdpbkV2ZW50ID0gXCJldmVudC1cIituYW1lKyhzZWwgPyBcIjpcIitzZWw6XCJcIikrKG5zID8gXCI6XCIrbnM6XCJcIik7XG4gICAgICAgICAgICAgICAgaW5kZXggPSAkKGVsKS5vcmlnaW4ob3JpZ2luRXZlbnQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ICE9PSB1bmRlZmluZWQgJiYgJC5ldmVudHNbaW5kZXhdLmhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihuYW1lLCAkLmV2ZW50c1tpbmRleF0uaGFuZGxlciwgJC5ldmVudHNbaW5kZXhdLm9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICAkLmV2ZW50c1tpbmRleF0uaGFuZGxlciA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJChlbCkub3JpZ2luKG9yaWdpbkV2ZW50LCBudWxsKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgdHJpZ2dlcjogZnVuY3Rpb24obmFtZSwgZGF0YSl7XG4gICAgICAgIHJldHVybiB0aGlzLmZpcmUobmFtZSwgZGF0YSk7XG4gICAgfSxcblxuICAgIGZpcmU6IGZ1bmN0aW9uKG5hbWUsIGRhdGEpe1xuICAgICAgICB2YXIgX25hbWUsIGU7XG5cbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICB9XG5cbiAgICAgICAgX25hbWUgPSBub3JtTmFtZShuYW1lKTtcblxuICAgICAgICBpZiAoWydmb2N1cycsICdibHVyJ10uaW5kZXhPZihfbmFtZSkgPiAtMSkge1xuICAgICAgICAgICAgdGhpc1swXVtfbmFtZV0oKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiBDdXN0b21FdmVudCAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgZSA9IG5ldyBDdXN0b21FdmVudChfbmFtZSwge1xuICAgICAgICAgICAgICAgIGJ1YmJsZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgY2FuY2VsYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkZXRhaWw6IGRhdGFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZSA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdFdmVudHMnKTtcbiAgICAgICAgICAgIGUuZGV0YWlsID0gZGF0YTtcbiAgICAgICAgICAgIGUuaW5pdEV2ZW50KF9uYW1lLCB0cnVlLCB0cnVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlKTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG5cbiggXCJibHVyIGZvY3VzIHJlc2l6ZSBzY3JvbGwgY2xpY2sgZGJsY2xpY2sgbW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBjb250ZXh0bWVudSB0b3VjaHN0YXJ0IHRvdWNoZW5kIHRvdWNobW92ZSB0b3VjaGNhbmNlbFwiIClcbiAgICAuc3BsaXQoIFwiIFwiIClcbiAgICAuZm9yRWFjaChcbiAgICBmdW5jdGlvbiggbmFtZSApIHtcbiAgICAgICAgJC5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHNlbCwgZm4sIG9wdCApIHtcbiAgICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID4gMCA/XG4gICAgICAgICAgICAgICAgdGhpcy5vbiggbmFtZSwgc2VsLCBmbiwgb3B0ICkgOlxuICAgICAgICAgICAgICAgIHRoaXMuZmlyZSggbmFtZSApO1xuICAgICAgICB9O1xufSk7XG5cbiQuZm4uZXh0ZW5kKCB7XG4gICAgaG92ZXI6IGZ1bmN0aW9uKCBmbk92ZXIsIGZuT3V0ICkge1xuICAgICAgICByZXR1cm4gdGhpcy5tb3VzZWVudGVyKCBmbk92ZXIgKS5tb3VzZWxlYXZlKCBmbk91dCB8fCBmbk92ZXIgKTtcbiAgICB9XG59KTtcblxuJC5yZWFkeSA9IGZ1bmN0aW9uKGZuLCBvcHRpb25zKXtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZm4sIChvcHRpb25zIHx8IGZhbHNlKSk7XG59O1xuXG4kLmxvYWQgPSBmdW5jdGlvbihmbil7XG4gICAgcmV0dXJuICQod2luZG93KS5vbihcImxvYWRcIiwgZm4pO1xufTtcblxuJC51bmxvYWQgPSBmdW5jdGlvbihmbil7XG4gICAgcmV0dXJuICQod2luZG93KS5vbihcInVubG9hZFwiLCBmbik7XG59O1xuXG4kLmZuLmV4dGVuZCh7XG4gICAgdW5sb2FkOiBmdW5jdGlvbihmbil7XG4gICAgICAgIHJldHVybiAodGhpcy5sZW5ndGggPT09IDAgfHwgdGhpc1swXS5zZWxmICE9PSB3aW5kb3cpID8gdW5kZWZpbmVkIDogJC51bmxvYWQoZm4pO1xuICAgIH1cbn0pO1xuXG4kLmJlZm9yZXVubG9hZCA9IGZ1bmN0aW9uKGZuKXtcbiAgICBpZiAodHlwZW9mIGZuID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHJldHVybiAkKHdpbmRvdykub24oXCJiZWZvcmV1bmxvYWRcIiwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICBlLnJldHVyblZhbHVlID0gZm47XG4gICAgICAgICAgICByZXR1cm4gZm47XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAkKHdpbmRvdykub24oXCJiZWZvcmV1bmxvYWRcIiwgZm4pO1xuICAgIH1cbn07XG5cbiQuZm4uZXh0ZW5kKHtcbiAgICBiZWZvcmV1bmxvYWQ6IGZ1bmN0aW9uKGZuKXtcbiAgICAgICAgcmV0dXJuICh0aGlzLmxlbmd0aCA9PT0gMCB8fCB0aGlzWzBdLnNlbGYgIT09IHdpbmRvdykgPyB1bmRlZmluZWQgOiAkLmJlZm9yZXVubG9hZChmbik7XG4gICAgfVxufSk7XG5cbiQuZm4uZXh0ZW5kKHtcbiAgICByZWFkeTogZnVuY3Rpb24oZm4pe1xuICAgICAgICBpZiAodGhpcy5sZW5ndGggJiYgdGhpc1swXSA9PT0gZG9jdW1lbnQgJiYgdHlwZW9mIGZuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5yZWFkeShmbik7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuLy8gU291cmNlOiBzcmMvYWpheC5qc1xuXG4vKiBnbG9iYWwgJCwgUHJvbWlzZSwgbm90LCBpc1NpbXBsZSwgaXNQbGFpbk9iamVjdCwgaXNFbXB0eU9iamVjdCwgY2FtZWxDYXNlICovXG4vKiBjYW4gYmUgY2hhbmdlZCB0byBmZXRjaCAqL1xuJC5hamF4ID0gZnVuY3Rpb24ocCl7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCl7XG4gICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKSwgZGF0YTtcbiAgICAgICAgdmFyIG1ldGhvZCA9IChwLm1ldGhvZCB8fCBcIkdFVFwiKS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICB2YXIgaGVhZGVycyA9IFtdO1xuICAgICAgICB2YXIgYXN5bmMgPSBub3QocC5hc3luYykgPyB0cnVlIDogcC5hc3luYztcbiAgICAgICAgdmFyIHVybCA9IHAudXJsO1xuICAgICAgICB2YXIgdXJsV2l0aFBhcmFtcyA9IHVybC5pbmRleE9mKFwiP1wiKSA+IC0xO1xuICAgICAgICB2YXIgam9pblBhcmFtc1N5bWJvbCA9IHVybFdpdGhQYXJhbXMgPyBcIiZcIiA6IFwiP1wiO1xuXG4gICAgICAgIHZhciBleGVjID0gZnVuY3Rpb24oZm4sIHBhcmFtcyl7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGZuID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICBmbi5hcHBseShudWxsLCBwYXJhbXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpc0dldCA9IGZ1bmN0aW9uKG1ldGhvZCl7XG4gICAgICAgICAgICByZXR1cm4gW1wiR0VUXCIsIFwiSlNPTlwiXS5pbmRleE9mKG1ldGhvZCkgIT09IC0xO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBwbGFpbk9iamVjdFRvRGF0YSA9IGZ1bmN0aW9uKG9iail7XG4gICAgICAgICAgICB2YXIgX2RhdGEgPSBbXTtcbiAgICAgICAgICAgICQuZWFjaChvYmosIGZ1bmN0aW9uKGssIHYpe1xuICAgICAgICAgICAgICAgIHZhciBfdiA9IGlzU2ltcGxlKHYpID8gdiA6IEpTT04uc3RyaW5naWZ5KHYpO1xuICAgICAgICAgICAgICAgIF9kYXRhLnB1c2goaytcIj1cIiArIF92KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIF9kYXRhLmpvaW4oXCImXCIpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChwLmRhdGEgaW5zdGFuY2VvZiBIVE1MRm9ybUVsZW1lbnQpIHtcbiAgICAgICAgICAgIHZhciBfYWN0aW9uID0gcC5kYXRhLmdldEF0dHJpYnV0ZShcImFjdGlvblwiKTtcbiAgICAgICAgICAgIHZhciBfbWV0aG9kID0gcC5kYXRhLmdldEF0dHJpYnV0ZShcIm1ldGhvZFwiKTtcblxuICAgICAgICAgICAgaWYgKG5vdCh1cmwpICYmIF9hY3Rpb24gJiYgX2FjdGlvbi50cmltKCkgIT09IFwiXCIpIHt1cmwgPSBfYWN0aW9uO31cbiAgICAgICAgICAgIGlmIChfbWV0aG9kICYmIF9tZXRob2QudHJpbSgpICE9PSBcIlwiKSB7bWV0aG9kID0gX21ldGhvZC50b1VwcGVyQ2FzZSgpO31cbiAgICAgICAgfVxuXG5cbiAgICAgICAgaWYgKHAudGltZW91dCkge1xuICAgICAgICAgICAgeGhyLnRpbWVvdXQgPSBwLnRpbWVvdXQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocC53aXRoQ3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgIHhoci53aXRoQ3JlZGVudGlhbHMgPSBwLndpdGhDcmVkZW50aWFscztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwLmRhdGEgaW5zdGFuY2VvZiBIVE1MRm9ybUVsZW1lbnQpIHtcbiAgICAgICAgICAgIGRhdGEgPSAkLnNlcmlhbGl6ZShwLmRhdGEpO1xuICAgICAgICB9IGVsc2UgaWYgKHAuZGF0YSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ICYmIHAuZGF0YS5nZXRBdHRyaWJ1dGUoXCJ0eXBlXCIpICYmIHAuZGF0YS5nZXRBdHRyaWJ1dGUoXCJ0eXBlXCIpLnRvTG93ZXJDYXNlKCkgPT09IFwiZmlsZVwiKSB7XG4gICAgICAgICAgICB2YXIgX25hbWUgPSBwLmRhdGEuZ2V0QXR0cmlidXRlKFwibmFtZVwiKTtcbiAgICAgICAgICAgIGRhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcC5kYXRhLmZpbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5hcHBlbmQoX25hbWUsIHAuZGF0YS5maWxlc1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdChwLmRhdGEpKSB7XG4gICAgICAgICAgICBkYXRhID0gcGxhaW5PYmplY3RUb0RhdGEocC5kYXRhKTtcbiAgICAgICAgfSBlbHNlIGlmIChwLmRhdGEgaW5zdGFuY2VvZiBGb3JtRGF0YSkge1xuICAgICAgICAgICAgZGF0YSA9IHAuZGF0YTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcC5kYXRhID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICBkYXRhID0gcC5kYXRhO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICAgICAgZGF0YS5hcHBlbmQoXCJfZGF0YVwiLCBKU09OLnN0cmluZ2lmeShwLmRhdGEpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpc0dldChtZXRob2QpKSB7XG4gICAgICAgICAgICB1cmwgKz0gKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiID8gam9pblBhcmFtc1N5bWJvbCArIGRhdGEgOiBpc0VtcHR5T2JqZWN0KGRhdGEpID8gXCJcIiA6IGpvaW5QYXJhbXNTeW1ib2wgKyBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgICAgIH1cblxuICAgICAgICB4aHIub3BlbihtZXRob2QsIHVybCwgYXN5bmMsIHAudXNlciwgcC5wYXNzd29yZCk7XG4gICAgICAgIGlmIChwLmhlYWRlcnMpIHtcbiAgICAgICAgICAgICQuZWFjaChwLmhlYWRlcnMsIGZ1bmN0aW9uKGssIHYpe1xuICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKGssIHYpO1xuICAgICAgICAgICAgICAgIGhlYWRlcnMucHVzaChrKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghaXNHZXQobWV0aG9kKSkge1xuICAgICAgICAgICAgaWYgKGhlYWRlcnMuaW5kZXhPZihcIkNvbnRlbnQtdHlwZVwiKSA9PT0gLTEgJiYgcC5jb250ZW50VHlwZSAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtdHlwZVwiLCBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB4aHIuc2VuZChkYXRhKTtcblxuICAgICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQgJiYgeGhyLnN0YXR1cyA8IDMwMCkge1xuICAgICAgICAgICAgICAgIHZhciBfcmV0dXJuID0gcC5yZXR1cm5WYWx1ZSAmJiBwLnJldHVyblZhbHVlID09PSAneGhyJyA/IHhociA6IHhoci5yZXNwb25zZTtcbiAgICAgICAgICAgICAgICBpZiAocC5wYXJzZUpzb24pIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZXR1cm4gPSBKU09OLnBhcnNlKF9yZXR1cm4pO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3JldHVybiA9IHt9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGV4ZWMocmVzb2x2ZSwgW19yZXR1cm5dKTtcbiAgICAgICAgICAgICAgICBleGVjKHAub25TdWNjZXNzLCBbZSwgeGhyXSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGV4ZWMocmVqZWN0LCBbeGhyXSk7XG4gICAgICAgICAgICAgICAgZXhlYyhwLm9uRmFpbCwgW2UsIHhocl0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZXhlYyhwLm9uTG9hZCwgW2UsIHhocl0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAkLmVhY2goW1wicmVhZHlzdGF0ZWNoYW5nZVwiLCBcImVycm9yXCIsIFwidGltZW91dFwiLCBcInByb2dyZXNzXCIsIFwibG9hZHN0YXJ0XCIsIFwibG9hZGVuZFwiLCBcImFib3J0XCJdLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGV2ID0gY2FtZWxDYXNlKFwib24tXCIrKHRoaXMgPT09ICdyZWFkeXN0YXRlY2hhbmdlJyA/ICdzdGF0ZScgOiB0aGlzKSk7XG4gICAgICAgICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcihldiwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZXhlYyhwW2V2XSwgW2UsIHhocl0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufTtcblxuWydnZXQnLCAncG9zdCcsICdwdXQnLCAncGF0Y2gnLCAnZGVsZXRlJywgJ2pzb24nXS5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZCl7XG4gICAgJFttZXRob2RdID0gZnVuY3Rpb24odXJsLCBkYXRhLCBvcHRpb25zKXtcbiAgICAgICAgdmFyIF9tZXRob2QgPSBtZXRob2QudG9VcHBlckNhc2UoKTtcbiAgICAgICAgdmFyIF9vcHRpb25zID0ge1xuICAgICAgICAgICAgbWV0aG9kOiBfbWV0aG9kID09PSAnSlNPTicgPyAnR0VUJyA6IF9tZXRob2QsXG4gICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICBwYXJzZUpzb246IF9tZXRob2QgPT09ICdKU09OJ1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gJC5hamF4KCQuZXh0ZW5kKHt9LCBfb3B0aW9ucywgb3B0aW9ucykpO1xuICAgIH07XG59KTtcblxuJC5mbi5leHRlbmQoe1xuICAgIGxvYWQ6IGZ1bmN0aW9uKHVybCwgZGF0YSwgb3B0aW9ucyl7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICBpZiAodGhpcy5sZW5ndGggJiYgdGhpc1swXS5zZWxmID09PSB3aW5kb3cgKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5sb2FkKHVybCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gJC5nZXQodXJsLCBkYXRhLCBvcHRpb25zKS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgdGhhdC5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhpcy5pbm5lckhUTUwgPSBkYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pO1xuXG4vLyBTb3VyY2U6IHNyYy9jc3MuanNcblxuLyogZ2xvYmFsICQsIG5vdCwgc2V0U3R5bGVQcm9wICovXG5cbiQuZm4uZXh0ZW5kKHtcblxuICAgIHN0eWxlOiBmdW5jdGlvbihuYW1lLCBwc2V1ZG8pe1xuICAgICAgICB2YXIgZWw7XG5cbiAgICAgICAgZnVuY3Rpb24gX2dldFN0eWxlKGVsLCBwcm9wLCBwc2V1ZG8pe1xuICAgICAgICAgICAgcmV0dXJuIFtcInNjcm9sbExlZnRcIiwgXCJzY3JvbGxUb3BcIl0uaW5kZXhPZihwcm9wKSA+IC0xID8gJChlbClbcHJvcF0oKSA6IGdldENvbXB1dGVkU3R5bGUoZWwsIHBzZXVkbylbcHJvcF07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIG5hbWUgPT09ICdzdHJpbmcnICYmIHRoaXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuXG4gICAgICAgIGVsID0gdGhpc1swXTtcblxuICAgICAgICBpZiAobm90KG5hbWUpIHx8IG5hbWUgPT09IFwiYWxsXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRDb21wdXRlZFN0eWxlKGVsLCBwc2V1ZG8pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHt9LCBuYW1lcyA9IG5hbWUuc3BsaXQoXCIsIFwiKS5tYXAoZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgICAgIHJldHVybiAoXCJcIitlbCkudHJpbSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAobmFtZXMubGVuZ3RoID09PSAxKSAge1xuICAgICAgICAgICAgICAgIHJldHVybiBfZ2V0U3R5bGUoZWwsIG5hbWVzWzBdLCBwc2V1ZG8pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkLmVhY2gobmFtZXMsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByb3AgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRbdGhpc10gPSBfZ2V0U3R5bGUoZWwsIHByb3AsIHBzZXVkbyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZW1vdmVTdHlsZVByb3BlcnR5OiBmdW5jdGlvbihuYW1lKXtcbiAgICAgICAgaWYgKG5vdChuYW1lKSB8fCB0aGlzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHRoaXM7XG4gICAgICAgIHZhciBuYW1lcyA9IG5hbWUuc3BsaXQoXCIsIFwiKS5tYXAoZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgcmV0dXJuIChcIlwiK2VsKS50cmltKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbCA9IHRoaXM7XG4gICAgICAgICAgICAkLmVhY2gobmFtZXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgZWwuc3R5bGUucmVtb3ZlUHJvcGVydHkodGhpcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGNzczogZnVuY3Rpb24oa2V5LCB2YWwpe1xuICAgICAgICBrZXkgPSBrZXkgfHwgJ2FsbCc7XG5cbiAgICAgICAgaWYgKHR5cGVvZiBrZXkgPT09IFwic3RyaW5nXCIgJiYgbm90KHZhbCkpIHtcbiAgICAgICAgICAgIHJldHVybiAgdGhpcy5zdHlsZShrZXkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsID0gdGhpcztcbiAgICAgICAgICAgIGlmICh0eXBlb2Yga2V5ID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKGtleSwgZnVuY3Rpb24oa2V5LCB2YWwpe1xuICAgICAgICAgICAgICAgICAgICBzZXRTdHlsZVByb3AoZWwsIGtleSwgdmFsKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGtleSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIHNldFN0eWxlUHJvcChlbCwga2V5LCB2YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgc2Nyb2xsVG9wOiBmdW5jdGlvbih2YWwpe1xuICAgICAgICBpZiAobm90KHZhbCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxlbmd0aCA9PT0gMCA/IHVuZGVmaW5lZCA6IHRoaXNbMF0gPT09IHdpbmRvdyA/IHBhZ2VZT2Zmc2V0IDogdGhpc1swXS5zY3JvbGxUb3A7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5zY3JvbGxUb3AgPSB2YWw7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBzY3JvbGxMZWZ0OiBmdW5jdGlvbih2YWwpe1xuICAgICAgICBpZiAobm90KHZhbCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxlbmd0aCA9PT0gMCA/IHVuZGVmaW5lZCA6IHRoaXNbMF0gPT09IHdpbmRvdyA/IHBhZ2VYT2Zmc2V0IDogdGhpc1swXS5zY3JvbGxMZWZ0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuc2Nyb2xsTGVmdCA9IHZhbDtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG5cblxuXG4vLyBTb3VyY2U6IHNyYy9jbGFzc2VzLmpzXG5cbi8qIGdsb2JhbCAkLCBub3QgKi9cblxuJC5mbi5leHRlbmQoe1xuICAgIGFkZENsYXNzOiBmdW5jdGlvbigpe30sXG4gICAgcmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uKCl7fSxcbiAgICB0b2dnbGVDbGFzczogZnVuY3Rpb24oKXt9LFxuXG4gICAgY29udGFpbnNDbGFzczogZnVuY3Rpb24oY2xzKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzQ2xhc3MoY2xzKTtcbiAgICB9LFxuXG4gICAgaGFzQ2xhc3M6IGZ1bmN0aW9uKGNscyl7XG4gICAgICAgIHZhciByZXN1bHQgPSBmYWxzZTtcbiAgICAgICAgdmFyIGNsYXNzZXMgPSBjbHMuc3BsaXQoXCIgXCIpLmZpbHRlcihmdW5jdGlvbih2KXtcbiAgICAgICAgICAgIHJldHVybiAoXCJcIit2KS50cmltKCkgIT09IFwiXCI7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChub3QoY2xzKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWwgPSB0aGlzO1xuXG4gICAgICAgICAgICAkLmVhY2goY2xhc3NlcywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdCAmJiBlbC5jbGFzc0xpc3QgJiYgZWwuY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcblxuICAgIGNsZWFyQ2xhc3NlczogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5jbGFzc05hbWUgPSBcIlwiO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgY2xzOiBmdW5jdGlvbihhcnJheSl7XG4gICAgICAgIHJldHVybiB0aGlzLmxlbmd0aCA9PT0gMCA/IHVuZGVmaW5lZCA6IGFycmF5ID8gdGhpc1swXS5jbGFzc05hbWUuc3BsaXQoXCIgXCIpIDogdGhpc1swXS5jbGFzc05hbWU7XG4gICAgfSxcblxuICAgIHJlbW92ZUNsYXNzQnk6IGZ1bmN0aW9uKG1hc2spe1xuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWwgPSAkKHRoaXMpO1xuICAgICAgICAgICAgdmFyIGNsYXNzZXMgPSBlbC5jbHModHJ1ZSk7XG4gICAgICAgICAgICAkLmVhY2goY2xhc3NlcywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgZWxDbGFzcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgaWYgKGVsQ2xhc3MuaW5kZXhPZihtYXNrKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsLnJlbW92ZUNsYXNzKGVsQ2xhc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59KTtcblxuWydhZGQnLCAncmVtb3ZlJywgJ3RvZ2dsZSddLmZvckVhY2goZnVuY3Rpb24gKG1ldGhvZCkge1xuICAgICQuZm5bbWV0aG9kICsgXCJDbGFzc1wiXSA9IGZ1bmN0aW9uKGNscyl7XG4gICAgICAgIGlmIChub3QoY2xzKSB8fCAoXCJcIitjbHMpLnRyaW0oKSA9PT0gXCJcIikgcmV0dXJuIHRoaXM7XG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgaGFzQ2xhc3NMaXN0ID0gdHlwZW9mIGVsLmNsYXNzTGlzdCAhPT0gXCJ1bmRlZmluZWRcIjtcbiAgICAgICAgICAgICQuZWFjaChjbHMuc3BsaXQoXCIgXCIpLmZpbHRlcihmdW5jdGlvbih2KXtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFwiXCIrdikudHJpbSgpICE9PSBcIlwiO1xuICAgICAgICAgICAgfSksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKGhhc0NsYXNzTGlzdCkgZWwuY2xhc3NMaXN0W21ldGhvZF0odGhpcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbn0pO1xuXG5cbi8vIFNvdXJjZTogc3JjL3BhcnNlci5qc1xuXG4vKiBnbG9iYWwgJCAqL1xuXG4kLnBhcnNlSFRNTCA9IGZ1bmN0aW9uKGRhdGEpe1xuICAgIHZhciBiYXNlLCBzaW5nbGVUYWcsIHJlc3VsdCA9IFtdLCBjdHgsIF9jb250ZXh0O1xuICAgIHZhciByZWdleHBTaW5nbGVUYWcgPSAvXjwoW2Etel1bXlxcL1xcMD46XFx4MjBcXHRcXHJcXG5cXGZdKilbXFx4MjBcXHRcXHJcXG5cXGZdKlxcLz8+KD86PFxcL1xcMT58KSQvaTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuXG4gICAgaWYgKHR5cGVvZiBkYXRhICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBkYXRhID0gZGF0YS50cmltKCk7XG5cbiAgICBjdHggPSBkb2N1bWVudC5pbXBsZW1lbnRhdGlvbi5jcmVhdGVIVE1MRG9jdW1lbnQoXCJcIik7XG4gICAgYmFzZSA9IGN0eC5jcmVhdGVFbGVtZW50KCBcImJhc2VcIiApO1xuICAgIGJhc2UuaHJlZiA9IGRvY3VtZW50LmxvY2F0aW9uLmhyZWY7XG4gICAgY3R4LmhlYWQuYXBwZW5kQ2hpbGQoIGJhc2UgKTtcbiAgICBfY29udGV4dCA9IGN0eC5ib2R5O1xuXG4gICAgc2luZ2xlVGFnID0gcmVnZXhwU2luZ2xlVGFnLmV4ZWMoZGF0YSk7XG5cbiAgICBpZiAoc2luZ2xlVGFnKSB7XG4gICAgICAgIHJlc3VsdC5wdXNoKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoc2luZ2xlVGFnWzFdKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgX2NvbnRleHQuaW5uZXJIVE1MID0gZGF0YTtcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IF9jb250ZXh0LmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKF9jb250ZXh0LmNoaWxkTm9kZXNbaV0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5cblxuLy8gU291cmNlOiBzcmMvc2l6ZS5qc1xuXG4vKiBnbG9iYWwgJCwgbm90ICovXG5cbiQuZm4uZXh0ZW5kKHtcbiAgICBfc2l6ZTogZnVuY3Rpb24ocHJvcCwgdmFsKXtcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSAwKSByZXR1cm4gO1xuXG4gICAgICAgIGlmIChub3QodmFsKSkge1xuXG4gICAgICAgICAgICB2YXIgZWwgPSB0aGlzWzBdO1xuXG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gJ2hlaWdodCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWwgPT09IHdpbmRvdyA/IHdpbmRvdy5pbm5lckhlaWdodCA6IGVsID09PSBkb2N1bWVudCA/IGVsLmJvZHkuY2xpZW50SGVpZ2h0IDogcGFyc2VJbnQoZ2V0Q29tcHV0ZWRTdHlsZShlbCkuaGVpZ2h0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnd2lkdGgnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsID09PSB3aW5kb3cgPyB3aW5kb3cuaW5uZXJXaWR0aCA6IGVsID09PSBkb2N1bWVudCA/IGVsLmJvZHkuY2xpZW50V2lkdGggOiBwYXJzZUludChnZXRDb21wdXRlZFN0eWxlKGVsKS53aWR0aCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWwgPSB0aGlzO1xuICAgICAgICAgICAgaWYgKGVsID09PSB3aW5kb3cgfHwgZWwgPT09IGRvY3VtZW50KSB7cmV0dXJuIDt9XG4gICAgICAgICAgICBlbC5zdHlsZVtwcm9wXSA9IGlzTmFOKHZhbCkgPyB2YWwgOiB2YWwgKyAncHgnO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgaGVpZ2h0OiBmdW5jdGlvbih2YWwpe1xuICAgICAgICByZXR1cm4gdGhpcy5fc2l6ZSgnaGVpZ2h0JywgdmFsKTtcbiAgICB9LFxuXG4gICAgd2lkdGg6IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgIHJldHVybiB0aGlzLl9zaXplKCd3aWR0aCcsIHZhbCk7XG4gICAgfSxcblxuICAgIF9zaXplT3V0OiBmdW5jdGlvbihwcm9wLCB2YWwpe1xuICAgICAgICB2YXIgZWwsIHNpemUsIHN0eWxlLCByZXN1bHQ7XG5cbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFub3QodmFsKSAmJiB0eXBlb2YgdmFsICE9PSBcImJvb2xlYW5cIikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBlbCA9IHRoaXM7XG4gICAgICAgICAgICAgICAgaWYgKGVsID09PSB3aW5kb3cgfHwgZWwgPT09IGRvY3VtZW50KSB7cmV0dXJuIDt9XG4gICAgICAgICAgICAgICAgdmFyIGgsIHN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZShlbCksXG4gICAgICAgICAgICAgICAgICAgIGJzID0gcHJvcCA9PT0gJ3dpZHRoJyA/IHBhcnNlSW50KHN0eWxlWydib3JkZXItbGVmdC13aWR0aCddKSArIHBhcnNlSW50KHN0eWxlWydib3JkZXItcmlnaHQtd2lkdGgnXSkgOiBwYXJzZUludChzdHlsZVsnYm9yZGVyLXRvcC13aWR0aCddKSArIHBhcnNlSW50KHN0eWxlWydib3JkZXItYm90dG9tLXdpZHRoJ10pLFxuICAgICAgICAgICAgICAgICAgICBwYSA9IHByb3AgPT09ICd3aWR0aCcgPyBwYXJzZUludChzdHlsZVsncGFkZGluZy1sZWZ0J10pICsgcGFyc2VJbnQoc3R5bGVbJ3BhZGRpbmctcmlnaHQnXSkgOiBwYXJzZUludChzdHlsZVsncGFkZGluZy10b3AnXSkgKyBwYXJzZUludChzdHlsZVsncGFkZGluZy1ib3R0b20nXSk7XG5cbiAgICAgICAgICAgICAgICBoID0gJCh0aGlzKVtwcm9wXSh2YWwpW3Byb3BdKCkgLSBicyAtIHBhO1xuICAgICAgICAgICAgICAgIGVsLnN0eWxlW3Byb3BdID0gaCArICdweCc7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsID0gdGhpc1swXTtcbiAgICAgICAgc2l6ZSA9IGVsW3Byb3AgPT09ICd3aWR0aCcgPyAnb2Zmc2V0V2lkdGgnIDogJ29mZnNldEhlaWdodCddO1xuICAgICAgICBzdHlsZSA9IGdldENvbXB1dGVkU3R5bGUoZWwpO1xuICAgICAgICByZXN1bHQgPSBzaXplICsgcGFyc2VJbnQoc3R5bGVbcHJvcCA9PT0gJ3dpZHRoJyA/ICdtYXJnaW4tbGVmdCcgOiAnbWFyZ2luLXRvcCddKSArIHBhcnNlSW50KHN0eWxlW3Byb3AgPT09ICd3aWR0aCcgPyAnbWFyZ2luLXJpZ2h0JyA6ICdtYXJnaW4tYm90dG9tJ10pO1xuICAgICAgICByZXR1cm4gdmFsID09PSB0cnVlID8gcmVzdWx0IDogc2l6ZTtcbiAgICB9LFxuXG4gICAgb3V0ZXJXaWR0aDogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NpemVPdXQoJ3dpZHRoJywgdmFsKTtcbiAgICB9LFxuXG4gICAgb3V0ZXJIZWlnaHQ6IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgIHJldHVybiB0aGlzLl9zaXplT3V0KCdoZWlnaHQnLCB2YWwpO1xuICAgIH0sXG5cbiAgICBwYWRkaW5nOiBmdW5jdGlvbihwKXtcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSAwKSByZXR1cm47XG4gICAgICAgIHZhciBzID0gZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzWzBdLCBwKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdG9wOiBwYXJzZUludChzW1wicGFkZGluZy10b3BcIl0pLFxuICAgICAgICAgICAgcmlnaHQ6IHBhcnNlSW50KHNbXCJwYWRkaW5nLXJpZ2h0XCJdKSxcbiAgICAgICAgICAgIGJvdHRvbTogcGFyc2VJbnQoc1tcInBhZGRpbmctYm90dG9tXCJdKSxcbiAgICAgICAgICAgIGxlZnQ6IHBhcnNlSW50KHNbXCJwYWRkaW5nLWxlZnRcIl0pXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIG1hcmdpbjogZnVuY3Rpb24ocCl7XG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuICAgICAgICB2YXIgcyA9IGdldENvbXB1dGVkU3R5bGUodGhpc1swXSwgcCk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRvcDogcGFyc2VJbnQoc1tcIm1hcmdpbi10b3BcIl0pLFxuICAgICAgICAgICAgcmlnaHQ6IHBhcnNlSW50KHNbXCJtYXJnaW4tcmlnaHRcIl0pLFxuICAgICAgICAgICAgYm90dG9tOiBwYXJzZUludChzW1wibWFyZ2luLWJvdHRvbVwiXSksXG4gICAgICAgICAgICBsZWZ0OiBwYXJzZUludChzW1wibWFyZ2luLWxlZnRcIl0pXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIGJvcmRlcjogZnVuY3Rpb24ocCl7XG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuICAgICAgICB2YXIgcyA9IGdldENvbXB1dGVkU3R5bGUodGhpc1swXSwgcCk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRvcDogcGFyc2VJbnQoc1tcImJvcmRlci10b3Atd2lkdGhcIl0pLFxuICAgICAgICAgICAgcmlnaHQ6IHBhcnNlSW50KHNbXCJib3JkZXItcmlnaHQtd2lkdGhcIl0pLFxuICAgICAgICAgICAgYm90dG9tOiBwYXJzZUludChzW1wiYm9yZGVyLWJvdHRvbS13aWR0aFwiXSksXG4gICAgICAgICAgICBsZWZ0OiBwYXJzZUludChzW1wiYm9yZGVyLWxlZnQtd2lkdGhcIl0pXG4gICAgICAgIH07XG4gICAgfVxufSk7XG5cbi8vIFNvdXJjZTogc3JjL3Bvc2l0aW9uLmpzXG5cbi8qIGdsb2JhbCAkLCBub3QgKi9cblxuJC5mbi5leHRlbmQoe1xuICAgIG9mZnNldDogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgdmFyIHJlY3Q7XG5cbiAgICAgICAgaWYgKG5vdCh2YWwpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IDApIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICByZWN0ID0gdGhpc1swXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdG9wOiByZWN0LnRvcCArIHBhZ2VZT2Zmc2V0LFxuICAgICAgICAgICAgICAgIGxlZnQ6IHJlY3QubGVmdCArIHBhZ2VYT2Zmc2V0XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpeyAvLz9cbiAgICAgICAgICAgIHZhciBlbCA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAgdG9wID0gdmFsLnRvcCxcbiAgICAgICAgICAgICAgICBsZWZ0ID0gdmFsLmxlZnQsXG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSBnZXRDb21wdXRlZFN0eWxlKHRoaXMpLnBvc2l0aW9uLFxuICAgICAgICAgICAgICAgIG9mZnNldCA9IGVsLm9mZnNldCgpO1xuXG4gICAgICAgICAgICBpZiAocG9zaXRpb24gPT09IFwic3RhdGljXCIpIHtcbiAgICAgICAgICAgICAgICBlbC5jc3MoXCJwb3NpdGlvblwiLCBcInJlbGF0aXZlXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoW1wiYWJzb2x1dGVcIiwgXCJmaXhlZFwiXS5pbmRleE9mKHBvc2l0aW9uKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICB0b3AgPSB0b3AgLSBvZmZzZXQudG9wO1xuICAgICAgICAgICAgICAgIGxlZnQgPSBsZWZ0IC0gb2Zmc2V0LmxlZnQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsLmNzcyh7XG4gICAgICAgICAgICAgICAgdG9wOiB0b3AsXG4gICAgICAgICAgICAgICAgbGVmdDogbGVmdFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBwb3NpdGlvbjogZnVuY3Rpb24obWFyZ2luKXtcbiAgICAgICAgdmFyIG1sID0gMCwgbXQgPSAwLCBlbCwgc3R5bGU7XG5cbiAgICAgICAgaWYgKG5vdChtYXJnaW4pIHx8IHR5cGVvZiBtYXJnaW4gIT09IFwiYm9vbGVhblwiKSB7XG4gICAgICAgICAgICBtYXJnaW4gPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsID0gdGhpc1swXTtcbiAgICAgICAgc3R5bGUgPSBnZXRDb21wdXRlZFN0eWxlKGVsKTtcblxuICAgICAgICBpZiAobWFyZ2luKSB7XG4gICAgICAgICAgICBtbCA9IHBhcnNlSW50KHN0eWxlWydtYXJnaW4tbGVmdCddKTtcbiAgICAgICAgICAgIG10ID0gcGFyc2VJbnQoc3R5bGVbJ21hcmdpbi10b3AnXSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbGVmdDogZWwub2Zmc2V0TGVmdCAtIG1sLFxuICAgICAgICAgICAgdG9wOiBlbC5vZmZzZXRUb3AgLSBtdFxuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICBsZWZ0OiBmdW5jdGlvbih2YWwsIG1hcmdpbil7XG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDtcbiAgICAgICAgaWYgKG5vdCh2YWwpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wb3NpdGlvbihtYXJnaW4pLmxlZnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09IFwiYm9vbGVhblwiKSB7XG4gICAgICAgICAgICBtYXJnaW4gPSB2YWw7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wb3NpdGlvbihtYXJnaW4pLmxlZnQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgJCh0aGlzKS5jc3Moe1xuICAgICAgICAgICAgICAgIGxlZnQ6IHZhbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICB0b3A6IGZ1bmN0aW9uKHZhbCwgbWFyZ2luKXtcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSAwKSByZXR1cm4gO1xuICAgICAgICBpZiAobm90KHZhbCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBvc2l0aW9uKG1hcmdpbikudG9wO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgdmFsID09PSBcImJvb2xlYW5cIikge1xuICAgICAgICAgICAgbWFyZ2luID0gdmFsO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucG9zaXRpb24obWFyZ2luKS50b3A7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgJCh0aGlzKS5jc3Moe1xuICAgICAgICAgICAgICAgIHRvcDogdmFsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGNvb3JkOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGggPT09IDAgPyB1bmRlZmluZWQgOiB0aGlzWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIH0sXG5cbiAgICBwb3M6IGZ1bmN0aW9uKCl7XG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRvcDogcGFyc2VJbnQoJCh0aGlzWzBdKS5zdHlsZShcInRvcFwiKSksXG4gICAgICAgICAgICBsZWZ0OiBwYXJzZUludCgkKHRoaXNbMF0pLnN0eWxlKFwibGVmdFwiKSlcbiAgICAgICAgfTtcbiAgICB9XG59KTtcblxuLy8gU291cmNlOiBzcmMvYXR0ci5qc1xuXG4vKiBnbG9iYWwgJCwgbm90LCBpc1BsYWluT2JqZWN0ICovXG5cbiQuZm4uZXh0ZW5kKHtcbiAgICBhdHRyOiBmdW5jdGlvbihuYW1lLCB2YWwpe1xuICAgICAgICB2YXIgYXR0cmlidXRlcyA9IHt9O1xuXG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCAmJiBhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoICYmIGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICQuZWFjaCh0aGlzWzBdLmF0dHJpYnV0ZXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgYXR0cmlidXRlc1t0aGlzLm5vZGVOYW1lXSA9IHRoaXMubm9kZVZhbHVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gYXR0cmlidXRlcztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxICYmIHR5cGVvZiBuYW1lID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGggJiYgdGhpc1swXS5ub2RlVHlwZSA9PT0gMSAmJiB0aGlzWzBdLmhhc0F0dHJpYnV0ZShuYW1lKSA/IHRoaXNbMF0uZ2V0QXR0cmlidXRlKG5hbWUpIDogdW5kZWZpbmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsID0gdGhpcztcbiAgICAgICAgICAgIGlmIChpc1BsYWluT2JqZWN0KG5hbWUpKSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKG5hbWUsIGZ1bmN0aW9uKGssIHYpe1xuICAgICAgICAgICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoaywgdik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZShuYW1lLCB2YWwpO1xuICAgICAgICAgICAgICAgIC8vIFxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgcmVtb3ZlQXR0cjogZnVuY3Rpb24obmFtZSl7XG4gICAgICAgIHZhciBhdHRyaWJ1dGVzO1xuXG4gICAgICAgIGlmIChub3QobmFtZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgZWwgPSB0aGlzO1xuICAgICAgICAgICAgICAgICQuZWFjaCh0aGlzLmF0dHJpYnV0ZXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZSh0aGlzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgYXR0cmlidXRlcyA9IHR5cGVvZiBuYW1lID09PSBcInN0cmluZ1wiID8gbmFtZS5zcGxpdChcIixcIikubWFwKGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIHJldHVybiBlbC50cmltKCk7XG4gICAgICAgIH0pIDogbmFtZTtcblxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWwgPSB0aGlzO1xuICAgICAgICAgICAgJC5lYWNoKGF0dHJpYnV0ZXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKGVsLmhhc0F0dHJpYnV0ZSh0aGlzKSkgZWwucmVtb3ZlQXR0cmlidXRlKHRoaXMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICB0b2dnbGVBdHRyOiBmdW5jdGlvbihuYW1lLCB2YWwpe1xuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWwgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAobm90KHZhbCkpIHtcbiAgICAgICAgICAgICAgICBlbC5yZW1vdmVBdHRyaWJ1dGUobmFtZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZShuYW1lLCB2YWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBpZDogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgcmV0dXJuIHRoaXMubGVuZ3RoID8gJCh0aGlzWzBdKS5hdHRyKFwiaWRcIiwgdmFsKSA6IHVuZGVmaW5lZDtcbiAgICB9XG59KTtcblxuJC5leHRlbmQoe1xuICAgIG1ldGE6IGZ1bmN0aW9uKG5hbWUpe1xuICAgICAgICByZXR1cm4gbm90KG5hbWUpID8gJChcIm1ldGFcIikgOiAkKFwibWV0YVtuYW1lPSckbmFtZSddXCIucmVwbGFjZShcIiRuYW1lXCIsIG5hbWUpKTtcbiAgICB9LFxuXG4gICAgbWV0YUJ5OiBmdW5jdGlvbihuYW1lKXtcbiAgICAgICAgcmV0dXJuIG5vdChuYW1lKSA/ICQoXCJtZXRhXCIpIDogJChcIm1ldGFbJG5hbWVdXCIucmVwbGFjZShcIiRuYW1lXCIsIG5hbWUpKTtcbiAgICB9LFxuXG4gICAgZG9jdHlwZTogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuICQoXCJkb2N0eXBlXCIpO1xuICAgIH0sXG5cbiAgICBodG1sOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gJChcImh0bWxcIik7XG4gICAgfSxcblxuICAgIGhlYWQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiAkKFwiaHRtbFwiKS5maW5kKFwiaGVhZFwiKTtcbiAgICB9LFxuXG4gICAgYm9keTogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuICQoXCJib2R5XCIpO1xuICAgIH0sXG5cbiAgICBkb2N1bWVudDogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuICQoZG9jdW1lbnQpO1xuICAgIH0sXG5cbiAgICB3aW5kb3c6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiAkKHdpbmRvdyk7XG4gICAgfSxcblxuICAgIGNoYXJzZXQ6IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgIHZhciBtZXRhID0gJChcIm1ldGFbY2hhcnNldF1cIik7XG4gICAgICAgIGlmICh2YWwpIHtcbiAgICAgICAgICAgIG1ldGEuYXR0cihcImNoYXJzZXRcIiwgdmFsKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbWV0YS5hdHRyKFwiY2hhcnNldFwiKTtcbiAgICB9XG59KTtcblxuLy8gU291cmNlOiBzcmMvcHJveHkuanNcblxuLyogZ2xvYmFsICQgKi9cblxuJC5leHRlbmQoe1xuICAgIHByb3h5OiBmdW5jdGlvbihmbiwgY3R4KXtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiBmbiAhPT0gXCJmdW5jdGlvblwiID8gdW5kZWZpbmVkIDogZm4uYmluZChjdHgpO1xuICAgIH0sXG5cbiAgICBiaW5kOiBmdW5jdGlvbihmbiwgY3R4KXtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJveHkoZm4sIGN0eCk7XG4gICAgfVxufSk7XG5cblxuLy8gU291cmNlOiBzcmMvbWFuaXB1bGF0aW9uLmpzXG5cbi8qIGdsb2JhbCAkLCBpc0FycmF5TGlrZSwgbm90LCBtYXRjaGVzLCBoYXNQcm9wICovXG5cbihmdW5jdGlvbiAoYXJyKSB7XG4gICAgYXJyLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgWydhcHBlbmQnLCAncHJlcGVuZCddLmZvckVhY2goZnVuY3Rpb24od2hlcmUpe1xuICAgICAgICAgICAgaWYgKGhhc1Byb3AoaXRlbSwgd2hlcmUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaXRlbSwgd2hlcmUsIHtcbiAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXJnQXJyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvY0ZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgYXJnQXJyLmZvckVhY2goZnVuY3Rpb24gKGFyZ0l0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpc05vZGUgPSBhcmdJdGVtIGluc3RhbmNlb2YgTm9kZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvY0ZyYWcuYXBwZW5kQ2hpbGQoaXNOb2RlID8gYXJnSXRlbSA6IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKFN0cmluZyhhcmdJdGVtKSkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAod2hlcmUgPT09ICdwcmVwZW5kJylcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zZXJ0QmVmb3JlKGRvY0ZyYWcsIHRoaXMuZmlyc3RDaGlsZCk7XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQoZG9jRnJhZyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoW0VsZW1lbnQucHJvdG90eXBlLCBEb2N1bWVudC5wcm90b3R5cGUsIERvY3VtZW50RnJhZ21lbnQucHJvdG90eXBlXSk7XG5cbnZhciBub3JtYWxpemVFbGVtZW50cyA9IGZ1bmN0aW9uKHMpe1xuICAgIHZhciByZXN1bHQ7XG5cbiAgICBpZiAodHlwZW9mIHMgPT09IFwic3RyaW5nXCIpIHJlc3VsdCA9ICQuaXNTZWxlY3RvcihzKSA/ICQocykgOiAkLnBhcnNlSFRNTChzKTtcbiAgICBlbHNlIGlmIChzIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHJlc3VsdCA9IFtzXTtcbiAgICBlbHNlIGlmIChpc0FycmF5TGlrZShzKSkgcmVzdWx0ID0gcztcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcblxuJC5mbi5leHRlbmQoe1xuXG4gICAgYXBwZW5kVGV4dDogZnVuY3Rpb24odGV4dCl7XG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZWxJbmRleCwgZWwpe1xuICAgICAgICAgICAgZWwuaW5uZXJIVE1MICs9IHRleHQ7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBwcmVwZW5kVGV4dDogZnVuY3Rpb24odGV4dCl7XG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZWxJbmRleCwgZWwpe1xuICAgICAgICAgICAgZWwuaW5uZXJIVE1MID0gdGV4dCArIGVsLmlubmVySFRNTDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFwcGVuZDogZnVuY3Rpb24oZWxlbWVudHMpe1xuICAgICAgICB2YXIgX2VsZW1lbnRzID0gbm9ybWFsaXplRWxlbWVudHMoZWxlbWVudHMpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZWxJbmRleCwgZWwpe1xuICAgICAgICAgICAgJC5lYWNoKF9lbGVtZW50cywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAoZWwgPT09IHRoaXMpIHJldHVybiA7XG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkID0gZWxJbmRleCA9PT0gMCA/IHRoaXMgOiB0aGlzLmNsb25lTm9kZSh0cnVlKTtcbiAgICAgICAgICAgICAgICAkLnNjcmlwdChjaGlsZCk7XG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkLnRhZ05hbWUgJiYgY2hpbGQudGFnTmFtZSAhPT0gXCJTQ1JJUFRcIikgZWwuYXBwZW5kKGNoaWxkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYXBwZW5kVG86IGZ1bmN0aW9uKGVsZW1lbnRzKXtcbiAgICAgICAgdmFyIF9lbGVtZW50cyA9IG5vcm1hbGl6ZUVsZW1lbnRzKGVsZW1lbnRzKTtcblxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWwgPSB0aGlzO1xuICAgICAgICAgICAgJC5lYWNoKF9lbGVtZW50cywgZnVuY3Rpb24ocGFySW5kZXgsIHBhcmVudCl7XG4gICAgICAgICAgICAgICAgaWYgKGVsID09PSB0aGlzKSByZXR1cm4gO1xuICAgICAgICAgICAgICAgIHBhcmVudC5hcHBlbmQocGFySW5kZXggPT09IDAgPyBlbCA6IGVsLmNsb25lTm9kZSh0cnVlKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHByZXBlbmQ6IGZ1bmN0aW9uKGVsZW1lbnRzKXtcbiAgICAgICAgdmFyIF9lbGVtZW50cyA9IG5vcm1hbGl6ZUVsZW1lbnRzKGVsZW1lbnRzKTtcblxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uIChlbEluZGV4LCBlbCkge1xuICAgICAgICAgICAgJC5lYWNoKF9lbGVtZW50cywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAoZWwgPT09IHRoaXMpIHJldHVybiA7XG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkID0gZWxJbmRleCA9PT0gMCA/IHRoaXMgOiB0aGlzLmNsb25lTm9kZSh0cnVlKTtcbiAgICAgICAgICAgICAgICAkLnNjcmlwdChjaGlsZCk7XG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkLnRhZ05hbWUgJiYgY2hpbGQudGFnTmFtZSAhPT0gXCJTQ1JJUFRcIikgZWwucHJlcGVuZChjaGlsZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHByZXBlbmRUbzogZnVuY3Rpb24oZWxlbWVudHMpe1xuICAgICAgICB2YXIgX2VsZW1lbnRzID0gbm9ybWFsaXplRWxlbWVudHMoZWxlbWVudHMpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbCA9IHRoaXM7XG4gICAgICAgICAgICAkLmVhY2goX2VsZW1lbnRzLCBmdW5jdGlvbihwYXJJbmRleCwgcGFyZW50KXtcbiAgICAgICAgICAgICAgICBpZiAoZWwgPT09IHRoaXMpIHJldHVybiA7XG4gICAgICAgICAgICAgICAgJChwYXJlbnQpLnByZXBlbmQocGFySW5kZXggPT09IDAgPyBlbCA6IGVsLmNsb25lTm9kZSh0cnVlKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGluc2VydEJlZm9yZTogZnVuY3Rpb24oZWxlbWVudHMpe1xuICAgICAgICB2YXIgX2VsZW1lbnRzID0gbm9ybWFsaXplRWxlbWVudHMoZWxlbWVudHMpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbCA9IHRoaXM7XG4gICAgICAgICAgICAkLmVhY2goX2VsZW1lbnRzLCBmdW5jdGlvbihlbEluZGV4KXtcbiAgICAgICAgICAgICAgICBpZiAoZWwgPT09IHRoaXMpIHJldHVybiA7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMucGFyZW50Tm9kZTtcbiAgICAgICAgICAgICAgICBpZiAocGFyZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoZWxJbmRleCA9PT0gMCA/IGVsIDogZWwuY2xvbmVOb2RlKHRydWUpLCB0aGlzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGluc2VydEFmdGVyOiBmdW5jdGlvbihlbGVtZW50cyl7XG4gICAgICAgIHZhciBfZWxlbWVudHMgPSBub3JtYWxpemVFbGVtZW50cyhlbGVtZW50cyk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsID0gdGhpcztcbiAgICAgICAgICAgICQuZWFjaChfZWxlbWVudHMsIGZ1bmN0aW9uKGVsSW5kZXgsIGVsZW1lbnQpe1xuICAgICAgICAgICAgICAgIGlmIChlbCA9PT0gdGhpcykgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5wYXJlbnROb2RlO1xuICAgICAgICAgICAgICAgIGlmIChwYXJlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50Lmluc2VydEJlZm9yZShlbEluZGV4ID09PSAwID8gZWwgOiBlbC5jbG9uZU5vZGUodHJ1ZSksIGVsZW1lbnQubmV4dFNpYmxpbmcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYWZ0ZXI6IGZ1bmN0aW9uKGh0bWwpe1xuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWwgPSB0aGlzO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBodG1sID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgZWwuaW5zZXJ0QWRqYWNlbnRIVE1MKCdhZnRlcmVuZCcsIGh0bWwpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKGh0bWwpLmluc2VydEFmdGVyKGVsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGJlZm9yZTogZnVuY3Rpb24oaHRtbCl7XG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbCA9IHRoaXM7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGh0bWwgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICBlbC5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWJlZ2luJywgaHRtbCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQoaHRtbCkuaW5zZXJ0QmVmb3JlKGVsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGNsb25lOiBmdW5jdGlvbihkZWVwLCB3aXRoRGF0YSl7XG4gICAgICAgIHZhciByZXMgPSBbXTtcbiAgICAgICAgaWYgKG5vdChkZWVwKSkge1xuICAgICAgICAgICAgZGVlcCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub3Qod2l0aERhdGEpKSB7XG4gICAgICAgICAgICB3aXRoRGF0YSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsID0gdGhpcy5jbG9uZU5vZGUoZGVlcCk7XG4gICAgICAgICAgICB2YXIgJGVsID0gJChlbCk7XG4gICAgICAgICAgICB2YXIgZGF0YTtcbiAgICAgICAgICAgIGlmICh3aXRoRGF0YSAmJiAkLmhhc0RhdGEodGhpcykpIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gJCh0aGlzKS5kYXRhKCk7XG4gICAgICAgICAgICAgICAgJC5lYWNoKGRhdGEsIGZ1bmN0aW9uKGssIHYpe1xuICAgICAgICAgICAgICAgICAgICAkZWwuZGF0YShrLCB2KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlcy5wdXNoKGVsKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiAkLm1lcmdlKCQoKSwgcmVzKTtcbiAgICB9LFxuXG4gICAgaW1wb3J0OiBmdW5jdGlvbihkZWVwKXtcbiAgICAgICAgdmFyIHJlcyA9IFtdO1xuICAgICAgICBpZiAobm90KGRlZXApKSB7XG4gICAgICAgICAgICBkZWVwID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXMucHVzaChkb2N1bWVudC5pbXBvcnROb2RlKHRoaXMsIGRlZXApKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiAkLm1lcmdlKCQoKSwgcmVzKTtcbiAgICB9LFxuXG4gICAgYWRvcHQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciByZXMgPSBbXTtcbiAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXMucHVzaChkb2N1bWVudC5hZG9wdE5vZGUodGhpcykpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuICQubWVyZ2UoJCgpLCByZXMpO1xuICAgIH0sXG5cbiAgICByZW1vdmU6IGZ1bmN0aW9uKHNlbGVjdG9yKXtcbiAgICAgICAgdmFyIGkgPSAwLCBub2RlLCBvdXQsIHJlcyA9IFtdO1xuXG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgfVxuXG4gICAgICAgIG91dCA9IHNlbGVjdG9yID8gdGhpcy5maWx0ZXIoZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXMuY2FsbChlbCwgc2VsZWN0b3IpO1xuICAgICAgICB9KSA6IHRoaXMuaXRlbXMoKTtcblxuICAgICAgICBmb3IgKCA7ICggbm9kZSA9IG91dFsgaSBdICkgIT0gbnVsbDsgaSsrICkge1xuICAgICAgICAgICAgaWYgKG5vZGUucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgICAgIHJlcy5wdXNoKG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKSk7XG4gICAgICAgICAgICAgICAgJC5yZW1vdmVEYXRhKG5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICQubWVyZ2UoJCgpLCByZXMpO1xuICAgIH0sXG5cbiAgICB3cmFwOiBmdW5jdGlvbiggZWwgKXtcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHdyYXBwZXIgPSAkKG5vcm1hbGl6ZUVsZW1lbnRzKGVsKSk7XG5cbiAgICAgICAgaWYgKCF3cmFwcGVyLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciByZXMgPSBbXTtcblxuICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBfdGFyZ2V0LCBfd3JhcHBlcjtcblxuICAgICAgICAgICAgX3dyYXBwZXIgPSB3cmFwcGVyLmNsb25lKHRydWUsIHRydWUpO1xuICAgICAgICAgICAgX3dyYXBwZXIuaW5zZXJ0QmVmb3JlKHRoaXMpO1xuXG4gICAgICAgICAgICBfdGFyZ2V0ID0gX3dyYXBwZXI7XG4gICAgICAgICAgICB3aGlsZSAoX3RhcmdldC5jaGlsZHJlbigpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIF90YXJnZXQgPSBfdGFyZ2V0LmNoaWxkcmVuKCkuZXEoMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfdGFyZ2V0LmFwcGVuZCh0aGlzKTtcblxuICAgICAgICAgICAgcmVzLnB1c2goX3dyYXBwZXIpO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gJChyZXMpO1xuICAgIH0sXG5cbiAgICB3cmFwQWxsOiBmdW5jdGlvbiggZWwgKXtcbiAgICAgICAgdmFyIHdyYXBwZXIsIF93cmFwcGVyLCBfdGFyZ2V0O1xuXG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgfVxuXG4gICAgICAgIHdyYXBwZXIgPSAkKG5vcm1hbGl6ZUVsZW1lbnRzKGVsKSk7XG5cbiAgICAgICAgaWYgKCF3cmFwcGVyLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgfVxuXG4gICAgICAgIF93cmFwcGVyID0gd3JhcHBlci5jbG9uZSh0cnVlLCB0cnVlKTtcbiAgICAgICAgX3dyYXBwZXIuaW5zZXJ0QmVmb3JlKHRoaXNbMF0pO1xuXG4gICAgICAgIF90YXJnZXQgPSBfd3JhcHBlcjtcbiAgICAgICAgd2hpbGUgKF90YXJnZXQuY2hpbGRyZW4oKS5sZW5ndGgpIHtcbiAgICAgICAgICAgIF90YXJnZXQgPSBfdGFyZ2V0LmNoaWxkcmVuKCkuZXEoMCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIF90YXJnZXQuYXBwZW5kKHRoaXMpO1xuICAgICAgICB9KVxuXG4gICAgICAgIHJldHVybiBfd3JhcHBlcjtcbiAgICB9LFxuXG4gICAgd3JhcElubmVyOiBmdW5jdGlvbiggZWwgKXtcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHdyYXBwZXIgPSAkKG5vcm1hbGl6ZUVsZW1lbnRzKGVsKSk7XG5cbiAgICAgICAgaWYgKCF3cmFwcGVyLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciByZXMgPSBbXTtcblxuICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtID0gJCh0aGlzKTtcbiAgICAgICAgICAgIHZhciBodG1sID0gZWxlbS5odG1sKCk7XG4gICAgICAgICAgICB2YXIgd3JwID0gd3JhcHBlci5jbG9uZSh0cnVlLCB0cnVlKTtcbiAgICAgICAgICAgIGVsZW0uaHRtbCh3cnAuaHRtbChodG1sKSk7XG4gICAgICAgICAgICByZXMucHVzaCh3cnApO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gJChyZXMpO1xuICAgIH1cbn0pO1xuXG4vLyBTb3VyY2U6IHNyYy9hbmltYXRpb24uanNcblxuLyogZ2xvYmFsICQsIG5vdCwgY2FtZWxDYXNlLCBwYXJzZVVuaXQsIFByb21pc2UsIGdldFVuaXQsIG1hdGNoZXMgKi9cblxuJC5leHRlbmQoe1xuICAgIGFuaW1hdGlvbjoge1xuICAgICAgICBkdXJhdGlvbjogMTAwMCxcbiAgICAgICAgZWFzZTogXCJsaW5lYXJcIixcbiAgICAgICAgZWxlbWVudHM6IHt9XG4gICAgfVxufSk7XG5cbmlmICh0eXBlb2Ygd2luZG93W1wic2V0dXBBbmltYXRpb25cIl0gPT09ICdvYmplY3QnKSB7XG4gICAgJC5lYWNoKHdpbmRvd1tcInNldHVwQW5pbWF0aW9uXCJdLCBmdW5jdGlvbihrZXksIHZhbCl7XG4gICAgICAgIGlmICh0eXBlb2YgJC5hbmltYXRpb25ba2V5XSAhPT0gXCJ1bmRlZmluZWRcIiAmJiAhbm90KHZhbCkpXG4gICAgICAgICAgICAkLmFuaW1hdGlvbltrZXldID0gdmFsO1xuICAgIH0pO1xufVxuXG52YXIgdHJhbnNmb3JtUHJvcHMgPSBbJ3RyYW5zbGF0ZVgnLCAndHJhbnNsYXRlWScsICd0cmFuc2xhdGVaJywgJ3JvdGF0ZScsICdyb3RhdGVYJywgJ3JvdGF0ZVknLCAncm90YXRlWicsICdzY2FsZScsICdzY2FsZVgnLCAnc2NhbGVZJywgJ3NjYWxlWicsICdza2V3JywgJ3NrZXdYJywgJ3NrZXdZJ107XG52YXIgbnVtYmVyUHJvcHMgPSBbJ29wYWNpdHknLCAnekluZGV4J107XG52YXIgZmxvYXRQcm9wcyA9IFsnb3BhY2l0eScsICd2b2x1bWUnXTtcbnZhciBzY3JvbGxQcm9wcyA9IFtcInNjcm9sbExlZnRcIiwgXCJzY3JvbGxUb3BcIl07XG52YXIgcmV2ZXJzZVByb3BzID0gW1wib3BhY2l0eVwiLCBcInZvbHVtZVwiXTtcblxuZnVuY3Rpb24gX3ZhbGlkRWxlbWVudChlbCkge1xuICAgIHJldHVybiBlbCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50IHx8IGVsIGluc3RhbmNlb2YgU1ZHRWxlbWVudDtcbn1cblxuLyoqXG4gKlxuICogQHBhcmFtIHRvXG4gKiBAcGFyYW0gZnJvbVxuICogQHJldHVybnMgeyp9XG4gKiBAcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBfZ2V0UmVsYXRpdmVWYWx1ZSAodG8sIGZyb20pIHtcbiAgICB2YXIgb3BlcmF0b3IgPSAvXihcXCo9fFxcKz18LT0pLy5leGVjKHRvKTtcbiAgICBpZiAoIW9wZXJhdG9yKSByZXR1cm4gdG87XG4gICAgdmFyIHUgPSBnZXRVbml0KHRvKSB8fCAwO1xuICAgIHZhciB4ID0gcGFyc2VGbG9hdChmcm9tKTtcbiAgICB2YXIgeSA9IHBhcnNlRmxvYXQodG8ucmVwbGFjZShvcGVyYXRvclswXSwgJycpKTtcbiAgICBzd2l0Y2ggKG9wZXJhdG9yWzBdWzBdKSB7XG4gICAgICAgIGNhc2UgJysnOlxuICAgICAgICAgICAgcmV0dXJuIHggKyB5ICsgdTtcbiAgICAgICAgY2FzZSAnLSc6XG4gICAgICAgICAgICByZXR1cm4geCAtIHkgKyB1O1xuICAgICAgICBjYXNlICcqJzpcbiAgICAgICAgICAgIHJldHVybiB4ICogeSArIHU7XG4gICAgICAgIGNhc2UgJy8nOlxuICAgICAgICAgICAgcmV0dXJuIHggLyB5ICsgdTtcbiAgICB9XG59XG5cbi8qKlxuICpcbiAqIEBwYXJhbSBlbFxuICogQHBhcmFtIHByb3BcbiAqIEBwYXJhbSBwc2V1ZG9cbiAqIEByZXR1cm5zIHsqfG51bWJlcnxzdHJpbmd9XG4gKiBAcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBfZ2V0U3R5bGUgKGVsLCBwcm9wLCBwc2V1ZG8pe1xuICAgIGlmICh0eXBlb2YgZWxbcHJvcF0gIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgaWYgKHNjcm9sbFByb3BzLmluZGV4T2YocHJvcCkgPiAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIHByb3AgPT09IFwic2Nyb2xsTGVmdFwiID8gZWwgPT09IHdpbmRvdyA/IHBhZ2VYT2Zmc2V0IDogZWwuc2Nyb2xsTGVmdCA6IGVsID09PSB3aW5kb3cgPyBwYWdlWU9mZnNldCA6IGVsLnNjcm9sbFRvcDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBlbFtwcm9wXSB8fCAwO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGVsLnN0eWxlW3Byb3BdIHx8IGdldENvbXB1dGVkU3R5bGUoZWwsIHBzZXVkbylbcHJvcF07XG59XG5cbi8qKlxuICpcbiAqIEBwYXJhbSBlbFxuICogQHBhcmFtIGtleVxuICogQHBhcmFtIHZhbFxuICogQHBhcmFtIHVuaXRcbiAqIEBwYXJhbSB0b0ludFxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gX3NldFN0eWxlIChlbCwga2V5LCB2YWwsIHVuaXQsIHRvSW50KSB7XG5cbiAgICBpZiAobm90KHRvSW50KSkge1xuICAgICAgICB0b0ludCA9IGZhbHNlO1xuICAgIH1cblxuICAgIGtleSA9IGNhbWVsQ2FzZShrZXkpO1xuXG4gICAgaWYgKHRvSW50KSB7XG4gICAgICAgIHZhbCAgPSBwYXJzZUludCh2YWwpO1xuICAgIH1cblxuICAgIGlmIChfdmFsaWRFbGVtZW50KGVsKSkge1xuICAgICAgICBpZiAodHlwZW9mIGVsW2tleV0gIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIGVsW2tleV0gPSB2YWw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlbC5zdHlsZVtrZXldID0ga2V5ID09PSBcInRyYW5zZm9ybVwiIHx8IGtleS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ2NvbG9yJykgPiAtMSA/IHZhbCA6IHZhbCArIHVuaXQ7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBlbFtrZXldID0gdmFsO1xuICAgIH1cbn1cblxuLyoqXG4gKlxuICogQHBhcmFtIGVsXG4gKiBAcGFyYW0gbWFwUHJvcHNcbiAqIEBwYXJhbSBwXG4gKiBAcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBfYXBwbHlTdHlsZXMgKGVsLCBtYXBQcm9wcywgcCkge1xuICAgICQuZWFjaChtYXBQcm9wcywgZnVuY3Rpb24gKGtleSwgdmFsKSB7XG4gICAgICAgIF9zZXRTdHlsZShlbCwga2V5LCB2YWxbMF0gKyAodmFsWzJdICogcCksIHZhbFszXSwgdmFsWzRdKTtcbiAgICB9KTtcbn1cblxuLyoqXG4gKlxuICogQHBhcmFtIGVsXG4gKiBAcmV0dXJucyB7e319XG4gKiBAcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBfZ2V0RWxlbWVudFRyYW5zZm9ybXMgKGVsKSB7XG4gICAgaWYgKCFfdmFsaWRFbGVtZW50KGVsKSkgcmV0dXJuIHt9O1xuICAgIHZhciBzdHIgPSBlbC5zdHlsZS50cmFuc2Zvcm0gfHwgJyc7XG4gICAgdmFyIHJlZyA9IC8oXFx3KylcXCgoW14pXSopXFwpL2c7XG4gICAgdmFyIHRyYW5zZm9ybXMgPSB7fTtcbiAgICB2YXIgbTtcblxuICAgIC8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICB3aGlsZSAobSA9IHJlZy5leGVjKHN0cikpXG4gICAgICAgIHRyYW5zZm9ybXNbbVsxXV0gPSBtWzJdO1xuICAgIC8qIGpzaGludCBpZ25vcmU6ZW5kICovXG5cbiAgICByZXR1cm4gdHJhbnNmb3Jtcztcbn1cblxuLyoqXG4gKlxuICogQHBhcmFtIHZhbFxuICogQHJldHVybnMge251bWJlcltdfVxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gX2dldENvbG9yQXJyYXlGcm9tSGV4ICh2YWwpe1xuICAgIHZhciBhID0gL14jPyhbYS1mXFxkXXsyfSkoW2EtZlxcZF17Mn0pKFthLWZcXGRdezJ9KSQvaS5leGVjKHZhbCA/IHZhbCA6IFwiIzAwMDAwMFwiKTtcbiAgICByZXR1cm4gYS5zbGljZSgxKS5tYXAoZnVuY3Rpb24odikge1xuICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHYsIDE2KTtcbiAgICB9KTtcbn1cblxuLyoqXG4gKlxuICogQHBhcmFtIGVsXG4gKiBAcGFyYW0ga2V5XG4gKiBAcmV0dXJucyB7bnVtYmVyW119XG4gKiBAcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBfZ2V0Q29sb3JBcnJheUZyb21FbGVtZW50IChlbCwga2V5KSB7XG4gICAgcmV0dXJuIGdldENvbXB1dGVkU3R5bGUoZWwpW2tleV0ucmVwbGFjZSgvW15cXGQuLF0vZywgJycpLnNwbGl0KCcsJykubWFwKGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KHYpO1xuICAgIH0pO1xufVxuXG4vKipcbiAqXG4gKiBAcGFyYW0gZWxcbiAqIEBwYXJhbSBtYXBQcm9wc1xuICogQHBhcmFtIHBcbiAqIEBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIF9hcHBseVRyYW5zZm9ybSAoZWwsIG1hcFByb3BzLCBwKSB7XG4gICAgdmFyIHQgPSBbXTtcbiAgICB2YXIgZWxUcmFuc2Zvcm1zID0gX2dldEVsZW1lbnRUcmFuc2Zvcm1zKGVsKTtcblxuICAgICQuZWFjaChtYXBQcm9wcywgZnVuY3Rpb24oa2V5LCB2YWwpIHtcbiAgICAgICAgdmFyIGZyb20gPSB2YWxbMF0sIHRvID0gdmFsWzFdLCBkZWx0YSA9IHZhbFsyXSwgdW5pdCA9IHZhbFszXTtcbiAgICAgICAga2V5ID0gXCJcIiArIGtleTtcblxuICAgICAgICBpZiAoIGtleS5pbmRleE9mKFwicm90YXRlXCIpID4gLTEgfHwga2V5LmluZGV4T2YoXCJza2V3XCIpID4gLTEpIHtcbiAgICAgICAgICAgIGlmICh1bml0ID09PSBcIlwiKSB1bml0ID0gXCJkZWdcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChrZXkuaW5kZXhPZignc2NhbGUnKSA+IC0xKSB7XG4gICAgICAgICAgICB1bml0ID0gJyc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoa2V5LmluZGV4T2YoJ3RyYW5zbGF0ZScpID4gLTEgJiYgdW5pdCA9PT0gJycpIHtcbiAgICAgICAgICAgIHVuaXQgPSAncHgnO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHVuaXQgPT09IFwidHVyblwiKSB7XG4gICAgICAgICAgICB0LnB1c2goa2V5K1wiKFwiICsgKHRvICogcCkgKyB1bml0ICsgXCIpXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdC5wdXNoKGtleSArXCIoXCIgKyAoZnJvbSArIChkZWx0YSAqIHApKSArIHVuaXQrXCIpXCIpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAkLmVhY2goZWxUcmFuc2Zvcm1zLCBmdW5jdGlvbihrZXksIHZhbCkge1xuICAgICAgICBpZiAobWFwUHJvcHNba2V5XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0LnB1c2goa2V5K1wiKFwiK3ZhbCtcIilcIik7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGVsLnN0eWxlLnRyYW5zZm9ybSA9IHQuam9pbihcIiBcIik7XG59XG5cbi8qKlxuICpcbiAqIEBwYXJhbSBlbFxuICogQHBhcmFtIG1hcFByb3BzXG4gKiBAcGFyYW0gcFxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gX2FwcGx5Q29sb3JzIChlbCwgbWFwUHJvcHMsIHApIHtcbiAgICAkLmVhY2gobWFwUHJvcHMsIGZ1bmN0aW9uIChrZXksIHZhbCkge1xuICAgICAgICB2YXIgaSwgcmVzdWx0ID0gWzAsIDAsIDBdLCB2O1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7XG4gICAgICAgICAgICByZXN1bHRbaV0gPSBNYXRoLmZsb29yKHZhbFswXVtpXSArICh2YWxbMl1baV0gKiBwKSk7XG4gICAgICAgIH1cbiAgICAgICAgdiA9IFwicmdiKFwiKyhyZXN1bHQuam9pbihcIixcIikpK1wiKVwiO1xuICAgICAgICBlbC5zdHlsZVtrZXldID0gdjtcbiAgICB9KTtcbn1cblxuLyoqXG4gKlxuICogQHBhcmFtIHZhbFxuICogQHJldHVybnMge3N0cmluZ3wqfVxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gX2V4cGFuZENvbG9yVmFsdWUgKHZhbCkge1xuICAgIHZhciByZWdFeHAgPSAvXiM/KFthLWZcXGRdKShbYS1mXFxkXSkoW2EtZlxcZF0pJC9pO1xuICAgIGlmICh2YWxbMF0gPT09IFwiI1wiICYmIHZhbC5sZW5ndGggPT09IDQpIHtcbiAgICAgICAgcmV0dXJuIFwiI1wiICsgdmFsLnJlcGxhY2UocmVnRXhwLCBmdW5jdGlvbihtLCByLCBnLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gciArIHIgKyBnICsgZyArIGIgKyBiO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbFswXSA9PT0gXCIjXCIgPyB2YWwgOiBcIiNcIit2YWw7XG59XG5cbi8qKlxuICpcbiAqIEBwYXJhbSBlbFxuICogQHBhcmFtIG1hcFxuICogQHBhcmFtIHBcbiAqL1xuZnVuY3Rpb24gYXBwbHlQcm9wcyAoZWwsIG1hcCwgcCkge1xuICAgIF9hcHBseVN0eWxlcyhlbCwgbWFwLnByb3BzLCBwKTtcbiAgICBfYXBwbHlUcmFuc2Zvcm0oZWwsIG1hcC50cmFuc2Zvcm0sIHApO1xuICAgIF9hcHBseUNvbG9ycyhlbCwgbWFwLmNvbG9yLCBwKTtcbn1cblxuLyoqXG4gKlxuICogQHBhcmFtIGVsXG4gKiBAcGFyYW0gZHJhd1xuICogQHBhcmFtIGRpclxuICogQHJldHVybnMge3t0cmFuc2Zvcm06IHt9LCBjb2xvcjoge30sIHByb3BzOiB7fX19XG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZUFuaW1hdGlvbk1hcCAoZWwsIGRyYXcsIGRpcikge1xuICAgIHZhciBtYXAgPSB7XG4gICAgICAgIHByb3BzOiB7fSxcbiAgICAgICAgdHJhbnNmb3JtOiB7fSxcbiAgICAgICAgY29sb3I6IHt9XG4gICAgfTtcbiAgICB2YXIgaSwgZnJvbSwgdG8sIGRlbHRhLCB1bml0LCB0ZW1wO1xuICAgIHZhciBlbFRyYW5zZm9ybXMgPSBfZ2V0RWxlbWVudFRyYW5zZm9ybXMoZWwpO1xuXG4gICAgaWYgKG5vdChkaXIpKSB7XG4gICAgICAgIGRpciA9IFwibm9ybWFsXCI7XG4gICAgfVxuXG4gICAgJC5lYWNoKGRyYXcsIGZ1bmN0aW9uKGtleSwgdmFsKSB7XG5cbiAgICAgICAgdmFyIGlzVHJhbnNmb3JtUHJvcCA9IHRyYW5zZm9ybVByb3BzLmluZGV4T2YoXCJcIitrZXkpID4gLTE7XG4gICAgICAgIHZhciBpc051bVByb3AgPSBudW1iZXJQcm9wcy5pbmRleE9mKFwiXCIra2V5KSA+IC0xO1xuICAgICAgICB2YXIgaXNDb2xvclByb3AgPSAoXCJcIitrZXkpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcImNvbG9yXCIpID4gLTE7XG5cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsKSAmJiB2YWwubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICB2YWwgPSB2YWxbMF07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsKSkge1xuICAgICAgICAgICAgaWYgKGlzVHJhbnNmb3JtUHJvcCkge1xuICAgICAgICAgICAgICAgIGZyb20gPSBlbFRyYW5zZm9ybXNba2V5XSB8fCAwO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpc0NvbG9yUHJvcCkge1xuICAgICAgICAgICAgICAgIGZyb20gPSBfZ2V0Q29sb3JBcnJheUZyb21FbGVtZW50KGVsLCBrZXkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmcm9tID0gX2dldFN0eWxlKGVsLCBrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZnJvbSA9ICFpc0NvbG9yUHJvcCA/IHBhcnNlVW5pdChmcm9tKSA6IGZyb207XG4gICAgICAgICAgICB0byA9ICFpc0NvbG9yUHJvcCA/IHBhcnNlVW5pdChfZ2V0UmVsYXRpdmVWYWx1ZSh2YWwsIEFycmF5LmlzQXJyYXkoZnJvbSkgPyBmcm9tWzBdIDogZnJvbSkpIDogX2dldENvbG9yQXJyYXlGcm9tSGV4KHZhbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmcm9tID0gIWlzQ29sb3JQcm9wID8gcGFyc2VVbml0KHZhbFswXSkgOiBfZ2V0Q29sb3JBcnJheUZyb21IZXgoX2V4cGFuZENvbG9yVmFsdWUodmFsWzBdKSk7XG4gICAgICAgICAgICB0byA9ICFpc0NvbG9yUHJvcCA/IHBhcnNlVW5pdCh2YWxbMV0pIDogX2dldENvbG9yQXJyYXlGcm9tSGV4KF9leHBhbmRDb2xvclZhbHVlKHZhbFsxXSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHJldmVyc2VQcm9wcy5pbmRleE9mKFwiXCIra2V5KSA+IC0xICYmIGZyb21bMF0gPT09IHRvWzBdKSB7XG4gICAgICAgICAgICBmcm9tWzBdID0gdG9bMF0gPiAwID8gMCA6IDE7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGlyID09PSBcInJldmVyc2VcIikge1xuICAgICAgICAgICAgdGVtcCA9IGZyb207XG4gICAgICAgICAgICBmcm9tID0gdG87XG4gICAgICAgICAgICB0byA9IHRlbXA7XG4gICAgICAgIH1cblxuICAgICAgICB1bml0ID0gZWwgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCAmJiB0b1sxXSA9PT0gJycgJiYgIWlzTnVtUHJvcCAmJiAhaXNUcmFuc2Zvcm1Qcm9wID8gJ3B4JyA6IHRvWzFdO1xuXG4gICAgICAgIGlmIChpc0NvbG9yUHJvcCkge1xuICAgICAgICAgICAgZGVsdGEgPSBbMCwgMCwgMF07XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7XG4gICAgICAgICAgICAgICAgZGVsdGFbaV0gPSB0b1tpXSAtIGZyb21baV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkZWx0YSA9IHRvWzBdIC0gZnJvbVswXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpc1RyYW5zZm9ybVByb3ApIHtcbiAgICAgICAgICAgIG1hcC50cmFuc2Zvcm1ba2V5XSA9IFtmcm9tWzBdLCB0b1swXSwgZGVsdGEsIHVuaXRdO1xuICAgICAgICB9IGVsc2UgaWYgKGlzQ29sb3JQcm9wKSB7XG4gICAgICAgICAgICBtYXAuY29sb3Jba2V5XSA9IFtmcm9tLCB0bywgZGVsdGEsIHVuaXRdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbWFwLnByb3BzW2tleV0gPSBbZnJvbVswXSwgdG9bMF0sIGRlbHRhLCB1bml0LCBmbG9hdFByb3BzLmluZGV4T2YoXCJcIitrZXkpID09PSAtMV07XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBtYXA7XG59XG5cbmZ1bmN0aW9uIG1pbk1heCh2YWwsIG1pbiwgbWF4KSB7XG4gICAgcmV0dXJuIE1hdGgubWluKE1hdGgubWF4KHZhbCwgbWluKSwgbWF4KTtcbn1cblxudmFyIEVhc2luZyA9IHtcbiAgICBsaW5lYXI6IGZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKHQpIHtyZXR1cm4gdDt9O31cbn07XG5cbkVhc2luZy5kZWZhdWx0ID0gRWFzaW5nLmxpbmVhcjtcblxudmFyIGVhc2VzID0ge1xuICAgIFNpbmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0KXtcbiAgICAgICAgICAgIHJldHVybiAxIC0gTWF0aC5jb3ModCAqIE1hdGguUEkgLyAyKTtcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIENpcmM6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0KXtcbiAgICAgICAgICAgIHJldHVybiAxIC0gTWF0aC5zcXJ0KDEgLSB0ICogdCk7XG4gICAgICAgIH07XG4gICAgfSxcbiAgICBCYWNrOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24odCl7XG4gICAgICAgICAgICByZXR1cm4gdCAqIHQgKiAoMyAqIHQgLSAyKTtcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIEJvdW5jZTogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQpe1xuICAgICAgICAgICAgdmFyIHBvdzIsIGIgPSA0O1xuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICAgICAgICB3aGlsZSAodCA8ICgoIHBvdzIgPSBNYXRoLnBvdygyLCAtLWIpKSAtIDEpIC8gMTEpIHt9XG4gICAgICAgICAgICByZXR1cm4gMSAvIE1hdGgucG93KDQsIDMgLSBiKSAtIDcuNTYyNSAqIE1hdGgucG93KCggcG93MiAqIDMgLSAyICkgLyAyMiAtIHQsIDIpO1xuICAgICAgICB9O1xuICAgIH0sXG4gICAgRWxhc3RpYzogZnVuY3Rpb24oYW1wbGl0dWRlLCBwZXJpb2Qpe1xuICAgICAgICBpZiAobm90KGFtcGxpdHVkZSkpIHtcbiAgICAgICAgICAgIGFtcGxpdHVkZSA9IDE7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobm90KHBlcmlvZCkpIHtcbiAgICAgICAgICAgIHBlcmlvZCA9IDAuNTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgYSA9IG1pbk1heChhbXBsaXR1ZGUsIDEsIDEwKTtcbiAgICAgICAgdmFyIHAgPSBtaW5NYXgocGVyaW9kLCAwLjEsIDIpO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24odCl7XG4gICAgICAgICAgICByZXR1cm4gKHQgPT09IDAgfHwgdCA9PT0gMSkgPyB0IDpcbiAgICAgICAgICAgICAgICAtYSAqIE1hdGgucG93KDIsIDEwICogKHQgLSAxKSkgKiBNYXRoLnNpbigoKCh0IC0gMSkgLSAocCAvIChNYXRoLlBJICogMikgKiBNYXRoLmFzaW4oMSAvIGEpKSkgKiAoTWF0aC5QSSAqIDIpKSAvIHApO1xuICAgICAgICB9O1xuICAgIH1cbn07XG5cblsnUXVhZCcsICdDdWJpYycsICdRdWFydCcsICdRdWludCcsICdFeHBvJ10uZm9yRWFjaChmdW5jdGlvbihuYW1lLCBpKSB7XG4gICAgZWFzZXNbbmFtZV0gPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24odCl7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5wb3codCwgaSArIDIpO1xuICAgICAgICB9O1xuICAgIH07XG59KTtcblxuT2JqZWN0LmtleXMoZWFzZXMpLmZvckVhY2goZnVuY3Rpb24obmFtZSkge1xuICAgIHZhciBlYXNlSW4gPSBlYXNlc1tuYW1lXTtcbiAgICBFYXNpbmdbJ2Vhc2VJbicgKyBuYW1lXSA9IGVhc2VJbjtcbiAgICBFYXNpbmdbJ2Vhc2VPdXQnICsgbmFtZV0gPSBmdW5jdGlvbihhLCBiKXtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQpe1xuICAgICAgICAgICAgcmV0dXJuIDEgLSBlYXNlSW4oYSwgYikoMSAtIHQpO1xuICAgICAgICB9O1xuICAgIH07XG4gICAgRWFzaW5nWydlYXNlSW5PdXQnICsgbmFtZV0gPSBmdW5jdGlvbihhLCBiKXtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQpe1xuICAgICAgICAgICAgcmV0dXJuIHQgPCAwLjUgPyBlYXNlSW4oYSwgYikodCAqIDIpIC8gMiA6IDEgLSBlYXNlSW4oYSwgYikodCAqIC0yICsgMikgLyAyO1xuICAgICAgICB9O1xuICAgIH07XG59KTtcblxudmFyIGRlZmF1bHRBbmltYXRpb25Qcm9wcyA9IHtcbiAgICBpZDogbnVsbCxcbiAgICBlbDogbnVsbCxcbiAgICBkcmF3OiB7fSxcbiAgICBkdXI6ICQuYW5pbWF0aW9uLmR1cmF0aW9uLFxuICAgIGVhc2U6ICQuYW5pbWF0aW9uLmVhc2UsXG4gICAgbG9vcDogMCxcbiAgICBwYXVzZTogMCxcbiAgICBkaXI6IFwibm9ybWFsXCIsXG4gICAgZGVmZXI6IDAsXG4gICAgb25TdGFydDogZnVuY3Rpb24oKXt9LFxuICAgIG9uU3RvcDogZnVuY3Rpb24oKXt9LFxuICAgIG9uU3RvcEFsbDogZnVuY3Rpb24oKXt9LFxuICAgIG9uUGF1c2U6IGZ1bmN0aW9uKCl7fSxcbiAgICBvblBhdXNlQWxsOiBmdW5jdGlvbigpe30sXG4gICAgb25SZXN1bWU6IGZ1bmN0aW9uKCl7fSxcbiAgICBvblJlc3VtZUFsbDogZnVuY3Rpb24oKXt9LFxuICAgIG9uRnJhbWU6IGZ1bmN0aW9uKCl7fSxcbiAgICBvbkRvbmU6IGZ1bmN0aW9uKCl7fVxufTtcblxuZnVuY3Rpb24gYW5pbWF0ZShhcmdzKXtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSl7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIHByb3BzID0gJC5hc3NpZ24oe30sIGRlZmF1bHRBbmltYXRpb25Qcm9wcywge2R1cjogJC5hbmltYXRpb24uZHVyYXRpb24sIGVhc2U6ICQuYW5pbWF0aW9uLmVhc2V9LCBhcmdzKTtcbiAgICAgICAgdmFyIGlkID0gcHJvcHMuaWQsIGVsID0gcHJvcHMuZWwsIGRyYXcgPSBwcm9wcy5kcmF3LCBkdXIgPSBwcm9wcy5kdXIsIGVhc2UgPSBwcm9wcy5lYXNlLCBsb29wID0gcHJvcHMubG9vcCxcbiAgICAgICAgICAgIG9uU3RhcnQgPSBwcm9wcy5vblN0YXJ0LCBvbkZyYW1lID0gcHJvcHMub25GcmFtZSwgb25Eb25lID0gcHJvcHMub25Eb25lLFxuICAgICAgICAgICAgcGF1c2VTdGFydCA9IHByb3BzLnBhdXNlLCBkaXIgPSBwcm9wcy5kaXIsIGRlZmVyID0gcHJvcHMuZGVmZXI7XG4gICAgICAgIHZhciBtYXAgPSB7fTtcbiAgICAgICAgdmFyIGVhc2VOYW1lID0gXCJsaW5lYXJcIiwgZWFzZUFyZ3MgPSBbXSwgZWFzZUZuID0gRWFzaW5nLmxpbmVhciwgbWF0Y2hBcmdzO1xuICAgICAgICB2YXIgZGlyZWN0aW9uID0gZGlyID09PSBcImFsdGVybmF0ZVwiID8gXCJub3JtYWxcIiA6IGRpcjtcbiAgICAgICAgdmFyIHJlcGxheSA9IGZhbHNlO1xuICAgICAgICB2YXIgYW5pbWF0aW9uSUQgPSBpZCA/IGlkIDogKyhwZXJmb3JtYW5jZS5ub3coKSAqIE1hdGgucG93KDEwLCAxNCkpO1xuXG4gICAgICAgIGlmIChub3QoZWwpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmtub3duIGVsZW1lbnQhXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiBlbCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGVsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2YgZHJhdyAhPT0gXCJmdW5jdGlvblwiICYmIHR5cGVvZiBkcmF3ICE9PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmtub3duIGRyYXcgb2JqZWN0LiBNdXN0IGJlIGEgZnVuY3Rpb24gb3Igb2JqZWN0IVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkdXIgPT09IDApIHtcbiAgICAgICAgICAgIGR1ciA9IDE7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGlyID09PSBcImFsdGVybmF0ZVwiICYmIHR5cGVvZiBsb29wID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgICAgICBsb29wICo9IDI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIGVhc2UgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIG1hdGNoQXJncyA9IC9cXCgoW14pXSspXFwpLy5leGVjKGVhc2UpO1xuICAgICAgICAgICAgZWFzZU5hbWUgPSBlYXNlLnNwbGl0KFwiKFwiKVswXTtcbiAgICAgICAgICAgIGVhc2VBcmdzID0gbWF0Y2hBcmdzID8gbWF0Y2hBcmdzWzFdLnNwbGl0KCcsJykubWFwKGZ1bmN0aW9uKHApe3JldHVybiBwYXJzZUZsb2F0KHApO30pIDogW107XG4gICAgICAgICAgICBlYXNlRm4gPSBFYXNpbmdbZWFzZU5hbWVdIHx8IEVhc2luZy5saW5lYXI7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGVhc2UgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgZWFzZUZuID0gZWFzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGVhc2VGbiA9IEVhc2luZy5saW5lYXI7XG4gICAgICAgIH1cblxuICAgICAgICAkLmFuaW1hdGlvbi5lbGVtZW50c1thbmltYXRpb25JRF0gPSB7XG4gICAgICAgICAgICBlbGVtZW50OiBlbCxcbiAgICAgICAgICAgIGlkOiBudWxsLFxuICAgICAgICAgICAgc3RvcDogMCxcbiAgICAgICAgICAgIHBhdXNlOiAwLFxuICAgICAgICAgICAgbG9vcDogMCxcbiAgICAgICAgICAgIHQ6IC0xLFxuICAgICAgICAgICAgc3RhcnRlZDogMCxcbiAgICAgICAgICAgIHBhdXNlZDogMFxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBwbGF5ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGRyYXcgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICAgICAgICBtYXAgPSBjcmVhdGVBbmltYXRpb25NYXAoZWwsIGRyYXcsIGRpcmVjdGlvbik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb25TdGFydCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgb25TdGFydC5hcHBseShlbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgICAgICAkLmFuaW1hdGlvbi5lbGVtZW50c1thbmltYXRpb25JRF0ubG9vcCArPSAxO1xuICAgICAgICAgICAgJC5hbmltYXRpb24uZWxlbWVudHNbYW5pbWF0aW9uSURdLnN0YXJ0ZWQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgICAgICQuYW5pbWF0aW9uLmVsZW1lbnRzW2FuaW1hdGlvbklEXS5kdXJhdGlvbiA9IGR1cjtcbiAgICAgICAgICAgICQuYW5pbWF0aW9uLmVsZW1lbnRzW2FuaW1hdGlvbklEXS5pZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZG9uZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUoJC5hbmltYXRpb24uZWxlbWVudHNbYW5pbWF0aW9uSURdLmlkKTtcbiAgICAgICAgICAgIGRlbGV0ZSAkLmFuaW1hdGlvbi5lbGVtZW50c1tpZF07XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb25Eb25lID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICBvbkRvbmUuYXBwbHkoZWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXNvbHZlKHRoYXQpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBhbmltYXRlID0gZnVuY3Rpb24odGltZSkge1xuICAgICAgICAgICAgdmFyIHAsIHQ7XG4gICAgICAgICAgICB2YXIgc3RvcCA9ICQuYW5pbWF0aW9uLmVsZW1lbnRzW2FuaW1hdGlvbklEXS5zdG9wO1xuICAgICAgICAgICAgdmFyIHBhdXNlID0gJC5hbmltYXRpb24uZWxlbWVudHNbYW5pbWF0aW9uSURdLnBhdXNlO1xuICAgICAgICAgICAgdmFyIHN0YXJ0ID0gJC5hbmltYXRpb24uZWxlbWVudHNbYW5pbWF0aW9uSURdLnN0YXJ0ZWQ7XG5cbiAgICAgICAgICAgIGlmICgkLmFuaW1hdGlvbi5lbGVtZW50c1thbmltYXRpb25JRF0ucGF1c2VkKSB7XG4gICAgICAgICAgICAgICAgc3RhcnQgPSB0aW1lIC0gJC5hbmltYXRpb24uZWxlbWVudHNbYW5pbWF0aW9uSURdLnQgKiBkdXI7XG4gICAgICAgICAgICAgICAgJC5hbmltYXRpb24uZWxlbWVudHNbYW5pbWF0aW9uSURdLnN0YXJ0ZWQgPSBzdGFydDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdCA9ICgodGltZSAtIHN0YXJ0KSAvIGR1cikudG9GaXhlZCg0KTtcblxuICAgICAgICAgICAgaWYgKHQgPiAxKSB0ID0gMTtcbiAgICAgICAgICAgIGlmICh0IDwgMCkgdCA9IDA7XG5cbiAgICAgICAgICAgIHAgPSBlYXNlRm4uYXBwbHkobnVsbCwgZWFzZUFyZ3MpKHQpO1xuXG4gICAgICAgICAgICAkLmFuaW1hdGlvbi5lbGVtZW50c1thbmltYXRpb25JRF0udCA9IHQ7XG4gICAgICAgICAgICAkLmFuaW1hdGlvbi5lbGVtZW50c1thbmltYXRpb25JRF0ucCA9IHA7XG5cbiAgICAgICAgICAgIGlmIChwYXVzZSkge1xuICAgICAgICAgICAgICAgICQuYW5pbWF0aW9uLmVsZW1lbnRzW2FuaW1hdGlvbklEXS5pZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTtcbiAgICAgICAgICAgICAgICAvLyAkLmFuaW1hdGlvbi5lbGVtZW50c1thbmltYXRpb25JRF0uc3RhcnRlZCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCBzdG9wID4gMCkge1xuICAgICAgICAgICAgICAgIGlmIChzdG9wID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZHJhdyA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkcmF3LmJpbmQoZWwpKDEsIDEpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHlQcm9wcyhlbCwgbWFwLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGRyYXcgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgIGRyYXcuYmluZChlbCkodCwgcCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFwcGx5UHJvcHMoZWwsIG1hcCwgcCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb25GcmFtZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIG9uRnJhbWUuYXBwbHkoZWwsIFt0LCBwXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0IDwgMSkge1xuICAgICAgICAgICAgICAgICQuYW5pbWF0aW9uLmVsZW1lbnRzW2FuaW1hdGlvbklEXS5pZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHBhcnNlSW50KHQpID09PSAxKSB7XG4gICAgICAgICAgICAgICAgaWYgKGxvb3ApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpciA9PT0gXCJhbHRlcm5hdGVcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uID0gZGlyZWN0aW9uID09PSBcIm5vcm1hbFwiID8gXCJyZXZlcnNlXCIgOiBcIm5vcm1hbFwiO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBsb29wID09PSBcImJvb2xlYW5cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgcGF1c2VTdGFydCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9vcCA+ICQuYW5pbWF0aW9uLmVsZW1lbnRzW2FuaW1hdGlvbklEXS5sb29wKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBwYXVzZVN0YXJ0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpciA9PT0gXCJhbHRlcm5hdGVcIiAmJiAhcmVwbGF5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBkaXJlY3Rpb24gPT09IFwibm9ybWFsXCIgPyBcInJldmVyc2VcIiA6IFwibm9ybWFsXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXBsYXkgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGxheSgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBpZiAoZGVmZXIgPiAwKSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsYXkoKTtcbiAgICAgICAgICAgIH0sIGRlZmVyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBsYXkoKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG4vLyBTdG9wIGFuaW1hdGlvblxuZnVuY3Rpb24gc3RvcEFuaW1hdGlvbihpZCwgZG9uZSl7XG4gICAgdmFyIGFuID0gJC5hbmltYXRpb24uZWxlbWVudHNbaWRdO1xuXG4gICAgaWYgKHR5cGVvZiBhbiA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICByZXR1cm4gO1xuICAgIH1cblxuICAgIGlmIChub3QoZG9uZSkpIHtcbiAgICAgICAgZG9uZSA9IHRydWU7XG4gICAgfVxuXG4gICAgYW4uc3RvcCA9IGRvbmUgPT09IHRydWUgPyAyIDogMTtcblxuICAgIGlmICh0eXBlb2YgYW4ub25TdG9wID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgYW4ub25TdG9wLmFwcGx5KGFuLmVsZW1lbnQpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gc3RvcEFuaW1hdGlvbkFsbChkb25lLCBmaWx0ZXIpe1xuICAgICQuZWFjaCgkLmFuaW1hdGlvbi5lbGVtZW50cywgZnVuY3Rpb24oaywgdil7XG4gICAgICAgIGlmIChmaWx0ZXIpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZmlsdGVyID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgaWYgKG1hdGNoZXMuY2FsbCh2LmVsZW1lbnQsIGZpbHRlcikpIHN0b3BBbmltYXRpb24oaywgZG9uZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGZpbHRlci5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAkLmVhY2goZmlsdGVyLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBpZiAodi5lbGVtZW50ID09PSB0aGlzKSBzdG9wQW5pbWF0aW9uKGssIGRvbmUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChmaWx0ZXIgaW5zdGFuY2VvZiBFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKHYuZWxlbWVudCA9PT0gZmlsdGVyKSBzdG9wQW5pbWF0aW9uKGssIGRvbmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3RvcEFuaW1hdGlvbihrLCBkb25lKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuLy8gZW5kIG9mIHN0b3BcblxuLy8gUGF1c2UgYW5kIHJlc3VtZSBhbmltYXRpb25cbmZ1bmN0aW9uIHBhdXNlQW5pbWF0aW9uKGlkKXtcbiAgICB2YXIgYW4gPSAkLmFuaW1hdGlvbi5lbGVtZW50c1tpZF07XG5cbiAgICBpZiAodHlwZW9mIGFuID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIHJldHVybiA7XG4gICAgfVxuXG4gICAgYW4ucGF1c2UgPSAxO1xuICAgIGFuLnBhdXNlZCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuXG4gICAgaWYgKHR5cGVvZiBhbi5vblBhdXNlID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgYW4ub25QYXVzZS5hcHBseShhbi5lbGVtZW50KTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHBhdXNlQW5pbWF0aW9uQWxsKGZpbHRlcil7XG4gICAgJC5lYWNoKCQuYW5pbWF0aW9uLmVsZW1lbnRzLCBmdW5jdGlvbihrLCB2KXtcbiAgICAgICAgaWYgKGZpbHRlcikge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBmaWx0ZXIgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAobWF0Y2hlcy5jYWxsKHYuZWxlbWVudCwgZmlsdGVyKSkgcGF1c2VBbmltYXRpb24oayk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGZpbHRlci5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAkLmVhY2goZmlsdGVyLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBpZiAodi5lbGVtZW50ID09PSB0aGlzKSBwYXVzZUFuaW1hdGlvbihrKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlsdGVyIGluc3RhbmNlb2YgRWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGlmICh2LmVsZW1lbnQgPT09IGZpbHRlcikgcGF1c2VBbmltYXRpb24oayk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwYXVzZUFuaW1hdGlvbihrKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuLy8gZW5kIG9mIHBhdXNlXG5cbmZ1bmN0aW9uIHJlc3VtZUFuaW1hdGlvbihpZCl7XG4gICAgdmFyIGFuID0gJC5hbmltYXRpb24uZWxlbWVudHNbaWRdO1xuXG4gICAgaWYgKHR5cGVvZiBhbiA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICByZXR1cm4gO1xuICAgIH1cblxuICAgIGFuLnBhdXNlID0gMDtcbiAgICBhbi5wYXVzZWQgPSAwO1xuXG4gICAgaWYgKHR5cGVvZiBhbi5vblJlc3VtZSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGFuLm9uUmVzdW1lLmFwcGx5KGFuLmVsZW1lbnQpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gcmVzdW1lQW5pbWF0aW9uQWxsKGZpbHRlcil7XG4gICAgJC5lYWNoKCQuYW5pbWF0aW9uLmVsZW1lbnRzLCBmdW5jdGlvbihrLCB2KXtcbiAgICAgICAgaWYgKGZpbHRlcikge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBmaWx0ZXIgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAobWF0Y2hlcy5jYWxsKHYuZWxlbWVudCwgZmlsdGVyKSkgcmVzdW1lQW5pbWF0aW9uKGspO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKGZpbHRlciwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHYuZWxlbWVudCA9PT0gdGhpcykgcmVzdW1lQW5pbWF0aW9uKGspO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChmaWx0ZXIgaW5zdGFuY2VvZiBFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKHYuZWxlbWVudCA9PT0gZmlsdGVyKSByZXN1bWVBbmltYXRpb24oayk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXN1bWVBbmltYXRpb24oayk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuLyogZXNsaW50LWVuYWJsZSAqL1xuXG52YXIgZGVmYXVsdENoYWluT3B0aW9ucyA9IHtcbiAgICBsb29wOiBmYWxzZSxcbiAgICBvbkNoYWluSXRlbTogbnVsbCxcbiAgICBvbkNoYWluSXRlbUNvbXBsZXRlOiBudWxsLFxuICAgIG9uQ2hhaW5Db21wbGV0ZTogbnVsbFxufVxuXG5mdW5jdGlvbiBjaGFpbihhcnIsIG9wdCl7XG4gICAgdmFyIG8gPSAkLmV4dGVuZCh7fSwgZGVmYXVsdENoYWluT3B0aW9ucywgb3B0KTtcblxuICAgIGlmICh0eXBlb2Ygby5sb29wICE9PSBcImJvb2xlYW5cIikge1xuICAgICAgICBvLmxvb3AtLTtcbiAgICB9XG5cbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoYXJyKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJDaGFpbiBhcnJheSBpcyBub3QgZGVmaW5lZCFcIik7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgcmVkdWNlciA9IGZ1bmN0aW9uKGFjYywgaXRlbSl7XG4gICAgICAgIHJldHVybiBhY2MudGhlbihmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBvW1wib25DaGFpbkl0ZW1cIl0gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgIG9bXCJvbkNoYWluSXRlbVwiXShpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhbmltYXRlKGl0ZW0pLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9bXCJvbkNoYWluSXRlbUNvbXBsZXRlXCJdID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgb1tcIm9uQ2hhaW5JdGVtQ29tcGxldGVcIl0oaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBhcnIucmVkdWNlKHJlZHVjZXIsIFByb21pc2UucmVzb2x2ZSgpKS50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgIGlmICh0eXBlb2Ygb1tcIm9uQ2hhaW5Db21wbGV0ZVwiXSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICBvW1wib25DaGFpbkNvbXBsZXRlXCJdKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoby5sb29wKSB7XG4gICAgICAgICAgICBjaGFpbihhcnIsIG8pO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbiQuZWFzaW5nID0ge307XG5cbiQuZXh0ZW5kKCQuZWFzaW5nLCBFYXNpbmcpO1xuXG4kLmV4dGVuZCh7XG4gICAgYW5pbWF0ZTogZnVuY3Rpb24oYXJncyl7XG4gICAgICAgIHZhciBlbCwgZHJhdywgZHVyLCBlYXNlLCBjYjtcblxuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIGVsID0gJChhcmd1bWVudHNbMF0pWzBdO1xuICAgICAgICAgICAgZHJhdyA9IGFyZ3VtZW50c1sxXTtcbiAgICAgICAgICAgIGR1ciA9IGFyZ3VtZW50c1syXSB8fCAkLmFuaW1hdGlvbi5kdXJhdGlvbjtcbiAgICAgICAgICAgIGVhc2UgPSBhcmd1bWVudHNbM10gfHwgJC5hbmltYXRpb24uZWFzZTtcbiAgICAgICAgICAgIGNiID0gYXJndW1lbnRzWzRdO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGR1ciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGNiID0gZHVyO1xuICAgICAgICAgICAgICAgIGVhc2UgPSAkLmFuaW1hdGlvbi5lYXNlO1xuICAgICAgICAgICAgICAgIGR1ciA9ICQuYW5pbWF0aW9uLmR1cmF0aW9uO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGVhc2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBjYiA9IGVhc2U7XG4gICAgICAgICAgICAgICAgZWFzZSA9ICQuYW5pbWF0aW9uLmVhc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBhbmltYXRlKHtcbiAgICAgICAgICAgICAgICBlbDogZWwsXG4gICAgICAgICAgICAgICAgZHJhdzogZHJhdyxcbiAgICAgICAgICAgICAgICBkdXI6IGR1cixcbiAgICAgICAgICAgICAgICBlYXNlOiBlYXNlLFxuICAgICAgICAgICAgICAgIG9uRG9uZTogY2JcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFuaW1hdGUoYXJncyk7XG4gICAgfSxcbiAgICBjaGFpbjogY2hhaW4sXG4gICAgc3RvcDogc3RvcEFuaW1hdGlvbixcbiAgICBzdG9wQWxsOiBzdG9wQW5pbWF0aW9uQWxsLFxuICAgIHJlc3VtZTogcmVzdW1lQW5pbWF0aW9uLFxuICAgIHJlc3VtZUFsbDogcmVzdW1lQW5pbWF0aW9uQWxsLFxuICAgIHBhdXNlOiBwYXVzZUFuaW1hdGlvbixcbiAgICBwYXVzZUFsbDogcGF1c2VBbmltYXRpb25BbGxcbn0pO1xuXG4kLmZuLmV4dGVuZCh7XG4gICAgLyoqXG4gICAgICpcblxuICAgICBhcmdzID0ge1xuICAgICAgICAgZHJhdzoge30gfCBmdW5jdGlvbixcbiAgICAgICAgIGR1cjogMTAwMCxcbiAgICAgICAgIGVhc2U6IFwibGluZWFyXCIsXG4gICAgICAgICBsb29wOiAwLFxuICAgICAgICAgcGF1c2U6IDAsXG4gICAgICAgICBkaXI6IFwibm9ybWFsXCIsXG4gICAgICAgICBkZWZlcjogMCxcbiAgICAgICAgIG9uRnJhbWU6IGZ1bmN0aW9uLFxuICAgICAgICAgb25Eb25lOiBmdW5jdGlvblxuICAgICB9XG5cbiAgICAgKiBAcmV0dXJucyB7dGhpc31cbiAgICAgKi9cbiAgICBhbmltYXRlOiBmdW5jdGlvbihhcmdzKXtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgZHJhdywgZHVyLCBlYXNpbmcsIGNiO1xuICAgICAgICB2YXIgYSA9IGFyZ3M7XG4gICAgICAgIHZhciBjb21wYXRpYmlsaXR5TW9kZTtcblxuICAgICAgICBjb21wYXRpYmlsaXR5TW9kZSA9ICFBcnJheS5pc0FycmF5KGFyZ3MpICYmIChhcmd1bWVudHMubGVuZ3RoID4gMSB8fCAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSAmJiB0eXBlb2YgYXJndW1lbnRzWzBdLmRyYXcgPT09ICd1bmRlZmluZWQnKSk7XG5cbiAgICAgICAgaWYgKCBjb21wYXRpYmlsaXR5TW9kZSApIHtcbiAgICAgICAgICAgIGRyYXcgPSBhcmd1bWVudHNbMF07XG4gICAgICAgICAgICBkdXIgPSBhcmd1bWVudHNbMV0gfHwgJC5hbmltYXRpb24uZHVyYXRpb247XG4gICAgICAgICAgICBlYXNpbmcgPSBhcmd1bWVudHNbMl0gfHwgJC5hbmltYXRpb24uZWFzZTtcbiAgICAgICAgICAgIGNiID0gYXJndW1lbnRzWzNdO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGR1ciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGNiID0gZHVyO1xuICAgICAgICAgICAgICAgIGR1ciA9ICQuYW5pbWF0aW9uLmR1cmF0aW9uO1xuICAgICAgICAgICAgICAgIGVhc2luZyA9ICQuYW5pbWF0aW9uLmVhc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgZWFzaW5nID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgY2IgPSBlYXNpbmc7XG4gICAgICAgICAgICAgICAgZWFzaW5nID0gJC5hbmltYXRpb24uZWFzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHJldHVybiAkLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBlbDogdGhpcyxcbiAgICAgICAgICAgICAgICAgICAgZHJhdzogZHJhdyxcbiAgICAgICAgICAgICAgICAgICAgZHVyOiBkdXIsXG4gICAgICAgICAgICAgICAgICAgIGVhc2U6IGVhc2luZyxcbiAgICAgICAgICAgICAgICAgICAgb25Eb25lOiBjYlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhcmdzKSkge1xuICAgICAgICAgICAgJC5lYWNoKGFyZ3MsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHRoYXQuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBhLmVsID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgJC5hbmltYXRlKGEpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGEuZWwgPSB0aGlzO1xuICAgICAgICAgICAgJC5hbmltYXRlKGEpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgY2hhaW46IGZ1bmN0aW9uKGFyciwgbG9vcCl7XG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbCA9IHRoaXM7XG4gICAgICAgICAgICAkLmVhY2goYXJyLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoaXMuZWwgPSBlbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJC5jaGFpbihhcnIsIGxvb3ApO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9uZVxuICAgICAqIEByZXR1cm5zIHt0aGlzfVxuICAgICAqL1xuICAgIHN0b3A6IGZ1bmN0aW9uKGRvbmUpe1xuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWwgPSB0aGlzO1xuICAgICAgICAgICAgJC5lYWNoKCQuYW5pbWF0aW9uLmVsZW1lbnRzLCBmdW5jdGlvbihrLCBvKXtcbiAgICAgICAgICAgICAgICBpZiAoby5lbGVtZW50ID09PSBlbCkge1xuICAgICAgICAgICAgICAgICAgICBzdG9wQW5pbWF0aW9uKGssIGRvbmUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgcGF1c2U6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbCA9IHRoaXM7XG4gICAgICAgICAgICAkLmVhY2goJC5hbmltYXRpb24uZWxlbWVudHMsIGZ1bmN0aW9uKGssIG8pe1xuICAgICAgICAgICAgICAgIGlmIChvLmVsZW1lbnQgPT09IGVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhdXNlQW5pbWF0aW9uKGspO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgcmVzdW1lOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWwgPSB0aGlzO1xuICAgICAgICAgICAgJC5lYWNoKCQuYW5pbWF0aW9uLmVsZW1lbnRzLCBmdW5jdGlvbihrLCBvKXtcbiAgICAgICAgICAgICAgICBpZiAoby5lbGVtZW50ID09PSBlbCkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bWVBbmltYXRpb24oayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pO1xuXG5cbi8vIFNvdXJjZTogc3JjL3Zpc2liaWxpdHkuanNcblxuLyogZ2xvYmFsICQgKi9cblxuJC5leHRlbmQoe1xuICAgIGhpZGRlbjogZnVuY3Rpb24oZWwsIHZhbCwgY2Ipe1xuICAgICAgICBlbCA9ICQoZWwpWzBdO1xuXG4gICAgICAgIGlmICh0eXBlb2YgdmFsID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICB2YWwgPSB2YWwudG9Mb3dlckNhc2UoKSA9PT0gXCJ0cnVlXCI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICBjYiA9IHZhbDtcbiAgICAgICAgICAgIHZhbCA9ICFlbC5oaWRkZW47XG4gICAgICAgIH1cblxuICAgICAgICBlbC5oaWRkZW4gPSB2YWw7XG5cbiAgICAgICAgaWYgKHR5cGVvZiBjYiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAkLmJpbmQoY2IsIGVsKTtcbiAgICAgICAgICAgIGNiLmNhbGwoZWwsIGFyZ3VtZW50cyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgaGlkZTogZnVuY3Rpb24oZWwsIGNiKXtcbiAgICAgICAgdmFyICRlbCA9ICQoZWwpO1xuXG4gICAgICAgICRlbC5vcmlnaW4oJ2Rpc3BsYXknLCAoZWwuc3R5bGUuZGlzcGxheSA/IGVsLnN0eWxlLmRpc3BsYXkgOiBnZXRDb21wdXRlZFN0eWxlKGVsLCBudWxsKS5kaXNwbGF5KSk7XG4gICAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cbiAgICAgICAgaWYgKHR5cGVvZiBjYiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAkLmJpbmQoY2IsIGVsKTtcbiAgICAgICAgICAgIGNiLmNhbGwoZWwsIGFyZ3VtZW50cyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgc2hvdzogZnVuY3Rpb24oZWwsIGNiKXtcbiAgICAgICAgdmFyIGRpc3BsYXkgPSAkKGVsKS5vcmlnaW4oJ2Rpc3BsYXknLCB1bmRlZmluZWQsIFwiYmxvY2tcIik7XG4gICAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5ID8gZGlzcGxheSA9PT0gJ25vbmUnID8gJ2Jsb2NrJyA6IGRpc3BsYXkgOiAnJztcbiAgICAgICAgaWYgKHBhcnNlSW50KGVsLnN0eWxlLm9wYWNpdHkpID09PSAwKSB7XG4gICAgICAgICAgICBlbC5zdHlsZS5vcGFjaXR5ID0gXCIxXCI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBjYiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAkLmJpbmQoY2IsIGVsKTtcbiAgICAgICAgICAgIGNiLmNhbGwoZWwsIGFyZ3VtZW50cyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIHZpc2libGU6IGZ1bmN0aW9uKGVsLCBtb2RlLCBjYil7XG4gICAgICAgIGlmIChtb2RlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIG1vZGUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsLnN0eWxlLnZpc2liaWxpdHkgPSBtb2RlID8gJ3Zpc2libGUnIDogJ2hpZGRlbic7XG4gICAgICAgIGlmICh0eXBlb2YgY2IgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgJC5iaW5kKGNiLCBlbCk7XG4gICAgICAgICAgICBjYi5jYWxsKGVsLCBhcmd1bWVudHMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICB0b2dnbGU6IGZ1bmN0aW9uKGVsLCBjYil7XG4gICAgICAgIHZhciBmdW5jID0gZ2V0Q29tcHV0ZWRTdHlsZShlbCwgbnVsbCkuZGlzcGxheSAhPT0gJ25vbmUnID8gJ2hpZGUnIDogJ3Nob3cnO1xuICAgICAgICByZXR1cm4gJFtmdW5jXShlbCwgY2IpO1xuICAgIH1cbn0pO1xuXG4kLmZuLmV4dGVuZCh7XG4gICAgaGlkZTogZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIGNhbGxiYWNrO1xuXG4gICAgICAgICQuZWFjaChhcmd1bWVudHMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IHRoaXM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICQuaGlkZSh0aGlzLCBjYWxsYmFjayk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBzaG93OiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgY2FsbGJhY2s7XG5cbiAgICAgICAgJC5lYWNoKGFyZ3VtZW50cywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gdGhpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgJC5zaG93KHRoaXMsIGNhbGxiYWNrKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHZpc2libGU6IGZ1bmN0aW9uKG1vZGUsIGNiKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgJC52aXNpYmxlKHRoaXMsIG1vZGUsIGNiKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHRvZ2dsZTogZnVuY3Rpb24oY2Ipe1xuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkLnRvZ2dsZSh0aGlzLCBjYik7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBoaWRkZW46IGZ1bmN0aW9uKHZhbCwgY2Ipe1xuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkLmhpZGRlbih0aGlzLCB2YWwsIGNiKTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG5cblxuXG4vLyBTb3VyY2U6IHNyYy9lZmZlY3RzLmpzXG5cbi8qIGdsb2JhbCAkLCBub3QsIGlzVmlzaWJsZSAqL1xuXG4kLmV4dGVuZCh7XG4gICAgZng6IHtcbiAgICAgICAgb2ZmOiBmYWxzZVxuICAgIH1cbn0pO1xuXG4kLmZuLmV4dGVuZCh7XG4gICAgZmFkZUluOiBmdW5jdGlvbihkdXIsIGVhc2luZywgY2Ipe1xuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWwgPSB0aGlzO1xuICAgICAgICAgICAgdmFyICRlbCA9ICQoZWwpO1xuICAgICAgICAgICAgdmFyIHZpc2libGUgPSAhKCFpc1Zpc2libGUoZWwpIHx8IChpc1Zpc2libGUoZWwpICYmICsoJGVsLnN0eWxlKCdvcGFjaXR5JykpID09PSAwKSk7XG5cbiAgICAgICAgICAgIGlmICh2aXNpYmxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChub3QoZHVyKSAmJiBub3QoZWFzaW5nKSAmJiBub3QoY2IpKSB7XG4gICAgICAgICAgICAgICAgY2IgPSBudWxsO1xuICAgICAgICAgICAgICAgIGR1ciA9ICQuYW5pbWF0aW9uLmR1cmF0aW9uO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZHVyID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICBjYiA9IGR1cjtcbiAgICAgICAgICAgICAgICBkdXIgPSAkLmFuaW1hdGlvbi5kdXJhdGlvbjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBlYXNpbmcgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgIGNiID0gZWFzaW5nO1xuICAgICAgICAgICAgICAgIGVhc2luZyA9ICQuYW5pbWF0aW9uLmVhc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICgkLmZ4Lm9mZikge1xuICAgICAgICAgICAgICAgIGR1ciA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvcmlnaW5EaXNwbGF5ID0gJGVsLm9yaWdpbihcImRpc3BsYXlcIiwgdW5kZWZpbmVkLCAnYmxvY2snKTtcblxuICAgICAgICAgICAgZWwuc3R5bGUub3BhY2l0eSA9IFwiMFwiO1xuICAgICAgICAgICAgZWwuc3R5bGUuZGlzcGxheSA9IG9yaWdpbkRpc3BsYXk7XG5cbiAgICAgICAgICAgIHJldHVybiAkLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIGVsOiBlbCxcbiAgICAgICAgICAgICAgICBkcmF3OiB7XG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGR1cjogZHVyLFxuICAgICAgICAgICAgICAgIGVhc2U6IGVhc2luZyxcbiAgICAgICAgICAgICAgICBvbkRvbmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY2IgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkoY2IsIHRoaXMpKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGZhZGVPdXQ6IGZ1bmN0aW9uKGR1ciwgZWFzaW5nLCBjYil7XG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgJGVsID0gJChlbCk7XG5cbiAgICAgICAgICAgIGlmICggIWlzVmlzaWJsZShlbCkgKSByZXR1cm4gO1xuXG4gICAgICAgICAgICBpZiAobm90KGR1cikgJiYgbm90KGVhc2luZykgJiYgbm90KGNiKSkge1xuICAgICAgICAgICAgICAgIGNiID0gbnVsbDtcbiAgICAgICAgICAgICAgICBkdXIgPSAkLmFuaW1hdGlvbi5kdXJhdGlvbjtcbiAgICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBkdXIgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgIGNiID0gZHVyO1xuICAgICAgICAgICAgICAgIGR1ciA9ICQuYW5pbWF0aW9uLmR1cmF0aW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBlYXNpbmcgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgIGNiID0gZWFzaW5nO1xuICAgICAgICAgICAgICAgIGVhc2luZyA9ICQuYW5pbWF0aW9uLmVhc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICRlbC5vcmlnaW4oXCJkaXNwbGF5XCIsICRlbC5zdHlsZSgnZGlzcGxheScpKTtcblxuICAgICAgICAgICAgcmV0dXJuICQuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgZWw6IGVsLFxuICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZHVyOiBkdXIsXG4gICAgICAgICAgICAgICAgZWFzZTogZWFzaW5nLFxuICAgICAgICAgICAgICAgIG9uRG9uZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY2IgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkoY2IsIHRoaXMpKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHNsaWRlVXA6IGZ1bmN0aW9uKGR1ciwgZWFzaW5nLCBjYil7XG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgJGVsID0gJChlbCk7XG4gICAgICAgICAgICB2YXIgY3VyckhlaWdodDtcblxuICAgICAgICAgICAgaWYgKCRlbC5oZWlnaHQoKSA9PT0gMCkgcmV0dXJuIDtcblxuICAgICAgICAgICAgaWYgKG5vdChkdXIpICYmIG5vdChlYXNpbmcpICYmIG5vdChjYikpIHtcbiAgICAgICAgICAgICAgICBjYiA9IG51bGw7XG4gICAgICAgICAgICAgICAgZHVyID0gJC5hbmltYXRpb24uZHVyYXRpb247XG4gICAgICAgICAgICB9IGVsc2VcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZHVyID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICBjYiA9IGR1cjtcbiAgICAgICAgICAgICAgICBkdXIgPSAkLmFuaW1hdGlvbi5kdXJhdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2YgZWFzaW5nID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICBjYiA9IGVhc2luZztcbiAgICAgICAgICAgICAgICBlYXNpbmcgPSAkLmFuaW1hdGlvbi5lYXNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjdXJySGVpZ2h0ID0gJGVsLmhlaWdodCgpO1xuICAgICAgICAgICAgJGVsLm9yaWdpbihcImhlaWdodFwiLCBjdXJySGVpZ2h0KTtcbiAgICAgICAgICAgICRlbC5vcmlnaW4oXCJkaXNwbGF5XCIsICQoZWwpLnN0eWxlKCdkaXNwbGF5JykpO1xuXG4gICAgICAgICAgICAkZWwuY3NzKHtcbiAgICAgICAgICAgICAgICBvdmVyZmxvdzogXCJoaWRkZW5cIlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiAkLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIGVsOiBlbCxcbiAgICAgICAgICAgICAgICBkcmF3OiB7XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogMFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZHVyOiBkdXIsXG4gICAgICAgICAgICAgICAgZWFzZTogZWFzaW5nLFxuICAgICAgICAgICAgICAgIG9uRG9uZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgJGVsLmhpZGUoKS5yZW1vdmVTdHlsZVByb3BlcnR5KFwib3ZlcmZsb3csIGhlaWdodFwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjYiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5wcm94eShjYiwgdGhpcykoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgc2xpZGVEb3duOiBmdW5jdGlvbihkdXIsIGVhc2luZywgY2Ipe1xuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWwgPSB0aGlzO1xuICAgICAgICAgICAgdmFyICRlbCA9ICQoZWwpO1xuICAgICAgICAgICAgdmFyIHRhcmdldEhlaWdodCwgb3JpZ2luRGlzcGxheTtcblxuICAgICAgICAgICAgaWYgKG5vdChkdXIpICYmIG5vdChlYXNpbmcpICYmIG5vdChjYikpIHtcbiAgICAgICAgICAgICAgICBjYiA9IG51bGw7XG4gICAgICAgICAgICAgICAgZHVyID0gJC5hbmltYXRpb24uZHVyYXRpb247XG4gICAgICAgICAgICB9IGVsc2VcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZHVyID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICBjYiA9IGR1cjtcbiAgICAgICAgICAgICAgICBkdXIgPSAkLmFuaW1hdGlvbi5kdXJhdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2YgZWFzaW5nID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICBjYiA9IGVhc2luZztcbiAgICAgICAgICAgICAgICBlYXNpbmcgPSAkLmFuaW1hdGlvbi5lYXNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkZWwuc2hvdygpLnZpc2libGUoZmFsc2UpO1xuICAgICAgICAgICAgdGFyZ2V0SGVpZ2h0ID0gKyRlbC5vcmlnaW4oXCJoZWlnaHRcIiwgdW5kZWZpbmVkLCAkZWwuaGVpZ2h0KCkpO1xuICAgICAgICAgICAgaWYgKHBhcnNlSW50KHRhcmdldEhlaWdodCkgPT09IDApIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRIZWlnaHQgPSBlbC5zY3JvbGxIZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcmlnaW5EaXNwbGF5ID0gJGVsLm9yaWdpbihcImRpc3BsYXlcIiwgJGVsLnN0eWxlKCdkaXNwbGF5JyksIFwiYmxvY2tcIik7XG4gICAgICAgICAgICAkZWwuaGVpZ2h0KDApLnZpc2libGUodHJ1ZSk7XG5cbiAgICAgICAgICAgICRlbC5jc3Moe1xuICAgICAgICAgICAgICAgIG92ZXJmbG93OiBcImhpZGRlblwiLFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IG9yaWdpbkRpc3BsYXkgPT09IFwibm9uZVwiID8gXCJibG9ja1wiIDogb3JpZ2luRGlzcGxheVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiAkLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIGVsOiBlbCxcbiAgICAgICAgICAgICAgICBkcmF3OiB7XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogdGFyZ2V0SGVpZ2h0XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkdXI6IGR1cixcbiAgICAgICAgICAgICAgICBlYXNlOiBlYXNpbmcsXG4gICAgICAgICAgICAgICAgb25Eb25lOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAkKGVsKS5yZW1vdmVTdHlsZVByb3BlcnR5KFwib3ZlcmZsb3csIGhlaWdodCwgdmlzaWJpbGl0eVwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjYiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5wcm94eShjYiwgdGhpcykoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgbW92ZVRvOiBmdW5jdGlvbih4LCB5LCBkdXIsIGVhc2luZywgY2Ipe1xuICAgICAgICB2YXIgZHJhdyA9IHtcbiAgICAgICAgICAgIHRvcDogeSxcbiAgICAgICAgICAgIGxlZnQ6IHhcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAodHlwZW9mIGR1ciA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICBjYiA9IGR1cjtcbiAgICAgICAgICAgIGR1ciA9ICQuYW5pbWF0aW9uLmR1cmF0aW9uO1xuICAgICAgICAgICAgZWFzaW5nID0gJC5hbmltYXRpb24uZWFzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2YgZWFzaW5nID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIGNiID0gZWFzaW5nO1xuICAgICAgICAgICAgZWFzaW5nID0gJC5hbmltYXRpb24uZWFzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICQuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgZWw6IHRoaXMsXG4gICAgICAgICAgICAgICAgZHJhdzogZHJhdyxcbiAgICAgICAgICAgICAgICBkdXI6IGR1cixcbiAgICAgICAgICAgICAgICBlYXNlOiBlYXNpbmcsXG4gICAgICAgICAgICAgICAgb25Eb25lOiBjYlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBjZW50ZXJUbzogZnVuY3Rpb24oeCwgeSwgZHVyLCBlYXNpbmcsIGNiKXtcbiAgICAgICAgaWYgKHR5cGVvZiBkdXIgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgY2IgPSBkdXI7XG4gICAgICAgICAgICBkdXIgPSAkLmFuaW1hdGlvbi5kdXJhdGlvbjtcbiAgICAgICAgICAgIGVhc2luZyA9ICQuYW5pbWF0aW9uLmVhc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIGVhc2luZyA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICBjYiA9IGVhc2luZztcbiAgICAgICAgICAgIGVhc2luZyA9ICQuYW5pbWF0aW9uLmVhc2U7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZHJhdyA9IHtcbiAgICAgICAgICAgICAgICBsZWZ0OiB4IC0gdGhpcy5jbGllbnRXaWR0aCAvIDIsXG4gICAgICAgICAgICAgICAgdG9wOiB5IC0gdGhpcy5jbGllbnRIZWlnaHQgLyAyXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgJC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBlbDogdGhpcyxcbiAgICAgICAgICAgICAgICBkcmF3OiBkcmF3LFxuICAgICAgICAgICAgICAgIGR1cjogZHVyLFxuICAgICAgICAgICAgICAgIGVhc2U6IGVhc2luZyxcbiAgICAgICAgICAgICAgICBvbkRvbmU6IGNiXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGNvbG9yVG86IGZ1bmN0aW9uKGNvbG9yLCBkdXIsIGVhc2luZywgY2Ipe1xuICAgICAgICB2YXIgZHJhdyA9IHtcbiAgICAgICAgICAgIGNvbG9yOiBjb2xvclxuICAgICAgICB9O1xuXG4gICAgICAgIGlmICh0eXBlb2YgZHVyID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIGNiID0gZHVyO1xuICAgICAgICAgICAgZHVyID0gJC5hbmltYXRpb24uZHVyYXRpb247XG4gICAgICAgICAgICBlYXNpbmcgPSAkLmFuaW1hdGlvbi5lYXNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiBlYXNpbmcgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgY2IgPSBlYXNpbmc7XG4gICAgICAgICAgICBlYXNpbmcgPSAkLmFuaW1hdGlvbi5lYXNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgJC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBlbDogdGhpcyxcbiAgICAgICAgICAgICAgICBkcmF3OiBkcmF3LFxuICAgICAgICAgICAgICAgIGR1cjogZHVyLFxuICAgICAgICAgICAgICAgIGVhc2U6IGVhc2luZyxcbiAgICAgICAgICAgICAgICBvbkRvbmU6IGNiXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGJhY2tncm91bmRUbzogZnVuY3Rpb24oY29sb3IsIGR1ciwgZWFzaW5nLCBjYil7XG4gICAgICAgIHZhciBkcmF3ID0ge1xuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBjb2xvclxuICAgICAgICB9O1xuXG4gICAgICAgIGlmICh0eXBlb2YgZHVyID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIGNiID0gZHVyO1xuICAgICAgICAgICAgZHVyID0gJC5hbmltYXRpb24uZHVyYXRpb247XG4gICAgICAgICAgICBlYXNpbmcgPSAkLmFuaW1hdGlvbi5lYXNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiBlYXNpbmcgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgY2IgPSBlYXNpbmc7XG4gICAgICAgICAgICBlYXNpbmcgPSAkLmFuaW1hdGlvbi5lYXNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgJC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBlbDogdGhpcyxcbiAgICAgICAgICAgICAgICBkcmF3OiBkcmF3LFxuICAgICAgICAgICAgICAgIGR1cjogZHVyLFxuICAgICAgICAgICAgICAgIGVhc2U6IGVhc2luZyxcbiAgICAgICAgICAgICAgICBvbkRvbmU6IGNiXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG5cbi8vIFNvdXJjZTogc3JjL2luaXQuanNcblxuLyogZ2xvYmFsICQsIGlzQXJyYXlMaWtlLCBpc1BsYWluT2JqZWN0LCBoYXNQcm9wLCBzdHIyYXJyICovXG5cbiQuaW5pdCA9IGZ1bmN0aW9uKHNlbCwgY3R4KXtcbiAgICB2YXIgcGFyc2VkO1xuICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgIGlmICh0eXBlb2Ygc2VsID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHNlbCA9IHNlbC50cmltKCk7XG4gICAgfVxuXG4gICAgdGhpcy51aWQgPSAkLnVuaXF1ZUlkKCk7XG5cbiAgICBpZiAoIXNlbCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHNlbCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHJldHVybiAkLnJlYWR5KHNlbCk7XG4gICAgfVxuXG4gICAgaWYgKHNlbCBpbnN0YW5jZW9mIEVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5wdXNoKHNlbCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGlmIChzZWwgaW5zdGFuY2VvZiAkKSB7XG4gICAgICAgICQuZWFjaChzZWwsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGF0LnB1c2godGhpcyk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBpZiAoc2VsID09PSBcIndpbmRvd1wiKSBzZWwgPSB3aW5kb3c7XG4gICAgaWYgKHNlbCA9PT0gXCJkb2N1bWVudFwiKSBzZWwgPSBkb2N1bWVudDtcbiAgICBpZiAoc2VsID09PSBcImJvZHlcIikgc2VsID0gZG9jdW1lbnQuYm9keTtcbiAgICBpZiAoc2VsID09PSBcImh0bWxcIikgc2VsID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICAgIGlmIChzZWwgPT09IFwiZG9jdHlwZVwiKSBzZWwgPSBkb2N1bWVudC5kb2N0eXBlO1xuICAgIGlmIChzZWwgJiYgKHNlbC5ub2RlVHlwZSB8fCBzZWwuc2VsZiA9PT0gd2luZG93KSkge1xuICAgICAgICB0aGlzLnB1c2goc2VsKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgaWYgKGlzQXJyYXlMaWtlKHNlbCkpIHtcbiAgICAgICAgJC5lYWNoKHNlbCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICQodGhpcykuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQucHVzaCh0aGlzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBzZWwgIT09IFwic3RyaW5nXCIgJiYgKHNlbC5zZWxmICYmIHNlbC5zZWxmICE9PSB3aW5kb3cpKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGlmIChzZWwgPT09IFwiI1wiIHx8IHNlbCA9PT0gXCIuXCIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlNlbGVjdG9yIGNhbid0IGJlICMgb3IgLlwiKSA7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGlmIChzZWxbMF0gPT09IFwiQFwiKSB7XG5cbiAgICAgICAgJChcIltkYXRhLXJvbGVdXCIpLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciByb2xlcyA9IHN0cjJhcnIoJCh0aGlzKS5hdHRyKFwiZGF0YS1yb2xlXCIpLCBcIixcIik7XG4gICAgICAgICAgICBpZiAocm9sZXMuaW5kZXhPZihzZWwuc2xpY2UoMSkpID4gLTEpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnB1c2godGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgfSBlbHNlIHtcblxuICAgICAgICBwYXJzZWQgPSAkLnBhcnNlSFRNTChzZWwpO1xuXG4gICAgICAgIGlmIChwYXJzZWQubGVuZ3RoID09PSAxICYmIHBhcnNlZFswXS5ub2RlVHlwZSA9PT0gMykgeyAvLyBNdXN0IGJlIGEgdGV4dCBub2RlIC0+IGNzcyBzZWxcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgW10ucHVzaC5hcHBseSh0aGlzLCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbCkpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIC8vY29uc29sZS5lcnJvcihzZWwgKyBcIiBpcyBub3QgYSB2YWxpZCBzZWxlY3RvclwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQubWVyZ2UodGhpcywgcGFyc2VkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjdHggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoY3R4IGluc3RhbmNlb2YgJCkge1xuICAgICAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkKGN0eCkuYXBwZW5kKHRoYXQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoY3R4IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHtcbiAgICAgICAgICAgICQoY3R4KS5hcHBlbmQodGhhdCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoaXNQbGFpbk9iamVjdChjdHgpKSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKHRoaXMsZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBuYW1lIGluIGN0eCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhc1Byb3AoY3R4LCBuYW1lKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShuYW1lLCBjdHhbbmFtZV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbn07XG5cbiQuaW5pdC5wcm90b3R5cGUgPSAkLmZuO1xuXG5cbi8vIFNvdXJjZTogc3JjL3BvcHVsYXRlLmpzXG5cbi8qIGdsb2JhbCBQcm9taXNlLCAkICovXG5cbnZhciBfJCA9IHdpbmRvdy4kO1xuXG4kLlByb21pc2UgPSBQcm9taXNlO1xuXG53aW5kb3cubTRxID0gJDtcblxuaWYgKHR5cGVvZiB3aW5kb3cuJCA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgIHdpbmRvdy4kID0gJDtcbn1cblxuJC5nbG9iYWwgPSBmdW5jdGlvbigpe1xuICAgIF8kID0gd2luZG93LiQ7XG4gICAgd2luZG93LiQgPSAkO1xufTtcblxuJC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCB3aW5kb3cuJCA9PT0gJCApIHtcbiAgICAgICAgd2luZG93LiQgPSBfJDtcbiAgICB9XG5cbiAgICByZXR1cm4gJDtcbn07XG5cbn0od2luZG93KSk7XG5cclxuXHJcbihmdW5jdGlvbigkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIG1ldGFfaW5pdCA9ICQubWV0YSgnbWV0cm80OmluaXQnKS5hdHRyKFwiY29udGVudFwiKTtcbiAgICB2YXIgbWV0YV9sb2NhbGUgPSAkLm1ldGEoJ21ldHJvNDpsb2NhbGUnKS5hdHRyKFwiY29udGVudFwiKTtcbiAgICB2YXIgbWV0YV93ZWVrX3N0YXJ0ID0gJC5tZXRhKCdtZXRybzQ6d2Vla19zdGFydCcpLmF0dHIoXCJjb250ZW50XCIpO1xuICAgIHZhciBtZXRhX2RhdGVfZm9ybWF0ID0gJC5tZXRhKCdtZXRybzQ6ZGF0ZV9mb3JtYXQnKS5hdHRyKFwiY29udGVudFwiKTtcbiAgICB2YXIgbWV0YV9kYXRlX2Zvcm1hdF9pbnB1dCA9ICQubWV0YSgnbWV0cm80OmRhdGVfZm9ybWF0X2lucHV0JykuYXR0cihcImNvbnRlbnRcIik7XG4gICAgdmFyIG1ldGFfYW5pbWF0aW9uX2R1cmF0aW9uID0gJC5tZXRhKCdtZXRybzQ6YW5pbWF0aW9uX2R1cmF0aW9uJykuYXR0cihcImNvbnRlbnRcIik7XG4gICAgdmFyIG1ldGFfY2FsbGJhY2tfdGltZW91dCA9ICQubWV0YSgnbWV0cm80OmNhbGxiYWNrX3RpbWVvdXQnKS5hdHRyKFwiY29udGVudFwiKTtcbiAgICB2YXIgbWV0YV90aW1lb3V0ID0gJC5tZXRhKCdtZXRybzQ6dGltZW91dCcpLmF0dHIoXCJjb250ZW50XCIpO1xuICAgIHZhciBtZXRhX3Njcm9sbF9tdWx0aXBsZSA9ICQubWV0YSgnbWV0cm80OnNjcm9sbF9tdWx0aXBsZScpLmF0dHIoXCJjb250ZW50XCIpO1xuICAgIHZhciBtZXRhX2Nsb2FrID0gJC5tZXRhKCdtZXRybzQ6Y2xvYWsnKS5hdHRyKFwiY29udGVudFwiKTtcbiAgICB2YXIgbWV0YV9jbG9ha19kdXJhdGlvbiA9ICQubWV0YSgnbWV0cm80OmNsb2FrX2R1cmF0aW9uJykuYXR0cihcImNvbnRlbnRcIik7XG4gICAgdmFyIG1ldGFfZ2xvYmFsX2NvbW1vbiA9ICQubWV0YSgnbWV0cm80Omdsb2JhbF9jb21tb24nKS5hdHRyKFwiY29udGVudFwiKTtcbiAgICB2YXIgbWV0YV9ibHVyX2ltYWdlID0gJC5tZXRhKCdtZXRybzQ6Ymx1cl9pbWFnZScpLmF0dHIoXCJjb250ZW50XCIpO1xuXG4gICAgaWYgKHdpbmRvdy5NRVRST19CTFVSX0lNQUdFID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgd2luZG93Lk1FVFJPX0JMVVJfSU1BR0UgPSBtZXRhX2JsdXJfaW1hZ2UgIT09IHVuZGVmaW5lZCA/IEpTT04ucGFyc2UobWV0YV9nbG9iYWxfY29tbW9uKSA6IGZhbHNlO1xuICAgIH1cblxuICAgIGlmICh3aW5kb3cuTUVUUk9fR0xPQkFMX0NPTU1PTiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHdpbmRvdy5NRVRST19HTE9CQUxfQ09NTU9OID0gbWV0YV9nbG9iYWxfY29tbW9uICE9PSB1bmRlZmluZWQgPyBKU09OLnBhcnNlKG1ldGFfZ2xvYmFsX2NvbW1vbikgOiBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgbWV0YV9qcXVlcnkgPSAkLm1ldGEoJ21ldHJvNDpqcXVlcnknKS5hdHRyKFwiY29udGVudFwiKTsgLy91bmRlZmluZWRcbiAgICB3aW5kb3cuanF1ZXJ5X3ByZXNlbnQgPSB0eXBlb2YgalF1ZXJ5ICE9PSBcInVuZGVmaW5lZFwiO1xuICAgIGlmICh3aW5kb3cuTUVUUk9fSlFVRVJZID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgd2luZG93Lk1FVFJPX0pRVUVSWSA9IG1ldGFfanF1ZXJ5ICE9PSB1bmRlZmluZWQgPyBKU09OLnBhcnNlKG1ldGFfanF1ZXJ5KSA6IHRydWU7XG4gICAgfVxuICAgIHdpbmRvdy51c2VKUXVlcnkgPSB3aW5kb3cuanF1ZXJ5X3ByZXNlbnQgJiYgd2luZG93Lk1FVFJPX0pRVUVSWTtcblxuXG4gICAgLyogQWRkZWQgYnkgS2VuIEtpdGF5IGh0dHBzOi8vZ2l0aHViLmNvbS9rZW5zLWNvZGUqL1xuICAgIHZhciBtZXRhX2Fib3V0ID0gJC5tZXRhKCdtZXRybzQ6YWJvdXQnKS5hdHRyKFwiY29udGVudFwiKTtcbiAgICBpZiAod2luZG93Lk1FVFJPX1NIT1dfQUJPVVQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB3aW5kb3cuTUVUUk9fU0hPV19BQk9VVCA9IG1ldGFfYWJvdXQgIT09IHVuZGVmaW5lZCA/IEpTT04ucGFyc2UobWV0YV9hYm91dCkgOiB0cnVlO1xuICAgIH1cbiAgICAvKiAtLS0gZW5kIC0tLSovXG5cbiAgICB2YXIgbWV0YV9jb21waWxlID0gJC5tZXRhKCdtZXRybzQ6Y29tcGlsZScpLmF0dHIoXCJjb250ZW50XCIpO1xuICAgIGlmICh3aW5kb3cuTUVUUk9fU0hPV19DT01QSUxFX1RJTUUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB3aW5kb3cuTUVUUk9fU0hPV19DT01QSUxFX1RJTUUgPSBtZXRhX2NvbXBpbGUgIT09IHVuZGVmaW5lZCA/IEpTT04ucGFyc2UobWV0YV9jb21waWxlKSA6IHRydWU7XG4gICAgfVxuXG4gICAgaWYgKHdpbmRvdy5NRVRST19JTklUID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgd2luZG93Lk1FVFJPX0lOSVQgPSBtZXRhX2luaXQgIT09IHVuZGVmaW5lZCA/IEpTT04ucGFyc2UobWV0YV9pbml0KSA6IHRydWU7XG4gICAgfVxuXG4gICAgaWYgKHdpbmRvdy5NRVRST19ERUJVRyA9PT0gdW5kZWZpbmVkKSB7d2luZG93Lk1FVFJPX0RFQlVHID0gdHJ1ZTt9XG5cbiAgICBpZiAod2luZG93Lk1FVFJPX1dFRUtfU1RBUlQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB3aW5kb3cuTUVUUk9fV0VFS19TVEFSVCA9IG1ldGFfd2Vla19zdGFydCAhPT0gdW5kZWZpbmVkID8gcGFyc2VJbnQobWV0YV93ZWVrX3N0YXJ0KSA6IDA7XG4gICAgfVxuICAgIGlmICh3aW5kb3cuTUVUUk9fREFURV9GT1JNQVQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB3aW5kb3cuTUVUUk9fREFURV9GT1JNQVQgPSBtZXRhX2RhdGVfZm9ybWF0ICE9PSB1bmRlZmluZWQgPyBtZXRhX2RhdGVfZm9ybWF0IDogXCJZWVlZLU1NLUREXCI7XG4gICAgfVxuICAgIGlmICh3aW5kb3cuTUVUUk9fREFURV9GT1JNQVRfSU5QVVQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB3aW5kb3cuTUVUUk9fREFURV9GT1JNQVRfSU5QVVQgPSBtZXRhX2RhdGVfZm9ybWF0X2lucHV0ICE9PSB1bmRlZmluZWQgPyBtZXRhX2RhdGVfZm9ybWF0X2lucHV0IDogXCJZWVlZLU1NLUREXCI7XG4gICAgfVxuICAgIGlmICh3aW5kb3cuTUVUUk9fTE9DQUxFID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgd2luZG93Lk1FVFJPX0xPQ0FMRSA9IG1ldGFfbG9jYWxlICE9PSB1bmRlZmluZWQgPyBtZXRhX2xvY2FsZSA6ICdlbi1VUyc7XG4gICAgfVxuICAgIGlmICh3aW5kb3cuTUVUUk9fQU5JTUFUSU9OX0RVUkFUSU9OID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgd2luZG93Lk1FVFJPX0FOSU1BVElPTl9EVVJBVElPTiA9IG1ldGFfYW5pbWF0aW9uX2R1cmF0aW9uICE9PSB1bmRlZmluZWQgPyBwYXJzZUludChtZXRhX2FuaW1hdGlvbl9kdXJhdGlvbikgOiAxMDA7XG4gICAgfVxuICAgIGlmICh3aW5kb3cuTUVUUk9fQ0FMTEJBQ0tfVElNRU9VVCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHdpbmRvdy5NRVRST19DQUxMQkFDS19USU1FT1VUID0gbWV0YV9jYWxsYmFja190aW1lb3V0ICE9PSB1bmRlZmluZWQgPyBwYXJzZUludChtZXRhX2NhbGxiYWNrX3RpbWVvdXQpIDogNTAwO1xuICAgIH1cbiAgICBpZiAod2luZG93Lk1FVFJPX1RJTUVPVVQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB3aW5kb3cuTUVUUk9fVElNRU9VVCA9IG1ldGFfdGltZW91dCAhPT0gdW5kZWZpbmVkID8gcGFyc2VJbnQobWV0YV90aW1lb3V0KSA6IDIwMDA7XG4gICAgfVxuICAgIGlmICh3aW5kb3cuTUVUUk9fU0NST0xMX01VTFRJUExFID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgd2luZG93Lk1FVFJPX1NDUk9MTF9NVUxUSVBMRSA9IG1ldGFfc2Nyb2xsX211bHRpcGxlICE9PSB1bmRlZmluZWQgPyBwYXJzZUludChtZXRhX3Njcm9sbF9tdWx0aXBsZSkgOiAyMDtcbiAgICB9XG4gICAgaWYgKHdpbmRvdy5NRVRST19DTE9BS19SRU1PVkUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB3aW5kb3cuTUVUUk9fQ0xPQUtfUkVNT1ZFID0gbWV0YV9jbG9hayAhPT0gdW5kZWZpbmVkID8gKFwiXCIrbWV0YV9jbG9haykudG9Mb3dlckNhc2UoKSA6IFwiZmFkZVwiO1xuICAgIH1cbiAgICBpZiAod2luZG93Lk1FVFJPX0NMT0FLX0RVUkFUSU9OID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgd2luZG93Lk1FVFJPX0NMT0FLX0RVUkFUSU9OID0gbWV0YV9jbG9ha19kdXJhdGlvbiAhPT0gdW5kZWZpbmVkID8gcGFyc2VJbnQobWV0YV9jbG9ha19kdXJhdGlvbikgOiAzMDA7XG4gICAgfVxuXG4gICAgaWYgKHdpbmRvdy5NRVRST19IT1RLRVlTX0ZJTFRFUl9DT05URU5UX0VESVRBQkxFID09PSB1bmRlZmluZWQpIHt3aW5kb3cuTUVUUk9fSE9US0VZU19GSUxURVJfQ09OVEVOVF9FRElUQUJMRSA9IHRydWU7fVxuICAgIGlmICh3aW5kb3cuTUVUUk9fSE9US0VZU19GSUxURVJfSU5QVVRfQUNDRVBUSU5HX0VMRU1FTlRTID09PSB1bmRlZmluZWQpIHt3aW5kb3cuTUVUUk9fSE9US0VZU19GSUxURVJfSU5QVVRfQUNDRVBUSU5HX0VMRU1FTlRTID0gdHJ1ZTt9XG4gICAgaWYgKHdpbmRvdy5NRVRST19IT1RLRVlTX0ZJTFRFUl9URVhUX0lOUFVUUyA9PT0gdW5kZWZpbmVkKSB7d2luZG93Lk1FVFJPX0hPVEtFWVNfRklMVEVSX1RFWFRfSU5QVVRTID0gdHJ1ZTt9XG4gICAgaWYgKHdpbmRvdy5NRVRST19IT1RLRVlTX0JVQkJMRV9VUCA9PT0gdW5kZWZpbmVkKSB7d2luZG93Lk1FVFJPX0hPVEtFWVNfQlVCQkxFX1VQID0gZmFsc2U7fVxuICAgIGlmICh3aW5kb3cuTUVUUk9fVEhST1dTID09PSB1bmRlZmluZWQpIHt3aW5kb3cuTUVUUk9fVEhST1dTID0gdHJ1ZTt9XG5cbiAgICB3aW5kb3cuTUVUUk9fTUVESUEgPSBbXTtcblxufShtNHEpKTtcclxuXHJcbi8qIE1ldHJvIDQgQ29yZSAqL1xuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciAkID0gbTRxO1xuXG4gICAgaWYgKHR5cGVvZiBtNHEgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTWV0cm8gNCByZXF1aXJlcyBtNHEgaGVscGVyIScpO1xuICAgIH1cblxuICAgIGlmICghKCdNdXRhdGlvbk9ic2VydmVyJyBpbiB3aW5kb3cpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTWV0cm8gNCByZXF1aXJlcyBNdXRhdGlvbk9ic2VydmVyIScpO1xuICAgIH1cblxuICAgIHZhciBpc1RvdWNoID0gKCgnb250b3VjaHN0YXJ0JyBpbiB3aW5kb3cpIHx8IChuYXZpZ2F0b3JbXCJNYXhUb3VjaFBvaW50c1wiXSA+IDApIHx8IChuYXZpZ2F0b3JbXCJtc01heFRvdWNoUG9pbnRzXCJdID4gMCkpO1xuXG4gICAgdmFyIG5vcm1hbGl6ZUNvbXBvbmVudE5hbWUgPSBmdW5jdGlvbihuYW1lKXtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiBuYW1lICE9PSBcInN0cmluZ1wiID8gdW5kZWZpbmVkIDogbmFtZS5yZXBsYWNlKC8tL2csIFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgfTtcblxuICAgIHZhciBNZXRybyA9IHtcblxuICAgICAgICB2ZXJzaW9uOiBcIjQuNS4wXCIsXG4gICAgICAgIGNvbXBpbGVUaW1lOiBcIjAxLzA4LzIwMjEgMTg6NTM6NDNcIixcbiAgICAgICAgYnVpbGROdW1iZXI6IFwiNzU1XCIsXG4gICAgICAgIGlzVG91Y2hhYmxlOiBpc1RvdWNoLFxuICAgICAgICBmdWxsU2NyZWVuRW5hYmxlZDogZG9jdW1lbnQuZnVsbHNjcmVlbkVuYWJsZWQsXG4gICAgICAgIHNoZWV0OiBudWxsLFxuXG5cbiAgICAgICAgY29udHJvbHNQb3NpdGlvbjoge1xuICAgICAgICAgICAgSU5TSURFOiBcImluc2lkZVwiLFxuICAgICAgICAgICAgT1VUU0lERTogXCJvdXRzaWRlXCJcbiAgICAgICAgfSxcblxuICAgICAgICBncm91cE1vZGU6IHtcbiAgICAgICAgICAgIE9ORTogXCJvbmVcIixcbiAgICAgICAgICAgIE1VTFRJOiBcIm11bHRpXCJcbiAgICAgICAgfSxcblxuICAgICAgICBhc3BlY3RSYXRpbzoge1xuICAgICAgICAgICAgSEQ6IFwiaGRcIixcbiAgICAgICAgICAgIFNEOiBcInNkXCIsXG4gICAgICAgICAgICBDSU5FTUE6IFwiY2luZW1hXCJcbiAgICAgICAgfSxcblxuICAgICAgICBmdWxsU2NyZWVuTW9kZToge1xuICAgICAgICAgICAgV0lORE9XOiBcIndpbmRvd1wiLFxuICAgICAgICAgICAgREVTS1RPUDogXCJkZXNrdG9wXCJcbiAgICAgICAgfSxcblxuICAgICAgICBwb3NpdGlvbjoge1xuICAgICAgICAgICAgVE9QOiBcInRvcFwiLFxuICAgICAgICAgICAgQk9UVE9NOiBcImJvdHRvbVwiLFxuICAgICAgICAgICAgTEVGVDogXCJsZWZ0XCIsXG4gICAgICAgICAgICBSSUdIVDogXCJyaWdodFwiLFxuICAgICAgICAgICAgVE9QX1JJR0hUOiBcInRvcC1yaWdodFwiLFxuICAgICAgICAgICAgVE9QX0xFRlQ6IFwidG9wLWxlZnRcIixcbiAgICAgICAgICAgIEJPVFRPTV9MRUZUOiBcImJvdHRvbS1sZWZ0XCIsXG4gICAgICAgICAgICBCT1RUT01fUklHSFQ6IFwiYm90dG9tLXJpZ2h0XCIsXG4gICAgICAgICAgICBMRUZUX0JPVFRPTTogXCJsZWZ0LWJvdHRvbVwiLFxuICAgICAgICAgICAgTEVGVF9UT1A6IFwibGVmdC10b3BcIixcbiAgICAgICAgICAgIFJJR0hUX1RPUDogXCJyaWdodC10b3BcIixcbiAgICAgICAgICAgIFJJR0hUX0JPVFRPTTogXCJyaWdodC1ib3R0b21cIlxuICAgICAgICB9LFxuXG4gICAgICAgIHBvcG92ZXJFdmVudHM6IHtcbiAgICAgICAgICAgIENMSUNLOiBcImNsaWNrXCIsXG4gICAgICAgICAgICBIT1ZFUjogXCJob3ZlclwiLFxuICAgICAgICAgICAgRk9DVVM6IFwiZm9jdXNcIlxuICAgICAgICB9LFxuXG4gICAgICAgIHN0ZXBwZXJWaWV3OiB7XG4gICAgICAgICAgICBTUVVBUkU6IFwic3F1YXJlXCIsXG4gICAgICAgICAgICBDWUNMRTogXCJjeWNsZVwiLFxuICAgICAgICAgICAgRElBTU9ORDogXCJkaWFtb25kXCJcbiAgICAgICAgfSxcblxuICAgICAgICBsaXN0Vmlldzoge1xuICAgICAgICAgICAgTElTVDogXCJsaXN0XCIsXG4gICAgICAgICAgICBDT05URU5UOiBcImNvbnRlbnRcIixcbiAgICAgICAgICAgIElDT05TOiBcImljb25zXCIsXG4gICAgICAgICAgICBJQ09OU19NRURJVU06IFwiaWNvbnMtbWVkaXVtXCIsXG4gICAgICAgICAgICBJQ09OU19MQVJHRTogXCJpY29ucy1sYXJnZVwiLFxuICAgICAgICAgICAgVElMRVM6IFwidGlsZXNcIixcbiAgICAgICAgICAgIFRBQkxFOiBcInRhYmxlXCJcbiAgICAgICAgfSxcblxuICAgICAgICBldmVudHM6IHtcbiAgICAgICAgICAgIGNsaWNrOiAnY2xpY2snLFxuICAgICAgICAgICAgc3RhcnQ6IGlzVG91Y2ggPyAndG91Y2hzdGFydCcgOiAnbW91c2Vkb3duJyxcbiAgICAgICAgICAgIHN0b3A6IGlzVG91Y2ggPyAndG91Y2hlbmQnIDogJ21vdXNldXAnLFxuICAgICAgICAgICAgbW92ZTogaXNUb3VjaCA/ICd0b3VjaG1vdmUnIDogJ21vdXNlbW92ZScsXG4gICAgICAgICAgICBlbnRlcjogaXNUb3VjaCA/ICd0b3VjaHN0YXJ0JyA6ICdtb3VzZWVudGVyJyxcblxuICAgICAgICAgICAgc3RhcnRBbGw6ICdtb3VzZWRvd24gdG91Y2hzdGFydCcsXG4gICAgICAgICAgICBzdG9wQWxsOiAnbW91c2V1cCB0b3VjaGVuZCcsXG4gICAgICAgICAgICBtb3ZlQWxsOiAnbW91c2Vtb3ZlIHRvdWNobW92ZScsXG5cbiAgICAgICAgICAgIGxlYXZlOiAnbW91c2VsZWF2ZScsXG4gICAgICAgICAgICBmb2N1czogJ2ZvY3VzJyxcbiAgICAgICAgICAgIGJsdXI6ICdibHVyJyxcbiAgICAgICAgICAgIHJlc2l6ZTogJ3Jlc2l6ZScsXG4gICAgICAgICAgICBrZXl1cDogJ2tleXVwJyxcbiAgICAgICAgICAgIGtleWRvd246ICdrZXlkb3duJyxcbiAgICAgICAgICAgIGtleXByZXNzOiAna2V5cHJlc3MnLFxuICAgICAgICAgICAgZGJsY2xpY2s6ICdkYmxjbGljaycsXG4gICAgICAgICAgICBpbnB1dDogJ2lucHV0JyxcbiAgICAgICAgICAgIGNoYW5nZTogJ2NoYW5nZScsXG4gICAgICAgICAgICBjdXQ6ICdjdXQnLFxuICAgICAgICAgICAgcGFzdGU6ICdwYXN0ZScsXG4gICAgICAgICAgICBzY3JvbGw6ICdzY3JvbGwnLFxuICAgICAgICAgICAgbW91c2V3aGVlbDogJ21vdXNld2hlZWwnLFxuICAgICAgICAgICAgaW5wdXRjaGFuZ2U6IFwiY2hhbmdlIGlucHV0IHByb3BlcnR5Y2hhbmdlIGN1dCBwYXN0ZSBjb3B5IGRyb3BcIixcbiAgICAgICAgICAgIGRyYWdzdGFydDogXCJkcmFnc3RhcnRcIixcbiAgICAgICAgICAgIGRyYWdlbmQ6IFwiZHJhZ2VuZFwiLFxuICAgICAgICAgICAgZHJhZ2VudGVyOiBcImRyYWdlbnRlclwiLFxuICAgICAgICAgICAgZHJhZ292ZXI6IFwiZHJhZ292ZXJcIixcbiAgICAgICAgICAgIGRyYWdsZWF2ZTogXCJkcmFnbGVhdmVcIixcbiAgICAgICAgICAgIGRyb3A6ICdkcm9wJyxcbiAgICAgICAgICAgIGRyYWc6ICdkcmFnJ1xuICAgICAgICB9LFxuXG4gICAgICAgIGtleUNvZGU6IHtcbiAgICAgICAgICAgIEJBQ0tTUEFDRTogOCxcbiAgICAgICAgICAgIFRBQjogOSxcbiAgICAgICAgICAgIEVOVEVSOiAxMyxcbiAgICAgICAgICAgIFNISUZUOiAxNixcbiAgICAgICAgICAgIENUUkw6IDE3LFxuICAgICAgICAgICAgQUxUOiAxOCxcbiAgICAgICAgICAgIEJSRUFLOiAxOSxcbiAgICAgICAgICAgIENBUFM6IDIwLFxuICAgICAgICAgICAgRVNDQVBFOiAyNyxcbiAgICAgICAgICAgIFNQQUNFOiAzMixcbiAgICAgICAgICAgIFBBR0VVUDogMzMsXG4gICAgICAgICAgICBQQUdFRE9XTjogMzQsXG4gICAgICAgICAgICBFTkQ6IDM1LFxuICAgICAgICAgICAgSE9NRTogMzYsXG4gICAgICAgICAgICBMRUZUX0FSUk9XOiAzNyxcbiAgICAgICAgICAgIFVQX0FSUk9XOiAzOCxcbiAgICAgICAgICAgIFJJR0hUX0FSUk9XOiAzOSxcbiAgICAgICAgICAgIERPV05fQVJST1c6IDQwLFxuICAgICAgICAgICAgQ09NTUE6IDE4OFxuICAgICAgICB9LFxuXG4gICAgICAgIG1lZGlhX3F1ZXJpZXM6IHtcbiAgICAgICAgICAgIEZTOiBcIihtaW4td2lkdGg6IDBweClcIixcbiAgICAgICAgICAgIFhTOiBcIihtaW4td2lkdGg6IDM2MHB4KVwiLFxuICAgICAgICAgICAgU006IFwiKG1pbi13aWR0aDogNTc2cHgpXCIsXG4gICAgICAgICAgICBNRDogXCIobWluLXdpZHRoOiA3NjhweClcIixcbiAgICAgICAgICAgIExHOiBcIihtaW4td2lkdGg6IDk5MnB4KVwiLFxuICAgICAgICAgICAgWEw6IFwiKG1pbi13aWR0aDogMTIwMHB4KVwiLFxuICAgICAgICAgICAgWFhMOiBcIihtaW4td2lkdGg6IDE0NTJweClcIlxuICAgICAgICB9LFxuXG4gICAgICAgIG1lZGlhX3NpemVzOiB7XG4gICAgICAgICAgICBGUzogMCxcbiAgICAgICAgICAgIFhTOiAzNjAsXG4gICAgICAgICAgICBTTTogNTc2LFxuICAgICAgICAgICAgTEQ6IDY0MCxcbiAgICAgICAgICAgIE1EOiA3NjgsXG4gICAgICAgICAgICBMRzogOTkyLFxuICAgICAgICAgICAgWEw6IDEyMDAsXG4gICAgICAgICAgICBYWEw6IDE0NTJcbiAgICAgICAgfSxcblxuICAgICAgICBtZWRpYV9tb2RlOiB7XG4gICAgICAgICAgICBGUzogXCJmc1wiLFxuICAgICAgICAgICAgWFM6IFwieHNcIixcbiAgICAgICAgICAgIFNNOiBcInNtXCIsXG4gICAgICAgICAgICBNRDogXCJtZFwiLFxuICAgICAgICAgICAgTEc6IFwibGdcIixcbiAgICAgICAgICAgIFhMOiBcInhsXCIsXG4gICAgICAgICAgICBYWEw6IFwieHhsXCJcbiAgICAgICAgfSxcblxuICAgICAgICBtZWRpYV9tb2RlczogW1wiZnNcIixcInhzXCIsXCJzbVwiLFwibWRcIixcImxnXCIsXCJ4bFwiLFwieHhsXCJdLFxuXG4gICAgICAgIGFjdGlvbnM6IHtcbiAgICAgICAgICAgIFJFTU9WRTogMSxcbiAgICAgICAgICAgIEhJREU6IDJcbiAgICAgICAgfSxcblxuICAgICAgICBob3RrZXlzOiB7fSxcbiAgICAgICAgbG9jYWxlczoge30sXG4gICAgICAgIHV0aWxzOiB7fSxcbiAgICAgICAgY29sb3JzOiB7fSxcbiAgICAgICAgZGlhbG9nOiBudWxsLFxuICAgICAgICBwYWdpbmF0aW9uOiBudWxsLFxuICAgICAgICBtZDU6IG51bGwsXG4gICAgICAgIHN0b3JhZ2U6IG51bGwsXG4gICAgICAgIGV4cG9ydDogbnVsbCxcbiAgICAgICAgYW5pbWF0aW9uczogbnVsbCxcbiAgICAgICAgY29va2llOiBudWxsLFxuICAgICAgICB0ZW1wbGF0ZTogbnVsbCxcbiAgICAgICAgZGVmYXVsdHM6IHt9LFxuXG4gICAgICAgIGFib3V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGNvbnRlbnQgPVxuICAgICAgICAgICAgICAgIFwiPGgzPkFib3V0PC9oMz5cIiArXG4gICAgICAgICAgICAgICAgXCI8aHI+XCIgK1xuICAgICAgICAgICAgICAgIFwiPGRpdj48Yj5NZXRybyA0PC9iPiAtIHZcIiArIE1ldHJvLnZlcnNpb24gK1wiLiBcIisgTWV0cm8uc2hvd0NvbXBpbGVUaW1lKCkgKyBcIjwvZGl2PlwiICtcbiAgICAgICAgICAgICAgICBcIjxkaXY+PGI+TTRRPC9iPiAtIFwiICsgbTRxLnZlcnNpb24gKyBcIjwvZGl2PlwiO1xuICAgICAgICAgICAgTWV0cm8uaW5mb2JveC5jcmVhdGUoY29udGVudClcbiAgICAgICAgfSxcblxuICAgICAgICBpbmZvOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiTWV0cm8gNCAtIHZcIiArIE1ldHJvLnZlcnNpb24gK1wiLiBcIisgTWV0cm8uc2hvd0NvbXBpbGVUaW1lKCkpO1xuICAgICAgICAgICAgY29uc29sZS5pbmZvKFwibTRxIC0gXCIgKyBtNHEudmVyc2lvbik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2hvd0NvbXBpbGVUaW1lOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIFwiQnVpbHQgYXQ6IFwiICsgTWV0cm8uY29tcGlsZVRpbWU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYWJvdXREbGc6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBhbGVydChcIk1ldHJvIDQgLSB2XCIgKyBNZXRyby52ZXJzaW9uICtcIi4gXCIrIE1ldHJvLnNob3dDb21waWxlVGltZSgpKTtcbiAgICAgICAgfSxcblxuICAgICAgICB2ZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gTWV0cm8udmVyc2lvbjtcbiAgICAgICAgfSxcblxuICAgICAgICBidWlsZDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiBNZXRyby5idWlsZDtcbiAgICAgICAgfSxcblxuICAgICAgICBjb21waWxlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIE1ldHJvLmNvbXBpbGVUaW1lO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9ic2VydmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgb2JzZXJ2ZXIsIG9ic2VydmVyQ2FsbGJhY2s7XG4gICAgICAgICAgICB2YXIgb2JzZXJ2ZXJDb25maWcgPSB7XG4gICAgICAgICAgICAgICAgY2hpbGRMaXN0OiB0cnVlLFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgc3VidHJlZTogdHJ1ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIG9ic2VydmVyQ2FsbGJhY2sgPSBmdW5jdGlvbihtdXRhdGlvbnMpe1xuICAgICAgICAgICAgICAgIG11dGF0aW9ucy5tYXAoZnVuY3Rpb24obXV0YXRpb24pe1xuICAgICAgICAgICAgICAgICAgICBpZiAobXV0YXRpb24udHlwZSA9PT0gJ2F0dHJpYnV0ZXMnICYmIG11dGF0aW9uLmF0dHJpYnV0ZU5hbWUgIT09IFwiZGF0YS1yb2xlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtdXRhdGlvbi5hdHRyaWJ1dGVOYW1lID09PSAnZGF0YS1ob3RrZXknKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTWV0cm8uaW5pdEhvdGtleXMoW211dGF0aW9uLnRhcmdldF0sIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9ICQobXV0YXRpb24udGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWMgPSBlbGVtZW50LmRhdGEoJ21ldHJvQ29tcG9uZW50Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHIgPSBtdXRhdGlvbi5hdHRyaWJ1dGVOYW1lLCBuZXdWYWx1ZSA9IGVsZW1lbnQuYXR0cihhdHRyKSwgb2xkVmFsdWUgPSBtdXRhdGlvbi5vbGRWYWx1ZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmlyZShcImF0dHItY2hhbmdlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHI6IGF0dHIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdWYWx1ZTogbmV3VmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZTogb2xkVmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXM6IGVsZW1lbnRbMF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKG1jLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBsdWcgPSBNZXRyby5nZXRQbHVnaW4oZWxlbWVudCwgdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGx1ZyAmJiB0eXBlb2YgcGx1Zy5jaGFuZ2VBdHRyaWJ1dGUgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsdWcuY2hhbmdlQXR0cmlidXRlKGF0dHIsIG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlXG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG11dGF0aW9uLnR5cGUgPT09ICdjaGlsZExpc3QnICYmIG11dGF0aW9uLmFkZGVkTm9kZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGksIHdpZGdldHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkbm9kZSwgbm9kZSwgbm9kZXMgPSBtdXRhdGlvbi5hZGRlZE5vZGVzO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGVzW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbm9kZSA9ICQobm9kZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRub2RlLmF0dHIoXCJkYXRhLXJvbGVcIikgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkZ2V0cy5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKCRub2RlLmZpbmQoXCJbZGF0YS1yb2xlXVwiKSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aWRnZXRzLmluZGV4T2YobykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkZ2V0cy5wdXNoKG8pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2lkZ2V0cy5sZW5ndGgpIE1ldHJvLmluaXRXaWRnZXRzKHdpZGdldHMsIFwib2JzZXJ2ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKG9ic2VydmVyQ2FsbGJhY2spO1xuICAgICAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZSgkKFwiaHRtbFwiKVswXSwgb2JzZXJ2ZXJDb25maWcpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgd2lkZ2V0cyA9ICQoXCJbZGF0YS1yb2xlXVwiKTtcbiAgICAgICAgICAgIHZhciBob3RrZXlzID0gJChcIltkYXRhLWhvdGtleV1cIik7XG4gICAgICAgICAgICB2YXIgaHRtbCA9ICQoXCJodG1sXCIpO1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAod2luZG93Lk1FVFJPX0JMVVJfSU1BR0UpIHtcbiAgICAgICAgICAgICAgICBodG1sLmFkZENsYXNzKFwidXNlLWJsdXItaW1hZ2VcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh3aW5kb3cuTUVUUk9fU0hPV19BQk9VVCkgTWV0cm8uaW5mbyh0cnVlKTtcblxuICAgICAgICAgICAgaWYgKGlzVG91Y2ggPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBodG1sLmFkZENsYXNzKFwibWV0cm8tdG91Y2gtZGV2aWNlXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBodG1sLmFkZENsYXNzKFwibWV0cm8tbm8tdG91Y2gtZGV2aWNlXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBNZXRyby5zaGVldCA9IHRoaXMudXRpbHMubmV3Q3NzU2hlZXQoKTtcblxuICAgICAgICAgICAgdGhpcy51dGlscy5hZGRDc3NSdWxlKE1ldHJvLnNoZWV0LCBcIiosICo6OmJlZm9yZSwgKjo6YWZ0ZXJcIiwgXCJib3gtc2l6aW5nOiBib3JkZXItYm94O1wiKTtcblxuICAgICAgICAgICAgd2luZG93Lk1FVFJPX01FRElBID0gW107XG4gICAgICAgICAgICAkLmVhY2goTWV0cm8ubWVkaWFfcXVlcmllcywgZnVuY3Rpb24oa2V5LCBxdWVyeSl7XG4gICAgICAgICAgICAgICAgaWYgKHRoYXQudXRpbHMubWVkaWEocXVlcnkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5NRVRST19NRURJQS5wdXNoKE1ldHJvLm1lZGlhX21vZGVba2V5XSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIE1ldHJvLm9ic2VydmUoKTtcblxuICAgICAgICAgICAgTWV0cm8uaW5pdEhvdGtleXMoaG90a2V5cyk7XG4gICAgICAgICAgICBNZXRyby5pbml0V2lkZ2V0cyh3aWRnZXRzLCBcImluaXRcIik7XG5cbiAgICAgICAgICAgIGlmICh3aW5kb3cuTUVUUk9fQ0xPQUtfUkVNT1ZFICE9PSBcImZhZGVcIikge1xuICAgICAgICAgICAgICAgICQoXCIubTQtY2xvYWtcIikucmVtb3ZlQ2xhc3MoXCJtNC1jbG9ha1wiKTtcbiAgICAgICAgICAgICAgICAkKHdpbmRvdykuZmlyZShcIm1ldHJvLWluaXRpYXRlZFwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJChcIi5tNC1jbG9ha1wiKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBkdXI6IDMwMCxcbiAgICAgICAgICAgICAgICAgICAgb25Eb25lOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgJChcIi5tNC1jbG9ha1wiKS5yZW1vdmVDbGFzcyhcIm00LWNsb2FrXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh3aW5kb3cpLmZpcmUoXCJtZXRyby1pbml0aWF0ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpbml0SG90a2V5czogZnVuY3Rpb24oaG90a2V5cywgcmVkZWZpbmUpe1xuICAgICAgICAgICAgJC5lYWNoKGhvdGtleXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIHZhciBob3RrZXkgPSBlbGVtZW50LmF0dHIoJ2RhdGEtaG90a2V5JykgPyBlbGVtZW50LmF0dHIoJ2RhdGEtaG90a2V5JykudG9Mb3dlckNhc2UoKSA6IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZhciBmbiA9IGVsZW1lbnQuYXR0cignZGF0YS1ob3RrZXktZnVuYycpID8gZWxlbWVudC5hdHRyKCdkYXRhLWhvdGtleS1mdW5jJykgOiBmYWxzZTtcblxuICAgICAgICAgICAgICAgIGlmIChob3RrZXkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5kYXRhKCdob3RLZXlCb25kZWQnKSA9PT0gdHJ1ZSAmJiByZWRlZmluZSAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgTWV0cm8uaG90a2V5c1tob3RrZXldID0gW3RoaXMsIGZuXTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmRhdGEoJ2hvdEtleUJvbmRlZCcsIHRydWUpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuZmlyZShcImhvdC1rZXktYm9uZGVkXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzOiBlbGVtZW50WzBdLFxuICAgICAgICAgICAgICAgICAgICBob3RrZXk6IGhvdGtleSxcbiAgICAgICAgICAgICAgICAgICAgZm46IGZuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0V2lkZ2V0czogZnVuY3Rpb24od2lkZ2V0cykge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICAkLmVhY2god2lkZ2V0cywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyksIHJvbGVzO1xuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmhhc0F0dHJpYnV0ZShcImRhdGEtcm9sZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJvbGVzID0gJHRoaXMuYXR0cignZGF0YS1yb2xlJykuc3BsaXQoL1xccyosXFxzKi8pO1xuXG4gICAgICAgICAgICAgICAgcm9sZXMubWFwKGZ1bmN0aW9uIChmdW5jKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyICQkID0gdGhhdC51dGlscy4kKCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfZnVuYyA9IG5vcm1hbGl6ZUNvbXBvbmVudE5hbWUoZnVuYyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCQkLmZuW19mdW5jXSAhPT0gdW5kZWZpbmVkICYmICR0aGlzLmF0dHIoXCJkYXRhLXJvbGUtXCIrX2Z1bmMpID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCQuZm5bX2Z1bmNdLmNhbGwoJHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmF0dHIoXCJkYXRhLXJvbGUtXCIrX2Z1bmMsIHRydWUpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1jID0gJHRoaXMuZGF0YSgnbWV0cm9Db21wb25lbnQnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1jID0gW19mdW5jXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYy5wdXNoKF9mdW5jKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuZGF0YSgnbWV0cm9Db21wb25lbnQnLCBtYyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5maXJlKFwiY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzOiAkdGhpc1swXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogX2Z1bmNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5maXJlKFwiY29tcG9uZW50LWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6ICR0aGlzWzBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBfZnVuY1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjcmVhdGluZyBjb21wb25lbnQgXCIgKyBmdW5jICsgXCIgZm9yIFwiLCAkdGhpc1swXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcGx1Z2luOiBmdW5jdGlvbihuYW1lLCBvYmplY3Qpe1xuICAgICAgICAgICAgdmFyIF9uYW1lID0gbm9ybWFsaXplQ29tcG9uZW50TmFtZShuYW1lKTtcblxuICAgICAgICAgICAgdmFyIHJlZ2lzdGVyID0gZnVuY3Rpb24oJCl7XG4gICAgICAgICAgICAgICAgJC5mbltfbmFtZV0gPSBmdW5jdGlvbiggb3B0aW9ucyApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZGF0YSggdGhpcywgX25hbWUsIE9iamVjdC5jcmVhdGUob2JqZWN0KS5pbml0KG9wdGlvbnMsIHRoaXMgKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlZ2lzdGVyKG00cSk7XG5cbiAgICAgICAgICAgIGlmICh3aW5kb3cudXNlSlF1ZXJ5KSB7XG4gICAgICAgICAgICAgICAgcmVnaXN0ZXIoalF1ZXJ5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBwbHVnaW5FeGlzdHM6IGZ1bmN0aW9uKG5hbWUpe1xuICAgICAgICAgICAgdmFyICQgPSB3aW5kb3cudXNlSlF1ZXJ5ID8galF1ZXJ5IDogbTRxO1xuICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiAkLmZuW25vcm1hbGl6ZUNvbXBvbmVudE5hbWUobmFtZSldID09PSBcImZ1bmN0aW9uXCI7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveVBsdWdpbjogZnVuY3Rpb24oZWxlbWVudCwgbmFtZSl7XG4gICAgICAgICAgICB2YXIgcCwgbWM7XG4gICAgICAgICAgICB2YXIgZWwgPSAkKGVsZW1lbnQpO1xuICAgICAgICAgICAgdmFyIF9uYW1lID0gbm9ybWFsaXplQ29tcG9uZW50TmFtZShuYW1lKTtcblxuICAgICAgICAgICAgcCA9IE1ldHJvLmdldFBsdWdpbihlbCwgX25hbWUpO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIHAgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwiQ29tcG9uZW50IFwiK25hbWUrXCIgY2FuIG5vdCBiZSBkZXN0cm95ZWQ6IHRoZSBlbGVtZW50IGlzIG5vdCBhIE1ldHJvIDQgY29tcG9uZW50LlwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZW9mIHBbJ2Rlc3Ryb3knXSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcIkNvbXBvbmVudCBcIituYW1lK1wiIGNhbiBub3QgYmUgZGVzdHJveWVkOiBtZXRob2QgZGVzdHJveSBub3QgZm91bmQuXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBbJ2Rlc3Ryb3knXSgpO1xuICAgICAgICAgICAgbWMgPSBlbC5kYXRhKFwibWV0cm9Db21wb25lbnRcIik7XG4gICAgICAgICAgICB0aGlzLnV0aWxzLmFycmF5RGVsZXRlKG1jLCBfbmFtZSk7XG4gICAgICAgICAgICBlbC5kYXRhKFwibWV0cm9Db21wb25lbnRcIiwgbWMpO1xuICAgICAgICAgICAgJC5yZW1vdmVEYXRhKGVsWzBdLCBfbmFtZSk7XG4gICAgICAgICAgICBlbC5yZW1vdmVBdHRyKFwiZGF0YS1yb2xlLVwiK19uYW1lKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95UGx1Z2luQWxsOiBmdW5jdGlvbihlbGVtZW50KXtcbiAgICAgICAgICAgIHZhciBlbCA9ICQoZWxlbWVudCk7XG4gICAgICAgICAgICB2YXIgbWMgPSBlbC5kYXRhKFwibWV0cm9Db21wb25lbnRcIik7XG5cbiAgICAgICAgICAgIGlmIChtYyAhPT0gdW5kZWZpbmVkICYmIG1jLmxlbmd0aCA+IDApICQuZWFjaChtYywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBNZXRyby5kZXN0cm95UGx1Z2luKGVsWzBdLCB0aGlzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIG5vb3A6IGZ1bmN0aW9uKCl7fSxcbiAgICAgICAgbm9vcF90cnVlOiBmdW5jdGlvbigpe3JldHVybiB0cnVlO30sXG4gICAgICAgIG5vb3BfZmFsc2U6IGZ1bmN0aW9uKCl7cmV0dXJuIGZhbHNlO30sXG5cbiAgICAgICAgcmVxdWVzdEZ1bGxTY3JlZW46IGZ1bmN0aW9uKGVsZW1lbnQpe1xuICAgICAgICAgICAgaWYgKGVsZW1lbnRbXCJtb3pSZXF1ZXN0RnVsbFNjcmVlblwiXSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnRbXCJtb3pSZXF1ZXN0RnVsbFNjcmVlblwiXSgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50W1wid2Via2l0UmVxdWVzdEZ1bGxTY3JlZW5cIl0pIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50W1wid2Via2l0UmVxdWVzdEZ1bGxTY3JlZW5cIl0oKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudFtcIm1zUmVxdWVzdEZ1bGxzY3JlZW5cIl0pIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50W1wibXNSZXF1ZXN0RnVsbHNjcmVlblwiXSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnJlcXVlc3RGdWxsc2NyZWVuKCkuY2F0Y2goIGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcIkVycm9yIGF0dGVtcHRpbmcgdG8gZW5hYmxlIGZ1bGwtc2NyZWVuIG1vZGU6IFwiK2Vyci5tZXNzYWdlK1wiIFwiK2Vyci5uYW1lKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBleGl0RnVsbFNjcmVlbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmIChkb2N1bWVudFtcIm1vekNhbmNlbEZ1bGxTY3JlZW5cIl0pIHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudFtcIm1vekNhbmNlbEZ1bGxTY3JlZW5cIl0oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGRvY3VtZW50W1wid2Via2l0Q2FuY2VsRnVsbFNjcmVlblwiXSkge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50W1wid2Via2l0Q2FuY2VsRnVsbFNjcmVlblwiXSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZG9jdW1lbnRbXCJtc0V4aXRGdWxsc2NyZWVuXCJdKSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnRbXCJtc0V4aXRGdWxsc2NyZWVuXCJdKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKCkuY2F0Y2goIGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcIkVycm9yIGF0dGVtcHRpbmcgdG8gZGlzYWJsZSBmdWxsLXNjcmVlbiBtb2RlOiBcIitlcnIubWVzc2FnZStcIiBcIitlcnIubmFtZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5GdWxsU2NyZWVuOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGZzbSA9IChkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCB8fCBkb2N1bWVudFtcIndlYmtpdEZ1bGxzY3JlZW5FbGVtZW50XCJdIHx8IGRvY3VtZW50W1wibW96RnVsbFNjcmVlbkVsZW1lbnRcIl0gfHwgZG9jdW1lbnRbXCJtc0Z1bGxzY3JlZW5FbGVtZW50XCJdKTtcbiAgICAgICAgICAgIHJldHVybiBmc20gIT09IHVuZGVmaW5lZDtcbiAgICAgICAgfSxcblxuICAgICAgICAkOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy51c2VKUXVlcnkgPyBqUXVlcnkgOiBtNHE7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0JGVsOiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICByZXR1cm4gTWV0cm8uJCgpKCQoZWwpWzBdKTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXQkZWxlbWVudHM6IGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIHJldHVybiBNZXRyby4kKCkoJChlbCkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIFRPRE8gYWRkIGlmIG5hbWUgaXMgbm90IGRlZmluZWQsIHJldHVybiBvbmUgb3IgYXJyYXkgb2YgcGx1Z2luc1xuICAgICAgICBnZXRQbHVnaW46IGZ1bmN0aW9uKGVsLCBuYW1lKXtcbiAgICAgICAgICAgIHZhciBfbmFtZSA9IG5vcm1hbGl6ZUNvbXBvbmVudE5hbWUobmFtZSk7XG4gICAgICAgICAgICB2YXIgJGVsID0gTWV0cm8uZ2V0JGVsKGVsKTtcbiAgICAgICAgICAgIHJldHVybiAkZWwubGVuZ3RoID8gJGVsLmRhdGEoX25hbWUpIDogdW5kZWZpbmVkO1xuICAgICAgICB9LFxuXG4gICAgICAgIG1ha2VQbHVnaW46IGZ1bmN0aW9uKGVsLCBuYW1lLCBvcHRpb25zKXtcbiAgICAgICAgICAgIHZhciBfbmFtZSA9IG5vcm1hbGl6ZUNvbXBvbmVudE5hbWUobmFtZSk7XG4gICAgICAgICAgICB2YXIgJGVsID0gTWV0cm8uZ2V0JGVsZW1lbnRzKGVsKTtcbiAgICAgICAgICAgIHJldHVybiAkZWwubGVuZ3RoICYmIHR5cGVvZiAkZWxbX25hbWVdID09PSBcImZ1bmN0aW9uXCIgPyAkZWxbX25hbWVdKG9wdGlvbnMpIDogdW5kZWZpbmVkO1xuICAgICAgICB9LFxuXG4gICAgICAgIENvbXBvbmVudDogZnVuY3Rpb24obmFtZU5hbWUsIGNvbXBPYmope1xuICAgICAgICAgICAgdmFyIG5hbWUgPSBub3JtYWxpemVDb21wb25lbnROYW1lKG5hbWVOYW1lKTtcbiAgICAgICAgICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgICAgICAgICAgdmFyIGNvbXBvbmVudCA9ICQuZXh0ZW5kKHtuYW1lOiBuYW1lfSwge1xuICAgICAgICAgICAgICAgIF9zdXBlcjogZnVuY3Rpb24oZWwsIG9wdGlvbnMsIGRlZmF1bHRzLCBzZXR1cCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW0gPSBlbDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50ID0gJChlbCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKCB7fSwgZGVmYXVsdHMsIG9wdGlvbnMgKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wb25lbnQgPSB0aGlzLmVsZW07XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0T3B0aW9uc0Zyb21ET00oKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZXR1cCAmJiB0eXBlb2Ygc2V0dXAgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goc2V0dXAsIGZ1bmN0aW9uKGtleSwgdmFsKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmW2tleV0gPSB2YWw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlRXhlYygpO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBfc2V0T3B0aW9uc0Zyb21ET006IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICAgICAgICAgICQuZWFjaChlbGVtZW50LmRhdGEoKSwgZnVuY3Rpb24oa2V5LCB2YWx1ZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5IGluIG8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvW2tleV0gPSBKU09OLnBhcnNlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIF9ydW50aW1lOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbWM7XG4gICAgICAgICAgICAgICAgICAgIHZhciByb2xlcyA9IChlbGVtZW50LmF0dHIoXCJkYXRhLXJvbGVcIikgfHwgXCJcIikudG9BcnJheShcIixcIikubWFwKGZ1bmN0aW9uKHYpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZUNvbXBvbmVudE5hbWUodik7XG4gICAgICAgICAgICAgICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbih2KXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2LnRyaW0oKSAhPT0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlbGVtZW50LmF0dHIoJ2RhdGEtcm9sZS0nK3RoaXMubmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcImRhdGEtcm9sZS1cIit0aGlzLm5hbWUsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvbGVzLmluZGV4T2YodGhpcy5uYW1lKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb2xlcy5wdXNoKHRoaXMubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwiZGF0YS1yb2xlXCIsIHJvbGVzLmpvaW4oXCIsXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgbWMgPSBlbGVtZW50LmRhdGEoJ21ldHJvQ29tcG9uZW50Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobWMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1jID0gW3RoaXMubmFtZV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1jLnB1c2godGhpcy5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZGF0YSgnbWV0cm9Db21wb25lbnQnLCBtYyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgX2NyZWF0ZUV4ZWM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgdGltZW91dCA9IHRoaXMub3B0aW9uc1t0aGlzLm5hbWUrJ0RlZmVycmVkJ107XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9jcmVhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRpbWVvdXQpXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9jcmVhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBfZmlyZUV2ZW50OiBmdW5jdGlvbihldmVudE5hbWUsIGRhdGEsIGxvZywgbm9GaXJlKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50ID0gJC5jYW1lbENhc2UoZXZlbnROYW1lKS5jYXBpdGFsaXplKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9ICQuZXh0ZW5kKHt9LCBkYXRhLCB7X190aGlzOiBlbGVtZW50WzBdfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgX2RhdGEgPSBkYXRhID8gT2JqZWN0LnZhbHVlcyhkYXRhKSA6IHt9O1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChsb2cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2Fybihsb2cpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwiRXZlbnQ6IFwiICsgXCJvblwiK2V2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcIkRhdGE6IFwiLCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcIkVsZW1lbnQ6IFwiLCBlbGVtZW50WzBdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChub0ZpcmUgIT09IHRydWUpXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpcmUoZXZlbnQudG9Mb3dlckNhc2UoKSwgZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFV0aWxzLmV4ZWMob1tcIm9uXCIrZXZlbnRdLCBfZGF0YSwgZWxlbWVudFswXSk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIF9maXJlRXZlbnRzOiBmdW5jdGlvbihldmVudHMsIGRhdGEsIGxvZywgbm9GaXJlKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBfZXZlbnRzO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGV2ZW50cywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBldiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KGV2Lm5hbWUsIGV2LmRhdGEsIGV2LmxvZywgZXYubm9GaXJlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVXRpbHMub2JqZWN0TGVuZ3RoKGV2ZW50cyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZXZlbnRzKSAmJiB0eXBlb2YgZXZlbnRzICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgX2V2ZW50cyA9IEFycmF5LmlzQXJyYXkoZXZlbnRzKSA/IGV2ZW50cyA6IGV2ZW50cy50b0FycmF5KFwiLFwiKTtcblxuICAgICAgICAgICAgICAgICAgICAkLmVhY2goX2V2ZW50cywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudCh0aGlzLCBkYXRhLCBsb2csIG5vRmlyZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBnZXRDb21wb25lbnQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudDtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgZ2V0Q29tcG9uZW50TmFtZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmFtZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBjb21wT2JqKTtcblxuICAgICAgICAgICAgTWV0cm8ucGx1Z2luKG5hbWUsIGNvbXBvbmVudCk7XG5cbiAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZmV0Y2g6IHtcbiAgICAgICAgICAgIHN0YXR1czogZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5vayA/IFByb21pc2UucmVzb2x2ZShyZXNwb25zZSkgOiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IocmVzcG9uc2Uuc3RhdHVzVGV4dCkpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAganNvbjogZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICB0ZXh0OiBmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGZvcm06IGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZm9ybURhdGEoKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGJsb2I6IGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuYmxvYigpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgYnVmZmVyOiBmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmFycmF5QnVmZmVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJCh3aW5kb3cpLm9uKE1ldHJvLmV2ZW50cy5yZXNpemUsIGZ1bmN0aW9uKCl7XG4gICAgICAgIHdpbmRvdy5NRVRST19NRURJQSA9IFtdO1xuICAgICAgICAkLmVhY2goTWV0cm8ubWVkaWFfcXVlcmllcywgZnVuY3Rpb24oa2V5LCBxdWVyeSl7XG4gICAgICAgICAgICBpZiAoTWV0cm8udXRpbHMubWVkaWEocXVlcnkpKSB7XG4gICAgICAgICAgICAgICAgd2luZG93Lk1FVFJPX01FRElBLnB1c2goTWV0cm8ubWVkaWFfbW9kZVtrZXldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB3aW5kb3cuTWV0cm8gPSBNZXRybztcblxuICAgIGlmICh3aW5kb3cuTUVUUk9fSU5JVCA9PT0gIHRydWUpIHtcbiAgICAgICAgJChmdW5jdGlvbigpe1xuICAgICAgICAgICAgTWV0cm8uaW5pdCgpXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBNZXRybztcbn0oKSk7XG5cclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICQuZXh0ZW5kKE1ldHJvWydsb2NhbGVzJ10sIHtcbiAgICAgICAgJ2RhLURLJzoge1xuICAgICAgICAgICAgXCJjYWxlbmRhclwiOiB7XG4gICAgICAgICAgICAgICAgXCJtb250aHNcIjogW1xuICAgICAgICAgICAgICAgICAgICBcIkphbnVhclwiLCBcIkZlYnJ1YXJcIiwgXCJNYXJ0c1wiLCBcIkFwcmlsXCIsIFwiTWFqXCIsIFwiSnVuaVwiLCBcIkp1bGlcIiwgXCJBdWd1c3RcIiwgXCJTZXB0ZW1iZXJcIiwgXCJPa3RvYmVyXCIsIFwiTm92ZW1iZXJcIiwgXCJEZWNlbWJlclwiLFxuICAgICAgICAgICAgICAgICAgICBcIkphblwiLCBcIkZlYlwiLCBcIk1hclwiLCBcIkFwclwiLCBcIk1halwiLCBcIkp1blwiLCBcIkp1bFwiLCBcIkF1Z1wiLCBcIlNlcFwiLCBcIk9rdFwiLCBcIk5vdlwiLCBcIkRlY1wiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcImRheXNcIjogW1xuICAgICAgICAgICAgICAgICAgICBcIlPDuG5kYWdcIiwgXCJNYW5kYWdcIiwgXCJUaXJzZGFnXCIsIFwiT25zZGFnXCIsIFwiVG9yc2RhZ1wiLCBcIkZyZWRhZ1wiLCBcIkzDuHJkYWdcIixcbiAgICAgICAgICAgICAgICAgICAgXCJTw7hcIiwgXCJNYVwiLCBcIlRpXCIsIFwiT25cIiwgXCJUb1wiLCBcIkZyXCIsIFwiTMO4XCIsXG4gICAgICAgICAgICAgICAgICAgIFwiU8O4blwiLCBcIk1hblwiLCBcIlRpclwiLCBcIk9uc1wiLCBcIlRvclwiLCBcIkZyZVwiLCBcIkzDuHJcIlxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXCJ0aW1lXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJkYXlzXCI6IFwiREFHRVwiLFxuICAgICAgICAgICAgICAgICAgICBcImhvdXJzXCI6IFwiVElNRVJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJtaW51dGVzXCI6IFwiTUlOXCIsXG4gICAgICAgICAgICAgICAgICAgIFwic2Vjb25kc1wiOiBcIlNFS1wiLFxuICAgICAgICAgICAgICAgICAgICBcIm1vbnRoXCI6IFwiTU9OXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZGF5XCI6IFwiREFHXCIsXG4gICAgICAgICAgICAgICAgICAgIFwieWVhclwiOiBcIsOFUlwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBcIndlZWtTdGFydFwiOiAxXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJidXR0b25zXCI6IHtcbiAgICAgICAgICAgICAgICBcIm9rXCI6IFwiT0tcIixcbiAgICAgICAgICAgICAgICBcImNhbmNlbFwiOiBcIkFubnVsbGVyXCIsXG4gICAgICAgICAgICAgICAgXCJkb25lXCI6IFwiRsOmcmRpZ1wiLFxuICAgICAgICAgICAgICAgIFwidG9kYXlcIjogXCJJZGFnXCIsXG4gICAgICAgICAgICAgICAgXCJub3dcIjogXCJOdVwiLFxuICAgICAgICAgICAgICAgIFwiY2xlYXJcIjogXCJSeWRcIixcbiAgICAgICAgICAgICAgICBcImhlbHBcIjogXCJIasOmbHBcIixcbiAgICAgICAgICAgICAgICBcInllc1wiOiBcIkphXCIsXG4gICAgICAgICAgICAgICAgXCJub1wiOiBcIk5lalwiLFxuICAgICAgICAgICAgICAgIFwicmFuZG9tXCI6IFwiVGlsZsOmbGRpZ1wiLFxuICAgICAgICAgICAgICAgIFwic2F2ZVwiOiBcIkdlbVwiLFxuICAgICAgICAgICAgICAgIFwicmVzZXRcIjogXCJOdWxzdGlsXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInRhYmxlXCI6IHtcbiAgICAgICAgICAgICAgICBcInJvd3NDb3VudFwiOiBcIlNob3cgZW50cmllczpcIixcbiAgICAgICAgICAgICAgICBcInNlYXJjaFwiOiBcIlNlYXJjaDpcIixcbiAgICAgICAgICAgICAgICBcImluZm9cIjogXCJTaG93aW5nICQxIHRvICQyIG9mICQzIGVudHJpZXNcIixcbiAgICAgICAgICAgICAgICBcInByZXZcIjogXCJQcmV2XCIsXG4gICAgICAgICAgICAgICAgXCJuZXh0XCI6IFwiTmV4dFwiLFxuICAgICAgICAgICAgICAgIFwiYWxsXCI6IFwiQWxsXCIsXG4gICAgICAgICAgICAgICAgXCJpbnNwZWN0b3JcIjogXCJJbnNwZWN0b3JcIixcbiAgICAgICAgICAgICAgICBcInNraXBcIjogXCJHb3RvIHBhZ2VcIixcbiAgICAgICAgICAgICAgICBcImVtcHR5XCI6IFwiTm90aGluZyB0byBzaG93XCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImNvbG9yU2VsZWN0b3JcIjoge1xuICAgICAgICAgICAgICAgIGFkZFVzZXJDb2xvckJ1dHRvbjogXCJBREQgVE8gU1dBVENIRVNcIixcbiAgICAgICAgICAgICAgICB1c2VyQ29sb3JzVGl0bGU6IFwiVVNFUiBDT0xPUlNcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwic3dpdGNoXCI6IHtcbiAgICAgICAgICAgICAgICBvbjogXCJvblwiLFxuICAgICAgICAgICAgICAgIG9mZjogXCJvZmZcIlxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICQuZXh0ZW5kKE1ldHJvLmxvY2FsZXMsIHtcbiAgICAgICAgJ2RlLURFJzoge1xuICAgICAgICAgICAgXCJjYWxlbmRhclwiOiB7XG4gICAgICAgICAgICAgICAgXCJtb250aHNcIjogW1xuICAgICAgICAgICAgICAgICAgICBcIkphbnVhclwiLCBcIkZlYnJ1YXJcIiwgXCJNw6RyelwiLCBcIkFwcmlsXCIsIFwiTWFpXCIsIFwiSnVuaVwiLCBcIkp1bGlcIiwgXCJBdWd1c3RcIiwgXCJTZXB0ZW1iZXJcIiwgXCJPa3RvYmVyXCIsIFwiTm92ZW1iZXJcIiwgXCJEZXplbWJlclwiLFxuICAgICAgICAgICAgICAgICAgICBcIkphblwiLCBcIkZlYlwiLCBcIk3DpHJcIiwgXCJBcHJcIiwgXCJNYWlcIiwgXCJKdW5cIiwgXCJKdWxcIiwgXCJBdWdcIiwgXCJTZXBcIiwgXCJPa3RcIiwgXCJOb3ZcIiwgXCJEZXpcIlxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXCJkYXlzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgXCJTb25udGFnXCIsIFwiTW9udGFnXCIsIFwiRGllbnN0YWdcIiwgXCJNaXR0d29jaFwiLCBcIkRvbm5lcnN0YWdcIiwgXCJGcmVpdGFnXCIsIFwiU2Ftc3RhZ1wiLFxuICAgICAgICAgICAgICAgICAgICBcIlNvXCIsIFwiTW9cIiwgXCJEaVwiLCBcIk1pXCIsIFwiRG9cIiwgXCJGclwiLCBcIlNhXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiU29uXCIsIFwiTW9uXCIsIFwiRGllXCIsIFwiTWl0XCIsIFwiRG9uXCIsIFwiRnJlXCIsIFwiU2FtXCJcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIFwidGltZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIFwiZGF5c1wiOiBcIlRBR0VcIixcbiAgICAgICAgICAgICAgICAgICAgXCJob3Vyc1wiOiBcIlNURFwiLFxuICAgICAgICAgICAgICAgICAgICBcIm1pbnV0ZXNcIjogXCJNSU5cIixcbiAgICAgICAgICAgICAgICAgICAgXCJzZWNvbmRzXCI6IFwiU0VLXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwid2Vla1N0YXJ0XCI6IDJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImJ1dHRvbnNcIjoge1xuICAgICAgICAgICAgICAgIFwib2tcIjogXCJPS1wiLFxuICAgICAgICAgICAgICAgIFwiY2FuY2VsXCI6IFwiQWJicmVjaGVuXCIsXG4gICAgICAgICAgICAgICAgXCJkb25lXCI6IFwiRmVydGlnXCIsXG4gICAgICAgICAgICAgICAgXCJ0b2RheVwiOiBcIkhldXRlXCIsXG4gICAgICAgICAgICAgICAgXCJub3dcIjogXCJKZXR6dFwiLFxuICAgICAgICAgICAgICAgIFwiY2xlYXJcIjogXCJMw7ZzY2hlblwiLFxuICAgICAgICAgICAgICAgIFwiaGVscFwiOiBcIkhpbGZlXCIsXG4gICAgICAgICAgICAgICAgXCJ5ZXNcIjogXCJKYVwiLFxuICAgICAgICAgICAgICAgIFwibm9cIjogXCJOZWluXCIsXG4gICAgICAgICAgICAgICAgXCJyYW5kb21cIjogXCJadWbDpGxsaWdcIixcbiAgICAgICAgICAgICAgICBcInNhdmVcIjogXCJTcGVpY2hlcm5cIixcbiAgICAgICAgICAgICAgICBcInJlc2V0XCI6IFwiWnVyw7xja3NldHplblwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJ0YWJsZVwiOiB7XG4gICAgICAgICAgICAgICAgXCJyb3dzQ291bnRcIjogXCJTaG93IGVudHJpZXM6XCIsXG4gICAgICAgICAgICAgICAgXCJzZWFyY2hcIjogXCJTZWFyY2g6XCIsXG4gICAgICAgICAgICAgICAgXCJpbmZvXCI6IFwiU2hvd2luZyAkMSB0byAkMiBvZiAkMyBlbnRyaWVzXCIsXG4gICAgICAgICAgICAgICAgXCJwcmV2XCI6IFwiUHJldlwiLFxuICAgICAgICAgICAgICAgIFwibmV4dFwiOiBcIk5leHRcIixcbiAgICAgICAgICAgICAgICBcImFsbFwiOiBcIkFsbFwiLFxuICAgICAgICAgICAgICAgIFwiaW5zcGVjdG9yXCI6IFwiSW5zcGVjdG9yXCIsXG4gICAgICAgICAgICAgICAgXCJza2lwXCI6IFwiR290byBwYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJlbXB0eVwiOiBcIk5vdGhpbmcgdG8gc2hvd1wiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJjb2xvclNlbGVjdG9yXCI6IHtcbiAgICAgICAgICAgICAgICBhZGRVc2VyQ29sb3JCdXR0b246IFwiQUREIFRPIFNXQVRDSEVTXCIsXG4gICAgICAgICAgICAgICAgdXNlckNvbG9yc1RpdGxlOiBcIlVTRVIgQ09MT1JTXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInN3aXRjaFwiOiB7XG4gICAgICAgICAgICAgICAgb246IFwib25cIixcbiAgICAgICAgICAgICAgICBvZmY6IFwib2ZmXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAkLmV4dGVuZChNZXRyby5sb2NhbGVzLCB7XG4gICAgICAgICdlbi1VUyc6IHtcbiAgICAgICAgICAgIFwiY2FsZW5kYXJcIjoge1xuICAgICAgICAgICAgICAgIFwibW9udGhzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgXCJKYW51YXJ5XCIsIFwiRmVicnVhcnlcIiwgXCJNYXJjaFwiLCBcIkFwcmlsXCIsIFwiTWF5XCIsIFwiSnVuZVwiLCBcIkp1bHlcIiwgXCJBdWd1c3RcIiwgXCJTZXB0ZW1iZXJcIiwgXCJPY3RvYmVyXCIsIFwiTm92ZW1iZXJcIiwgXCJEZWNlbWJlclwiLFxuICAgICAgICAgICAgICAgICAgICBcIkphblwiLCBcIkZlYlwiLCBcIk1hclwiLCBcIkFwclwiLCBcIk1heVwiLCBcIkp1blwiLCBcIkp1bFwiLCBcIkF1Z1wiLCBcIlNlcFwiLCBcIk9jdFwiLCBcIk5vdlwiLCBcIkRlY1wiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcImRheXNcIjogW1xuICAgICAgICAgICAgICAgICAgICBcIlN1bmRheVwiLCBcIk1vbmRheVwiLCBcIlR1ZXNkYXlcIiwgXCJXZWRuZXNkYXlcIiwgXCJUaHVyc2RheVwiLCBcIkZyaWRheVwiLCBcIlNhdHVyZGF5XCIsXG4gICAgICAgICAgICAgICAgICAgIFwiU3VcIiwgXCJNb1wiLCBcIlR1XCIsIFwiV2VcIiwgXCJUaFwiLCBcIkZyXCIsIFwiU2FcIixcbiAgICAgICAgICAgICAgICAgICAgXCJTdW5cIiwgXCJNb25cIiwgXCJUdXNcIiwgXCJXZW5cIiwgXCJUaHVcIiwgXCJGcmlcIiwgXCJTYXRcIlxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXCJ0aW1lXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJkYXlzXCI6IFwiREFZU1wiLFxuICAgICAgICAgICAgICAgICAgICBcImhvdXJzXCI6IFwiSE9VUlNcIixcbiAgICAgICAgICAgICAgICAgICAgXCJtaW51dGVzXCI6IFwiTUlOU1wiLFxuICAgICAgICAgICAgICAgICAgICBcInNlY29uZHNcIjogXCJTRUNTXCIsXG4gICAgICAgICAgICAgICAgICAgIFwibW9udGhcIjogXCJNT05cIixcbiAgICAgICAgICAgICAgICAgICAgXCJkYXlcIjogXCJEQVlcIixcbiAgICAgICAgICAgICAgICAgICAgXCJ5ZWFyXCI6IFwiWUVBUlwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBcIndlZWtTdGFydFwiOiAwXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJidXR0b25zXCI6IHtcbiAgICAgICAgICAgICAgICBcIm9rXCI6IFwiT0tcIixcbiAgICAgICAgICAgICAgICBcImNhbmNlbFwiOiBcIkNhbmNlbFwiLFxuICAgICAgICAgICAgICAgIFwiZG9uZVwiOiBcIkRvbmVcIixcbiAgICAgICAgICAgICAgICBcInRvZGF5XCI6IFwiVG9kYXlcIixcbiAgICAgICAgICAgICAgICBcIm5vd1wiOiBcIk5vd1wiLFxuICAgICAgICAgICAgICAgIFwiY2xlYXJcIjogXCJDbGVhclwiLFxuICAgICAgICAgICAgICAgIFwiaGVscFwiOiBcIkhlbHBcIixcbiAgICAgICAgICAgICAgICBcInllc1wiOiBcIlllc1wiLFxuICAgICAgICAgICAgICAgIFwibm9cIjogXCJOb1wiLFxuICAgICAgICAgICAgICAgIFwicmFuZG9tXCI6IFwiUmFuZG9tXCIsXG4gICAgICAgICAgICAgICAgXCJzYXZlXCI6IFwiU2F2ZVwiLFxuICAgICAgICAgICAgICAgIFwicmVzZXRcIjogXCJSZXNldFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJ0YWJsZVwiOiB7XG4gICAgICAgICAgICAgICAgXCJyb3dzQ291bnRcIjogXCJTaG93IGVudHJpZXM6XCIsXG4gICAgICAgICAgICAgICAgXCJzZWFyY2hcIjogXCJTZWFyY2g6XCIsXG4gICAgICAgICAgICAgICAgXCJpbmZvXCI6IFwiU2hvd2luZyAkMSB0byAkMiBvZiAkMyBlbnRyaWVzXCIsXG4gICAgICAgICAgICAgICAgXCJwcmV2XCI6IFwiUHJldlwiLFxuICAgICAgICAgICAgICAgIFwibmV4dFwiOiBcIk5leHRcIixcbiAgICAgICAgICAgICAgICBcImFsbFwiOiBcIkFsbFwiLFxuICAgICAgICAgICAgICAgIFwiaW5zcGVjdG9yXCI6IFwiSW5zcGVjdG9yXCIsXG4gICAgICAgICAgICAgICAgXCJza2lwXCI6IFwiR290byBwYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJlbXB0eVwiOiBcIk5vdGhpbmcgdG8gc2hvd1wiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJjb2xvclNlbGVjdG9yXCI6IHtcbiAgICAgICAgICAgICAgICBhZGRVc2VyQ29sb3JCdXR0b246IFwiQUREIFRPIFNXQVRDSEVTXCIsXG4gICAgICAgICAgICAgICAgdXNlckNvbG9yc1RpdGxlOiBcIlVTRVIgQ09MT1JTXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInN3aXRjaFwiOiB7XG4gICAgICAgICAgICAgICAgb246IFwib25cIixcbiAgICAgICAgICAgICAgICBvZmY6IFwib2ZmXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAkLmV4dGVuZChNZXRyby5sb2NhbGVzLCB7XG4gICAgICAgICdlcy1NWCc6IHtcbiAgICAgICAgICAgIFwiY2FsZW5kYXJcIjoge1xuICAgICAgICAgICAgICAgIFwibW9udGhzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgXCJFbmVyb1wiLCBcIkZlYnJlcm9cIiwgXCJNYXJ6b1wiLCBcIkFicmlsXCIsIFwiTWF5b1wiLCBcIkp1bmlvXCIsIFwiSnVsaW9cIiwgXCJBZ29zdG9cIiwgXCJTZXB0aWVtYnJlXCIsIFwiT2N0dWJyZVwiLCBcIk5vdmllbWJyZVwiLCBcIkRpY2llbWJyZVwiLFxuICAgICAgICAgICAgICAgICAgICBcIkVuZVwiLCBcIkZlYlwiLCBcIk1hclwiLCBcIkFiclwiLCBcIk1heVwiLCBcIkp1blwiLCBcIkp1bFwiLCBcIkFnb1wiLCBcIlNlcFwiLCBcIk9jdFwiLCBcIk5vdlwiLCBcIkRpY1wiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcImRheXNcIjogW1xuICAgICAgICAgICAgICAgICAgICBcIkRvbWluZ29cIiwgXCJMdW5lc1wiLCBcIk1hcnRlc1wiLCBcIk1pw6lyY29sZXNcIiwgXCJKdWV2ZXNcIiwgXCJWaWVybmVzXCIsIFwiU8OhYmFkb1wiLFxuICAgICAgICAgICAgICAgICAgICBcIkRvXCIsIFwiTHVcIiwgXCJNYVwiLCBcIk1pXCIsIFwiSnVcIiwgXCJWaVwiLCBcIlNhXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiRG9tXCIsIFwiTHVuXCIsIFwiTWFyXCIsIFwiTWnDqVwiLCBcIkp1ZVwiLCBcIlZpZVwiLCBcIlPDoWJcIlxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXCJ0aW1lXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJkYXlzXCI6IFwiRMONQVNcIixcbiAgICAgICAgICAgICAgICAgICAgXCJob3Vyc1wiOiBcIkhPUkFTXCIsXG4gICAgICAgICAgICAgICAgICAgIFwibWludXRlc1wiOiBcIk1JTlNcIixcbiAgICAgICAgICAgICAgICAgICAgXCJzZWNvbmRzXCI6IFwiU0VHU1wiLFxuICAgICAgICAgICAgICAgICAgICBcIm1vbnRoXCI6IFwiTUVTXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZGF5XCI6IFwiRMONQVwiLFxuICAgICAgICAgICAgICAgICAgICBcInllYXJcIjogXCJBw5FPXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwid2Vla1N0YXJ0XCI6IDFcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImJ1dHRvbnNcIjoge1xuICAgICAgICAgICAgICAgIFwib2tcIjogXCJBY2VwdGFyXCIsXG4gICAgICAgICAgICAgICAgXCJjYW5jZWxcIjogXCJDYW5jZWxhclwiLFxuICAgICAgICAgICAgICAgIFwiZG9uZVwiOiBcIkhlY2hvXCIsXG4gICAgICAgICAgICAgICAgXCJ0b2RheVwiOiBcIkhveVwiLFxuICAgICAgICAgICAgICAgIFwibm93XCI6IFwiQWhvcmFcIixcbiAgICAgICAgICAgICAgICBcImNsZWFyXCI6IFwiTGltcGlhclwiLFxuICAgICAgICAgICAgICAgIFwiaGVscFwiOiBcIkF5dWRhXCIsXG4gICAgICAgICAgICAgICAgXCJ5ZXNcIjogXCJTaVwiLFxuICAgICAgICAgICAgICAgIFwibm9cIjogXCJOb1wiLFxuICAgICAgICAgICAgICAgIFwicmFuZG9tXCI6IFwiQWxlYXRvcmlvXCIsXG4gICAgICAgICAgICAgICAgXCJzYXZlXCI6IFwiU2FsdmFyXCIsXG4gICAgICAgICAgICAgICAgXCJyZXNldFwiOiBcIlJlaW5pY2lhclwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJ0YWJsZVwiOiB7XG4gICAgICAgICAgICAgICAgXCJyb3dzQ291bnRcIjogXCJTaG93IGVudHJpZXM6XCIsXG4gICAgICAgICAgICAgICAgXCJzZWFyY2hcIjogXCJTZWFyY2g6XCIsXG4gICAgICAgICAgICAgICAgXCJpbmZvXCI6IFwiU2hvd2luZyAkMSB0byAkMiBvZiAkMyBlbnRyaWVzXCIsXG4gICAgICAgICAgICAgICAgXCJwcmV2XCI6IFwiUHJldlwiLFxuICAgICAgICAgICAgICAgIFwibmV4dFwiOiBcIk5leHRcIixcbiAgICAgICAgICAgICAgICBcImFsbFwiOiBcIkFsbFwiLFxuICAgICAgICAgICAgICAgIFwiaW5zcGVjdG9yXCI6IFwiSW5zcGVjdG9yXCIsXG4gICAgICAgICAgICAgICAgXCJza2lwXCI6IFwiR290byBwYWdlXCIsXG4gICAgICAgICAgICAgICAgXCJlbXB0eVwiOiBcIk5vdGhpbmcgdG8gc2hvd1wiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJjb2xvclNlbGVjdG9yXCI6IHtcbiAgICAgICAgICAgICAgICBhZGRVc2VyQ29sb3JCdXR0b246IFwiQUREIFRPIFNXQVRDSEVTXCIsXG4gICAgICAgICAgICAgICAgdXNlckNvbG9yc1RpdGxlOiBcIlVTRVIgQ09MT1JTXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInN3aXRjaFwiOiB7XG4gICAgICAgICAgICAgICAgb246IFwib25cIixcbiAgICAgICAgICAgICAgICBvZmY6IFwib2ZmXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAkLmV4dGVuZChNZXRyby5sb2NhbGVzLCB7XG4gICAgICAgICdmci1GUic6IHtcbiAgICAgICAgICAgIFwiY2FsZW5kYXJcIjoge1xuICAgICAgICAgICAgICAgIFwibW9udGhzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgXCJKYW52aWVyXCIsIFwiRsOpdnJpZXJcIiwgXCJNYXJzXCIsIFwiQXZyaWxcIiwgXCJNYWlcIiwgXCJKdWluXCIsIFwiSnVpbGxldFwiLCBcIkFvw7t0XCIsIFwiU2VwdGVtYnJlXCIsIFwiT2N0b2JyZVwiLCBcIk5vdmVtYnJlXCIsIFwiRMOpY2VtYnJlXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiSmFudlwiLCBcIkbDqXZyXCIsIFwiTWFyc1wiLCBcIkF2clwiLCBcIk1haVwiLCBcIkp1aW5cIiwgXCJKdWlsXCIsIFwiQW/Du3RcIiwgXCJTZXB0XCIsIFwiT2N0XCIsIFwiTm92XCIsIFwiRMOpY1wiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcImRheXNcIjogW1xuICAgICAgICAgICAgICAgICAgICBcIkRpbWFuY2hlXCIsIFwiTHVuZGlcIiwgXCJNYXJkaVwiLCBcIk1lcmNyZWRpXCIsIFwiSmV1ZGlcIiwgXCJWZW5kcmVkaVwiLCBcIlNhbWVkaVwiLFxuICAgICAgICAgICAgICAgICAgICBcIkRpXCIsIFwiTHVcIiwgXCJNYVwiLCBcIk1lXCIsIFwiSmVcIiwgXCJWZVwiLCBcIlNhXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiRGltXCIsIFwiTHVuXCIsIFwiTWFyXCIsIFwiTWVyXCIsIFwiSmV1XCIsIFwiVmVuXCIsIFwiU2FtXCJcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIFwidGltZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIFwiZGF5c1wiOiBcIkpPVVJTXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiaG91cnNcIjogXCJIRVVSRVNcIixcbiAgICAgICAgICAgICAgICAgICAgXCJtaW51dGVzXCI6IFwiTUlOU1wiLFxuICAgICAgICAgICAgICAgICAgICBcInNlY29uZHNcIjogXCJTRUNTXCIsXG4gICAgICAgICAgICAgICAgICAgIFwibW9udGhcIjogXCJNT0lTXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZGF5XCI6IFwiSk9VUlwiLFxuICAgICAgICAgICAgICAgICAgICBcInllYXJcIjogXCJBTk5FRVwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBcIndlZWtTdGFydFwiOiAxXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJidXR0b25zXCI6IHtcbiAgICAgICAgICAgICAgICBcIm9rXCI6IFwiT0tcIixcbiAgICAgICAgICAgICAgICBcImNhbmNlbFwiOiBcIkFubnVsw6lcIixcbiAgICAgICAgICAgICAgICBcImRvbmVcIjogXCJGYWl0XCIsXG4gICAgICAgICAgICAgICAgXCJ0b2RheVwiOiBcIkF1am91cmQnaHVpXCIsXG4gICAgICAgICAgICAgICAgXCJub3dcIjogXCJNYWludGVuYW50XCIsXG4gICAgICAgICAgICAgICAgXCJjbGVhclwiOiBcIkVmZmFjw6lcIixcbiAgICAgICAgICAgICAgICBcImhlbHBcIjogXCJBaWRlXCIsXG4gICAgICAgICAgICAgICAgXCJ5ZXNcIjogXCJPdWlcIixcbiAgICAgICAgICAgICAgICBcIm5vXCI6IFwiTm9uXCIsXG4gICAgICAgICAgICAgICAgXCJyYW5kb21cIjogXCJBbMOpYXRvaXJlXCIsXG4gICAgICAgICAgICAgICAgXCJzYXZlXCI6IFwiU2F1dmVnYXJkZXJcIixcbiAgICAgICAgICAgICAgICBcInJlc2V0XCI6IFwiUsOpaW5pdGlhbGlzZXJcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwidGFibGVcIjoge1xuICAgICAgICAgICAgICAgIFwicm93c0NvdW50XCI6IFwiU2hvdyBlbnRyaWVzOlwiLFxuICAgICAgICAgICAgICAgIFwic2VhcmNoXCI6IFwiU2VhcmNoOlwiLFxuICAgICAgICAgICAgICAgIFwiaW5mb1wiOiBcIlNob3dpbmcgJDEgdG8gJDIgb2YgJDMgZW50cmllc1wiLFxuICAgICAgICAgICAgICAgIFwicHJldlwiOiBcIlByZXZcIixcbiAgICAgICAgICAgICAgICBcIm5leHRcIjogXCJOZXh0XCIsXG4gICAgICAgICAgICAgICAgXCJhbGxcIjogXCJBbGxcIixcbiAgICAgICAgICAgICAgICBcImluc3BlY3RvclwiOiBcIkluc3BlY3RvclwiLFxuICAgICAgICAgICAgICAgIFwic2tpcFwiOiBcIkdvdG8gcGFnZVwiLFxuICAgICAgICAgICAgICAgIFwiZW1wdHlcIjogXCJOb3RoaW5nIHRvIHNob3dcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiY29sb3JTZWxlY3RvclwiOiB7XG4gICAgICAgICAgICAgICAgYWRkVXNlckNvbG9yQnV0dG9uOiBcIkFERCBUTyBTV0FUQ0hFU1wiLFxuICAgICAgICAgICAgICAgIHVzZXJDb2xvcnNUaXRsZTogXCJVU0VSIENPTE9SU1wiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJzd2l0Y2hcIjoge1xuICAgICAgICAgICAgICAgIG9uOiBcIm9uXCIsXG4gICAgICAgICAgICAgICAgb2ZmOiBcIm9mZlwiXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJC5leHRlbmQoTWV0cm8ubG9jYWxlcywge1xuICAgICAgICAnaHItSFInOiB7XG4gICAgICAgICAgICBcImNhbGVuZGFyXCI6IHtcbiAgICAgICAgICAgICAgICBcIm1vbnRoc1wiOiBbXG4gICAgICAgICAgICAgICAgICAgIFwiU2lqZcSNYW5qXCIsIFwiVmVsamHEjWFcIiwgXCJPxb51amFrXCIsIFwiVHJhdmFualwiLCBcIlN2aWJhbmpcIiwgXCJMaXBhbmpcIiwgXCJTcnBhbmpcIiwgXCJLb2xvdm96XCIsIFwiUnVqYW5cIiwgXCJMaXN0b3BhZFwiLCBcIlN0dWRlbmlcIiwgXCJQcm9zaW5hY1wiLFxuICAgICAgICAgICAgICAgICAgICBcIlNpalwiLCBcIlZlbGpcIiwgXCJPxb51XCIsIFwiVHJhXCIsIFwiU3ZpXCIsIFwiTGlwXCIsIFwiU3JwXCIsIFwiS29sXCIsIFwiUnVqXCIsIFwiTGlzXCIsIFwiU3R1XCIsIFwiUHJvXCJcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIFwiZGF5c1wiOiBbXG4gICAgICAgICAgICAgICAgICAgIFwiTmVkamVsamFcIixcIlBvbmVkamVsamFrXCIsXCJVdG9yYWtcIiwgXCJTcmlqZWRhXCIsIFwixIxldHZydGFrXCIsIFwiUGV0YWtcIiwgXCJTdWJvdGFcIiwgIFxuICAgICAgICAgICAgICAgICAgICBcIk5lXCIsXCJQb1wiLCBcIlV0XCIsIFwiU3JcIiwgXCLEjGVcIiwgXCJQZVwiLCBcIlN1XCIsIFxuICAgICAgICAgICAgICAgICAgICBcIk5lZFwiLCBcIlBvblwiLCBcIlV0b1wiLCBcIlNyaVwiLCBcIsSMZXRcIiwgXCJQZXRcIiwgXCJTdWJcIiBcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIFwidGltZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIFwiZGF5c1wiOiBcIkRBTklcIixcbiAgICAgICAgICAgICAgICAgICAgXCJob3Vyc1wiOiBcIlNBVElcIixcbiAgICAgICAgICAgICAgICAgICAgXCJtaW51dGVzXCI6IFwiTUlOVVRFXCIsXG4gICAgICAgICAgICAgICAgICAgIFwic2Vjb25kc1wiOiBcIlNFS1VOREVcIixcbiAgICAgICAgICAgICAgICAgICAgXCJtb250aFwiOiBcIk1KRVNFQ1wiLFxuICAgICAgICAgICAgICAgICAgICBcImRheVwiOiBcIkRBTlwiLFxuICAgICAgICAgICAgICAgICAgICBcInllYXJcIjogXCJHT0RJTkFcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXCJ3ZWVrU3RhcnRcIjogMVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiYnV0dG9uc1wiOiB7XG4gICAgICAgICAgICAgICAgXCJva1wiOiBcIk9LXCIsXG4gICAgICAgICAgICAgICAgXCJjYW5jZWxcIjogXCJPdGthxb5pXCIsXG4gICAgICAgICAgICAgICAgXCJkb25lXCI6IFwiR290b3ZvXCIsXG4gICAgICAgICAgICAgICAgXCJ0b2RheVwiOiBcIkRhbmFzXCIsXG4gICAgICAgICAgICAgICAgXCJub3dcIjogXCJTYWRhXCIsXG4gICAgICAgICAgICAgICAgXCJjbGVhclwiOiBcIkl6YnJpxaFpXCIsXG4gICAgICAgICAgICAgICAgXCJoZWxwXCI6IFwiUG9tb8SHXCIsXG4gICAgICAgICAgICAgICAgXCJ5ZXNcIjogXCJEYVwiLFxuICAgICAgICAgICAgICAgIFwibm9cIjogXCJOZVwiLFxuICAgICAgICAgICAgICAgIFwicmFuZG9tXCI6IFwiTmFzdW1pxI1ub1wiLFxuICAgICAgICAgICAgICAgIFwic2F2ZVwiOiBcIlNwcmVtaVwiLFxuICAgICAgICAgICAgICAgIFwicmVzZXRcIjogXCJSZXNldFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJ0YWJsZVwiOiB7XG4gICAgICAgICAgICAgICAgXCJyb3dzQ291bnRcIjogXCJCcm9qIHJlZGFrYTpcIixcbiAgICAgICAgICAgICAgICBcInNlYXJjaFwiOiBcIlByZXRyYWdhOlwiLFxuICAgICAgICAgICAgICAgIFwiaW5mb1wiOiBcIlByaWthenVqZW0gJDEgZG8gJDIgb2QgJDNcIixcbiAgICAgICAgICAgICAgICBcInByZXZcIjogXCJOYXphZFwiLFxuICAgICAgICAgICAgICAgIFwibmV4dFwiOiBcIk5hcHJpamVkXCIsXG4gICAgICAgICAgICAgICAgXCJhbGxcIjogXCJTdmVcIixcbiAgICAgICAgICAgICAgICBcImluc3BlY3RvclwiOiBcIkluc3Bla3RvclwiLFxuICAgICAgICAgICAgICAgIFwic2tpcFwiOiBcIklkaSBuYSBzdHJhbmljdVwiLFxuICAgICAgICAgICAgICAgIFwiZW1wdHlcIjogXCJQcmF6bm9cIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiY29sb3JTZWxlY3RvclwiOiB7XG4gICAgICAgICAgICAgICAgYWRkVXNlckNvbG9yQnV0dG9uOiBcIkRvZGFqIHV6b3JjaW1hXCIsXG4gICAgICAgICAgICAgICAgdXNlckNvbG9yc1RpdGxlOiBcIktvcmlzbmnEjWtlIGJvamVcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwic3dpdGNoXCI6IHtcbiAgICAgICAgICAgICAgICBvbjogXCJvblwiLFxuICAgICAgICAgICAgICAgIG9mZjogXCJvZmZcIlxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcblxyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJC5leHRlbmQoTWV0cm8ubG9jYWxlcywge1xuICAgICAgICAnaHUtSFUnOiB7XG4gICAgICAgICAgICBcImNhbGVuZGFyXCI6IHtcbiAgICAgICAgICAgICAgICBcIm1vbnRoc1wiOiBbXG4gICAgICAgICAgICAgICAgICAgICdKYW51w6FyJywgJ0ZlYnJ1w6FyJywgJ03DoXJjaXVzJywgJ8OBcHJpbGlzJywgJ03DoWp1cycsICdKw7puaXVzJywgJ0rDumxpdXMnLCAnQXVndXN6dHVzJywgJ1N6ZXB0ZW1iZXInLCAnT2t0w7NiZXInLCAnTm92ZW1iZXInLCAnRGVjZW1iZXInLFxuICAgICAgICAgICAgICAgICAgICAnSmFuJywgJ0ZlYicsICdNw6FyJywgJ8OBcHInLCAnTcOhaicsICdKw7puJywgJ0rDumwnLCAnQXVnJywgJ1N6ZXAnLCAnT2t0JywgJ05vdicsICdEZWMnXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcImRheXNcIjogW1xuICAgICAgICAgICAgICAgICAgICAnVmFzw6FybmFwJywgJ0jDqXRmxZEnLCAnS2VkZCcsICdTemVyZGEnLCAnQ3PDvHTDtnJ0w7ZrJywgJ1DDqW50ZWsnLCAnU3pvbWJhdCcsXG4gICAgICAgICAgICAgICAgICAgICdWJywgJ0gnLCAnSycsICdTeicsICdDcycsICdQJywgJ1N6JyxcbiAgICAgICAgICAgICAgICAgICAgJ1ZhcycsICdIw6l0JywgJ0tlJywgJ1N6ZScsICdDc8O8JywgJ1DDqW4nLCAnU3pvbSdcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIFwidGltZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIFwiZGF5c1wiOiBcIk5BUFwiLFxuICAgICAgICAgICAgICAgICAgICBcImhvdXJzXCI6IFwiw5NSQVwiLFxuICAgICAgICAgICAgICAgICAgICBcIm1pbnV0ZXNcIjogXCJQRVJDXCIsXG4gICAgICAgICAgICAgICAgICAgIFwic2Vjb25kc1wiOiBcIk1QXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwid2Vla1N0YXJ0XCI6IDFcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImJ1dHRvbnNcIjoge1xuICAgICAgICAgICAgICAgIFwib2tcIjogXCJPS1wiLFxuICAgICAgICAgICAgICAgIFwiY2FuY2VsXCI6IFwiTcOpZ3NlXCIsXG4gICAgICAgICAgICAgICAgXCJkb25lXCI6IFwiS8Opc3pcIixcbiAgICAgICAgICAgICAgICBcInRvZGF5XCI6IFwiTWFcIixcbiAgICAgICAgICAgICAgICBcIm5vd1wiOiBcIk1vc3RcIixcbiAgICAgICAgICAgICAgICBcImNsZWFyXCI6IFwiVMO2cmzDqXNcIixcbiAgICAgICAgICAgICAgICBcImhlbHBcIjogXCJTZWfDrXRzw6lnXCIsXG4gICAgICAgICAgICAgICAgXCJ5ZXNcIjogXCJJZ2VuXCIsXG4gICAgICAgICAgICAgICAgXCJub1wiOiBcIk5lbVwiLFxuICAgICAgICAgICAgICAgIFwicmFuZG9tXCI6IFwiVsOpbGV0bGVuXCIsXG4gICAgICAgICAgICAgICAgXCJzYXZlXCI6IFwiTWVudMOpc1wiLFxuICAgICAgICAgICAgICAgIFwicmVzZXRcIjogXCJWaXNzemHDoWxsw610w6FzXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInRhYmxlXCI6IHtcbiAgICAgICAgICAgICAgICBcInJvd3NDb3VudFwiOiBcIlNob3cgZW50cmllczpcIixcbiAgICAgICAgICAgICAgICBcInNlYXJjaFwiOiBcIlNlYXJjaDpcIixcbiAgICAgICAgICAgICAgICBcImluZm9cIjogXCJTaG93aW5nICQxIHRvICQyIG9mICQzIGVudHJpZXNcIixcbiAgICAgICAgICAgICAgICBcInByZXZcIjogXCJQcmV2XCIsXG4gICAgICAgICAgICAgICAgXCJuZXh0XCI6IFwiTmV4dFwiLFxuICAgICAgICAgICAgICAgIFwiYWxsXCI6IFwiQWxsXCIsXG4gICAgICAgICAgICAgICAgXCJpbnNwZWN0b3JcIjogXCJJbnNwZWN0b3JcIixcbiAgICAgICAgICAgICAgICBcInNraXBcIjogXCJHb3RvIHBhZ2VcIixcbiAgICAgICAgICAgICAgICBcImVtcHR5XCI6IFwiTm90aGluZyB0byBzaG93XCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImNvbG9yU2VsZWN0b3JcIjoge1xuICAgICAgICAgICAgICAgIGFkZFVzZXJDb2xvckJ1dHRvbjogXCJBREQgVE8gU1dBVENIRVNcIixcbiAgICAgICAgICAgICAgICB1c2VyQ29sb3JzVGl0bGU6IFwiVVNFUiBDT0xPUlNcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwic3dpdGNoXCI6IHtcbiAgICAgICAgICAgICAgICBvbjogXCJvblwiLFxuICAgICAgICAgICAgICAgIG9mZjogXCJvZmZcIlxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICQuZXh0ZW5kKE1ldHJvLmxvY2FsZXMsIHtcbiAgICAgICAgJ2l0LUlUJzoge1xuICAgICAgICAgICAgXCJjYWxlbmRhclwiOiB7XG4gICAgICAgICAgICAgICAgXCJtb250aHNcIjogW1xuICAgICAgICAgICAgICAgICAgICBcIkdlbm5haW9cIiwgXCJGZWJicmFpb1wiLCBcIk1hcnpvXCIsIFwiQXByaWxlXCIsIFwiTWFnZ2lvXCIsIFwiR2l1Z25vXCIsIFwiTHVnbGlvXCIsIFwiQWdvc3RvXCIsIFwiU2V0dGVtYnJlXCIsIFwiT3R0b2JyZVwiLCBcIk5vdmVtYnJlXCIsIFwiRGljZW1icmVcIixcbiAgICAgICAgICAgICAgICAgICAgXCJHZW5cIiwgXCJGZWJcIiwgXCJNYXJcIiwgXCJBcHJcIiwgXCJNYWdcIiwgXCJHaXVcIiwgXCJMdWdcIiwgXCJBZ29cIiwgXCJTZXRcIiwgXCJPdHRcIiwgXCJOb3ZcIiwgXCJEaWNcIlxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXCJkYXlzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgXCJEb21lbmljYVwiLCBcIkx1bmVkw6xcIiwgXCJNYXJ0ZWTDrFwiLCBcIk1lcmNvbGVkw6xcIiwgXCJHaW92ZWTDrFwiLCBcIlZlbmVyZMOsXCIsIFwiU2FiYXRvXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiRG9cIiwgXCJMdVwiLCBcIk1hXCIsIFwiTWVcIiwgXCJHaVwiLCBcIlZlXCIsIFwiU2FcIixcbiAgICAgICAgICAgICAgICAgICAgXCJEb21cIiwgXCJMdW5cIiwgXCJNYXJcIiwgXCJNZXJcIiwgXCJHaW9cIiwgXCJWZW5cIiwgXCJTYWJcIlxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXCJ0aW1lXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJkYXlzXCI6IFwiR0lPUk5JXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiaG91cnNcIjogXCJPUkVcIixcbiAgICAgICAgICAgICAgICAgICAgXCJtaW51dGVzXCI6IFwiTUlOXCIsXG4gICAgICAgICAgICAgICAgICAgIFwic2Vjb25kc1wiOiBcIlNFQ1wiLFxuICAgICAgICAgICAgICAgICAgICBcIm1vbnRoXCI6IFwiTUVTRVwiLFxuICAgICAgICAgICAgICAgICAgICBcImRheVwiOiBcIkdJT1JOT1wiLFxuICAgICAgICAgICAgICAgICAgICBcInllYXJcIjogXCJBTk5PXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwid2Vla1N0YXJ0XCI6IDFcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImJ1dHRvbnNcIjoge1xuICAgICAgICAgICAgICAgIFwib2tcIjogXCJPS1wiLFxuICAgICAgICAgICAgICAgIFwiY2FuY2VsXCI6IFwiQW5udWxsYVwiLFxuICAgICAgICAgICAgICAgIFwiZG9uZVwiOiBcIkZhdHRvXCIsXG4gICAgICAgICAgICAgICAgXCJ0b2RheVwiOiBcIk9nZ2lcIixcbiAgICAgICAgICAgICAgICBcIm5vd1wiOiBcIkFkZXNzb1wiLFxuICAgICAgICAgICAgICAgIFwiY2xlYXJcIjogXCJDYW5jZWxsYVwiLFxuICAgICAgICAgICAgICAgIFwiaGVscFwiOiBcIkFpdXRvXCIsXG4gICAgICAgICAgICAgICAgXCJ5ZXNcIjogXCJTw6xcIixcbiAgICAgICAgICAgICAgICBcIm5vXCI6IFwiTm9cIixcbiAgICAgICAgICAgICAgICBcInJhbmRvbVwiOiBcIlJhbmRvbVwiLFxuICAgICAgICAgICAgICAgIFwic2F2ZVwiOiBcIlNhbHZhcmVcIixcbiAgICAgICAgICAgICAgICBcInJlc2V0XCI6IFwiUmVzZXRcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwidGFibGVcIjoge1xuICAgICAgICAgICAgICAgIFwicm93c0NvdW50XCI6IFwiU2hvdyBlbnRyaWVzOlwiLFxuICAgICAgICAgICAgICAgIFwic2VhcmNoXCI6IFwiU2VhcmNoOlwiLFxuICAgICAgICAgICAgICAgIFwiaW5mb1wiOiBcIlNob3dpbmcgJDEgdG8gJDIgb2YgJDMgZW50cmllc1wiLFxuICAgICAgICAgICAgICAgIFwicHJldlwiOiBcIlByZXZcIixcbiAgICAgICAgICAgICAgICBcIm5leHRcIjogXCJOZXh0XCIsXG4gICAgICAgICAgICAgICAgXCJhbGxcIjogXCJBbGxcIixcbiAgICAgICAgICAgICAgICBcImluc3BlY3RvclwiOiBcIkluc3BlY3RvclwiLFxuICAgICAgICAgICAgICAgIFwic2tpcFwiOiBcIkdvdG8gcGFnZVwiLFxuICAgICAgICAgICAgICAgIFwiZW1wdHlcIjogXCJOb3RoaW5nIHRvIHNob3dcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiY29sb3JTZWxlY3RvclwiOiB7XG4gICAgICAgICAgICAgICAgYWRkVXNlckNvbG9yQnV0dG9uOiBcIkFERCBUTyBTV0FUQ0hFU1wiLFxuICAgICAgICAgICAgICAgIHVzZXJDb2xvcnNUaXRsZTogXCJVU0VSIENPTE9SU1wiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJzd2l0Y2hcIjoge1xuICAgICAgICAgICAgICAgIG9uOiBcIm9uXCIsXG4gICAgICAgICAgICAgICAgb2ZmOiBcIm9mZlwiXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJC5leHRlbmQoTWV0cm8ubG9jYWxlcywge1xuICAgICAgICAncHQtQlInOiB7XG4gICAgICAgICAgICBcImNhbGVuZGFyXCI6IHtcbiAgICAgICAgICAgICAgICBcIm1vbnRoc1wiOiBbXG4gICAgICAgICAgICAgICAgICAgIFwiSmFuZWlyb1wiLCBcIkZldmVyZWlyb1wiLCBcIk1hcsOnb1wiLCBcIkFicmlsXCIsIFwiTWFpb1wiLCBcIkp1bmhvXCIsIFwiSnVsaG9cIiwgXCJBZ29zdG9cIiwgXCJTZXRlbWJyb1wiLCBcIk91dHVicm9cIiwgXCJOb3ZlbWJyb1wiLCBcIkRlemVtYnJvXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiSmFuXCIsIFwiRmV2XCIsIFwiTWFyXCIsIFwiQWJyXCIsIFwiTWFpb1wiLCBcIkp1blwiLCBcIkp1bFwiLCBcIkFnb1wiLCBcIlNldFwiLCBcIk91dFwiLCBcIk5vdlwiLCBcIkRlelwiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcImRheXNcIjogW1xuICAgICAgICAgICAgICAgICAgICBcIkRvbWluZ29cIiwgXCJTZWd1bmRhXCIsIFwiVGVyw6dhXCIsIFwiUXVhcnRhXCIsIFwiUXVpbnRhXCIsIFwiU2V4dGFcIiwgXCJTw6FiYWRvXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiRG9cIiwgXCJTZVwiLCBcIlRlXCIsIFwiUWFcIiwgXCJRaVwiLCBcIlNlXCIsIFwiU2FcIixcbiAgICAgICAgICAgICAgICAgICAgXCJEb21cIiwgXCJTZWdcIiwgXCJUZXJcIiwgXCJRdWFcIiwgXCJRdWlcIiwgXCJTZXhcIiwgXCJTYWJcIlxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXCJ0aW1lXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJkYXlzXCI6IFwiRElBU1wiLFxuICAgICAgICAgICAgICAgICAgICBcImhvdXJzXCI6IFwiSE9SQVNcIixcbiAgICAgICAgICAgICAgICAgICAgXCJtaW51dGVzXCI6IFwiTUlOVVRPU1wiLFxuICAgICAgICAgICAgICAgICAgICBcInNlY29uZHNcIjogXCJTRUdVTkRPU1wiLFxuICAgICAgICAgICAgICAgICAgICBcIm1vbnRoXCI6IFwiTcOKU1wiLFxuICAgICAgICAgICAgICAgICAgICBcImRheVwiOiBcIkRJQVwiLFxuICAgICAgICAgICAgICAgICAgICBcInllYXJcIjogXCJBTk9cIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXCJ3ZWVrU3RhcnRcIjogMVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiYnV0dG9uc1wiOiB7XG4gICAgICAgICAgICAgICAgXCJva1wiOiBcIk9LXCIsXG4gICAgICAgICAgICAgICAgXCJjYW5jZWxcIjogXCJDYW5jZWxhclwiLFxuICAgICAgICAgICAgICAgIFwiZG9uZVwiOiBcIkZlaXRvXCIsXG4gICAgICAgICAgICAgICAgXCJ0b2RheVwiOiBcIkhvamVcIixcbiAgICAgICAgICAgICAgICBcIm5vd1wiOiBcIkFnb3JhXCIsXG4gICAgICAgICAgICAgICAgXCJjbGVhclwiOiBcIkxpbXBhclwiLFxuICAgICAgICAgICAgICAgIFwiaGVscFwiOiBcIkFqdWRhXCIsXG4gICAgICAgICAgICAgICAgXCJ5ZXNcIjogXCJTaW1cIixcbiAgICAgICAgICAgICAgICBcIm5vXCI6IFwiTsOjb1wiLFxuICAgICAgICAgICAgICAgIFwicmFuZG9tXCI6IFwiQWxlYXTDs3Jpb1wiLFxuICAgICAgICAgICAgICAgIFwic2F2ZVwiOiBcIlNhbHZhclwiLFxuICAgICAgICAgICAgICAgIFwicmVzZXRcIjogXCJSZXN0YXVyYXJcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwidGFibGVcIjoge1xuICAgICAgICAgICAgICAgIFwicm93c0NvdW50XCI6IFwiU2hvdyBlbnRyaWVzOlwiLFxuICAgICAgICAgICAgICAgIFwic2VhcmNoXCI6IFwiU2VhcmNoOlwiLFxuICAgICAgICAgICAgICAgIFwiaW5mb1wiOiBcIlNob3dpbmcgJDEgdG8gJDIgb2YgJDMgZW50cmllc1wiLFxuICAgICAgICAgICAgICAgIFwicHJldlwiOiBcIlByZXZcIixcbiAgICAgICAgICAgICAgICBcIm5leHRcIjogXCJOZXh0XCIsXG4gICAgICAgICAgICAgICAgXCJhbGxcIjogXCJBbGxcIixcbiAgICAgICAgICAgICAgICBcImluc3BlY3RvclwiOiBcIkluc3BlY3RvclwiLFxuICAgICAgICAgICAgICAgIFwic2tpcFwiOiBcIkdvdG8gcGFnZVwiLFxuICAgICAgICAgICAgICAgIFwiZW1wdHlcIjogXCJOb3RoaW5nIHRvIHNob3dcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiY29sb3JTZWxlY3RvclwiOiB7XG4gICAgICAgICAgICAgICAgYWRkVXNlckNvbG9yQnV0dG9uOiBcIkFERCBUTyBTV0FUQ0hFU1wiLFxuICAgICAgICAgICAgICAgIHVzZXJDb2xvcnNUaXRsZTogXCJVU0VSIENPTE9SU1wiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJzd2l0Y2hcIjoge1xuICAgICAgICAgICAgICAgIG9uOiBcIm9uXCIsXG4gICAgICAgICAgICAgICAgb2ZmOiBcIm9mZlwiXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJC5leHRlbmQoTWV0cm8ubG9jYWxlcywge1xuICAgICAgICAncnUtUlUnOiB7XG4gICAgICAgICAgICBcImNhbGVuZGFyXCI6IHtcbiAgICAgICAgICAgICAgICBcIm1vbnRoc1wiOiBbXG4gICAgICAgICAgICAgICAgICAgIFwi0K/QvdCy0LDRgNGMXCIsIFwi0KTQtdCy0YDQsNC70YxcIiwgXCLQnNCw0YDRglwiLCBcItCQ0L/RgNC10LvRjFwiLCBcItCc0LDQuVwiLCBcItCY0Y7QvdGMXCIsIFwi0JjRjtC70YxcIiwgXCLQkNCy0LPRg9GB0YJcIiwgXCLQodC10L3RgtGP0LHRgNGMXCIsIFwi0J7QutGC0Y/QsdGA0YxcIiwgXCLQndC+0Y/QsdGA0YxcIiwgXCLQlNC10LrQsNCx0YDRjFwiLFxuICAgICAgICAgICAgICAgICAgICBcItCv0L3QslwiLCBcItCk0LXQslwiLCBcItCc0LDRgFwiLCBcItCQ0L/RgFwiLCBcItCc0LDQuVwiLCBcItCY0Y7QvVwiLCBcItCY0Y7Qu1wiLCBcItCQ0LLQs1wiLCBcItCh0LXQvVwiLCBcItCe0LrRglwiLCBcItCd0L7Rj1wiLCBcItCU0LXQulwiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcImRheXNcIjogW1xuICAgICAgICAgICAgICAgICAgICBcItCS0L7RgdC60YDQtdGB0LXQvdGM0LVcIiwgXCLQn9C+0L3QtdC00LXQu9GM0L3QuNC6XCIsIFwi0JLRgtC+0YDQvdC40LpcIiwgXCLQodGA0LXQtNCwXCIsIFwi0KfQtdGC0LLQtdGA0LNcIiwgXCLQn9GP0YLQvdC40YbQsFwiLCBcItCh0YPQsdCx0L7RgtCwXCIsXG4gICAgICAgICAgICAgICAgICAgIFwi0JLRgVwiLCBcItCf0L1cIiwgXCLQktGCXCIsIFwi0KHRgFwiLCBcItCn0YJcIiwgXCLQn9GCXCIsIFwi0KHQsVwiLFxuICAgICAgICAgICAgICAgICAgICBcItCS0L7RgVwiLCBcItCf0L7QvVwiLCBcItCS0YLQvlwiLCBcItCh0YDQtVwiLCBcItCn0LXRglwiLCBcItCf0Y/RglwiLCBcItCh0YPQsVwiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcInRpbWVcIjoge1xuICAgICAgICAgICAgICAgICAgICBcImRheXNcIjogXCLQlNCd0JhcIixcbiAgICAgICAgICAgICAgICAgICAgXCJob3Vyc1wiOiBcItCn0JDQodCrXCIsXG4gICAgICAgICAgICAgICAgICAgIFwibWludXRlc1wiOiBcItCc0JjQnVwiLFxuICAgICAgICAgICAgICAgICAgICBcInNlY29uZHNcIjogXCLQodCV0JpcIixcbiAgICAgICAgICAgICAgICAgICAgXCJtb250aFwiOiBcItCc0JXQoVwiLFxuICAgICAgICAgICAgICAgICAgICBcImRheVwiOiBcItCU0JXQndCsXCIsXG4gICAgICAgICAgICAgICAgICAgIFwieWVhclwiOiBcItCT0J7QlFwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBcIndlZWtTdGFydFwiOiAxXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJidXR0b25zXCI6IHtcbiAgICAgICAgICAgICAgICBcIm9rXCI6IFwi0J7QmlwiLFxuICAgICAgICAgICAgICAgIFwiY2FuY2VsXCI6IFwi0J7RgtC80LXQvdCwXCIsXG4gICAgICAgICAgICAgICAgXCJkb25lXCI6IFwi0JPQvtGC0L7QstC+XCIsXG4gICAgICAgICAgICAgICAgXCJ0b2RheVwiOiBcItCh0LXQs9C+0LTQvdGPXCIsXG4gICAgICAgICAgICAgICAgXCJub3dcIjogXCLQodC10LnRh9Cw0YFcIixcbiAgICAgICAgICAgICAgICBcImNsZWFyXCI6IFwi0J7Rh9C40YHRgtC40YLRjFwiLFxuICAgICAgICAgICAgICAgIFwiaGVscFwiOiBcItCf0L7QvNC+0YnRjFwiLFxuICAgICAgICAgICAgICAgIFwieWVzXCI6IFwi0JTQsFwiLFxuICAgICAgICAgICAgICAgIFwibm9cIjogXCLQndC10YJcIixcbiAgICAgICAgICAgICAgICBcInJhbmRvbVwiOiBcItCh0LvRg9GH0LDQudC90L5cIixcbiAgICAgICAgICAgICAgICBcInNhdmVcIjogXCLQodC+0YXRgNCw0L3QuNGC0YxcIixcbiAgICAgICAgICAgICAgICBcInJlc2V0XCI6IFwi0KHQsdGA0L7RgVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJ0YWJsZVwiOiB7XG4gICAgICAgICAgICAgICAgXCJyb3dzQ291bnRcIjogXCLQn9C+0LrQsNC30LDRgtGMINC30LDQv9C40YHQtdC5OlwiLFxuICAgICAgICAgICAgICAgIFwic2VhcmNoXCI6IFwi0J/QvtC40YHQujpcIixcbiAgICAgICAgICAgICAgICBcImluZm9cIjogXCLQn9C+0LrQsNC30LDQvdGLICQxINGBICQyINC/0L4gJDMg0LfQsNC/0LjRgdC10LlcIixcbiAgICAgICAgICAgICAgICBcInByZXZcIjogXCLQn9GA0LXQtNGL0LTRg9GJ0LjQtVwiLFxuICAgICAgICAgICAgICAgIFwibmV4dFwiOiBcItCh0LvQtdC00YPRjtGJ0LjQtVwiLFxuICAgICAgICAgICAgICAgIFwiYWxsXCI6IFwi0JLRgdC1XCIsXG4gICAgICAgICAgICAgICAgXCJpbnNwZWN0b3JcIjogXCLQmNC90YHQv9C10LrRgtC+0YBcIixcbiAgICAgICAgICAgICAgICBcInNraXBcIjogXCLQn9C10YDQtdC50YLQuCDQvdCwINGB0YLRgNCw0L3QuNGG0YNcIixcbiAgICAgICAgICAgICAgICBcImVtcHR5XCI6IFwi0J3QtdGCINC30LDQv9C40YHQtdC5XCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImNvbG9yU2VsZWN0b3JcIjoge1xuICAgICAgICAgICAgICAgIGFkZFVzZXJDb2xvckJ1dHRvbjogXCLQlNCe0JHQkNCS0JjQotCsINCSINCe0JHQoNCQ0JfQptCrXCIsXG4gICAgICAgICAgICAgICAgdXNlckNvbG9yc1RpdGxlOiBcItCm0JLQldCi0JAg0J/QntCb0KzQl9Ce0JLQkNCi0JXQm9CvXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInN3aXRjaFwiOiB7XG4gICAgICAgICAgICAgICAgb246IFwi0LLQutC7XCIsXG4gICAgICAgICAgICAgICAgb2ZmOiBcItCy0YvQutC7XCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAkLmV4dGVuZChNZXRyby5sb2NhbGVzLCB7XG4gICAgICAgICd0ci1UUic6IHtcbiAgICAgICAgICAgIFwiY2FsZW5kYXJcIjoge1xuICAgICAgICAgICAgICAgIFwibW9udGhzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgXCJPY2FrXCIsIFwixZ51YmF0XCIsIFwiTWFydFwiLCBcIk5pc2FuXCIsIFwiTWF5xLFzXCIsIFwiSGF6aXJhblwiLCBcIlRlbW11elwiLCBcIkHEn3VzdG9zXCIsIFwiRXlsw7xsXCIsIFwiRWtpbVwiLCBcIkthc8SxbVwiLCBcIkFyYWzEsWtcIixcbiAgICAgICAgICAgICAgICAgICAgXCJPY2FcIiwgXCLFnnViXCIsIFwiTWFyXCIsIFwiTmlzXCIsIFwiTWF5XCIsIFwiSGF6XCIsIFwiVGVtXCIsIFwiQcSfdVwiLCBcIkV5bFwiLCBcIkVraVwiLCBcIkthc1wiLCBcIkFyYVwiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcImRheXNcIjogW1xuICAgICAgICAgICAgICAgICAgICBcIlBhemFyXCIsIFwiUGF6YXJ0ZXNpXCIsIFwiU2FsxLFcIiwgXCLDh2FyxZ9hbWJhXCIsIFwiUGVyxZ9lbWJlXCIsIFwiQ3VtYVwiLCBcIkN1bWFydGVzaVwiLFxuICAgICAgICAgICAgICAgICAgICBcIlBhXCIsIFwiUHpcIiwgXCJTYVwiLCBcIsOHYVwiLCBcIlBlXCIsIFwiQ3VcIiwgXCJDdFwiLFxuICAgICAgICAgICAgICAgICAgICBcIlBhelwiLCBcIlB6dFwiLCBcIlNhbFwiLCBcIsOHYXJcIiwgXCJQZXJcIiwgXCJDdW1cIiwgXCJDbXRcIlxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXCJ0aW1lXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJkYXlzXCI6IFwiR8OcTlwiLFxuICAgICAgICAgICAgICAgICAgICBcImhvdXJzXCI6IFwiU0FBVFwiLFxuICAgICAgICAgICAgICAgICAgICBcIm1pbnV0ZXNcIjogXCJEQUtcIixcbiAgICAgICAgICAgICAgICAgICAgXCJzZWNvbmRzXCI6IFwiU0FOXCIsXG4gICAgICAgICAgICAgICAgICAgIFwibW9udGhcIjogXCJBWVwiLFxuICAgICAgICAgICAgICAgICAgICBcImRheVwiOiBcIkfDnE5cIixcbiAgICAgICAgICAgICAgICAgICAgXCJ5ZWFyXCI6IFwiWUlMXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwid2Vla1N0YXJ0XCI6IDFcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImJ1dHRvbnNcIjoge1xuICAgICAgICAgICAgICAgIFwib2tcIjogXCJUYW1hbVwiLFxuICAgICAgICAgICAgICAgIFwiY2FuY2VsXCI6IFwiVmF6Z2XDp1wiLFxuICAgICAgICAgICAgICAgIFwiZG9uZVwiOiBcIkJpdHRpXCIsXG4gICAgICAgICAgICAgICAgXCJ0b2RheVwiOiBcIkJ1Z8O8blwiLFxuICAgICAgICAgICAgICAgIFwibm93XCI6IFwixZ5pbWRpXCIsXG4gICAgICAgICAgICAgICAgXCJjbGVhclwiOiBcIlRlbWl6bGVcIixcbiAgICAgICAgICAgICAgICBcImhlbHBcIjogXCJZYXJkxLFtXCIsXG4gICAgICAgICAgICAgICAgXCJ5ZXNcIjogXCJFdmV0XCIsXG4gICAgICAgICAgICAgICAgXCJub1wiOiBcIkhhecSxclwiLFxuICAgICAgICAgICAgICAgIFwicmFuZG9tXCI6IFwiUmFzZ2VsZVwiLFxuICAgICAgICAgICAgICAgIFwic2F2ZVwiOiBcIkt1cnRhcm1ha1wiLFxuICAgICAgICAgICAgICAgIFwicmVzZXRcIjogXCJTxLFmxLFybGFcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwidGFibGVcIjoge1xuICAgICAgICAgICAgICAgIFwicm93c0NvdW50XCI6IFwiU2hvdyBlbnRyaWVzOlwiLFxuICAgICAgICAgICAgICAgIFwic2VhcmNoXCI6IFwiU2VhcmNoOlwiLFxuICAgICAgICAgICAgICAgIFwiaW5mb1wiOiBcIlNob3dpbmcgJDEgdG8gJDIgb2YgJDMgZW50cmllc1wiLFxuICAgICAgICAgICAgICAgIFwicHJldlwiOiBcIlByZXZcIixcbiAgICAgICAgICAgICAgICBcIm5leHRcIjogXCJOZXh0XCIsXG4gICAgICAgICAgICAgICAgXCJhbGxcIjogXCJBbGxcIixcbiAgICAgICAgICAgICAgICBcImluc3BlY3RvclwiOiBcIkluc3BlY3RvclwiLFxuICAgICAgICAgICAgICAgIFwic2tpcFwiOiBcIkdvdG8gcGFnZVwiLFxuICAgICAgICAgICAgICAgIFwiZW1wdHlcIjogXCJOb3RoaW5nIHRvIHNob3dcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiY29sb3JTZWxlY3RvclwiOiB7XG4gICAgICAgICAgICAgICAgYWRkVXNlckNvbG9yQnV0dG9uOiBcIkFERCBUTyBTV0FUQ0hFU1wiLFxuICAgICAgICAgICAgICAgIHVzZXJDb2xvcnNUaXRsZTogXCJVU0VSIENPTE9SU1wiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJzd2l0Y2hcIjoge1xuICAgICAgICAgICAgICAgIG9uOiBcIm9uXCIsXG4gICAgICAgICAgICAgICAgb2ZmOiBcIm9mZlwiXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJC5leHRlbmQoTWV0cm8ubG9jYWxlcywge1xuICAgICAgICAndWstVUEnOiB7XG4gICAgICAgICAgICBcImNhbGVuZGFyXCI6IHtcbiAgICAgICAgICAgICAgICBcIm1vbnRoc1wiOiBbXG4gICAgICAgICAgICAgICAgICAgIFwi0KHRltGH0LXQvdGMXCIsIFwi0JvRjtGC0LjQuVwiLCBcItCR0LXRgNC10LfQtdC90YxcIiwgXCLQmtCy0ZbRgtC10L3RjFwiLCBcItCi0YDQsNCy0LXQvdGMXCIsIFwi0KfQtdGA0LLQtdC90YxcIiwgXCLQm9C40L/QtdC90YxcIiwgXCLQodC10YDQv9C10L3RjFwiLCBcItCS0LXRgNC10YHQtdC90YxcIiwgXCLQltC+0LLRgtC10L3RjFwiLCBcItCb0LjRgdGC0L7Qv9Cw0LRcIiwgXCLQk9GA0YPQtNC10L3RjFwiLFxuICAgICAgICAgICAgICAgICAgICBcItCh0ZbRh1wiLCBcItCb0Y7RglwiLCBcItCR0LXRgFwiLCBcItCa0LLRllwiLCBcItCi0YDQsFwiLCBcItCn0LXRgFwiLCBcItCb0LjQv1wiLCBcItCh0LXRgFwiLCBcItCS0LXRgFwiLCBcItCW0L7QslwiLCBcItCb0LjRgVwiLCBcItCT0YDRg1wiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcImRheXNcIjogW1xuICAgICAgICAgICAgICAgICAgICBcItCd0LXQtNGW0LvRj1wiLCBcItCf0L7QvdC10LTRltC70L7QulwiLCBcItCS0ZbQstGC0L7RgNC+0LpcIiwgXCLQodC10YDQtdC00LBcIiwgXCLQp9C10YLQstC10YBcIiwgXCLQn+KAmdGP0YLQvdC40YbRj1wiLCBcItCh0YPQsdC+0YLQsFwiLFxuICAgICAgICAgICAgICAgICAgICBcItCd0LRcIiwgXCLQn9C9XCIsIFwi0JLRglwiLCBcItCh0YBcIiwgXCLQp9GCXCIsIFwi0J/RglwiLCBcItCh0LFcIixcbiAgICAgICAgICAgICAgICAgICAgXCLQndC10LRcIiwgXCLQn9C+0L1cIiwgXCLQkmnQslwiLCBcItCh0LXRgFwiLCBcItCn0LXRglwiLCBcItCf0Y/RglwiLCBcItCh0YPQsVwiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcInRpbWVcIjoge1xuICAgICAgICAgICAgICAgICAgICBcImRheXNcIjogXCLQlNCd0IZcIixcbiAgICAgICAgICAgICAgICAgICAgXCJob3Vyc1wiOiBcItCT0J7QlFwiLFxuICAgICAgICAgICAgICAgICAgICBcIm1pbnV0ZXNcIjogXCLQpdCS0JjQm1wiLFxuICAgICAgICAgICAgICAgICAgICBcInNlY29uZHNcIjogXCLQodCV0JpcIixcbiAgICAgICAgICAgICAgICAgICAgXCJtb250aFwiOiBcItCc0IbQoVwiLFxuICAgICAgICAgICAgICAgICAgICBcImRheVwiOiBcItCU0JXQndCsXCIsXG4gICAgICAgICAgICAgICAgICAgIFwieWVhclwiOiBcItCg0IbQmlwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBcIndlZWtTdGFydFwiOiAxXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJidXR0b25zXCI6IHtcbiAgICAgICAgICAgICAgICBcIm9rXCI6IFwi0J7QmlwiLFxuICAgICAgICAgICAgICAgIFwiY2FuY2VsXCI6IFwi0JLRltC00LzRltC90LBcIixcbiAgICAgICAgICAgICAgICBcImRvbmVcIjogXCLQk9C+0YLQvtCy0L5cIixcbiAgICAgICAgICAgICAgICBcInRvZGF5XCI6IFwi0KHRjNC+0LPQvtC00L3RllwiLFxuICAgICAgICAgICAgICAgIFwibm93XCI6IFwi0JfQsNGA0LDQt1wiLFxuICAgICAgICAgICAgICAgIFwiY2xlYXJcIjogXCLQntGH0LjRgdGC0LjRgtC4XCIsXG4gICAgICAgICAgICAgICAgXCJoZWxwXCI6IFwi0JTQvtC/0L7QvNC+0LPQsFwiLFxuICAgICAgICAgICAgICAgIFwieWVzXCI6IFwi0KLQsNC6XCIsXG4gICAgICAgICAgICAgICAgXCJub1wiOiBcItCd0ZZcIixcbiAgICAgICAgICAgICAgICBcInJhbmRvbVwiOiBcItCS0LjQv9Cw0LTQutC+0LLQvlwiLFxuICAgICAgICAgICAgICAgIFwic2F2ZVwiOiBcItCX0LHQtdGA0LXQs9GC0LhcIixcbiAgICAgICAgICAgICAgICBcInJlc2V0XCI6IFwi0KHQutC40L3Rg9GC0LhcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwidGFibGVcIjoge1xuICAgICAgICAgICAgICAgIFwicm93c0NvdW50XCI6IFwi0J/QvtC60LDQt9Cw0YLQuCDQt9Cw0L/QuNGB0ZbQsjpcIixcbiAgICAgICAgICAgICAgICBcInNlYXJjaFwiOiBcItCf0L7RiNGD0Lo6XCIsXG4gICAgICAgICAgICAgICAgXCJpbmZvXCI6IFwi0J/QvtC60LDQt9Cw0L3QviAkMSDQtyAkMiDQv9C+ICQzINC30LDQv9C40YHRltCyXCIsXG4gICAgICAgICAgICAgICAgXCJwcmV2XCI6IFwi0J/QvtC/0LXRgNC10LTQvdGWXCIsXG4gICAgICAgICAgICAgICAgXCJuZXh0XCI6IFwi0J3QsNGB0YLRg9C/0L3RllwiLFxuICAgICAgICAgICAgICAgIFwiYWxsXCI6IFwi0KPRgdGWXCIsXG4gICAgICAgICAgICAgICAgXCJpbnNwZWN0b3JcIjogXCLQhtC90YHQv9C10LrRgtC+0YBcIixcbiAgICAgICAgICAgICAgICBcInNraXBcIjogXCLQn9C10YDQtdC50YLQuCDQtNC+INGB0YLQvtGA0ZbQvdC60LhcIixcbiAgICAgICAgICAgICAgICBcImVtcHR5XCI6IFwi0J3QtdC80LAg0LfQsNC/0LjRgdGW0LJcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiY29sb3JTZWxlY3RvclwiOiB7XG4gICAgICAgICAgICAgICAgYWRkVXNlckNvbG9yQnV0dG9uOiBcItCU0J7QlNCQ0KLQmCDQkiDQl9Cg0JDQl9Ca0JhcIixcbiAgICAgICAgICAgICAgICB1c2VyQ29sb3JzVGl0bGU6IFwi0JrQntCb0IbQoNCYINCa0J7QoNCY0KHQotCj0JLQkNCn0JBcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwic3dpdGNoXCI6IHtcbiAgICAgICAgICAgICAgICBvbjogXCLRg9Cy0LxcIixcbiAgICAgICAgICAgICAgICBvZmY6IFwi0LLRltC8XCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAkLmV4dGVuZChNZXRyby5sb2NhbGVzLCB7XG4gICAgICAgICd6aC1DTic6IHtcbiAgICAgICAgICAgIFwiY2FsZW5kYXJcIjoge1xuICAgICAgICAgICAgICAgIFwibW9udGhzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgXCLkuIDmnIhcIiwgXCLkuozmnIhcIiwgXCLkuInmnIhcIiwgXCLlm5vmnIhcIiwgXCLkupTmnIhcIiwgXCLlha3mnIhcIiwgXCLkuIPmnIhcIiwgXCLlhavmnIhcIiwgXCLkuZ3mnIhcIiwgXCLljYHmnIhcIiwgXCLljYHkuIDmnIhcIiwgXCLljYHkuozmnIhcIixcbiAgICAgICAgICAgICAgICAgICAgXCIx5pyIXCIsIFwiMuaciFwiLCBcIjPmnIhcIiwgXCI05pyIXCIsIFwiNeaciFwiLCBcIjbmnIhcIiwgXCI35pyIXCIsIFwiOOaciFwiLCBcIjnmnIhcIiwgXCIxMOaciFwiLCBcIjEx5pyIXCIsIFwiMTLmnIhcIlxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXCJkYXlzXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgXCLmmJ/mnJ/ml6VcIiwgXCLmmJ/mnJ/kuIBcIiwgXCLmmJ/mnJ/kuoxcIiwgXCLmmJ/mnJ/kuIlcIiwgXCLmmJ/mnJ/lm5tcIiwgXCLmmJ/mnJ/kupRcIiwgXCLmmJ/mnJ/lha1cIixcbiAgICAgICAgICAgICAgICAgICAgXCLml6VcIiwgXCLkuIBcIiwgXCLkuoxcIiwgXCLkuIlcIiwgXCLlm5tcIiwgXCLkupRcIiwgXCLlha1cIixcbiAgICAgICAgICAgICAgICAgICAgXCLlkajml6VcIiwgXCLlkajkuIBcIiwgXCLlkajkuoxcIiwgXCLlkajkuIlcIiwgXCLlkajlm5tcIiwgXCLlkajkupRcIiwgXCLlkajlha1cIlxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXCJ0aW1lXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJkYXlzXCI6IFwi5aSpXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiaG91cnNcIjogXCLml7ZcIixcbiAgICAgICAgICAgICAgICAgICAgXCJtaW51dGVzXCI6IFwi5YiGXCIsXG4gICAgICAgICAgICAgICAgICAgIFwic2Vjb25kc1wiOiBcIuenklwiLFxuICAgICAgICAgICAgICAgICAgICBcIm1vbnRoXCI6IFwi5pyIXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZGF5XCI6IFwi5pelXCIsXG4gICAgICAgICAgICAgICAgICAgIFwieWVhclwiOiBcIuW5tFwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBcIndlZWtTdGFydFwiOiAxXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJidXR0b25zXCI6IHtcbiAgICAgICAgICAgICAgICBcIm9rXCI6IFwi56Gu6K6kXCIsXG4gICAgICAgICAgICAgICAgXCJjYW5jZWxcIjogXCLlj5bmtohcIixcbiAgICAgICAgICAgICAgICBcImRvbmVcIjogXCLlrozmiJBcIixcbiAgICAgICAgICAgICAgICBcInRvZGF5XCI6IFwi5LuK5aSpXCIsXG4gICAgICAgICAgICAgICAgXCJub3dcIjogXCLnjrDlnKhcIixcbiAgICAgICAgICAgICAgICBcImNsZWFyXCI6IFwi5riF6ZmkXCIsXG4gICAgICAgICAgICAgICAgXCJoZWxwXCI6IFwi5biu5YqpXCIsXG4gICAgICAgICAgICAgICAgXCJ5ZXNcIjogXCLmmK9cIixcbiAgICAgICAgICAgICAgICBcIm5vXCI6IFwi5ZCmXCIsXG4gICAgICAgICAgICAgICAgXCJyYW5kb21cIjogXCLpmo/mnLpcIixcbiAgICAgICAgICAgICAgICBcInNhdmVcIjogXCLkv53lrZhcIixcbiAgICAgICAgICAgICAgICBcInJlc2V0XCI6IFwi6YeN5ZWfXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInRhYmxlXCI6IHtcbiAgICAgICAgICAgICAgICBcInJvd3NDb3VudFwiOiBcIlNob3cgZW50cmllczpcIixcbiAgICAgICAgICAgICAgICBcInNlYXJjaFwiOiBcIlNlYXJjaDpcIixcbiAgICAgICAgICAgICAgICBcImluZm9cIjogXCJTaG93aW5nICQxIHRvICQyIG9mICQzIGVudHJpZXNcIixcbiAgICAgICAgICAgICAgICBcInByZXZcIjogXCJQcmV2XCIsXG4gICAgICAgICAgICAgICAgXCJuZXh0XCI6IFwiTmV4dFwiLFxuICAgICAgICAgICAgICAgIFwiYWxsXCI6IFwiQWxsXCIsXG4gICAgICAgICAgICAgICAgXCJpbnNwZWN0b3JcIjogXCJJbnNwZWN0b3JcIixcbiAgICAgICAgICAgICAgICBcInNraXBcIjogXCJHb3RvIHBhZ2VcIixcbiAgICAgICAgICAgICAgICBcImVtcHR5XCI6IFwiTm90aGluZyB0byBzaG93XCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImNvbG9yU2VsZWN0b3JcIjoge1xuICAgICAgICAgICAgICAgIGFkZFVzZXJDb2xvckJ1dHRvbjogXCJBREQgVE8gU1dBVENIRVNcIixcbiAgICAgICAgICAgICAgICB1c2VyQ29sb3JzVGl0bGU6IFwiVVNFUiBDT0xPUlNcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwic3dpdGNoXCI6IHtcbiAgICAgICAgICAgICAgICBvbjogXCJvblwiLFxuICAgICAgICAgICAgICAgIG9mZjogXCJvZmZcIlxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICQuZXh0ZW5kKE1ldHJvLmxvY2FsZXMsIHtcbiAgICAgICAgJ3poLVRXJzoge1xuICAgICAgICAgICAgXCJjYWxlbmRhclwiOiB7XG4gICAgICAgICAgICAgICAgXCJtb250aHNcIjogW1xuICAgICAgICAgICAgICAgICAgICBcIuS4gOaciFwiLCBcIuS6jOaciFwiLCBcIuS4ieaciFwiLCBcIuWbm+aciFwiLCBcIuS6lOaciFwiLCBcIuWFreaciFwiLCBcIuS4g+aciFwiLCBcIuWFq+aciFwiLCBcIuS5neaciFwiLCBcIuWNgeaciFwiLCBcIuWNgeS4gOaciFwiLCBcIuWNgeS6jOaciFwiLFxuICAgICAgICAgICAgICAgICAgICBcIjHmnIhcIiwgXCIy5pyIXCIsIFwiM+aciFwiLCBcIjTmnIhcIiwgXCI15pyIXCIsIFwiNuaciFwiLCBcIjfmnIhcIiwgXCI45pyIXCIsIFwiOeaciFwiLCBcIjEw5pyIXCIsIFwiMTHmnIhcIiwgXCIxMuaciFwiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcImRheXNcIjogW1xuICAgICAgICAgICAgICAgICAgICBcIuaYn+acn+aXpVwiLCBcIuaYn+acn+S4gFwiLCBcIuaYn+acn+S6jFwiLCBcIuaYn+acn+S4iVwiLCBcIuaYn+acn+Wbm1wiLCBcIuaYn+acn+S6lFwiLCBcIuaYn+acn+WFrVwiLFxuICAgICAgICAgICAgICAgICAgICBcIuaXpVwiLCBcIuS4gFwiLCBcIuS6jFwiLCBcIuS4iVwiLCBcIuWbm1wiLCBcIuS6lFwiLCBcIuWFrVwiLFxuICAgICAgICAgICAgICAgICAgICBcIumAseaXpVwiLCBcIumAseS4gFwiLCBcIumAseS6jFwiLCBcIumAseS4iVwiLCBcIumAseWbm1wiLCBcIumAseS6lFwiLCBcIumAseWFrVwiXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBcInRpbWVcIjoge1xuICAgICAgICAgICAgICAgICAgICBcImRheXNcIjogXCLlpKlcIixcbiAgICAgICAgICAgICAgICAgICAgXCJob3Vyc1wiOiBcIuaZglwiLFxuICAgICAgICAgICAgICAgICAgICBcIm1pbnV0ZXNcIjogXCLliIZcIixcbiAgICAgICAgICAgICAgICAgICAgXCJzZWNvbmRzXCI6IFwi56eSXCIsXG4gICAgICAgICAgICAgICAgICAgIFwibW9udGhcIjogXCLmnIhcIixcbiAgICAgICAgICAgICAgICAgICAgXCJkYXlcIjogXCLml6VcIixcbiAgICAgICAgICAgICAgICAgICAgXCJ5ZWFyXCI6IFwi5bm0XCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwid2Vla1N0YXJ0XCI6IDFcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImJ1dHRvbnNcIjoge1xuICAgICAgICAgICAgICAgIFwib2tcIjogXCLnorroqo1cIixcbiAgICAgICAgICAgICAgICBcImNhbmNlbFwiOiBcIuWPlua2iFwiLFxuICAgICAgICAgICAgICAgIFwiZG9uZVwiOiBcIuWujOaIkFwiLFxuICAgICAgICAgICAgICAgIFwidG9kYXlcIjogXCLku4rlpKlcIixcbiAgICAgICAgICAgICAgICBcIm5vd1wiOiBcIuePvuWcqFwiLFxuICAgICAgICAgICAgICAgIFwiY2xlYXJcIjogXCLmuIXpmaRcIixcbiAgICAgICAgICAgICAgICBcImhlbHBcIjogXCLluavliqlcIixcbiAgICAgICAgICAgICAgICBcInllc1wiOiBcIuaYr1wiLFxuICAgICAgICAgICAgICAgIFwibm9cIjogXCLlkKZcIixcbiAgICAgICAgICAgICAgICBcInJhbmRvbVwiOiBcIumaqOapn1wiLFxuICAgICAgICAgICAgICAgIFwic2F2ZVwiOiBcIuS/neWtmFwiLFxuICAgICAgICAgICAgICAgIFwicmVzZXRcIjogXCLph43llZ9cIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwidGFibGVcIjoge1xuICAgICAgICAgICAgICAgIFwicm93c0NvdW50XCI6IFwiU2hvdyBlbnRyaWVzOlwiLFxuICAgICAgICAgICAgICAgIFwic2VhcmNoXCI6IFwiU2VhcmNoOlwiLFxuICAgICAgICAgICAgICAgIFwiaW5mb1wiOiBcIlNob3dpbmcgJDEgdG8gJDIgb2YgJDMgZW50cmllc1wiLFxuICAgICAgICAgICAgICAgIFwicHJldlwiOiBcIlByZXZcIixcbiAgICAgICAgICAgICAgICBcIm5leHRcIjogXCJOZXh0XCIsXG4gICAgICAgICAgICAgICAgXCJhbGxcIjogXCJBbGxcIixcbiAgICAgICAgICAgICAgICBcImluc3BlY3RvclwiOiBcIkluc3BlY3RvclwiLFxuICAgICAgICAgICAgICAgIFwic2tpcFwiOiBcIkdvdG8gcGFnZVwiLFxuICAgICAgICAgICAgICAgIFwiZW1wdHlcIjogXCJOb3RoaW5nIHRvIHNob3dcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiY29sb3JTZWxlY3RvclwiOiB7XG4gICAgICAgICAgICAgICAgYWRkVXNlckNvbG9yQnV0dG9uOiBcIkFERCBUTyBTV0FUQ0hFU1wiLFxuICAgICAgICAgICAgICAgIHVzZXJDb2xvcnNUaXRsZTogXCJVU0VSIENPTE9SU1wiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJzd2l0Y2hcIjoge1xuICAgICAgICAgICAgICAgIG9uOiBcIm9uXCIsXG4gICAgICAgICAgICAgICAgb2ZmOiBcIm9mZlwiXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICh0eXBlb2YgQXJyYXkucHJvdG90eXBlLnNodWZmbGUgIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBBcnJheS5wcm90b3R5cGUuc2h1ZmZsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjdXJyZW50SW5kZXggPSB0aGlzLmxlbmd0aCwgdGVtcG9yYXJ5VmFsdWUsIHJhbmRvbUluZGV4O1xuXG4gICAgICAgICAgICB3aGlsZSAoMCAhPT0gY3VycmVudEluZGV4KSB7XG5cbiAgICAgICAgICAgICAgICByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGN1cnJlbnRJbmRleCk7XG4gICAgICAgICAgICAgICAgY3VycmVudEluZGV4IC09IDE7XG5cbiAgICAgICAgICAgICAgICB0ZW1wb3JhcnlWYWx1ZSA9IHRoaXNbY3VycmVudEluZGV4XTtcbiAgICAgICAgICAgICAgICB0aGlzW2N1cnJlbnRJbmRleF0gPSB0aGlzW3JhbmRvbUluZGV4XTtcbiAgICAgICAgICAgICAgICB0aGlzW3JhbmRvbUluZGV4XSA9IHRlbXBvcmFyeVZhbHVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIEFycmF5LnByb3RvdHlwZS5jbG9uZSAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIEFycmF5LnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNsaWNlKDApO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgQXJyYXkucHJvdG90eXBlLnVuaXF1ZSAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIEFycmF5LnByb3RvdHlwZS51bmlxdWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgYSA9IHRoaXMuY29uY2F0KCk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGEubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gaSArIDE7IGogPCBhLmxlbmd0aDsgKytqKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhW2ldID09PSBhW2pdKVxuICAgICAgICAgICAgICAgICAgICAgICAgYS5zcGxpY2Uoai0tLCAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICB9O1xuICAgIH1cblxufSgpKTtcclxuXHJcbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvKipcbiAgICAgKiBOdW1iZXIucHJvdG90eXBlLmZvcm1hdChuLCB4LCBzLCBjKVxuICAgICAqXG4gICAgICogQHBhcmFtICBuOiBsZW5ndGggb2YgZGVjaW1hbFxuICAgICAqIEBwYXJhbSAgeDogbGVuZ3RoIG9mIHdob2xlIHBhcnRcbiAgICAgKiBAcGFyYW0gIHM6IHNlY3Rpb25zIGRlbGltaXRlclxuICAgICAqIEBwYXJhbSAgYzogZGVjaW1hbCBkZWxpbWl0ZXJcbiAgICAgKi9cbiAgICBOdW1iZXIucHJvdG90eXBlLmZvcm1hdCA9IGZ1bmN0aW9uKG4sIHgsIHMsIGMpIHtcbiAgICAgICAgdmFyIHJlID0gJ1xcXFxkKD89KFxcXFxkeycgKyAoeCB8fCAzKSArICd9KSsnICsgKG4gPiAwID8gJ1xcXFxEJyA6ICckJykgKyAnKScsXG4gICAgICAgICAgICBudW0gPSB0aGlzLnRvRml4ZWQoTWF0aC5tYXgoMCwgfn5uKSk7XG5cbiAgICAgICAgcmV0dXJuIChjID8gbnVtLnJlcGxhY2UoJy4nLCBjKSA6IG51bSkucmVwbGFjZShuZXcgUmVnRXhwKHJlLCAnZycpLCAnJCYnICsgKHMgfHwgJywnKSk7XG4gICAgfTtcbn0oKSk7XHJcblxyXG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgU3RyaW5nLnByb3RvdHlwZS50b0FycmF5ID0gZnVuY3Rpb24oZGVsaW1pdGVyLCB0eXBlLCBmb3JtYXQsIGxvY2FsZSl7XG4gICAgICAgIHZhciBzdHIgPSB0aGlzO1xuICAgICAgICB2YXIgYTtcblxuICAgICAgICB0eXBlID0gdHlwZSB8fCBcInN0cmluZ1wiO1xuICAgICAgICBkZWxpbWl0ZXIgPSBkZWxpbWl0ZXIgfHwgXCIsXCI7XG4gICAgICAgIGZvcm1hdCA9IGZvcm1hdCA9PT0gdW5kZWZpbmVkIHx8IGZvcm1hdCA9PT0gbnVsbCA/IGZhbHNlIDogZm9ybWF0O1xuXG4gICAgICAgIGEgPSAoXCJcIitzdHIpLnNwbGl0KGRlbGltaXRlcik7XG5cbiAgICAgICAgcmV0dXJuIGEubWFwKGZ1bmN0aW9uKHMpe1xuICAgICAgICAgICAgdmFyIHJlc3VsdDtcblxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImludFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJpbnRlZ2VyXCI6IHJlc3VsdCA9IGlzTmFOKHMpID8gcy50cmltKCkgOiBwYXJzZUludChzKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcIm51bWJlclwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJmbG9hdFwiOiByZXN1bHQgPSBpc05hTihzKSA/IHMgOiBwYXJzZUZsb2F0KHMpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0ZVwiOiByZXN1bHQgPSAhZm9ybWF0ID8gZGF0ZXRpbWUocykgOiBEYXRldGltZS5mcm9tKHMsIGZvcm1hdCwgbG9jYWxlIHx8ICdlbi1VUycpOyBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiByZXN1bHQgPSBzLnRyaW0oKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIFN0cmluZy5wcm90b3R5cGUuY2FwaXRhbGl6ZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBzdHIgPSB0aGlzO1xuICAgICAgICByZXR1cm4gc3RyLnN1YnN0cigwLCAxKS50b1VwcGVyQ2FzZSgpICsgc3RyLnN1YnN0cigxKVxuICAgIH1cbn0oKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgTWV0cm8udXRpbHMgPSB7XG4gICAgICAgIGlzVmlzaWJsZTogZnVuY3Rpb24oZWxlbWVudCl7XG4gICAgICAgICAgICB2YXIgZWwgPSAkKGVsZW1lbnQpWzBdO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U3R5bGVPbmUoZWwsIFwiZGlzcGxheVwiKSAhPT0gXCJub25lXCJcbiAgICAgICAgICAgICAgICAmJiB0aGlzLmdldFN0eWxlT25lKGVsLCBcInZpc2liaWxpdHlcIikgIT09IFwiaGlkZGVuXCJcbiAgICAgICAgICAgICAgICAmJiBlbC5vZmZzZXRQYXJlbnQgIT09IG51bGw7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNVcmw6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSAqL1xuICAgICAgICAgICAgcmV0dXJuIC9eKFxcLlxcL3xcXC5cXC5cXC98ZnRwfGh0dHB8aHR0cHMpOlxcL1xcLyhcXHcrOnswLDF9XFx3KkApPyhcXFMrKSg6WzAtOV0rKT8oXFwvfFxcLyhbXFx3IyE6Lj8rPSYlQFxcLVxcL10pKT8vLnRlc3QodmFsKTtcbiAgICAgICAgfSxcblxuICAgICAgICBpc1RhZzogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSAqL1xuICAgICAgICAgICAgcmV0dXJuIC9ePFxcLz9bXFx3XFxzPVwiLy4nOjsjLVxcL1xcP10rPi9naS50ZXN0KHZhbCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNFbWJlZE9iamVjdDogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICAgIHZhciBlbWJlZCA9IFtcImlmcmFtZVwiLCBcIm9iamVjdFwiLCBcImVtYmVkXCIsIFwidmlkZW9cIl07XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gZmFsc2U7XG4gICAgICAgICAgICAkLmVhY2goZW1iZWQsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09IFwic3RyaW5nXCIgJiYgdmFsLnRvTG93ZXJDYXNlKCkgPT09IHRoaXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbC5ub2RlVHlwZSAhPT0gdW5kZWZpbmVkICYmIHZhbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IHRoaXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNWaWRlb1VybDogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICAgIHJldHVybiAveW91dHVcXC5iZXx5b3V0dWJlfHR3aXRjaHx2aW1lby9naS50ZXN0KHZhbCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNEYXRlOiBmdW5jdGlvbih2YWwsIGZvcm1hdCwgbG9jYWxlKXtcbiAgICAgICAgICAgIHZhciByZXN1bHQ7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzRGF0ZU9iamVjdCh2YWwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gZm9ybWF0ID8gRGF0ZXRpbWUuZnJvbSh2YWwsIGZvcm1hdCwgbG9jYWxlIHx8IFwiZW4tVVNcIikgOiBkYXRldGltZSh2YWwpXG4gICAgICAgICAgICAgICAgcmV0dXJuIERhdGV0aW1lLmlzRGF0ZXRpbWUocmVzdWx0KTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNEYXRlT2JqZWN0OiBmdW5jdGlvbih2KXtcbiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgdiA9PT0gJ29iamVjdCcgJiYgdi5nZXRNb250aCAhPT0gdW5kZWZpbmVkO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzSW50OiBmdW5jdGlvbihuKXtcbiAgICAgICAgICAgIHJldHVybiAhaXNOYU4obikgJiYgK24gJSAxID09PSAwO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzRmxvYXQ6IGZ1bmN0aW9uKG4pe1xuICAgICAgICAgICAgcmV0dXJuICghaXNOYU4obikgJiYgK24gJSAxICE9PSAwKSB8fCAvXlxcZCpcXC5cXGQrJC8udGVzdChuKTtcbiAgICAgICAgfSxcblxuICAgICAgICBpc0Z1bmM6IGZ1bmN0aW9uKGYpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNUeXBlKGYsICdmdW5jdGlvbicpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzT2JqZWN0OiBmdW5jdGlvbihvKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzVHlwZShvLCAnb2JqZWN0Jyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNPYmplY3QyOiBmdW5jdGlvbihvKXtcbiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgbyA9PT0gXCJvYmplY3RcIiAmJiAhQXJyYXkuaXNBcnJheShvKTtcbiAgICAgICAgfSxcblxuICAgICAgICBpc1R5cGU6IGZ1bmN0aW9uKG8sIHQpe1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzVmFsdWUobykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgbyA9PT0gdCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoKFwiXCIrdCkudG9Mb3dlckNhc2UoKSA9PT0gJ3RhZycgJiYgdGhpcy5pc1RhZyhvKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoKFwiXCIrdCkudG9Mb3dlckNhc2UoKSA9PT0gJ3VybCcgJiYgdGhpcy5pc1VybChvKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoKFwiXCIrdCkudG9Mb3dlckNhc2UoKSA9PT0gJ2FycmF5JyAmJiBBcnJheS5pc0FycmF5KG8pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG87XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzVGFnKG8pIHx8IHRoaXMuaXNVcmwobykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93W29dID09PSB0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHdpbmRvd1tvXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvID09PSAnc3RyaW5nJyAmJiBvLmluZGV4T2YoXCIuXCIpID09PSAtMSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvID09PSAnc3RyaW5nJyAmJiAvWy9cXHMoW10rL2dtLnRlc3QobykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgbyA9PT0gXCJudW1iZXJcIiAmJiB0LnRvTG93ZXJDYXNlKCkgIT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBucyA9IG8uc3BsaXQoXCIuXCIpO1xuICAgICAgICAgICAgdmFyIGksIGNvbnRleHQgPSB3aW5kb3c7XG5cbiAgICAgICAgICAgIGZvcihpID0gMDsgaSA8IG5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29udGV4dCA9IGNvbnRleHRbbnNbaV1dO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdHlwZW9mIGNvbnRleHQgPT09IHQgPyBjb250ZXh0IDogZmFsc2U7XG4gICAgICAgIH0sXG5cbiAgICAgICAgJDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3cudXNlSlF1ZXJ5ID8galF1ZXJ5IDogbTRxO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzTWV0cm9PYmplY3Q6IGZ1bmN0aW9uKGVsLCB0eXBlKXtcbiAgICAgICAgICAgIHZhciAkZWwgPSAkKGVsKSwgZWxfb2JqID0gTWV0cm8uZ2V0UGx1Z2luKGVsLCB0eXBlKTtcblxuICAgICAgICAgICAgaWYgKCRlbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4odHlwZSArICcgJyArIGVsICsgJyBub3QgZm91bmQhJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZWxfb2JqID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0VsZW1lbnQgbm90IGNvbnRhaW4gcm9sZSAnKyB0eXBlICsnISBQbGVhc2UgYWRkIGF0dHJpYnV0ZSBkYXRhLXJvbGU9XCInK3R5cGUrJ1wiIHRvIGVsZW1lbnQgJyArIGVsKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzSlF1ZXJ5OiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICByZXR1cm4gKHR5cGVvZiBqUXVlcnkgIT09IFwidW5kZWZpbmVkXCIgJiYgZWwgaW5zdGFuY2VvZiBqUXVlcnkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzTTRROiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICByZXR1cm4gKHR5cGVvZiBtNHEgIT09IFwidW5kZWZpbmVkXCIgJiYgZWwgaW5zdGFuY2VvZiBtNHEpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzUTogZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNKUXVlcnkoZWwpIHx8IHRoaXMuaXNNNFEoZWwpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGVtYmVkVXJsOiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgaWYgKHZhbC5pbmRleE9mKFwieW91dHUuYmVcIikgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgdmFsID0gXCJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC9cIiArIHZhbC5zcGxpdChcIi9cIikucG9wKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gXCI8ZGl2IGNsYXNzPSdlbWJlZC1jb250YWluZXInPjxpZnJhbWUgc3JjPSdcIit2YWwrXCInPjwvaWZyYW1lPjwvZGl2PlwiO1xuICAgICAgICB9LFxuXG4gICAgICAgIGVsZW1lbnRJZDogZnVuY3Rpb24ocHJlZml4KXtcbiAgICAgICAgICAgIHJldHVybiBwcmVmaXgrXCItXCIrKG5ldyBEYXRlKCkpLmdldFRpbWUoKSskLnJhbmRvbSgxLCAxMDAwKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZWNvbmRzVG9UaW1lOiBmdW5jdGlvbihzKSB7XG4gICAgICAgICAgICB2YXIgZGF5cyA9IE1hdGguZmxvb3IoKHMgJSAzMTUzNjAwMCkgLyA4NjQwMCk7XG4gICAgICAgICAgICB2YXIgaG91cnMgPSBNYXRoLmZsb29yKCgocyAlIDMxNTM2MDAwKSAlIDg2NDAwKSAvIDM2MDApO1xuICAgICAgICAgICAgdmFyIG1pbnV0ZXMgPSBNYXRoLmZsb29yKCgoKHMgJSAzMTUzNjAwMCkgJSA4NjQwMCkgJSAzNjAwKSAvIDYwKTtcbiAgICAgICAgICAgIHZhciBzZWNvbmRzID0gTWF0aC5yb3VuZCgoKChzICUgMzE1MzYwMDApICUgODY0MDApICUgMzYwMCkgJSA2MCk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgXCJkXCI6IGRheXMsXG4gICAgICAgICAgICAgICAgXCJoXCI6IGhvdXJzLFxuICAgICAgICAgICAgICAgIFwibVwiOiBtaW51dGVzLFxuICAgICAgICAgICAgICAgIFwic1wiOiBzZWNvbmRzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIHNlY29uZHNUb0Zvcm1hdHRlZFN0cmluZzogZnVuY3Rpb24odGltZSl7XG4gICAgICAgICAgICB2YXIgc2VjX251bSA9IHBhcnNlSW50KHRpbWUsIDEwKTtcbiAgICAgICAgICAgIHZhciBob3VycyAgID0gTWF0aC5mbG9vcihzZWNfbnVtIC8gMzYwMCk7XG4gICAgICAgICAgICB2YXIgbWludXRlcyA9IE1hdGguZmxvb3IoKHNlY19udW0gLSAoaG91cnMgKiAzNjAwKSkgLyA2MCk7XG4gICAgICAgICAgICB2YXIgc2Vjb25kcyA9IHNlY19udW0gLSAoaG91cnMgKiAzNjAwKSAtIChtaW51dGVzICogNjApO1xuXG4gICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgIENha2UubHBhZChob3VycywgMiwgXCIwXCIpLFxuICAgICAgICAgICAgICAgIENha2UubHBhZChtaW51dGVzLCAyLCBcIjBcIiksXG4gICAgICAgICAgICAgICAgQ2FrZS5scGFkKHNlY29uZHMsIDIsIFwiMFwiKVxuICAgICAgICAgICAgXS5qb2luKFwiOlwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBmdW5jOiBmdW5jdGlvbihmKXtcbiAgICAgICAgICAgIC8qIGpzaGludCAtVzA1NCAqL1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBGdW5jdGlvbihcImFcIiwgZik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXhlYzogZnVuY3Rpb24oZiwgYXJncywgY29udGV4dCl7XG4gICAgICAgICAgICB2YXIgcmVzdWx0O1xuICAgICAgICAgICAgaWYgKGYgPT09IHVuZGVmaW5lZCB8fCBmID09PSBudWxsKSB7cmV0dXJuIGZhbHNlO31cbiAgICAgICAgICAgIHZhciBmdW5jID0gdGhpcy5pc0Z1bmMoZik7XG5cbiAgICAgICAgICAgIGlmIChmdW5jID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIGZ1bmMgPSB0aGlzLmZ1bmMoZik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IG51bGw7XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5NRVRST19USFJPV1MgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNPdXRzaWRlcjogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIGVsID0gJChlbGVtZW50KTtcbiAgICAgICAgICAgIHZhciBpblZpZXdwb3J0O1xuICAgICAgICAgICAgdmFyIGNsb25lID0gZWwuY2xvbmUoKTtcblxuICAgICAgICAgICAgY2xvbmUucmVtb3ZlQXR0cihcImRhdGEtcm9sZVwiKS5jc3Moe1xuICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6IFwiaGlkZGVuXCIsXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IFwiYWJzb2x1dGVcIixcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiBcImJsb2NrXCJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZWwucGFyZW50KCkuYXBwZW5kKGNsb25lKTtcblxuICAgICAgICAgICAgaW5WaWV3cG9ydCA9IHRoaXMuaW5WaWV3cG9ydChjbG9uZVswXSk7XG5cbiAgICAgICAgICAgIGNsb25lLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICByZXR1cm4gIWluVmlld3BvcnQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5WaWV3cG9ydDogZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgdmFyIHJlY3QgPSB0aGlzLnJlY3QoZWwpO1xuXG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIHJlY3QudG9wID49IDAgJiZcbiAgICAgICAgICAgICAgICByZWN0LmxlZnQgPj0gMCAmJlxuICAgICAgICAgICAgICAgIHJlY3QuYm90dG9tIDw9ICh3aW5kb3cuaW5uZXJIZWlnaHQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCkgJiZcbiAgICAgICAgICAgICAgICByZWN0LnJpZ2h0IDw9ICh3aW5kb3cuaW5uZXJXaWR0aCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgpXG4gICAgICAgICAgICApO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlY3Q6IGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIHJldHVybiBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRDdXJzb3JQb3NpdGlvbjogZnVuY3Rpb24oZWwsIGUpe1xuICAgICAgICAgICAgdmFyIGEgPSB0aGlzLnJlY3QoZWwpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB4OiB0aGlzLnBhZ2VYWShlKS54IC0gYS5sZWZ0IC0gd2luZG93LnBhZ2VYT2Zmc2V0LFxuICAgICAgICAgICAgICAgIHk6IHRoaXMucGFnZVhZKGUpLnkgLSBhLnRvcCAtIHdpbmRvdy5wYWdlWU9mZnNldFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRDdXJzb3JQb3NpdGlvblg6IGZ1bmN0aW9uKGVsLCBlKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEN1cnNvclBvc2l0aW9uKGVsLCBlKS54O1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldEN1cnNvclBvc2l0aW9uWTogZnVuY3Rpb24oZWwsIGUpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q3Vyc29yUG9zaXRpb24oZWwsIGUpLnk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb2JqZWN0TGVuZ3RoOiBmdW5jdGlvbihvYmope1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaikubGVuZ3RoO1xuICAgICAgICB9LFxuXG4gICAgICAgIHBlcmNlbnQ6IGZ1bmN0aW9uKHRvdGFsLCBwYXJ0LCByb3VuZF92YWx1ZSl7XG4gICAgICAgICAgICBpZiAodG90YWwgPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBwYXJ0ICogMTAwIC8gdG90YWw7XG4gICAgICAgICAgICByZXR1cm4gcm91bmRfdmFsdWUgPT09IHRydWUgPyBNYXRoLnJvdW5kKHJlc3VsdCkgOiBNYXRoLnJvdW5kKHJlc3VsdCAqIDEwMCkgLyAxMDA7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb2JqZWN0U2hpZnQ6IGZ1bmN0aW9uKG9iail7XG4gICAgICAgICAgICB2YXIgbWluID0gMDtcbiAgICAgICAgICAgICQuZWFjaChvYmosIGZ1bmN0aW9uKGkpe1xuICAgICAgICAgICAgICAgIGlmIChtaW4gPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbWluID0gaTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAobWluID4gaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWluID0gaTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGVsZXRlIG9ialttaW5dO1xuXG4gICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9iamVjdERlbGV0ZTogZnVuY3Rpb24ob2JqLCBrZXkpe1xuICAgICAgICAgICAgaWYgKG9ialtrZXldICE9PSB1bmRlZmluZWQpIGRlbGV0ZSBvYmpba2V5XTtcbiAgICAgICAgfSxcblxuICAgICAgICBhcnJheURlbGV0ZUJ5TXVsdGlwbGVLZXlzOiBmdW5jdGlvbihhcnIsIGtleXMpe1xuICAgICAgICAgICAga2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGluZCl7XG4gICAgICAgICAgICAgICAgZGVsZXRlIGFycltpbmRdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gYXJyLmZpbHRlcihmdW5jdGlvbihpdGVtKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbSAhPT0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYXJyYXlEZWxldGU6IGZ1bmN0aW9uKGFyciwgdmFsKXtcbiAgICAgICAgICAgIHZhciBpID0gYXJyLmluZGV4T2YodmFsKTtcbiAgICAgICAgICAgIGlmIChpID4gLTEpIGFyci5zcGxpY2UoaSwgMSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYXJyYXlEZWxldGVCeUtleTogZnVuY3Rpb24oYXJyLCBrZXkpe1xuICAgICAgICAgICAgYXJyLnNwbGljZShrZXksIDEpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG52bDogZnVuY3Rpb24oZGF0YSwgb3RoZXIpe1xuICAgICAgICAgICAgcmV0dXJuIGRhdGEgPT09IHVuZGVmaW5lZCB8fCBkYXRhID09PSBudWxsID8gb3RoZXIgOiBkYXRhO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9iamVjdENsb25lOiBmdW5jdGlvbihvYmope1xuICAgICAgICAgICAgdmFyIGNvcHkgPSB7fTtcbiAgICAgICAgICAgIGZvcih2YXIga2V5IGluIG9iaikge1xuICAgICAgICAgICAgICAgIGlmICgkLmhhc1Byb3Aob2JqLCBrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvcHlba2V5XSA9IG9ialtrZXldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjb3B5O1xuICAgICAgICB9LFxuXG4gICAgICAgIGdpdGh1YjogZnVuY3Rpb24ocmVwbywgY2FsbGJhY2spe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgJC5qc29uKCdodHRwczovL2FwaS5naXRodWIuY29tL3JlcG9zLycgKyByZXBvKS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgIHRoYXQuZXhlYyhjYWxsYmFjaywgW2RhdGFdKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRldGVjdElFOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciB1YSA9IHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50O1xuICAgICAgICAgICAgdmFyIG1zaWUgPSB1YS5pbmRleE9mKCdNU0lFICcpO1xuICAgICAgICAgICAgaWYgKG1zaWUgPiAwKSB7XG4gICAgICAgICAgICAgICAgLy8gSUUgMTAgb3Igb2xkZXIgPT4gcmV0dXJuIHZlcnNpb24gbnVtYmVyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHVhLnN1YnN0cmluZyhtc2llICsgNSwgdWEuaW5kZXhPZignLicsIG1zaWUpKSwgMTApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdHJpZGVudCA9IHVhLmluZGV4T2YoJ1RyaWRlbnQvJyk7XG4gICAgICAgICAgICBpZiAodHJpZGVudCA+IDApIHtcbiAgICAgICAgICAgICAgICAvLyBJRSAxMSA9PiByZXR1cm4gdmVyc2lvbiBudW1iZXJcbiAgICAgICAgICAgICAgICB2YXIgcnYgPSB1YS5pbmRleE9mKCdydjonKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQodWEuc3Vic3RyaW5nKHJ2ICsgMywgdWEuaW5kZXhPZignLicsIHJ2KSksIDEwKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGVkZ2UgPSB1YS5pbmRleE9mKCdFZGdlLycpO1xuICAgICAgICAgICAgaWYgKGVkZ2UgPiAwKSB7XG4gICAgICAgICAgICAgICAgLy8gRWRnZSAoSUUgMTIrKSA9PiByZXR1cm4gdmVyc2lvbiBudW1iZXJcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQodWEuc3Vic3RyaW5nKGVkZ2UgKyA1LCB1YS5pbmRleE9mKCcuJywgZWRnZSkpLCAxMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIG90aGVyIGJyb3dzZXJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXRlY3RDaHJvbWU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gL0Nocm9tZS8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSAmJiAvR29vZ2xlIEluYy8udGVzdChuYXZpZ2F0b3IudmVuZG9yKTtcbiAgICAgICAgfSxcblxuICAgICAgICBwYWdlSGVpZ2h0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGJvZHkgPSBkb2N1bWVudC5ib2R5LFxuICAgICAgICAgICAgICAgIGh0bWwgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG5cbiAgICAgICAgICAgIHJldHVybiBNYXRoLm1heCggYm9keS5zY3JvbGxIZWlnaHQsIGJvZHkub2Zmc2V0SGVpZ2h0LCBodG1sLmNsaWVudEhlaWdodCwgaHRtbC5zY3JvbGxIZWlnaHQsIGh0bWwub2Zmc2V0SGVpZ2h0ICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xlYW5QcmVDb2RlOiBmdW5jdGlvbihzZWxlY3Rvcil7XG4gICAgICAgICAgICB2YXIgZWxzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvciksIDApO1xuXG4gICAgICAgICAgICBlbHMuZm9yRWFjaChmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICAgICAgdmFyIHR4dCA9IGVsLnRleHRDb250ZW50XG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9eW1xcclxcbl0rLywgXCJcIilcdC8vIHN0cmlwIGxlYWRpbmcgbmV3bGluZVxuICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFxzKyQvZywgXCJcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAoL15cXFMvZ20udGVzdCh0eHQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsLnRleHRDb250ZW50ID0gdHh0O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIG1hdCwgc3RyLCByZSA9IC9eW1xcdCBdKy9nbSwgbGVuLCBtaW4gPSAxZTM7XG5cbiAgICAgICAgICAgICAgICAvKiBqc2hpbnQgLVcwODQgKi9cbiAgICAgICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgKi9cbiAgICAgICAgICAgICAgICB3aGlsZSAobWF0ID0gcmUuZXhlYyh0eHQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxlbiA9IG1hdFswXS5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGxlbiA8IG1pbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWluID0gbGVuO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RyID0gbWF0WzBdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG1pbiA9PT0gMWUzKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgICAgICBlbC50ZXh0Q29udGVudCA9IHR4dC5yZXBsYWNlKG5ldyBSZWdFeHAoXCJeXCIgKyBzdHIsICdnbScpLCBcIlwiKS50cmltKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjb29yZHM6IGZ1bmN0aW9uKGVsZW1lbnQpe1xuICAgICAgICAgICAgdmFyIGVsID0gJChlbGVtZW50KVswXTtcbiAgICAgICAgICAgIHZhciBib3ggPSBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0b3A6IGJveC50b3AgKyB3aW5kb3cucGFnZVlPZmZzZXQsXG4gICAgICAgICAgICAgICAgbGVmdDogYm94LmxlZnQgKyB3aW5kb3cucGFnZVhPZmZzZXRcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgcG9zaXRpb25YWTogZnVuY3Rpb24oZSwgdCl7XG4gICAgICAgICAgICBzd2l0Y2ggKHQpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdjbGllbnQnOiByZXR1cm4gdGhpcy5jbGllbnRYWShlKTtcbiAgICAgICAgICAgICAgICBjYXNlICdzY3JlZW4nOiByZXR1cm4gdGhpcy5zY3JlZW5YWShlKTtcbiAgICAgICAgICAgICAgICBjYXNlICdwYWdlJzogcmV0dXJuIHRoaXMucGFnZVhZKGUpO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHJldHVybiB7eDogMCwgeTogMH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7VG91Y2hFdmVudHxFdmVudHxNb3VzZUV2ZW50fSBlXG4gICAgICAgICAqIEByZXR1cm5zIHt7eDogKCopLCB5OiAoKil9fVxuICAgICAgICAgKi9cbiAgICAgICAgY2xpZW50WFk6IGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB4OiBlLmNoYW5nZWRUb3VjaGVzID8gZS5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRYIDogZS5jbGllbnRYLFxuICAgICAgICAgICAgICAgIHk6IGUuY2hhbmdlZFRvdWNoZXMgPyBlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFkgOiBlLmNsaWVudFlcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7VG91Y2hFdmVudHxFdmVudHxNb3VzZUV2ZW50fSBlXG4gICAgICAgICAqIEByZXR1cm5zIHt7eDogKCopLCB5OiAoKil9fVxuICAgICAgICAgKi9cbiAgICAgICAgc2NyZWVuWFk6IGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB4OiBlLmNoYW5nZWRUb3VjaGVzID8gZS5jaGFuZ2VkVG91Y2hlc1swXS5zY3JlZW5YIDogZS5zY3JlZW5YLFxuICAgICAgICAgICAgICAgIHk6IGUuY2hhbmdlZFRvdWNoZXMgPyBlLmNoYW5nZWRUb3VjaGVzWzBdLnNjcmVlblkgOiBlLnNjcmVlbllcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7VG91Y2hFdmVudHxFdmVudHxNb3VzZUV2ZW50fSBlXG4gICAgICAgICAqIEByZXR1cm5zIHt7eDogKCopLCB5OiAoKil9fVxuICAgICAgICAgKi9cbiAgICAgICAgcGFnZVhZOiBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgeDogZS5jaGFuZ2VkVG91Y2hlcyA/IGUuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYLFxuICAgICAgICAgICAgICAgIHk6IGUuY2hhbmdlZFRvdWNoZXMgPyBlLmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZIDogZS5wYWdlWVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcblxuICAgICAgICBpc1JpZ2h0TW91c2U6IGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgcmV0dXJuIFwid2hpY2hcIiBpbiBlID8gZS53aGljaCA9PT0gMyA6IFwiYnV0dG9uXCIgaW4gZSA/IGUuYnV0dG9uID09PSAyIDogdW5kZWZpbmVkO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhpZGRlbkVsZW1lbnRTaXplOiBmdW5jdGlvbihlbCwgaW5jbHVkZU1hcmdpbil7XG4gICAgICAgICAgICB2YXIgd2lkdGgsIGhlaWdodCwgY2xvbmUgPSAkKGVsKS5jbG9uZSh0cnVlKTtcblxuICAgICAgICAgICAgY2xvbmUucmVtb3ZlQXR0cihcImRhdGEtcm9sZVwiKS5jc3Moe1xuICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6IFwiaGlkZGVuXCIsXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IFwiYWJzb2x1dGVcIixcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiBcImJsb2NrXCJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJChcImJvZHlcIikuYXBwZW5kKGNsb25lKTtcblxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzVmFsdWUoaW5jbHVkZU1hcmdpbikpIHtcbiAgICAgICAgICAgICAgICBpbmNsdWRlTWFyZ2luID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHdpZHRoID0gY2xvbmUub3V0ZXJXaWR0aChpbmNsdWRlTWFyZ2luKTtcbiAgICAgICAgICAgIGhlaWdodCA9IGNsb25lLm91dGVySGVpZ2h0KGluY2x1ZGVNYXJnaW4pO1xuICAgICAgICAgICAgY2xvbmUucmVtb3ZlKCk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IGhlaWdodFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRTdHlsZTogZnVuY3Rpb24oZWxlbWVudCwgcHNldWRvKXtcbiAgICAgICAgICAgIHZhciBlbCA9ICQoZWxlbWVudClbMF07XG4gICAgICAgICAgICByZXR1cm4gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWwsIHBzZXVkbyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0U3R5bGVPbmU6IGZ1bmN0aW9uKGVsLCBwcm9wZXJ0eSl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRTdHlsZShlbCkuZ2V0UHJvcGVydHlWYWx1ZShwcm9wZXJ0eSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0SW5saW5lU3R5bGVzOiBmdW5jdGlvbihlbGVtZW50KXtcbiAgICAgICAgICAgIHZhciBpLCBsLCBzdHlsZXMgPSB7fSwgZWwgPSAkKGVsZW1lbnQpWzBdO1xuICAgICAgICAgICAgZm9yIChpID0gMCwgbCA9IGVsLnN0eWxlLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBzID0gZWwuc3R5bGVbaV07XG4gICAgICAgICAgICAgICAgc3R5bGVzW3NdID0gZWwuc3R5bGVbc107XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBzdHlsZXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZW5jb2RlVVJJOiBmdW5jdGlvbihzdHIpe1xuICAgICAgICAgICAgcmV0dXJuIGVuY29kZVVSSShzdHIpLnJlcGxhY2UoLyU1Qi9nLCAnWycpLnJlcGxhY2UoLyU1RC9nLCAnXScpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHVwZGF0ZVVSSVBhcmFtZXRlcjogZnVuY3Rpb24odXJpLCBrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKFwiKFs/Jl0pXCIgKyBrZXkgKyBcIj0uKj8oJnwkKVwiLCBcImlcIik7XG4gICAgICAgICAgICB2YXIgc2VwYXJhdG9yID0gdXJpLmluZGV4T2YoJz8nKSAhPT0gLTEgPyBcIiZcIiA6IFwiP1wiO1xuICAgICAgICAgICAgaWYgKHVyaS5tYXRjaChyZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXJpLnJlcGxhY2UocmUsICckMScgKyBrZXkgKyBcIj1cIiArIHZhbHVlICsgJyQyJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXJpICsgc2VwYXJhdG9yICsga2V5ICsgXCI9XCIgKyB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBnZXRVUklQYXJhbWV0ZXI6IGZ1bmN0aW9uKHVybCwgbmFtZSl7XG4gICAgICAgICAgICBpZiAoIXVybCkgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgKi9cbiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csIFwiXFxcXCQmXCIpO1xuICAgICAgICAgICAgdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cChcIls/Jl1cIiArIG5hbWUgKyBcIig9KFteJiNdKil8JnwjfCQpXCIpLFxuICAgICAgICAgICAgICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG4gICAgICAgICAgICBpZiAoIXJlc3VsdHMpIHJldHVybiBudWxsO1xuICAgICAgICAgICAgaWYgKCFyZXN1bHRzWzJdKSByZXR1cm4gJyc7XG4gICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csIFwiIFwiKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0TG9jYWxlczogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhNZXRyby5sb2NhbGVzKTtcbiAgICAgICAgfSxcblxuICAgICAgICBhZGRMb2NhbGU6IGZ1bmN0aW9uKGxvY2FsZSl7XG4gICAgICAgICAgICBNZXRyby5sb2NhbGVzID0gJC5leHRlbmQoIHt9LCBNZXRyby5sb2NhbGVzLCBsb2NhbGUgKTtcbiAgICAgICAgfSxcblxuICAgICAgICBhc3BlY3RSYXRpb0g6IGZ1bmN0aW9uKHdpZHRoLCBhKXtcbiAgICAgICAgICAgIGlmIChhID09PSBcIjE2LzlcIikgcmV0dXJuIHdpZHRoICogOSAvIDE2O1xuICAgICAgICAgICAgaWYgKGEgPT09IFwiMjEvOVwiKSByZXR1cm4gd2lkdGggKiA5IC8gMjE7XG4gICAgICAgICAgICBpZiAoYSA9PT0gXCI0LzNcIikgcmV0dXJuIHdpZHRoICogMyAvIDQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYXNwZWN0UmF0aW9XOiBmdW5jdGlvbihoZWlnaHQsIGEpe1xuICAgICAgICAgICAgaWYgKGEgPT09IFwiMTYvOVwiKSByZXR1cm4gaGVpZ2h0ICogMTYgLyA5O1xuICAgICAgICAgICAgaWYgKGEgPT09IFwiMjEvOVwiKSByZXR1cm4gaGVpZ2h0ICogMjEgLyA5O1xuICAgICAgICAgICAgaWYgKGEgPT09IFwiNC8zXCIpIHJldHVybiBoZWlnaHQgKiA0IC8gMztcbiAgICAgICAgfSxcblxuICAgICAgICB2YWx1ZUluT2JqZWN0OiBmdW5jdGlvbihvYmosIHZhbHVlKXtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKG9iaikuaW5kZXhPZih2YWx1ZSkgPiAtMTtcbiAgICAgICAgfSxcblxuICAgICAgICBrZXlJbk9iamVjdDogZnVuY3Rpb24ob2JqLCBrZXkpe1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaikuaW5kZXhPZihrZXkpID4gLTE7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5PYmplY3Q6IGZ1bmN0aW9uKG9iaiwga2V5LCB2YWwpe1xuICAgICAgICAgICAgcmV0dXJuIG9ialtrZXldICE9PSB1bmRlZmluZWQgJiYgb2JqW2tleV0gPT09IHZhbDtcbiAgICAgICAgfSxcblxuICAgICAgICBuZXdDc3NTaGVldDogZnVuY3Rpb24obWVkaWEpe1xuICAgICAgICAgICAgdmFyIHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInN0eWxlXCIpO1xuXG4gICAgICAgICAgICBpZiAobWVkaWEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHN0eWxlLnNldEF0dHJpYnV0ZShcIm1lZGlhXCIsIG1lZGlhKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3R5bGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoXCJcIikpO1xuXG4gICAgICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlKTtcblxuICAgICAgICAgICAgcmV0dXJuIHN0eWxlLnNoZWV0O1xuICAgICAgICB9LFxuXG4gICAgICAgIGFkZENzc1J1bGU6IGZ1bmN0aW9uKHNoZWV0LCBzZWxlY3RvciwgcnVsZXMsIGluZGV4KXtcbiAgICAgICAgICAgIHNoZWV0Lmluc2VydFJ1bGUoc2VsZWN0b3IgKyBcIntcIiArIHJ1bGVzICsgXCJ9XCIsIGluZGV4KTtcbiAgICAgICAgfSxcblxuICAgICAgICBtZWRpYTogZnVuY3Rpb24ocXVlcnkpe1xuICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5tYXRjaE1lZGlhKHF1ZXJ5KS5tYXRjaGVzO1xuICAgICAgICB9LFxuXG4gICAgICAgIG1lZGlhTW9kZXM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gd2luZG93Lk1FVFJPX01FRElBO1xuICAgICAgICB9LFxuXG4gICAgICAgIG1lZGlhRXhpc3Q6IGZ1bmN0aW9uKG1lZGlhKXtcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3cuTUVUUk9fTUVESUEuaW5kZXhPZihtZWRpYSkgPiAtMTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbk1lZGlhOiBmdW5jdGlvbihtZWRpYSl7XG4gICAgICAgICAgICByZXR1cm4gd2luZG93Lk1FVFJPX01FRElBLmluZGV4T2YobWVkaWEpID4gLTEgJiYgd2luZG93Lk1FVFJPX01FRElBLmluZGV4T2YobWVkaWEpID09PSB3aW5kb3cuTUVUUk9fTUVESUEubGVuZ3RoIC0gMTtcbiAgICAgICAgfSxcblxuICAgICAgICBpc1ZhbHVlOiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgcmV0dXJuIHZhbCAhPT0gdW5kZWZpbmVkICYmIHZhbCAhPT0gbnVsbCAmJiB2YWwgIT09IFwiXCI7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNOdWxsOiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgcmV0dXJuIHZhbCA9PT0gdW5kZWZpbmVkIHx8IHZhbCA9PT0gbnVsbDtcbiAgICAgICAgfSxcblxuICAgICAgICBpc05lZ2F0aXZlOiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQodmFsKSA8IDA7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNQb3NpdGl2ZTogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KHZhbCkgPiAwO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzWmVybzogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICAgIHJldHVybiAocGFyc2VGbG9hdCh2YWwudG9GaXhlZCgyKSkpID09PSAwLjAwO1xuICAgICAgICB9LFxuXG4gICAgICAgIGJldHdlZW46IGZ1bmN0aW9uKHZhbCwgYm90dG9tLCB0b3AsIGVxdWFscyl7XG4gICAgICAgICAgICByZXR1cm4gZXF1YWxzID09PSB0cnVlID8gdmFsID49IGJvdHRvbSAmJiB2YWwgPD0gdG9wIDogdmFsID4gYm90dG9tICYmIHZhbCA8IHRvcDtcbiAgICAgICAgfSxcblxuICAgICAgICBwYXJzZU1vbmV5OiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgcmV0dXJuIE51bWJlcihwYXJzZUZsb2F0KHZhbC5yZXBsYWNlKC9bXjAtOS0uXS9nLCAnJykpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBwYXJzZUNhcmQ6IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgICByZXR1cm4gdmFsLnJlcGxhY2UoL1teMC05XS9nLCAnJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcGFyc2VQaG9uZTogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlQ2FyZCh2YWwpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHBhcnNlTnVtYmVyOiBmdW5jdGlvbih2YWwsIHRob3VzYW5kLCBkZWNpbWFsKXtcbiAgICAgICAgICAgIHJldHVybiB2YWwucmVwbGFjZShuZXcgUmVnRXhwKCdcXFxcJyt0aG91c2FuZCwgXCJnXCIpLCBcIlwiKS5yZXBsYWNlKG5ldyBSZWdFeHAoJ1xcXFwnK2RlY2ltYWwsICdnJyksIFwiLlwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBuZWFyZXN0OiBmdW5jdGlvbih2YWwsIHByZWNpc2lvbiwgZG93bil7XG4gICAgICAgICAgICB2YWwgLz0gcHJlY2lzaW9uO1xuICAgICAgICAgICAgdmFsID0gTWF0aFtkb3duID09PSB0cnVlID8gJ2Zsb29yJyA6ICdjZWlsJ10odmFsKSAqIHByZWNpc2lvbjtcbiAgICAgICAgICAgIHJldHVybiB2YWw7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYm9vbDogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgICAgc3dpdGNoKHZhbHVlKXtcbiAgICAgICAgICAgICAgICBjYXNlIHRydWU6XG4gICAgICAgICAgICAgICAgY2FzZSBcInRydWVcIjpcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgY2FzZSBcIjFcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwib25cIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwieWVzXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjb3B5OiBmdW5jdGlvbihlbGVtZW50KXtcbiAgICAgICAgICAgIHZhciBib2R5ID0gZG9jdW1lbnQuYm9keSwgcmFuZ2UsIHNlbDtcbiAgICAgICAgICAgIHZhciBlbCA9ICQoZWxlbWVudClbMF07XG5cbiAgICAgICAgICAgIGlmIChkb2N1bWVudC5jcmVhdGVSYW5nZSAmJiB3aW5kb3cuZ2V0U2VsZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuICAgICAgICAgICAgICAgIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICBzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2Uuc2VsZWN0Tm9kZUNvbnRlbnRzKGVsKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsLmFkZFJhbmdlKHJhbmdlKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJhbmdlLnNlbGVjdE5vZGUoZWwpO1xuICAgICAgICAgICAgICAgICAgICBzZWwuYWRkUmFuZ2UocmFuZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYm9keVtcImNyZWF0ZVRleHRSYW5nZVwiXSkge1xuICAgICAgICAgICAgICAgIHJhbmdlID0gYm9keVtcImNyZWF0ZVRleHRSYW5nZVwiXSgpO1xuICAgICAgICAgICAgICAgIHJhbmdlW1wibW92ZVRvRWxlbWVudFRleHRcIl0oZWwpO1xuICAgICAgICAgICAgICAgIHJhbmdlLnNlbGVjdCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZChcIkNvcHlcIik7XG5cbiAgICAgICAgICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5lbXB0eSkgeyAgLy8gQ2hyb21lXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5lbXB0eSgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAod2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcykgeyAgLy8gRmlyZWZveFxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChkb2N1bWVudFtcInNlbGVjdGlvblwiXSkgeyAgLy8gSUU/XG4gICAgICAgICAgICAgICAgZG9jdW1lbnRbXCJzZWxlY3Rpb25cIl0uZW1wdHkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZWNDb3VudDogZnVuY3Rpb24odil7XG4gICAgICAgICAgICByZXR1cm4gdiAlIDEgPT09IDAgPyAwIDogdi50b1N0cmluZygpLnNwbGl0KFwiLlwiKVsxXS5sZW5ndGg7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKHdpbmRvdy5NRVRST19HTE9CQUxfQ09NTU9OID09PSB0cnVlKSB7XG4gICAgICAgIHdpbmRvdy5VdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIH1cbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKXtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIEFjY29yZGlvbkRlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGFjY29yZGlvbkRlZmVycmVkOiAwLFxuICAgICAgICBzaG93TWFya2VyOiB0cnVlLFxuICAgICAgICBtYXRlcmlhbDogZmFsc2UsXG4gICAgICAgIGR1cmF0aW9uOiBNRVRST19BTklNQVRJT05fRFVSQVRJT04sXG4gICAgICAgIG9uZUZyYW1lOiB0cnVlLFxuICAgICAgICBzaG93QWN0aXZlOiB0cnVlLFxuICAgICAgICBhY3RpdmVGcmFtZUNsYXNzOiBcIlwiLFxuICAgICAgICBhY3RpdmVIZWFkaW5nQ2xhc3M6IFwiXCIsXG4gICAgICAgIGFjdGl2ZUNvbnRlbnRDbGFzczogXCJcIixcbiAgICAgICAgY2xzRnJhbWU6IFwiXCIsXG4gICAgICAgIGNsc0hlYWRpbmc6IFwiXCIsXG4gICAgICAgIGNsc0NvbnRlbnQ6IFwiXCIsXG4gICAgICAgIGNsc0FjY29yZGlvbjogXCJcIixcbiAgICAgICAgY2xzQWN0aXZlRnJhbWU6IFwiXCIsXG4gICAgICAgIGNsc0FjdGl2ZUZyYW1lSGVhZGluZzogXCJcIixcbiAgICAgICAgY2xzQWN0aXZlRnJhbWVDb250ZW50OiBcIlwiLFxuICAgICAgICBvbkZyYW1lT3BlbjogTWV0cm8ubm9vcCxcbiAgICAgICAgb25GcmFtZUJlZm9yZU9wZW46IE1ldHJvLm5vb3BfdHJ1ZSxcbiAgICAgICAgb25GcmFtZUNsb3NlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkZyYW1lQmVmb3JlQ2xvc2U6IE1ldHJvLm5vb3BfdHJ1ZSxcbiAgICAgICAgb25BY2NvcmRpb25DcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uYWNjb3JkaW9uU2V0dXAgPSBmdW5jdGlvbihvcHRpb25zKXtcbiAgICAgICAgQWNjb3JkaW9uRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBBY2NvcmRpb25EZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0FjY29yZGlvblNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8uYWNjb3JkaW9uU2V0dXAod2luZG93W1wibWV0cm9BY2NvcmRpb25TZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdhY2NvcmRpb24nLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgQWNjb3JkaW9uRGVmYXVsdENvbmZpZyk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVN0cnVjdHVyZSgpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlRXZlbnRzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudCgnYWNjb3JkaW9uQ3JlYXRlJywge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgZnJhbWVzID0gZWxlbWVudC5jaGlsZHJlbihcIi5mcmFtZVwiKTtcbiAgICAgICAgICAgIHZhciBhY3RpdmUgPSBlbGVtZW50LmNoaWxkcmVuKFwiLmZyYW1lLmFjdGl2ZVwiKTtcbiAgICAgICAgICAgIHZhciBmcmFtZV90b19vcGVuO1xuXG4gICAgICAgICAgICBlbGVtZW50XG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKFwiYWNjb3JkaW9uXCIpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKG8uY2xzQWNjb3JkaW9uKVxuICAgICAgICAgICAgO1xuXG4gICAgICAgICAgICBmcmFtZXNcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3Moby5jbHNGcmFtZSlcbiAgICAgICAgICAgICAgICAuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgJGVsID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgJGVsLmNoaWxkcmVuKFwiLmhlYWRpbmdcIikuYWRkQ2xhc3Moby5jbHNIZWFkaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgJGVsLmNoaWxkcmVuKFwiLmNvbnRlbnRcIikuYWRkQ2xhc3Moby5jbHNDb250ZW50KTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgO1xuXG4gICAgICAgICAgICBpZiAoby5zaG93TWFya2VyID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcIm1hcmtlci1vblwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8ubWF0ZXJpYWwgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwibWF0ZXJpYWxcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChhY3RpdmUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgZnJhbWVfdG9fb3BlbiA9IGZyYW1lc1swXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZnJhbWVfdG9fb3BlbiA9IGFjdGl2ZVswXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5faGlkZUFsbCgpO1xuXG4gICAgICAgICAgICBpZiAoby5zaG93QWN0aXZlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKG8ub25lRnJhbWUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb3BlbkZyYW1lKGZyYW1lX3RvX29wZW4pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQuZWFjaChhY3RpdmUsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9vcGVuRnJhbWUodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGFjdGl2ZSA9IGVsZW1lbnQuY2hpbGRyZW4oXCIuZnJhbWUuYWN0aXZlXCIpO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuaGVhZGluZ1wiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBoZWFkaW5nID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgZnJhbWUgPSBoZWFkaW5nLnBhcmVudCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGhlYWRpbmcuY2xvc2VzdChcIi5hY2NvcmRpb25cIilbMF0gIT09IGVsZW1lbnRbMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChmcmFtZS5oYXNDbGFzcyhcImFjdGl2ZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZlLmxlbmd0aCA9PT0gMSAmJiBvLm9uZUZyYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgKi9cblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fY2xvc2VGcmFtZShmcmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9vcGVuRnJhbWUoZnJhbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9vcGVuRnJhbWU6IGZ1bmN0aW9uKGYpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgZnJhbWUgPSAkKGYpO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuZXhlYyhvLm9uRnJhbWVCZWZvcmVPcGVuLCBbZnJhbWVbMF1dLCBlbGVtZW50WzBdKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLm9uZUZyYW1lID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY2xvc2VBbGwoZnJhbWVbMF0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmcmFtZS5hZGRDbGFzcyhcImFjdGl2ZSBcIiArIG8uYWN0aXZlRnJhbWVDbGFzcykuYWRkQ2xhc3Moby5jbHNBY3RpdmVGcmFtZSk7XG4gICAgICAgICAgICBmcmFtZS5jaGlsZHJlbihcIi5oZWFkaW5nXCIpLmFkZENsYXNzKG8uYWN0aXZlSGVhZGluZ0NsYXNzKS5hZGRDbGFzcyhvLmNsc0FjdGl2ZUZyYW1lSGVhZGluZyk7XG4gICAgICAgICAgICBmcmFtZS5jaGlsZHJlbihcIi5jb250ZW50XCIpLmFkZENsYXNzKG8uYWN0aXZlQ29udGVudENsYXNzKS5hZGRDbGFzcyhvLmNsc0FjdGl2ZUZyYW1lQ29udGVudCkuc2xpZGVEb3duKG8uZHVyYXRpb24pO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJmcmFtZU9wZW5cIiwge1xuICAgICAgICAgICAgICAgIGZyYW1lOiBmcmFtZVswXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2Nsb3NlRnJhbWU6IGZ1bmN0aW9uKGYpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgZnJhbWUgPSAkKGYpO1xuXG4gICAgICAgICAgICBpZiAoIWZyYW1lLmhhc0NsYXNzKFwiYWN0aXZlXCIpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmV4ZWMoby5vbkZyYW1lQmVmb3JlQ2xvc2UsIFtmcmFtZVswXV0sIGVsZW1lbnRbMF0pID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZyYW1lLnJlbW92ZUNsYXNzKFwiYWN0aXZlIFwiICsgby5hY3RpdmVGcmFtZUNsYXNzKS5yZW1vdmVDbGFzcyhvLmNsc0FjdGl2ZUZyYW1lKTtcbiAgICAgICAgICAgIGZyYW1lLmNoaWxkcmVuKFwiLmhlYWRpbmdcIikucmVtb3ZlQ2xhc3Moby5hY3RpdmVIZWFkaW5nQ2xhc3MpLnJlbW92ZUNsYXNzKG8uY2xzQWN0aXZlRnJhbWVIZWFkaW5nKTtcbiAgICAgICAgICAgIGZyYW1lLmNoaWxkcmVuKFwiLmNvbnRlbnRcIikucmVtb3ZlQ2xhc3Moby5hY3RpdmVDb250ZW50Q2xhc3MpLnJlbW92ZUNsYXNzKG8uY2xzQWN0aXZlRnJhbWVDb250ZW50KS5zbGlkZVVwKG8uZHVyYXRpb24pO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJmcmFtZUNsb3NlXCIsIHtcbiAgICAgICAgICAgICAgICBmcmFtZTogZnJhbWVbMF1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jbG9zZUFsbDogZnVuY3Rpb24oc2tpcCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgZnJhbWVzID0gZWxlbWVudC5jaGlsZHJlbihcIi5mcmFtZVwiKTtcblxuICAgICAgICAgICAgJC5lYWNoKGZyYW1lcywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAoc2tpcCA9PT0gdGhpcykgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHRoYXQuX2Nsb3NlRnJhbWUodGhpcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfaGlkZUFsbDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIGZyYW1lcyA9IGVsZW1lbnQuY2hpbGRyZW4oXCIuZnJhbWVcIik7XG5cbiAgICAgICAgICAgICQuZWFjaChmcmFtZXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5jaGlsZHJlbihcIi5jb250ZW50XCIpLmhpZGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9vcGVuQWxsOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIGZyYW1lcyA9IGVsZW1lbnQuY2hpbGRyZW4oXCIuZnJhbWVcIik7XG5cbiAgICAgICAgICAgICQuZWFjaChmcmFtZXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5fb3BlbkZyYW1lKHRoaXMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb3BlbjogZnVuY3Rpb24oaSl7XG4gICAgICAgICAgICB2YXIgZnJhbWUgPSB0aGlzLmVsZW1lbnQuY2hpbGRyZW4oXCIuZnJhbWVcIikuZXEoaSk7XG4gICAgICAgICAgICB0aGlzLl9vcGVuRnJhbWUoZnJhbWUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSAqL1xuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHIsIG5ld1ZhbCl7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5oZWFkaW5nXCIpO1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBBY3Rpdml0eURlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGFjdGl2aXR5RGVmZXJyZWQ6IDAsXG4gICAgICAgIHR5cGU6IFwicmluZ1wiLFxuICAgICAgICBzdHlsZTogXCJjb2xvclwiLFxuICAgICAgICBzaXplOiA2NCxcbiAgICAgICAgcmFkaXVzOiAyMCxcbiAgICAgICAgb25BY3Rpdml0eUNyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5hY3Rpdml0eVNldHVwID0gZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgICAgIEFjdGl2aXR5RGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBBY3Rpdml0eURlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvQWN0aXZpdHlTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmFjdGl2aXR5U2V0dXAod2luZG93W1wibWV0cm9BY3Rpdml0eVNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ2FjdGl2aXR5Jywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIEFjdGl2aXR5RGVmYXVsdENvbmZpZyk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgaSwgd3JhcDtcblxuICAgICAgICAgICAgZWxlbWVudFxuICAgICAgICAgICAgICAgIC5odG1sKCcnKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhvLnN0eWxlICsgXCItc3R5bGVcIilcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJhY3Rpdml0eS1cIiArIG8udHlwZSk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIF9tZXRybygpe1xuICAgICAgICAgICAgICAgIGZvcihpID0gMDsgaSA8IDUgOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgJChcIjxkaXYvPlwiKS5hZGRDbGFzcygnY2lyY2xlJykuYXBwZW5kVG8oZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBfc3F1YXJlKCl7XG4gICAgICAgICAgICAgICAgZm9yKGkgPSAwOyBpIDwgNCA7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAkKFwiPGRpdi8+XCIpLmFkZENsYXNzKCdzcXVhcmUnKS5hcHBlbmRUbyhlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIF9jeWNsZSgpe1xuICAgICAgICAgICAgICAgICQoXCI8ZGl2Lz5cIikuYWRkQ2xhc3MoJ2N5Y2xlJykuYXBwZW5kVG8oZWxlbWVudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIF9yaW5nKCl7XG4gICAgICAgICAgICAgICAgZm9yKGkgPSAwOyBpIDwgNSA7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB3cmFwID0gJChcIjxkaXYvPlwiKS5hZGRDbGFzcygnd3JhcCcpLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiPGRpdi8+XCIpLmFkZENsYXNzKCdjaXJjbGUnKS5hcHBlbmRUbyh3cmFwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIF9zaW1wbGUoKXtcbiAgICAgICAgICAgICAgICAkKCc8c3ZnIGNsYXNzPVwiY2lyY3VsYXJcIj48Y2lyY2xlIGNsYXNzPVwicGF0aFwiIGN4PVwiJytvLnNpemUvMisnXCIgY3k9XCInK28uc2l6ZS8yKydcIiByPVwiJytvLnJhZGl1cysnXCIgZmlsbD1cIm5vbmVcIiBzdHJva2Utd2lkdGg9XCIyXCIgc3Ryb2tlLW1pdGVybGltaXQ9XCIxMFwiLz48L3N2Zz4nKS5hcHBlbmRUbyhlbGVtZW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gX2F0b20oKXtcbiAgICAgICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCAzIDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICQoXCI8c3Bhbi8+XCIpLmFkZENsYXNzKCdlbGVjdHJvbicpLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gX2JhcnMoKXtcbiAgICAgICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCA2IDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICQoXCI8c3Bhbi8+XCIpLmFkZENsYXNzKCdiYXInKS5hcHBlbmRUbyhlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHN3aXRjaCAoby50eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnbWV0cm8nOiBfbWV0cm8oKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3F1YXJlJzogX3NxdWFyZSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdjeWNsZSc6IF9jeWNsZSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdzaW1wbGUnOiBfc2ltcGxlKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2F0b20nOiBfYXRvbSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdiYXJzJzogX2JhcnMoKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDogX3JpbmcoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiYWN0aXZpdHktY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qZXNsaW50LWRpc2FibGUtbmV4dC1saW5lKi9cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgTWV0cm8uYWN0aXZpdHkgPSB7XG4gICAgICAgIG9wZW46IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgICAgICAgICAgdmFyIG8gPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgdmFyIGFjdGl2aXR5ID0gJzxkaXYgZGF0YS1yb2xlPVwiYWN0aXZpdHlcIiBkYXRhLXR5cGU9XCInKyggby50eXBlID8gby50eXBlIDogJ2N5Y2xlJyApKydcIiBkYXRhLXN0eWxlPVwiJysoIG8uc3R5bGUgPyBvLnN0eWxlIDogJ2NvbG9yJyApKydcIj48L2Rpdj4nO1xuICAgICAgICAgICAgdmFyIHRleHQgPSBvLnRleHQgPyAnPGRpdiBjbGFzcz1cInRleHQtY2VudGVyXCI+JytvLnRleHQrJzwvZGl2PicgOiAnJztcblxuICAgICAgICAgICAgcmV0dXJuIE1ldHJvLmRpYWxvZy5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGFjdGl2aXR5ICsgdGV4dCxcbiAgICAgICAgICAgICAgICBkZWZhdWx0QWN0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjbHNDb250ZW50OiBcImQtZmxleCBmbGV4LWNvbHVtbiBmbGV4LWp1c3RpZnktY2VudGVyIGZsZXgtYWxpZ24tY2VudGVyIGJnLXRyYW5zcGFyZW50IG5vLXNoYWRvdyB3LWF1dG9cIixcbiAgICAgICAgICAgICAgICBjbHNEaWFsb2c6IFwibm8tYm9yZGVyIG5vLXNoYWRvdyBiZy10cmFuc3BhcmVudCBnbG9iYWwtZGlhbG9nXCIsXG4gICAgICAgICAgICAgICAgYXV0b0hpZGU6IG8uYXV0b0hpZGUgPyBvLmF1dG9IaWRlIDogMCxcbiAgICAgICAgICAgICAgICBvdmVybGF5Q2xpY2tDbG9zZTogby5vdmVybGF5Q2xpY2tDbG9zZSA9PT0gdHJ1ZSxcbiAgICAgICAgICAgICAgICBvdmVybGF5Q29sb3I6IG8ub3ZlcmxheUNvbG9yID8gby5vdmVybGF5Q29sb3IgOiAnIzAwMDAwMCcsXG4gICAgICAgICAgICAgICAgb3ZlcmxheUFscGhhOiBvLm92ZXJsYXlBbHBoYSA/IG8ub3ZlcmxheUFscGhhIDogMC41LFxuICAgICAgICAgICAgICAgIGNsc092ZXJsYXk6IFwiZ2xvYmFsLW92ZXJsYXlcIlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKGEpe1xuICAgICAgICAgICAgTWV0cm8uZGlhbG9nLmNsb3NlKGEpO1xuICAgICAgICB9XG4gICAgfTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBBZGJsb2NrRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgYWRibG9ja0RlZmVycmVkOiAwLFxuICAgICAgICBjaGVja0ludGVydmFsOiAxMDAwLFxuICAgICAgICBmaXJlT25jZTogdHJ1ZSxcbiAgICAgICAgY2hlY2tTdG9wOiAxMCxcbiAgICAgICAgbG9jYWxob3N0OiBmYWxzZSxcbiAgICAgICAgb25BbGVydDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25GaXNoaW5nU3RhcnQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uRmlzaGluZ0RvbmU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uYWRibG9ja1NldHVwID0gZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgICAgIEFkYmxvY2tEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIEFkYmxvY2tEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0FkYmxvY2tTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmFkYmxvY2tTZXR1cCh3aW5kb3dbXCJtZXRyb0FkYmxvY2tTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgdmFyIEFkYmxvY2sgPSB7XG4gICAgICAgIGJpdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgY2xhc3NlcyA9IFwiYWRibG9jay1iaXRlIGFkc2Vuc2UgZ29vZ2xlLWFkc2Vuc2UgZGJsY2xpY2sgYWR2ZXJ0IHRvcGFkIHRvcF9hZHMgdG9wQWRzIHRleHRhZHMgc3BvbnNvcmVkdGV4dGxpbmtfY29udGFpbmVyIHNob3dfYWRzIHJpZ2h0LWJhbm5lciByZWtsIG1wdSBtb2R1bGUtYWQgbWlkX2FkIG1lZGlhZ2V0IGhvcml6b250YWxfYWQgaGVhZGVyQWQgY29udGVudEFkIGJyYW5kLWxpbmsgYm90dG9tYmFubmVyIGJvdHRvbV9hZF9ibG9jayBibG9ja19hZCBiYW5uZXJ0b3AgYmFubmVyLXJpZ2h0IGJhbm5lci1ib2R5IGItYmFubmVyIGItYXJ0aWNsZS1hc2lkZV9fYmFubmVyIGItYWR2ZXJ0IGFkd3JhcHBlciBhZHZlcnRzIGFkdmVydGlzbWVudCBhZHZlcnRpc2VtZW50Om5vdChib2R5KSBhZHZlcnRpc2UgYWR2ZXJ0X2xpc3QgYWR0YWJsZSBhZHNlbnNlIGFkcGljIGFkbGlzdCBhZGxlZnQgYWRpbmZvIGFkaSBhZGhvbGRlciBhZGZyYW1lIGFkZGl2IGFkX3RleHQgYWRfc3BhY2UgYWRfcmlnaHQgYWRfbGlua3MgYWRfYm9keSBhZF9ibG9jayBhZF9SaWdodCBhZFRpdGxlIGFkVGV4dFwiO1xuICAgICAgICAgICAgJChcIjxkaXY+XCIpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzZXMuc3BsaXQoXCIgXCIpLnNodWZmbGUoKS5qb2luKFwiIFwiKSlcbiAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IFwiZml4ZWRcIixcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAxLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogMSxcbiAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3c6IFwiaGlkZGVuXCIsXG4gICAgICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6IFwidmlzaWJsZVwiLFxuICAgICAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IDBcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hcHBlbmQoJChcIjxhIGhyZWY9J2h0dHBzOi8vZGJsY2xpY2submV0Jz5cIikuaHRtbCgnZGJsY2xpY2submV0JykpXG4gICAgICAgICAgICAgICAgLmFwcGVuZFRvKCdib2R5Jyk7XG5cbiAgICAgICAgICAgIGlmIChBZGJsb2NrLm9wdGlvbnMuYWRibG9ja0RlZmVycmVkKSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIEFkYmxvY2suZmlzaGluZygpO1xuICAgICAgICAgICAgICAgIH0sIEFkYmxvY2sub3B0aW9ucy5hZGJsb2NrRGVmZXJyZWQpO1xuICAgICAgICAgICAgfSBlbHNlIHRoaXMuZmlzaGluZygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGZpc2hpbmc6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgbyA9IEFkYmxvY2sub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjaGVja3MgPSB0eXBlb2Ygby5maXJlT25jZSA9PT0gXCJudW1iZXJcIiA/IG8uZmlyZU9uY2UgOiAwO1xuICAgICAgICAgICAgdmFyIGNoZWNrU3RvcCA9IG8uY2hlY2tTdG9wO1xuICAgICAgICAgICAgdmFyIGludGVydmFsID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgcnVuID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgYSA9ICQoXCIuYWRzZW5zZS5nb29nbGUtYWRzZW5zZS5kYmxjbGljay5hZHZlcnQuYWRibG9jay1iaXRlXCIpO1xuICAgICAgICAgICAgICAgIHZhciBiID0gYS5maW5kKFwiYVwiKTtcbiAgICAgICAgICAgICAgICB2YXIgZG9uZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuXG4gICAgICAgICAgICAgICAgICAgIFV0aWxzLmV4ZWMoby5vbkZpc2hpbmdEb25lKTtcbiAgICAgICAgICAgICAgICAgICAgJCh3aW5kb3cpLmZpcmUoXCJmaXNoaW5nLWRvbmVcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgYS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgaWYgKCFvLmxvY2FsaG9zdCAmJiAkLmxvY2FsaG9zdCkge1xuICAgICAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCAgICFhLmxlbmd0aFxuICAgICAgICAgICAgICAgICAgICB8fCAhYi5sZW5ndGhcbiAgICAgICAgICAgICAgICAgICAgfHwgYS5jc3MoXCJkaXNwbGF5XCIpLmluZGV4T2YoJ25vbmUnKSA+IC0xXG4gICAgICAgICAgICAgICAgICAgIHx8IGIuY3NzKFwiZGlzcGxheVwiKS5pbmRleE9mKCdub25lJykgPiAtMVxuICAgICAgICAgICAgICAgICkge1xuXG4gICAgICAgICAgICAgICAgICAgIFV0aWxzLmV4ZWMoQWRibG9jay5vcHRpb25zLm9uQWxlcnQpO1xuICAgICAgICAgICAgICAgICAgICAkKHdpbmRvdykuZmlyZShcImFkYmxvY2stYWxlcnRcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKEFkYmxvY2sub3B0aW9ucy5maXJlT25jZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tzLS07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrU3RvcCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrU3RvcC0tO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrU3RvcCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIFV0aWxzLmV4ZWMoby5vbkZpc2hpbmdTdGFydCk7XG4gICAgICAgICAgICAkKHdpbmRvdykuZmlyZShcImZpc2hpbmctc3RhcnRcIik7XG5cbiAgICAgICAgICAgIGludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBydW4oKTtcbiAgICAgICAgICAgIH0sIEFkYmxvY2sub3B0aW9ucy5jaGVja0ludGVydmFsKTtcblxuICAgICAgICAgICAgcnVuKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgTWV0cm8uQWRibG9jayA9IEFkYmxvY2s7XG5cbiAgICAkKGZ1bmN0aW9uKCl7XG4gICAgICAgIEFkYmxvY2sub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBBZGJsb2NrRGVmYXVsdENvbmZpZyk7XG4gICAgICAgICQod2luZG93KS5vbihcIm1ldHJvLWluaXRpYXRlZFwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgQWRibG9jay5iaXRlKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIEFuaW1hdGlvbkRlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGR1cmF0aW9uOiBNRVRST19BTklNQVRJT05fRFVSQVRJT04sXG4gICAgICAgIGVhc2U6IFwibGluZWFyXCJcbiAgICB9XG5cbiAgICBNZXRyby5hbmltYXRpb25zID0ge1xuXG4gICAgICAgIHN3aXRjaEluOiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICAkKGVsKVxuICAgICAgICAgICAgICAgIC5oaWRlKClcbiAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogMCxcbiAgICAgICAgICAgICAgICAgICAgdG9wOiAwXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc2hvdygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHN3aXRjaE91dDogZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgJChlbCkuaGlkZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHN3aXRjaDogZnVuY3Rpb24oY3VycmVudCwgbmV4dCl7XG4gICAgICAgICAgICB0aGlzLnN3aXRjaE91dChjdXJyZW50KTtcbiAgICAgICAgICAgIHRoaXMuc3dpdGNoSW4obmV4dCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2xpZGVVcEluOiBmdW5jdGlvbihlbCwgbyl7XG4gICAgICAgICAgICB2YXIgb3AsICRlbCA9ICQoZWwpO1xuICAgICAgICAgICAgdmFyIGggPSAkZWwucGFyZW50KCkub3V0ZXJIZWlnaHQodHJ1ZSk7XG5cbiAgICAgICAgICAgIG9wID0gJC5leHRlbmQoe30sIEFuaW1hdGlvbkRlZmF1bHRDb25maWcsIG8pO1xuXG4gICAgICAgICAgICAkZWxcbiAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBoLFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwLFxuICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IDJcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBkdXI6IG9wLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICBlYXNlOiBvcC5lYXNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2xpZGVVcE91dDogZnVuY3Rpb24oZWwsIG8pe1xuICAgICAgICAgICAgdmFyIG9wLCAkZWwgPSAkKGVsKTtcbiAgICAgICAgICAgIHZhciBoID0gJGVsLnBhcmVudCgpLm91dGVySGVpZ2h0KHRydWUpO1xuXG4gICAgICAgICAgICBvcCA9ICQuZXh0ZW5kKHt9LCBBbmltYXRpb25EZWZhdWx0Q29uZmlnLCBvKTtcblxuICAgICAgICAgICAgJGVsXG4gICAgICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIHpJbmRleDogMVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBkcmF3OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3A6IC1oLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBkdXI6IG9wLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICBlYXNlOiBvcC5lYXNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2xpZGVVcDogZnVuY3Rpb24oY3VycmVudCwgbmV4dCwgbyl7XG4gICAgICAgICAgICB0aGlzLnNsaWRlVXBPdXQoY3VycmVudCwgbyk7XG4gICAgICAgICAgICB0aGlzLnNsaWRlVXBJbihuZXh0LCBvKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzbGlkZURvd25JbjogZnVuY3Rpb24oZWwsIG8pe1xuICAgICAgICAgICAgdmFyIG9wLCAkZWwgPSAkKGVsKTtcbiAgICAgICAgICAgIHZhciBoID0gJGVsLnBhcmVudCgpLm91dGVySGVpZ2h0KHRydWUpO1xuXG4gICAgICAgICAgICBvcCA9ICQuZXh0ZW5kKHt9LCBBbmltYXRpb25EZWZhdWx0Q29uZmlnLCBvKTtcblxuICAgICAgICAgICAgJGVsXG4gICAgICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIHRvcDogLWgsXG4gICAgICAgICAgICAgICAgICAgIHpJbmRleDogMlxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBkcmF3OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGR1cjogb3AuZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGVhc2U6IG9wLmVhc2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBzbGlkZURvd25PdXQ6IGZ1bmN0aW9uKGVsLCBvKXtcbiAgICAgICAgICAgIHZhciBvcCwgJGVsID0gJChlbCk7XG4gICAgICAgICAgICB2YXIgaCA9ICRlbC5wYXJlbnQoKS5vdXRlckhlaWdodCh0cnVlKTtcblxuICAgICAgICAgICAgb3AgPSAkLmV4dGVuZCh7fSwgQW5pbWF0aW9uRGVmYXVsdENvbmZpZywgbyk7XG5cbiAgICAgICAgICAgICRlbFxuICAgICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IDFcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBoLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBkdXI6IG9wLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICBlYXNlOiBvcC5lYXNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2xpZGVEb3duOiBmdW5jdGlvbihjdXJyZW50LCBuZXh0LCBvKXtcbiAgICAgICAgICAgIHRoaXMuc2xpZGVEb3duT3V0KGN1cnJlbnQsIG8pO1xuICAgICAgICAgICAgdGhpcy5zbGlkZURvd25JbihuZXh0LCBvKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzbGlkZUxlZnRJbjogZnVuY3Rpb24oZWwsIG8pe1xuICAgICAgICAgICAgdmFyIG9wLCAkZWwgPSAkKGVsKTtcbiAgICAgICAgICAgIHZhciB3ID0gJGVsLnBhcmVudCgpLm91dGVyV2lkdGgodHJ1ZSk7XG5cbiAgICAgICAgICAgIG9wID0gJC5leHRlbmQoe30sIEFuaW1hdGlvbkRlZmF1bHRDb25maWcsIG8pO1xuXG4gICAgICAgICAgICAkZWxcbiAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogdyxcbiAgICAgICAgICAgICAgICAgICAgekluZGV4OiAyXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGR1cjogb3AuZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGVhc2U6IG9wLmVhc2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBzbGlkZUxlZnRPdXQ6IGZ1bmN0aW9uKGVsLCBvKXtcbiAgICAgICAgICAgIHZhciBvcCwgJGVsID0gJChlbCk7XG4gICAgICAgICAgICB2YXIgdyA9ICRlbC5wYXJlbnQoKS5vdXRlcldpZHRoKHRydWUpO1xuXG4gICAgICAgICAgICBvcCA9ICQuZXh0ZW5kKHt9LCBBbmltYXRpb25EZWZhdWx0Q29uZmlnLCBvKTtcblxuICAgICAgICAgICAgJGVsXG4gICAgICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIHpJbmRleDogMVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBkcmF3OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAtdyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZHVyOiBvcC5kdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZWFzZTogb3AuZWFzZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNsaWRlTGVmdDogZnVuY3Rpb24oY3VycmVudCwgbmV4dCwgbyl7XG4gICAgICAgICAgICB0aGlzLnNsaWRlTGVmdE91dChjdXJyZW50LCBvKTtcbiAgICAgICAgICAgIHRoaXMuc2xpZGVMZWZ0SW4obmV4dCwgbyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2xpZGVSaWdodEluOiBmdW5jdGlvbihlbCwgbyl7XG4gICAgICAgICAgICB2YXIgb3AsICRlbCA9ICQoZWwpO1xuICAgICAgICAgICAgdmFyIHcgPSAkZWwucGFyZW50KCkub3V0ZXJXaWR0aCh0cnVlKTtcblxuICAgICAgICAgICAgb3AgPSAkLmV4dGVuZCh7fSwgQW5pbWF0aW9uRGVmYXVsdENvbmZpZywgbyk7XG5cbiAgICAgICAgICAgICRlbFxuICAgICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICBsZWZ0OiAtdyxcbiAgICAgICAgICAgICAgICAgICAgekluZGV4OiAyXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGR1cjogb3AuZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGVhc2U6IG9wLmVhc2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBzbGlkZVJpZ2h0T3V0OiBmdW5jdGlvbihlbCwgbyl7XG4gICAgICAgICAgICB2YXIgb3AsICRlbCA9ICQoZWwpO1xuICAgICAgICAgICAgdmFyIHcgPSAkZWwucGFyZW50KCkub3V0ZXJXaWR0aCh0cnVlKTtcblxuICAgICAgICAgICAgb3AgPSAkLmV4dGVuZCh7fSwgQW5pbWF0aW9uRGVmYXVsdENvbmZpZywgbyk7XG5cbiAgICAgICAgICAgICRlbFxuICAgICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IDFcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogIHcsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGR1cjogb3AuZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGVhc2U6IG9wLmVhc2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBzbGlkZVJpZ2h0OiBmdW5jdGlvbihjdXJyZW50LCBuZXh0LCBvKXtcbiAgICAgICAgICAgIHRoaXMuc2xpZGVSaWdodE91dChjdXJyZW50LCBvKTtcbiAgICAgICAgICAgIHRoaXMuc2xpZGVSaWdodEluKG5leHQsIG8pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGZhZGVJbjogZnVuY3Rpb24oZWwsIG8pe1xuICAgICAgICAgICAgdmFyIG9wID0gJC5leHRlbmQoe30sIEFuaW1hdGlvbkRlZmF1bHRDb25maWcsIG8pO1xuICAgICAgICAgICAgdmFyICRlbCA9ICQoZWwpO1xuXG4gICAgICAgICAgICAkZWxcbiAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwLFxuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZHVyOiBvcC5kdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZWFzZTogb3AuZWFzZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGZhZGVPdXQ6IGZ1bmN0aW9uKGVsLCBvKXtcbiAgICAgICAgICAgIHZhciBvcCA9ICQuZXh0ZW5kKHt9LCBBbmltYXRpb25EZWZhdWx0Q29uZmlnLCBvKTtcbiAgICAgICAgICAgIHZhciAkZWwgPSAkKGVsKTtcblxuICAgICAgICAgICAgJGVsXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBkcmF3OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGR1cjogb3AuZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGVhc2U6IG9wLmVhc2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBmYWRlOiBmdW5jdGlvbihjdXJyZW50LCBuZXh0LCBvKXtcbiAgICAgICAgICAgIHRoaXMuZmFkZU91dChjdXJyZW50LCBvKTtcbiAgICAgICAgICAgIHRoaXMuZmFkZUluKG5leHQsIG8pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHpvb21JbjogZnVuY3Rpb24oZWwsIG8pe1xuICAgICAgICAgICAgdmFyIG9wID0gJC5leHRlbmQoe30sIEFuaW1hdGlvbkRlZmF1bHRDb25maWcsIG8pO1xuICAgICAgICAgICAgdmFyICRlbCA9ICQoZWwpO1xuXG4gICAgICAgICAgICAkZWxcbiAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwLFxuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IFwic2NhbGUoMylcIixcbiAgICAgICAgICAgICAgICAgICAgekluZGV4OiAyXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBkdXI6IG9wLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICBlYXNlOiBvcC5lYXNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgem9vbU91dDogZnVuY3Rpb24oZWwsIG8pe1xuICAgICAgICAgICAgdmFyIG9wID0gJC5leHRlbmQoe30sIEFuaW1hdGlvbkRlZmF1bHRDb25maWcsIG8pO1xuICAgICAgICAgICAgdmFyICRlbCA9ICQoZWwpO1xuXG4gICAgICAgICAgICAkZWxcbiAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgekluZGV4OiAxXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiAzLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBkdXI6IG9wLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICBlYXNlOiBvcC5lYXNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgem9vbTogZnVuY3Rpb24oY3VycmVudCwgbmV4dCwgbyl7XG4gICAgICAgICAgICB0aGlzLnpvb21PdXQoY3VycmVudCwgbyk7XG4gICAgICAgICAgICB0aGlzLnpvb21JbihuZXh0LCBvKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzd2lybEluOiBmdW5jdGlvbihlbCwgbyl7XG4gICAgICAgICAgICB2YXIgb3AgPSAkLmV4dGVuZCh7fSwgQW5pbWF0aW9uRGVmYXVsdENvbmZpZywgbyk7XG4gICAgICAgICAgICB2YXIgJGVsID0gJChlbCk7XG5cbiAgICAgICAgICAgICRlbFxuICAgICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogXCJzY2FsZSgzKSByb3RhdGUoMTgwZGVnKVwiLFxuICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IDJcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICByb3RhdGU6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGR1cjogb3AuZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGVhc2U6IG9wLmVhc2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBzd2lybE91dDogZnVuY3Rpb24oZWwsIG8pe1xuICAgICAgICAgICAgdmFyIG9wID0gJC5leHRlbmQoe30sIEFuaW1hdGlvbkRlZmF1bHRDb25maWcsIG8pO1xuICAgICAgICAgICAgdmFyICRlbCA9ICQoZWwpO1xuXG4gICAgICAgICAgICAkZWxcbiAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgekluZGV4OiAxXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiAzLFxuICAgICAgICAgICAgICAgICAgICAgICAgcm90YXRlOiBcIjE4MGRlZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBkdXI6IG9wLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICBlYXNlOiBvcC5lYXNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc3dpcmw6IGZ1bmN0aW9uKGN1cnJlbnQsIG5leHQsIG8pe1xuICAgICAgICAgICAgdGhpcy5zd2lybE91dChjdXJyZW50LCBvKTtcbiAgICAgICAgICAgIHRoaXMuc3dpcmxJbihuZXh0LCBvKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBpZiAod2luZG93Lk1FVFJPX0dMT0JBTF9DT01NT04gPT09IHRydWUpIHtcbiAgICAgICAgd2luZG93LkFuaW1hdGlvbnMgPSBNZXRyby5hbmltYXRpb25zO1xuICAgIH1cbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIEFwcEJhckRlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGFwcGJhckRlZmVycmVkOiAwLFxuICAgICAgICBleHBhbmQ6IGZhbHNlLFxuICAgICAgICBleHBhbmRQb2ludDogbnVsbCxcbiAgICAgICAgZHVyYXRpb246IDEwMCxcbiAgICAgICAgb25NZW51T3BlbjogTWV0cm8ubm9vcCxcbiAgICAgICAgb25NZW51Q2xvc2U6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQmVmb3JlTWVudU9wZW46IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQmVmb3JlTWVudUNsb3NlOiBNZXRyby5ub29wLFxuICAgICAgICBvbk1lbnVDb2xsYXBzZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25NZW51RXhwYW5kOiBNZXRyby5ub29wLFxuICAgICAgICBvbkFwcEJhckNyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5hcHBCYXJTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIEFwcEJhckRlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgQXBwQmFyRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9BcHBCYXJTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmFwcEJhclNldHVwKHdpbmRvd1tcIm1ldHJvQXBwQmFyU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnYXBwLWJhcicsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKG9wdGlvbnMsIGVsZW0pIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIEFwcEJhckRlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICBpZDogVXRpbHMuZWxlbWVudElkKCdhcHAtYmFyJylcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiYXBwLWJhci1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVN0cnVjdHVyZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgaGFtYnVyZ2VyLCBtZW51LCBlbGVtZW50Q29sb3IgPSBVdGlscy5nZXRTdHlsZU9uZShlbGVtZW50LCBcImJhY2tncm91bmQtY29sb3JcIik7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJhcHAtYmFyXCIpO1xuXG4gICAgICAgICAgICBoYW1idXJnZXIgPSBlbGVtZW50LmZpbmQoXCIuaGFtYnVyZ2VyXCIpO1xuICAgICAgICAgICAgaWYgKGhhbWJ1cmdlci5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBoYW1idXJnZXIgPSAkKFwiPGJ1dHRvbj5cIikuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIikuYWRkQ2xhc3MoXCJoYW1idXJnZXIgbWVudS1kb3duXCIpO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMzsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJsaW5lXCIpLmFwcGVuZFRvKGhhbWJ1cmdlcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnRDb2xvciA9PT0gXCJyZ2JhKDAsIDAsIDAsIDApXCIgfHwgTWV0cm8uY29sb3JzLmlzTGlnaHQoZWxlbWVudENvbG9yKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBoYW1idXJnZXIuYWRkQ2xhc3MoXCJkYXJrXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5wcmVwZW5kKGhhbWJ1cmdlcik7XG4gICAgICAgICAgICBtZW51ID0gZWxlbWVudC5maW5kKFwiLmFwcC1iYXItbWVudVwiKTtcblxuICAgICAgICAgICAgaWYgKG1lbnUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgaGFtYnVyZ2VyLmNzcyhcImRpc3BsYXlcIiwgXCJub25lXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBVdGlscy5hZGRDc3NSdWxlKE1ldHJvLnNoZWV0LCBcIi5hcHAtYmFyLW1lbnUgbGlcIiwgXCJsaXN0LXN0eWxlOiBub25lIWltcG9ydGFudDtcIik7IC8vIFRoaXMgc3BlY2lhbCBmb3IgSUUxMSBhbmQgRWRnZVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaGFtYnVyZ2VyLmNzcygnZGlzcGxheScpID09PSAnYmxvY2snKSB7XG4gICAgICAgICAgICAgICAgbWVudS5oaWRlKCkuYWRkQ2xhc3MoXCJjb2xsYXBzZWRcIik7XG4gICAgICAgICAgICAgICAgaGFtYnVyZ2VyLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBoYW1idXJnZXIuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmV4cGFuZCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJhcHAtYmFyLWV4cGFuZFwiKTtcbiAgICAgICAgICAgICAgICBoYW1idXJnZXIuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8uZXhwYW5kUG9pbnQpICYmIFV0aWxzLm1lZGlhRXhpc3Qoby5leHBhbmRQb2ludCkpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImFwcC1iYXItZXhwYW5kXCIpO1xuICAgICAgICAgICAgICAgICAgICBoYW1idXJnZXIuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBtZW51ID0gZWxlbWVudC5maW5kKFwiLmFwcC1iYXItbWVudVwiKTtcbiAgICAgICAgICAgIHZhciBoYW1idXJnZXIgPSBlbGVtZW50LmZpbmQoXCIuaGFtYnVyZ2VyXCIpO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuaGFtYnVyZ2VyXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAobWVudS5sZW5ndGggPT09IDApIHJldHVybjtcbiAgICAgICAgICAgICAgICB2YXIgY29sbGFwc2VkID0gbWVudS5oYXNDbGFzcyhcImNvbGxhcHNlZFwiKTtcbiAgICAgICAgICAgICAgICBpZiAoY29sbGFwc2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQub3BlbigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKE1ldHJvLmV2ZW50cy5yZXNpemUsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIGlmIChvLmV4cGFuZCAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLmV4cGFuZFBvaW50KSAmJiBVdGlscy5tZWRpYUV4aXN0KG8uZXhwYW5kUG9pbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwiYXBwLWJhci1leHBhbmRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJtZW51LWV4cGFuZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJhcHAtYmFyLWV4cGFuZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcIm1lbnUtY29sbGFwc2VcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobWVudS5sZW5ndGggPT09IDApIHJldHVybjtcblxuICAgICAgICAgICAgICAgIGlmIChoYW1idXJnZXIuY3NzKCdkaXNwbGF5JykgIT09ICdibG9jaycpIHtcbiAgICAgICAgICAgICAgICAgICAgbWVudS5zaG93KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlU3R5bGVQcm9wZXJ0eShcImRpc3BsYXlcIik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBoYW1idXJnZXIuYWRkQ2xhc3MoXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaGFtYnVyZ2VyLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaGFtYnVyZ2VyLmhhc0NsYXNzKFwiYWN0aXZlXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZW51LnNob3coKS5yZW1vdmVDbGFzcyhcImNvbGxhcHNlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lbnUuaGlkZSgpLmFkZENsYXNzKFwiY29sbGFwc2VkXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwge25zOiB0aGlzLmlkfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBtZW51ID0gZWxlbWVudC5maW5kKFwiLmFwcC1iYXItbWVudVwiKTtcbiAgICAgICAgICAgIHZhciBoYW1idXJnZXIgPSBlbGVtZW50LmZpbmQoXCIuaGFtYnVyZ2VyXCIpO1xuXG4gICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJiZWZvcmUtbWVudS1jbG9zZVwiLCB7XG4gICAgICAgICAgICAgICAgbWVudTogbWVudVswXVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1lbnUuc2xpZGVVcChvLmR1cmF0aW9uLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgbWVudS5hZGRDbGFzcyhcImNvbGxhcHNlZFwiKS5yZW1vdmVDbGFzcyhcIm9wZW5lZFwiKTtcbiAgICAgICAgICAgICAgICBoYW1idXJnZXIucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJtZW51LWNsb3NlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgbWVudTogbWVudVswXVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb3BlbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIG1lbnUgPSBlbGVtZW50LmZpbmQoXCIuYXBwLWJhci1tZW51XCIpO1xuICAgICAgICAgICAgdmFyIGhhbWJ1cmdlciA9IGVsZW1lbnQuZmluZChcIi5oYW1idXJnZXJcIik7XG5cbiAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImJlZm9yZS1tZW51LW9wZW5cIiwge1xuICAgICAgICAgICAgICAgIG1lbnU6IG1lbnVbMF1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtZW51LnNsaWRlRG93bihvLmR1cmF0aW9uLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgbWVudS5yZW1vdmVDbGFzcyhcImNvbGxhcHNlZFwiKS5hZGRDbGFzcyhcIm9wZW5lZFwiKTtcbiAgICAgICAgICAgICAgICBoYW1idXJnZXIuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJtZW51LW9wZW5cIiwge1xuICAgICAgICAgICAgICAgICAgICBtZW51OiBtZW51WzBdXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgKi9cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbiAoYXR0cmlidXRlTmFtZSkge1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5oYW1idXJnZXJcIik7XG4gICAgICAgICAgICAkKHdpbmRvdykub2ZmKE1ldHJvLmV2ZW50cy5yZXNpemUsIHtuczogdGhpcy5pZH0pO1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBBdWRpb0J1dHRvbkRlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGF1ZGlvVm9sdW1lOiAwLjUsXG4gICAgICAgIGF1ZGlvU3JjOiBcIlwiLFxuICAgICAgICBvbkF1ZGlvU3RhcnQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQXVkaW9FbmQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQXVkaW9CdXR0b25DcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uYXVkaW9CdXR0b25TZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIEF1ZGlvQnV0dG9uRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBBdWRpb0J1dHRvbkRlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvQXVkaW9CdXR0b25TZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmF1ZGlvQnV0dG9uU2V0dXAod2luZG93W1wibWV0cm9BdWRpb0J1dHRvblNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ2F1ZGlvLWJ1dHRvbicsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG5cbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIEF1ZGlvQnV0dG9uRGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIGF1ZGlvOiBudWxsLFxuICAgICAgICAgICAgICAgIGNhblBsYXk6IG51bGwsXG4gICAgICAgICAgICAgICAgaWQ6IFV0aWxzLmVsZW1lbnRJZChcImF1ZGlvQnV0dG9uXCIpXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoJ2F1ZGlvQnV0dG9uQ3JlYXRlJywge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHRoaXMuYXVkaW8gPSBuZXcgQXVkaW8oby5hdWRpb1NyYyk7XG4gICAgICAgICAgICB0aGlzLmF1ZGlvLnZvbHVtZSA9IG8uYXVkaW9Wb2x1bWU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBhdWRpbyA9IHRoaXMuYXVkaW87XG5cbiAgICAgICAgICAgIGF1ZGlvLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlZGRhdGEnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuY2FuUGxheSA9IHRydWU7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYXVkaW8uYWRkRXZlbnRMaXN0ZW5lcignZW5kZWQnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImF1ZGlvRW5kXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgc3JjOiBvLmF1ZGlvU3JjLFxuICAgICAgICAgICAgICAgICAgICBhdWRpbzogYXVkaW9cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQucGxheSgpO1xuICAgICAgICAgICAgfSwge25zOiB0aGlzLmlkfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcGxheTogZnVuY3Rpb24oY2Ipe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgYXVkaW8gPSB0aGlzLmF1ZGlvO1xuXG4gICAgICAgICAgICBpZiAoby5hdWRpb1NyYyAhPT0gXCJcIiAmJiB0aGlzLmF1ZGlvLmR1cmF0aW9uICYmIHRoaXMuY2FuUGxheSkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiYXVkaW9TdGFydFwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHNyYzogby5hdWRpb1NyYyxcbiAgICAgICAgICAgICAgICAgICAgYXVkaW86IGF1ZGlvXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBhdWRpby5wYXVzZSgpO1xuICAgICAgICAgICAgICAgIGF1ZGlvLmN1cnJlbnRUaW1lID0gMDtcbiAgICAgICAgICAgICAgICBhdWRpby5wbGF5KCk7XG5cbiAgICAgICAgICAgICAgICBVdGlscy5leGVjKGNiLCBbYXVkaW9dLCBlbGVtZW50WzBdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzdG9wOiBmdW5jdGlvbihjYil7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBhdWRpbyA9IHRoaXMuYXVkaW87XG5cbiAgICAgICAgICAgIGF1ZGlvLnBhdXNlKCk7XG4gICAgICAgICAgICBhdWRpby5jdXJyZW50VGltZSA9IDA7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImF1ZGlvRW5kXCIsIHtcbiAgICAgICAgICAgICAgICBzcmM6IG8uYXVkaW9TcmMsXG4gICAgICAgICAgICAgICAgYXVkaW86IGF1ZGlvXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgVXRpbHMuZXhlYyhjYiwgW2F1ZGlvXSwgZWxlbWVudFswXSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGF1ZGlvID0gdGhpcy5hdWRpbztcblxuICAgICAgICAgICAgdmFyIGNoYW5nZVNyYyA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIHNyYyA9IGVsZW1lbnQuYXR0cignZGF0YS1hdWRpby1zcmMnKTtcbiAgICAgICAgICAgICAgICBpZiAoc3JjICYmIHNyYy50cmltKCkgIT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgby5hdWRpb1NyYyA9IHNyYztcbiAgICAgICAgICAgICAgICAgICAgYXVkaW8uc3JjID0gc3JjO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGNoYW5nZVZvbHVtZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIHZvbHVtZSA9IHBhcnNlRmxvYXQoZWxlbWVudC5hdHRyKCdkYXRhLWF1ZGlvLXZvbHVtZScpKTtcbiAgICAgICAgICAgICAgICBpZiAoaXNOYU4odm9sdW1lKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBvLmF1ZGlvVm9sdW1lID0gdm9sdW1lO1xuICAgICAgICAgICAgICAgIGF1ZGlvLnZvbHVtZSA9IHZvbHVtZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZU5hbWUgPT09ICdkYXRhLWF1ZGlvLXNyYycpIHtcbiAgICAgICAgICAgICAgICBjaGFuZ2VTcmMoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZU5hbWUgPT09ICdkYXRhLWF1ZGlvLXZvbHVtZScpIHtcbiAgICAgICAgICAgICAgICBjaGFuZ2VWb2x1bWUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywge25zOiB0aGlzLmlkfSk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIE1ldHJvW1wicGxheVNvdW5kXCJdID0gZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgIHZhciBhdWRpbztcbiAgICAgICAgdmFyIHNyYyA9IHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiID8gZGF0YSA6IGRhdGEuYXVkaW9TcmM7XG4gICAgICAgIHZhciB2b2x1bWUgPSBkYXRhICYmIGRhdGEuYXVkaW9Wb2x1bWUgPyBkYXRhLmF1ZGlvVm9sdW1lIDogMC41O1xuXG4gICAgICAgIGlmICghc3JjKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBhdWRpbyA9IG5ldyBBdWRpbyhzcmMpO1xuICAgICAgICBhdWRpby52b2x1bWUgPSBwYXJzZUZsb2F0KHZvbHVtZSk7XG5cbiAgICAgICAgYXVkaW8uYWRkRXZlbnRMaXN0ZW5lcignbG9hZGVkZGF0YScsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLm9uQXVkaW9TdGFydClcbiAgICAgICAgICAgICAgICBVdGlscy5leGVjKGRhdGEub25BdWRpb1N0YXJ0LCBbc3JjXSwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLnBsYXkoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYXVkaW8uYWRkRXZlbnRMaXN0ZW5lcignZW5kZWQnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5vbkF1ZGlvRW5kKVxuICAgICAgICAgICAgICAgIFV0aWxzLmV4ZWMoZGF0YS5vbkF1ZGlvRW5kLCBbbnVsbF0sIHRoaXMpO1xuICAgICAgICB9KTtcbiAgICB9O1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIEF1ZGlvUGxheWVyRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgYXVkaW9EZWZlcnJlZDogMCxcbiAgICAgICAgcGxheWxpc3Q6IG51bGwsXG4gICAgICAgIHNyYzogbnVsbCxcblxuICAgICAgICB2b2x1bWU6IC41LFxuICAgICAgICBsb29wOiBmYWxzZSxcbiAgICAgICAgYXV0b3BsYXk6IGZhbHNlLFxuXG4gICAgICAgIHNob3dMb29wOiB0cnVlLFxuICAgICAgICBzaG93UGxheTogdHJ1ZSxcbiAgICAgICAgc2hvd1N0b3A6IHRydWUsXG4gICAgICAgIHNob3dNdXRlOiB0cnVlLFxuICAgICAgICBzaG93RnVsbDogdHJ1ZSxcbiAgICAgICAgc2hvd1N0cmVhbTogdHJ1ZSxcbiAgICAgICAgc2hvd1ZvbHVtZTogdHJ1ZSxcbiAgICAgICAgc2hvd0luZm86IHRydWUsXG5cbiAgICAgICAgc2hvd1BsYXlsaXN0OiB0cnVlLFxuICAgICAgICBzaG93TmV4dDogdHJ1ZSxcbiAgICAgICAgc2hvd1ByZXY6IHRydWUsXG4gICAgICAgIHNob3dGaXJzdDogdHJ1ZSxcbiAgICAgICAgc2hvd0xhc3Q6IHRydWUsXG4gICAgICAgIHNob3dGb3J3YXJkOiB0cnVlLFxuICAgICAgICBzaG93QmFja3dhcmQ6IHRydWUsXG4gICAgICAgIHNob3dTaHVmZmxlOiB0cnVlLFxuICAgICAgICBzaG93UmFuZG9tOiB0cnVlLFxuXG4gICAgICAgIGxvb3BJY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tbG9vcCc+PC9zcGFuPlwiLFxuICAgICAgICBzdG9wSWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLXN0b3AnPjwvc3Bhbj5cIixcbiAgICAgICAgcGxheUljb246IFwiPHNwYW4gY2xhc3M9J2RlZmF1bHQtaWNvbi1wbGF5Jz48L3NwYW4+XCIsXG4gICAgICAgIHBhdXNlSWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLXBhdXNlJz48L3NwYW4+XCIsXG4gICAgICAgIG11dGVJY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tbXV0ZSc+PC9zcGFuPlwiLFxuICAgICAgICB2b2x1bWVMb3dJY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tbG93LXZvbHVtZSc+PC9zcGFuPlwiLFxuICAgICAgICB2b2x1bWVNZWRpdW1JY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tbWVkaXVtLXZvbHVtZSc+PC9zcGFuPlwiLFxuICAgICAgICB2b2x1bWVIaWdoSWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLWhpZ2gtdm9sdW1lJz48L3NwYW4+XCIsXG5cbiAgICAgICAgcGxheWxpc3RJY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tcGxheWxpc3QnPjwvc3Bhbj5cIixcbiAgICAgICAgbmV4dEljb246IFwiPHNwYW4gY2xhc3M9J2RlZmF1bHQtaWNvbi1uZXh0Jz48L3NwYW4+XCIsXG4gICAgICAgIHByZXZJY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tcHJldic+PC9zcGFuPlwiLFxuICAgICAgICBmaXJzdEljb246IFwiPHNwYW4gY2xhc3M9J2RlZmF1bHQtaWNvbi1maXJzdCc+PC9zcGFuPlwiLFxuICAgICAgICBsYXN0SWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLWxhc3QnPjwvc3Bhbj5cIixcbiAgICAgICAgZm9yd2FyZEljb246IFwiPHNwYW4gY2xhc3M9J2RlZmF1bHQtaWNvbi1mb3J3YXJkJz48L3NwYW4+XCIsXG4gICAgICAgIGJhY2t3YXJkSWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLWJhY2t3YXJkJz48L3NwYW4+XCIsXG4gICAgICAgIHNodWZmbGVJY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tc2h1ZmZsZSc+PC9zcGFuPlwiLFxuICAgICAgICByYW5kb21JY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tcmFuZG9tJz48L3NwYW4+XCIsXG5cbiAgICAgICAgb25QbGF5OiBNZXRyby5ub29wLFxuICAgICAgICBvblBhdXNlOiBNZXRyby5ub29wLFxuICAgICAgICBvblN0b3A6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uRW5kOiBNZXRyby5ub29wLFxuICAgICAgICBvbk1ldGFkYXRhOiBNZXRyby5ub29wLFxuICAgICAgICBvblRpbWU6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQXVkaW9QbGF5ZXJDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uYXVkaW9QbGF5ZXJTZXR1cCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgICAgICBBdWRpb1BsYXllckRlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgQXVkaW9QbGF5ZXJEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0F1ZGlvUGxheWVyU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5hdWRpb1BsYXllclNldHVwKHdpbmRvd1tcIm1ldHJvQXVkaW9QbGF5ZXJTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdhdWRpby1wbGF5ZXInLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgQXVkaW9QbGF5ZXJEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgcHJlbG9hZGVyOiBudWxsLFxuICAgICAgICAgICAgICAgIHBsYXllcjogbnVsbCxcbiAgICAgICAgICAgICAgICBhdWRpbzogZWxlbSxcbiAgICAgICAgICAgICAgICBzdHJlYW06IG51bGwsXG4gICAgICAgICAgICAgICAgdm9sdW1lOiBudWxsLFxuICAgICAgICAgICAgICAgIHZvbHVtZUJhY2t1cDogMCxcbiAgICAgICAgICAgICAgICBtdXRlZDogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVBsYXllcigpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlQ29udHJvbHMoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICBpZiAoby5hdXRvcGxheSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGxheSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJhdWRpby1wbGF5ZXItY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50LFxuICAgICAgICAgICAgICAgIHBsYXllcjogdGhpcy5wbGF5ZXJcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVBsYXllcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zLCBhdWRpbyA9IHRoaXMuYXVkaW87XG5cbiAgICAgICAgICAgIHZhciBwcmV2ID0gZWxlbWVudC5wcmV2KCk7XG4gICAgICAgICAgICB2YXIgcGFyZW50ID0gZWxlbWVudC5wYXJlbnQoKTtcbiAgICAgICAgICAgIHZhciBwbGF5ZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJtZWRpYS1wbGF5ZXIgYXVkaW8tcGxheWVyIFwiICsgZWxlbWVudFswXS5jbGFzc05hbWUpO1xuXG4gICAgICAgICAgICBpZiAocHJldi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBwYXJlbnQucHJlcGVuZChwbGF5ZXIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwbGF5ZXIuaW5zZXJ0QWZ0ZXIocHJldik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kVG8ocGxheWVyKTtcblxuICAgICAgICAgICAgJC5lYWNoKFsnbXV0ZWQnLCAnYXV0b3BsYXknLCAnY29udHJvbHMnLCAnaGVpZ2h0JywgJ3dpZHRoJywgJ2xvb3AnLCAncG9zdGVyJywgJ3ByZWxvYWQnXSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZUF0dHIodGhpcyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwicHJlbG9hZFwiLCBcImF1dG9cIik7XG5cbiAgICAgICAgICAgIGF1ZGlvLnZvbHVtZSA9IG8udm9sdW1lO1xuXG4gICAgICAgICAgICBpZiAoby5zcmMgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zZXRTb3VyY2Uoby5zcmMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50WzBdLmNsYXNzTmFtZSA9IFwiXCI7XG5cbiAgICAgICAgICAgIHRoaXMucGxheWVyID0gcGxheWVyO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9zZXRTb3VyY2U6IGZ1bmN0aW9uKHNyYyl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwic291cmNlXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVBdHRyKFwic3JjXCIpO1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc3JjKSkge1xuICAgICAgICAgICAgICAgICQuZWFjaChzcmMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JjID09PSB1bmRlZmluZWQpIHJldHVybiA7XG4gICAgICAgICAgICAgICAgICAgICQoXCI8c291cmNlPlwiKS5hdHRyKCdzcmMnLCBpdGVtLnNyYykuYXR0cigndHlwZScsIGl0ZW0udHlwZSAhPT0gdW5kZWZpbmVkID8gaXRlbS50eXBlIDogJycpLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJzcmNcIiwgc3JjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlQ29udHJvbHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnMsIGF1ZGlvID0gdGhpcy5lbGVtO1xuXG4gICAgICAgICAgICB2YXIgY29udHJvbHMgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJjb250cm9sc1wiKS5hZGRDbGFzcyhvLmNsc0NvbnRyb2xzKS5pbnNlcnRBZnRlcihlbGVtZW50KTtcblxuXG4gICAgICAgICAgICB2YXIgc3RyZWFtID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwic3RyZWFtXCIpLmFwcGVuZFRvKGNvbnRyb2xzKTtcbiAgICAgICAgICAgIHZhciBzdHJlYW1TbGlkZXIgPSAkKFwiPGlucHV0PlwiKS5hZGRDbGFzcyhcInN0cmVhbS1zbGlkZXIgdWx0cmEtdGhpbiBjeWNsZS1tYXJrZXJcIikuYXBwZW5kVG8oc3RyZWFtKTtcbiAgICAgICAgICAgIHZhciBwcmVsb2FkZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJsb2FkLWF1ZGlvXCIpLmFwcGVuZFRvKHN0cmVhbSk7XG5cbiAgICAgICAgICAgIHZhciB2b2x1bWUgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJ2b2x1bWVcIikuYXBwZW5kVG8oY29udHJvbHMpO1xuICAgICAgICAgICAgdmFyIHZvbHVtZVNsaWRlciA9ICQoXCI8aW5wdXQ+XCIpLmFkZENsYXNzKFwidm9sdW1lLXNsaWRlciB1bHRyYS10aGluIGN5Y2xlLW1hcmtlclwiKS5hcHBlbmRUbyh2b2x1bWUpO1xuXG4gICAgICAgICAgICB2YXIgaW5mb0JveCA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImluZm8tYm94XCIpLmFwcGVuZFRvKGNvbnRyb2xzKTtcblxuICAgICAgICAgICAgaWYgKG8uc2hvd0luZm8gIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBpbmZvQm94LmhpZGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcHJlbG9hZGVyLmFjdGl2aXR5KHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIm1ldHJvXCIsXG4gICAgICAgICAgICAgICAgc3R5bGU6IFwiY29sb3JcIlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHByZWxvYWRlci5oaWRlKDApO1xuXG4gICAgICAgICAgICB0aGlzLnByZWxvYWRlciA9IHByZWxvYWRlcjtcblxuICAgICAgICAgICAgTWV0cm8ubWFrZVBsdWdpbihzdHJlYW1TbGlkZXIsIFwic2xpZGVyXCIsIHtcbiAgICAgICAgICAgICAgICBjbHNNYXJrZXI6IFwiYmctcmVkXCIsXG4gICAgICAgICAgICAgICAgY2xzSGludDogXCJiZy1jeWFuIGZnLXdoaXRlXCIsXG4gICAgICAgICAgICAgICAgY2xzQ29tcGxldGU6IFwiYmctY3lhblwiLFxuICAgICAgICAgICAgICAgIGhpbnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgb25TdGFydDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFhdWRpby5wYXVzZWQpIGF1ZGlvLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvblN0b3A6IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhdWRpby5zZWVrYWJsZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhdWRpby5jdXJyZW50VGltZSA9ICh0aGF0LmR1cmF0aW9uICogdmFsIC8gMTAwKS50b0ZpeGVkKDApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChhdWRpby5wYXVzZWQgJiYgYXVkaW8uY3VycmVudFRpbWUgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhdWRpby5wbGF5KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5zdHJlYW0gPSBzdHJlYW1TbGlkZXI7XG5cbiAgICAgICAgICAgIGlmIChvLnNob3dTdHJlYW0gIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBzdHJlYW0uaGlkZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBNZXRyby5tYWtlUGx1Z2luKHZvbHVtZVNsaWRlciwgXCJzbGlkZXJcIiwge1xuICAgICAgICAgICAgICAgIGNsc01hcmtlcjogXCJiZy1yZWRcIixcbiAgICAgICAgICAgICAgICBjbHNIaW50OiBcImJnLWN5YW4gZmctd2hpdGVcIixcbiAgICAgICAgICAgICAgICBoaW50OiB0cnVlLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBvLnZvbHVtZSAqIDEwMCxcbiAgICAgICAgICAgICAgICBvbkNoYW5nZVZhbHVlOiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgICAgICAgICBhdWRpby52b2x1bWUgPSB2YWwgLyAxMDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMudm9sdW1lID0gdm9sdW1lU2xpZGVyO1xuXG4gICAgICAgICAgICBpZiAoby5zaG93Vm9sdW1lICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdm9sdW1lLmhpZGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGxvb3A7XG5cbiAgICAgICAgICAgIGlmIChvLnNob3dMb29wID09PSB0cnVlKSBsb29wID0gJChcIjxidXR0b24+XCIpLmF0dHIoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpLmFkZENsYXNzKFwiYnV0dG9uIHNxdWFyZSBsb29wXCIpLmh0bWwoby5sb29wSWNvbikuYXBwZW5kVG8oY29udHJvbHMpO1xuICAgICAgICAgICAgaWYgKG8uc2hvd1BsYXkgPT09IHRydWUpICQoXCI8YnV0dG9uPlwiKS5hdHRyKFwidHlwZVwiLCBcImJ1dHRvblwiKS5hZGRDbGFzcyhcImJ1dHRvbiBzcXVhcmUgcGxheVwiKS5odG1sKG8ucGxheUljb24pLmFwcGVuZFRvKGNvbnRyb2xzKTtcbiAgICAgICAgICAgIGlmIChvLnNob3dTdG9wID09PSB0cnVlKSAkKFwiPGJ1dHRvbj5cIikuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIikuYWRkQ2xhc3MoXCJidXR0b24gc3F1YXJlIHN0b3BcIikuaHRtbChvLnN0b3BJY29uKS5hcHBlbmRUbyhjb250cm9scyk7XG4gICAgICAgICAgICBpZiAoby5zaG93TXV0ZSA9PT0gdHJ1ZSkgJChcIjxidXR0b24+XCIpLmF0dHIoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpLmFkZENsYXNzKFwiYnV0dG9uIHNxdWFyZSBtdXRlXCIpLmh0bWwoby5tdXRlSWNvbikuYXBwZW5kVG8oY29udHJvbHMpO1xuXG4gICAgICAgICAgICBpZiAoby5sb29wID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgbG9vcC5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJsb29wXCIsIFwibG9vcFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fc2V0Vm9sdW1lKCk7XG5cbiAgICAgICAgICAgIGlmIChvLm11dGVkKSB7XG4gICAgICAgICAgICAgICAgdGhhdC52b2x1bWVCYWNrdXAgPSBhdWRpby52b2x1bWU7XG4gICAgICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKHRoYXQudm9sdW1lLCAnc2xpZGVyJykudmFsKDApO1xuICAgICAgICAgICAgICAgIGF1ZGlvLnZvbHVtZSA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGluZm9Cb3guaHRtbChcIjAwOjAwIC8gMDA6MDBcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucywgYXVkaW8gPSB0aGlzLmVsZW0sIHBsYXllciA9IHRoaXMucGxheWVyO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKFwibG9hZHN0YXJ0XCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5wcmVsb2FkZXIuZmFkZUluKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihcImxvYWRlZG1ldGFkYXRhXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5kdXJhdGlvbiA9IGF1ZGlvLmR1cmF0aW9uLnRvRml4ZWQoMCk7XG4gICAgICAgICAgICAgICAgdGhhdC5fc2V0SW5mbygwLCB0aGF0LmR1cmF0aW9uKTtcbiAgICAgICAgICAgICAgICBVdGlscy5leGVjKG8ub25NZXRhZGF0YSwgW2F1ZGlvLCBwbGF5ZXJdLCBlbGVtZW50WzBdKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKFwiY2FucGxheVwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuX3NldEJ1ZmZlcigpO1xuICAgICAgICAgICAgICAgIHRoYXQucHJlbG9hZGVyLmZhZGVPdXQoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKFwicHJvZ3Jlc3NcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0Ll9zZXRCdWZmZXIoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKFwidGltZXVwZGF0ZVwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IE1hdGgucm91bmQoYXVkaW8uY3VycmVudFRpbWUgKiAxMDAgLyB0aGF0LmR1cmF0aW9uKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9zZXRJbmZvKGF1ZGlvLmN1cnJlbnRUaW1lLCB0aGF0LmR1cmF0aW9uKTtcbiAgICAgICAgICAgICAgICBNZXRyby5nZXRQbHVnaW4odGhhdC5zdHJlYW0sICdzbGlkZXInKS52YWwocG9zaXRpb24pO1xuICAgICAgICAgICAgICAgIFV0aWxzLmV4ZWMoby5vblRpbWUsIFthdWRpby5jdXJyZW50VGltZSwgdGhhdC5kdXJhdGlvbiwgYXVkaW8sIHBsYXllcl0sIGVsZW1lbnRbMF0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oXCJ3YWl0aW5nXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5wcmVsb2FkZXIuZmFkZUluKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihcImxvYWRlZGRhdGFcIiwgZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oXCJwbGF5XCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgcGxheWVyLmZpbmQoXCIucGxheVwiKS5odG1sKG8ucGF1c2VJY29uKTtcbiAgICAgICAgICAgICAgICBVdGlscy5leGVjKG8ub25QbGF5LCBbYXVkaW8sIHBsYXllcl0sIGVsZW1lbnRbMF0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oXCJwYXVzZVwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHBsYXllci5maW5kKFwiLnBsYXlcIikuaHRtbChvLnBsYXlJY29uKTtcbiAgICAgICAgICAgICAgICBVdGlscy5leGVjKG8ub25QYXVzZSwgW2F1ZGlvLCBwbGF5ZXJdLCBlbGVtZW50WzBdKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKFwic3RvcFwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbih0aGF0LnN0cmVhbSwgJ3NsaWRlcicpLnZhbCgwKTtcbiAgICAgICAgICAgICAgICBVdGlscy5leGVjKG8ub25TdG9wLCBbYXVkaW8sIHBsYXllcl0sIGVsZW1lbnRbMF0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oXCJlbmRlZFwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbih0aGF0LnN0cmVhbSwgJ3NsaWRlcicpLnZhbCgwKTtcbiAgICAgICAgICAgICAgICBVdGlscy5leGVjKG8ub25FbmQsIFthdWRpbywgcGxheWVyXSwgZWxlbWVudFswXSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihcInZvbHVtZWNoYW5nZVwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuX3NldFZvbHVtZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHBsYXllci5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLnBsYXlcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAoYXVkaW8ucGF1c2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQucGxheSgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQucGF1c2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcGxheWVyLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuc3RvcFwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuc3RvcCgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHBsYXllci5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLm11dGVcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0Ll90b2dnbGVNdXRlKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcGxheWVyLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIubG9vcFwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuX3RvZ2dsZUxvb3AoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF90b2dnbGVMb29wOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGxvb3AgPSB0aGlzLnBsYXllci5maW5kKFwiLmxvb3BcIik7XG4gICAgICAgICAgICBpZiAobG9vcC5sZW5ndGggPT09IDApIHJldHVybiA7XG4gICAgICAgICAgICBsb29wLnRvZ2dsZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgaWYgKGxvb3AuaGFzQ2xhc3MoXCJhY3RpdmVcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYXR0cihcImxvb3BcIiwgXCJsb29wXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cihcImxvb3BcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3RvZ2dsZU11dGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLm11dGVkID0gIXRoaXMubXV0ZWQ7XG4gICAgICAgICAgICBpZiAodGhpcy5tdXRlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvLnZvbHVtZSA9IHRoaXMudm9sdW1lQmFja3VwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZvbHVtZUJhY2t1cCA9IHRoaXMuYXVkaW8udm9sdW1lO1xuICAgICAgICAgICAgICAgIHRoaXMuYXVkaW8udm9sdW1lID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbih0aGlzLnZvbHVtZSwgJ3NsaWRlcicpLnZhbCh0aGlzLm11dGVkID09PSBmYWxzZSA/IHRoaXMudm9sdW1lQmFja3VwICogMTAwIDogMCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3NldEluZm86IGZ1bmN0aW9uKGEsIGIpe1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuZmluZChcIi5pbmZvLWJveFwiKS5odG1sKFV0aWxzLnNlY29uZHNUb0Zvcm1hdHRlZFN0cmluZyhNYXRoLnJvdW5kKGEpKSArIFwiIC8gXCIgKyBVdGlscy5zZWNvbmRzVG9Gb3JtYXR0ZWRTdHJpbmcoTWF0aC5yb3VuZChiKSkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9zZXRCdWZmZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5hdWRpby5idWZmZXJlZC5sZW5ndGggPyBNYXRoLnJvdW5kKE1hdGguZmxvb3IodGhpcy5hdWRpby5idWZmZXJlZC5lbmQoMCkpIC8gTWF0aC5mbG9vcih0aGlzLmF1ZGlvLmR1cmF0aW9uKSAqIDEwMCkgOiAwO1xuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKHRoaXMuc3RyZWFtLCAnc2xpZGVyJykuYnVmZihidWZmZXIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9zZXRWb2x1bWU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgYXVkaW8gPSB0aGlzLmF1ZGlvLCBwbGF5ZXIgPSB0aGlzLnBsYXllciwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdmFyIHZvbHVtZUJ1dHRvbiA9IHBsYXllci5maW5kKFwiLm11dGVcIik7XG4gICAgICAgICAgICB2YXIgdm9sdW1lID0gYXVkaW8udm9sdW1lICogMTAwO1xuICAgICAgICAgICAgaWYgKHZvbHVtZSA+IDEgJiYgdm9sdW1lIDwgMzApIHtcbiAgICAgICAgICAgICAgICB2b2x1bWVCdXR0b24uaHRtbChvLnZvbHVtZUxvd0ljb24pO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh2b2x1bWUgPj0gMzAgJiYgdm9sdW1lIDwgNjApIHtcbiAgICAgICAgICAgICAgICB2b2x1bWVCdXR0b24uaHRtbChvLnZvbHVtZU1lZGl1bUljb24pO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh2b2x1bWUgPj0gNjAgJiYgdm9sdW1lIDw9IDEwMCkge1xuICAgICAgICAgICAgICAgIHZvbHVtZUJ1dHRvbi5odG1sKG8udm9sdW1lSGlnaEljb24pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2b2x1bWVCdXR0b24uaHRtbChvLm11dGVJY29uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBwbGF5OiBmdW5jdGlvbihzcmMpe1xuICAgICAgICAgICAgaWYgKHNyYyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2V0U291cmNlKHNyYyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmVsZW1lbnQuYXR0cihcInNyY1wiKSA9PT0gdW5kZWZpbmVkICYmIHRoaXMuZWxlbWVudC5maW5kKFwic291cmNlXCIpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuYXVkaW8ucGxheSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHBhdXNlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5hdWRpby5wYXVzZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlc3VtZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmF1ZGlvLnBhdXNlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMucGxheSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHN0b3A6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmF1ZGlvLnBhdXNlKCk7XG4gICAgICAgICAgICB0aGlzLmF1ZGlvLmN1cnJlbnRUaW1lID0gMDtcbiAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbih0aGlzLnN0cmVhbSwgJ3NsaWRlcicpLnZhbCgwKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRWb2x1bWU6IGZ1bmN0aW9uKHYpe1xuICAgICAgICAgICAgaWYgKHYgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmF1ZGlvLnZvbHVtZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHYgPiAxKSB7XG4gICAgICAgICAgICAgICAgdiAvPSAxMDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuYXVkaW8udm9sdW1lID0gdjtcbiAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbih0aGlzLnZvbHVtZSwgJ3NsaWRlcicpLnZhbCh2KjEwMCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbG9vcDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuX3RvZ2dsZUxvb3AoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBtdXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5fdG9nZ2xlTXV0ZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZVNvdXJjZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBzcmMgPSBKU09OLnBhcnNlKHRoaXMuZWxlbWVudC5hdHRyKCdkYXRhLXNyYycpKTtcbiAgICAgICAgICAgIHRoaXMucGxheShzcmMpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZVZvbHVtZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB2b2x1bWUgPSB0aGlzLmVsZW1lbnQuYXR0cihcImRhdGEtdm9sdW1lXCIpO1xuICAgICAgICAgICAgdGhpcy5zZXRWb2x1bWUodm9sdW1lKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHJpYnV0ZU5hbWUpe1xuICAgICAgICAgICAgc3dpdGNoIChhdHRyaWJ1dGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtc3JjXCI6IHRoaXMuY2hhbmdlU291cmNlKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLXZvbHVtZVwiOiB0aGlzLmNoYW5nZVZvbHVtZSgpOyBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIHBsYXllciA9IHRoaXMucGxheWVyO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9mZihcImFsbFwiKTtcbiAgICAgICAgICAgIHBsYXllci5vZmYoXCJhbGxcIik7XG5cbiAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbih0aGlzLnN0cmVhbSwgXCJzbGlkZXJcIikuZGVzdHJveSgpO1xuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKHRoaXMudm9sdW1lLCBcInNsaWRlclwiKS5kZXN0cm95KCk7XG5cbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgQm90dG9tU2hlZXREZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBib3R0b21zaGVldERlZmVycmVkOiAwLFxuICAgICAgICBtb2RlOiBcImxpc3RcIixcbiAgICAgICAgdG9nZ2xlOiBudWxsLFxuICAgICAgICBvbk9wZW46IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQ2xvc2U6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQm90dG9tU2hlZXRDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uYm90dG9tU2hlZXRTZXR1cCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgICAgICBCb3R0b21TaGVldERlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgQm90dG9tU2hlZXREZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0JvdHRvbVNoZWV0U2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5ib3R0b21TaGVldFNldHVwKHdpbmRvd1tcIm1ldHJvQm90dG9tU2hlZXRTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdib3R0b20tc2hlZXQnLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgQm90dG9tU2hlZXREZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgdG9nZ2xlOiBudWxsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJib3R0b20tc2hlZXQtY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgZWxlbWVudFxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcImJvdHRvbS1zaGVldFwiKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhvLm1vZGUrXCItbGlzdFwiKTtcblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby50b2dnbGUpICYmICQoby50b2dnbGUpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZSA9ICQoby50b2dnbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKHRoaXMudG9nZ2xlKSkge1xuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC50b2dnbGUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwibGlcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0LmNsb3NlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBpc09wZW46IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50Lmhhc0NsYXNzKFwib3BlbmVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9wZW46IGZ1bmN0aW9uKG1vZGUpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG1vZGUpKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcyhcImxpc3Qtc3R5bGUgZ3JpZC1zdHlsZVwiKS5hZGRDbGFzcyhtb2RlK1wiLXN0eWxlXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJvcGVuZWRcIik7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcIm9wZW5cIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcyhcIm9wZW5lZFwiKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiY2xvc2VcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbihtb2RlKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzT3BlbigpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wZW4obW9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lICovXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSl7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZSh0aGlzLnRvZ2dsZSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZS5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcImxpXCIpO1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIE1ldHJvWydib3R0b21zaGVldCddID0ge1xuICAgICAgICBpc0JvdHRvbVNoZWV0OiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICByZXR1cm4gVXRpbHMuaXNNZXRyb09iamVjdChlbCwgXCJib3R0b20tc2hlZXRcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb3BlbjogZnVuY3Rpb24oZWwsIGFzKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0JvdHRvbVNoZWV0KGVsKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbihlbCwgXCJib3R0b20tc2hlZXRcIikub3Blbihhcyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0JvdHRvbVNoZWV0KGVsKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbihlbCwgXCJib3R0b20tc2hlZXRcIikuY2xvc2UoKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKGVsLCBhcyl7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNCb3R0b21TaGVldChlbCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5pc09wZW4oZWwpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZShlbCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMub3BlbihlbCwgYXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGlzT3BlbjogZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzQm90dG9tU2hlZXQoZWwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIE1ldHJvLmdldFBsdWdpbihlbCwgXCJib3R0b20tc2hlZXRcIikuaXNPcGVuKCk7XG4gICAgICAgIH1cbiAgICB9O1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIEJ1dHRvbkdyb3VwRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgYnV0dG9uZ3JvdXBEZWZlcnJlZDogMCxcbiAgICAgICAgdGFyZ2V0czogXCJidXR0b25cIixcbiAgICAgICAgY2xzQWN0aXZlOiBcIlwiLFxuICAgICAgICByZXF1aXJlZEJ1dHRvbjogZmFsc2UsXG4gICAgICAgIG1vZGU6IE1ldHJvLmdyb3VwTW9kZS5PTkUsXG4gICAgICAgIG9uQnV0dG9uQ2xpY2s6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQnV0dG9uR3JvdXBDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uYnV0dG9uR3JvdXBTZXR1cCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgICAgICBCdXR0b25Hcm91cERlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgQnV0dG9uR3JvdXBEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0J1dHRvbkdyb3VwU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5idXR0b25Hcm91cFNldHVwKHdpbmRvd1tcIm1ldHJvQnV0dG9uR3JvdXBTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdidXR0b24tZ3JvdXAnLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgQnV0dG9uR3JvdXBEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgYWN0aXZlOiBudWxsLFxuICAgICAgICAgICAgICAgIGlkOiBVdGlscy5lbGVtZW50SWQoXCJidXR0b24tZ3JvdXBcIilcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUdyb3VwKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiYnV0dG9uLWdyb3VwLWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlR3JvdXA6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBidXR0b25zLCBidXR0b25zX2FjdGl2ZTtcblxuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImJ1dHRvbi1ncm91cFwiKTtcblxuICAgICAgICAgICAgYnV0dG9ucyA9IGVsZW1lbnQuZmluZCggby50YXJnZXRzICk7XG4gICAgICAgICAgICBidXR0b25zX2FjdGl2ZSA9IGVsZW1lbnQuZmluZCggXCIuYWN0aXZlXCIgKTtcblxuICAgICAgICAgICAgaWYgKG8ubW9kZSA9PT0gTWV0cm8uZ3JvdXBNb2RlLk9ORSAmJiBidXR0b25zX2FjdGl2ZS5sZW5ndGggPT09IDAgJiYgby5yZXF1aXJlZEJ1dHRvbiA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICQoYnV0dG9uc1swXSkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLm1vZGUgPT09IE1ldHJvLmdyb3VwTW9kZS5PTkUgJiYgYnV0dG9uc19hY3RpdmUubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIGJ1dHRvbnMucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIikucmVtb3ZlQ2xhc3Moby5jbHNBY3RpdmUpO1xuICAgICAgICAgICAgICAgICQoYnV0dG9uc1swXSkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAuZmluZCggXCIuYWN0aXZlXCIgKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcImpzLWFjdGl2ZVwiKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhvLmNsc0FjdGl2ZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIG8udGFyZ2V0cywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgZWwgPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiYnV0dG9uLWNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uOiB0aGlzXG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgIGlmIChvLm1vZGUgPT09IE1ldHJvLmdyb3VwTW9kZS5PTkUgJiYgZWwuaGFzQ2xhc3MoXCJhY3RpdmVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoby5tb2RlID09PSBNZXRyby5ncm91cE1vZGUuT05FKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZChvLnRhcmdldHMpLnJlbW92ZUNsYXNzKG8uY2xzQWN0aXZlKS5yZW1vdmVDbGFzcyhcImFjdGl2ZSBqcy1hY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgICAgIGVsLmFkZENsYXNzKFwiYWN0aXZlXCIpLmFkZENsYXNzKG8uY2xzQWN0aXZlKS5hZGRDbGFzcyhcImpzLWFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBlbC50b2dnbGVDbGFzcyhcImFjdGl2ZVwiKS50b2dnbGVDbGFzcyhvLmNsc0FjdGl2ZSkudG9nZ2xlQ2xhc3MoXCJqcy1hY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgKi9cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuY2xpY2ssIG8udGFyZ2V0cyk7XG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuXG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgQ2FsZW5kYXJEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBzaG93R2hvc3Q6IGZhbHNlLFxuICAgICAgICBldmVudHM6IG51bGwsXG4gICAgICAgIHN0YXJ0Q29udGVudDogXCJkYXlzXCIsXG4gICAgICAgIHNob3dUaW1lOiBmYWxzZSxcbiAgICAgICAgaW5pdGlhbFRpbWU6IG51bGwsXG4gICAgICAgIGluaXRpYWxIb3VyczogbnVsbCxcbiAgICAgICAgaW5pdGlhbE1pbnV0ZXM6IG51bGwsXG4gICAgICAgIGxhYmVsVGltZUhvdXJzOiBudWxsLFxuICAgICAgICBsYWJlbFRpbWVNaW51dGVzOiBudWxsLFxuXG4gICAgICAgIGFuaW1hdGlvbkNvbnRlbnQ6IHRydWUsXG4gICAgICAgIGFuaW1hdGlvblNwZWVkOiAxMCxcblxuICAgICAgICBjYWxlbmRhckRlZmVycmVkOiAwLFxuICAgICAgICBkYXlCb3JkZXI6IGZhbHNlLFxuICAgICAgICBleGNsdWRlRGF5OiBudWxsLFxuICAgICAgICBwcmV2TW9udGhJY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tY2hldnJvbi1sZWZ0Jz48L3NwYW4+XCIsXG4gICAgICAgIG5leHRNb250aEljb246IFwiPHNwYW4gY2xhc3M9J2RlZmF1bHQtaWNvbi1jaGV2cm9uLXJpZ2h0Jz48L3NwYW4+XCIsXG4gICAgICAgIHByZXZZZWFySWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLWNoZXZyb24tbGVmdCc+PC9zcGFuPlwiLFxuICAgICAgICBuZXh0WWVhckljb246IFwiPHNwYW4gY2xhc3M9J2RlZmF1bHQtaWNvbi1jaGV2cm9uLXJpZ2h0Jz48L3NwYW4+XCIsXG4gICAgICAgIGNvbXBhY3Q6IGZhbHNlLFxuICAgICAgICB3aWRlOiBmYWxzZSxcbiAgICAgICAgd2lkZVBvaW50OiBudWxsLFxuICAgICAgICBwaWNrZXJNb2RlOiBmYWxzZSxcbiAgICAgICAgc2hvdzogbnVsbCxcbiAgICAgICAgbG9jYWxlOiBNRVRST19MT0NBTEUsXG4gICAgICAgIHdlZWtTdGFydDogTUVUUk9fV0VFS19TVEFSVCxcbiAgICAgICAgb3V0c2lkZTogdHJ1ZSxcbiAgICAgICAgYnV0dG9uczogJ2NhbmNlbCwgdG9kYXksIGNsZWFyLCBkb25lJyxcbiAgICAgICAgeWVhcnNCZWZvcmU6IDEwMCxcbiAgICAgICAgeWVhcnNBZnRlcjogMTAwLFxuICAgICAgICBoZWFkZXJGb3JtYXQ6IFwiZGRkZCwgTU1NIEREXCIsXG4gICAgICAgIHNob3dIZWFkZXI6IHRydWUsXG4gICAgICAgIHNob3dGb290ZXI6IHRydWUsXG4gICAgICAgIHNob3dXZWVrTnVtYmVyOiBmYWxzZSxcblxuICAgICAgICBpc0RpYWxvZzogZmFsc2UsXG4gICAgICAgIHJpcHBsZTogZmFsc2UsXG4gICAgICAgIHJpcHBsZUNvbG9yOiBcIiNjY2NjY2NcIixcbiAgICAgICAgZXhjbHVkZTogbnVsbCxcbiAgICAgICAgcHJlc2V0OiBudWxsLFxuICAgICAgICBtaW5EYXRlOiBudWxsLFxuICAgICAgICBtYXhEYXRlOiBudWxsLFxuICAgICAgICB3ZWVrRGF5Q2xpY2s6IGZhbHNlLFxuICAgICAgICB3ZWVrTnVtYmVyQ2xpY2s6IGZhbHNlLFxuICAgICAgICBtdWx0aVNlbGVjdDogZmFsc2UsXG4gICAgICAgIHNwZWNpYWw6IG51bGwsXG4gICAgICAgIGZvcm1hdDogTUVUUk9fREFURV9GT1JNQVQsXG4gICAgICAgIGlucHV0Rm9ybWF0OiBudWxsLFxuXG4gICAgICAgIGNsc0NhbGVuZGFyOiBcIlwiLFxuICAgICAgICBjbHNDYWxlbmRhckhlYWRlcjogXCJcIixcbiAgICAgICAgY2xzQ2FsZW5kYXJDb250ZW50OiBcIlwiLFxuICAgICAgICBjbHNDYWxlbmRhckZvb3RlcjogXCJcIixcbiAgICAgICAgY2xzQ2FsZW5kYXJNb250aHM6IFwiXCIsXG4gICAgICAgIGNsc0NhbGVuZGFyWWVhcnM6IFwiXCIsXG4gICAgICAgIGNsc1RvZGF5OiBcIlwiLFxuICAgICAgICBjbHNTZWxlY3RlZDogXCJcIixcbiAgICAgICAgY2xzRXhjbHVkZWQ6IFwiXCIsXG4gICAgICAgIGNsc0NhbmNlbEJ1dHRvbjogXCJcIixcbiAgICAgICAgY2xzVG9kYXlCdXR0b246IFwiXCIsXG4gICAgICAgIGNsc0NsZWFyQnV0dG9uOiBcIlwiLFxuICAgICAgICBjbHNEb25lQnV0dG9uOiBcIlwiLFxuICAgICAgICBjbHNFdmVudENvdW50ZXI6IFwiXCIsXG4gICAgICAgIGNsc1dlZWtlbmQ6IFwiXCIsXG4gICAgICAgIGNsc0N1cnJlbnRXZWVrOiBcIlwiLFxuICAgICAgICBjbHNDYWxlbmRhclRpbWU6IFwiXCIsXG4gICAgICAgIGNsc1RpbWU6IFwiXCIsXG4gICAgICAgIGNsc1RpbWVIb3VyczogXCJcIixcbiAgICAgICAgY2xzVGltZU1pbnV0ZXM6IFwiXCIsXG4gICAgICAgIGNsc1RpbWVCdXR0b246IFwiXCIsXG4gICAgICAgIGNsc1RpbWVCdXR0b25QbHVzOiBcIlwiLFxuICAgICAgICBjbHNUaW1lQnV0dG9uTWludXM6IFwiXCIsXG4gICAgICAgIGNsc1NwZWNpYWw6IFwiXCIsXG4gICAgICAgIGNsc0V2ZW50czogXCJcIixcbiAgICAgICAgY2xzRXZlbnQ6IFwiXCIsXG5cbiAgICAgICAgb25DYW5jZWw6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uVG9kYXk6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQ2xlYXI6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uRG9uZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EYXlDbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EcmF3RGF5OiBNZXRyby5ub29wLFxuICAgICAgICBvbkRyYXdNb250aDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EcmF3WWVhcjogTWV0cm8ubm9vcCxcbiAgICAgICAgb25XZWVrRGF5Q2xpY2s6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uV2Vla051bWJlckNsaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvbk1vbnRoQ2hhbmdlOiBNZXRyby5ub29wLFxuICAgICAgICBvblllYXJDaGFuZ2U6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uVGltZUNoYW5nZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Ib3Vyc0NoYW5nZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25NaW51dGVzQ2hhbmdlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNhbGVuZGFyQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmNhbGVuZGFyU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBDYWxlbmRhckRlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgQ2FsZW5kYXJEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0NhbGVuZGFyU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5jYWxlbmRhclNldHVwKHdpbmRvd1tcIm1ldHJvQ2FsZW5kYXJTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdjYWxlbmRhcicsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG5cbiAgICAgICAgICAgIHZhciBub3cgPSBkYXRldGltZSgpLmFsaWduKFwiZGF5XCIpO1xuXG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBDYWxlbmRhckRlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICB0b2RheTogbm93LFxuICAgICAgICAgICAgICAgIHNob3c6IG5vdyxcbiAgICAgICAgICAgICAgICBjdXJyZW50OiB7XG4gICAgICAgICAgICAgICAgICAgIHllYXI6IG5vdy55ZWFyKCksXG4gICAgICAgICAgICAgICAgICAgIG1vbnRoOiBub3cubW9udGgoKSxcbiAgICAgICAgICAgICAgICAgICAgZGF5OiBub3cuZGF5KClcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHByZXNldDogW10sXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IFtdLFxuICAgICAgICAgICAgICAgIGV4Y2x1ZGU6IFtdLFxuICAgICAgICAgICAgICAgIHNwZWNpYWw6IFtdLFxuICAgICAgICAgICAgICAgIGV4Y2x1ZGVEYXk6IFtdLFxuICAgICAgICAgICAgICAgIGV2ZW50czogW10sXG4gICAgICAgICAgICAgICAgbWluOiBudWxsLFxuICAgICAgICAgICAgICAgIG1heDogbnVsbCxcbiAgICAgICAgICAgICAgICBsb2NhbGU6IG51bGwsXG4gICAgICAgICAgICAgICAgbWluWWVhcjogbnVsbCxcbiAgICAgICAgICAgICAgICBtYXhZZWFyOiBudWxsLFxuICAgICAgICAgICAgICAgIGlkOiBVdGlscy5lbGVtZW50SWQoXCJjYWxlbmRhclwiKSxcbiAgICAgICAgICAgICAgICB0aW1lOiBbZGF0ZXRpbWUoKS5ob3VyKCksIGRhdGV0aW1lKCkubWludXRlKCldLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IFwiZGF5c1wiLFxuICAgICAgICAgICAgICAgIHllYXJEaXN0YW5jZTogMTEsXG4gICAgICAgICAgICAgICAgeWVhckdyb3VwU3RhcnQ6IG5vdy55ZWFyKClcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIHRoaXMuY29udGVudCA9IG8uc3RhcnRDb250ZW50O1xuICAgICAgICAgICAgdGhpcy5taW5ZZWFyID0gdGhpcy5jdXJyZW50LnllYXIgLSB0aGlzLm9wdGlvbnMueWVhcnNCZWZvcmU7XG4gICAgICAgICAgICB0aGlzLm1heFllYXIgPSB0aGlzLmN1cnJlbnQueWVhciArIHRoaXMub3B0aW9ucy55ZWFyc0FmdGVyO1xuXG4gICAgICAgICAgICBlbGVtZW50Lmh0bWwoXCJcIikuYWRkQ2xhc3MoXCJjYWxlbmRhciBcIiArIChvLmNvbXBhY3QgPT09IHRydWUgPyBcImNvbXBhY3RcIiA6IFwiXCIpKS5hZGRDbGFzcyhvLmNsc0NhbGVuZGFyKTtcblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5pbml0aWFsVGltZSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWUgPSBvLmluaXRpYWxUaW1lLnNwbGl0KFwiOlwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5pbml0aWFsSG91cnMpICYmIFV0aWxzLmJldHdlZW4oby5pbml0aWFsSG91cnMsIDAsIDIzLCB0cnVlKSkge1xuICAgICAgICAgICAgICAgIHRoaXMudGltZVswXSA9IHBhcnNlSW50KG8uaW5pdGlhbEhvdXJzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5pbml0aWFsTWludXRlcykgJiYgVXRpbHMuYmV0d2VlbihvLmluaXRpYWxNaW51dGVzLCAwLCA1OSwgdHJ1ZSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVbMV0gPSBwYXJzZUludChvLmluaXRpYWxNaW51dGVzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uZGF5Qm9yZGVyID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImRheS1ib3JkZXJcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8uZXhjbHVkZURheSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmV4Y2x1ZGVEYXkgPSAoXCJcIitvLmV4Y2x1ZGVEYXkpLnRvQXJyYXkoXCIsXCIsIFwiaW50XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLnByZXNldCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9kYXRlczJhcnJheShvLnByZXNldCwgJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8uZXhjbHVkZSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9kYXRlczJhcnJheShvLmV4Y2x1ZGUsICdleGNsdWRlJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8uc3BlY2lhbCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9kYXRlczJhcnJheShvLnNwZWNpYWwsICdzcGVjaWFsJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8uZXZlbnRzKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RhdGVzMmFycmF5KG8uZXZlbnRzLCAnZXZlbnRzJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmJ1dHRvbnMgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoby5idXR0b25zKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgby5idXR0b25zID0gby5idXR0b25zLnNwbGl0KFwiLFwiKS5tYXAoZnVuY3Rpb24oaXRlbSl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5taW4gPSBvLm1pbkRhdGUgPyAoby5pbnB1dEZvcm1hdCA/IERhdGV0aW1lLmZyb20oby5taW5EYXRlLCBvLmlucHV0Rm9ybWF0KSA6IGRhdGV0aW1lKG8ubWluRGF0ZSkpLmFsaWduKFwiZGF5XCIpIDogbnVsbDtcbiAgICAgICAgICAgIHRoaXMubWF4ID0gby5tYXhEYXRlID8gKG8uaW5wdXRGb3JtYXQgPyBEYXRldGltZS5mcm9tKG8ubWF4RGF0ZSwgby5pbnB1dEZvcm1hdCkgOiBkYXRldGltZShvLm1heERhdGUpKS5hbGlnbihcImRheVwiKSA6IG51bGw7XG5cbiAgICAgICAgICAgIGlmIChvLnNob3cpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3cgPSAoIW8uc2hvdyA/IGRhdGV0aW1lKCkgOiBvLmlucHV0Rm9ybWF0ID8gRGF0ZXRpbWUuZnJvbShvLnNob3csIG8uaW5wdXRGb3JtYXQpIDogZGF0ZXRpbWUoby5zaG93KSkuYWxpZ24oXCJkYXlcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50ID0ge1xuICAgICAgICAgICAgICAgICAgICB5ZWFyOiB0aGlzLnNob3cueWVhcigpLFxuICAgICAgICAgICAgICAgICAgICBtb250aDogdGhpcy5zaG93Lm1vbnRoKCksXG4gICAgICAgICAgICAgICAgICAgIGRheTogdGhpcy5zaG93LmRheSgpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmxvY2FsZSA9IE1ldHJvLmxvY2FsZXNbby5sb2NhbGVdICE9PSB1bmRlZmluZWQgPyBNZXRyby5sb2NhbGVzW28ubG9jYWxlXSA6IE1ldHJvLmxvY2FsZXNbXCJlbi1VU1wiXTtcblxuICAgICAgICAgICAgdGhpcy5fZHJhd0NhbGVuZGFyKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcblxuICAgICAgICAgICAgaWYgKG8ud2lkZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJjYWxlbmRhci13aWRlXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoIVV0aWxzLmlzTnVsbChvLndpZGVQb2ludCkgJiYgVXRpbHMubWVkaWFFeGlzdChvLndpZGVQb2ludCkpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImNhbGVuZGFyLXdpZGVcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIGlmIChvLnJpcHBsZSA9PT0gdHJ1ZSAmJiBVdGlscy5pc0Z1bmMoZWxlbWVudC5yaXBwbGUpICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQucmlwcGxlKHtcbiAgICAgICAgICAgICAgICAgICAgcmlwcGxlVGFyZ2V0OiBcIi5idXR0b24sIC5wcmV2LW1vbnRoLCAubmV4dC1tb250aCwgLnByZXYteWVhciwgLm5leHQteWVhciwgLmRheVwiLFxuICAgICAgICAgICAgICAgICAgICByaXBwbGVDb2xvcjogdGhpcy5vcHRpb25zLnJpcHBsZUNvbG9yXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImNhbGVuZGFyLWNyZWF0ZVwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfZGF0ZXMyYXJyYXk6IGZ1bmN0aW9uKHZhbCwgY2F0ZWdvcnkpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGRhdGVzO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNOdWxsKHZhbCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkYXRlcyA9IHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnID8gdmFsLnRvQXJyYXkoKSA6IEFycmF5LmlzQXJyYXkodmFsKSA/IHZhbCA6IFtdO1xuXG4gICAgICAgICAgICAkLmVhY2goZGF0ZXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIF9kLCBkYXRlID0gdGhpcztcblxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIF9kID0gKG8uaW5wdXRGb3JtYXQgPyBEYXRldGltZS5mcm9tKGRhdGUsIG8uaW5wdXRGb3JtYXQpIDogZGF0ZXRpbWUoZGF0ZSkpLmFsaWduKCdkYXknKS5mb3JtYXQoJ1lZWVktTU0tREQnKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGF0W2NhdGVnb3J5XS5wdXNoKF9kKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgICQod2luZG93KS5vbihNZXRyby5ldmVudHMucmVzaXplLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmIChvLndpZGUgIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFVdGlscy5pc051bGwoby53aWRlUG9pbnQpICYmIFV0aWxzLm1lZGlhRXhpc3Qoby53aWRlUG9pbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwiY2FsZW5kYXItd2lkZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJjYWxlbmRhci13aWRlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwge25zOiB0aGlzLmlkfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5wcmV2LXllYXItZ3JvdXAsIC5uZXh0LXllYXItZ3JvdXBcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcyhcInByZXYteWVhci1ncm91cFwiKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnllYXJHcm91cFN0YXJ0IC09IHRoYXQueWVhckRpc3RhbmNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQueWVhckdyb3VwU3RhcnQgKz0gdGhhdC55ZWFyRGlzdGFuY2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoYXQuX2RyYXdDb250ZW50KCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLnByZXYtbW9udGgsIC5uZXh0LW1vbnRoLCAucHJldi15ZWFyLCAubmV4dC15ZWFyXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIG5ld19kYXRlLCBlbCA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZWwuaGFzQ2xhc3MoXCJwcmV2LW1vbnRoXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld19kYXRlID0gZGF0ZXRpbWUodGhhdC5jdXJyZW50LnllYXIsIHRoYXQuY3VycmVudC5tb250aCAtIDEsIDEpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobmV3X2RhdGUueWVhcigpIDwgdGhhdC5taW5ZZWFyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlbC5oYXNDbGFzcyhcIm5leHQtbW9udGhcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3X2RhdGUgPSBkYXRldGltZSh0aGF0LmN1cnJlbnQueWVhciwgdGhhdC5jdXJyZW50Lm1vbnRoICsgMSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdfZGF0ZS55ZWFyKCkgPiB0aGF0Lm1heFllYXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGVsLmhhc0NsYXNzKFwicHJldi15ZWFyXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld19kYXRlID0gZGF0ZXRpbWUodGhhdC5jdXJyZW50LnllYXIgLSAxLCB0aGF0LmN1cnJlbnQubW9udGgsIDEpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobmV3X2RhdGUueWVhcigpIDwgdGhhdC5taW5ZZWFyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlbC5oYXNDbGFzcyhcIm5leHQteWVhclwiKSkge1xuICAgICAgICAgICAgICAgICAgICBuZXdfZGF0ZSA9IGRhdGV0aW1lKHRoYXQuY3VycmVudC55ZWFyICsgMSwgdGhhdC5jdXJyZW50Lm1vbnRoLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld19kYXRlLnllYXIoKSA+IHRoYXQubWF4WWVhcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudCA9IHtcbiAgICAgICAgICAgICAgICAgICAgeWVhcjogbmV3X2RhdGUueWVhcigpLFxuICAgICAgICAgICAgICAgICAgICBtb250aDogbmV3X2RhdGUubW9udGgoKSxcbiAgICAgICAgICAgICAgICAgICAgZGF5OiBuZXdfZGF0ZS5kYXkoKVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2RyYXdDb250ZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlbC5oYXNDbGFzcyhcInByZXYtbW9udGhcIikgfHwgZWwuaGFzQ2xhc3MoXCJuZXh0LW1vbnRoXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJtb250aC1jaGFuZ2VcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQ6IHRoYXQuY3VycmVudFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGVsLmhhc0NsYXNzKFwicHJldi15ZWFyXCIpIHx8IGVsLmhhc0NsYXNzKFwibmV4dC15ZWFyXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJ5ZWFyLWNoYW5nZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudDogdGhhdC5jdXJyZW50XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIG8ucmlwcGxlID8gMzAwIDogMSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmJ1dHRvbi50b2RheVwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQudG9EYXkoKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJ0b2RheVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHRvZGF5OiB0aGF0LnRvZGF5LnZhbCgpLFxuICAgICAgICAgICAgICAgICAgICB0aW1lOiB0aGF0LnRpbWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuYnV0dG9uLmNsZWFyXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBkYXRldGltZSgpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5zZWxlY3RlZCA9IFtdO1xuICAgICAgICAgICAgICAgIHRoYXQudGltZSA9IFtkYXRlLmhvdXIoKSwgZGF0ZS5taW51dGUoKV07XG4gICAgICAgICAgICAgICAgdGhhdC55ZWFyR3JvdXBTdGFydCA9IGRhdGUueWVhcigpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2RyYXdDb250ZW50KCk7XG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiY2xlYXJcIik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmJ1dHRvbi5jYW5jZWxcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0Ll9kcmF3Q29udGVudCgpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImNhbmNlbFwiKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuYnV0dG9uLmRvbmVcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0Ll9kcmF3Q29udGVudCgpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImRvbmVcIiwge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogdGhhdC5zZWxlY3RlZCxcbiAgICAgICAgICAgICAgICAgICAgdGltZTogdGhhdC50aW1lXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKG8ud2Vla0RheUNsaWNrID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLndlZWstZGF5cyAud2Vlay1kYXlcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRheSwgaW5kZXgsIGRheXMsIGlpID0gW107XG5cbiAgICAgICAgICAgICAgICAgICAgZGF5ID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBkYXkuaW5kZXgoKTtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDc7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWkucHVzaChpbmRleCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleCArPSBvLnNob3dXZWVrTnVtYmVyID8gOCA6IDc7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoby5tdWx0aVNlbGVjdCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF5cyA9IGVsZW1lbnQuZmluZChcIi5kYXlcIikuZmlsdGVyKGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGVsID0gJChlbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlpLmluZGV4T2YoJGVsLmluZGV4KCkpID4gLTEgJiYgISRlbC5oYXNDbGFzcyhcIm91dHNpZGUgZGlzYWJsZWQgZXhjbHVkZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goZGF5cywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkZWwgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXkgPSAkZWwuZGF0YSgnZGF5Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5zZWxlY3RlZC5pbmRleE9mKGRheSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuc2VsZWN0ZWQucHVzaChkYXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZWwuYWRkQ2xhc3MoXCJzZWxlY3RlZFwiKS5hZGRDbGFzcyhvLmNsc1NlbGVjdGVkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZWwucmVtb3ZlQ2xhc3MoXCJzZWxlY3RlZFwiKS5yZW1vdmVDbGFzcyhvLmNsc1NlbGVjdGVkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuYXJyYXlEZWxldGUodGhhdC5zZWxlY3RlZCwgZGF5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcIndlZWstZGF5LWNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiB0aGF0LnNlbGVjdGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF5OiBkYXlbMF1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby53ZWVrTnVtYmVyQ2xpY2spIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIud2Vlay1udW1iZXJcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICRlbCwgd24sIGluZGV4LCBkYXlzO1xuXG4gICAgICAgICAgICAgICAgICAgICRlbCA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIHduID0gJGVsLnRleHQoKTtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSAkZWwuaW5kZXgoKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAod24gPT09IFwiI1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG8ubXVsdGlTZWxlY3QgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRheXMgPSBlbGVtZW50LmZpbmQoXCIuZGF5XCIpLmZpbHRlcihmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRlbCA9ICQoZWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbEluZGV4ID0gJGVsLmluZGV4KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFV0aWxzLmJldHdlZW4oZWxJbmRleCwgaW5kZXgsIGluZGV4ICsgOCwgZmFsc2UpICYmICEkZWwuaGFzQ2xhc3MoXCJvdXRzaWRlIGRpc2FibGVkIGV4Y2x1ZGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGRheXMsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGVsID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF5ID0gJGVsLmRhdGEoJ2RheScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQuc2VsZWN0ZWQuaW5kZXhPZihkYXkpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LnNlbGVjdGVkLnB1c2goZGF5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGVsLmFkZENsYXNzKFwic2VsZWN0ZWRcIikuYWRkQ2xhc3Moby5jbHNTZWxlY3RlZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGVsLnJlbW92ZUNsYXNzKFwic2VsZWN0ZWRcIikucmVtb3ZlQ2xhc3Moby5jbHNTZWxlY3RlZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLmFycmF5RGVsZXRlKHRoYXQuc2VsZWN0ZWQsIGRheSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJ3ZWVrLW51bWJlci1jbGlja1wiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogdGhhdC5zZWxlY3RlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bTogd24sXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1FbGVtZW50OiAkZWxbMF1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuZGF5XCIsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIHZhciBkYXkgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIHZhciBpbmRleCwgZGF0ZTtcblxuICAgICAgICAgICAgICAgIGRhdGUgPSBkYXkuZGF0YSgnZGF5Jyk7XG4gICAgICAgICAgICAgICAgaW5kZXggPSB0aGF0LnNlbGVjdGVkLmluZGV4T2YoZGF0ZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZGF5Lmhhc0NsYXNzKFwib3V0c2lkZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRlID0gZGF0ZXRpbWUoZGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHllYXI6IGRhdGUueWVhcigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbW9udGg6IGRhdGUubW9udGgoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRheTogZGF0ZS5kYXkoKVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9kcmF3Q29udGVudCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcIm1vbnRoLWNoYW5nZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50OiB0aGF0LmN1cnJlbnRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIWRheS5oYXNDbGFzcyhcImRpc2FibGVkXCIpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG8ucGlja2VyTW9kZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5zZWxlY3RlZCA9IFtkYXRlXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQudG9kYXkgPSBkYXRldGltZShkYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudC55ZWFyID0gdGhhdC50b2RheS55ZWFyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnQubW9udGggPSB0aGF0LnRvZGF5Lm1vbnRoKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnQuZGF5ID0gdGhhdC50b2RheS5kYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2RyYXdIZWFkZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2RyYXdDb250ZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG8ubXVsdGlTZWxlY3QgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5kYXlcIikucmVtb3ZlQ2xhc3MoXCJzZWxlY3RlZFwiKS5yZW1vdmVDbGFzcyhvLmNsc1NlbGVjdGVkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5zZWxlY3RlZCA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LnNlbGVjdGVkLnB1c2goZGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF5LmFkZENsYXNzKFwic2VsZWN0ZWRcIikuYWRkQ2xhc3Moby5jbHNTZWxlY3RlZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheS5yZW1vdmVDbGFzcyhcInNlbGVjdGVkXCIpLnJlbW92ZUNsYXNzKG8uY2xzU2VsZWN0ZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLmFycmF5RGVsZXRlKHRoYXQuc2VsZWN0ZWQsIGRhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJkYXktY2xpY2tcIiwge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogdGhhdC5zZWxlY3RlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF5OiBkYXlbMF0sXG4gICAgICAgICAgICAgICAgICAgIHRpbWU6IHRoYXQudGltZVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmN1cnItbW9udGhcIiwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgdGhhdC5jb250ZW50ID0gXCJtb250aHNcIjtcbiAgICAgICAgICAgICAgICB0aGF0Ll9kcmF3Q29udGVudCgpO1xuXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLm1vbnRoXCIsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudC5tb250aCA9IHBhcnNlSW50KCQodGhpcykuYXR0cihcImRhdGEtbW9udGhcIikpO1xuICAgICAgICAgICAgICAgIHRoYXQuY29udGVudCA9IFwiZGF5c1wiO1xuICAgICAgICAgICAgICAgIHRoYXQuX2RyYXdDb250ZW50KCk7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJtb250aC1jaGFuZ2VcIiwge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50OiB0aGF0LmN1cnJlbnRcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5jdXJyLXllYXJcIiwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgaWYgKHRoYXQuY29udGVudCA9PT0gXCJ5ZWFyc1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoYXQuY29udGVudCA9IFwieWVhcnNcIjtcbiAgICAgICAgICAgICAgICB0aGF0Ll9kcmF3Q29udGVudCgpO1xuXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLnllYXJcIiwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgdGhhdC5jdXJyZW50LnllYXIgPSBwYXJzZUludCgkKHRoaXMpLmF0dHIoXCJkYXRhLXllYXJcIikpO1xuICAgICAgICAgICAgICAgIHRoYXQueWVhckdyb3VwU3RhcnQgPSB0aGF0LmN1cnJlbnQueWVhcjtcbiAgICAgICAgICAgICAgICB0aGF0LmNvbnRlbnQgPSBcIm1vbnRoc1wiO1xuICAgICAgICAgICAgICAgIHRoYXQuX2RyYXdDb250ZW50KCk7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJ5ZWFyLWNoYW5nZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnQ6IHRoYXQuY3VycmVudFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfZHJhd0hlYWRlcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGhlYWRlciA9IGVsZW1lbnQuZmluZChcIi5jYWxlbmRhci1oZWFkZXJcIik7XG5cbiAgICAgICAgICAgIGlmIChoZWFkZXIubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgaGVhZGVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY2FsZW5kYXItaGVhZGVyXCIpLmFkZENsYXNzKG8uY2xzQ2FsZW5kYXJIZWFkZXIpLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBoZWFkZXIuaHRtbChcIlwiKTtcblxuICAgICAgICAgICAgJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiaGVhZGVyLXllYXJcIikuaHRtbCh0aGlzLnRvZGF5LnllYXIoKSkuYXBwZW5kVG8oaGVhZGVyKTtcbiAgICAgICAgICAgICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImhlYWRlci1kYXlcIikuaHRtbCh0aGlzLnRvZGF5LmZvcm1hdChvLmhlYWRlckZvcm1hdCwgby5sb2NhbGUpKS5hcHBlbmRUbyhoZWFkZXIpO1xuXG4gICAgICAgICAgICBpZiAoby5zaG93SGVhZGVyID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIGhlYWRlci5oaWRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2RyYXdGb290ZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBidXR0b25zX2xvY2FsZSA9IHRoaXMubG9jYWxlWydidXR0b25zJ107XG4gICAgICAgICAgICB2YXIgZm9vdGVyID0gZWxlbWVudC5maW5kKFwiLmNhbGVuZGFyLWZvb3RlclwiKTtcblxuICAgICAgICAgICAgaWYgKG8uYnV0dG9ucyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZm9vdGVyLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGZvb3RlciA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImNhbGVuZGFyLWZvb3RlclwiKS5hZGRDbGFzcyhvLmNsc0NhbGVuZGFyRm9vdGVyKS5hcHBlbmRUbyhlbGVtZW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZm9vdGVyLmh0bWwoXCJcIik7XG5cbiAgICAgICAgICAgICQuZWFjaChvLmJ1dHRvbnMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGJ1dHRvbiA9ICQoXCI8YnV0dG9uPlwiKS5hdHRyKFwidHlwZVwiLCBcImJ1dHRvblwiKS5hZGRDbGFzcyhcImJ1dHRvbiBcIiArIHRoaXMgKyBcIiBcIiArIG9bJ2NscycrQ2FrZS5jYXBpdGFsaXplKHRoaXMpKydCdXR0b24nXSkuaHRtbChidXR0b25zX2xvY2FsZVt0aGlzXSkuYXBwZW5kVG8oZm9vdGVyKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcyA9PT0gJ2NhbmNlbCcgfHwgdGhpcyA9PT0gJ2RvbmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5hZGRDbGFzcyhcImpzLWRpYWxvZy1jbG9zZVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKG8uc2hvd0Zvb3RlciA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBmb290ZXIuaGlkZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9kcmF3VGltZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjYWxlbmRhckNvbnRlbnQgPSBlbGVtZW50LmZpbmQoXCIuY2FsZW5kYXItY29udGVudFwiKTtcbiAgICAgICAgICAgIHZhciB0aW1lID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY2FsZW5kYXItdGltZVwiKS5hZGRDbGFzcyhvLmNsc0NhbGVuZGFyVGltZSkuYXBwZW5kVG8oY2FsZW5kYXJDb250ZW50KTtcbiAgICAgICAgICAgIHZhciBpbm5lciwgaG91cnMsIG1pbnV0ZXMsIHJvdztcbiAgICAgICAgICAgIHZhciBoID0gXCJcIit0aGlzLnRpbWVbMF07XG4gICAgICAgICAgICB2YXIgbSA9IFwiXCIrdGhpcy50aW1lWzFdO1xuICAgICAgICAgICAgdmFyIGxvY2FsZSA9IHRoaXMubG9jYWxlWydjYWxlbmRhciddWyd0aW1lJ107XG5cbiAgICAgICAgICAgIHZhciBvbkNoYW5nZSA9IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gcGFyc2VJbnQodmFsKTtcbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5hdHRyKFwiZGF0YS10aW1lLXBhcnRcIikgPT09IFwiaG91cnNcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnRpbWVbMF0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiaG91cnMtY2hhbmdlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IHRoYXQudGltZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhvdXJzOiB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnRpbWVbMV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwibWludXRlcy1jaGFuZ2VcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogdGhhdC50aW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWludXRlczogdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwidGltZS1jaGFuZ2VcIiwge1xuICAgICAgICAgICAgICAgICAgICB0aW1lOiB0aGF0LnRpbWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGltZS5hcHBlbmQoIGlubmVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY2FsZW5kYXItdGltZV9faW5uZXJcIikgKTtcblxuICAgICAgICAgICAgaW5uZXIuYXBwZW5kKCByb3cgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJjYWxlbmRhci10aW1lX19pbm5lci1yb3dcIikgKTtcbiAgICAgICAgICAgIHJvdy5hcHBlbmQoICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImNhbGVuZGFyLXRpbWVfX2lubmVyLWNlbGxcIikuYXBwZW5kKCAkKFwiPHNwYW4+XCIpLmh0bWwoby5sYWJlbFRpbWVIb3VycyB8fCBsb2NhbGVbJ2hvdXJzJ10pICkpO1xuICAgICAgICAgICAgcm93LmFwcGVuZCggJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY2FsZW5kYXItdGltZV9faW5uZXItY2VsbFwiKS5hcHBlbmQoICQoXCI8c3Bhbj5cIikuaHRtbChvLmxhYmVsVGltZU1pbnV0ZXMgfHwgbG9jYWxlWydtaW51dGVzJ10pICkpO1xuXG4gICAgICAgICAgICB0aW1lLmFwcGVuZCggaW5uZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJjYWxlbmRhci10aW1lX19pbm5lciBzcGlubmVyc1wiKS5hZGRDbGFzcyhvLmNsc1RpbWUpICk7XG4gICAgICAgICAgICBpbm5lci5hcHBlbmQoIGhvdXJzID0gJChcIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLWNscy1zcGlubmVyLWlucHV0PSdcIitvLmNsc1RpbWVIb3VycytcIicgZGF0YS10aW1lLXBhcnQ9J2hvdXJzJyBkYXRhLWJ1dHRvbnMtcG9zaXRpb249J3JpZ2h0JyBkYXRhLW1pbi12YWx1ZT0nMCcgZGF0YS1tYXgtdmFsdWU9JzIzJz5cIikuYWRkQ2xhc3MoXCJob3Vyc1wiKS5hZGRDbGFzcyhvLmNvbXBhY3QgPyBcImlucHV0LXNtYWxsXCIgOiBcImlucHV0LW5vcm1hbFwiKSApO1xuICAgICAgICAgICAgaW5uZXIuYXBwZW5kKCBtaW51dGVzID0gJChcIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLWNscy1zcGlubmVyLWlucHV0PSdcIitvLmNsc1RpbWVNaW51dGVzK1wiJyBkYXRhLXRpbWUtcGFydD0nbWludXRlcycgZGF0YS1idXR0b25zLXBvc2l0aW9uPSdyaWdodCcgZGF0YS1taW4tdmFsdWU9JzAnIGRhdGEtbWF4LXZhbHVlPSc1OSc+XCIpLmFkZENsYXNzKFwibWludXRlc1wiKS5hZGRDbGFzcyhvLmNvbXBhY3QgPyBcImlucHV0LXNtYWxsXCIgOiBcImlucHV0LW5vcm1hbFwiKSApO1xuXG4gICAgICAgICAgICBoID0gQ2FrZS5scGFkKGgsIDIsIFwiMFwiKTtcbiAgICAgICAgICAgIG0gPSBDYWtlLmxwYWQobSwgMiwgXCIwXCIpO1xuXG4gICAgICAgICAgICBob3Vycy52YWwoaCk7XG4gICAgICAgICAgICBtaW51dGVzLnZhbChtKTtcblxuICAgICAgICAgICAgTWV0cm8ubWFrZVBsdWdpbihpbm5lci5maW5kKFwiaW5wdXRbdHlwZT10ZXh0XVwiKSwgXCJzcGlubmVyXCIsIHtcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogb25DaGFuZ2UsXG4gICAgICAgICAgICAgICAgY2xzU3Bpbm5lckJ1dHRvbjogby5jbHNUaW1lQnV0dG9uLFxuICAgICAgICAgICAgICAgIGNsc1NwaW5uZXJCdXR0b25QbHVzOiBvLmNsc1RpbWVCdXR0b25QbHVzLFxuICAgICAgICAgICAgICAgIGNsc1NwaW5uZXJCdXR0b25NaW51czogby5jbHNUaW1lQnV0dG9uTWludXNcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoby5zaG93VGltZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB0aW1lLmhpZGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfZHJhd0NvbnRlbnREYXlzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBlbGVtZW50LmZpbmQoXCIuY2FsZW5kYXItY29udGVudFwiKSwgdG9vbGJhciwgd2Vla0RheXMsIGNhbGVuZGFyRGF5cztcbiAgICAgICAgICAgIHZhciBjYWxlbmRhciA9IGRhdGV0aW1lKHRoaXMuY3VycmVudC55ZWFyLCB0aGlzLmN1cnJlbnQubW9udGgsIHRoaXMuY3VycmVudC5kYXkpLnVzZUxvY2FsZShvLmxvY2FsZSkuY2FsZW5kYXIoby53ZWVrU3RhcnQpO1xuICAgICAgICAgICAgdmFyIGxvY2FsZSA9IERhdGV0aW1lLmdldExvY2FsZShvLmxvY2FsZSk7XG4gICAgICAgICAgICB2YXIgc2hvd0RheSA9IHRoaXMuc2hvdy5mb3JtYXQoXCJZWVlZLU1NLUREXCIpO1xuICAgICAgICAgICAgdmFyIG5vdyA9IGRhdGV0aW1lKCk7XG5cbiAgICAgICAgICAgIGlmIChjb250ZW50Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJjYWxlbmRhci1jb250ZW50XCIpLmFkZENsYXNzKG8uY2xzQ2FsZW5kYXJDb250ZW50KS5hcHBlbmRUbyhlbGVtZW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uc2hvd1dlZWtOdW1iZXIpIHtcbiAgICAgICAgICAgICAgICBjb250ZW50LmFkZENsYXNzKFwiLXdlZWstbnVtYmVyc1wiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29udGVudC5lbXB0eSgpO1xuXG4gICAgICAgICAgICB0b29sYmFyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY2FsZW5kYXItdG9vbGJhclwiKS5hcHBlbmRUbyhjb250ZW50KTtcblxuICAgICAgICAgICAgJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcInByZXYtbW9udGhcIikuaHRtbChvLnByZXZNb250aEljb24pLmFwcGVuZFRvKHRvb2xiYXIpO1xuICAgICAgICAgICAgJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcImN1cnItbW9udGhcIikuaHRtbChsb2NhbGVbJ21vbnRocyddW3RoaXMuY3VycmVudC5tb250aF0pLmFwcGVuZFRvKHRvb2xiYXIpO1xuICAgICAgICAgICAgJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcIm5leHQtbW9udGhcIikuaHRtbChvLm5leHRNb250aEljb24pLmFwcGVuZFRvKHRvb2xiYXIpO1xuXG4gICAgICAgICAgICAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwicHJldi15ZWFyXCIpLmh0bWwoby5wcmV2WWVhckljb24pLmFwcGVuZFRvKHRvb2xiYXIpO1xuICAgICAgICAgICAgJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcImN1cnIteWVhclwiKS5odG1sKHRoaXMuY3VycmVudC55ZWFyKS5hcHBlbmRUbyh0b29sYmFyKTtcbiAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJuZXh0LXllYXJcIikuaHRtbChvLm5leHRZZWFySWNvbikuYXBwZW5kVG8odG9vbGJhcik7XG5cbiAgICAgICAgICAgIHdlZWtEYXlzID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwid2Vlay1kYXlzXCIpLmFwcGVuZFRvKGNvbnRlbnQpO1xuICAgICAgICAgICAgaWYgKG8uc2hvd1dlZWtOdW1iZXIpIHtcbiAgICAgICAgICAgICAgICAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwid2Vlay1udW1iZXJcIikuaHRtbChcIiNcIikuYXBwZW5kVG8od2Vla0RheXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5lYWNoKGNhbGVuZGFyWyd3ZWVrZGF5cyddLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJ3ZWVrLWRheVwiKS5odG1sKHRoaXMpLmFwcGVuZFRvKHdlZWtEYXlzKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjYWxlbmRhckRheXMgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJkYXlzXCIpLmFwcGVuZFRvKGNvbnRlbnQpO1xuXG4gICAgICAgICAgICAkLmVhY2goY2FsZW5kYXJbJ2RheXMnXSwgZnVuY3Rpb24oaSl7XG4gICAgICAgICAgICAgICAgdmFyIGRheSA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBkYXRldGltZShkYXkpLmFsaWduKCdkYXknKTtcbiAgICAgICAgICAgICAgICB2YXIgb3V0c2lkZURhdGUgPSBkYXRlLm1vbnRoKCkgIT09IHRoYXQuY3VycmVudC5tb250aDtcblxuICAgICAgICAgICAgICAgIGlmIChvLnNob3dXZWVrTnVtYmVyICYmIGkgJSA3ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJ3ZWVrLW51bWJlclwiKS5odG1sKGRhdGUud2Vla051bWJlcihvLndlZWtTdGFydCkpLmFwcGVuZFRvKGNhbGVuZGFyRGF5cyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGNlbGwgPSAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwiZGF5XCIpLmh0bWwoZGF0ZS5kYXkoKSkuYXBwZW5kVG8oY2FsZW5kYXJEYXlzKTtcblxuICAgICAgICAgICAgICAgIGNlbGwuZGF0YSgnZGF5JywgZGF5KTtcblxuICAgICAgICAgICAgICAgIGlmIChkYXkgPT09IHNob3dEYXkpIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5hZGRDbGFzcyhcInNob3dlZFwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAob3V0c2lkZURhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5hZGRDbGFzcyhcIm91dHNpZGVcIik7XG4gICAgICAgICAgICAgICAgICAgIGlmICghby5vdXRzaWRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoZGF5ID09PSBjYWxlbmRhclsndG9kYXknXSkge1xuICAgICAgICAgICAgICAgICAgICBjZWxsLmFkZENsYXNzKFwidG9kYXlcIilcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoby5zaG93R2hvc3QgJiYgZGF0ZS5kYXkoKSA9PT0gbm93LmRheSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNlbGwuYWRkQ2xhc3MoXCJjb2luY2lkZW50YWxcIik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHRoYXQuc3BlY2lhbC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQuc3BlY2lhbC5pbmRleE9mKGRheSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLmFkZENsYXNzKFwiZGlzYWJsZWQgZXhjbHVkZWRcIikuYWRkQ2xhc3Moby5jbHNFeGNsdWRlZCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLmFkZENsYXNzKG8uY2xzU3BlY2lhbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5zZWxlY3RlZC5pbmRleE9mKGRheSkgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5hZGRDbGFzcyhcInNlbGVjdGVkXCIpLmFkZENsYXNzKG8uY2xzU2VsZWN0ZWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LmV4Y2x1ZGUuaW5kZXhPZihkYXkpID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuYWRkQ2xhc3MoXCJkaXNhYmxlZCBleGNsdWRlZFwiKS5hZGRDbGFzcyhvLmNsc0V4Y2x1ZGVkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5taW4gJiYgZGF0ZS5vbGRlcih0aGF0Lm1pbikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuYWRkQ2xhc3MoXCJkaXNhYmxlZCBleGNsdWRlZFwiKS5hZGRDbGFzcyhvLmNsc0V4Y2x1ZGVkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5tYXggJiYgZGF0ZS55b3VuZ2VyKHRoYXQubWF4KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5hZGRDbGFzcyhcImRpc2FibGVkIGV4Y2x1ZGVkXCIpLmFkZENsYXNzKG8uY2xzRXhjbHVkZWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGNhbGVuZGFyWyd3ZWVrZW5kcyddLmluZGV4T2YoZGF5KSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5hZGRDbGFzcyhvLmNsc1dlZWtlbmQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChjYWxlbmRhclsnd2VlayddLmluZGV4T2YoZGF5KSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5hZGRDbGFzcyhvLmNsc0N1cnJlbnRXZWVrKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodGhhdC5ldmVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBldmVudHMgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJldmVudHNcIikuYWRkQ2xhc3Moby5jbHNFdmVudHMpLmFwcGVuZFRvKGNlbGwpO1xuICAgICAgICAgICAgICAgICAgICAkLmVhY2godGhhdC5ldmVudHMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcyA9PT0gZGF5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50ID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiZXZlbnRcIikuYWRkQ2xhc3Moby5jbHNFdmVudCkuYXBwZW5kVG8oZXZlbnRzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW8uY2xzRXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogTWV0cm8uY29sb3JzLnJhbmRvbSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChvLmFuaW1hdGlvbkNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5hZGRDbGFzcyhcInRvLWFuaW1hdGVcIik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZHJhdy1kYXlcIiwge1xuICAgICAgICAgICAgICAgICAgICBkYXRlOiBkYXRlLnZhbCgpLFxuICAgICAgICAgICAgICAgICAgICBkYXk6IGRhdGUuZGF5KCksXG4gICAgICAgICAgICAgICAgICAgIG1vbnRoOiBkYXRlLm1vbnRoKCksXG4gICAgICAgICAgICAgICAgICAgIHllYXI6IGRhdGUueWVhcigpLFxuICAgICAgICAgICAgICAgICAgICBjZWxsOiBjZWxsWzBdXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5fZHJhd1RpbWUoKTtcbiAgICAgICAgICAgIHRoaXMuX2FuaW1hdGVDb250ZW50KFwiLmRheVwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfZHJhd0NvbnRlbnRNb250aHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjb250ZW50ID0gZWxlbWVudC5maW5kKFwiLmNhbGVuZGFyLWNvbnRlbnRcIik7XG4gICAgICAgICAgICB2YXIgbG9jYWxlID0gdGhpcy5sb2NhbGVbJ2NhbGVuZGFyJ11bJ21vbnRocyddO1xuICAgICAgICAgICAgdmFyIHRvb2xiYXIsIG1vbnRocywgbW9udGgsIHllYXJUb2RheSA9IGRhdGV0aW1lKCkueWVhcigpLCBtb250aFRvZGF5ID0gZGF0ZXRpbWUoKS5tb250aCgpO1xuXG4gICAgICAgICAgICBpZiAoY29udGVudC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBjb250ZW50ID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY2FsZW5kYXItY29udGVudFwiKS5hZGRDbGFzcyhvLmNsc0NhbGVuZGFyQ29udGVudCkuYXBwZW5kVG8oZWxlbWVudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnRlbnQuY2xlYXIoKTtcblxuICAgICAgICAgICAgdG9vbGJhciA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImNhbGVuZGFyLXRvb2xiYXJcIikuYXBwZW5kVG8oY29udGVudCk7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQ2FsZW5kYXIgdG9vbGJhclxuICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJwcmV2LXllYXJcIikuaHRtbChvLnByZXZZZWFySWNvbikuYXBwZW5kVG8odG9vbGJhcik7XG4gICAgICAgICAgICAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwiY3Vyci15ZWFyXCIpLmh0bWwodGhpcy5jdXJyZW50LnllYXIpLmFwcGVuZFRvKHRvb2xiYXIpO1xuICAgICAgICAgICAgJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcIm5leHQteWVhclwiKS5odG1sKG8ubmV4dFllYXJJY29uKS5hcHBlbmRUbyh0b29sYmFyKTtcblxuICAgICAgICAgICAgY29udGVudC5hcHBlbmQoIG1vbnRocyA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcIm1vbnRoc1wiKSApO1xuXG4gICAgICAgICAgICBmb3IodmFyIGkgPSAxMjsgaSA8IDI0OyBpKyspIHtcbiAgICAgICAgICAgICAgICBtb250aHMuYXBwZW5kKFxuICAgICAgICAgICAgICAgICAgICBtb250aCA9ICQoXCI8ZGl2PlwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkYXRhLW1vbnRoXCIsIGkgLSAxMilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcIm1vbnRoXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoaSAtIDEyID09PSBtb250aFRvZGF5ICYmIHRoaXMuY3VycmVudC55ZWFyID09PSB5ZWFyVG9kYXkgPyBcInRvZGF5XCIgOiBcIlwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmh0bWwobG9jYWxlW2ldKVxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICBpZiAoby5hbmltYXRpb25Db250ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIG1vbnRoLmFkZENsYXNzKFwidG8tYW5pbWF0ZVwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJkcmF3LW1vbnRoXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgbW9udGg6IGkgLSAxMixcbiAgICAgICAgICAgICAgICAgICAgeWVhcjogdGhpcy5jdXJyZW50LnllYXIsXG4gICAgICAgICAgICAgICAgICAgIGNlbGw6IG1vbnRoWzBdXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2FuaW1hdGVDb250ZW50KFwiLm1vbnRocyAubW9udGhcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2RyYXdDb250ZW50WWVhcnM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjb250ZW50ID0gZWxlbWVudC5maW5kKFwiLmNhbGVuZGFyLWNvbnRlbnRcIik7XG4gICAgICAgICAgICB2YXIgdG9vbGJhciwgeWVhcnMsIHllYXI7XG5cbiAgICAgICAgICAgIGlmIChjb250ZW50Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJjYWxlbmRhci1jb250ZW50XCIpLmFkZENsYXNzKG8uY2xzQ2FsZW5kYXJDb250ZW50KS5hcHBlbmRUbyhlbGVtZW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29udGVudC5jbGVhcigpO1xuXG4gICAgICAgICAgICB0b29sYmFyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY2FsZW5kYXItdG9vbGJhclwiKS5hcHBlbmRUbyhjb250ZW50KTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBDYWxlbmRhciB0b29sYmFyXG4gICAgICAgICAgICAgKi9cblxuICAgICAgICAgICAgJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcInByZXYteWVhci1ncm91cFwiKS5odG1sKG8ucHJldlllYXJJY29uKS5hcHBlbmRUbyh0b29sYmFyKTtcbiAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJjdXJyLXllYXJcIikuaHRtbCh0aGlzLnllYXJHcm91cFN0YXJ0ICsgXCIgLSBcIiArICh0aGlzLnllYXJHcm91cFN0YXJ0ICsgdGhpcy55ZWFyRGlzdGFuY2UpKS5hcHBlbmRUbyh0b29sYmFyKTtcbiAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJuZXh0LXllYXItZ3JvdXBcIikuaHRtbChvLm5leHRZZWFySWNvbikuYXBwZW5kVG8odG9vbGJhcik7XG5cbiAgICAgICAgICAgIGNvbnRlbnQuYXBwZW5kKCB5ZWFycyA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInllYXJzXCIpICk7XG5cbiAgICAgICAgICAgIGZvcih2YXIgaSA9IHRoaXMueWVhckdyb3VwU3RhcnQ7IGkgPD0gdGhpcy55ZWFyR3JvdXBTdGFydCArIHRoaXMueWVhckRpc3RhbmNlOyBpKyspIHtcbiAgICAgICAgICAgICAgICB5ZWFycy5hcHBlbmQoXG4gICAgICAgICAgICAgICAgICAgIHllYXIgPSAkKFwiPGRpdj5cIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZGF0YS15ZWFyXCIsIGkpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJ5ZWFyXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoaSA9PT0gdGhpcy5jdXJyZW50LnllYXIgPyBcInRvZGF5XCIgOiBcIlwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmh0bWwoaSlcbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgaWYgKG8uYW5pbWF0aW9uQ29udGVudCkge1xuICAgICAgICAgICAgICAgICAgICB5ZWFyLmFkZENsYXNzKFwidG8tYW5pbWF0ZVwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaSA8IG8ubWluWWVhciB8fCBpID4gby5tYXhZZWFyKSB7XG4gICAgICAgICAgICAgICAgICAgIHllYXIuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJkcmF3LXllYXJcIiwge1xuICAgICAgICAgICAgICAgICAgICB5ZWFyOiBpLFxuICAgICAgICAgICAgICAgICAgICBjZWxsOiB5ZWFyWzBdXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2FuaW1hdGVDb250ZW50KFwiLnllYXJzIC55ZWFyXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9kcmF3Q29udGVudDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5jb250ZW50KSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcInllYXJzXCI6IHRoaXMuX2RyYXdDb250ZW50WWVhcnMoKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcIm1vbnRoc1wiOiB0aGlzLl9kcmF3Q29udGVudE1vbnRocygpOyBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiB0aGlzLl9kcmF3Q29udGVudERheXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfZHJhd0NhbGVuZGFyOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuZWxlbWVudC5odG1sKFwiXCIpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2RyYXdIZWFkZXIoKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9kcmF3Q29udGVudCgpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2RyYXdGb290ZXIoKTtcbiAgICAgICAgICAgIH0sIDApO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9hbmltYXRlQ29udGVudDogZnVuY3Rpb24odGFyZ2V0LCBjbHMpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY29udGVudCA9IGVsZW1lbnQuZmluZChcIi5jYWxlbmRhci1jb250ZW50XCIpO1xuXG4gICAgICAgICAgICBjbHMgPSBjbHMgfHwgXCJ0by1hbmltYXRlXCI7XG5cbiAgICAgICAgICAgIGNvbnRlbnQuZmluZCh0YXJnZXQpLmVhY2goZnVuY3Rpb24oayl7XG4gICAgICAgICAgICAgICAgdmFyIGRheSA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBkYXkucmVtb3ZlQ2xhc3MoY2xzKTtcbiAgICAgICAgICAgICAgICB9LCBvLmFuaW1hdGlvblNwZWVkICogayk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRUaW1lOiBmdW5jdGlvbihhc1N0cmluZyl7XG4gICAgICAgICAgICB2YXIgaCwgbTtcblxuICAgICAgICAgICAgYXNTdHJpbmcgPSBhc1N0cmluZyB8fCBmYWxzZTtcblxuICAgICAgICAgICAgaCA9IENha2UubHBhZCh0aGlzLnRpbWVbMF0sIDIsIFwiMFwiKTtcbiAgICAgICAgICAgIG0gPSBDYWtlLmxwYWQodGhpcy50aW1lWzFdLCAyLCBcIjBcIik7XG5cbiAgICAgICAgICAgIHJldHVybiBhc1N0cmluZyA/IGggK1wiOlwiKyBtIDogdGhpcy50aW1lO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldFRpbWU6IGZ1bmN0aW9uKHRpbWUpe1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGltZSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWUgPSB0aW1lO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWUgPSB0aW1lLnNwbGl0KFwiOlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2RyYXdDYWxlbmRhcigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldFByZXNldDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnByZXNldDtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRTZWxlY3RlZDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldEV4Y2x1ZGVkOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhjbHVkZTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRUb2RheTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRvZGF5O1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldEN1cnJlbnQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50O1xuICAgICAgICB9LFxuXG4gICAgICAgIGNsZWFyU2VsZWN0ZWQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gW107XG4gICAgICAgICAgICB0aGlzLl9kcmF3Q29udGVudCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvRGF5OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy50b2RheSA9IGRhdGV0aW1lKCkuYWxpZ24oXCJkYXlcIik7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnQgPSB7XG4gICAgICAgICAgICAgICAgeWVhcjogdGhpcy50b2RheS55ZWFyKCksXG4gICAgICAgICAgICAgICAgbW9udGg6IHRoaXMudG9kYXkubW9udGgoKSxcbiAgICAgICAgICAgICAgICBkYXk6IHRoaXMudG9kYXkuZGF5KClcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLnRpbWUgPSBbZGF0ZXRpbWUoKS5ob3VyKCksIGRhdGV0aW1lKCkubWludXRlKCldO1xuICAgICAgICAgICAgdGhpcy55ZWFyR3JvdXBTdGFydCA9IGRhdGV0aW1lKCkueWVhcigpO1xuICAgICAgICAgICAgdGhpcy5jb250ZW50ID0gXCJkYXlzXCI7XG4gICAgICAgICAgICB0aGlzLl9kcmF3SGVhZGVyKCk7XG4gICAgICAgICAgICB0aGlzLl9kcmF3Q29udGVudCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldEV4Y2x1ZGU6IGZ1bmN0aW9uKGV4Y2x1ZGUpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNOdWxsKGV4Y2x1ZGUpICYmIFV0aWxzLmlzTnVsbChlbGVtZW50LmF0dHIoXCJkYXRhLWV4Y2x1ZGVcIikpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG8uZXhjbHVkZSA9ICFVdGlscy5pc051bGwoZXhjbHVkZSkgPyBleGNsdWRlIDogZWxlbWVudC5hdHRyKFwiZGF0YS1leGNsdWRlXCIpO1xuICAgICAgICAgICAgdGhpcy5fZGF0ZXMyYXJyYXkoby5leGNsdWRlLCAnZXhjbHVkZScpO1xuICAgICAgICAgICAgdGhpcy5fZHJhd0NvbnRlbnQoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRQcmVzZXQ6IGZ1bmN0aW9uKHByZXNldCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIGlmIChVdGlscy5pc051bGwocHJlc2V0KSAmJiBVdGlscy5pc051bGwoZWxlbWVudC5hdHRyKFwiZGF0YS1wcmVzZXRcIikpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgby5wcmVzZXQgPSAhVXRpbHMuaXNOdWxsKHByZXNldCkgPyBwcmVzZXQgOiBlbGVtZW50LmF0dHIoXCJkYXRhLXByZXNldFwiKTtcblxuICAgICAgICAgICAgdGhpcy5fZGF0ZXMyYXJyYXkoby5wcmVzZXQsICdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgdGhpcy5fZHJhd0NvbnRlbnQoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRTcGVjaWFsOiBmdW5jdGlvbihzcGVjaWFsKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgaWYgKFV0aWxzLmlzTnVsbChzcGVjaWFsKSAmJiBVdGlscy5pc051bGwoZWxlbWVudC5hdHRyKFwiZGF0YS1zcGVjaWFsXCIpKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvLnNwZWNpYWwgPSAhVXRpbHMuaXNOdWxsKHNwZWNpYWwpID8gc3BlY2lhbCA6IGVsZW1lbnQuYXR0cihcImRhdGEtc3BlY2lhbFwiKTtcbiAgICAgICAgICAgIHRoaXMuX2RhdGVzMmFycmF5KG8uZXhjbHVkZSwgJ3NwZWNpYWwnKTtcbiAgICAgICAgICAgIHRoaXMuX2RyYXdDb250ZW50KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2hvd0RhdGU6IGZ1bmN0aW9uKGRhdGUpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2V0U2hvdyhkYXRlKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRTaG93OiBmdW5jdGlvbihzaG93KXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGF0dHIgPSBlbGVtZW50LmF0dHIoXCJkYXRhLXNob3dcIik7XG5cbiAgICAgICAgICAgIGlmICghc2hvdyAmJiAhYXR0cikge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG8uc2hvdyA9IHNob3cgPyBzaG93IDogYXR0cjtcblxuICAgICAgICAgICAgaWYgKCFvLnNob3cpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3cgPSBkYXRldGltZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG8uc2hvdyA9PT0gXCJzdHJpbmdcIiAmJiBvLmlucHV0Rm9ybWF0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvdyA9IERhdGV0aW1lLmZyb20oby5zaG93LCBvLmlucHV0Rm9ybWF0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3cgPSBkYXRldGltZShvLnNob3cpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5zaG93ID0gdGhpcy5zaG93LmFsaWduKFwiZGF5XCIpO1xuXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnQgPSB7XG4gICAgICAgICAgICAgICAgeWVhcjogdGhpcy5zaG93LnllYXIoKSxcbiAgICAgICAgICAgICAgICBtb250aDogdGhpcy5zaG93Lm1vbnRoKCksXG4gICAgICAgICAgICAgICAgZGF5OiB0aGlzLnNob3cuZGF5KClcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fZHJhd0NvbnRlbnQoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRNaW5EYXRlOiBmdW5jdGlvbihkYXRlKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGF0dHIgPSBlbGVtZW50LmF0dHIoXCJkYXRhLW1pbi1kYXRlXCIpO1xuXG4gICAgICAgICAgICBpZiAoIWRhdGUgJiYgIWF0dHIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBvLm1pbkRhdGUgPSBkYXRlID8gZGF0ZSA6IGF0dHI7XG5cbiAgICAgICAgICAgIHRoaXMubWluID0gby5taW5EYXRlID8gKG8uaW5wdXRGb3JtYXQgPyBEYXRldGltZS5mcm9tKG8ubWluRGF0ZSwgby5pbnB1dEZvcm1hdCkgOiBkYXRldGltZShvLm1pbkRhdGUpKS5hbGlnbihcImRheVwiKSA6IG51bGw7XG5cbiAgICAgICAgICAgIHRoaXMuX2RyYXdDb250ZW50KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0TWF4RGF0ZTogZnVuY3Rpb24oZGF0ZSl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBhdHRyID0gZWxlbWVudC5hdHRyKFwiZGF0YS1tYXgtZGF0ZVwiKTtcblxuICAgICAgICAgICAgby5tYXhEYXRlID0gZGF0ZSA/IGRhdGUgOiBhdHRyO1xuXG4gICAgICAgICAgICB0aGlzLm1heCA9IG8ubWF4RGF0ZSA/IChvLmlucHV0Rm9ybWF0ID8gRGF0ZXRpbWUuZnJvbShvLm1heERhdGUsIG8uaW5wdXRGb3JtYXQpIDogZGF0ZXRpbWUoby5tYXhEYXRlKSkuYWxpZ24oXCJkYXlcIikgOiBudWxsO1xuXG4gICAgICAgICAgICB0aGlzLl9kcmF3Q29udGVudCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGkxOG46IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIGlmICh2YWwgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvLmxvY2FsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChNZXRyby5sb2NhbGVzW3ZhbF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG8ubG9jYWxlID0gdmFsO1xuICAgICAgICAgICAgdGhpcy5sb2NhbGUgPSBNZXRyby5sb2NhbGVzW28ubG9jYWxlXTtcbiAgICAgICAgICAgIHRoaXMuX2RyYXdDYWxlbmRhcigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJMb2NhbGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHRoaXMuaTE4bihlbGVtZW50LmF0dHIoXCJkYXRhLWxvY2FsZVwiKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgICAgIHN3aXRjaCAoYXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ2RhdGEtZXhjbHVkZSc6IHRoaXMuc2V0RXhjbHVkZSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdkYXRhLXByZXNldCc6IHRoaXMuc2V0UHJlc2V0KCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2RhdGEtc3BlY2lhbCc6IHRoaXMuc2V0U3BlY2lhbCgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdkYXRhLXNob3cnOiB0aGlzLnNldFNob3coKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnZGF0YS1taW4tZGF0ZSc6IHRoaXMuc2V0TWluRGF0ZSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdkYXRhLW1heC1kYXRlJzogdGhpcy5zZXRNYXhEYXRlKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2RhdGEtbG9jYWxlJzogdGhpcy5jaGFuZ2VBdHRyTG9jYWxlKCk7IGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5wcmV2LW1vbnRoLCAubmV4dC1tb250aCwgLnByZXYteWVhciwgLm5leHQteWVhclwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuYnV0dG9uLnRvZGF5XCIpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5idXR0b24uY2xlYXJcIik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmJ1dHRvbi5jYW5jZWxcIik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmJ1dHRvbi5kb25lXCIpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi53ZWVrLWRheXMgLmRheVwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuZGF5cy1yb3cgLmRheVwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuY3Vyci1tb250aFwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuY2FsZW5kYXItbW9udGhzIGxpXCIpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5jdXJyLXllYXJcIik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmNhbGVuZGFyLXllYXJzIGxpXCIpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrKTtcblxuICAgICAgICAgICAgaWYgKG8ucmlwcGxlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5kYXRhKFwicmlwcGxlXCIpLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJCh3aW5kb3cpLm9mZihNZXRyby5ldmVudHMucmVzaXplLCB7bnM6IHRoaXMuaWR9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgICQoZG9jdW1lbnQpLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oKXtcbiAgICAgICAgJCgnLmNhbGVuZGFyIC5jYWxlbmRhci15ZWFycycpLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgJCgnLmNhbGVuZGFyIC5jYWxlbmRhci1tb250aHMnKS5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKFwib3BlblwiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBNZXRyby5kZWZhdWx0cy5DYWxlbmRhciA9IENhbGVuZGFyRGVmYXVsdENvbmZpZztcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBDYWxlbmRhclBpY2tlckRlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGxhYmVsOiBcIlwiLFxuICAgICAgICB2YWx1ZTogJycsXG4gICAgICAgIGNhbGVuZGFycGlja2VyRGVmZXJyZWQ6IDAsXG4gICAgICAgIG51bGxWYWx1ZTogdHJ1ZSxcbiAgICAgICAgdXNlTm93OiBmYWxzZSxcbiAgICAgICAgcHJlcGVuZDogXCJcIixcbiAgICAgICAgZGlhbG9nTW9kZTogZmFsc2UsXG4gICAgICAgIGRpYWxvZ1BvaW50OiA2NDAsXG4gICAgICAgIGRpYWxvZ092ZXJsYXk6IHRydWUsXG4gICAgICAgIG92ZXJsYXlDb2xvcjogJyMwMDAwMDAnLFxuICAgICAgICBvdmVybGF5QWxwaGE6IC41LFxuICAgICAgICBsb2NhbGU6IE1FVFJPX0xPQ0FMRSxcbiAgICAgICAgc2l6ZTogXCIxMDAlXCIsXG4gICAgICAgIGZvcm1hdDogTUVUUk9fREFURV9GT1JNQVQsXG4gICAgICAgIGlucHV0Rm9ybWF0OiBudWxsLFxuICAgICAgICBjbGVhckJ1dHRvbjogZmFsc2UsXG4gICAgICAgIGNhbGVuZGFyQnV0dG9uSWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLWNhbGVuZGFyJz48L3NwYW4+XCIsXG4gICAgICAgIGNsZWFyQnV0dG9uSWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLWNyb3NzJz48L3NwYW4+XCIsXG4gICAgICAgIGNvcHlJbmxpbmVTdHlsZXM6IGZhbHNlLFxuICAgICAgICBjbHNQaWNrZXI6IFwiXCIsXG4gICAgICAgIGNsc0lucHV0OiBcIlwiLFxuICAgICAgICBjbHNQcmVwZW5kOiBcIlwiLFxuICAgICAgICBjbHNMYWJlbDogXCJcIixcbiAgICAgICAgb25EYXlDbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25DYWxlbmRhclBpY2tlckNyZWF0ZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25DYWxlbmRhclNob3c6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQ2FsZW5kYXJIaWRlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNoYW5nZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25QaWNrZXJDaGFuZ2U6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uTW9udGhDaGFuZ2U6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uWWVhckNoYW5nZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5jYWxlbmRhclBpY2tlclNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgQ2FsZW5kYXJQaWNrZXJEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIENhbGVuZGFyUGlja2VyRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9DYWxlbmRhclBpY2tlclNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8uY2FsZW5kYXJQaWNrZXJTZXR1cCh3aW5kb3dbXCJtZXRyb0NhbGVuZGFyUGlja2VyU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnY2FsZW5kYXItcGlja2VyJywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsICQuZXh0ZW5kKHt9LCBNZXRyby5kZWZhdWx0cy5DYWxlbmRhciwge1xuICAgICAgICAgICAgfSwgQ2FsZW5kYXJQaWNrZXJEZWZhdWx0Q29uZmlnKSwge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBudWxsLFxuICAgICAgICAgICAgICAgIHZhbHVlX2RhdGU6IG51bGwsXG4gICAgICAgICAgICAgICAgY2FsZW5kYXI6IG51bGwsXG4gICAgICAgICAgICAgICAgb3ZlcmxheTogbnVsbCxcbiAgICAgICAgICAgICAgICBpZDogVXRpbHMuZWxlbWVudElkKFwiY2FsZW5kYXItcGlja2VyXCIpLFxuICAgICAgICAgICAgICAgIHRpbWU6IFtkYXRldGltZSgpLmhvdXIoKSwgZGF0ZXRpbWUoKS5taW51dGUoKV1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJjYWxlbmRhci1waWNrZXItY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY29udGFpbmVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiaW5wdXQgXCIgKyBlbGVtZW50WzBdLmNsYXNzTmFtZSArIFwiIGNhbGVuZGFyLXBpY2tlclwiKTtcbiAgICAgICAgICAgIHZhciBidXR0b25zID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiYnV0dG9uLWdyb3VwXCIpO1xuICAgICAgICAgICAgdmFyIGNhbGVuZGFyQnV0dG9uLCBjbGVhckJ1dHRvbiwgY2FsID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiZHJvcC1zaGFkb3dcIik7XG4gICAgICAgICAgICB2YXIgY3VyciwgX2N1cnIsIGluaXRUaW1lLCBpbml0SG91cnMsIGluaXRNaW51dGVzLCBlbGVtZW50VmFsdWUsIGgsIG07XG4gICAgICAgICAgICB2YXIgYm9keSA9ICQoXCJib2R5XCIpO1xuXG4gICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJ0eXBlXCIsIFwidGV4dFwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcImF1dG9jb21wbGV0ZVwiLCBcIm9mZlwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcInJlYWRvbmx5XCIsIHRydWUpO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLmluaXRpYWxUaW1lKSkge1xuICAgICAgICAgICAgICAgIHRoaXMudGltZSA9IG8uaW5pdGlhbFRpbWUudHJpbSgpLnNwbGl0KFwiOlwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5pbml0aWFsSG91cnMpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lWzBdID0gcGFyc2VJbnQoby5pbml0aWFsSG91cnMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLmluaXRpYWxIb3VycykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVbMV0gPSBwYXJzZUludChvLmluaXRpYWxNaW51dGVzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY3VyciA9IChcIlwiK28udmFsdWUpLnRyaW0oKSAhPT0gJycgPyBvLnZhbHVlIDogZWxlbWVudC52YWwoKS50cmltKCk7XG5cbiAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZShjdXJyKSkge1xuICAgICAgICAgICAgICAgIGlmIChvLnVzZU5vdykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gZGF0ZXRpbWUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50aW1lID0gW3RoaXMudmFsdWUuaG91cigpLCB0aGlzLnZhbHVlLm1pbnV0ZSgpXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIF9jdXJyID0gY3Vyci5zcGxpdChcIiBcIik7XG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9ICghby5pbnB1dEZvcm1hdCA/IGRhdGV0aW1lKF9jdXJyWzBdKSA6IERhdGV0aW1lLmZyb20oX2N1cnJbMF0sIG8uaW5wdXRGb3JtYXQsIG8ubG9jYWxlKSkuYWxpZ24oXCJkYXlcIik7XG4gICAgICAgICAgICAgICAgaWYgKF9jdXJyWzFdKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGltZSA9IF9jdXJyWzFdLnRyaW0oKS5zcGxpdChcIjpcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50VmFsdWUgPSAhY3VyciAmJiBvLm51bGxWYWx1ZSA9PT0gdHJ1ZSA/IFwiXCIgOiBkYXRldGltZSh0aGF0LnZhbHVlKS5mb3JtYXQoby5mb3JtYXQsIG8ubG9jYWxlKTtcblxuICAgICAgICAgICAgaWYgKG8uc2hvd1RpbWUgJiYgdGhpcy50aW1lICYmIGVsZW1lbnRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIGggPSBDYWtlLmxwYWQodGhpcy50aW1lWzBdLCAyLCBcIjBcIik7XG4gICAgICAgICAgICAgICAgbSA9IENha2UubHBhZCh0aGlzLnRpbWVbMV0sIDIsIFwiMFwiKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50VmFsdWUgKz0gXCIgXCIgKyBoICsgXCI6XCIgKyBtO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LnZhbChlbGVtZW50VmFsdWUpO1xuXG4gICAgICAgICAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKGVsZW1lbnQpO1xuICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRUbyhjb250YWluZXIpO1xuICAgICAgICAgICAgYnV0dG9ucy5hcHBlbmRUbyhjb250YWluZXIpO1xuICAgICAgICAgICAgY2FsLmFwcGVuZFRvKG8uZGlhbG9nTW9kZSA/IGJvZHkgOiBjb250YWluZXIpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy50aW1lICYmIHRoaXMudGltZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBpbml0SG91cnMgPSB0aGlzLnRpbWVbMF07XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnRpbWVbMV0gIT09IFwidW5kZWZpbmVkXCIpXG4gICAgICAgICAgICAgICAgICAgIGluaXRNaW51dGVzID0gdGhpcy50aW1lWzFdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpbml0VGltZSA9IG8uaW5pdGlhbFRpbWU7XG5cbiAgICAgICAgICAgIGlmIChvLmluaXRpYWxIb3Vycykge1xuICAgICAgICAgICAgICAgIGluaXRIb3VycyA9IG8uaW5pdGlhbEhvdXJzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5pbml0aWFsSG91cnMpIHtcbiAgICAgICAgICAgICAgICBpbml0TWludXRlcyA9IG8uaW5pdGlhbE1pbnV0ZXM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIE1ldHJvLm1ha2VQbHVnaW4oY2FsLCBcImNhbGVuZGFyXCIsIHtcbiAgICAgICAgICAgICAgICBzaG93VGltZTogby5zaG93VGltZSxcbiAgICAgICAgICAgICAgICBpbml0aWFsVGltZTogaW5pdFRpbWUsXG4gICAgICAgICAgICAgICAgaW5pdGlhbEhvdXJzOiBpbml0SG91cnMsXG4gICAgICAgICAgICAgICAgaW5pdGlhbE1pbnV0ZXM6IGluaXRNaW51dGVzLFxuICAgICAgICAgICAgICAgIGNsc0NhbGVuZGFyVGltZTogby5jbHNDYWxlbmRhclRpbWUsXG4gICAgICAgICAgICAgICAgY2xzVGltZTogby5jbHNUaW1lLFxuICAgICAgICAgICAgICAgIGNsc1RpbWVIb3Vyczogby5jbHNUaW1lSG91cnMsXG4gICAgICAgICAgICAgICAgY2xzVGltZU1pbnV0ZXM6IG8uY2xzVGltZU1pbnV0ZXMsXG4gICAgICAgICAgICAgICAgY2xzVGltZUJ1dHRvbjogby5jbHNUaW1lQnV0dG9uLFxuICAgICAgICAgICAgICAgIGNsc1RpbWVCdXR0b25QbHVzOiBvLmNsc1RpbWVCdXR0b25QbHVzLFxuICAgICAgICAgICAgICAgIGNsc1RpbWVCdXR0b25NaW51czogby5jbHNUaW1lQnV0dG9uTWludXMsXG5cbiAgICAgICAgICAgICAgICB3aWRlOiBvLndpZGUsXG4gICAgICAgICAgICAgICAgd2lkZVBvaW50OiBvLndpZGVQb2ludCxcblxuICAgICAgICAgICAgICAgIGZvcm1hdDogby5mb3JtYXQsXG4gICAgICAgICAgICAgICAgaW5wdXRGb3JtYXQ6IG8uaW5wdXRGb3JtYXQsXG4gICAgICAgICAgICAgICAgcGlja2VyTW9kZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBzaG93OiBvLnZhbHVlLFxuICAgICAgICAgICAgICAgIGxvY2FsZTogby5sb2NhbGUsXG4gICAgICAgICAgICAgICAgd2Vla1N0YXJ0OiBvLndlZWtTdGFydCxcbiAgICAgICAgICAgICAgICBvdXRzaWRlOiBvLm91dHNpZGUsXG4gICAgICAgICAgICAgICAgYnV0dG9uczogZmFsc2UsXG4gICAgICAgICAgICAgICAgaGVhZGVyRm9ybWF0OiBvLmhlYWRlckZvcm1hdCxcblxuICAgICAgICAgICAgICAgIGNsc0NhbGVuZGFyOiBbby5jbHNDYWxlbmRhciwgXCJjYWxlbmRhci1mb3ItcGlja2VyXCIsIChvLmRpYWxvZ01vZGUgPyBcImRpYWxvZy1tb2RlXCI6XCJcIildLmpvaW4oXCIgXCIpLFxuICAgICAgICAgICAgICAgIGNsc0NhbGVuZGFySGVhZGVyOiBvLmNsc0NhbGVuZGFySGVhZGVyLFxuICAgICAgICAgICAgICAgIGNsc0NhbGVuZGFyQ29udGVudDogby5jbHNDYWxlbmRhckNvbnRlbnQsXG4gICAgICAgICAgICAgICAgY2xzQ2FsZW5kYXJGb290ZXI6IFwiZC1ub25lXCIsXG4gICAgICAgICAgICAgICAgY2xzQ2FsZW5kYXJNb250aHM6IG8uY2xzQ2FsZW5kYXJNb250aHMsXG4gICAgICAgICAgICAgICAgY2xzQ2FsZW5kYXJZZWFyczogby5jbHNDYWxlbmRhclllYXJzLFxuICAgICAgICAgICAgICAgIGNsc1RvZGF5OiBvLmNsc1RvZGF5LFxuICAgICAgICAgICAgICAgIGNsc1NlbGVjdGVkOiBvLmNsc1NlbGVjdGVkLFxuICAgICAgICAgICAgICAgIGNsc0V4Y2x1ZGVkOiBvLmNsc0V4Y2x1ZGVkLFxuXG4gICAgICAgICAgICAgICAgcmlwcGxlOiBvLnJpcHBsZSxcbiAgICAgICAgICAgICAgICByaXBwbGVDb2xvcjogby5yaXBwbGVDb2xvcixcbiAgICAgICAgICAgICAgICBleGNsdWRlOiBvLmV4Y2x1ZGUsXG4gICAgICAgICAgICAgICAgbWluRGF0ZTogby5taW5EYXRlLFxuICAgICAgICAgICAgICAgIG1heERhdGU6IG8ubWF4RGF0ZSxcbiAgICAgICAgICAgICAgICB5ZWFyc0JlZm9yZTogby55ZWFyc0JlZm9yZSxcbiAgICAgICAgICAgICAgICB5ZWFyc0FmdGVyOiBvLnllYXJzQWZ0ZXIsXG4gICAgICAgICAgICAgICAgc3BlY2lhbDogby5zcGVjaWFsLFxuICAgICAgICAgICAgICAgIGV2ZW50czogby5ldmVudHMsXG4gICAgICAgICAgICAgICAgc2hvd0hlYWRlcjogZmFsc2UsXG4gICAgICAgICAgICAgICAgc2hvd0Zvb3RlcjogZmFsc2UsXG4gICAgICAgICAgICAgICAgbXVsdGlTZWxlY3Q6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHNob3dXZWVrTnVtYmVyOiBvLnNob3dXZWVrTnVtYmVyLFxuICAgICAgICAgICAgICAgIG9uRGF5Q2xpY2s6IGZ1bmN0aW9uKHNlbCwgZGF5LCB0aW1lLCBlbCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRlID0gZGF0ZXRpbWUoc2VsWzBdKS5hbGlnbihcImRheVwiKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRWYWx1ZSwgaCwgbTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9yZW1vdmVPdmVybGF5KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC52YWx1ZSA9IGRhdGU7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQudGltZSA9IHRpbWU7XG5cbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFZhbHVlID0gZGF0ZS5mb3JtYXQoby5mb3JtYXQsIG8ubG9jYWxlKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoby5zaG93VGltZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaCA9IENha2UubHBhZCh0aW1lWzBdLCAyLCBcIjBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBtID0gQ2FrZS5scGFkKHRpbWVbMV0sIDIsIFwiMFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRWYWx1ZSArPSBcIiBcIiArIGggKyBcIjpcIiArIG07XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnZhbChlbGVtZW50VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnRyaWdnZXIoXCJjaGFuZ2VcIik7XG4gICAgICAgICAgICAgICAgICAgIGNhbC5yZW1vdmVDbGFzcyhcIm9wZW4gb3Blbi11cFwiKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsLmhpZGUoKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJjaGFuZ2VcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiB0aGF0LnZhbHVlLnZhbCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogdGhhdC50aW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImRheS1jbGlja1wiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWw6IHNlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRheTogZGF5LFxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogdGltZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsOiBlbFxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJwaWNrZXItY2hhbmdlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbDogdGhhdC52YWx1ZS52YWwoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IHRoYXQudGltZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uVGltZUNoYW5nZTogZnVuY3Rpb24odGltZSl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbGVtZW50VmFsdWUsIGgsIG07XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC50aW1lID0gdGltZTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoYXQudmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQudmFsdWUgPSBkYXRldGltZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRWYWx1ZSA9IHRoYXQudmFsdWUuZm9ybWF0KG8uZm9ybWF0LCBvLmxvY2FsZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG8uc2hvd1RpbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBDYWtlLmxwYWQodGltZVswXSwgMiwgXCIwXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbSA9IENha2UubHBhZCh0aW1lWzFdLCAyLCBcIjBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50VmFsdWUgKz0gXCIgXCIgKyBoICsgXCI6XCIgKyBtO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC52YWwoZWxlbWVudFZhbHVlKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJjaGFuZ2VcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiB0aGF0LnZhbHVlLnZhbCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogdGhhdC50aW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInBpY2tlci1jaGFuZ2VcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiB0aGF0LnZhbHVlLnZhbCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogdGhhdC50aW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25Nb250aENoYW5nZTogby5vbk1vbnRoQ2hhbmdlLFxuICAgICAgICAgICAgICAgIG9uWWVhckNoYW5nZTogby5vblllYXJDaGFuZ2VcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLmNhbGVuZGFyID0gY2FsO1xuXG4gICAgICAgICAgICBpZiAoby5jbGVhckJ1dHRvbiA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGNsZWFyQnV0dG9uID0gJChcIjxidXR0b24+XCIpLmFkZENsYXNzKFwiYnV0dG9uIGlucHV0LWNsZWFyLWJ1dHRvblwiKS5hdHRyKFwidGFiaW5kZXhcIiwgLTEpLmF0dHIoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpLmh0bWwoby5jbGVhckJ1dHRvbkljb24pO1xuICAgICAgICAgICAgICAgIGNsZWFyQnV0dG9uLmFwcGVuZFRvKGJ1dHRvbnMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjYWxlbmRhckJ1dHRvbiA9ICQoXCI8YnV0dG9uPlwiKS5hZGRDbGFzcyhcImJ1dHRvblwiKS5hdHRyKFwidGFiaW5kZXhcIiwgLTEpLmF0dHIoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpLmh0bWwoby5jYWxlbmRhckJ1dHRvbkljb24pO1xuICAgICAgICAgICAgY2FsZW5kYXJCdXR0b24uYXBwZW5kVG8oYnV0dG9ucyk7XG5cbiAgICAgICAgICAgIGlmIChvLnByZXBlbmQgIT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJlcGVuZCA9ICQoXCI8ZGl2PlwiKS5odG1sKG8ucHJlcGVuZCk7XG4gICAgICAgICAgICAgICAgcHJlcGVuZC5hZGRDbGFzcyhcInByZXBlbmRcIikuYWRkQ2xhc3Moby5jbHNQcmVwZW5kKS5hcHBlbmRUbyhjb250YWluZXIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5hdHRyKCdkaXInKSA9PT0gJ3J0bCcgKSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwicnRsXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoU3RyaW5nKG8uc2l6ZSkuaW5kZXhPZihcIiVcIikgPiAtMSkge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogby5zaXplXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogcGFyc2VJbnQoby5zaXplKSArIFwicHhcIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50WzBdLmNsYXNzTmFtZSA9ICcnO1xuXG4gICAgICAgICAgICBpZiAoby5jb3B5SW5saW5lU3R5bGVzID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKFV0aWxzLmdldElubGluZVN0eWxlcyhlbGVtZW50KSwgZnVuY3Rpb24oa2V5LCB2YWx1ZSl7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jc3Moa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcyhvLmNsc1BpY2tlcik7XG4gICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKG8uY2xzSW5wdXQpO1xuXG4gICAgICAgICAgICBpZiAoby5kaWFsb2dPdmVybGF5ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vdmVybGF5ID0gdGhhdC5fb3ZlcmxheSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5kaWFsb2dNb2RlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwiZGlhbG9nLW1vZGVcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChVdGlscy5tZWRpYShcIihtYXgtd2lkdGg6IFwiK28uZGlhbG9nUG9pbnQrXCJweClcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwiZGlhbG9nLW1vZGVcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsZW5kYXIuYWRkQ2xhc3MoXCJkaWFsb2ctbW9kZVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gJChcIjxsYWJlbD5cIikuYWRkQ2xhc3MoXCJsYWJlbC1mb3ItaW5wdXRcIikuYWRkQ2xhc3Moby5jbHNMYWJlbCkuaHRtbChvLmxhYmVsKS5pbnNlcnRCZWZvcmUoY29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5hdHRyKFwiaWRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwuYXR0cihcImZvclwiLCBlbGVtZW50LmF0dHIoXCJpZFwiKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmF0dHIoXCJkaXJcIikgPT09IFwicnRsXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwuYWRkQ2xhc3MoXCJydGxcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5pcyhcIjpkaXNhYmxlZFwiKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBlbGVtZW50LnBhcmVudCgpO1xuICAgICAgICAgICAgdmFyIGNsZWFyID0gY29udGFpbmVyLmZpbmQoXCIuaW5wdXQtY2xlYXItYnV0dG9uXCIpO1xuICAgICAgICAgICAgdmFyIGNhbCA9IHRoaXMuY2FsZW5kYXI7XG4gICAgICAgICAgICB2YXIgY2FsX3BsdWdpbiA9IE1ldHJvLmdldFBsdWdpbihjYWxbMF0sICdjYWxlbmRhcicpO1xuICAgICAgICAgICAgdmFyIGNhbGVuZGFyID0gdGhpcy5jYWxlbmRhcjtcblxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKE1ldHJvLmV2ZW50cy5yZXNpemUsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKG8uZGlhbG9nTW9kZSAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoVXRpbHMubWVkaWEoXCIobWF4LXdpZHRoOiBcIiArIG8uZGlhbG9nUG9pbnQgKyBcInB4KVwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwiZGlhbG9nLW1vZGVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxlbmRhci5hcHBlbmRUbyhcImJvZHlcIikuYWRkQ2xhc3MoXCJkaWFsb2ctbW9kZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5yZW1vdmVDbGFzcyhcImRpYWxvZy1tb2RlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsZW5kYXIuYXBwZW5kVG8oY29udGFpbmVyKS5yZW1vdmVDbGFzcyhcImRpYWxvZy1tb2RlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwge25zOiB0aGlzLmlkfSk7XG5cbiAgICAgICAgICAgIGlmIChjbGVhci5sZW5ndGggPiAwKSBjbGVhci5vbihNZXRyby5ldmVudHMuY2xpY2ssIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGVsZW1lbnQudmFsKFwiXCIpLnRyaWdnZXIoJ2NoYW5nZScpLmJsdXIoKTsgLy8gVE9ETyBjaGFuZ2UgYmx1clxuICAgICAgICAgICAgICAgIHRoYXQudmFsdWUgPSBudWxsO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiYnV0dG9uLCBpbnB1dFwiLCBmdW5jdGlvbihlKXtcblxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHRoYXQudmFsdWUgPyB0aGF0LnZhbHVlIDogZGF0ZXRpbWUoKTtcbiAgICAgICAgICAgICAgICB2YXIgcHJlc2V0VmFsdWUgPSBvLmlucHV0Rm9ybWF0ID8gdmFsdWUuZm9ybWF0KG8uaW5wdXRGb3JtYXQpIDogdmFsdWUuZm9ybWF0KFwiWVlZWS1NTS1ERFwiKTtcblxuICAgICAgICAgICAgICAgIHZhbHVlLmFsaWduKFwiZGF5XCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGNhbC5oYXNDbGFzcyhcIm9wZW5cIikgPT09IGZhbHNlICYmIGNhbC5oYXNDbGFzcyhcIm9wZW4tdXBcIikgPT09IGZhbHNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgJChcIi5jYWxlbmRhci1waWNrZXIgLmNhbGVuZGFyXCIpLnJlbW92ZUNsYXNzKFwib3BlbiBvcGVuLXVwXCIpLmhpZGUoKTtcblxuICAgICAgICAgICAgICAgICAgICBjYWxfcGx1Z2luLnNldFByZXNldChbcHJlc2V0VmFsdWVdKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsX3BsdWdpbi5zZXRTaG93KHZhbHVlKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoY29udGFpbmVyLmhhc0NsYXNzKFwiZGlhbG9nLW1vZGVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQub3ZlcmxheS5hcHBlbmRUbygkKCdib2R5JykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhbC5hZGRDbGFzcyhcIm9wZW5cIik7XG4gICAgICAgICAgICAgICAgICAgIGlmICghVXRpbHMuaW5WaWV3cG9ydChjYWxbMF0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWwuYWRkQ2xhc3MoXCJvcGVuLXVwXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiY2FsZW5kYXItc2hvd1wiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxlbmRhcjogY2FsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9yZW1vdmVPdmVybGF5KCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbC5yZW1vdmVDbGFzcyhcIm9wZW4gb3Blbi11cFwiKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJjYWxlbmRhci1oaWRlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGVuZGFyOiBjYWxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuYmx1ciwgZnVuY3Rpb24oKXtjb250YWluZXIucmVtb3ZlQ2xhc3MoXCJmb2N1c2VkXCIpO30pO1xuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuZm9jdXMsIGZ1bmN0aW9uKCl7Y29udGFpbmVyLmFkZENsYXNzKFwiZm9jdXNlZFwiKTt9KTtcbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNoYW5nZSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBVdGlscy5leGVjKG8ub25DaGFuZ2UsIFt0aGF0LnZhbHVlLnZhbCgpXSwgZWxlbWVudFswXSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuXG4gICAgICAgIF9vdmVybGF5OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIHZhciBvdmVybGF5ID0gJChcIjxkaXY+XCIpO1xuICAgICAgICAgICAgb3ZlcmxheS5hZGRDbGFzcyhcIm92ZXJsYXkgZm9yLWNhbGVuZGFyLXBpY2tlclwiKS5hZGRDbGFzcyhvLmNsc092ZXJsYXkpO1xuXG4gICAgICAgICAgICBpZiAoby5vdmVybGF5Q29sb3IgPT09ICd0cmFuc3BhcmVudCcpIHtcbiAgICAgICAgICAgICAgICBvdmVybGF5LmFkZENsYXNzKFwidHJhbnNwYXJlbnRcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG92ZXJsYXkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogTWV0cm8uY29sb3JzLnRvUkdCQShvLm92ZXJsYXlDb2xvciwgby5vdmVybGF5QWxwaGEpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBvdmVybGF5O1xuICAgICAgICB9LFxuXG4gICAgICAgIF9yZW1vdmVPdmVybGF5OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgJCgnYm9keScpLmZpbmQoJy5vdmVybGF5LmZvci1jYWxlbmRhci1waWNrZXInKS5yZW1vdmUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjbGVhcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSBkYXRldGltZSgpO1xuICAgICAgICAgICAgdGhpcy50aW1lID0gW2RhdGV0aW1lKCkuaG91cigpLCBkYXRldGltZSgpLm1pbnV0ZSgpXTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC52YWwoXCJcIilcbiAgICAgICAgfSxcblxuICAgICAgICB2YWw6IGZ1bmN0aW9uKHYsIGYpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgZWxlbWVudFZhbHVlLCBoLCBtO1xuXG4gICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCB8fCBVdGlscy5pc051bGwodikpICB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0ZTogdGhpcy52YWx1ZS52YWwoKSxcbiAgICAgICAgICAgICAgICAgICAgdGltZTogdGhpcy50aW1lXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHYgPT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jbGVhcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZikge1xuICAgICAgICAgICAgICAgIG8uaW5wdXRGb3JtYXQgPSBmO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgX2N1cnIgPSB2LnNwbGl0KFwiIFwiKTtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSAhby5pbnB1dEZvcm1hdCA/IGRhdGV0aW1lKF9jdXJyWzBdKSA6IERhdGV0aW1lLmZyb20oX2N1cnJbMF0sIG8uaW5wdXRGb3JtYXQsIG8ubG9jYWxlKTtcbiAgICAgICAgICAgIGlmIChfY3VyclsxXSkge1xuICAgICAgICAgICAgICAgIHRoaXMudGltZSA9IF9jdXJyWzFdLnRyaW0oKS5zcGxpdChcIjpcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMudmFsdWUuYWxpZ24oXCJkYXlcIik7XG4gICAgICAgICAgICBNZXRyby5nZXRQbHVnaW4odGhpcy5jYWxlbmRhciwgXCJjYWxlbmRhclwiKS5zZXRUaW1lKHRoaXMudGltZSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnRWYWx1ZSA9IHRoaXMudmFsdWUuZm9ybWF0KG8uZm9ybWF0KTtcblxuICAgICAgICAgICAgaWYgKG8uc2hvd1RpbWUgJiYgdGhpcy50aW1lICYmIGVsZW1lbnRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIGggPSBDYWtlLmxwYWQodGhpcy50aW1lWzBdLCAyLCBcIjBcIik7XG4gICAgICAgICAgICAgICAgbSA9IENha2UubHBhZCh0aGlzLnRpbWVbMV0sIDIsIFwiMFwiKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50VmFsdWUgKz0gXCIgXCIgKyBoICsgXCI6XCIgKyBtO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LnZhbChlbGVtZW50VmFsdWUpO1xuICAgICAgICAgICAgZWxlbWVudC50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRpc2FibGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnBhcmVudCgpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZW5hYmxlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmRhdGEoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50KCkucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGVTdGF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmVsZW0uZGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmFibGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpMThuOiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgaGlkZGVuO1xuICAgICAgICAgICAgdmFyIGNhbCA9IHRoaXMuY2FsZW5kYXI7XG4gICAgICAgICAgICBpZiAodmFsID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gby5sb2NhbGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoTWV0cm8ubG9jYWxlc1t2YWxdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGhpZGRlbiA9IGNhbFswXS5oaWRkZW47XG4gICAgICAgICAgICBpZiAoaGlkZGVuKSB7XG4gICAgICAgICAgICAgICAgY2FsLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6IFwiaGlkZGVuXCIsXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IFwiYmxvY2tcIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKGNhbFswXSwgJ2NhbGVuZGFyJykuaTE4bih2YWwpO1xuICAgICAgICAgICAgaWYgKGhpZGRlbikge1xuICAgICAgICAgICAgICAgIGNhbC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiBcInZpc2libGVcIixcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogXCJub25lXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBnZXRUaW1lOiBmdW5jdGlvbihhc1N0cmluZyl7XG4gICAgICAgICAgICB2YXIgaCwgbTtcblxuICAgICAgICAgICAgYXNTdHJpbmcgPSBhc1N0cmluZyB8fCBmYWxzZTtcblxuICAgICAgICAgICAgaCA9IENha2UubHBhZCh0aGlzLnRpbWVbMF0sIDIsIFwiMFwiKTtcbiAgICAgICAgICAgIG0gPSBDYWtlLmxwYWQodGhpcy50aW1lWzFdLCAyLCBcIjBcIik7XG5cbiAgICAgICAgICAgIHJldHVybiBhc1N0cmluZyA/IGggK1wiOlwiKyBtIDogdGhpcy50aW1lO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSwgbmV3VmFsdWUpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIGNhbCA9IE1ldHJvLmdldFBsdWdpbih0aGlzLmNhbGVuZGFyWzBdLCBcImNhbGVuZGFyXCIpO1xuXG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwidmFsdWVcIjogdGhhdC52YWwobmV3VmFsdWUpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdkaXNhYmxlZCc6IHRoaXMudG9nZ2xlU3RhdGUoKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnZGF0YS1sb2NhbGUnOiB0aGF0LmkxOG4obmV3VmFsdWUpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdkYXRhLXNwZWNpYWwnOiBjYWwuc2V0U3BlY2lhbChuZXdWYWx1ZSk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2RhdGEtZXhjbHVkZSc6IGNhbC5zZXRFeGNsdWRlKG5ld1ZhbHVlKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnZGF0YS1taW4tZGF0ZSc6IGNhbC5zZXRNaW5EYXRlKG5ld1ZhbHVlKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnZGF0YS1tYXgtZGF0ZSc6IGNhbC5zZXRNYXhEYXRlKG5ld1ZhbHVlKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnZGF0YS12YWx1ZSc6IHRoYXQudmFsKG5ld1ZhbHVlKTsgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGVsZW1lbnQucGFyZW50KCk7XG4gICAgICAgICAgICB2YXIgY2xlYXIgPSBjb250YWluZXIuZmluZChcIi5pbnB1dC1jbGVhci1idXR0b25cIik7XG5cbiAgICAgICAgICAgICQod2luZG93KS5vZmYoTWV0cm8uZXZlbnRzLnJlc2l6ZSwge25zOiB0aGlzLmlkfSk7XG4gICAgICAgICAgICBjbGVhci5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcImJ1dHRvbiwgaW5wdXRcIik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuYmx1cik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuZm9jdXMpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNoYW5nZSk7XG5cbiAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbih0aGlzLmNhbGVuZGFyLCBcImNhbGVuZGFyXCIpLmRlc3Ryb3koKTtcblxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgICQoZG9jdW1lbnQpLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIub3ZlcmxheS5mb3ItY2FsZW5kYXItcGlja2VyXCIsZnVuY3Rpb24oKXtcbiAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICAgICAgJChcIi5jYWxlbmRhci1mb3ItcGlja2VyLm9wZW5cIikucmVtb3ZlQ2xhc3MoXCJvcGVuIG9wZW4tdXBcIik7XG4gICAgfSk7XG5cbiAgICAkKGRvY3VtZW50KS5vbihNZXRyby5ldmVudHMuY2xpY2ssIGZ1bmN0aW9uKCl7XG4gICAgICAgICQoXCIuY2FsZW5kYXItcGlja2VyIC5jYWxlbmRhclwiKS5yZW1vdmVDbGFzcyhcIm9wZW4gb3Blbi11cFwiKTtcbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBlZmZlY3RzID0gW1xuICAgICAgICBcInNsaWRlXCIsIFwic2xpZGUtdlwiLCBcImZhZGVcIiwgXCJzd2l0Y2hcIiwgXCJ6b29tXCIsIFwic3dpcmxcIlxuICAgIF07XG4gICAgdmFyIENhcm91c2VsRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgY2Fyb3VzZWxEZWZlcnJlZDogMCxcbiAgICAgICAgYXV0b1N0YXJ0OiBmYWxzZSxcbiAgICAgICAgd2lkdGg6IFwiMTAwJVwiLFxuICAgICAgICBoZWlnaHQ6IFwiMTYvOVwiLCAvLyAzLzQsIDIxLzlcbiAgICAgICAgZWZmZWN0OiBlZmZlY3RzWzBdLFxuICAgICAgICBlZmZlY3RGdW5jOiBcImxpbmVhclwiLFxuICAgICAgICBkaXJlY3Rpb246IFwibGVmdFwiLCAvL2xlZnQsIHJpZ2h0XG4gICAgICAgIGR1cmF0aW9uOiBNRVRST19BTklNQVRJT05fRFVSQVRJT04sXG4gICAgICAgIHBlcmlvZDogNTAwMCxcbiAgICAgICAgc3RvcE9uTW91c2U6IHRydWUsXG5cbiAgICAgICAgY29udHJvbHM6IHRydWUsXG4gICAgICAgIGJ1bGxldHM6IHRydWUsXG4gICAgICAgIGJ1bGxldHNTdHlsZTogXCJzcXVhcmVcIiwgLy8gc3F1YXJlLCBjaXJjbGUsIHJlY3QsIGRpYW1vbmRcbiAgICAgICAgYnVsbGV0c1NpemU6IFwiZGVmYXVsdFwiLCAvLyBkZWZhdWx0LCBtaW5pLCBzbWFsbCwgbGFyZ2VcblxuICAgICAgICBjb250cm9sc09uTW91c2U6IGZhbHNlLFxuICAgICAgICBjb250cm9sc091dHNpZGU6IGZhbHNlLFxuICAgICAgICBidWxsZXRzUG9zaXRpb246IFwiZGVmYXVsdFwiLCAvLyBkZWZhdWx0LCBsZWZ0LCByaWdodFxuXG4gICAgICAgIGNvbnRyb2xQcmV2OiAnJiN4MjNGNCcsXG4gICAgICAgIGNvbnRyb2xOZXh0OiAnJiN4MjNGNScsXG4gICAgICAgIGNsc0Nhcm91c2VsOiBcIlwiLFxuICAgICAgICBjbHNTbGlkZXM6IFwiXCIsXG4gICAgICAgIGNsc1NsaWRlOiBcIlwiLFxuICAgICAgICBjbHNDb250cm9sczogXCJcIixcbiAgICAgICAgY2xzQ29udHJvbE5leHQ6IFwiXCIsXG4gICAgICAgIGNsc0NvbnRyb2xQcmV2OiBcIlwiLFxuICAgICAgICBjbHNCdWxsZXRzOiBcIlwiLFxuICAgICAgICBjbHNCdWxsZXQ6IFwiXCIsXG4gICAgICAgIGNsc0J1bGxldE9uOiBcIlwiLFxuICAgICAgICBjbHNUaHVtYk9uOiBcIlwiLFxuXG4gICAgICAgIG9uU3RvcDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25TdGFydDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25QbGF5OiBNZXRyby5ub29wLFxuICAgICAgICBvblNsaWRlQ2xpY2s6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQnVsbGV0Q2xpY2s6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uVGh1bWJDbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Nb3VzZUVudGVyOiBNZXRyby5ub29wLFxuICAgICAgICBvbk1vdXNlTGVhdmU6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uTmV4dENsaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvblByZXZDbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25TbGlkZVNob3c6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uU2xpZGVIaWRlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNhcm91c2VsQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmNhcm91c2VsU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBDYXJvdXNlbERlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgQ2Fyb3VzZWxEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0Nhcm91c2VsU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5jYXJvdXNlbFNldHVwKHdpbmRvd1tcIm1ldHJvQ2Fyb3VzZWxTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdjYXJvdXNlbCcsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBDYXJvdXNlbERlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDAsXG4gICAgICAgICAgICAgICAgd2lkdGg6IDAsXG4gICAgICAgICAgICAgICAgc2xpZGVzOiBbXSxcbiAgICAgICAgICAgICAgICBjdXJyZW50OiBudWxsLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRJbmRleDogbnVsbCxcbiAgICAgICAgICAgICAgICBkaXI6IFwibGVmdFwiLFxuICAgICAgICAgICAgICAgIGludGVydmFsOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBpc0FuaW1hdGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlkOiBVdGlscy5lbGVtZW50SWQoXCJjYXJvdXNlbFwiKVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBzbGlkZXMgPSBlbGVtZW50LmZpbmQoXCIuc2xpZGVcIik7XG4gICAgICAgICAgICB2YXIgc2xpZGVzX2NvbnRhaW5lciA9IGVsZW1lbnQuZmluZChcIi5zbGlkZXNcIik7XG5cbiAgICAgICAgICAgIHRoaXMuZGlyID0gdGhpcy5vcHRpb25zLmRpcmVjdGlvbjtcblxuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImNhcm91c2VsXCIpLmFkZENsYXNzKG8uY2xzQ2Fyb3VzZWwpO1xuXG4gICAgICAgICAgICBlbGVtZW50LmNzcyh7XG4gICAgICAgICAgICAgICAgbWF4V2lkdGg6IG8ud2lkdGhcbiAgICAgICAgICAgIH0pO1xuXG5cbiAgICAgICAgICAgIGlmIChvLmNvbnRyb2xzT3V0c2lkZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJjb250cm9scy1vdXRzaWRlXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc2xpZGVzX2NvbnRhaW5lci5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBzbGlkZXNfY29udGFpbmVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwic2xpZGVzXCIpLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHNsaWRlcy5hcHBlbmRUbyhzbGlkZXNfY29udGFpbmVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2xpZGVzLmFkZENsYXNzKG8uY2xzU2xpZGVzKTtcblxuICAgICAgICAgICAgaWYgKHNsaWRlcy5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVTbGlkZXMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVDb250cm9scygpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUJ1bGxldHMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZXNpemUoKTtcblxuICAgICAgICAgICAgICAgIGlmIChvLmNvbnRyb2xzT25Nb3VzZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoXCJbY2xhc3MqPWNhcm91c2VsLXN3aXRjaF1cIikuZmFkZU91dCgwKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmNhcm91c2VsLWJ1bGxldHNcIikuZmFkZU91dCgwKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoby5hdXRvU3RhcnQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3RhcnQoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJzbGlkZS1zaG93XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQ6IHRoaXMuc2xpZGVzW3RoaXMuY3VycmVudEluZGV4XVswXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZXY6IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiY2Fyb3VzZWwtY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfc3RhcnQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgcGVyaW9kID0gby5wZXJpb2Q7XG4gICAgICAgICAgICB2YXIgY3VycmVudCA9IHRoaXMuc2xpZGVzW3RoaXMuY3VycmVudEluZGV4XTtcblxuICAgICAgICAgICAgaWYgKGN1cnJlbnQuZGF0YShcInBlcmlvZFwiKSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcGVyaW9kID0gY3VycmVudC5kYXRhKFwicGVyaW9kXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5zbGlkZXMubGVuZ3RoIDw9IDEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5pbnRlcnZhbCA9PT0gZmFsc2UpIHRoaXMuaW50ZXJ2YWwgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uIHJ1bigpIHtcbiAgICAgICAgICAgICAgICB2YXIgdCA9IG8uZGlyZWN0aW9uID09PSAnbGVmdCcgPyAnbmV4dCcgOiAncHJpb3InO1xuICAgICAgICAgICAgICAgIHRoYXQuX3NsaWRlVG8odCwgdHJ1ZSk7XG4gICAgICAgICAgICB9LCBwZXJpb2QpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJzdGFydFwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3N0b3A6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpO1xuICAgICAgICAgICAgdGhpcy5pbnRlcnZhbCA9IGZhbHNlO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9yZXNpemU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciB3aWR0aCA9IGVsZW1lbnQub3V0ZXJXaWR0aCgpO1xuICAgICAgICAgICAgdmFyIGhlaWdodDtcbiAgICAgICAgICAgIHZhciBtZWRpYXMgPSBbXTtcblxuICAgICAgICAgICAgaWYgKFtcIjE2LzlcIiwgXCIyMS85XCIsIFwiNC8zXCJdLmluZGV4T2Yoby5oZWlnaHQpID4gLTEpIHtcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSBVdGlscy5hc3BlY3RSYXRpb0god2lkdGgsIG8uaGVpZ2h0KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKFN0cmluZyhvLmhlaWdodCkuaW5kZXhPZihcIkBcIikgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICBtZWRpYXMgPSBvLmhlaWdodC5zdWJzdHIoMSkudG9BcnJheShcInxcIik7XG4gICAgICAgICAgICAgICAgICAgICQuZWFjaChtZWRpYXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVkaWEgPSB0aGlzLnRvQXJyYXkoXCIsXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5tYXRjaE1lZGlhKG1lZGlhWzBdKS5tYXRjaGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFtcIjE2LzlcIiwgXCIyMS85XCIsIFwiNC8zXCJdLmluZGV4T2YobWVkaWFbMV0pID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gVXRpbHMuYXNwZWN0UmF0aW9IKHdpZHRoLCBtZWRpYVsxXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gcGFyc2VJbnQobWVkaWFbMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gcGFyc2VJbnQoby5oZWlnaHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlU2xpZGVzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHNsaWRlcyA9IGVsZW1lbnQuZmluZChcIi5zbGlkZVwiKTtcblxuICAgICAgICAgICAgJC5lYWNoKHNsaWRlcywgZnVuY3Rpb24oaSl7XG4gICAgICAgICAgICAgICAgdmFyIHNsaWRlID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICBpZiAoc2xpZGUuZGF0YShcImNvdmVyXCIpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2xpZGUuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogXCJ1cmwoXCIrc2xpZGUuZGF0YSgnY292ZXInKStcIilcIlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaSAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG8uZWZmZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwic3dpdGNoXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwic2xpZGVcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZS5jc3MoXCJsZWZ0XCIsIFwiMTAwJVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJzbGlkZS12XCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGUuY3NzKFwidG9wXCIsIFwiMTAwJVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJmYWRlXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiem9vbVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcInN3aXJsXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGUuY3NzKFwib3BhY2l0eVwiLCBcIjBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzbGlkZS5hZGRDbGFzcyhcImFjdGl2ZS1zbGlkZVwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzbGlkZS5hZGRDbGFzcyhvLmNsc1NsaWRlKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuc2xpZGVzLnB1c2goc2xpZGUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuY3VycmVudEluZGV4ID0gMDtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudCA9IHRoaXMuc2xpZGVzW3RoaXMuY3VycmVudEluZGV4XTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlQ29udHJvbHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBuZXh0LCBwcmV2O1xuXG4gICAgICAgICAgICBpZiAoby5jb250cm9scyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBuZXh0ID0gJCgnPHNwYW4vPicpLmFkZENsYXNzKCdjYXJvdXNlbC1zd2l0Y2gtbmV4dCcpLmFkZENsYXNzKG8uY2xzQ29udHJvbHMpLmFkZENsYXNzKG8uY2xzQ29udHJvbE5leHQpLmh0bWwoXCI+XCIpO1xuICAgICAgICAgICAgcHJldiA9ICQoJzxzcGFuLz4nKS5hZGRDbGFzcygnY2Fyb3VzZWwtc3dpdGNoLXByZXYnKS5hZGRDbGFzcyhvLmNsc0NvbnRyb2xzKS5hZGRDbGFzcyhvLmNsc0NvbnRyb2xQcmV2KS5odG1sKFwiPFwiKTtcblxuICAgICAgICAgICAgaWYgKG8uY29udHJvbE5leHQpIHtcbiAgICAgICAgICAgICAgICBuZXh0Lmh0bWwoby5jb250cm9sTmV4dCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmNvbnRyb2xQcmV2KSB7XG4gICAgICAgICAgICAgICAgcHJldi5odG1sKG8uY29udHJvbFByZXYpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBuZXh0LmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgcHJldi5hcHBlbmRUbyhlbGVtZW50KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlQnVsbGV0czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGJ1bGxldHMsIGk7XG5cbiAgICAgICAgICAgIGlmIChvLmJ1bGxldHMgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYnVsbGV0cyA9ICQoJzxkaXY+JykuYWRkQ2xhc3MoXCJjYXJvdXNlbC1idWxsZXRzXCIpLmFkZENsYXNzKG8uYnVsbGV0c1NpemUrXCItc2l6ZVwiKS5hZGRDbGFzcyhcImJ1bGxldC1zdHlsZS1cIitvLmJ1bGxldHNTdHlsZSkuYWRkQ2xhc3Moby5jbHNCdWxsZXRzKTtcbiAgICAgICAgICAgIGlmIChvLmJ1bGxldHNQb3NpdGlvbiA9PT0gJ2RlZmF1bHQnIHx8IG8uYnVsbGV0c1Bvc2l0aW9uID09PSAnY2VudGVyJykge1xuICAgICAgICAgICAgICAgIGJ1bGxldHMuYWRkQ2xhc3MoXCJmbGV4LWp1c3RpZnktY2VudGVyXCIpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChvLmJ1bGxldHNQb3NpdGlvbiA9PT0gJ2xlZnQnKSB7XG4gICAgICAgICAgICAgICAgYnVsbGV0cy5hZGRDbGFzcyhcImZsZXgtanVzdGlmeS1zdGFydFwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYnVsbGV0cy5hZGRDbGFzcyhcImZsZXgtanVzdGlmeS1lbmRcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLnNsaWRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBidWxsZXQgPSAkKCc8c3Bhbj4nKS5hZGRDbGFzcyhcImNhcm91c2VsLWJ1bGxldFwiKS5hZGRDbGFzcyhvLmNsc0J1bGxldCkuZGF0YShcInNsaWRlXCIsIGkpO1xuICAgICAgICAgICAgICAgIGlmIChpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1bGxldC5hZGRDbGFzcygnYnVsbGV0LW9uJykuYWRkQ2xhc3Moby5jbHNCdWxsZXRPbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJ1bGxldC5hcHBlbmRUbyhidWxsZXRzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYnVsbGV0cy5hcHBlbmRUbyhlbGVtZW50KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuY2Fyb3VzZWwtYnVsbGV0XCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGJ1bGxldCA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgaWYgKHRoYXQuaXNBbmltYXRlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9zbGlkZVRvU2xpZGUoYnVsbGV0LmRhdGEoJ3NsaWRlJykpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJidWxsZXQtY2xpY2tcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnVsbGV0OiBidWxsZXRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5jYXJvdXNlbC1zd2l0Y2gtbmV4dFwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmICh0aGF0LmlzQW5pbWF0ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fc2xpZGVUbyhcIm5leHRcIiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJuZXh0LWNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbjogdGhpc1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmNhcm91c2VsLXN3aXRjaC1wcmV2XCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKHRoYXQuaXNBbmltYXRlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9zbGlkZVRvKFwicHJldlwiLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInByZXYtY2xpY2tcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uOiB0aGlzXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoby5zdG9wT25Nb3VzZSA9PT0gdHJ1ZSAmJiBvLmF1dG9TdGFydCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmVudGVyLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3N0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwibW91c2UtZW50ZXJcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgICAgICAgICB9LCBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMubGVhdmUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fc3RhcnQoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwibW91c2UtbGVhdmVcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgICAgICAgICB9LCBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmNvbnRyb2xzT25Nb3VzZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmVudGVyLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIltjbGFzcyo9Y2Fyb3VzZWwtc3dpdGNoXVwiKS5mYWRlSW4oKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmNhcm91c2VsLWJ1bGxldHNcIikuZmFkZUluKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMubGVhdmUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiW2NsYXNzKj1jYXJvdXNlbC1zd2l0Y2hdXCIpLmZhZGVPdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmNhcm91c2VsLWJ1bGxldHNcIikuZmFkZU91dCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuc2xpZGVcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgc2xpZGUgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInNsaWRlLWNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgc2xpZGU6IHNsaWRlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKE1ldHJvLmV2ZW50cy5yZXNpemUsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5fcmVzaXplKCk7XG4gICAgICAgICAgICB9LCB7bnM6IHRoaXMuaWR9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfc2xpZGVUb1NsaWRlOiBmdW5jdGlvbihpbmRleCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjdXJyZW50LCBuZXh0LCB0bztcblxuICAgICAgICAgICAgaWYgKHRoaXMuc2xpZGVzW2luZGV4XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudEluZGV4ID09PSBpbmRleCkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRvID0gaW5kZXggPiB0aGlzLmN1cnJlbnRJbmRleCA/IFwibmV4dFwiIDogXCJwcmV2XCI7XG4gICAgICAgICAgICBjdXJyZW50ID0gdGhpcy5zbGlkZXNbdGhpcy5jdXJyZW50SW5kZXhdO1xuICAgICAgICAgICAgbmV4dCA9IHRoaXMuc2xpZGVzW2luZGV4XTtcblxuICAgICAgICAgICAgdGhpcy5jdXJyZW50SW5kZXggPSBpbmRleDtcblxuICAgICAgICAgICAgdGhpcy5fZWZmZWN0KGN1cnJlbnQsIG5leHQsIG8uZWZmZWN0LCB0byk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5jYXJvdXNlbC1idWxsZXRcIikucmVtb3ZlQ2xhc3MoXCJidWxsZXQtb25cIikucmVtb3ZlQ2xhc3Moby5jbHNCdWxsZXRPbik7XG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuY2Fyb3VzZWwtYnVsbGV0Om50aC1jaGlsZChcIisodGhpcy5jdXJyZW50SW5kZXgrMSkrXCIpXCIpLmFkZENsYXNzKFwiYnVsbGV0LW9uXCIpLmFkZENsYXNzKG8uY2xzQnVsbGV0T24pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9zbGlkZVRvOiBmdW5jdGlvbih0bywgaW50ZXJ2YWwpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY3VycmVudCwgbmV4dDtcblxuICAgICAgICAgICAgaWYgKHRvID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0byA9IFwibmV4dFwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjdXJyZW50ID0gdGhpcy5zbGlkZXNbdGhpcy5jdXJyZW50SW5kZXhdO1xuXG4gICAgICAgICAgICBpZiAodG8gPT09IFwibmV4dFwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50SW5kZXgrKztcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50SW5kZXggPj0gdGhpcy5zbGlkZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEluZGV4ID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEluZGV4LS07XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudEluZGV4IDwgMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRJbmRleCA9IHRoaXMuc2xpZGVzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBuZXh0ID0gdGhpcy5zbGlkZXNbdGhpcy5jdXJyZW50SW5kZXhdO1xuXG4gICAgICAgICAgICB0aGlzLl9lZmZlY3QoY3VycmVudCwgbmV4dCwgby5lZmZlY3QsIHRvLCBpbnRlcnZhbCk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5jYXJvdXNlbC1idWxsZXRcIikucmVtb3ZlQ2xhc3MoXCJidWxsZXQtb25cIikucmVtb3ZlQ2xhc3Moby5jbHNCdWxsZXRPbik7XG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuY2Fyb3VzZWwtYnVsbGV0Om50aC1jaGlsZChcIisodGhpcy5jdXJyZW50SW5kZXgrMSkrXCIpXCIpLmFkZENsYXNzKFwiYnVsbGV0LW9uXCIpLmFkZENsYXNzKG8uY2xzQnVsbGV0T24pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9lZmZlY3Q6IGZ1bmN0aW9uKGN1cnJlbnQsIG5leHQsIGVmZmVjdCwgdG8sIGludGVydmFsKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBkdXJhdGlvbiA9IG8uZHVyYXRpb247XG4gICAgICAgICAgICB2YXIgZnVuYywgZWZmZWN0RnVuYyA9IG8uZWZmZWN0RnVuYztcbiAgICAgICAgICAgIHZhciBwZXJpb2QgPSBvLnBlcmlvZDtcblxuICAgICAgICAgICAgdmFyIHJ1biA9IGZ1bmN0aW9uKGYsIGMsIG4sIG8pe1xuICAgICAgICAgICAgICAgIE1ldHJvLmFuaW1hdGlvbnNbZl0oYywgbiwgbyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChuZXh0LmRhdGEoJ2R1cmF0aW9uJykgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGR1cmF0aW9uID0gbmV4dC5kYXRhKCdkdXJhdGlvbicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobmV4dC5kYXRhKCdlZmZlY3RGdW5jJykgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGVmZmVjdEZ1bmMgPSBuZXh0LmRhdGEoJ2VmZmVjdEZ1bmMnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGVmZmVjdCA9PT0gJ3N3aXRjaCcpIHtcbiAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGN1cnJlbnQuc3RvcCh0cnVlKTtcbiAgICAgICAgICAgIG5leHQuc3RvcCh0cnVlKTtcbiAgICAgICAgICAgIHRoaXMuaXNBbmltYXRlID0gdHJ1ZTtcblxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe3RoYXQuaXNBbmltYXRlID0gZmFsc2U7fSwgZHVyYXRpb24gKyAxMDApO1xuXG4gICAgICAgICAgICBpZiAoZWZmZWN0ID09PSAnc2xpZGUnKSB7XG4gICAgICAgICAgICAgICAgZnVuYyA9IHRvID09PSAnbmV4dCcgPyAnc2xpZGVMZWZ0JzogJ3NsaWRlUmlnaHQnO1xuICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICBpZiAoZWZmZWN0ID09PSAnc2xpZGUtdicpIHtcbiAgICAgICAgICAgICAgICBmdW5jID0gdG8gPT09ICduZXh0JyA/ICdzbGlkZVVwJzogJ3NsaWRlRG93bic7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZ1bmMgPSBlZmZlY3Q7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghZWZmZWN0cy5pbmNsdWRlcyhlZmZlY3QpKSB7XG4gICAgICAgICAgICAgICAgZnVuYyA9IFwic3dpdGNoXCI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJ1bihmdW5jLCBjdXJyZW50LCBuZXh0LCB7ZHVyYXRpb246IGR1cmF0aW9uLCBlYXNlOiBlZmZlY3RGdW5jfSk7XG5cbiAgICAgICAgICAgIGN1cnJlbnQucmVtb3ZlQ2xhc3MoXCJhY3RpdmUtc2xpZGVcIik7XG4gICAgICAgICAgICBuZXh0LmFkZENsYXNzKFwiYWN0aXZlLXNsaWRlXCIpO1xuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwic2xpZGUtc2hvd1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnQ6IG5leHRbMF0sXG4gICAgICAgICAgICAgICAgICAgIHByZXY6IGN1cnJlbnRbMF1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSwgZHVyYXRpb24pO1xuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwic2xpZGUtaGlkZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnQ6IGN1cnJlbnRbMF0sXG4gICAgICAgICAgICAgICAgICAgIG5leHQ6IG5leHRbMF1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSwgZHVyYXRpb24pO1xuXG4gICAgICAgICAgICBpZiAoaW50ZXJ2YWwgPT09IHRydWUpIHtcblxuICAgICAgICAgICAgICAgIGlmIChuZXh0LmRhdGEoJ3BlcmlvZCcpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcGVyaW9kID0gbmV4dC5kYXRhKCdwZXJpb2QnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLmludGVydmFsID0gc2V0VGltZW91dChmdW5jdGlvbiBydW4oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0ID0gby5kaXJlY3Rpb24gPT09ICdsZWZ0JyA/ICduZXh0JyA6ICdwcmlvcic7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3NsaWRlVG8odCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSwgcGVyaW9kKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB0b1NsaWRlOiBmdW5jdGlvbihpbmRleCl7XG4gICAgICAgICAgICB0aGlzLl9zbGlkZVRvU2xpZGUoaW5kZXgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG5leHQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLl9zbGlkZVRvKFwibmV4dFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBwcmV2OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5fc2xpZGVUbyhcInByZXZcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc3RvcDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKTtcbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInN0b3BcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcGxheTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuX3N0YXJ0KCk7XG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJwbGF5XCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldEVmZmVjdDogZnVuY3Rpb24oZWZmZWN0KXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHNsaWRlcyA9IGVsZW1lbnQuZmluZChcIi5zbGlkZVwiKTtcblxuICAgICAgICAgICAgaWYgKCFlZmZlY3RzLmluY2x1ZGVzKGVmZmVjdCkpIHJldHVybiA7XG5cbiAgICAgICAgICAgIG8uZWZmZWN0ID0gZWZmZWN0O1xuXG4gICAgICAgICAgICBzbGlkZXMucmVtb3ZlU3R5bGVQcm9wZXJ0eShcInRyYW5zZm9ybVwiKS5jc3Moe1xuICAgICAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgICAgICBsZWZ0OiAwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgKi9cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lLCBuZXdWYWx1ZSl7XG4gICAgICAgICAgICBpZiAoYXR0cmlidXRlTmFtZSA9PT0gJ2RhdGEtZWZmZWN0Jykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0RWZmZWN0KG5ld1ZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuY2Fyb3VzZWwtYnVsbGV0XCIpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5jYXJvdXNlbC1zd2l0Y2gtbmV4dFwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuY2Fyb3VzZWwtc3dpdGNoLXByZXZcIik7XG5cbiAgICAgICAgICAgIGlmIChvLnN0b3BPbk1vdXNlID09PSB0cnVlICYmIG8uYXV0b1N0YXJ0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmVudGVyKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMubGVhdmUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5jb250cm9sc09uTW91c2UgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuZW50ZXIpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5sZWF2ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuc2xpZGVcIik7XG4gICAgICAgICAgICAkKHdpbmRvdykub2ZmKE1ldHJvLmV2ZW50cy5yZXNpemUsIHtuczogdGhpcy5pZH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIENoYXJtc0RlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGNoYXJtc0RlZmVycmVkOiAwLFxuICAgICAgICBwb3NpdGlvbjogXCJyaWdodFwiLFxuICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICBjbHNDaGFybXM6IFwiXCIsXG4gICAgICAgIG9uQ2hhcm1DcmVhdGU6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uT3BlbjogTWV0cm8ubm9vcCxcbiAgICAgICAgb25DbG9zZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Ub2dnbGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uY2hhcm1zU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBDaGFybXNEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIENoYXJtc0RlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvQ2hhcm1zU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5jaGFybXNTZXR1cCh3aW5kb3dbXCJtZXRyb0NoYXJtc1NldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ2NoYXJtcycsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBDaGFybXNEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgb3JpZ2luOiB7XG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IFwiXCJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJjaGFybS1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgZWxlbWVudFxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcImNoYXJtc1wiKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhvLnBvc2l0aW9uICsgXCItc2lkZVwiKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhvLmNsc0NoYXJtcyk7XG5cbiAgICAgICAgICAgIHRoaXMub3JpZ2luLmJhY2tncm91bmQgPSBlbGVtZW50LmNzcyhcImJhY2tncm91bmQtY29sb3JcIik7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuY3NzKHtcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IE1ldHJvLmNvbG9ycy50b1JHQkEoVXRpbHMuZ2V0U3R5bGVPbmUoZWxlbWVudCwgXCJiYWNrZ3JvdW5kLWNvbG9yXCIpLCBvLm9wYWNpdHkpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICB9LFxuXG4gICAgICAgIG9wZW46IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcIm9wZW5cIik7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcIm9wZW5cIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcyhcIm9wZW5cIik7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImNsb3NlXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5oYXNDbGFzcyhcIm9wZW5cIikgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMub3BlbigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJ0b2dnbGVcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb3BhY2l0eTogZnVuY3Rpb24odil7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgaWYgKHYgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvLm9wYWNpdHk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvcGFjaXR5ID0gTWF0aC5hYnMocGFyc2VGbG9hdCh2KSk7XG4gICAgICAgICAgICBpZiAob3BhY2l0eSA8IDAgfHwgb3BhY2l0eSA+IDEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgby5vcGFjaXR5ID0gb3BhY2l0eTtcblxuICAgICAgICAgICAgZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogTWV0cm8uY29sb3JzLnRvUkdCQShVdGlscy5nZXRTdHlsZU9uZShlbGVtZW50LCBcImJhY2tncm91bmQtY29sb3JcIiksIG9wYWNpdHkpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VPcGFjaXR5OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB0aGlzLm9wYWNpdHkoZWxlbWVudC5hdHRyKFwiZGF0YS1vcGFjaXR5XCIpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHJpYnV0ZU5hbWUpe1xuICAgICAgICAgICAgc3dpdGNoIChhdHRyaWJ1dGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtb3BhY2l0eVwiOiB0aGlzLmNoYW5nZU9wYWNpdHkoKTsgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIE1ldHJvWydjaGFybXMnXSA9IHtcbiAgICAgICAgY2hlY2s6IGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIGlmIChVdGlscy5pc01ldHJvT2JqZWN0KGVsLCBcImNoYXJtc1wiKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJFbGVtZW50IGlzIG5vdCBhIGNoYXJtcyBjb21wb25lbnRcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNPcGVuOiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICBpZiAodGhpcy5jaGVjayhlbCkgPT09IGZhbHNlKSByZXR1cm4gO1xuICAgICAgICAgICAgcmV0dXJuICQoZWwpLmhhc0NsYXNzKFwib3BlblwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvcGVuOiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICBpZiAodGhpcy5jaGVjayhlbCkgPT09IGZhbHNlKSByZXR1cm4gO1xuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKGVsLCBcImNoYXJtc1wiKS5vcGVuKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrKGVsKSA9PT0gZmFsc2UpIHJldHVybiA7XG4gICAgICAgICAgICBNZXRyby5nZXRQbHVnaW4oZWwsIFwiY2hhcm1zXCIpLmNsb3NlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICBpZiAodGhpcy5jaGVjayhlbCkgPT09IGZhbHNlKSByZXR1cm4gO1xuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKGVsLCBcImNoYXJtc1wiKS50b2dnbGUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjbG9zZUFsbDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICQoJ1tkYXRhLXJvbGUqPWNoYXJtc10nKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbih0aGlzLCAnY2hhcm1zJykuY2xvc2UoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9wYWNpdHk6IGZ1bmN0aW9uKGVsLCBvcGFjaXR5KXtcbiAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrKGVsKSA9PT0gZmFsc2UpIHJldHVybiA7XG4gICAgICAgICAgICBNZXRyby5nZXRQbHVnaW4oZWwsIFwiY2hhcm1zXCIpLm9wYWNpdHkob3BhY2l0eSk7XG4gICAgICAgIH1cbiAgICB9O1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIGRlZmF1bHRBdmF0YXIgPSBcImRhdGE6aW1hZ2UvanBlZztiYXNlNjQsLzlqLzRBQVFTa1pKUmdBQkFRQUFBUUFCQUFELy9nQTdRMUpGUVZSUFVqb2daMlF0YW5CbFp5QjJNUzR3SUNoMWMybHVaeUJKU2tjZ1NsQkZSeUIyTmpJcExDQnhkV0ZzYVhSNUlEMGdPVEFLLzlzQVF3QURBZ0lEQWdJREF3TURCQU1EQkFVSUJRVUVCQVVLQndjR0NBd0tEQXdMQ2dzTERRNFNFQTBPRVE0TEN4QVdFQkVURkJVVkZRd1BGeGdXRkJnU0ZCVVUvOXNBUXdFREJBUUZCQVVKQlFVSkZBMExEUlFVRkJRVUZCUVVGQlFVRkJRVUZCUVVGQlFVRkJRVUZCUVVGQlFVRkJRVUZCUVVGQlFVRkJRVUZCUVVGQlFVRkJRVS84QUFFUWdBVUFCUUF3RWlBQUlSQVFNUkFmL0VBQjhBQUFFRkFRRUJBUUVCQUFBQUFBQUFBQUFCQWdNRUJRWUhDQWtLQy8vRUFMVVFBQUlCQXdNQ0JBTUZCUVFFQUFBQmZRRUNBd0FFRVFVU0lURkJCaE5SWVFjaWNSUXlnWkdoQ0NOQ3NjRVZVdEh3SkROaWNvSUpDaFlYR0JrYUpTWW5LQ2txTkRVMk56ZzVPa05FUlVaSFNFbEtVMVJWVmxkWVdWcGpaR1ZtWjJocGFuTjBkWFozZUhsNmc0U0Zob2VJaVlxU2s1U1ZscGVZbVpxaW82U2xwcWVvcWFxeXM3UzF0cmU0dWJyQ3c4VEZ4c2ZJeWNyUzA5VFYxdGZZMmRyaDR1UGs1ZWJuNk9ucThmTHo5UFgyOS9qNSt2L0VBQjhCQUFNQkFRRUJBUUVCQVFFQUFBQUFBQUFCQWdNRUJRWUhDQWtLQy8vRUFMVVJBQUlCQWdRRUF3UUhCUVFFQUFFQ2R3QUJBZ01SQkFVaE1RWVNRVkVIWVhFVElqS0JDQlJDa2FHeHdRa2pNMUx3RldKeTBRb1dKRFRoSmZFWEdCa2FKaWNvS1NvMU5qYzRPVHBEUkVWR1IwaEpTbE5VVlZaWFdGbGFZMlJsWm1kb2FXcHpkSFYyZDNoNWVvS0RoSVdHaDRpSmlwS1RsSldXbDVpWm1xS2pwS1dtcDZpcHFyS3p0TFcydDdpNXVzTER4TVhHeDhqSnl0TFQxTlhXMTlqWjJ1TGo1T1htNStqcDZ2THo5UFgyOS9qNSt2L2FBQXdEQVFBQ0VRTVJBRDhBK3QrS0tQeG8vR2dBNzBZby9HajhhQURGSDRWZXNkQzFIVWwzV3RqY1hDZjM0NHlWL1BHS1crMEhVdE5YZGRXTnpicC9ma2pJWDg4WW9Bb2ZoUitGSDQwZmpRQWZoUitGSDQwZmpRQVVVVVVBRmVwZUFQaDVEOWxpMUxWWWhLOGczUTI3ajVWWHN6RHVUNmY1SEErRnRPWFZ2RVduMnJqTWNrbzNqMVVja2ZrRFgwTUJnWUhBb0FSVkNLRlVCVkhBQTZDbFpRd0trWkJHQ0RTMFVBZWMrUHZoM0JKYXk2bHBVUWltakJlVzNRWVZ4M0tqc2Zidi9QeXF2cHV2bnZ4ZnBxYVQ0bDFDMVFiWTBsSlVEc3JmTUIrUm9BeUtLS0tBQ2lpaWdEYThHWHE2ZjRwMDJlUWdJSlFwSjdCdmx6K3RmUVA0Vjh5RGcxN1A0QThjdzY1WnhXVjVJRTFLTWJmbVArdUE3ajM5UitOQUhhVWZoU1VVQUwrRmVBK09MMU5ROFdhbE5HUVU4M1lDTyswQmY2VjZiNDk4Y1E2Qlp5V2xySUpOU2tYYUFwejVRUDhBRWZmMEZlS2s1T1R5VFFBVVVVVUFINDBmalJVMW5hVFg5M0RiUUlYbWxZSWlqdVRRQmMwRHcvZWVJNzRXMW1tNDlYa2JoVUhxVFhzSGh6NGVhWG9DcEk4WXZic2NtYVlaQVA4QXNyMEg4L2V0SHd2NGNnOE02WEhheEFOSWZtbGx4eTdkejlQU3RpZ0EvR2svR2xvb0E1YnhKOFBkTDE5WGtXTVdkNDNQbndqR1QvdEwwUDhBUDNyeC9YL0Q5NTRjdmpiWGliVDFTUmVWY2VvTmZSRlpIaWp3NUI0bTB1UzFsQVdRZk5GTGpsRzdINmV0QUh6NStOSDQxTmVXazFoZHpXMDZGSm9uS01wN0VHb2FBQ3ZRZmhCb3d1ZFR1ZFJrWEsyeTdJOGorTnVwL0FmenJ6NnZhZmhSYUNEd21rZ0hNOHp1ZndPMy93QmxvQTdLaWlqOEtBQ2twYVNnQmFTajhLS0FQSnZpL293dHRUdHRSalhDM0s3Sk1mM2w2SDhSL0t2UHE5cCtLMXFKL0NieUVjd1RJNFAxTzMvMmF2RnFBUC9aXCI7XG4gICAgdmFyIENoYXREZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBjaGF0RGVmZXJyZWQ6IDAsXG4gICAgICAgIGlucHV0VGltZUZvcm1hdDogbnVsbCxcbiAgICAgICAgdGltZUZvcm1hdDogXCJEIE1NTSBoaDptbSBBXCIsXG4gICAgICAgIG5hbWU6IFwiSm9obiBEb2VcIixcbiAgICAgICAgYXZhdGFyOiBkZWZhdWx0QXZhdGFyLFxuICAgICAgICB3ZWxjb21lOiBudWxsLFxuICAgICAgICB3ZWxjb21lQXZhdGFyOiBkZWZhdWx0QXZhdGFyLFxuICAgICAgICB0aXRsZTogbnVsbCxcbiAgICAgICAgd2lkdGg6IFwiMTAwJVwiLFxuICAgICAgICBoZWlnaHQ6IFwiYXV0b1wiLFxuICAgICAgICBtZXNzYWdlczogbnVsbCxcbiAgICAgICAgc2VuZEJ1dHRvblRpdGxlOiBcIlNlbmRcIixcbiAgICAgICAgcmVhZG9ubHk6IGZhbHNlLFxuICAgICAgICBsb2NhbGU6IE1FVFJPX0xPQ0FMRSxcblxuICAgICAgICBjbHNDaGF0OiBcIlwiLFxuICAgICAgICBjbHNOYW1lOiBcIlwiLFxuICAgICAgICBjbHNUaW1lOiBcIlwiLFxuICAgICAgICBjbHNJbnB1dDogXCJcIixcbiAgICAgICAgY2xzU2VuZEJ1dHRvbjogXCJcIixcbiAgICAgICAgY2xzTWVzc2FnZUxlZnQ6IFwiZGVmYXVsdFwiLFxuICAgICAgICBjbHNNZXNzYWdlUmlnaHQ6IFwiZGVmYXVsdFwiLFxuXG4gICAgICAgIG9uTWVzc2FnZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25TZW5kOiBNZXRyby5ub29wLFxuICAgICAgICBvblNlbmRCdXR0b25DbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25DaGF0Q3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmNoYXRTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIENoYXREZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIENoYXREZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0NoYXRTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmNoYXRTZXR1cCh3aW5kb3dbXCJtZXRyb0NoYXRTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdjaGF0Jywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIENoYXREZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgaW5wdXQ6IG51bGwsXG4gICAgICAgICAgICAgICAgY2xhc3NlczogXCJwcmltYXJ5IHNlY29uZGFyeSBzdWNjZXNzIGFsZXJ0IHdhcm5pbmcgeWVsbG93IGluZm8gZGFyayBsaWdodFwiLnNwbGl0KFwiIFwiKSxcbiAgICAgICAgICAgICAgICBsYXN0TWVzc2FnZTogbnVsbFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiY2hhdC1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgbWVzc2FnZXMsIG1lc3NhZ2VJbnB1dCwgaW5wdXQ7XG4gICAgICAgICAgICB2YXIgY3VzdG9tQnV0dG9ucyA9IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGh0bWw6IG8uc2VuZEJ1dHRvblRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBjbHM6IG8uY2xzU2VuZEJ1dHRvbitcIiBqcy1jaGF0LXNlbmQtYnV0dG9uXCIsXG4gICAgICAgICAgICAgICAgICAgIG9uY2xpY2s6IG8ub25TZW5kQnV0dG9uQ2xpY2tcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwiY2hhdFwiKS5hZGRDbGFzcyhvLmNsc0NoYXQpO1xuXG4gICAgICAgICAgICBlbGVtZW50LmNzcyh7XG4gICAgICAgICAgICAgICAgd2lkdGg6IG8ud2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBvLmhlaWdodFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8udGl0bGUpKSB7XG4gICAgICAgICAgICAgICAgJChcIjxkaXY+XCIpLmFkZENsYXNzKFwidGl0bGVcIikuaHRtbChvLnRpdGxlKS5hcHBlbmRUbyhlbGVtZW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbWVzc2FnZXMgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJtZXNzYWdlc1wiKTtcbiAgICAgICAgICAgIG1lc3NhZ2VzLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgbWVzc2FnZUlucHV0ID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwibWVzc2FnZS1pbnB1dFwiKS5hcHBlbmRUbyhlbGVtZW50KTtcbiAgICAgICAgICAgIGlucHV0ID0gJChcIjxpbnB1dCB0eXBlPSd0ZXh0Jz5cIik7XG4gICAgICAgICAgICBpbnB1dC5hcHBlbmRUbyhtZXNzYWdlSW5wdXQpO1xuICAgICAgICAgICAgaW5wdXQuaW5wdXQoe1xuICAgICAgICAgICAgICAgIGN1c3RvbUJ1dHRvbnM6IGN1c3RvbUJ1dHRvbnMsXG4gICAgICAgICAgICAgICAgY2xzSW5wdXQ6IG8uY2xzSW5wdXRcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoby53ZWxjb21lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGQoe1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBvLndlbGNvbWUsXG4gICAgICAgICAgICAgICAgICAgIHRpbWU6IGRhdGV0aW1lKCksXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBcImxlZnRcIixcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJDaGF0IEJvdFwiLFxuICAgICAgICAgICAgICAgICAgICBhdmF0YXI6IG8ud2VsY29tZUF2YXRhclxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8ubWVzc2FnZXMpICYmIHR5cGVvZiBvLm1lc3NhZ2VzID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgby5tZXNzYWdlcyA9IFV0aWxzLmlzT2JqZWN0KG8ubWVzc2FnZXMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIVV0aWxzLmlzTnVsbChvLm1lc3NhZ2VzKSAmJiB0eXBlb2Ygby5tZXNzYWdlcyA9PT0gXCJvYmplY3RcIiAmJiBVdGlscy5vYmplY3RMZW5ndGgoby5tZXNzYWdlcykgPiAwKSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKG8ubWVzc2FnZXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuYWRkKHRoaXMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIubWVzc2FnZS1pbnB1dFwiKVtvLnJlYWRvbmx5ID8gJ2FkZENsYXNzJzoncmVtb3ZlQ2xhc3MnXShcImRpc2FibGVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgc2VuZEJ1dHRvbiA9IGVsZW1lbnQuZmluZChcIi5qcy1jaGF0LXNlbmQtYnV0dG9uXCIpO1xuICAgICAgICAgICAgdmFyIGlucHV0ID0gZWxlbWVudC5maW5kKFwiaW5wdXRbdHlwZT10ZXh0XVwiKTtcblxuICAgICAgICAgICAgdmFyIHNlbmQgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBtc2cgPSBcIlwiK2lucHV0LnZhbCgpLCBtO1xuICAgICAgICAgICAgICAgIGlmIChtc2cudHJpbSgpID09PSBcIlwiKSB7cmV0dXJuIGZhbHNlO31cbiAgICAgICAgICAgICAgICBtID0ge1xuICAgICAgICAgICAgICAgICAgICBpZDogVXRpbHMuZWxlbWVudElkKFwiY2hhdC1tZXNzYWdlXCIpLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBvLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGF2YXRhcjogby5hdmF0YXIsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IG1zZyxcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IFwicmlnaHRcIixcbiAgICAgICAgICAgICAgICAgICAgdGltZTogZGF0ZXRpbWUoKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdGhhdC5hZGQobSk7XG4gICAgICAgICAgICAgICAgaW5wdXQudmFsKFwiXCIpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInNlbmRcIiwge1xuICAgICAgICAgICAgICAgICAgICBtc2c6IG1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpbnB1dC5mb2N1cygpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2VuZEJ1dHRvbi5vbihNZXRyby5ldmVudHMuY2xpY2ssIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBzZW5kKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaW5wdXQub24oTWV0cm8uZXZlbnRzLmtleXVwLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBNZXRyby5rZXlDb2RlLkVOVEVSKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbmQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuXG4gICAgICAgIGFkZDogZnVuY3Rpb24obXNnKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBtZXNzYWdlLCBzZW5kZXIsIHRpbWUsIGl0ZW0sIGF2YXRhciwgdGV4dDtcbiAgICAgICAgICAgIHZhciBtZXNzYWdlcyA9IGVsZW1lbnQuZmluZChcIi5tZXNzYWdlc1wiKTtcbiAgICAgICAgICAgIHZhciBtZXNzYWdlRGF0ZTtcblxuICAgICAgICAgICAgbWVzc2FnZURhdGUgPSBvLmlucHV0VGltZUZvcm1hdCA/IERhdGV0aW1lLmZyb20obXNnLnRpbWUsIG8uaW5wdXRUaW1lRm9ybWF0LCBvLmxvY2FsZSkgOiBkYXRldGltZShtc2cudGltZSk7XG5cbiAgICAgICAgICAgIG1lc3NhZ2UgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJtZXNzYWdlXCIpLmFkZENsYXNzKG1zZy5wb3NpdGlvbikuYXBwZW5kVG8obWVzc2FnZXMpO1xuICAgICAgICAgICAgaXRlbSA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcIm1lc3NhZ2UtaXRlbVwiKS5hcHBlbmRUbyhtZXNzYWdlKTtcbiAgICAgICAgICAgIGF2YXRhciA9ICQoXCI8aW1nPlwiKS5hdHRyKFwic3JjXCIsIG1zZy5hdmF0YXIpLmFkZENsYXNzKFwibWVzc2FnZS1hdmF0YXJcIikuYXBwZW5kVG8oaXRlbSk7XG4gICAgICAgICAgICB0ZXh0ID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwibWVzc2FnZS10ZXh0XCIpLmFwcGVuZCgkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJtZXNzYWdlLXRleHQtaW5uZXJcIikuaHRtbChDYWtlLmVzY2FwZUh0bWwobXNnLnRleHQpKSkuYXBwZW5kVG8oaXRlbSk7XG4gICAgICAgICAgICB0aW1lID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwibWVzc2FnZS10aW1lXCIpLmFkZENsYXNzKG8uY2xzVGltZSkudGV4dChtZXNzYWdlRGF0ZS5mb3JtYXQoby50aW1lRm9ybWF0KSkuYXBwZW5kVG8odGV4dCk7XG4gICAgICAgICAgICBzZW5kZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJtZXNzYWdlLXNlbmRlclwiKS5hZGRDbGFzcyhvLmNsc05hbWUpLnRleHQobXNnLm5hbWUpLmFwcGVuZFRvKHRleHQpO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShtc2cuaWQpKSB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZS5hdHRyKFwiaWRcIiwgbXNnLmlkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG1zZy5wb3NpdGlvbiA9PT0gJ2xlZnQnICYmIFV0aWxzLmlzVmFsdWUoby5jbHNNZXNzYWdlTGVmdCkpIHtcbiAgICAgICAgICAgICAgICB0ZXh0LmFkZENsYXNzKG8uY2xzTWVzc2FnZUxlZnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1zZy5wb3NpdGlvbiA9PT0gJ3JpZ2h0JyAmJiBVdGlscy5pc1ZhbHVlKG8uY2xzTWVzc2FnZVJpZ2h0KSkge1xuICAgICAgICAgICAgICAgIHRleHQuYWRkQ2xhc3Moby5jbHNNZXNzYWdlUmlnaHQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5sYXN0TWVzc2FnZSAmJiB0aGlzLmxhc3RNZXNzYWdlLnBvc2l0aW9uID09PSBtc2cucG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICB0ZXh0LmFkZENsYXNzKFwiLS1uZXh0XCIpO1xuICAgICAgICAgICAgICAgIGF2YXRhci52aXNpYmxlKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBzZW5kZXIuaGlkZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJtZXNzYWdlXCIsIHtcbiAgICAgICAgICAgICAgICBtc2c6IG1zZyxcbiAgICAgICAgICAgICAgICBlbDoge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLFxuICAgICAgICAgICAgICAgICAgICBzZW5kZXI6IHNlbmRlcixcbiAgICAgICAgICAgICAgICAgICAgdGltZTogdGltZSxcbiAgICAgICAgICAgICAgICAgICAgaXRlbTogaXRlbSxcbiAgICAgICAgICAgICAgICAgICAgYXZhdGFyOiBhdmF0YXIsXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbWVzc2FnZXMuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IG1lc3NhZ2VzWzBdLnNjcm9sbEhlaWdodFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZHVyOiAxMDAwXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5sYXN0TWVzc2FnZSA9IG1zZztcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYWRkTWVzc2FnZXM6IGZ1bmN0aW9uKG1lc3NhZ2VzKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUobWVzc2FnZXMpICYmIHR5cGVvZiBtZXNzYWdlcyA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIG1lc3NhZ2VzID0gVXRpbHMuaXNPYmplY3QobWVzc2FnZXMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2VzID09PSBcIm9iamVjdFwiICYmIFV0aWxzLm9iamVjdExlbmd0aChtZXNzYWdlcykgPiAwKSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKG1lc3NhZ2VzLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmFkZCh0aGlzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVsTWVzc2FnZTogZnVuY3Rpb24oaWQpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5tZXNzYWdlc1wiKS5maW5kKFwiI1wiK2lkKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdXBkTWVzc2FnZTogZnVuY3Rpb24obXNnKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBlbGVtZW50LmZpbmQoXCIubWVzc2FnZXNcIikuZmluZChcIiNcIittc2cuaWQpO1xuXG4gICAgICAgICAgICBpZiAobWVzc2FnZS5sZW5ndGggPT09IDApIHJldHVybiB0aGlzO1xuXG4gICAgICAgICAgICBtZXNzYWdlLmZpbmQoXCIubWVzc2FnZS10ZXh0XCIpLmh0bWwobXNnLnRleHQpO1xuICAgICAgICAgICAgbWVzc2FnZS5maW5kKFwiLm1lc3NhZ2UtdGltZVwiKS5odG1sKG1zZy50aW1lKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xlYXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBtZXNzYWdlcyA9IGVsZW1lbnQuZmluZChcIi5tZXNzYWdlc1wiKTtcbiAgICAgICAgICAgIG1lc3NhZ2VzLmh0bWwoXCJcIik7XG4gICAgICAgICAgICB0aGlzLmxhc3RNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGVSZWFkb25seTogZnVuY3Rpb24ocmVhZG9ubHkpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICBvLnJlYWRvbmx5ID0gdHlwZW9mIHJlYWRvbmx5ID09PSBcInVuZGVmaW5lZFwiID8gIW8ucmVhZG9ubHkgOiByZWFkb25seTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5tZXNzYWdlLWlucHV0XCIpW28ucmVhZG9ubHkgPyAnYWRkQ2xhc3MnOidyZW1vdmVDbGFzcyddKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgICAgIHN3aXRjaCAoYXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLXJlYWRvbmx5XCI6IHRoaXMudG9nZ2xlUmVhZG9ubHkoKTsgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIHNlbmRCdXR0b24gPSBlbGVtZW50LmZpbmQoXCIuanMtY2hhdC1zZW5kLWJ1dHRvblwiKTtcbiAgICAgICAgICAgIHZhciBpbnB1dCA9IGVsZW1lbnQuZmluZChcImlucHV0W3R5cGU9dGV4dF1cIik7XG5cbiAgICAgICAgICAgIHNlbmRCdXR0b24ub2ZmKE1ldHJvLmV2ZW50cy5jbGljayk7XG4gICAgICAgICAgICBpbnB1dC5vZmYoTWV0cm8uZXZlbnRzLmtleXVwKTtcblxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIE1ldHJvLmRlZmF1bHRzLkNoYXQgPSBDaGF0RGVmYXVsdENvbmZpZztcbiAgICBNZXRyby5kZWZhdWx0cy5DaGF0QXZhdGFyID0gZGVmYXVsdEF2YXRhcjtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBDaGVja2JveERlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGNoZWNrYm94RGVmZXJyZWQ6IDAsXG4gICAgICAgIHRyYW5zaXRpb246IHRydWUsXG4gICAgICAgIHN0eWxlOiAxLFxuICAgICAgICBjYXB0aW9uOiBcIlwiLFxuICAgICAgICBjYXB0aW9uUG9zaXRpb246IFwicmlnaHRcIixcbiAgICAgICAgaW5kZXRlcm1pbmF0ZTogZmFsc2UsXG4gICAgICAgIGNsc0NoZWNrYm94OiBcIlwiLFxuICAgICAgICBjbHNDaGVjazogXCJcIixcbiAgICAgICAgY2xzQ2FwdGlvbjogXCJcIixcbiAgICAgICAgb25DaGVja2JveENyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5jaGVja2JveFNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgQ2hlY2tib3hEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIENoZWNrYm94RGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9DaGVja2JveFNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8uY2hlY2tib3hTZXR1cCh3aW5kb3dbXCJtZXRyb0NoZWNrYm94U2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnY2hlY2tib3gnLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgQ2hlY2tib3hEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgb3JpZ2luOiB7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJcIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImNoZWNrYm94LWNyZWF0ZVwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlU3RydWN0dXJlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY2hlY2tib3g7XG4gICAgICAgICAgICB2YXIgY2hlY2sgPSAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwiY2hlY2tcIik7XG4gICAgICAgICAgICB2YXIgY2FwdGlvbiA9ICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJjYXB0aW9uXCIpLmh0bWwoby5jYXB0aW9uKTtcblxuICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwidHlwZVwiLCBcImNoZWNrYm94XCIpO1xuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5hdHRyKFwicmVhZG9ubHlcIikgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQub24oXCJjbGlja1wiLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNoZWNrYm94ID0gZWxlbWVudFxuICAgICAgICAgICAgICAgIC53cmFwKFwiPGxhYmVsPlwiKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcImNoZWNrYm94IFwiICsgZWxlbWVudFswXS5jbGFzc05hbWUpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKG8uc3R5bGUgPT09IDIgPyBcInN0eWxlMlwiIDogXCJcIik7XG5cbiAgICAgICAgICAgIGNoZWNrLmFwcGVuZFRvKGNoZWNrYm94KTtcbiAgICAgICAgICAgIGNhcHRpb24uYXBwZW5kVG8oY2hlY2tib3gpO1xuXG4gICAgICAgICAgICBpZiAoby50cmFuc2l0aW9uID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgY2hlY2tib3guYWRkQ2xhc3MoXCJ0cmFuc2l0aW9uLW9uXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5jYXB0aW9uUG9zaXRpb24gPT09ICdsZWZ0Jykge1xuICAgICAgICAgICAgICAgIGNoZWNrYm94LmFkZENsYXNzKFwiY2FwdGlvbi1sZWZ0XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLm9yaWdpbi5jbGFzc05hbWUgPSBlbGVtZW50WzBdLmNsYXNzTmFtZTtcbiAgICAgICAgICAgIGVsZW1lbnRbMF0uY2xhc3NOYW1lID0gJyc7XG5cbiAgICAgICAgICAgIGNoZWNrYm94LmFkZENsYXNzKG8uY2xzQ2hlY2tib3gpO1xuICAgICAgICAgICAgY2FwdGlvbi5hZGRDbGFzcyhvLmNsc0NhcHRpb24pO1xuICAgICAgICAgICAgY2hlY2suYWRkQ2xhc3Moby5jbHNDaGVjayk7XG5cbiAgICAgICAgICAgIGlmIChvLmluZGV0ZXJtaW5hdGUpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50WzBdLmluZGV0ZXJtaW5hdGUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5pcygnOmRpc2FibGVkJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmFibGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIGNoZWNrID0gZWxlbWVudC5zaWJsaW5ncyhcIi5jaGVja1wiKTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihcImZvY3VzXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgY2hlY2suYWRkQ2xhc3MoXCJmb2N1c2VkXCIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oXCJibHVyXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgY2hlY2sucmVtb3ZlQ2xhc3MoXCJmb2N1c2VkXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5kZXRlcm1pbmF0ZTogZnVuY3Rpb24odil7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgdiA9IFV0aWxzLmlzTnVsbCh2KSA/IHRydWUgOiBVdGlscy5ib29sKHYpO1xuXG4gICAgICAgICAgICBlbGVtZW50WzBdLmluZGV0ZXJtaW5hdGUgPSB2O1xuICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwiZGF0YS1pbmRldGVybWluYXRlXCIsIHYpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRpc2FibGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnBhcmVudCgpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZW5hYmxlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmRhdGEoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50KCkucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGVTdGF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmVsZW0uZGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmFibGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKHYpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIHRoaXMuaW5kZXRlcm1pbmF0ZShmYWxzZSk7XG5cbiAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZSh2KSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQucHJvcChcImNoZWNrZWRcIiwgIVV0aWxzLmJvb2woZWxlbWVudC5wcm9wKFwiY2hlY2tlZFwiKSkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodiA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmRldGVybWluYXRlKHRydWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucHJvcChcImNoZWNrZWRcIiwgdiA9PT0gMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHBhcmVudCA9IGVsZW1lbnQucGFyZW50KCk7XG5cbiAgICAgICAgICAgIHZhciBjaGFuZ2VTdHlsZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIG5ld19zdHlsZSA9IHBhcnNlSW50KGVsZW1lbnQuYXR0cihcImRhdGEtc3R5bGVcIikpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFVdGlscy5pc0ludChuZXdfc3R5bGUpKSByZXR1cm47XG5cbiAgICAgICAgICAgICAgICBvLnN0eWxlID0gbmV3X3N0eWxlO1xuICAgICAgICAgICAgICAgIHBhcmVudC5yZW1vdmVDbGFzcyhcInN0eWxlMSBzdHlsZTJcIikuYWRkQ2xhc3MoXCJzdHlsZVwiK25ld19zdHlsZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgaW5kZXRlcm1pbmF0ZVN0YXRlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBlbGVtZW50WzBdLmluZGV0ZXJtaW5hdGUgPSBKU09OLnBhcnNlKGVsZW1lbnQuYXR0cihcImRhdGEtaW5kZXRlcm1pbmF0ZVwiKSkgPT09IHRydWU7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdkaXNhYmxlZCc6IHRoaXMudG9nZ2xlU3RhdGUoKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnZGF0YS1pbmRldGVybWluYXRlJzogaW5kZXRlcm1pbmF0ZVN0YXRlKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2RhdGEtc3R5bGUnOiBjaGFuZ2VTdHlsZSgpOyBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihcImZvY3VzXCIpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoXCJibHVyXCIpO1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBDbG9ja0RlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGNsb2NrRGVmZXJyZWQ6IDAsXG4gICAgICAgIHNob3dUaW1lOiB0cnVlLFxuICAgICAgICBzaG93RGF0ZTogdHJ1ZSxcbiAgICAgICAgdGltZUZvcm1hdDogJzI0JyxcbiAgICAgICAgZGF0ZUZvcm1hdDogJ2FtZXJpY2FuJyxcbiAgICAgICAgZGl2aWRlcjogXCImbmJzcDsmbmJzcDtcIixcbiAgICAgICAgbGVhZGluZ1plcm86IHRydWUsXG4gICAgICAgIGRhdGVEaXZpZGVyOiAnLScsXG4gICAgICAgIHRpbWVEaXZpZGVyOiBcIjpcIixcbiAgICAgICAgb25UaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvblNlY29uZDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25DbG9ja0NyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5jbG9ja1NldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgQ2xvY2tEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIENsb2NrRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9DbG9ja1NldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8uY2xvY2tTZXR1cCh3aW5kb3dbXCJtZXRyb0Nsb2NrU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnY2xvY2snLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgQ2xvY2tEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgX2Nsb2NrSW50ZXJ2YWw6IG51bGxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoJ2Nsb2NrLWNyZWF0ZScsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5fdGljaygpO1xuXG4gICAgICAgICAgICB0aGlzLl9jbG9ja0ludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0Ll90aWNrKCk7XG4gICAgICAgICAgICB9LCA1MDApO1xuICAgICAgICAgICAgdGhpcy5fc2Vjb25kSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuX3NlY29uZCgpO1xuICAgICAgICAgICAgfSwgMTAwMCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2FkZExlYWRpbmdaZXJvOiBmdW5jdGlvbihpKXtcbiAgICAgICAgICAgIGlmIChpPDEwKXtpPVwiMFwiICsgaTt9XG4gICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgfSxcblxuICAgICAgICBfc2Vjb25kOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRpbWVzdGFtcCA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudCgnc2Vjb25kJywge1xuICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wXG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuXG4gICAgICAgIF90aWNrOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBcIlwiO1xuICAgICAgICAgICAgdmFyIGggPSB0aW1lc3RhbXAuZ2V0SG91cnMoKSxcbiAgICAgICAgICAgICAgICBpID0gdGltZXN0YW1wLmdldE1pbnV0ZXMoKSxcbiAgICAgICAgICAgICAgICBzID0gdGltZXN0YW1wLmdldFNlY29uZHMoKSxcbiAgICAgICAgICAgICAgICBkID0gdGltZXN0YW1wLmdldERhdGUoKSxcbiAgICAgICAgICAgICAgICBtID0gdGltZXN0YW1wLmdldE1vbnRoKCkgKyAxLFxuICAgICAgICAgICAgICAgIHkgPSB0aW1lc3RhbXAuZ2V0RnVsbFllYXIoKSxcbiAgICAgICAgICAgICAgICBhID0gJyc7XG5cbiAgICAgICAgICAgIGlmIChwYXJzZUludChvLnRpbWVGb3JtYXQpID09PSAxMikge1xuICAgICAgICAgICAgICAgIGEgPSBcIiBBTVwiO1xuICAgICAgICAgICAgICAgIGlmIChoID4gMTEpIHsgYSA9IFwiIFBNXCI7IH1cbiAgICAgICAgICAgICAgICBpZiAoaCA+IDEyKSB7IGggPSBoIC0gMTI7IH1cbiAgICAgICAgICAgICAgICBpZiAoaCA9PT0gMCkgeyBoID0gMTI7IH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaSA9IHRoaXMuX2FkZExlYWRpbmdaZXJvKGkpO1xuICAgICAgICAgICAgcyA9IHRoaXMuX2FkZExlYWRpbmdaZXJvKHMpO1xuXG4gICAgICAgICAgICBpZiAoby5sZWFkaW5nWmVybykge1xuICAgICAgICAgICAgICAgIGggPSB0aGlzLl9hZGRMZWFkaW5nWmVybyhoKTtcbiAgICAgICAgICAgICAgICBtID0gdGhpcy5fYWRkTGVhZGluZ1plcm8obSk7XG4gICAgICAgICAgICAgICAgZCA9IHRoaXMuX2FkZExlYWRpbmdaZXJvKGQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5zaG93RGF0ZSkge1xuICAgICAgICAgICAgICAgIGlmIChvLmRhdGVGb3JtYXQgPT09ICdhbWVyaWNhbicpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiPHNwYW4gY2xhc3M9J2RhdGUtbW9udGgnPlwiICsgbSArIFwiPC9zcGFuPlwiO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gXCI8c3BhbiBjbGFzcz0nZGF0ZS1kaXZpZGVyJz5cIiArIG8uZGF0ZURpdmlkZXIgKyBcIjwvc3Bhbj5cIjtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiPHNwYW4gY2xhc3M9J2RhdGUtZGF5Jz5cIiArIGQgKyBcIjwvc3Bhbj5cIjtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiPHNwYW4gY2xhc3M9J2RhdGUtZGl2aWRlcic+XCIgKyBvLmRhdGVEaXZpZGVyICsgXCI8L3NwYW4+XCI7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIjxzcGFuIGNsYXNzPSdkYXRlLXllYXInPlwiICsgeSArIFwiPC9zcGFuPlwiO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIjxzcGFuIGNsYXNzPSdkYXRlLWRheSc+XCIgKyBkICsgXCI8L3NwYW4+XCI7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIjxzcGFuIGNsYXNzPSdkYXRlLWRpdmlkZXInPlwiICsgby5kYXRlRGl2aWRlciArIFwiPC9zcGFuPlwiO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gXCI8c3BhbiBjbGFzcz0nZGF0ZS1tb250aCc+XCIgKyBtICsgXCI8L3NwYW4+XCI7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIjxzcGFuIGNsYXNzPSdkYXRlLWRpdmlkZXInPlwiICsgby5kYXRlRGl2aWRlciArIFwiPC9zcGFuPlwiO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gXCI8c3BhbiBjbGFzcz0nZGF0ZS15ZWFyJz5cIiArIHkgKyBcIjwvc3Bhbj5cIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IG8uZGl2aWRlcjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uc2hvd1RpbWUpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gXCI8c3BhbiBjbGFzcz0nY2xvY2staG91cic+XCIgKyBoICsgXCI8L3NwYW4+XCI7XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiPHNwYW4gY2xhc3M9J2Nsb2NrLWRpdmlkZXInPlwiICsgby50aW1lRGl2aWRlciArIFwiPC9zcGFuPlwiO1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIjxzcGFuIGNsYXNzPSdjbG9jay1taW51dGUnPlwiICsgaSArIFwiPC9zcGFuPlwiO1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIjxzcGFuIGNsYXNzPSdjbG9jay1kaXZpZGVyJz5cIiArIG8udGltZURpdmlkZXIgKyBcIjwvc3Bhbj5cIjtcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gXCI8c3BhbiBjbGFzcz0nY2xvY2stc2Vjb25kJz5cIiArIHMgKyBcIjwvc3Bhbj5cIjtcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gXCI8c3BhbiBjbGFzcz0nY2xvY2stc3VmZml4Jz5cIiArIGEgKyBcIjwvc3Bhbj5cIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5odG1sKHJlc3VsdCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudCgndGljaycsIHtcbiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcblxuICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgKi9cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLl9jbG9ja0ludGVydmFsKTtcbiAgICAgICAgICAgIHRoaXMuX2Nsb2NrSW50ZXJ2YWwgPSBudWxsO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIENvbGxhcHNlRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgY29sbGFwc2VEZWZlcnJlZDogMCxcbiAgICAgICAgY29sbGFwc2VkOiBmYWxzZSxcbiAgICAgICAgdG9nZ2xlRWxlbWVudDogZmFsc2UsXG4gICAgICAgIGR1cmF0aW9uOiAxMDAsXG4gICAgICAgIG9uRXhwYW5kOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNvbGxhcHNlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNvbGxhcHNlQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmNvbGxhcHNlU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBDb2xsYXBzZURlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgQ29sbGFwc2VEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0NvbGxhcHNlU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5jb2xsYXBzZVNldHVwKHdpbmRvd1tcIm1ldHJvQ29sbGFwc2VTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdjb2xsYXBzZScsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBDb2xsYXBzZURlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICB0b2dnbGU6IG51bGxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHRvZ2dsZTtcblxuICAgICAgICAgICAgdG9nZ2xlID0gby50b2dnbGVFbGVtZW50ICE9PSBmYWxzZSA/ICQoby50b2dnbGVFbGVtZW50KSA6IGVsZW1lbnQuc2libGluZ3MoJy5jb2xsYXBzZS10b2dnbGUnKS5sZW5ndGggPiAwID8gZWxlbWVudC5zaWJsaW5ncygnLmNvbGxhcHNlLXRvZ2dsZScpIDogZWxlbWVudC5zaWJsaW5ncygnYTpudGgtY2hpbGQoMSknKTtcblxuICAgICAgICAgICAgaWYgKG8uY29sbGFwc2VkID09PSB0cnVlIHx8IGVsZW1lbnQuYXR0cihcImNvbGxhcHNlZFwiKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuaGlkZSgwKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdG9nZ2xlLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuY3NzKCdkaXNwbGF5JykgPT09ICdibG9jaycgJiYgIWVsZW1lbnQuaGFzQ2xhc3MoJ2tlZXAtb3BlbicpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2Nsb3NlKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX29wZW4oZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKFtcIklOUFVUXCJdLmluZGV4T2YoZS50YXJnZXQudGFnTmFtZSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLnRvZ2dsZSA9IHRvZ2dsZTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiY29sbGFwc2UtY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY2xvc2U6IGZ1bmN0aW9uKGVsLCBpbW1lZGlhdGUpe1xuICAgICAgICAgICAgdmFyIGVsZW0gPSAkKGVsKTtcbiAgICAgICAgICAgIHZhciBkcm9wZG93biAgPSBNZXRyby5nZXRQbHVnaW4oZWxlbVswXSwgXCJjb2xsYXBzZVwiKTtcbiAgICAgICAgICAgIHZhciBvcHRpb25zID0gZHJvcGRvd24ub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBmdW5jID0gaW1tZWRpYXRlID8gJ3Nob3cnIDogJ3NsaWRlVXAnO1xuICAgICAgICAgICAgdmFyIGR1ciA9IGltbWVkaWF0ZSA/IDAgOiBvcHRpb25zLmR1cmF0aW9uO1xuXG4gICAgICAgICAgICB0aGlzLnRvZ2dsZS5yZW1vdmVDbGFzcyhcImFjdGl2ZS10b2dnbGVcIik7XG5cbiAgICAgICAgICAgIGVsZW1bZnVuY10oZHVyLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGVsLnRyaWdnZXIoXCJvbkNvbGxhcHNlXCIsIG51bGwsIGVsKTtcbiAgICAgICAgICAgICAgICBlbC5kYXRhKFwiY29sbGFwc2VkXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIGVsLmFkZENsYXNzKFwiY29sbGFwc2VkXCIpO1xuXG4gICAgICAgICAgICAgICAgZHJvcGRvd24uX2ZpcmVFdmVudChcImNvbGxhcHNlXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX29wZW46IGZ1bmN0aW9uKGVsLCBpbW1lZGlhdGUpe1xuICAgICAgICAgICAgdmFyIGVsZW0gPSAkKGVsKTtcbiAgICAgICAgICAgIHZhciBkcm9wZG93biAgPSBNZXRyby5nZXRQbHVnaW4oZWxlbVswXSwgXCJjb2xsYXBzZVwiKTtcbiAgICAgICAgICAgIHZhciBvcHRpb25zID0gZHJvcGRvd24ub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBmdW5jID0gaW1tZWRpYXRlID8gJ3Nob3cnIDogJ3NsaWRlRG93bic7XG4gICAgICAgICAgICB2YXIgZHVyID0gaW1tZWRpYXRlID8gMCA6IG9wdGlvbnMuZHVyYXRpb247XG5cbiAgICAgICAgICAgIHRoaXMudG9nZ2xlLmFkZENsYXNzKFwiYWN0aXZlLXRvZ2dsZVwiKTtcblxuICAgICAgICAgICAgZWxlbVtmdW5jXShkdXIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgZWwudHJpZ2dlcihcIm9uRXhwYW5kXCIsIG51bGwsIGVsKTtcbiAgICAgICAgICAgICAgICBlbC5kYXRhKFwiY29sbGFwc2VkXCIsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICBlbC5yZW1vdmVDbGFzcyhcImNvbGxhcHNlZFwiKTtcblxuICAgICAgICAgICAgICAgIGRyb3Bkb3duLl9maXJlRXZlbnQoXCJleHBhbmRcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjb2xsYXBzZTogZnVuY3Rpb24oaW1tZWRpYXRlKXtcbiAgICAgICAgICAgIHRoaXMuX2Nsb3NlKHRoaXMuZWxlbWVudCwgaW1tZWRpYXRlKTtcbiAgICAgICAgfSxcblxuICAgICAgICBleHBhbmQ6IGZ1bmN0aW9uKGltbWVkaWF0ZSl7XG4gICAgICAgICAgICB0aGlzLl9vcGVuKHRoaXMuZWxlbWVudCwgaW1tZWRpYXRlKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjbG9zZTogZnVuY3Rpb24oaW1tZWRpYXRlKXtcbiAgICAgICAgICAgIHRoaXMuX2Nsb3NlKHRoaXMuZWxlbWVudCwgaW1tZWRpYXRlKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvcGVuOiBmdW5jdGlvbihpbW1lZGlhdGUpe1xuICAgICAgICAgICAgdGhpcy5fb3Blbih0aGlzLmVsZW1lbnQsIGltbWVkaWF0ZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNDb2xsYXBzZWQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmRhdGEoXCJjb2xsYXBzZWRcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlU3RhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIGlmIChlbGVtZW50LmF0dHIoXCJjb2xsYXBzZWRcIikgPT09IHRydWUgfHwgZWxlbWVudC5kYXRhKFwiY29sbGFwc2VkXCIpID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb2xsYXBzZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmV4cGFuZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSl7XG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiY29sbGFwc2VkXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtY29sbGFwc2VkXCI6IHRoaXMudG9nZ2xlU3RhdGUoKTsgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlLm9mZihNZXRyby5ldmVudHMuY2xpY2spO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgQ29sb3JQaWNrZXJEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBkdXJhdGlvbjogMTAwLFxuICAgICAgICBwcmVwZW5kOiBcIlwiLFxuICAgICAgICBhcHBlbmQ6IFwiXCIsXG4gICAgICAgIGNsZWFyQnV0dG9uOiBmYWxzZSxcbiAgICAgICAgY2xlYXJCdXR0b25JY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tY3Jvc3MnPjwvc3Bhbj5cIixcbiAgICAgICAgcGlja2VyQnV0dG9uSWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLWVxdWFsaXplcic+PC9zcGFuPlwiLFxuICAgICAgICBkZWZhdWx0VmFsdWU6IFwicmdiYSgwLCAwLCAwLCAwKVwiLFxuICAgICAgICBjb3B5SW5saW5lU3R5bGVzOiBmYWxzZSxcbiAgICAgICAgY2xzUGlja2VyQnV0dG9uOiBcIlwiLFxuICAgICAgICBjbHNDbGVhckJ1dHRvbjogXCJcIixcbiAgICAgICAgb25Db2xvclNlbGVjdGVkOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNvbG9yUGlja2VyQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmNvbG9yUGlja2VyU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBDb2xvclBpY2tlckRlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgQ29sb3JQaWNrZXJEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0NvbG9yUGlja2VyU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5jb2xvclBpY2tlclNldHVwKHdpbmRvd1tcIm1ldHJvQ29sb3JQaWNrZXJTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdjb2xvci1waWNrZXInLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgJC5leHRlbmQoe30sIE1ldHJvLmRlZmF1bHRzLkNvbG9yU2VsZWN0b3IsIHtcbiAgICAgICAgICAgICAgICBzaG93VXNlckNvbG9yczogZmFsc2UsXG4gICAgICAgICAgICAgICAgc2hvd1ZhbHVlczogXCJcIlxuICAgICAgICAgICAgfSwgQ29sb3JQaWNrZXJEZWZhdWx0Q29uZmlnKSwge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBudWxsLFxuICAgICAgICAgICAgICAgIHBpY2tlcjogbnVsbCxcbiAgICAgICAgICAgICAgICBjb2xvclNlbGVjdG9yOiBudWxsLFxuICAgICAgICAgICAgICAgIGNvbG9yU2VsZWN0b3JCb3g6IG51bGwsXG4gICAgICAgICAgICAgICAgY29sb3JFeGFtcGxlOiBudWxsLFxuICAgICAgICAgICAgICAgIGlucHV0SW50ZXJ2YWw6IG51bGwsXG4gICAgICAgICAgICAgICAgaXNPcGVuOiBmYWxzZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY3VycmVudCA9IGVsZW1lbnQudmFsKCk7XG5cbiAgICAgICAgICAgIGlmICghTWV0cm8ucGx1Z2luRXhpc3RzKFwiY29sb3Itc2VsZWN0b3JcIikpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb2xvciBzZWxlY3RvciBjb21wb25lbnQgcmVxdWlyZWQhXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gTWV0cm8uY29sb3JzLmlzQ29sb3IoY3VycmVudCkgPyBjdXJyZW50IDogTWV0cm8uY29sb3JzLmlzQ29sb3Ioby5kZWZhdWx0VmFsdWUpID8gby5kZWZhdWx0VmFsdWUgOiBcInJnYmEoMCwwLDAsMClcIjtcblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KCdjb2xvci1waWNrZXItY3JlYXRlJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVN0cnVjdHVyZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBwaWNrZXIgPSBlbGVtZW50LndyYXAoICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImNvbG9yLXBpY2tlclwiKS5hZGRDbGFzcyhlbGVtZW50WzBdLmNsYXNzTmFtZSkgKTtcbiAgICAgICAgICAgIHZhciBidXR0b25zLCBjb2xvckV4YW1wbGUsIGNvbG9yU2VsZWN0b3IsIGNvbG9yU2VsZWN0b3JCb3g7XG5cbiAgICAgICAgICAgIGNvbG9yRXhhbXBsZSA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImNvbG9yLWV4YW1wbGUtYm94XCIpLmluc2VydEJlZm9yZShlbGVtZW50KTtcblxuICAgICAgICAgICAgYnV0dG9ucyA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImJ1dHRvbnNcIikuYXBwZW5kVG8ocGlja2VyKTtcblxuICAgICAgICAgICAgYnV0dG9ucy5hcHBlbmQoXG4gICAgICAgICAgICAgICAgJChcIjxidXR0b24+XCIpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcImJ1dHRvbiBjb2xvci1waWNrZXItYnV0dG9uXCIpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhvLmNsc1BpY2tlckJ1dHRvbilcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0YWJpbmRleFwiLCAtMSlcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpXG4gICAgICAgICAgICAgICAgICAgIC5odG1sKG8ucGlja2VyQnV0dG9uSWNvbilcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmIChvLmNsZWFyQnV0dG9uID09PSB0cnVlICYmICFlbGVtZW50WzBdLnJlYWRPbmx5KSB7XG4gICAgICAgICAgICAgICAgYnV0dG9ucy5hcHBlbmQoXG4gICAgICAgICAgICAgICAgICAgICQoXCI8YnV0dG9uPlwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKFwiYnV0dG9uIGlucHV0LWNsZWFyLWJ1dHRvblwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKG8uY2xzQ2xlYXJCdXR0b24pXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRhYmluZGV4XCIsIC0xKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuaHRtbChvLmNsZWFyQnV0dG9uSWNvbilcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLnByZXBlbmQpKSB7XG4gICAgICAgICAgICAgICAgcGlja2VyLnByZXBlbmQoJChcIjxkaXY+XCIpLmFkZENsYXNzKFwicHJlcGVuZFwiKS5hZGRDbGFzcyhvLmNsc1ByZXBlbmQpLmh0bWwoby5wcmVwZW5kKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8uYXBwZW5kKSkge1xuICAgICAgICAgICAgICAgIHBpY2tlci5hcHBlbmQoJChcIjxkaXY+XCIpLmh0bWwoby5hcHBlbmQpLmFkZENsYXNzKFwiYXBwZW5kXCIpLmFkZENsYXNzKG8uY2xzQXBwZW5kKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbG9yU2VsZWN0b3JCb3ggPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJjb2xvci1zZWxlY3Rvci1ib3hcIikuYXBwZW5kVG8ocGlja2VyKTtcbiAgICAgICAgICAgIGNvbG9yU2VsZWN0b3IgPSAkKFwiPGRpdj5cIikuYXBwZW5kVG8oY29sb3JTZWxlY3RvckJveCk7XG5cbiAgICAgICAgICAgIHRoaXMucGlja2VyID0gcGlja2VyO1xuICAgICAgICAgICAgdGhpcy5jb2xvckV4YW1wbGUgPSBjb2xvckV4YW1wbGU7XG4gICAgICAgICAgICB0aGlzLmNvbG9yU2VsZWN0b3IgPSBjb2xvclNlbGVjdG9yO1xuICAgICAgICAgICAgdGhpcy5jb2xvclNlbGVjdG9yQm94ID0gY29sb3JTZWxlY3RvckJveDtcblxuICAgICAgICAgICAgTWV0cm8ubWFrZVBsdWdpbihjb2xvclNlbGVjdG9yLCAnY29sb3Itc2VsZWN0b3InLCB7XG4gICAgICAgICAgICAgICAgZGVmYXVsdFN3YXRjaGVzOiBvLmRlZmF1bHRTd2F0Y2hlcyxcbiAgICAgICAgICAgICAgICB1c2VyQ29sb3JzOiBvLnVzZXJDb2xvcnMsXG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsdWVUeXBlOiBvLnJldHVyblZhbHVlVHlwZSxcbiAgICAgICAgICAgICAgICByZXR1cm5Bc1N0cmluZzogby5yZXR1cm5Bc1N0cmluZyxcbiAgICAgICAgICAgICAgICBzaG93VmFsdWVzOiBvLnNob3dWYWx1ZXMsXG4gICAgICAgICAgICAgICAgc2hvd0FzU3RyaW5nOiBvLnNob3dBc1N0cmluZyxcbiAgICAgICAgICAgICAgICBzaG93VXNlckNvbG9yczogby5zaG93VXNlckNvbG9ycyxcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IG8udGFyZ2V0LFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgbG9jYWxlOiBvLmxvY2FsZSxcbiAgICAgICAgICAgICAgICBhZGRVc2VyQ29sb3JUaXRsZTogby5hZGRVc2VyQ29sb3JUaXRsZSxcbiAgICAgICAgICAgICAgICB1c2VyQ29sb3JzVGl0bGU6IG8udXNlckNvbG9yc1RpdGxlLFxuICAgICAgICAgICAgICAgIGhzbE1vZGU6IG8uaHNsTW9kZSxcbiAgICAgICAgICAgICAgICBzaG93QWxwaGFDaGFubmVsOiBvLnNob3dBbHBoYUNoYW5uZWwsXG4gICAgICAgICAgICAgICAgaW5wdXRUaHJlc2hvbGQ6IG8uaW5wdXRUaHJlc2hvbGQsXG4gICAgICAgICAgICAgICAgaW5pdENvbG9yOiB0aGlzLnZhbHVlLFxuICAgICAgICAgICAgICAgIHJlYWRvbmx5SW5wdXQ6IG8ucmVhZG9ubHlJbnB1dCxcbiAgICAgICAgICAgICAgICBjbHNTZWxlY3Rvcjogby5jbHNTZWxlY3RvcixcbiAgICAgICAgICAgICAgICBjbHNTd2F0Y2hlczogby5jbHNTd2F0Y2hlcyxcbiAgICAgICAgICAgICAgICBjbHNTd2F0Y2g6IG8uY2xzU3dhdGNoLFxuICAgICAgICAgICAgICAgIGNsc1ZhbHVlOiBvLmNsc1ZhbHVlLFxuICAgICAgICAgICAgICAgIGNsc0xhYmVsOiBvLmNsc0xhYmVsLFxuICAgICAgICAgICAgICAgIGNsc0lucHV0OiBvLmNsc0lucHV0LFxuICAgICAgICAgICAgICAgIGNsc1VzZXJDb2xvckJ1dHRvbjogby5jbHNVc2VyQ29sb3JCdXR0b24sXG4gICAgICAgICAgICAgICAgY2xzVXNlckNvbG9yczogby5jbHNVc2VyQ29sb3JzLFxuICAgICAgICAgICAgICAgIGNsc1VzZXJDb2xvcnNUaXRsZTogby5jbHNVc2VyQ29sb3JzVGl0bGUsXG4gICAgICAgICAgICAgICAgY2xzVXNlckNvbG9yOiBvLmNsc1VzZXJDb2xvcixcbiAgICAgICAgICAgICAgICBvbkNvbG9yOiBvLm9uQ29sb3IsXG4gICAgICAgICAgICAgICAgb25Db2xvclNlbGVjdG9yQ3JlYXRlOiBvLm9uQ29sb3JTZWxlY3RvckNyZWF0ZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIE1ldHJvLm1ha2VQbHVnaW4oY29sb3JTZWxlY3RvckJveCwgJ2Ryb3Bkb3duJywge1xuICAgICAgICAgICAgICAgIGRyb3BGaWx0ZXI6IFwiLmNvbG9yLXBpY2tlclwiLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBvLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgIHRvZ2dsZUVsZW1lbnQ6IFtwaWNrZXJdLFxuICAgICAgICAgICAgICAgIGNoZWNrRHJvcFVwOiB0cnVlLFxuICAgICAgICAgICAgICAgIG9uRHJvcDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKGNvbG9yU2VsZWN0b3IsICdjb2xvci1zZWxlY3RvcicpLnZhbCh0aGF0LnZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudFswXS5jbGFzc05hbWUgPSAnJztcblxuICAgICAgICAgICAgaWYgKG8uY29weUlubGluZVN0eWxlcyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICQuZWFjaChVdGlscy5nZXRJbmxpbmVTdHlsZXMoZWxlbWVudCksIGZ1bmN0aW9uKGtleSwgdmFsdWUpe1xuICAgICAgICAgICAgICAgICAgICBwaWNrZXIuY3NzKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9zZXRDb2xvcigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jbGVhcklucHV0SW50ZXJ2YWw6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW5wdXRJbnRlcnZhbCk7XG4gICAgICAgICAgICB0aGlzLmlucHV0SW50ZXJ2YWwgPSBmYWxzZTtcbiAgICAgICAgfSxcblxuICAgICAgICBfc2V0Q29sb3I6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgY29sb3JFeGFtcGxlID0gdGhpcy5jb2xvckV4YW1wbGU7XG4gICAgICAgICAgICB2YXIgY29sb3IgPSB0aGlzLnZhbHVlO1xuXG4gICAgICAgICAgICBpZiAodGhpcy52YWx1ZS5pbmRleE9mKFwiY215a1wiKSAhPT0gLTEgfHwgdGhpcy52YWx1ZS5pbmRleE9mKFwiaHN2XCIpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgIGNvbG9yID0gTWV0cm8uY29sb3JzLnRvSEVYKHRoaXMudmFsdWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb2xvckV4YW1wbGUuY3NzKHtcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGNvbG9yXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHBpY2tlciA9IHRoaXMucGlja2VyLFxuICAgICAgICAgICAgICAgIGNvbG9yU2VsZWN0b3IgPSB0aGlzLmNvbG9yU2VsZWN0b3IsXG4gICAgICAgICAgICAgICAgY29sb3JTZWxlY3RvckJveCA9IHRoaXMuY29sb3JTZWxlY3RvcjtcblxuICAgICAgICAgICAgcGlja2VyLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuaW5wdXQtY2xlYXItYnV0dG9uXCIsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQudmFsKG8uZGVmYXVsdFZhbHVlKS50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuICAgICAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbihjb2xvclNlbGVjdG9yLCAnY29sb3Itc2VsZWN0b3InKS52YWwoby5kZWZhdWx0VmFsdWUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmlucHV0Y2hhbmdlLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQudmFsdWUgPSB0aGlzLnZhbHVlO1xuICAgICAgICAgICAgICAgIHRoYXQuX3NldENvbG9yKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29sb3JTZWxlY3RvckJveC5vbihNZXRyby5ldmVudHMuY2xpY2ssIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuXG4gICAgICAgIHZhbDogZnVuY3Rpb24odil7XG4gICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCB8fCAhVXRpbHMuaXNWYWx1ZSh2KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIU1ldHJvLmNvbG9ycy5pc0NvbG9yKHYpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHY7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQudmFsKHYpLnRyaWdnZXIoXCJjaGFuZ2VcIik7XG4gICAgICAgICAgICB0aGlzLl9zZXRDb2xvcigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0ciwgbmV3VmFsdWUpe1xuICAgICAgICAvLyB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgICQoZG9jdW1lbnQpLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oKXtcbiAgICAgICAgJChcIi5jb2xvci1waWNrZXJcIikucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpO1xuICAgIH0pO1xuXG59KE1ldHJvLCBtNHEpKTtcblxyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHN1cHBvcnRlZENvbG9yVHlwZXMgPSBcImhleCwgcmdiLCByZ2JhLCBoc2wsIGhzbGEsIGhzdiwgY215a1wiO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBDb2xvclNlbGVjdG9yRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgZGVmYXVsdFN3YXRjaGVzOiBcIiNGRkZGRkYsIzAwMDAwMCwjRkZGQjBELCMwNTMyRkYsI0ZGOTMwMCwjMDBGOTFBLCNGRjI3MDAsIzY4Njg2OCwjRUU1NDY0LCNEMjdBRUUsIzVCQThDNCwjRTY0QUE5LCMxYmExZTIsIzZhMDBmZiwjYmViZWJlLCNmOGY4ZjhcIixcbiAgICAgICAgdXNlckNvbG9yczogbnVsbCxcbiAgICAgICAgcmV0dXJuVmFsdWVUeXBlOiBcImhleFwiLFxuICAgICAgICByZXR1cm5Bc1N0cmluZzogdHJ1ZSxcbiAgICAgICAgc2hvd1ZhbHVlczogc3VwcG9ydGVkQ29sb3JUeXBlcyxcbiAgICAgICAgc2hvd0FzU3RyaW5nOiBudWxsLFxuICAgICAgICBzaG93VXNlckNvbG9yczogdHJ1ZSxcbiAgICAgICAgY29udHJvbGxlcjogbnVsbCxcbiAgICAgICAgbG9jYWxlOiBcImVuLVVTXCIsXG4gICAgICAgIGFkZFVzZXJDb2xvclRpdGxlOiBudWxsLFxuICAgICAgICB1c2VyQ29sb3JzVGl0bGU6IG51bGwsXG4gICAgICAgIGhzbE1vZGU6IFwicGVyY2VudFwiLFxuICAgICAgICBzaG93QWxwaGFDaGFubmVsOiB0cnVlLFxuICAgICAgICBpbnB1dFRocmVzaG9sZDogMzAwLFxuICAgICAgICBpbml0Q29sb3I6IG51bGwsXG4gICAgICAgIHJlYWRvbmx5SW5wdXQ6IGZhbHNlLFxuICAgICAgICBjbHNTZWxlY3RvcjogXCJcIixcbiAgICAgICAgY2xzU3dhdGNoZXM6IFwiXCIsXG4gICAgICAgIGNsc1N3YXRjaDogXCJcIixcbiAgICAgICAgY2xzVmFsdWU6IFwiXCIsXG4gICAgICAgIGNsc0xhYmVsOiBcIlwiLFxuICAgICAgICBjbHNJbnB1dDogXCJcIixcbiAgICAgICAgY2xzVXNlckNvbG9yQnV0dG9uOiBcIlwiLFxuICAgICAgICBjbHNVc2VyQ29sb3JzOiBcIlwiLFxuICAgICAgICBjbHNVc2VyQ29sb3JzVGl0bGU6IFwiXCIsXG4gICAgICAgIGNsc1VzZXJDb2xvcjogXCJcIixcbiAgICAgICAgb25TZWxlY3RDb2xvcjogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Db2xvclNlbGVjdG9yQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmNvbG9yU2VsZWN0b3JTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIENvbG9yU2VsZWN0b3JEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIENvbG9yU2VsZWN0b3JEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0NvbG9yU2VsZWN0b3JTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmNvbG9yU2VsZWN0b3JTZXR1cCh3aW5kb3dbXCJtZXRyb0NvbG9yU2VsZWN0b3JTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdjb2xvci1zZWxlY3RvcicsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBDb2xvclNlbGVjdG9yRGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIC8vIGRlZmluZSBpbnN0YW5jZSB2YXJzIGhlcmVcbiAgICAgICAgICAgICAgICBpZDogVXRpbHMuZWxlbWVudElkKFwiY29sb3Itc2VsZWN0b3JcIiksXG4gICAgICAgICAgICAgICAgZGVmYXVsdFN3YXRjaGVzOiBbXSxcbiAgICAgICAgICAgICAgICBzaG93VmFsdWVzOiBbXSxcbiAgICAgICAgICAgICAgICB1c2VyQ29sb3JzOiBbXSxcbiAgICAgICAgICAgICAgICBzaG93QXNTdHJpbmc6IFtdLFxuICAgICAgICAgICAgICAgIGh1ZTogMCxcbiAgICAgICAgICAgICAgICBzYXR1cmF0aW9uOiAwLFxuICAgICAgICAgICAgICAgIGxpZ2h0bmVzczogMSxcbiAgICAgICAgICAgICAgICBhbHBoYTogMSxcbiAgICAgICAgICAgICAgICBoc2w6IG51bGwsXG4gICAgICAgICAgICAgICAgaHNsYTogbnVsbCxcbiAgICAgICAgICAgICAgICBoc3Y6IG51bGwsXG4gICAgICAgICAgICAgICAgcmdiOiBudWxsLFxuICAgICAgICAgICAgICAgIHJnYmE6IG51bGwsXG4gICAgICAgICAgICAgICAgY215azogbnVsbCxcbiAgICAgICAgICAgICAgICBoZXg6IG51bGwsXG4gICAgICAgICAgICAgICAgaW5wdXRJbnRlcnZhbDogbnVsbCxcbiAgICAgICAgICAgICAgICBsb2NhbGU6IG51bGxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLmRlZmF1bHRTd2F0Y2hlcykpIHRoaXMuZGVmYXVsdFN3YXRjaGVzID0gby5kZWZhdWx0U3dhdGNoZXMudG9BcnJheShcIixcIikubWFwKGZ1bmN0aW9uIChlbCl7cmV0dXJuIGVsLnRvVXBwZXJDYXNlKCk7fSk7XG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLnNob3dWYWx1ZXMpKSB0aGlzLnNob3dWYWx1ZXMgPSBvLnNob3dWYWx1ZXMudG9BcnJheShcIixcIik7XG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLnVzZXJDb2xvcnMpKSB0aGlzLnVzZXJDb2xvcnMgPSBvLnVzZXJDb2xvcnMudG9BcnJheShcIixcIikubWFwKGZ1bmN0aW9uIChlbCl7cmV0dXJuIGVsLnRvVXBwZXJDYXNlKCk7fSk7XG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLnNob3dBc1N0cmluZykpIHRoaXMuc2hvd0FzU3RyaW5nID0gby5zaG93QXNTdHJpbmcudG9BcnJheShcIixcIik7XG5cbiAgICAgICAgICAgIHRoaXMubG9jYWxlID0gTWV0cm8ubG9jYWxlc1tvLmxvY2FsZV1bJ2NvbG9yU2VsZWN0b3InXTtcblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KCdjb2xvci1zZWxlY3Rvci1jcmVhdGUnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlU3RydWN0dXJlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zLCBsb2NhbGUgPSB0aGlzLmxvY2FsZTtcbiAgICAgICAgICAgIHZhciBjb2xvckJveCwgcm93LCBzd2F0Y2hlcywgbWFwLCB2YWx1ZSwgaW5wdXRzLCByYWRpb3MsXG4gICAgICAgICAgICAgICAgdXNlckNvbG9yc0FjdGlvbnMsIGh1ZUNhbnZhcywgc2hhZGVDYW52YXMsIGh1ZUN1cnNvciwgc2hhZGVDdXJzb3IsXG4gICAgICAgICAgICAgICAgY29sb3JCbG9jaywgYWxwaGFDYW52YXMsIGFscGhhQ3Vyc29yO1xuXG4gICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwiY29sb3Itc2VsZWN0b3JcIikuYWRkQ2xhc3Moby5jbHNTZWxlY3Rvcik7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kKCBjb2xvckJveCA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImNvbG9yLWJveFwiKSApO1xuXG4gICAgICAgICAgICBjb2xvckJveC5hcHBlbmQoIHJvdyA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInJvd1wiKSApO1xuXG4gICAgICAgICAgICByb3cuYXBwZW5kKCBzd2F0Y2hlcyA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImRlZmF1bHQtc3dhdGNoZXNcIikuYWRkQ2xhc3Moby5jbHNTd2F0Y2hlcykgKTtcbiAgICAgICAgICAgICQuZWFjaCh0aGlzLmRlZmF1bHRTd2F0Y2hlcywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBzd2F0Y2hlcy5hcHBlbmQoXG4gICAgICAgICAgICAgICAgICAgICQoXCI8YnV0dG9uPlwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkYXRhLWNvbG9yXCIsIHRoaXMpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcInN3YXRjaFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKG8uY2xzU3dhdGNoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNzcyhcImJhY2tncm91bmQtY29sb3JcIiwgdGhpcylcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbG9yQm94LmFwcGVuZCggcm93ID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwicm93XCIpICk7XG5cbiAgICAgICAgICAgIHJvdy5hcHBlbmQoIG1hcCA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImNvbG9yLW1hcFwiKSApO1xuICAgICAgICAgICAgbWFwLmFwcGVuZCggc2hhZGVDdXJzb3IgPSAkKFwiPGJ1dHRvbj5cIikuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIikuYWRkQ2xhc3MoXCJjdXJzb3IgY29sb3ItY3Vyc29yXCIpIClcbiAgICAgICAgICAgIG1hcC5hcHBlbmQoIHNoYWRlQ2FudmFzID0gJChcIjxjYW52YXM+XCIpLmFkZENsYXNzKFwiY29sb3ItY2FudmFzXCIpIClcblxuICAgICAgICAgICAgcm93LmFwcGVuZCggbWFwID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiaHVlLW1hcFwiKSApO1xuICAgICAgICAgICAgbWFwLmFwcGVuZCggaHVlQ3Vyc29yID0gJChcIjxidXR0b24+XCIpLmF0dHIoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpLmFkZENsYXNzKFwiY3Vyc29yIGh1ZS1jdXJzb3JcIikgKVxuICAgICAgICAgICAgbWFwLmFwcGVuZCggaHVlQ2FudmFzID0gJChcIjxjYW52YXM+XCIpLmFkZENsYXNzKFwiaHVlLWNhbnZhc1wiKSApXG5cbiAgICAgICAgICAgIHJvdy5hcHBlbmQoIG1hcCA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImFscGhhLW1hcFwiKSApO1xuICAgICAgICAgICAgbWFwLmFwcGVuZCggYWxwaGFDdXJzb3IgPSAkKFwiPGJ1dHRvbj5cIikuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIikuYWRkQ2xhc3MoXCJjdXJzb3IgYWxwaGEtY3Vyc29yXCIpIClcbiAgICAgICAgICAgIG1hcC5hcHBlbmQoIGFscGhhQ2FudmFzID0gJChcIjxjYW52YXM+XCIpLmFkZENsYXNzKFwiYWxwaGEtY2FudmFzXCIpIClcblxuICAgICAgICAgICAgY29sb3JCb3guYXBwZW5kKCByb3cgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJyb3cgY29sb3ItdmFsdWVzLWJsb2NrXCIpICk7XG5cbiAgICAgICAgICAgIHJvdy5hcHBlbmQoIHZhbHVlID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY29sb3ItdmFsdWUtaGV4XCIpICk7XG4gICAgICAgICAgICB2YWx1ZS5hcHBlbmQoICQoXCI8aW5wdXQgdHlwZT0ncmFkaW8nIG5hbWU9J3JldHVyblR5cGUnIHZhbHVlPSdoZXgnIGNoZWNrZWQ+XCIpLmFkZENsYXNzKFwiY2hlY2stY29sb3ItdmFsdWUtaGV4XCIpICk7XG4gICAgICAgICAgICB2YWx1ZS5hcHBlbmQoIGNvbG9yQmxvY2sgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJjb2xvci1ibG9jayBhcy1zdHJpbmcgY29sb3ItaGV4XCIpICk7XG4gICAgICAgICAgICBjb2xvckJsb2NrLmFwcGVuZCggJChcIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLXByZXBlbmQ9J0hFWDonPlwiKS5hZGRDbGFzcyhcImlucHV0LXNtYWxsIHZhbHVlLWhleFwiKSApO1xuXG4gICAgICAgICAgICByb3cuYXBwZW5kKCB2YWx1ZSA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImNvbG9yLXZhbHVlLXJnYlwiKSApO1xuICAgICAgICAgICAgdmFsdWUuYXBwZW5kKCAkKFwiPGlucHV0IHR5cGU9J3JhZGlvJyBuYW1lPSdyZXR1cm5UeXBlJyB2YWx1ZT0ncmdiJz5cIikuYWRkQ2xhc3MoXCJjaGVjay1jb2xvci12YWx1ZS1yZ2JcIikgKTtcbiAgICAgICAgICAgIHZhbHVlLmFwcGVuZCggY29sb3JCbG9jayA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImNvbG9yLWJsb2NrIGNvbG9yLXJnYlwiKSApO1xuICAgICAgICAgICAgY29sb3JCbG9jay5hcHBlbmQoICQoXCI8aW5wdXQgdHlwZT0ndGV4dCcgZGF0YS1wcmVwZW5kPSdSOic+XCIpLmFkZENsYXNzKFwiaW5wdXQtc21hbGwgdmFsdWUtclwiKSApO1xuICAgICAgICAgICAgY29sb3JCbG9jay5hcHBlbmQoICQoXCI8aW5wdXQgdHlwZT0ndGV4dCcgZGF0YS1wcmVwZW5kPSdHOic+XCIpLmFkZENsYXNzKFwiaW5wdXQtc21hbGwgdmFsdWUtZ1wiKSApO1xuICAgICAgICAgICAgY29sb3JCbG9jay5hcHBlbmQoICQoXCI8aW5wdXQgdHlwZT0ndGV4dCcgZGF0YS1wcmVwZW5kPSdCOic+XCIpLmFkZENsYXNzKFwiaW5wdXQtc21hbGwgdmFsdWUtYlwiKSApO1xuICAgICAgICAgICAgdmFsdWUuYXBwZW5kKCBjb2xvckJsb2NrID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY29sb3ItYmxvY2sgYXMtc3RyaW5nIGNvbG9yLXJnYlwiKSApO1xuICAgICAgICAgICAgY29sb3JCbG9jay5hcHBlbmQoICQoXCI8aW5wdXQgdHlwZT0ndGV4dCcgZGF0YS1wcmVwZW5kPSdSR0I6Jz5cIikuYWRkQ2xhc3MoXCJpbnB1dC1zbWFsbCB2YWx1ZS1yZ2JcIikgKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuc2hvd0FzU3RyaW5nLmluZGV4T2YoXCJyZ2JcIikgPiAtMSkge1xuICAgICAgICAgICAgICAgIHZhbHVlLmZpbmQoXCIudmFsdWUtciwudmFsdWUtZywudmFsdWUtYlwiKS5wYXJlbnQoKS5oaWRlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhbHVlLmZpbmQoXCIudmFsdWUtcmdiXCIpLnBhcmVudCgpLmhpZGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcm93LmFwcGVuZCggdmFsdWUgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJjb2xvci12YWx1ZS1yZ2JhXCIpICk7XG4gICAgICAgICAgICB2YWx1ZS5hcHBlbmQoICQoXCI8aW5wdXQgdHlwZT0ncmFkaW8nIG5hbWU9J3JldHVyblR5cGUnIHZhbHVlPSdyZ2JhJz5cIikuYWRkQ2xhc3MoXCJjaGVjay1jb2xvci12YWx1ZS1yZ2JhXCIpICk7XG4gICAgICAgICAgICB2YWx1ZS5hcHBlbmQoIGNvbG9yQmxvY2sgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJjb2xvci1ibG9jayBjb2xvci1yZ2JhXCIpICk7XG4gICAgICAgICAgICBjb2xvckJsb2NrLmFwcGVuZCggJChcIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLXByZXBlbmQ9J1I6Jz5cIikuYWRkQ2xhc3MoXCJpbnB1dC1zbWFsbCB2YWx1ZS1yXCIpICk7XG4gICAgICAgICAgICBjb2xvckJsb2NrLmFwcGVuZCggJChcIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLXByZXBlbmQ9J0c6Jz5cIikuYWRkQ2xhc3MoXCJpbnB1dC1zbWFsbCB2YWx1ZS1nXCIpICk7XG4gICAgICAgICAgICBjb2xvckJsb2NrLmFwcGVuZCggJChcIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLXByZXBlbmQ9J0I6Jz5cIikuYWRkQ2xhc3MoXCJpbnB1dC1zbWFsbCB2YWx1ZS1iXCIpICk7XG4gICAgICAgICAgICBjb2xvckJsb2NrLmFwcGVuZCggJChcIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLXByZXBlbmQ9J0E6Jz5cIikuYWRkQ2xhc3MoXCJpbnB1dC1zbWFsbCB2YWx1ZS1hXCIpICk7XG4gICAgICAgICAgICB2YWx1ZS5hcHBlbmQoIGNvbG9yQmxvY2sgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJjb2xvci1ibG9jayBhcy1zdHJpbmcgY29sb3ItcmdiYVwiKSApO1xuICAgICAgICAgICAgY29sb3JCbG9jay5hcHBlbmQoICQoXCI8aW5wdXQgdHlwZT0ndGV4dCcgZGF0YS1wcmVwZW5kPSdSR0JBOic+XCIpLmFkZENsYXNzKFwiaW5wdXQtc21hbGwgdmFsdWUtcmdiYVwiKSApO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5zaG93QXNTdHJpbmcuaW5kZXhPZihcInJnYmFcIikgPiAtMSkge1xuICAgICAgICAgICAgICAgIHZhbHVlLmZpbmQoXCIudmFsdWUtciwudmFsdWUtZywudmFsdWUtYiwudmFsdWUtYVwiKS5wYXJlbnQoKS5oaWRlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhbHVlLmZpbmQoXCIudmFsdWUtcmdiYVwiKS5wYXJlbnQoKS5oaWRlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJvdy5hcHBlbmQoIHZhbHVlID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY29sb3ItdmFsdWUtaHNsXCIpICk7XG4gICAgICAgICAgICB2YWx1ZS5hcHBlbmQoICQoXCI8aW5wdXQgdHlwZT0ncmFkaW8nIG5hbWU9J3JldHVyblR5cGUnIHZhbHVlPSdoc2wnPlwiKS5hZGRDbGFzcyhcImNoZWNrLWNvbG9yLXZhbHVlLWhzbFwiKSApO1xuICAgICAgICAgICAgdmFsdWUuYXBwZW5kKCBjb2xvckJsb2NrID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY29sb3ItYmxvY2sgY29sb3ItaHNsXCIpICk7XG4gICAgICAgICAgICBjb2xvckJsb2NrLmFwcGVuZCggJChcIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLXByZXBlbmQ9J0g6Jz5cIikuYWRkQ2xhc3MoXCJpbnB1dC1zbWFsbCB2YWx1ZS1oXCIpICk7XG4gICAgICAgICAgICBjb2xvckJsb2NrLmFwcGVuZCggJChcIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLXByZXBlbmQ9J1M6Jz5cIikuYWRkQ2xhc3MoXCJpbnB1dC1zbWFsbCB2YWx1ZS1zXCIpICk7XG4gICAgICAgICAgICBjb2xvckJsb2NrLmFwcGVuZCggJChcIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLXByZXBlbmQ9J0w6Jz5cIikuYWRkQ2xhc3MoXCJpbnB1dC1zbWFsbCB2YWx1ZS1sXCIpICk7XG4gICAgICAgICAgICB2YWx1ZS5hcHBlbmQoIGNvbG9yQmxvY2sgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJjb2xvci1ibG9jayBhcy1zdHJpbmcgY29sb3ItaHNsXCIpICk7XG4gICAgICAgICAgICBjb2xvckJsb2NrLmFwcGVuZCggJChcIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLXByZXBlbmQ9J0hTTDonPlwiKS5hZGRDbGFzcyhcImlucHV0LXNtYWxsIHZhbHVlLWhzbFwiKSApO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5zaG93QXNTdHJpbmcuaW5kZXhPZihcImhzbFwiKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUuZmluZChcIi52YWx1ZS1oLC52YWx1ZS1zLC52YWx1ZS1sXCIpLnBhcmVudCgpLmhpZGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsdWUuZmluZChcIi52YWx1ZS1oc2xcIikucGFyZW50KCkuaGlkZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByb3cuYXBwZW5kKCB2YWx1ZSA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImNvbG9yLXZhbHVlLWhzbGFcIikgKTtcbiAgICAgICAgICAgIHZhbHVlLmFwcGVuZCggJChcIjxpbnB1dCB0eXBlPSdyYWRpbycgbmFtZT0ncmV0dXJuVHlwZScgdmFsdWU9J2hzbGEnPlwiKS5hZGRDbGFzcyhcImNoZWNrLWNvbG9yLXZhbHVlLWhzbGFcIikgKTtcbiAgICAgICAgICAgIHZhbHVlLmFwcGVuZCggY29sb3JCbG9jayA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImNvbG9yLWJsb2NrIGNvbG9yLWhzbGFcIikgKTtcbiAgICAgICAgICAgIGNvbG9yQmxvY2suYXBwZW5kKCAkKFwiPGlucHV0IHR5cGU9J3RleHQnIGRhdGEtcHJlcGVuZD0nSDonPlwiKS5hZGRDbGFzcyhcImlucHV0LXNtYWxsIHZhbHVlLWhcIikgKTtcbiAgICAgICAgICAgIGNvbG9yQmxvY2suYXBwZW5kKCAkKFwiPGlucHV0IHR5cGU9J3RleHQnIGRhdGEtcHJlcGVuZD0nUzonPlwiKS5hZGRDbGFzcyhcImlucHV0LXNtYWxsIHZhbHVlLXNcIikgKTtcbiAgICAgICAgICAgIGNvbG9yQmxvY2suYXBwZW5kKCAkKFwiPGlucHV0IHR5cGU9J3RleHQnIGRhdGEtcHJlcGVuZD0nTDonPlwiKS5hZGRDbGFzcyhcImlucHV0LXNtYWxsIHZhbHVlLWxcIikgKTtcbiAgICAgICAgICAgIGNvbG9yQmxvY2suYXBwZW5kKCAkKFwiPGlucHV0IHR5cGU9J3RleHQnIGRhdGEtcHJlcGVuZD0nQTonPlwiKS5hZGRDbGFzcyhcImlucHV0LXNtYWxsIHZhbHVlLWFcIikgKTtcbiAgICAgICAgICAgIHZhbHVlLmFwcGVuZCggY29sb3JCbG9jayA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImNvbG9yLWJsb2NrIGFzLXN0cmluZyBjb2xvci1oc2xhXCIpICk7XG4gICAgICAgICAgICBjb2xvckJsb2NrLmFwcGVuZCggJChcIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLXByZXBlbmQ9J0hTTEE6Jz5cIikuYWRkQ2xhc3MoXCJpbnB1dC1zbWFsbCB2YWx1ZS1oc2xhXCIpICk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnNob3dBc1N0cmluZy5pbmRleE9mKFwiaHNsYVwiKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUuZmluZChcIi52YWx1ZS1oLC52YWx1ZS1zLC52YWx1ZS1sLC52YWx1ZS1hXCIpLnBhcmVudCgpLmhpZGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsdWUuZmluZChcIi52YWx1ZS1oc2xhXCIpLnBhcmVudCgpLmhpZGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcm93LmFwcGVuZCggdmFsdWUgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJjb2xvci12YWx1ZS1oc3ZcIikgKTtcbiAgICAgICAgICAgIHZhbHVlLmFwcGVuZCggJChcIjxpbnB1dCB0eXBlPSdyYWRpbycgbmFtZT0ncmV0dXJuVHlwZScgdmFsdWU9J2hzdic+XCIpLmFkZENsYXNzKFwiY2hlY2stY29sb3ItdmFsdWUtaHNsXCIpICk7XG4gICAgICAgICAgICB2YWx1ZS5hcHBlbmQoIGNvbG9yQmxvY2sgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJjb2xvci1ibG9jayBjb2xvci1oc3ZcIikgKTtcbiAgICAgICAgICAgIGNvbG9yQmxvY2suYXBwZW5kKCAkKFwiPGlucHV0IHR5cGU9J3RleHQnIGRhdGEtcHJlcGVuZD0nSDonPlwiKS5hZGRDbGFzcyhcImlucHV0LXNtYWxsIHZhbHVlLWhcIikgKTtcbiAgICAgICAgICAgIGNvbG9yQmxvY2suYXBwZW5kKCAkKFwiPGlucHV0IHR5cGU9J3RleHQnIGRhdGEtcHJlcGVuZD0nUzonPlwiKS5hZGRDbGFzcyhcImlucHV0LXNtYWxsIHZhbHVlLXNcIikgKTtcbiAgICAgICAgICAgIGNvbG9yQmxvY2suYXBwZW5kKCAkKFwiPGlucHV0IHR5cGU9J3RleHQnIGRhdGEtcHJlcGVuZD0nVjonPlwiKS5hZGRDbGFzcyhcImlucHV0LXNtYWxsIHZhbHVlLXZcIikgKTtcbiAgICAgICAgICAgIHZhbHVlLmFwcGVuZCggY29sb3JCbG9jayA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImNvbG9yLWJsb2NrIGFzLXN0cmluZyBjb2xvci1oc3ZcIikgKTtcbiAgICAgICAgICAgIGNvbG9yQmxvY2suYXBwZW5kKCAkKFwiPGlucHV0IHR5cGU9J3RleHQnIGRhdGEtcHJlcGVuZD0nSFNWOic+XCIpLmFkZENsYXNzKFwiaW5wdXQtc21hbGwgdmFsdWUtaHN2XCIpICk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnNob3dBc1N0cmluZy5pbmRleE9mKFwiaHN2XCIpID4gLTEpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZS5maW5kKFwiLnZhbHVlLWgsLnZhbHVlLXMsLnZhbHVlLXZcIikucGFyZW50KCkuaGlkZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YWx1ZS5maW5kKFwiLnZhbHVlLWhzdlwiKS5wYXJlbnQoKS5oaWRlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJvdy5hcHBlbmQoIHZhbHVlID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY29sb3ItdmFsdWUtY215a1wiKSApO1xuICAgICAgICAgICAgdmFsdWUuYXBwZW5kKCAkKFwiPGlucHV0IHR5cGU9J3JhZGlvJyBuYW1lPSdyZXR1cm5UeXBlJyB2YWx1ZT0nY215ayc+XCIpLmFkZENsYXNzKFwiY2hlY2stY29sb3ItdmFsdWUtY215a1wiKSApO1xuICAgICAgICAgICAgdmFsdWUuYXBwZW5kKCBjb2xvckJsb2NrID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY29sb3ItYmxvY2sgY29sb3ItY215a1wiKSApO1xuICAgICAgICAgICAgY29sb3JCbG9jay5hcHBlbmQoICQoXCI8aW5wdXQgdHlwZT0ndGV4dCcgZGF0YS1wcmVwZW5kPSdDOic+XCIpLmFkZENsYXNzKFwiaW5wdXQtc21hbGwgdmFsdWUtY1wiKSApO1xuICAgICAgICAgICAgY29sb3JCbG9jay5hcHBlbmQoICQoXCI8aW5wdXQgdHlwZT0ndGV4dCcgZGF0YS1wcmVwZW5kPSdNOic+XCIpLmFkZENsYXNzKFwiaW5wdXQtc21hbGwgdmFsdWUtbVwiKSApO1xuICAgICAgICAgICAgY29sb3JCbG9jay5hcHBlbmQoICQoXCI8aW5wdXQgdHlwZT0ndGV4dCcgZGF0YS1wcmVwZW5kPSdZOic+XCIpLmFkZENsYXNzKFwiaW5wdXQtc21hbGwgdmFsdWUteVwiKSApO1xuICAgICAgICAgICAgY29sb3JCbG9jay5hcHBlbmQoICQoXCI8aW5wdXQgdHlwZT0ndGV4dCcgZGF0YS1wcmVwZW5kPSdLOic+XCIpLmFkZENsYXNzKFwiaW5wdXQtc21hbGwgdmFsdWUta1wiKSApO1xuICAgICAgICAgICAgdmFsdWUuYXBwZW5kKCBjb2xvckJsb2NrID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY29sb3ItYmxvY2sgYXMtc3RyaW5nIGNvbG9yLWNteWtcIikgKTtcbiAgICAgICAgICAgIGNvbG9yQmxvY2suYXBwZW5kKCAkKFwiPGlucHV0IHR5cGU9J3RleHQnIGRhdGEtcHJlcGVuZD0nQ01ZSzonPlwiKS5hZGRDbGFzcyhcImlucHV0LXNtYWxsIHZhbHVlLWNteWtcIikgKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuc2hvd0FzU3RyaW5nLmluZGV4T2YoXCJjbXlrXCIpID4gLTEpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZS5maW5kKFwiLnZhbHVlLXMsLnZhbHVlLW0sLnZhbHVlLXksLnZhbHVlLWtcIikucGFyZW50KCkuaGlkZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YWx1ZS5maW5kKFwiLnZhbHVlLWNteWtcIikucGFyZW50KCkuaGlkZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb2xvckJveC5hcHBlbmQoIHJvdyA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInJvdyB1c2VyLWNvbG9ycy1jb250YWluZXJcIikgKTtcbiAgICAgICAgICAgIHJvdy5hcHBlbmQoICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInVzZXItY29sb3JzLXRpdGxlXCIpLmFkZENsYXNzKG8uY2xzVXNlckNvbG9yc1RpdGxlKS5odG1sKG8udXNlckNvbG9yc1RpdGxlIHx8IGxvY2FsZVsndXNlckNvbG9yc1RpdGxlJ10pICk7XG4gICAgICAgICAgICByb3cuYXBwZW5kKCAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJ1c2VyLWNvbG9yc1wiKS5hZGRDbGFzcyhvLmNsc1VzZXJDb2xvcnMpICk7XG4gICAgICAgICAgICByb3cuYXBwZW5kKCB1c2VyQ29sb3JzQWN0aW9ucyA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInVzZXItY29sb3JzLWFjdGlvbnNcIikgKTtcbiAgICAgICAgICAgIHVzZXJDb2xvcnNBY3Rpb25zLmFwcGVuZChcbiAgICAgICAgICAgICAgICAkKFwiPGJ1dHRvbj5cIilcbiAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKFwiYnV0dG9uIGFkZC1idXR0b25cIilcbiAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKG8uY2xzVXNlckNvbG9yQnV0dG9uKVxuICAgICAgICAgICAgICAgICAgICAuaHRtbChcIjxzcGFuIGNsYXNzPSd1c2VyLXN3YXRjaCc+PC9zcGFuPjxzcGFuPlwiKyhvLmFkZFVzZXJDb2xvclRpdGxlIHx8IGxvY2FsZVsnYWRkVXNlckNvbG9yQnV0dG9uJ10pK1wiPC9zcGFuPlwiKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaW5wdXRzID0gY29sb3JCb3guZmluZChcImlucHV0W3R5cGU9dGV4dF1cIik7XG4gICAgICAgICAgICBNZXRyby5tYWtlUGx1Z2luKGlucHV0cywgJ2lucHV0Jywge1xuICAgICAgICAgICAgICAgIGNsZWFyQnV0dG9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjbHNQcmVwZW5kOiBvLmNsc0xhYmVsLFxuICAgICAgICAgICAgICAgIGNsc0NvbXBvbmVudDogby5jbHNJbnB1dFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpbnB1dHMuYWRkQ2xhc3Moby5jbHNWYWx1ZSk7XG5cbiAgICAgICAgICAgIGlmIChvLnJlYWRvbmx5SW5wdXQpIHtcbiAgICAgICAgICAgICAgICBpbnB1dHMuYXR0cihcInJlYWRvbmx5XCIsIHRydWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByYWRpb3MgPSBjb2xvckJveC5maW5kKFwiaW5wdXRbdHlwZT1yYWRpb11cIikuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcIm5hbWVcIiwgdGhhdC5pZCArIFwiLXJldHVyblR5cGVcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJhZGlvcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKCQodGhpcykudmFsKCkgPT09IG8ucmV0dXJuVmFsdWVUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBNZXRyby5tYWtlUGx1Z2luKHJhZGlvcywgJ3JhZGlvJywge1xuICAgICAgICAgICAgICAgIHN0eWxlOiAyXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJC5lYWNoKHN1cHBvcnRlZENvbG9yVHlwZXMudG9BcnJheShcIixcIiksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKHRoYXQuc2hvd1ZhbHVlcy5pbmRleE9mKHRoaXMpID09PSAtMSkgZWxlbWVudC5maW5kKFwiLmNvbG9yLXZhbHVlLVwiK3RoaXMpLmhpZGUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIW8uc2hvd1VzZXJDb2xvcnMpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIudXNlci1jb2xvcnMtY29udGFpbmVyXCIpLmhpZGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFvLnNob3dBbHBoYUNoYW5uZWwpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwibm8tYWxwaGEtY2hhbm5lbFwiKTtcbiAgICAgICAgICAgICAgICAkLmVhY2goW1wicmdiYVwiLCBcImhzbGFcIl0sIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5jb2xvci12YWx1ZS1cIit0aGlzKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpbGxVc2VyQ29sb3JzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuaHVlQ2FudmFzID0gaHVlQ2FudmFzO1xuICAgICAgICAgICAgdGhpcy5odWVDdXJzb3IgPSBodWVDdXJzb3I7XG4gICAgICAgICAgICB0aGlzLnNoYWRlQ2FudmFzID0gc2hhZGVDYW52YXM7XG4gICAgICAgICAgICB0aGlzLnNoYWRlQ3Vyc29yID0gc2hhZGVDdXJzb3I7XG4gICAgICAgICAgICB0aGlzLmFscGhhQ2FudmFzID0gYWxwaGFDYW52YXM7XG4gICAgICAgICAgICB0aGlzLmFscGhhQ3Vyc29yID0gYWxwaGFDdXJzb3I7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVNoYWRlQ2FudmFzKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVIdWVDYW52YXMoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUFscGhhQ2FudmFzKCk7XG4gICAgICAgICAgICB0aGlzLl9zZXRDb2xvclZhbHVlcygpO1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlQ3Vyc29yc0NvbG9yKCk7XG5cbiAgICAgICAgICAgIGlmIChvLmluaXRDb2xvciAmJiBNZXRyby5jb2xvcnMuaXNDb2xvcihvLmluaXRDb2xvcikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xvclRvUG9zKHR5cGVvZiBvLmluaXRDb2xvciA9PT0gXCJzdHJpbmdcIiA/IE1ldHJvLmNvbG9ycy5wYXJzZShvLmluaXRDb2xvcikgOiBvLmluaXRDb2xvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVNoYWRlQ2FudmFzOiBmdW5jdGlvbihjb2xvcil7XG4gICAgICAgICAgICB2YXIgY2FudmFzID0gdGhpcy5zaGFkZUNhbnZhc1swXTtcbiAgICAgICAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuXG4gICAgICAgICAgICBpZighY29sb3IpIGNvbG9yID0gJyNmMDAnO1xuXG4gICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gY29sb3I7XG4gICAgICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcblxuICAgICAgICAgICAgdmFyIHdoaXRlR3JhZGllbnQgPSBjdHguY3JlYXRlTGluZWFyR3JhZGllbnQoMCwgMCwgY2FudmFzLndpZHRoLCAwKTtcbiAgICAgICAgICAgIHdoaXRlR3JhZGllbnQuYWRkQ29sb3JTdG9wKDAsIFwiI2ZmZlwiKTtcbiAgICAgICAgICAgIHdoaXRlR3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsIFwidHJhbnNwYXJlbnRcIik7XG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gd2hpdGVHcmFkaWVudDtcbiAgICAgICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuXG4gICAgICAgICAgICB2YXIgYmxhY2tHcmFkaWVudCA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAwLCAwLCBjYW52YXMuaGVpZ2h0KTtcbiAgICAgICAgICAgIGJsYWNrR3JhZGllbnQuYWRkQ29sb3JTdG9wKDAsIFwidHJhbnNwYXJlbnRcIik7XG4gICAgICAgICAgICBibGFja0dyYWRpZW50LmFkZENvbG9yU3RvcCgxLCBcIiMwMDBcIik7XG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYmxhY2tHcmFkaWVudDtcbiAgICAgICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVIdWVDYW52YXM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgY2FudmFzID0gdGhpcy5odWVDYW52YXNbMF07XG4gICAgICAgICAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgICAgICB2YXIgaHVlR3JhZGllbnQgPSBjdHguY3JlYXRlTGluZWFyR3JhZGllbnQoMCwgMCwgMCwgY2FudmFzLmhlaWdodCk7XG5cbiAgICAgICAgICAgIGh1ZUdyYWRpZW50LmFkZENvbG9yU3RvcCgwLjAwLCBcImhzbCgwLDEwMCUsNTAlKVwiKTtcbiAgICAgICAgICAgIGh1ZUdyYWRpZW50LmFkZENvbG9yU3RvcCgwLjE3LCBcImhzbCgyOTguOCwgMTAwJSwgNTAlKVwiKTtcbiAgICAgICAgICAgIGh1ZUdyYWRpZW50LmFkZENvbG9yU3RvcCgwLjMzLCBcImhzbCgyNDEuMiwgMTAwJSwgNTAlKVwiKTtcbiAgICAgICAgICAgIGh1ZUdyYWRpZW50LmFkZENvbG9yU3RvcCgwLjUwLCBcImhzbCgxODAsIDEwMCUsIDUwJSlcIik7XG4gICAgICAgICAgICBodWVHcmFkaWVudC5hZGRDb2xvclN0b3AoMC42NywgXCJoc2woMTE4LjgsIDEwMCUsIDUwJSlcIik7XG4gICAgICAgICAgICBodWVHcmFkaWVudC5hZGRDb2xvclN0b3AoMC44MywgXCJoc2woNjEuMiwxMDAlLDUwJSlcIik7XG4gICAgICAgICAgICBodWVHcmFkaWVudC5hZGRDb2xvclN0b3AoMS4wMCwgXCJoc2woMzYwLDEwMCUsNTAlKVwiKTtcbiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBodWVHcmFkaWVudDtcbiAgICAgICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVBbHBoYUNhbnZhczogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBjYW52YXMgPSB0aGlzLmFscGhhQ2FudmFzWzBdO1xuICAgICAgICAgICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICAgICAgdmFyIGFscGhhR3JhZGllbnQgPSBjdHguY3JlYXRlTGluZWFyR3JhZGllbnQoMCwgMCwgMCwgY2FudmFzLmhlaWdodCk7XG4gICAgICAgICAgICB2YXIgc3RhcnRDb2xvciA9IG5ldyBNZXRyby5jb2xvclByaW1pdGl2ZS5IU0xBKHRoaXMuaHVlLCAxLCAuNSwgMSkudG9TdHJpbmcoKSwgZW5kQ29sb3IgPSBcInJnYmEoMCwwLDAsMClcIjtcblxuICAgICAgICAgICAgYWxwaGFHcmFkaWVudC5hZGRDb2xvclN0b3AoMC4wMCwgc3RhcnRDb2xvcik7XG4gICAgICAgICAgICBhbHBoYUdyYWRpZW50LmFkZENvbG9yU3RvcCgxLjAwLCBlbmRDb2xvcik7XG4gICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYWxwaGFHcmFkaWVudDtcbiAgICAgICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF91cGRhdGVIdWVDdXJzb3I6IGZ1bmN0aW9uKHkpe1xuICAgICAgICAgICAgdGhpcy5odWVDdXJzb3IuY3NzKHtcbiAgICAgICAgICAgICAgICBcInRvcFwiOiB5XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfdXBkYXRlQWxwaGFDdXJzb3I6IGZ1bmN0aW9uKHkpe1xuICAgICAgICAgICAgdGhpcy5hbHBoYUN1cnNvci5jc3Moe1xuICAgICAgICAgICAgICAgIFwidG9wXCI6IHlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9nZXRIdWVDb2xvcjogZnVuY3Rpb24ocGFnZVkpe1xuICAgICAgICAgICAgdmFyIGNhbnZhcyA9IHRoaXMuaHVlQ2FudmFzO1xuICAgICAgICAgICAgdmFyIG9mZnNldCA9IGNhbnZhcy5vZmZzZXQoKTtcbiAgICAgICAgICAgIHZhciBoZWlnaHQgPSBjYW52YXMuaGVpZ2h0KCk7XG4gICAgICAgICAgICB2YXIgeSwgcGVyY2VudCwgY29sb3IsIGh1ZTtcblxuICAgICAgICAgICAgeSA9IHBhZ2VZIC0gb2Zmc2V0LnRvcDtcblxuICAgICAgICAgICAgaWYgKCB5ID4gaGVpZ2h0ICkgeSA9IGhlaWdodDtcbiAgICAgICAgICAgIGlmICggeSA8IDAgKSB5ID0gMDtcblxuICAgICAgICAgICAgcGVyY2VudCA9IHkgLyBoZWlnaHQ7XG4gICAgICAgICAgICBodWUgPSAzNjAgLSAoMzYwICogcGVyY2VudCk7XG4gICAgICAgICAgICBpZiAoaHVlID09PSAzNjApIGh1ZSA9IDA7XG4gICAgICAgICAgICBjb2xvciA9IFwiaHNsKFwiKyBodWUgK1wiLCAxMDAlLCA1MCUpXCI7XG4gICAgICAgICAgICB0aGlzLmh1ZSA9IGh1ZTtcblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU2hhZGVDYW52YXMoY29sb3IpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlQWxwaGFDYW52YXMoKTtcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUh1ZUN1cnNvcih5KTtcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUN1cnNvcnNDb2xvcigpO1xuICAgICAgICAgICAgdGhpcy5fc2V0Q29sb3JWYWx1ZXMoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfZ2V0QWxwaGFWYWx1ZTogZnVuY3Rpb24ocGFnZVkpe1xuICAgICAgICAgICAgdmFyIGNhbnZhcyA9IHRoaXMuYWxwaGFDYW52YXM7XG4gICAgICAgICAgICB2YXIgb2Zmc2V0ID0gY2FudmFzLm9mZnNldCgpO1xuICAgICAgICAgICAgdmFyIGhlaWdodCA9IGNhbnZhcy5oZWlnaHQoKTtcbiAgICAgICAgICAgIHZhciB5LCBwZXJjZW50O1xuXG4gICAgICAgICAgICB5ID0gcGFnZVkgLSBvZmZzZXQudG9wO1xuXG4gICAgICAgICAgICBpZiAoIHkgPiBoZWlnaHQgKSB5ID0gaGVpZ2h0O1xuICAgICAgICAgICAgaWYgKCB5IDwgMCApIHkgPSAwO1xuXG4gICAgICAgICAgICBwZXJjZW50ID0gMSAtIHkgLyBoZWlnaHQ7XG4gICAgICAgICAgICB0aGlzLmFscGhhID0gcGVyY2VudC50b0ZpeGVkKDIpO1xuXG4gICAgICAgICAgICB0aGlzLl91cGRhdGVBbHBoYUN1cnNvcih5KTtcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUN1cnNvcnNDb2xvcigpO1xuICAgICAgICAgICAgdGhpcy5fc2V0Q29sb3JWYWx1ZXMoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfZ2V0U2hhZGVDb2xvcjogZnVuY3Rpb24ocGFnZVgsIHBhZ2VZKXtcbiAgICAgICAgICAgIHZhciBjYW52YXMgPSB0aGlzLnNoYWRlQ2FudmFzO1xuICAgICAgICAgICAgdmFyIG9mZnNldCA9IGNhbnZhcy5vZmZzZXQoKTtcbiAgICAgICAgICAgIHZhciB3aWR0aCA9IGNhbnZhcy53aWR0aCgpO1xuICAgICAgICAgICAgdmFyIGhlaWdodCA9IGNhbnZhcy5oZWlnaHQoKTtcbiAgICAgICAgICAgIHZhciB4ID0gcGFnZVggLSBvZmZzZXQubGVmdDtcbiAgICAgICAgICAgIHZhciB5ID0gcGFnZVkgLSBvZmZzZXQudG9wO1xuXG4gICAgICAgICAgICBpZih4ID4gd2lkdGgpIHggPSB3aWR0aDtcbiAgICAgICAgICAgIGlmKHggPCAwKSB4ID0gMDtcbiAgICAgICAgICAgIGlmKHkgPiBoZWlnaHQpIHkgPSBoZWlnaHQ7XG4gICAgICAgICAgICBpZih5IDwgMCkgeSA9IC4xO1xuXG4gICAgICAgICAgICB2YXIgeFJhdGlvID0geCAvIHdpZHRoICogMTAwO1xuICAgICAgICAgICAgdmFyIHlSYXRpbyA9IHkgLyBoZWlnaHQgKiAxMDA7XG4gICAgICAgICAgICB2YXIgaHN2VmFsdWUgPSAxIC0gKHlSYXRpbyAvIDEwMCk7XG4gICAgICAgICAgICB2YXIgaHN2U2F0dXJhdGlvbiA9IHhSYXRpbyAvIDEwMDtcbiAgICAgICAgICAgIHZhciBsaWdodG5lc3MgPSAoaHN2VmFsdWUgLyAyKSAqICgyIC0gaHN2U2F0dXJhdGlvbik7XG4gICAgICAgICAgICB2YXIgc2F0dXJhdGlvbiA9IChoc3ZWYWx1ZSAqIGhzdlNhdHVyYXRpb24pIC8gKDEgLSBNYXRoLmFicygyICogbGlnaHRuZXNzIC0gMSkpO1xuXG4gICAgICAgICAgICBpZiAoaXNOYU4obGlnaHRuZXNzKSkge1xuICAgICAgICAgICAgICAgIGxpZ2h0bmVzcyA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChpc05hTihzYXR1cmF0aW9uKSkge1xuICAgICAgICAgICAgICAgIHNhdHVyYXRpb24gPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmxpZ2h0bmVzcyA9IGxpZ2h0bmVzcztcbiAgICAgICAgICAgIHRoaXMuc2F0dXJhdGlvbiA9IHNhdHVyYXRpb247XG5cbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVNoYWRlQ3Vyc29yKHgsIHkpO1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlQ3Vyc29yc0NvbG9yKCk7XG4gICAgICAgICAgICB0aGlzLl9zZXRDb2xvclZhbHVlcygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF91cGRhdGVDdXJzb3JzQ29sb3I6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLnNoYWRlQ3Vyc29yLmNzcyh7YmFja2dyb3VuZENvbG9yOiBNZXRyby5jb2xvcnMudG9IRVgobmV3IE1ldHJvLmNvbG9yUHJpbWl0aXZlLkhTTCh0aGlzLmh1ZSwgdGhpcy5zYXR1cmF0aW9uLCB0aGlzLmxpZ2h0bmVzcykpfSk7XG4gICAgICAgICAgICB0aGlzLmh1ZUN1cnNvci5jc3Moe2JhY2tncm91bmRDb2xvcjogTWV0cm8uY29sb3JzLnRvSEVYKG5ldyBNZXRyby5jb2xvclByaW1pdGl2ZS5IU0wodGhpcy5odWUsIDEsIC41KSl9KTtcbiAgICAgICAgICAgIHRoaXMuYWxwaGFDdXJzb3IuY3NzKHtiYWNrZ3JvdW5kQ29sb3I6IE1ldHJvLmNvbG9ycy50b1JHQkEobmV3IE1ldHJvLmNvbG9yUHJpbWl0aXZlLkhTTCh0aGlzLmh1ZSwgMSwgLjUpLCB0aGlzLmFscGhhKS50b1N0cmluZygpfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3VwZGF0ZVNoYWRlQ3Vyc29yOiBmdW5jdGlvbih4LCB5KXtcbiAgICAgICAgICAgIHRoaXMuc2hhZGVDdXJzb3IuY3NzKHtcbiAgICAgICAgICAgICAgICB0b3A6IHksXG4gICAgICAgICAgICAgICAgbGVmdDogeFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcblxuICAgICAgICBfY29sb3JUb1BvczogZnVuY3Rpb24gKGNvbG9yKXtcbiAgICAgICAgICAgIHZhciBzaGFkZUNhbnZhc1JlY3QgPSB0aGlzLnNoYWRlQ2FudmFzWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgICAgdmFyIGh1ZUNhbnZhc1JlY3QgPSB0aGlzLmh1ZUNhbnZhc1swXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgIHZhciBhbHBoYUNhbnZhc1JlY3QgPSB0aGlzLmFscGhhQ2FudmFzWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgICAgdmFyIGhzbCA9IE1ldHJvLmNvbG9ycy50b0hTTChjb2xvcik7XG4gICAgICAgICAgICB2YXIgaHNsYSA9IE1ldHJvLmNvbG9ycy50b0hTTEEoY29sb3IsIGNvbG9yLmEpO1xuICAgICAgICAgICAgdmFyIGhzdiA9IE1ldHJvLmNvbG9ycy50b0hTVihjb2xvcik7XG4gICAgICAgICAgICB2YXIgeCA9IHNoYWRlQ2FudmFzUmVjdC53aWR0aCAqIGhzdi5zO1xuICAgICAgICAgICAgdmFyIHkgPSBzaGFkZUNhbnZhc1JlY3QuaGVpZ2h0ICogKDEgLSBoc3Yudik7XG4gICAgICAgICAgICB2YXIgaHVlWSA9IGh1ZUNhbnZhc1JlY3QuaGVpZ2h0IC0gKChoc2wuaCAvIDM2MCkgKiBodWVDYW52YXNSZWN0LmhlaWdodCk7XG4gICAgICAgICAgICB2YXIgYWxwaGFZID0gKDEgLSBoc2xhLmEpICogYWxwaGFDYW52YXNSZWN0LmhlaWdodDtcblxuICAgICAgICAgICAgdGhpcy5odWUgPSBoc2wuaDtcbiAgICAgICAgICAgIHRoaXMuc2F0dXJhdGlvbiA9IGhzbC5zO1xuICAgICAgICAgICAgdGhpcy5saWdodG5lc3MgPSBoc2wubDtcbiAgICAgICAgICAgIHRoaXMuYWxwaGEgPSBoc2xhLmE7XG5cbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUh1ZUN1cnNvcihodWVZKTtcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVNoYWRlQ3Vyc29yKHgsIHkpO1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlQWxwaGFDdXJzb3IoYWxwaGFZKTtcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUN1cnNvcnNDb2xvcigpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU2hhZGVDYW52YXMoXCJoc2woXCIrIHRoaXMuaHVlICtcIiwgMTAwJSwgNTAlKVwiKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUFscGhhQ2FudmFzKCk7XG4gICAgICAgICAgICB0aGlzLl9zZXRDb2xvclZhbHVlcygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9zZXRDb2xvclZhbHVlczogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGhzbCA9IE1ldHJvLmNvbG9ycy50b0hTTChuZXcgTWV0cm8uY29sb3JQcmltaXRpdmUuSFNMKHRoaXMuaHVlLCB0aGlzLnNhdHVyYXRpb24sIHRoaXMubGlnaHRuZXNzKSk7XG4gICAgICAgICAgICB2YXIgaHNsYSA9IE1ldHJvLmNvbG9ycy50b0hTTEEobmV3IE1ldHJvLmNvbG9yUHJpbWl0aXZlLkhTTEEodGhpcy5odWUsIHRoaXMuc2F0dXJhdGlvbiwgdGhpcy5saWdodG5lc3MsIHRoaXMuYWxwaGEpKTtcbiAgICAgICAgICAgIHZhciByZ2IgPSBNZXRyby5jb2xvcnMudG9SR0IoaHNsKTtcbiAgICAgICAgICAgIHZhciByZ2JhID0gTWV0cm8uY29sb3JzLnRvUkdCQShyZ2IsIHRoaXMuYWxwaGEpO1xuICAgICAgICAgICAgdmFyIGhzdiA9IE1ldHJvLmNvbG9ycy50b0hTVihoc2wpO1xuICAgICAgICAgICAgdmFyIGNteWsgPSBNZXRyby5jb2xvcnMudG9DTVlLKGhzbCk7XG4gICAgICAgICAgICB2YXIgaGV4ID0gTWV0cm8uY29sb3JzLnRvSEVYKGhzbCk7XG4gICAgICAgICAgICB2YXIgY29udHJvbGxlciA9ICQoby5jb250cm9sbGVyKTtcbiAgICAgICAgICAgIHZhciBwZXJjZW50ID0gby5oc2xNb2RlID09PSBcInBlcmNlbnRcIjtcblxuICAgICAgICAgICAgdGhpcy5oc2wgPSBoc2w7XG4gICAgICAgICAgICB0aGlzLmhzbGEgPSBoc2xhO1xuICAgICAgICAgICAgdGhpcy5oc3YgPSBoc3Y7XG4gICAgICAgICAgICB0aGlzLnJnYiA9IHJnYjtcbiAgICAgICAgICAgIHRoaXMucmdiYSA9IHJnYmE7XG4gICAgICAgICAgICB0aGlzLmhleCA9IGhleDtcbiAgICAgICAgICAgIHRoaXMuY215ayA9IGNteWs7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5jb2xvci12YWx1ZS1oZXggLnZhbHVlLWhleCBpbnB1dFwiKS52YWwoaGV4KTtcblxuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmNvbG9yLXZhbHVlLXJnYiAudmFsdWUtciBpbnB1dFwiKS52YWwocmdiLnIpO1xuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmNvbG9yLXZhbHVlLXJnYiAudmFsdWUtZyBpbnB1dFwiKS52YWwocmdiLmcpO1xuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmNvbG9yLXZhbHVlLXJnYiAudmFsdWUtYiBpbnB1dFwiKS52YWwocmdiLmIpO1xuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmNvbG9yLXZhbHVlLXJnYiAudmFsdWUtcmdiIGlucHV0XCIpLnZhbChyZ2IudG9TdHJpbmcoKSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5jb2xvci12YWx1ZS1yZ2JhIC52YWx1ZS1yIGlucHV0XCIpLnZhbChyZ2JhLnIpO1xuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmNvbG9yLXZhbHVlLXJnYmEgLnZhbHVlLWcgaW5wdXRcIikudmFsKHJnYmEuZyk7XG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuY29sb3ItdmFsdWUtcmdiYSAudmFsdWUtYiBpbnB1dFwiKS52YWwocmdiYS5iKTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5jb2xvci12YWx1ZS1yZ2JhIC52YWx1ZS1hIGlucHV0XCIpLnZhbChyZ2JhLmEpO1xuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmNvbG9yLXZhbHVlLXJnYmEgLnZhbHVlLXJnYmEgaW5wdXRcIikudmFsKHJnYmEudG9TdHJpbmcoKSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5jb2xvci12YWx1ZS1oc2wgLnZhbHVlLWggaW5wdXRcIikudmFsKGhzbC5oLnRvRml4ZWQoMCkpO1xuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmNvbG9yLXZhbHVlLWhzbCAudmFsdWUtcyBpbnB1dFwiKS52YWwocGVyY2VudCA/IE1hdGgucm91bmQoaHNsLnMqMTAwKStcIiVcIiA6IGhzbC5zLnRvRml4ZWQoNCkpO1xuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmNvbG9yLXZhbHVlLWhzbCAudmFsdWUtbCBpbnB1dFwiKS52YWwocGVyY2VudCA/IE1hdGgucm91bmQoaHNsLmwqMTAwKStcIiVcIiA6IGhzbC5sLnRvRml4ZWQoNCkpO1xuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmNvbG9yLXZhbHVlLWhzbCAudmFsdWUtaHNsIGlucHV0XCIpLnZhbChoc2wudG9TdHJpbmcoKSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5jb2xvci12YWx1ZS1oc2xhIC52YWx1ZS1oIGlucHV0XCIpLnZhbChoc2xhLmgudG9GaXhlZCgwKSk7XG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuY29sb3ItdmFsdWUtaHNsYSAudmFsdWUtcyBpbnB1dFwiKS52YWwocGVyY2VudCA/IE1hdGgucm91bmQoaHNsYS5zKjEwMCkrXCIlXCIgOiBoc2wucy50b0ZpeGVkKDQpKTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5jb2xvci12YWx1ZS1oc2xhIC52YWx1ZS1sIGlucHV0XCIpLnZhbChwZXJjZW50ID8gTWF0aC5yb3VuZChoc2xhLmwqMTAwKStcIiVcIiA6IGhzbC5sLnRvRml4ZWQoNCkpO1xuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmNvbG9yLXZhbHVlLWhzbGEgLnZhbHVlLWEgaW5wdXRcIikudmFsKGhzbGEuYSk7XG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuY29sb3ItdmFsdWUtaHNsYSAudmFsdWUtaHNsYSBpbnB1dFwiKS52YWwoaHNsYS50b1N0cmluZygpKTtcblxuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmNvbG9yLXZhbHVlLWhzdiAudmFsdWUtaCBpbnB1dFwiKS52YWwoaHN2LmgudG9GaXhlZCgwKSk7XG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuY29sb3ItdmFsdWUtaHN2IC52YWx1ZS1zIGlucHV0XCIpLnZhbChwZXJjZW50ID8gTWF0aC5yb3VuZChoc3YucyoxMDApK1wiJVwiIDogaHN2LnMudG9GaXhlZCg0KSk7XG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuY29sb3ItdmFsdWUtaHN2IC52YWx1ZS12IGlucHV0XCIpLnZhbChwZXJjZW50ID8gTWF0aC5yb3VuZChoc3YudioxMDApK1wiJVwiIDogaHN2LnYudG9GaXhlZCg0KSk7XG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuY29sb3ItdmFsdWUtaHN2IC52YWx1ZS1oc3YgaW5wdXRcIikudmFsKGhzdi50b1N0cmluZygpKTtcblxuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmNvbG9yLXZhbHVlLWNteWsgLnZhbHVlLWMgaW5wdXRcIikudmFsKGNteWsuYy50b0ZpeGVkKDApKTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5jb2xvci12YWx1ZS1jbXlrIC52YWx1ZS1tIGlucHV0XCIpLnZhbChjbXlrLm0udG9GaXhlZCgwKSk7XG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuY29sb3ItdmFsdWUtY215ayAudmFsdWUteSBpbnB1dFwiKS52YWwoY215ay55LnRvRml4ZWQoMCkpO1xuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmNvbG9yLXZhbHVlLWNteWsgLnZhbHVlLWsgaW5wdXRcIikudmFsKGNteWsuay50b0ZpeGVkKDApKTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5jb2xvci12YWx1ZS1jbXlrIC52YWx1ZS1jbXlrIGlucHV0XCIpLnZhbChjbXlrLnRvU3RyaW5nKCkpO1xuXG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIudXNlci1jb2xvcnMtYWN0aW9ucyAudXNlci1zd2F0Y2hcIikuY3NzKHtcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGhleFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChjb250cm9sbGVyICYmIGNvbnRyb2xsZXIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlci52YWwodGhpcy52YWwoKSkudHJpZ2dlcihcImNoYW5nZVwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwic2VsZWN0LWNvbG9yXCIsIHtcbiAgICAgICAgICAgICAgICBjb2xvcjogdGhpcy52YWwoKSxcbiAgICAgICAgICAgICAgICBwcmltaXRpdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgaHNsOiB0aGlzLmhzbCxcbiAgICAgICAgICAgICAgICAgICAgaHNsYTogdGhpcy5oc2xhLFxuICAgICAgICAgICAgICAgICAgICByZ2I6IHRoaXMucmdiLFxuICAgICAgICAgICAgICAgICAgICByZ2JhOiB0aGlzLnJnYmEsXG4gICAgICAgICAgICAgICAgICAgIGhzdjogdGhpcy5oc3YsXG4gICAgICAgICAgICAgICAgICAgIGNteWs6IHRoaXMuY215ayxcbiAgICAgICAgICAgICAgICAgICAgaGV4OiB0aGlzLmhleFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jbGVhcklucHV0SW50ZXJ2YWw6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW5wdXRJbnRlcnZhbCk7XG4gICAgICAgICAgICB0aGlzLmlucHV0SW50ZXJ2YWwgPSBmYWxzZTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGh1ZU1hcCA9IGVsZW1lbnQuZmluZChcIi5odWUtbWFwXCIpO1xuICAgICAgICAgICAgdmFyIGFscGhhTWFwID0gZWxlbWVudC5maW5kKFwiLmFscGhhLW1hcFwiKTtcbiAgICAgICAgICAgIHZhciBzaGFkZU1hcCA9IGVsZW1lbnQuZmluZChcIi5jb2xvci1tYXBcIik7XG4gICAgICAgICAgICB2YXIgY29udHJvbGxlciA9ICQoby5jb250cm9sbGVyKTtcbiAgICAgICAgICAgIHZhciBjb2xvclZhbHVlcyA9IGVsZW1lbnQuZmluZChcIi5jb2xvci12YWx1ZXMtYmxvY2sgaW5wdXRbdHlwZT10ZXh0XVwiKTtcblxuICAgICAgICAgICAgY29sb3JWYWx1ZXMub24oTWV0cm8uZXZlbnRzLmlucHV0Y2hhbmdlLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBpbnB1dCA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9jbGVhcklucHV0SW50ZXJ2YWwoKTtcblxuICAgICAgICAgICAgICAgIGlmICghdGhhdC5pbnB1dEludGVydmFsKSB0aGF0LmlucHV0SW50ZXJ2YWwgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2xvckdyb3VwID0gaW5wdXQuY2xvc2VzdChcIi5jb2xvci1ibG9ja1wiKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbG9yVHlwZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbG9yLCBwYXJ0cztcblxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sb3JHcm91cC5oYXNDbGFzcyhcImNvbG9yLWhleFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3JUeXBlID0gXCJoZXhcIjtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb2xvckdyb3VwLmhhc0NsYXNzKFwiY29sb3ItcmdiXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvclR5cGUgPSBcInJnYlwiO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbG9yR3JvdXAuaGFzQ2xhc3MoXCJjb2xvci1yZ2JhXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvclR5cGUgPSBcInJnYmFcIjtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb2xvckdyb3VwLmhhc0NsYXNzKFwiY29sb3ItaHNsXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvclR5cGUgPSBcImhzbFwiO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbG9yR3JvdXAuaGFzQ2xhc3MoXCJjb2xvci1oc2xhXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvclR5cGUgPSBcImhzbGFcIjtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb2xvckdyb3VwLmhhc0NsYXNzKFwiY29sb3ItaHN2XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvclR5cGUgPSBcImhzdlwiO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbG9yR3JvdXAuaGFzQ2xhc3MoXCJjb2xvci1jbXlrXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvclR5cGUgPSBcImNteWtcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2xvckdyb3VwLmhhc0NsYXNzKFwiYXMtc3RyaW5nXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IGlucHV0LnZhbCgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFydHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChjb2xvckdyb3VwLmZpbmQoXCJpbnB1dFwiKSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0cy5wdXNoKHRoaXMudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IGNvbG9yVHlwZSArIFwiKFwiICtwYXJ0cy5qb2luKFwiLCBcIikrIFwiKVwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2xvciAmJiBNZXRyby5jb2xvcnMuaXNDb2xvcihjb2xvcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQudmFsKGNvbG9yKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2NsZWFySW5wdXRJbnRlcnZhbCgpO1xuICAgICAgICAgICAgICAgIH0sIG8uaW5wdXRUaHJlc2hvbGQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChjb250cm9sbGVyICYmIGNvbnRyb2xsZXIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlci5vbihNZXRyby5ldmVudHMuaW5wdXRjaGFuZ2UsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2NsZWFySW5wdXRJbnRlcnZhbCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoYXQuaW5wdXRJbnRlcnZhbCkgdGhhdC5pbnB1dEludGVydmFsID0gc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbCA9IGNvbnRyb2xsZXIudmFsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsICYmIE1ldHJvLmNvbG9ycy5pc0NvbG9yKHZhbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LnZhbCh2YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fY2xlYXJJbnB1dEludGVydmFsKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIG8uaW5wdXRUaHJlc2hvbGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhbHBoYU1hcC5vbihNZXRyby5ldmVudHMuc3RhcnRBbGwsIGZ1bmN0aW9uKGUpe1xuXG4gICAgICAgICAgICAgICAgdGhhdC5fZ2V0QWxwaGFWYWx1ZShVdGlscy5wYWdlWFkoZSkueSk7XG4gICAgICAgICAgICAgICAgdGhhdC5hbHBoYUN1cnNvci5hZGRDbGFzcyhcImRyYWdnaW5nXCIpO1xuXG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkub24oTWV0cm8uZXZlbnRzLm1vdmVBbGwsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2dldEFscGhhVmFsdWUoVXRpbHMucGFnZVhZKGUpLnkpO1xuICAgICAgICAgICAgICAgIH0sIHtuczogdGhhdC5pZCwgcGFzc2l2ZTogZmFsc2V9KTtcblxuICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKE1ldHJvLmV2ZW50cy5zdG9wQWxsLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmFscGhhQ3Vyc29yLnJlbW92ZUNsYXNzKFwiZHJhZ2dpbmdcIik7XG4gICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihNZXRyby5ldmVudHMubW92ZUFsbCwge25zOiB0aGF0LmlkfSk7XG4gICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihNZXRyby5ldmVudHMuc3RvcEFsbCwge25zOiB0aGF0LmlkfSk7XG4gICAgICAgICAgICAgICAgfSwge25zOiB0aGF0LmlkfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaHVlTWFwLm9uKE1ldHJvLmV2ZW50cy5zdGFydEFsbCwgZnVuY3Rpb24oZSl7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9nZXRIdWVDb2xvcihVdGlscy5wYWdlWFkoZSkueSk7XG4gICAgICAgICAgICAgICAgdGhhdC5odWVDdXJzb3IuYWRkQ2xhc3MoXCJkcmFnZ2luZ1wiKTtcblxuICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKE1ldHJvLmV2ZW50cy5tb3ZlQWxsLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9nZXRIdWVDb2xvcihVdGlscy5wYWdlWFkoZSkueSk7XG4gICAgICAgICAgICAgICAgfSwge25zOiB0aGF0LmlkLCBwYXNzaXZlOiBmYWxzZX0pO1xuXG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkub24oTWV0cm8uZXZlbnRzLnN0b3BBbGwsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaHVlQ3Vyc29yLnJlbW92ZUNsYXNzKFwiZHJhZ2dpbmdcIik7XG4gICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihNZXRyby5ldmVudHMubW92ZUFsbCwge25zOiB0aGF0LmlkfSk7XG4gICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihNZXRyby5ldmVudHMuc3RvcEFsbCwge25zOiB0aGF0LmlkfSk7XG4gICAgICAgICAgICAgICAgfSwge25zOiB0aGF0LmlkfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc2hhZGVNYXAub24oTWV0cm8uZXZlbnRzLnN0YXJ0QWxsLCBmdW5jdGlvbihlKXtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2dldFNoYWRlQ29sb3IoVXRpbHMucGFnZVhZKGUpLngsIFV0aWxzLnBhZ2VYWShlKS55KTtcbiAgICAgICAgICAgICAgICB0aGF0LnNoYWRlQ3Vyc29yLmFkZENsYXNzKFwiZHJhZ2dpbmdcIik7XG5cbiAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vbihNZXRyby5ldmVudHMubW92ZUFsbCwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZ2V0U2hhZGVDb2xvcihVdGlscy5wYWdlWFkoZSkueCwgVXRpbHMucGFnZVhZKGUpLnkpO1xuICAgICAgICAgICAgICAgIH0sIHtuczogdGhhdC5pZCwgcGFzc2l2ZTogZmFsc2V9KTtcblxuICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKE1ldHJvLmV2ZW50cy5zdG9wQWxsLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnNoYWRlQ3Vyc29yLnJlbW92ZUNsYXNzKFwiZHJhZ2dpbmdcIik7XG4gICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihNZXRyby5ldmVudHMubW92ZUFsbCwge25zOiB0aGF0LmlkfSk7XG4gICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihNZXRyby5ldmVudHMuc3RvcEFsbCwge25zOiB0aGF0LmlkfSk7XG4gICAgICAgICAgICAgICAgfSwge25zOiB0aGF0LmlkfSlcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKFwiY2xpY2tcIiwgXCIuc3dhdGNoXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5fY29sb3JUb1BvcygkKHRoaXMpLmF0dHIoXCJkYXRhLWNvbG9yXCIpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKFwiY2xpY2tcIiwgXCIuYWRkLWJ1dHRvblwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBjb2xvciA9IE1ldHJvLmNvbG9ycy50b0hFWChuZXcgTWV0cm8uY29sb3JQcmltaXRpdmUuSFNMKHRoYXQuaHVlLCB0aGF0LnNhdHVyYXRpb24sIHRoYXQubGlnaHRuZXNzKSkudG9VcHBlckNhc2UoKTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGF0LnVzZXJDb2xvcnMuaW5kZXhPZihjb2xvcikgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoYXQudXNlckNvbG9ycy5wdXNoKGNvbG9yKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi51c2VyLWNvbG9yc1wiKS5hcHBlbmQoXG4gICAgICAgICAgICAgICAgICAgICQoXCI8YnV0dG9uPlwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkYXRhLWNvbG9yXCIsIGNvbG9yKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJzd2F0Y2ggdXNlci1zd2F0Y2hcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogY29sb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCJpbnB1dFt0eXBlPXJhZGlvXVwiKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgby5yZXR1cm5WYWx1ZVR5cGUgPSAkKHRoaXMpLnZhbCgpO1xuICAgICAgICAgICAgICAgIHRoYXQuX3NldENvbG9yVmFsdWVzKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICB2YWw6IGZ1bmN0aW9uKHYpe1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZSh2KSB8fCAhTWV0cm8uY29sb3JzLmlzQ29sb3IodikpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoby5yZXR1cm5WYWx1ZVR5cGUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwicmdiXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXMgPSB0aGlzLnJnYjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwicmdiYVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzID0gdGhpcy5yZ2JhO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJoc2xcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IHRoaXMuaHNsO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJoc2xhXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXMgPSB0aGlzLmhzbGE7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImhzdlwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzID0gdGhpcy5oc3Y7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImNteWtcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IHRoaXMuY215aztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiByZXMgPSB0aGlzLmhleDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG8ucmV0dXJuQXNTdHJpbmcgPyByZXMudG9TdHJpbmcoKSA6IHJlcztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFNZXRyby5jb2xvcnMuaXNDb2xvcih2KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2NvbG9yVG9Qb3MoTWV0cm8uY29sb3JzLnBhcnNlKHYpKTtcbiAgICAgICAgfSxcblxuICAgICAgICB1c2VyOiBmdW5jdGlvbih2KXtcbiAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZSh2KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnVzZXJDb2xvcnM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2KSAmJiB0eXBlb2YgdiAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgdiA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIHRoaXMudXNlckNvbG9ycyA9IHYudG9BcnJheShcIixcIikubWFwKGZ1bmN0aW9uIChlbCl7cmV0dXJuIGVsLnRvVXBwZXJDYXNlKCk7fSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudXNlckNvbG9ycyA9IHYubWFwKGZ1bmN0aW9uIChlbCl7cmV0dXJuIGVsLnRvVXBwZXJDYXNlKCk7fSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpbGxVc2VyQ29sb3JzKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2ZpbGxVc2VyQ29sb3JzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGNvbG9ycyA9IHRoaXMuZWxlbWVudC5maW5kKFwiLnVzZXItY29sb3JzXCIpLmNsZWFyKCk7XG5cbiAgICAgICAgICAgICQuZWFjaCh0aGlzLnVzZXJDb2xvcnMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGNvbG9yID0gdGhpcztcbiAgICAgICAgICAgICAgICBjb2xvcnMuYXBwZW5kKFxuICAgICAgICAgICAgICAgICAgICAkKFwiPGJ1dHRvbj5cIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZGF0YS1jb2xvclwiLCBjb2xvcilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHlwZVwiLCBcImJ1dHRvblwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKFwic3dhdGNoIHVzZXItc3dhdGNoXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGNvbG9yXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0ciwgbmV3VmFsdWUpe1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmIChhdHRyID09PSBcImRhdGEtcmV0dXJuLXZhbHVlLXR5cGVcIikge1xuICAgICAgICAgICAgICAgIG8ucmV0dXJuVmFsdWVUeXBlID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChhdHRyID09PSBcImRhdGEtcmV0dXJuLWFzLXN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgby5yZXR1cm5WYWx1ZVR5cGUgPSBVdGlscy5ib29sKG5ld1ZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBNZXRyby5kZWZhdWx0cy5Db2xvclNlbGVjdG9yID0gQ29sb3JTZWxlY3RvckRlZmF1bHRDb25maWc7XG59KE1ldHJvLCBtNHEpKTtcblxyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBUeXBlcyA9IHtcbiAgICAgICAgSEVYOiBcImhleFwiLFxuICAgICAgICBIRVhBOiBcImhleGFcIixcbiAgICAgICAgUkdCOiBcInJnYlwiLFxuICAgICAgICBSR0JBOiBcInJnYmFcIixcbiAgICAgICAgSFNWOiBcImhzdlwiLFxuICAgICAgICBIU0w6IFwiaHNsXCIsXG4gICAgICAgIEhTTEE6IFwiaHNsYVwiLFxuICAgICAgICBDTVlLOiBcImNteWtcIixcbiAgICAgICAgVU5LTk9XTjogXCJ1bmtub3duXCJcbiAgICB9O1xuXG4gICAgTWV0cm8uY29sb3JzU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBDb2xvcnNEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIENvbG9yc0RlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvQ29sb3JzU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5jb2xvcnNTZXR1cCh3aW5kb3dbXCJtZXRyb0NvbG9yc1NldHVwXCJdKTtcbiAgICB9XG5cbiAgICB2YXIgQ29sb3JzRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgYW5nbGU6IDMwLFxuICAgICAgICByZXN1bHRUeXBlOiAnaGV4JyxcbiAgICAgICAgcmVzdWx0czogNixcbiAgICAgICAgYmFzZUxpZ2h0OiBcIiNmZmZmZmZcIixcbiAgICAgICAgYmFzZURhcms6IFwic2VsZlwiXG4gICAgfTtcblxuICAgIC8vIGZ1bmN0aW9uIEhFWChyLCBnLCBiKSB7XG4gICAgLy8gICAgIHRoaXMuciA9IHIgfHwgXCIwMFwiO1xuICAgIC8vICAgICB0aGlzLmcgPSBnIHx8IFwiMDBcIjtcbiAgICAvLyAgICAgdGhpcy5iID0gYiB8fCBcIjAwXCI7XG4gICAgLy8gfVxuICAgIC8vXG4gICAgLy8gSEVYLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCl7XG4gICAgLy8gICAgIHJldHVybiBcIiNcIiArIFt0aGlzLnIsIHRoaXMuZywgdGhpcy5iXS5qb2luKFwiXCIpO1xuICAgIC8vIH1cblxuICAgIC8vIGZ1bmN0aW9uIGRlYzJoZXgoZCl7XG4gICAgLy8gICAgIHJldHVybiBNYXRoLnJvdW5kKHBhcnNlRmxvYXQoZCkgKiAyNTUpLnRvU3RyaW5nKDE2KTtcbiAgICAvLyB9XG4gICAgLy9cbiAgICAvLyBmdW5jdGlvbiBoZXgyZGVjKGgpe1xuICAgIC8vICAgICByZXR1cm4gKHBhcnNlSW50KGgsIDE2KSAvIDI1NSk7XG4gICAgLy8gfVxuXG4gICAgZnVuY3Rpb24gc2hpZnQoaCwgYW5nbGUpe1xuICAgICAgICBoICs9IGFuZ2xlO1xuICAgICAgICB3aGlsZSAoaCA+PSAzNjAuMCkgaCAtPSAzNjAuMDtcbiAgICAgICAgd2hpbGUgKGggPCAwLjApIGggKz0gMzYwLjA7XG4gICAgICAgIHJldHVybiBoO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNsYW1wKHZhbCl7XG4gICAgICAgIHJldHVybiBNYXRoLm1pbigxLCBNYXRoLm1heCgwLCB2YWwpKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBSR0IociwgZywgYil7XG4gICAgICAgIHRoaXMuciA9IHIgfHwgMDtcbiAgICAgICAgdGhpcy5nID0gZyB8fCAwO1xuICAgICAgICB0aGlzLmIgPSBiIHx8IDA7XG4gICAgfVxuXG4gICAgUkdCLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBcInJnYihcIiArIFt0aGlzLnIsIHRoaXMuZywgdGhpcy5iXS5qb2luKFwiLCBcIikgKyBcIilcIjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBSR0JBKHIsIGcsIGIsIGEpe1xuICAgICAgICB0aGlzLnIgPSByIHx8IDA7XG4gICAgICAgIHRoaXMuZyA9IGcgfHwgMDtcbiAgICAgICAgdGhpcy5iID0gYiB8fCAwO1xuICAgICAgICB0aGlzLmEgPSBhID09PSAwID8gMCA6IGEgfHwgMTtcbiAgICB9XG5cbiAgICBSR0JBLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBcInJnYmEoXCIgKyBbdGhpcy5yLCB0aGlzLmcsIHRoaXMuYiwgcGFyc2VGbG9hdCh0aGlzLmEpLnRvRml4ZWQoMildLmpvaW4oXCIsIFwiKSArIFwiKVwiO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIEhTVihoLCBzLCB2KXtcbiAgICAgICAgdGhpcy5oID0gaCB8fCAwO1xuICAgICAgICB0aGlzLnMgPSBzIHx8IDA7XG4gICAgICAgIHRoaXMudiA9IHYgfHwgMDtcbiAgICB9XG5cbiAgICBIU1YucHJvdG90eXBlLnRvU3RyaW5nMiA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBcImhzdihcIiArIFt0aGlzLmgsIHRoaXMucywgdGhpcy52XS5qb2luKFwiLCBcIikgKyBcIilcIjtcbiAgICB9XG5cbiAgICBIU1YucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIFwiaHN2KFwiICsgW01hdGgucm91bmQodGhpcy5oKSwgTWF0aC5yb3VuZCh0aGlzLnMqMTAwKStcIiVcIiwgTWF0aC5yb3VuZCh0aGlzLnYqMTAwKStcIiVcIl0uam9pbihcIiwgXCIpICsgXCIpXCI7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gSFNMKGgsIHMsIGwpe1xuICAgICAgICB0aGlzLmggPSBoIHx8IDA7XG4gICAgICAgIHRoaXMucyA9IHMgfHwgMDtcbiAgICAgICAgdGhpcy5sID0gbCB8fCAwO1xuICAgIH1cblxuICAgIEhTTC5wcm90b3R5cGUudG9TdHJpbmcyID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIFwiaHNsKFwiICsgW3RoaXMuaCwgdGhpcy5zLCB0aGlzLmxdLmpvaW4oXCIsIFwiKSArIFwiKVwiO1xuICAgIH1cblxuICAgIEhTTC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gXCJoc2woXCIgKyBbTWF0aC5yb3VuZCh0aGlzLmgpLCBNYXRoLnJvdW5kKHRoaXMucyoxMDApK1wiJVwiLCBNYXRoLnJvdW5kKHRoaXMubCoxMDApK1wiJVwiXS5qb2luKFwiLCBcIikgKyBcIilcIjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBIU0xBKGgsIHMsIGwsIGEpe1xuICAgICAgICB0aGlzLmggPSBoIHx8IDA7XG4gICAgICAgIHRoaXMucyA9IHMgfHwgMDtcbiAgICAgICAgdGhpcy5sID0gbCB8fCAwO1xuICAgICAgICB0aGlzLmEgPSBhID09PSAwID8gMCA6IGEgfHwgMTtcbiAgICB9XG5cbiAgICBIU0xBLnByb3RvdHlwZS50b1N0cmluZzIgPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gXCJoc2xhKFwiICsgW3RoaXMuaCwgdGhpcy5zLCB0aGlzLmwsIHRoaXMuYV0uam9pbihcIiwgXCIpICsgXCIpXCI7XG4gICAgfVxuXG4gICAgSFNMQS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gXCJoc2xhKFwiICsgW01hdGgucm91bmQodGhpcy5oKSwgTWF0aC5yb3VuZCh0aGlzLnMqMTAwKStcIiVcIiwgTWF0aC5yb3VuZCh0aGlzLmwqMTAwKStcIiVcIiwgcGFyc2VGbG9hdCh0aGlzLmEpLnRvRml4ZWQoMildLmpvaW4oXCIsIFwiKSArIFwiKVwiO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIENNWUsoYywgbSwgeSwgayl7XG4gICAgICAgIHRoaXMuYyA9IGMgfHwgMDtcbiAgICAgICAgdGhpcy5tID0gbSB8fCAwO1xuICAgICAgICB0aGlzLnkgPSB5IHx8IDA7XG4gICAgICAgIHRoaXMuayA9IGsgfHwgMDtcbiAgICB9XG5cbiAgICBDTVlLLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBcImNteWsoXCIgKyBbdGhpcy5jLCB0aGlzLm0sIHRoaXMueSwgdGhpcy5rXS5qb2luKFwiLCBcIikgKyBcIilcIjtcbiAgICB9XG5cbiAgICB2YXIgQ29sb3JzID0ge1xuXG4gICAgICAgIFBBTEVUVEVTOiB7XG4gICAgICAgICAgICBBTEw6IFwiYWxsXCIsXG4gICAgICAgICAgICBNRVRSTzogXCJtZXRyb1wiLFxuICAgICAgICAgICAgU1RBTkRBUkQ6IFwic3RhbmRhcmRcIlxuICAgICAgICB9LFxuXG4gICAgICAgIG1ldHJvOiB7XG4gICAgICAgICAgICBsaW1lOiAnI2E0YzQwMCcsXG4gICAgICAgICAgICBncmVlbjogJyM2MGE5MTcnLFxuICAgICAgICAgICAgZW1lcmFsZDogJyMwMDhhMDAnLFxuICAgICAgICAgICAgYmx1ZTogJyMwMEFGRjAnLFxuICAgICAgICAgICAgdGVhbDogJyMwMGFiYTknLFxuICAgICAgICAgICAgY3lhbjogJyMxYmExZTInLFxuICAgICAgICAgICAgY29iYWx0OiAnIzAwNTBlZicsXG4gICAgICAgICAgICBpbmRpZ286ICcjNmEwMGZmJyxcbiAgICAgICAgICAgIHZpb2xldDogJyNhYTAwZmYnLFxuICAgICAgICAgICAgcGluazogJyNkYzRmYWQnLFxuICAgICAgICAgICAgbWFnZW50YTogJyNkODAwNzMnLFxuICAgICAgICAgICAgY3JpbXNvbjogJyNhMjAwMjUnLFxuICAgICAgICAgICAgcmVkOiAnI0NFMzUyQycsXG4gICAgICAgICAgICBvcmFuZ2U6ICcjZmE2ODAwJyxcbiAgICAgICAgICAgIGFtYmVyOiAnI2YwYTMwYScsXG4gICAgICAgICAgICB5ZWxsb3c6ICcjZmZmMDAwJyxcbiAgICAgICAgICAgIGJyb3duOiAnIzgyNWEyYycsXG4gICAgICAgICAgICBvbGl2ZTogJyM2ZDg3NjQnLFxuICAgICAgICAgICAgc3RlZWw6ICcjNjQ3Njg3JyxcbiAgICAgICAgICAgIG1hdXZlOiAnIzc2NjA4YScsXG4gICAgICAgICAgICB0YXVwZTogJyM4Nzc5NGUnXG4gICAgICAgIH0sXG5cbiAgICAgICAgc3RhbmRhcmQ6IHtcbiAgICAgICAgICAgIGFsaWNlYmx1ZTogXCIjZjBmOGZmXCIsXG4gICAgICAgICAgICBhbnRpcXVld2hpdGU6IFwiI2ZhZWJkN1wiLFxuICAgICAgICAgICAgYXF1YTogXCIjMDBmZmZmXCIsXG4gICAgICAgICAgICBhcXVhbWFyaW5lOiBcIiM3ZmZmZDRcIixcbiAgICAgICAgICAgIGF6dXJlOiBcIiNmMGZmZmZcIixcbiAgICAgICAgICAgIGJlaWdlOiBcIiNmNWY1ZGNcIixcbiAgICAgICAgICAgIGJpc3F1ZTogXCIjZmZlNGM0XCIsXG4gICAgICAgICAgICBibGFjazogXCIjMDAwMDAwXCIsXG4gICAgICAgICAgICBibGFuY2hlZGFsbW9uZDogXCIjZmZlYmNkXCIsXG4gICAgICAgICAgICBibHVlOiBcIiMwMDAwZmZcIixcbiAgICAgICAgICAgIGJsdWV2aW9sZXQ6IFwiIzhhMmJlMlwiLFxuICAgICAgICAgICAgYnJvd246IFwiI2E1MmEyYVwiLFxuICAgICAgICAgICAgYnVybHl3b29kOiBcIiNkZWI4ODdcIixcbiAgICAgICAgICAgIGNhZGV0Ymx1ZTogXCIjNWY5ZWEwXCIsXG4gICAgICAgICAgICBjaGFydHJldXNlOiBcIiM3ZmZmMDBcIixcbiAgICAgICAgICAgIGNob2NvbGF0ZTogXCIjZDI2OTFlXCIsXG4gICAgICAgICAgICBjb3JhbDogXCIjZmY3ZjUwXCIsXG4gICAgICAgICAgICBjb3JuZmxvd2VyYmx1ZTogXCIjNjQ5NWVkXCIsXG4gICAgICAgICAgICBjb3Juc2lsazogXCIjZmZmOGRjXCIsXG4gICAgICAgICAgICBjcmltc29uOiBcIiNkYzE0M2NcIixcbiAgICAgICAgICAgIGN5YW46IFwiIzAwZmZmZlwiLFxuICAgICAgICAgICAgZGFya2JsdWU6IFwiIzAwMDA4YlwiLFxuICAgICAgICAgICAgZGFya2N5YW46IFwiIzAwOGI4YlwiLFxuICAgICAgICAgICAgZGFya2dvbGRlbnJvZDogXCIjYjg4NjBiXCIsXG4gICAgICAgICAgICBkYXJrZ3JheTogXCIjYTlhOWE5XCIsXG4gICAgICAgICAgICBkYXJrZ3JlZW46IFwiIzAwNjQwMFwiLFxuICAgICAgICAgICAgZGFya2toYWtpOiBcIiNiZGI3NmJcIixcbiAgICAgICAgICAgIGRhcmttYWdlbnRhOiBcIiM4YjAwOGJcIixcbiAgICAgICAgICAgIGRhcmtvbGl2ZWdyZWVuOiBcIiM1NTZiMmZcIixcbiAgICAgICAgICAgIGRhcmtvcmFuZ2U6IFwiI2ZmOGMwMFwiLFxuICAgICAgICAgICAgZGFya29yY2hpZDogXCIjOTkzMmNjXCIsXG4gICAgICAgICAgICBkYXJrcmVkOiBcIiM4YjAwMDBcIixcbiAgICAgICAgICAgIGRhcmtzYWxtb246IFwiI2U5OTY3YVwiLFxuICAgICAgICAgICAgZGFya3NlYWdyZWVuOiBcIiM4ZmJjOGZcIixcbiAgICAgICAgICAgIGRhcmtzbGF0ZWJsdWU6IFwiIzQ4M2Q4YlwiLFxuICAgICAgICAgICAgZGFya3NsYXRlZ3JheTogXCIjMmY0ZjRmXCIsXG4gICAgICAgICAgICBkYXJrdHVycXVvaXNlOiBcIiMwMGNlZDFcIixcbiAgICAgICAgICAgIGRhcmt2aW9sZXQ6IFwiIzk0MDBkM1wiLFxuICAgICAgICAgICAgZGVlcHBpbms6IFwiI2ZmMTQ5M1wiLFxuICAgICAgICAgICAgZGVlcHNreWJsdWU6IFwiIzAwYmZmZlwiLFxuICAgICAgICAgICAgZGltZ3JheTogXCIjNjk2OTY5XCIsXG4gICAgICAgICAgICBkb2RnZXJibHVlOiBcIiMxZTkwZmZcIixcbiAgICAgICAgICAgIGZpcmVicmljazogXCIjYjIyMjIyXCIsXG4gICAgICAgICAgICBmbG9yYWx3aGl0ZTogXCIjZmZmYWYwXCIsXG4gICAgICAgICAgICBmb3Jlc3RncmVlbjogXCIjMjI4YjIyXCIsXG4gICAgICAgICAgICBmdWNoc2lhOiBcIiNmZjAwZmZcIixcbiAgICAgICAgICAgIGdhaW5zYm9ybzogXCIjRENEQ0RDXCIsXG4gICAgICAgICAgICBnaG9zdHdoaXRlOiBcIiNGOEY4RkZcIixcbiAgICAgICAgICAgIGdvbGQ6IFwiI2ZmZDcwMFwiLFxuICAgICAgICAgICAgZ29sZGVucm9kOiBcIiNkYWE1MjBcIixcbiAgICAgICAgICAgIGdyYXk6IFwiIzgwODA4MFwiLFxuICAgICAgICAgICAgZ3JlZW46IFwiIzAwODAwMFwiLFxuICAgICAgICAgICAgZ3JlZW55ZWxsb3c6IFwiI2FkZmYyZlwiLFxuICAgICAgICAgICAgaG9uZXlkZXc6IFwiI2YwZmZmMFwiLFxuICAgICAgICAgICAgaG90cGluazogXCIjZmY2OWI0XCIsXG4gICAgICAgICAgICBpbmRpYW5yZWQ6IFwiI2NkNWM1Y1wiLFxuICAgICAgICAgICAgaW5kaWdvOiBcIiM0YjAwODJcIixcbiAgICAgICAgICAgIGl2b3J5OiBcIiNmZmZmZjBcIixcbiAgICAgICAgICAgIGtoYWtpOiBcIiNmMGU2OGNcIixcbiAgICAgICAgICAgIGxhdmVuZGVyOiBcIiNlNmU2ZmFcIixcbiAgICAgICAgICAgIGxhdmVuZGVyYmx1c2g6IFwiI2ZmZjBmNVwiLFxuICAgICAgICAgICAgbGF3bmdyZWVuOiBcIiM3Y2ZjMDBcIixcbiAgICAgICAgICAgIGxlbW9uY2hpZmZvbjogXCIjZmZmYWNkXCIsXG4gICAgICAgICAgICBsaWdodGJsdWU6IFwiI2FkZDhlNlwiLFxuICAgICAgICAgICAgbGlnaHRjb3JhbDogXCIjZjA4MDgwXCIsXG4gICAgICAgICAgICBsaWdodGN5YW46IFwiI2UwZmZmZlwiLFxuICAgICAgICAgICAgbGlnaHRnb2xkZW5yb2R5ZWxsb3c6IFwiI2ZhZmFkMlwiLFxuICAgICAgICAgICAgbGlnaHRncmF5OiBcIiNkM2QzZDNcIixcbiAgICAgICAgICAgIGxpZ2h0Z3JlZW46IFwiIzkwZWU5MFwiLFxuICAgICAgICAgICAgbGlnaHRwaW5rOiBcIiNmZmI2YzFcIixcbiAgICAgICAgICAgIGxpZ2h0c2FsbW9uOiBcIiNmZmEwN2FcIixcbiAgICAgICAgICAgIGxpZ2h0c2VhZ3JlZW46IFwiIzIwYjJhYVwiLFxuICAgICAgICAgICAgbGlnaHRza3libHVlOiBcIiM4N2NlZmFcIixcbiAgICAgICAgICAgIGxpZ2h0c2xhdGVncmF5OiBcIiM3Nzg4OTlcIixcbiAgICAgICAgICAgIGxpZ2h0c3RlZWxibHVlOiBcIiNiMGM0ZGVcIixcbiAgICAgICAgICAgIGxpZ2h0eWVsbG93OiBcIiNmZmZmZTBcIixcbiAgICAgICAgICAgIGxpbWU6IFwiIzAwZmYwMFwiLFxuICAgICAgICAgICAgbGltZWdyZWVuOiBcIiMzMmRjMzJcIixcbiAgICAgICAgICAgIGxpbmVuOiBcIiNmYWYwZTZcIixcbiAgICAgICAgICAgIG1hZ2VudGE6IFwiI2ZmMDBmZlwiLFxuICAgICAgICAgICAgbWFyb29uOiBcIiM4MDAwMDBcIixcbiAgICAgICAgICAgIG1lZGl1bWFxdWFtYXJpbmU6IFwiIzY2Y2RhYVwiLFxuICAgICAgICAgICAgbWVkaXVtYmx1ZTogXCIjMDAwMGNkXCIsXG4gICAgICAgICAgICBtZWRpdW1vcmNoaWQ6IFwiI2JhNTVkM1wiLFxuICAgICAgICAgICAgbWVkaXVtcHVycGxlOiBcIiM5MzcwZGJcIixcbiAgICAgICAgICAgIG1lZGl1bXNlYWdyZWVuOiBcIiMzY2IzNzFcIixcbiAgICAgICAgICAgIG1lZGl1bXNsYXRlYmx1ZTogXCIjN2I2OGVlXCIsXG4gICAgICAgICAgICBtZWRpdW1zcHJpbmdncmVlbjogXCIjMDBmYTlhXCIsXG4gICAgICAgICAgICBtZWRpdW10dXJxdW9pc2U6IFwiIzQ4ZDFjY1wiLFxuICAgICAgICAgICAgbWVkaXVtdmlvbGV0cmVkOiBcIiNjNzE1ODVcIixcbiAgICAgICAgICAgIG1pZG5pZ2h0Ymx1ZTogXCIjMTkxOTcwXCIsXG4gICAgICAgICAgICBtaW50Y3JlYW06IFwiI2Y1ZmZmYVwiLFxuICAgICAgICAgICAgbWlzdHlyb3NlOiBcIiNmZmU0ZTFcIixcbiAgICAgICAgICAgIG1vY2Nhc2luOiBcIiNmZmU0YjVcIixcbiAgICAgICAgICAgIG5hdmFqb3doaXRlOiBcIiNmZmRlYWRcIixcbiAgICAgICAgICAgIG5hdnk6IFwiIzAwMDA4MFwiLFxuICAgICAgICAgICAgb2xkbGFjZTogXCIjZmRkNWU2XCIsXG4gICAgICAgICAgICBvbGl2ZTogXCIjODA4MDAwXCIsXG4gICAgICAgICAgICBvbGl2ZWRyYWI6IFwiIzZiOGUyM1wiLFxuICAgICAgICAgICAgb3JhbmdlOiBcIiNmZmE1MDBcIixcbiAgICAgICAgICAgIG9yYW5nZXJlZDogXCIjZmY0NTAwXCIsXG4gICAgICAgICAgICBvcmNoaWQ6IFwiI2RhNzBkNlwiLFxuICAgICAgICAgICAgcGFsZWdvbGRlbnJvZDogXCIjZWVlOGFhXCIsXG4gICAgICAgICAgICBwYWxlZ3JlZW46IFwiIzk4ZmI5OFwiLFxuICAgICAgICAgICAgcGFsZXR1cnF1b2lzZTogXCIjYWZlZWVlXCIsXG4gICAgICAgICAgICBwYWxldmlvbGV0cmVkOiBcIiNkYjcwOTNcIixcbiAgICAgICAgICAgIHBhcGF5YXdoaXA6IFwiI2ZmZWZkNVwiLFxuICAgICAgICAgICAgcGVhY2hwdWZmOiBcIiNmZmRhYjlcIixcbiAgICAgICAgICAgIHBlcnU6IFwiI2NkODUzZlwiLFxuICAgICAgICAgICAgcGluazogXCIjZmZjMGNiXCIsXG4gICAgICAgICAgICBwbHVtOiBcIiNkZGEwZGRcIixcbiAgICAgICAgICAgIHBvd2RlcmJsdWU6IFwiI2IwZTBlNlwiLFxuICAgICAgICAgICAgcHVycGxlOiBcIiM4MDAwODBcIixcbiAgICAgICAgICAgIHJlYmVjY2FwdXJwbGU6IFwiIzY2MzM5OVwiLFxuICAgICAgICAgICAgcmVkOiBcIiNmZjAwMDBcIixcbiAgICAgICAgICAgIHJvc3licm93bjogXCIjYmM4ZjhmXCIsXG4gICAgICAgICAgICByb3lhbGJsdWU6IFwiIzQxNjllMVwiLFxuICAgICAgICAgICAgc2FkZGxlYnJvd246IFwiIzhiNDUxM1wiLFxuICAgICAgICAgICAgc2FsbW9uOiBcIiNmYTgwNzJcIixcbiAgICAgICAgICAgIHNhbmR5YnJvd246IFwiI2Y0YTQ2MFwiLFxuICAgICAgICAgICAgc2VhZ3JlZW46IFwiIzJlOGI1N1wiLFxuICAgICAgICAgICAgc2Vhc2hlbGw6IFwiI2ZmZjVlZVwiLFxuICAgICAgICAgICAgc2llbm5hOiBcIiNhMDUyMmRcIixcbiAgICAgICAgICAgIHNpbHZlcjogXCIjYzBjMGMwXCIsXG4gICAgICAgICAgICBzbHlibHVlOiBcIiM4N2NlZWJcIixcbiAgICAgICAgICAgIHNsYXRlYmx1ZTogXCIjNmE1YWNkXCIsXG4gICAgICAgICAgICBzbGF0ZWdyYXk6IFwiIzcwODA5MFwiLFxuICAgICAgICAgICAgc25vdzogXCIjZmZmYWZhXCIsXG4gICAgICAgICAgICBzcHJpbmdncmVlbjogXCIjMDBmZjdmXCIsXG4gICAgICAgICAgICBzdGVlbGJsdWU6IFwiIzQ2ODJiNFwiLFxuICAgICAgICAgICAgdGFuOiBcIiNkMmI0OGNcIixcbiAgICAgICAgICAgIHRlYWw6IFwiIzAwODA4MFwiLFxuICAgICAgICAgICAgdGhpc3RsZTogXCIjZDhiZmQ4XCIsXG4gICAgICAgICAgICB0b21hdG86IFwiI2ZmNjM0N1wiLFxuICAgICAgICAgICAgdHVycXVvaXNlOiBcIiM0MGUwZDBcIixcbiAgICAgICAgICAgIHZpb2xldDogXCIjZWU4MmVlXCIsXG4gICAgICAgICAgICB3aGVhdDogXCIjZjVkZWIzXCIsXG4gICAgICAgICAgICB3aGl0ZTogXCIjZmZmZmZmXCIsXG4gICAgICAgICAgICB3aGl0ZXNtb2tlOiBcIiNmNWY1ZjVcIixcbiAgICAgICAgICAgIHllbGxvdzogXCIjZmZmZjAwXCIsXG4gICAgICAgICAgICB5ZWxsb3dncmVlbjogXCIjOWFjZDMyXCJcbiAgICAgICAgfSxcblxuICAgICAgICBhbGw6IHt9LFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmFsbCA9ICQuZXh0ZW5kKCB7fSwgdGhpcy5zdGFuZGFyZCwgdGhpcy5tZXRybyApO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY29sb3I6IGZ1bmN0aW9uKG5hbWUsIHBhbGV0dGUpe1xuICAgICAgICAgICAgcGFsZXR0ZSA9IHBhbGV0dGUgfHwgdGhpcy5QQUxFVFRFUy5BTEw7XG4gICAgICAgICAgICByZXR1cm4gdGhpc1twYWxldHRlXVtuYW1lXSAhPT0gdW5kZWZpbmVkID8gdGhpc1twYWxldHRlXVtuYW1lXSA6IGZhbHNlO1xuICAgICAgICB9LFxuXG4gICAgICAgIHBhbGV0dGU6IGZ1bmN0aW9uKHBhbGV0dGUpe1xuICAgICAgICAgICAgcGFsZXR0ZSA9IHBhbGV0dGUgfHwgdGhpcy5QQUxFVFRFUy5BTEw7XG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LmtleXModGhpc1twYWxldHRlXSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXhwYW5kSGV4Q29sb3I6IGZ1bmN0aW9uKGhleCl7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGhleCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlZhbHVlIGlzIG5vdCBhIHN0cmluZyFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaGV4WzBdID09PSBcIiNcIiAmJiBoZXgubGVuZ3RoID09PSA0KSB7XG4gICAgICAgICAgICAgICAgdmFyIHNob3J0aGFuZFJlZ2V4ID0gL14jPyhbYS1mXFxkXSkoW2EtZlxcZF0pKFthLWZcXGRdKSQvaTtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgICBcIiNcIiArXG4gICAgICAgICAgICAgICAgICAgIGhleC5yZXBsYWNlKHNob3J0aGFuZFJlZ2V4LCBmdW5jdGlvbihtLCByLCBnLCBiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gciArIHIgKyBnICsgZyArIGIgKyBiO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaGV4WzBdID09PSBcIiNcIiA/IGhleCA6IFwiI1wiICsgaGV4O1xuICAgICAgICB9LFxuXG4gICAgICAgIGNvbG9yczogZnVuY3Rpb24ocGFsZXR0ZSl7XG4gICAgICAgICAgICBwYWxldHRlID0gcGFsZXR0ZSB8fCB0aGlzLlBBTEVUVEVTLkFMTDtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKHRoaXNbcGFsZXR0ZV0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJhbmRvbTogZnVuY3Rpb24oY29sb3JUeXBlLCBhbHBoYSl7XG4gICAgICAgICAgICBjb2xvclR5cGUgPSBjb2xvclR5cGUgfHwgVHlwZXMuSEVYO1xuICAgICAgICAgICAgYWxwaGEgPSB0eXBlb2YgYWxwaGEgIT09IFwidW5kZWZpbmVkXCIgPyBhbHBoYSA6IDE7XG5cbiAgICAgICAgICAgIHZhciBoZXgsIHIsIGcsIGI7XG5cbiAgICAgICAgICAgIHIgPSAkLnJhbmRvbSgwLCAyNTUpO1xuICAgICAgICAgICAgZyA9ICQucmFuZG9tKDAsIDI1NSk7XG4gICAgICAgICAgICBiID0gJC5yYW5kb20oMCwgMjU1KTtcblxuICAgICAgICAgICAgaGV4ID0gXCIjXCIgKyAoKDEgPDwgMjQpICsgKHIgPDwgMTYpICsgKGcgPDwgOCkgKyBiKS50b1N0cmluZygxNikuc2xpY2UoMSk7XG5cbiAgICAgICAgICAgIHJldHVybiBjb2xvclR5cGUgPT09IFwiaGV4XCIgPyBoZXggOiB0aGlzLnRvQ29sb3IoaGV4LCBjb2xvclR5cGUsIGFscGhhKTtcbiAgICAgICAgfSxcblxuICAgICAgICBwYXJzZTogZnVuY3Rpb24oY29sb3Ipe1xuICAgICAgICAgICAgdmFyIF9jb2xvciA9IGNvbG9yLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuXG4gICAgICAgICAgICB2YXIgYSA9IF9jb2xvclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bXiVcXGQuLF0vZywgXCJcIilcbiAgICAgICAgICAgICAgICAuc3BsaXQoXCIsXCIpXG4gICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbih2KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2LmluZGV4T2YoJyUnKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2ID0gXCJcIitwYXJzZUludCh2KS8xMDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHYuaW5kZXhPZihcIi5cIikgPiAtMSA/IHBhcnNlRmxvYXQodikgOiBwYXJzZUludCh2KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKHRoaXMubWV0cm9bX2NvbG9yXSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmV4cGFuZEhleENvbG9yKHRoaXMubWV0cm9bX2NvbG9yXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnN0YW5kYXJkW19jb2xvcl0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5leHBhbmRIZXhDb2xvcih0aGlzLnN0YW5kYXJkW19jb2xvcl0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoX2NvbG9yWzBdID09PSBcIiNcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmV4cGFuZEhleENvbG9yKF9jb2xvcik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChfY29sb3IuaW5kZXhPZihcInJnYmFcIikgPT09IDAgJiYgYS5sZW5ndGggPT09IDQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJHQkEoYVswXSwgYVsxXSwgYVsyXSwgYVszXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoX2NvbG9yLmluZGV4T2YoXCJyZ2JcIikgPT09IDAgJiYgYS5sZW5ndGggPT09IDMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJHQihhWzBdLCBhWzFdLCBhWzJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChfY29sb3IuaW5kZXhPZihcImNteWtcIikgPT09IDAgJiYgYS5sZW5ndGggPT09IDQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IENNWUsoYVswXSwgYVsxXSwgYVsyXSwgYVszXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoX2NvbG9yLmluZGV4T2YoXCJoc3ZcIikgPT09IDAgJiYgYS5sZW5ndGggPT09IDMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEhTVihhWzBdLCBhWzFdLCBhWzJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChfY29sb3IuaW5kZXhPZihcImhzbGFcIikgPT09IDAgJiYgYS5sZW5ndGggPT09IDQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEhTTEEoYVswXSwgYVsxXSwgYVsyXSwgYVszXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoX2NvbG9yLmluZGV4T2YoXCJoc2xcIikgID09PSAwICYmIGEubGVuZ3RoID09PSAzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBIU0woYVswXSwgYVsxXSwgYVsyXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNyZWF0ZUNvbG9yOiBmdW5jdGlvbihjb2xvclR5cGUsIGZyb20pe1xuICAgICAgICAgICAgY29sb3JUeXBlID0gY29sb3JUeXBlIHx8IFwiaGV4XCI7XG4gICAgICAgICAgICBmcm9tID0gZnJvbSB8fCBcIiMwMDAwMDBcIjtcblxuICAgICAgICAgICAgdmFyIGJhc2VDb2xvcjtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBmcm9tID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgYmFzZUNvbG9yID0gdGhpcy5wYXJzZShmcm9tKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzQ29sb3IoYmFzZUNvbG9yKSkge1xuICAgICAgICAgICAgICAgIGJhc2VDb2xvciA9IFwiIzAwMDAwMFwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy50b0NvbG9yKGJhc2VDb2xvciwgY29sb3JUeXBlLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzRGFyazogZnVuY3Rpb24oY29sb3Ipe1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzQ29sb3IoY29sb3IpKSByZXR1cm47XG4gICAgICAgICAgICB2YXIgcmdiID0gdGhpcy50b1JHQihjb2xvcik7XG4gICAgICAgICAgICB2YXIgWUlRID0gKHJnYi5yICogMjk5ICsgcmdiLmcgKiA1ODcgKyByZ2IuYiAqIDExNCkgLyAxMDAwO1xuICAgICAgICAgICAgcmV0dXJuIFlJUSA8IDEyODtcbiAgICAgICAgfSxcblxuICAgICAgICBpc0xpZ2h0OiBmdW5jdGlvbihjb2xvcil7XG4gICAgICAgICAgICByZXR1cm4gIXRoaXMuaXNEYXJrKGNvbG9yKTtcbiAgICAgICAgfSxcblxuICAgICAgICBpc0hTVjogZnVuY3Rpb24oY29sb3Ipe1xuICAgICAgICAgICAgcmV0dXJuIGNvbG9yIGluc3RhbmNlb2YgSFNWO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzSFNMOiBmdW5jdGlvbihjb2xvcil7XG4gICAgICAgICAgICByZXR1cm4gY29sb3IgaW5zdGFuY2VvZiBIU0w7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNIU0xBOiBmdW5jdGlvbihjb2xvcil7XG4gICAgICAgICAgICByZXR1cm4gY29sb3IgaW5zdGFuY2VvZiBIU0xBO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzUkdCOiBmdW5jdGlvbihjb2xvcil7XG4gICAgICAgICAgICByZXR1cm4gY29sb3IgaW5zdGFuY2VvZiBSR0I7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNSR0JBOiBmdW5jdGlvbihjb2xvcil7XG4gICAgICAgICAgICByZXR1cm4gY29sb3IgaW5zdGFuY2VvZiBSR0JBO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzQ01ZSzogZnVuY3Rpb24oY29sb3Ipe1xuICAgICAgICAgICAgcmV0dXJuIGNvbG9yIGluc3RhbmNlb2YgQ01ZSztcbiAgICAgICAgfSxcblxuICAgICAgICBpc0hFWDogZnVuY3Rpb24oY29sb3Ipe1xuICAgICAgICAgICAgcmV0dXJuIC8oXiNbMC05QS1GXXs2fSQpfCheI1swLTlBLUZdezN9JCkvaS50ZXN0KGNvbG9yKTtcbiAgICAgICAgfSxcblxuICAgICAgICBpc0NvbG9yOiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgdmFyIGNvbG9yID0gdHlwZW9mIHZhbCA9PT0gXCJzdHJpbmdcIiA/IHRoaXMucGFyc2UodmFsKSA6IHZhbDtcblxuICAgICAgICAgICAgcmV0dXJuICFjb2xvclxuICAgICAgICAgICAgICAgID8gZmFsc2VcbiAgICAgICAgICAgICAgICA6IHRoaXMuaXNIRVgoY29sb3IpIHx8XG4gICAgICAgICAgICAgICAgICB0aGlzLmlzUkdCKGNvbG9yKSB8fFxuICAgICAgICAgICAgICAgICAgdGhpcy5pc1JHQkEoY29sb3IpIHx8XG4gICAgICAgICAgICAgICAgICB0aGlzLmlzSFNWKGNvbG9yKSB8fFxuICAgICAgICAgICAgICAgICAgdGhpcy5pc0hTTChjb2xvcikgfHxcbiAgICAgICAgICAgICAgICAgIHRoaXMuaXNIU0xBKGNvbG9yKSB8fFxuICAgICAgICAgICAgICAgICAgdGhpcy5pc0NNWUsoY29sb3IpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoZWNrOiBmdW5jdGlvbihjb2xvciwgdHlwZSl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGNoZWNrRm9yID0gdHlwZW9mIHR5cGUgPT09IFwic3RyaW5nXCIgPyBbdHlwZV0gOiB0eXBlO1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAkLmVhY2goY2hlY2tGb3IsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKHRoYXRbXCJpc1wiK3RoaXMudG9VcHBlckNhc2UoKV0oY29sb3IpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICghcmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVmFsdWUgaXMgbm90IGEgXCIgKyB0eXBlICsgXCIgY29sb3IgdHlwZSFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY29sb3JUeXBlOiBmdW5jdGlvbihjb2xvcil7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0hFWChjb2xvcikpIHJldHVybiBUeXBlcy5IRVg7XG4gICAgICAgICAgICBpZiAodGhpcy5pc1JHQihjb2xvcikpIHJldHVybiBUeXBlcy5SR0I7XG4gICAgICAgICAgICBpZiAodGhpcy5pc1JHQkEoY29sb3IpKSByZXR1cm4gVHlwZXMuUkdCQTtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzSFNWKGNvbG9yKSkgcmV0dXJuIFR5cGVzLkhTVjtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzSFNMKGNvbG9yKSkgcmV0dXJuIFR5cGVzLkhTTDtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzSFNMQShjb2xvcikpIHJldHVybiBUeXBlcy5IU0xBO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNDTVlLKGNvbG9yKSkgcmV0dXJuIFR5cGVzLkNNWUs7XG5cbiAgICAgICAgICAgIHJldHVybiBUeXBlcy5VTktOT1dOO1xuICAgICAgICB9LFxuXG4gICAgICAgIGVxdWFsOiBmdW5jdGlvbihjb2xvcjEsIGNvbG9yMil7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNDb2xvcihjb2xvcjEpIHx8ICF0aGlzLmlzQ29sb3IoY29sb3IyKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudG9IRVgoY29sb3IxKSA9PT0gdGhpcy50b0hFWChjb2xvcjIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNvbG9yVG9TdHJpbmc6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgIHJldHVybiBjb2xvci50b1N0cmluZygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhleDJyZ2I6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29sb3IgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJWYWx1ZSBpcyBub3QgYSBzdHJpbmchXCIpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gL14jPyhbYS1mXFxkXXsyfSkoW2EtZlxcZF17Mn0pKFthLWZcXGRdezJ9KSQvaS5leGVjKFxuICAgICAgICAgICAgICAgIHRoaXMuZXhwYW5kSGV4Q29sb3IoY29sb3IpXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdmFyIHJnYiA9IFtcbiAgICAgICAgICAgICAgICBwYXJzZUludChyZXN1bHRbMV0sIDE2KSxcbiAgICAgICAgICAgICAgICBwYXJzZUludChyZXN1bHRbMl0sIDE2KSxcbiAgICAgICAgICAgICAgICBwYXJzZUludChyZXN1bHRbM10sIDE2KVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQgPyBuZXcgUkdCKHJnYlswXSwgcmdiWzFdLCByZ2JbMl0pIDogbnVsbDtcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBUT0RPIGNhbiBiZSBpbXByb3ZlZFxuICAgICAgICByZ2IyaGV4OiBmdW5jdGlvbihjb2xvcil7XG4gICAgICAgICAgICB0aGlzLmNoZWNrKGNvbG9yLCBcInJnYlwiKTtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgXCIjXCIgK1xuICAgICAgICAgICAgICAgICgoMSA8PCAyNCkgKyAoY29sb3IuciA8PCAxNikgKyAoY29sb3IuZyA8PCA4KSArIGNvbG9yLmIpLnRvU3RyaW5nKDE2KS5zbGljZSgxKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZ2IyaHN2OiBmdW5jdGlvbihjb2xvcil7XG4gICAgICAgICAgICB0aGlzLmNoZWNrKGNvbG9yLCBcInJnYlwiKTtcbiAgICAgICAgICAgIHZhciBoc3YgPSBuZXcgSFNWKCk7XG4gICAgICAgICAgICB2YXIgaCwgcywgdjtcbiAgICAgICAgICAgIHZhciByID0gY29sb3IuciAvIDI1NSxcbiAgICAgICAgICAgICAgICBnID0gY29sb3IuZyAvIDI1NSxcbiAgICAgICAgICAgICAgICBiID0gY29sb3IuYiAvIDI1NTtcblxuICAgICAgICAgICAgdmFyIG1heCA9IE1hdGgubWF4KHIsIGcsIGIpO1xuICAgICAgICAgICAgdmFyIG1pbiA9IE1hdGgubWluKHIsIGcsIGIpO1xuICAgICAgICAgICAgdmFyIGRlbHRhID0gbWF4IC0gbWluO1xuXG4gICAgICAgICAgICB2ID0gbWF4O1xuXG4gICAgICAgICAgICBpZiAobWF4ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcyA9IDA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHMgPSAxIC0gbWluIC8gbWF4O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobWF4ID09PSBtaW4pIHtcbiAgICAgICAgICAgICAgICBoID0gMDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobWF4ID09PSByICYmIGcgPj0gYikge1xuICAgICAgICAgICAgICAgIGggPSA2MCAqICgoZyAtIGIpIC8gZGVsdGEpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChtYXggPT09IHIgJiYgZyA8IGIpIHtcbiAgICAgICAgICAgICAgICBoID0gNjAgKiAoKGcgLSBiKSAvIGRlbHRhKSArIDM2MDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobWF4ID09PSBnKSB7XG4gICAgICAgICAgICAgICAgaCA9IDYwICogKChiIC0gcikgLyBkZWx0YSkgKyAxMjA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG1heCA9PT0gYikge1xuICAgICAgICAgICAgICAgIGggPSA2MCAqICgociAtIGcpIC8gZGVsdGEpICsgMjQwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBoID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaHN2LmggPSBoO1xuICAgICAgICAgICAgaHN2LnMgPSBzO1xuICAgICAgICAgICAgaHN2LnYgPSB2O1xuXG4gICAgICAgICAgICByZXR1cm4gaHN2O1xuICAgICAgICB9LFxuXG4gICAgICAgIGhzdjJyZ2I6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgIHRoaXMuY2hlY2soY29sb3IsIFwiaHN2XCIpO1xuICAgICAgICAgICAgdmFyIHIsIGcsIGI7XG4gICAgICAgICAgICB2YXIgaCA9IGNvbG9yLmgsXG4gICAgICAgICAgICAgICAgcyA9IGNvbG9yLnMgKiAxMDAsXG4gICAgICAgICAgICAgICAgdiA9IGNvbG9yLnYgKiAxMDA7XG4gICAgICAgICAgICB2YXIgSGkgPSBNYXRoLmZsb29yKGggLyA2MCk7XG4gICAgICAgICAgICB2YXIgVm1pbiA9ICgoMTAwIC0gcykgKiB2KSAvIDEwMDtcbiAgICAgICAgICAgIHZhciBhbHBoYSA9ICh2IC0gVm1pbikgKiAoKGggJSA2MCkgLyA2MCk7XG4gICAgICAgICAgICB2YXIgVmluYyA9IFZtaW4gKyBhbHBoYTtcbiAgICAgICAgICAgIHZhciBWZGVjID0gdiAtIGFscGhhO1xuXG4gICAgICAgICAgICBzd2l0Y2ggKEhpKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICByID0gdjtcbiAgICAgICAgICAgICAgICAgICAgZyA9IFZpbmM7XG4gICAgICAgICAgICAgICAgICAgIGIgPSBWbWluO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgIHIgPSBWZGVjO1xuICAgICAgICAgICAgICAgICAgICBnID0gdjtcbiAgICAgICAgICAgICAgICAgICAgYiA9IFZtaW47XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgciA9IFZtaW47XG4gICAgICAgICAgICAgICAgICAgIGcgPSB2O1xuICAgICAgICAgICAgICAgICAgICBiID0gVmluYztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICByID0gVm1pbjtcbiAgICAgICAgICAgICAgICAgICAgZyA9IFZkZWM7XG4gICAgICAgICAgICAgICAgICAgIGIgPSB2O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgIHIgPSBWaW5jO1xuICAgICAgICAgICAgICAgICAgICBnID0gVm1pbjtcbiAgICAgICAgICAgICAgICAgICAgYiA9IHY7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgciA9IHY7XG4gICAgICAgICAgICAgICAgICAgIGcgPSBWbWluO1xuICAgICAgICAgICAgICAgICAgICBiID0gVmRlYztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBuZXcgUkdCKFxuICAgICAgICAgICAgICAgIE1hdGgucm91bmQoKHIgKiAyNTUpIC8gMTAwKSxcbiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChnICogMjU1KSAvIDEwMCksXG4gICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgoYiAqIDI1NSkgLyAxMDApXG4gICAgICAgICAgICApO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhzdjJoZXg6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgIHRoaXMuY2hlY2soY29sb3IsIFwiaHN2XCIpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmdiMmhleCh0aGlzLmhzdjJyZ2IoY29sb3IpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBoZXgyaHN2OiBmdW5jdGlvbihjb2xvcil7XG4gICAgICAgICAgICB0aGlzLmNoZWNrKGNvbG9yLCBcImhleFwiKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJnYjJoc3YodGhpcy5oZXgycmdiKGNvbG9yKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmdiMmNteWs6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgIHRoaXMuY2hlY2soY29sb3IsIFwicmdiXCIpO1xuICAgICAgICAgICAgdmFyIGNteWsgPSBuZXcgQ01ZSygpO1xuXG4gICAgICAgICAgICB2YXIgciA9IGNvbG9yLnIgLyAyNTU7XG4gICAgICAgICAgICB2YXIgZyA9IGNvbG9yLmcgLyAyNTU7XG4gICAgICAgICAgICB2YXIgYiA9IGNvbG9yLmIgLyAyNTU7XG5cbiAgICAgICAgICAgIGNteWsuayA9IE1hdGgubWluKDEgLSByLCAxIC0gZywgMSAtIGIpO1xuXG4gICAgICAgICAgICBjbXlrLmMgPSAxIC0gY215ay5rID09PSAwID8gMCA6ICgxIC0gciAtIGNteWsuaykgLyAoMSAtIGNteWsuayk7XG4gICAgICAgICAgICBjbXlrLm0gPSAxIC0gY215ay5rID09PSAwID8gMCA6ICgxIC0gZyAtIGNteWsuaykgLyAoMSAtIGNteWsuayk7XG4gICAgICAgICAgICBjbXlrLnkgPSAxIC0gY215ay5rID09PSAwID8gMCA6ICgxIC0gYiAtIGNteWsuaykgLyAoMSAtIGNteWsuayk7XG5cbiAgICAgICAgICAgIGNteWsuYyA9IE1hdGgucm91bmQoY215ay5jICogMTAwKTtcbiAgICAgICAgICAgIGNteWsubSA9IE1hdGgucm91bmQoY215ay5tICogMTAwKTtcbiAgICAgICAgICAgIGNteWsueSA9IE1hdGgucm91bmQoY215ay55ICogMTAwKTtcbiAgICAgICAgICAgIGNteWsuayA9IE1hdGgucm91bmQoY215ay5rICogMTAwKTtcblxuICAgICAgICAgICAgcmV0dXJuIGNteWs7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY215azJyZ2I6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgIHRoaXMuY2hlY2soY29sb3IsIFwiY215a1wiKTtcbiAgICAgICAgICAgIHZhciByID0gTWF0aC5mbG9vcigyNTUgKiAoMSAtIGNvbG9yLmMgLyAxMDApICogKDEgLSBjb2xvci5rIC8gMTAwKSk7XG4gICAgICAgICAgICB2YXIgZyA9IE1hdGguY2VpbCgyNTUgKiAoMSAtIGNvbG9yLm0gLyAxMDApICogKDEgLSBjb2xvci5rIC8gMTAwKSk7XG4gICAgICAgICAgICB2YXIgYiA9IE1hdGguY2VpbCgyNTUgKiAoMSAtIGNvbG9yLnkgLyAxMDApICogKDEgLSBjb2xvci5rIC8gMTAwKSk7XG5cbiAgICAgICAgICAgIHJldHVybiBuZXcgUkdCKHIsIGcsIGIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhzdjJoc2w6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgIHRoaXMuY2hlY2soY29sb3IsIFwiaHN2XCIpO1xuICAgICAgICAgICAgdmFyIGgsIHMsIGwsIGQ7XG4gICAgICAgICAgICBoID0gY29sb3IuaDtcbiAgICAgICAgICAgIGwgPSAoMiAtIGNvbG9yLnMpICogY29sb3IudjtcbiAgICAgICAgICAgIHMgPSBjb2xvci5zICogY29sb3IudjtcbiAgICAgICAgICAgIGlmIChsID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcyA9IDA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGQgPSBsIDw9IDEgPyBsIDogMiAtIGw7XG4gICAgICAgICAgICAgICAgaWYgKGQgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcyA9IDA7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcyAvPSBkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGwgLz0gMjtcbiAgICAgICAgICAgIHJldHVybiBuZXcgSFNMKGgsIHMsIGwpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhzbDJoc3Y6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgIHRoaXMuY2hlY2soY29sb3IsIFtcImhzbFwiLCBcImhzbGFcIl0pO1xuICAgICAgICAgICAgdmFyIGgsIHMsIHYsIGw7XG4gICAgICAgICAgICBoID0gY29sb3IuaDtcbiAgICAgICAgICAgIGwgPSBjb2xvci5sICogMjtcbiAgICAgICAgICAgIHMgPSBjb2xvci5zICogKGwgPD0gMSA/IGwgOiAyIC0gbCk7XG5cbiAgICAgICAgICAgIHYgPSAobCArIHMpIC8gMjtcblxuICAgICAgICAgICAgaWYgKGwgKyBzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcyA9IDA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHMgPSAoMiAqIHMpIC8gKGwgKyBzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG5ldyBIU1YoaCwgcywgdik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmdiMndlYnNhZmU6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgIHRoaXMuY2hlY2soY29sb3IsIFwicmdiXCIpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBSR0IoXG4gICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjb2xvci5yIC8gNTEpICogNTEsXG4gICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjb2xvci5nIC8gNTEpICogNTEsXG4gICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjb2xvci5iIC8gNTEpICogNTFcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmdiYTJ3ZWJzYWZlOiBmdW5jdGlvbihjb2xvcil7XG4gICAgICAgICAgICB0aGlzLmNoZWNrKGNvbG9yLCBcInJnYmFcIik7XG4gICAgICAgICAgICB2YXIgcmdiV2ViU2FmZSA9IHRoaXMucmdiMndlYnNhZmUoY29sb3IpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBSR0JBKHJnYldlYlNhZmUuciwgcmdiV2ViU2FmZS5nLCByZ2JXZWJTYWZlLmIsIGNvbG9yLmEpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhleDJ3ZWJzYWZlOiBmdW5jdGlvbihjb2xvcil7XG4gICAgICAgICAgICB0aGlzLmNoZWNrKGNvbG9yLCBcImhleFwiKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJnYjJoZXgodGhpcy5yZ2Iyd2Vic2FmZSh0aGlzLmhleDJyZ2IoY29sb3IpKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaHN2MndlYnNhZmU6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgIHRoaXMuY2hlY2soY29sb3IsIFwiaHN2XCIpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmdiMmhzdih0aGlzLnJnYjJ3ZWJzYWZlKHRoaXMudG9SR0IoY29sb3IpKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaHNsMndlYnNhZmU6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgdGhpcy5jaGVjayhjb2xvciwgXCJoc2xcIik7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5oc3YyaHNsKHRoaXMucmdiMmhzdih0aGlzLnJnYjJ3ZWJzYWZlKHRoaXMudG9SR0IoY29sb3IpKSkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNteWsyd2Vic2FmZTogZnVuY3Rpb24oY29sb3Ipe1xuICAgICAgICAgICAgdGhpcy5jaGVjayhjb2xvciwgXCJjbXlrXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmdiMmNteWsodGhpcy5yZ2Iyd2Vic2FmZSh0aGlzLmNteWsycmdiKGNvbG9yKSkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHdlYnNhZmU6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzSEVYKGNvbG9yKSkgcmV0dXJuIHRoaXMuaGV4MndlYnNhZmUoY29sb3IpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNSR0IoY29sb3IpKSByZXR1cm4gdGhpcy5yZ2Iyd2Vic2FmZShjb2xvcik7XG4gICAgICAgICAgICBpZiAodGhpcy5pc1JHQkEoY29sb3IpKSByZXR1cm4gdGhpcy5yZ2JhMndlYnNhZmUoY29sb3IpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNIU1YoY29sb3IpKSByZXR1cm4gdGhpcy5oc3Yyd2Vic2FmZShjb2xvcik7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0hTTChjb2xvcikpIHJldHVybiB0aGlzLmhzbDJ3ZWJzYWZlKGNvbG9yKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQ01ZSyhjb2xvcikpIHJldHVybiB0aGlzLmNteWsyd2Vic2FmZShjb2xvcik7XG5cbiAgICAgICAgICAgIHJldHVybiBjb2xvcjtcbiAgICAgICAgfSxcblxuICAgICAgICB0b0NvbG9yOiBmdW5jdGlvbihjb2xvciwgdHlwZSwgYWxwaGEpe1xuICAgICAgICAgICAgdmFyIHJlc3VsdDtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImhleFwiOlxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLnRvSEVYKGNvbG9yKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcInJnYlwiOlxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLnRvUkdCKGNvbG9yKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcInJnYmFcIjpcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy50b1JHQkEoY29sb3IsIGFscGhhKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImhzbFwiOlxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLnRvSFNMKGNvbG9yKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImhzbGFcIjpcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy50b0hTTEEoY29sb3IsIGFscGhhKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImhzdlwiOlxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLnRvSFNWKGNvbG9yKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImNteWtcIjpcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy50b0NNWUsoY29sb3IpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBjb2xvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9IRVg6IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgICB2YXIgY29sb3IgPSB0eXBlb2YgdmFsID09PSBcInN0cmluZ1wiID8gdGhpcy5wYXJzZSh2YWwpIDogdmFsO1xuXG4gICAgICAgICAgICBpZiAoIWNvbG9yKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5rbm93biBjb2xvciBmb3JtYXQhXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdHlwZW9mIGNvbG9yID09PSBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgPyBjb2xvclxuICAgICAgICAgICAgICAgIDogdGhpcy5yZ2IyaGV4KHRoaXMudG9SR0IoY29sb3IpKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b1JHQjogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICAgIHZhciBjb2xvciA9IHR5cGVvZiB2YWwgPT09IFwic3RyaW5nXCIgPyB0aGlzLnBhcnNlKHZhbCkgOiB2YWw7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzUkdCKGNvbG9yKSkgcmV0dXJuIGNvbG9yO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNSR0JBKGNvbG9yKSkgcmV0dXJuIG5ldyBSR0IoY29sb3IuciwgY29sb3IuZywgY29sb3IuYik7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0hTVihjb2xvcikpIHJldHVybiB0aGlzLmhzdjJyZ2IoY29sb3IpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNIU0woY29sb3IpKSByZXR1cm4gdGhpcy5oc3YycmdiKHRoaXMuaHNsMmhzdihjb2xvcikpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNIU0xBKGNvbG9yKSkgcmV0dXJuIHRoaXMuaHN2MnJnYih0aGlzLmhzbDJoc3YoY29sb3IpKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzSEVYKGNvbG9yKSkgcmV0dXJuIHRoaXMuaGV4MnJnYihjb2xvcik7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0NNWUsoY29sb3IpKSByZXR1cm4gdGhpcy5jbXlrMnJnYihjb2xvcik7XG5cbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVua25vd24gY29sb3IgZm9ybWF0IVwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b1JHQkE6IGZ1bmN0aW9uKGNvbG9yLCBhbHBoYSl7XG4gICAgICAgICAgICBpZiAodGhpcy5pc1JHQkEoY29sb3IpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFscGhhKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yLmEgPSBhbHBoYTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJnYiA9IHRoaXMudG9SR0IoY29sb3IpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBSR0JBKHJnYi5yLCByZ2IuZywgcmdiLmIsIGFscGhhKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b0hTVjogZnVuY3Rpb24oY29sb3Ipe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmdiMmhzdih0aGlzLnRvUkdCKGNvbG9yKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9IU0w6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmhzdjJoc2wodGhpcy5yZ2IyaHN2KHRoaXMudG9SR0IoY29sb3IpKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9IU0xBOiBmdW5jdGlvbihjb2xvciwgYWxwaGEpe1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNIU0xBKGNvbG9yKSkge1xuICAgICAgICAgICAgICAgIGlmIChhbHBoYSkge1xuICAgICAgICAgICAgICAgICAgICBjb2xvci5hID0gYWxwaGE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBjb2xvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBoc2xhID0gdGhpcy5oc3YyaHNsKHRoaXMucmdiMmhzdih0aGlzLnRvUkdCKGNvbG9yKSkpO1xuICAgICAgICAgICAgaHNsYS5hID0gYWxwaGE7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEhTTEEoaHNsYS5oLCBoc2xhLnMsIGhzbGEubCwgaHNsYS5hKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b0NNWUs6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJnYjJjbXlrKHRoaXMudG9SR0IoY29sb3IpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBncmF5c2NhbGU6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRlc2F0dXJhdGUoY29sb3IsIDEwMCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbGlnaHRlbjogZnVuY3Rpb24oY29sb3IsIGFtb3VudCl7XG4gICAgICAgICAgICB2YXIgaHNsLCB0eXBlLCBhbHBoYTtcblxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzQ29sb3IoY29sb3IpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGNvbG9yICsgXCIgaXMgbm90IGEgdmFsaWQgY29sb3IgdmFsdWUhXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhbW91bnQgPSAoYW1vdW50ID09PSAwKSA/IDAgOiAoYW1vdW50IHx8IDEwKTtcbiAgICAgICAgICAgIGhzbCA9IHRoaXMudG9IU0woY29sb3IpO1xuICAgICAgICAgICAgaHNsLmwgKz0gYW1vdW50IC8gMTAwO1xuICAgICAgICAgICAgaHNsLmwgPSBjbGFtcChoc2wubCk7XG5cbiAgICAgICAgICAgIHR5cGUgPSB0aGlzLmNvbG9yVHlwZShjb2xvcikudG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgaWYgKHR5cGUgPT09IFR5cGVzLlJHQkEgfHwgdHlwZSA9PT0gVHlwZXMuSFNMQSkge1xuICAgICAgICAgICAgICAgIGFscGhhID0gY29sb3IuYTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudG9Db2xvcihoc2wsIHR5cGUsIGFscGhhKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkYXJrZW46IGZ1bmN0aW9uKGNvbG9yLCBhbW91bnQpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGlnaHRlbihjb2xvciwgLWFtb3VudCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc3BpbjogZnVuY3Rpb24oY29sb3IsIGFtb3VudCl7XG4gICAgICAgICAgICB2YXIgaHNsLCB0eXBlLCBhbHBoYSwgaHVlO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNDb2xvcihjb2xvcikpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoY29sb3IgKyBcIiBpcyBub3QgYSB2YWxpZCBjb2xvciB2YWx1ZSFcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGhzbCA9IHRoaXMudG9IU0woY29sb3IpO1xuICAgICAgICAgICAgaHVlID0gKGhzbC5oICsgYW1vdW50KSAlIDM2MDtcbiAgICAgICAgICAgIGhzbC5oID0gaHVlIDwgMCA/IDM2MCArIGh1ZSA6IGh1ZTtcblxuICAgICAgICAgICAgdHlwZSA9IHRoaXMuY29sb3JUeXBlKGNvbG9yKS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gVHlwZXMuUkdCQSB8fCB0eXBlID09PSBUeXBlcy5IU0xBKSB7XG4gICAgICAgICAgICAgICAgYWxwaGEgPSBjb2xvci5hO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy50b0NvbG9yKGhzbCwgdHlwZSwgYWxwaGEpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGJyaWdodGVuOiBmdW5jdGlvbihjb2xvciwgYW1vdW50KXtcbiAgICAgICAgICAgIHZhciByZ2IsIHR5cGUsIGFscGhhO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNDb2xvcihjb2xvcikpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoY29sb3IgKyBcIiBpcyBub3QgYSB2YWxpZCBjb2xvciB2YWx1ZSFcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJnYiA9IHRoaXMudG9SR0IoY29sb3IpO1xuICAgICAgICAgICAgcmdiLnIgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigyNTUsIHJnYi5yIC0gTWF0aC5yb3VuZCgyNTUgKiAtIChhbW91bnQgLyAxMDApKSkpO1xuICAgICAgICAgICAgcmdiLmcgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigyNTUsIHJnYi5nIC0gTWF0aC5yb3VuZCgyNTUgKiAtIChhbW91bnQgLyAxMDApKSkpO1xuICAgICAgICAgICAgcmdiLmIgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigyNTUsIHJnYi5iIC0gTWF0aC5yb3VuZCgyNTUgKiAtIChhbW91bnQgLyAxMDApKSkpO1xuXG4gICAgICAgICAgICB0eXBlID0gdGhpcy5jb2xvclR5cGUoY29sb3IpLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgICAgIGlmICh0eXBlID09PSBUeXBlcy5SR0JBIHx8IHR5cGUgPT09IFR5cGVzLkhTTEEpIHtcbiAgICAgICAgICAgICAgICBhbHBoYSA9IGNvbG9yLmE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRvQ29sb3IocmdiLCB0eXBlLCBhbHBoYSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2F0dXJhdGU6IGZ1bmN0aW9uKGNvbG9yLCBhbW91bnQpe1xuICAgICAgICAgICAgdmFyIGhzbCwgdHlwZSwgYWxwaGE7XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5pc0NvbG9yKGNvbG9yKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihjb2xvciArIFwiIGlzIG5vdCBhIHZhbGlkIGNvbG9yIHZhbHVlIVwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaHNsID0gdGhpcy50b0hTTChjb2xvcik7XG4gICAgICAgICAgICBoc2wucyArPSBhbW91bnQgLyAxMDA7XG4gICAgICAgICAgICBoc2wucyA9IGNsYW1wKGhzbC5zKTtcblxuICAgICAgICAgICAgdHlwZSA9IHRoaXMuY29sb3JUeXBlKGNvbG9yKS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gVHlwZXMuUkdCQSB8fCB0eXBlID09PSBUeXBlcy5IU0xBKSB7XG4gICAgICAgICAgICAgICAgYWxwaGEgPSBjb2xvci5hO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy50b0NvbG9yKGhzbCwgdHlwZSwgYWxwaGEpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlc2F0dXJhdGU6IGZ1bmN0aW9uKGNvbG9yLCBhbW91bnQpe1xuICAgICAgICAgICAgdmFyIGhzbCwgdHlwZSwgYWxwaGE7XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5pc0NvbG9yKGNvbG9yKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihjb2xvciArIFwiIGlzIG5vdCBhIHZhbGlkIGNvbG9yIHZhbHVlIVwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaHNsID0gdGhpcy50b0hTTChjb2xvcik7XG4gICAgICAgICAgICBoc2wucyAtPSBhbW91bnQgLyAxMDA7XG4gICAgICAgICAgICBoc2wucyA9IGNsYW1wKGhzbC5zKTtcblxuICAgICAgICAgICAgdHlwZSA9IHRoaXMuY29sb3JUeXBlKGNvbG9yKS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gVHlwZXMuUkdCQSB8fCB0eXBlID09PSBUeXBlcy5IU0xBKSB7XG4gICAgICAgICAgICAgICAgYWxwaGEgPSBjb2xvci5hO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy50b0NvbG9yKGhzbCwgdHlwZSwgYWxwaGEpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGh1ZVNoaWZ0OiBmdW5jdGlvbihjb2xvciwgaHVlLCBzYXR1cmF0aW9uLCB2YWx1ZSl7XG4gICAgICAgICAgICB2YXIgaHN2ID0gdGhpcy50b0hTVihjb2xvcik7XG4gICAgICAgICAgICB2YXIgdHlwZSA9IHRoaXMuY29sb3JUeXBlKGNvbG9yKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgdmFyIGggPSBoc3YuaDtcbiAgICAgICAgICAgIHZhciBhbHBoYTtcbiAgICAgICAgICAgIHZhciBfaCA9IGh1ZSB8fCAwO1xuICAgICAgICAgICAgdmFyIF9zID0gc2F0dXJhdGlvbiB8fCAwO1xuICAgICAgICAgICAgdmFyIF92ID0gdmFsdWUgfHwgMDtcblxuICAgICAgICAgICAgaCArPSBfaDtcbiAgICAgICAgICAgIHdoaWxlIChoID49IDM2MC4wKSBoIC09IDM2MC4wO1xuICAgICAgICAgICAgd2hpbGUgKGggPCAwLjApIGggKz0gMzYwLjA7XG4gICAgICAgICAgICBoc3YuaCA9IGg7XG5cbiAgICAgICAgICAgIGhzdi5zICs9IF9zO1xuICAgICAgICAgICAgaWYgKGhzdi5zID4gMSkge2hzdi5zID0gMTt9XG4gICAgICAgICAgICBpZiAoaHN2LnMgPCAwKSB7aHN2LnMgPSAwO31cblxuICAgICAgICAgICAgaHN2LnYgKz0gX3Y7XG4gICAgICAgICAgICBpZiAoaHN2LnYgPiAxKSB7aHN2LnYgPSAxO31cbiAgICAgICAgICAgIGlmIChoc3YudiA8IDApIHtoc3YudiA9IDA7fVxuXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gVHlwZXMuUkdCQSB8fCB0eXBlID09PSBUeXBlcy5IU0xBKSB7XG4gICAgICAgICAgICAgICAgYWxwaGEgPSBjb2xvci5hO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy50b0NvbG9yKGhzdiwgdHlwZSwgYWxwaGEpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNoYWRlOiBmdW5jdGlvbihjb2xvciwgYW1vdW50KXtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0NvbG9yKGNvbG9yKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihjb2xvciArIFwiIGlzIG5vdCBhIHZhbGlkIGNvbG9yIHZhbHVlIVwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYW1vdW50IC89IDEwMDtcblxuICAgICAgICAgICAgdmFyIHR5cGUgPSB0aGlzLmNvbG9yVHlwZShjb2xvcikudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHZhciByZ2IgPSB0aGlzLnRvUkdCKGNvbG9yKTtcbiAgICAgICAgICAgIHZhciB0ID0gYW1vdW50IDwgMCA/IDAgOiAyNTU7XG4gICAgICAgICAgICB2YXIgcCA9IGFtb3VudCA8IDAgPyBhbW91bnQgKiAtMSA6IGFtb3VudDtcbiAgICAgICAgICAgIHZhciByLCBnLCBiLCBhO1xuXG4gICAgICAgICAgICByID0gKE1hdGgucm91bmQoKHQgLSByZ2IucikgKiBwKSArIHJnYi5yKTtcbiAgICAgICAgICAgIGcgPSAoTWF0aC5yb3VuZCgodCAtIHJnYi5nKSAqIHApICsgcmdiLmcpO1xuICAgICAgICAgICAgYiA9IChNYXRoLnJvdW5kKCh0IC0gcmdiLmIpICogcCkgKyByZ2IuYik7XG5cbiAgICAgICAgICAgIGlmICh0eXBlID09PSBUeXBlcy5SR0JBIHx8IHR5cGUgPT09IFR5cGVzLkhTTEEpIHtcbiAgICAgICAgICAgICAgICBhID0gY29sb3IuYTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudG9Db2xvcihuZXcgUkdCKHIsIGcsIGIpLCB0eXBlLCBhKTtcbiAgICAgICAgfSxcblxuICAgICAgICBtaXg6IGZ1bmN0aW9uKGNvbG9yMSwgY29sb3IyLCBhbW91bnQpe1xuXG4gICAgICAgICAgICBhbW91bnQgPSAoYW1vdW50ID09PSAwKSA/IDAgOiAoYW1vdW50IHx8IDUwKTtcblxuICAgICAgICAgICAgdmFyIHJnYiA9IG5ldyBSR0IoMCwwLDApO1xuICAgICAgICAgICAgdmFyIHJnYjEgPSB0aGlzLnRvUkdCKGNvbG9yMSk7XG4gICAgICAgICAgICB2YXIgcmdiMiA9IHRoaXMudG9SR0IoY29sb3IyKTtcblxuICAgICAgICAgICAgdmFyIHAgPSBhbW91bnQgLyAxMDA7XG5cbiAgICAgICAgICAgIHJnYi5yID0gTWF0aC5yb3VuZCgoKHJnYjIuciAtIHJnYjEucikgKiBwKSArIHJnYjEucik7XG4gICAgICAgICAgICByZ2IuZyA9IE1hdGgucm91bmQoKChyZ2IyLmcgLSByZ2IxLmcpICogcCkgKyByZ2IxLmcpO1xuICAgICAgICAgICAgcmdiLmIgPSBNYXRoLnJvdW5kKCgocmdiMi5iIC0gcmdiMS5iKSAqIHApICsgcmdiMS5iKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudG9IRVgocmdiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBtdWx0aXBseTogZnVuY3Rpb24oY29sb3IxLCBjb2xvcjIpe1xuICAgICAgICAgICAgdmFyIHJnYjEgPSB0aGlzLnRvUkdCKGNvbG9yMSk7XG4gICAgICAgICAgICB2YXIgcmdiMiA9IHRoaXMudG9SR0IoY29sb3IyKTtcbiAgICAgICAgICAgIHZhciByZ2IgPSBuZXcgUkdCKCk7XG5cbiAgICAgICAgICAgIHJnYjEuYiA9IE1hdGguZmxvb3IocmdiMS5iICogcmdiMi5iIC8gMjU1KTtcbiAgICAgICAgICAgIHJnYjEuZyA9IE1hdGguZmxvb3IocmdiMS5nICogcmdiMi5nIC8gMjU1KTtcbiAgICAgICAgICAgIHJnYjEuciA9IE1hdGguZmxvb3IocmdiMS5yICogcmdiMi5yIC8gMjU1KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudG9IRVgocmdiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBtYXRlcmlhbFBhbGV0dGU6IGZ1bmN0aW9uKGNvbG9yLCBvcHRpb25zKXtcbiAgICAgICAgICAgIHZhciBvcHQgPSAkLmV4dGVuZCh7fSwgQ29sb3JzRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgICAgICAgICB2YXIgYmFzZUxpZ2h0ID0gb3B0LmJhc2VMaWdodDtcbiAgICAgICAgICAgIHZhciBiYXNlRGFyayA9IG9wdC5iYXNlRGFyayA9PT0gXCJzZWxmXCIgfHwgIW9wdC5iYXNlRGFyayA/IHRoaXMubXVsdGlwbHkoY29sb3IsIGNvbG9yKSA6IG9wdC5iYXNlRGFyaztcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBcIjUwXCI6IHRoaXMubWl4KGJhc2VMaWdodCwgY29sb3IsIDEwKSxcbiAgICAgICAgICAgICAgICBcIjEwMFwiOiB0aGlzLm1peChiYXNlTGlnaHQsIGNvbG9yLCAzMCksXG4gICAgICAgICAgICAgICAgXCIyMDBcIjogdGhpcy5taXgoYmFzZUxpZ2h0LCBjb2xvciwgNTApLFxuICAgICAgICAgICAgICAgIFwiMzAwXCI6IHRoaXMubWl4KGJhc2VMaWdodCwgY29sb3IsIDcwKSxcbiAgICAgICAgICAgICAgICBcIjQwMFwiOiB0aGlzLm1peChiYXNlTGlnaHQsIGNvbG9yLCA4NSksXG4gICAgICAgICAgICAgICAgXCI1MDBcIjogdGhpcy5taXgoYmFzZUxpZ2h0LCBjb2xvciwgMTAwKSxcbiAgICAgICAgICAgICAgICBcIjYwMFwiOiB0aGlzLm1peChiYXNlRGFyaywgY29sb3IsIDkyKSxcbiAgICAgICAgICAgICAgICBcIjcwMFwiOiB0aGlzLm1peChiYXNlRGFyaywgY29sb3IsIDgzKSxcbiAgICAgICAgICAgICAgICBcIjgwMFwiOiB0aGlzLm1peChiYXNlRGFyaywgY29sb3IsIDc0KSxcbiAgICAgICAgICAgICAgICBcIjkwMFwiOiB0aGlzLm1peChiYXNlRGFyaywgY29sb3IsIDY1KSxcblxuICAgICAgICAgICAgICAgIFwiQTEwMFwiOiB0aGlzLmxpZ2h0ZW4odGhpcy5zYXR1cmF0ZSh0aGlzLm1peChiYXNlRGFyaywgY29sb3IsIDE1KSwgODApLCA2NSksXG4gICAgICAgICAgICAgICAgXCJBMjAwXCI6IHRoaXMubGlnaHRlbih0aGlzLnNhdHVyYXRlKHRoaXMubWl4KGJhc2VEYXJrLCBjb2xvciwgMTUpLCA4MCksIDU1KSxcbiAgICAgICAgICAgICAgICBcIkE0MDBcIjogdGhpcy5saWdodGVuKHRoaXMuc2F0dXJhdGUodGhpcy5taXgoYmFzZUxpZ2h0LCBjb2xvciwgMTAwKSwgNTUpLCAxMCksXG4gICAgICAgICAgICAgICAgXCJBNzAwXCI6IHRoaXMubGlnaHRlbih0aGlzLnNhdHVyYXRlKHRoaXMubWl4KGJhc2VEYXJrLCBjb2xvciwgODMpLCA2NSksIDEwKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcblxuICAgICAgICBtb25vY2hyb21hdGljOiBmdW5jdGlvbihjb2xvciwgb3B0aW9ucyl7XG4gICAgICAgICAgICB2YXIgb3B0ID0gJC5leHRlbmQoe30sIENvbG9yc0RlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgICAgICAgICAgdmFyIHJldHVybkFzID0gb3B0LnJlc3VsdFR5cGU7XG4gICAgICAgICAgICB2YXIgcmVzdWx0cyA9IG9wdC5yZXN1bHRzO1xuICAgICAgICAgICAgdmFyIGhzdiA9IHRoaXMudG9IU1YoY29sb3IpO1xuICAgICAgICAgICAgdmFyIGggPSBoc3YuaCxcbiAgICAgICAgICAgICAgICBzID0gaHN2LnMsXG4gICAgICAgICAgICAgICAgdiA9IGhzdi52O1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgICAgICAgICAgdmFyIG1vZCA9IDEgLyByZXN1bHRzO1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICB3aGlsZSAocmVzdWx0cy0tKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IEhTVihoLCBzLCB2KSk7XG4gICAgICAgICAgICAgICAgdiA9ICh2ICsgbW9kKSAlIDE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQubWFwKGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZltcInRvXCIrcmV0dXJuQXMudG9VcHBlckNhc2UoKV0oZWwpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY29tcGxlbWVudGFyeTogZnVuY3Rpb24oY29sb3IsIG9wdGlvbnMpe1xuICAgICAgICAgICAgdmFyIG9wdCA9ICQuZXh0ZW5kKHt9LCBDb2xvcnNEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICAgICAgICAgIHZhciBoc2wgPSB0aGlzLnRvSFNMKGNvbG9yKTtcbiAgICAgICAgICAgIHZhciByZXN1bHQ7XG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciByZXR1cm5BcyA9IG9wdC5yZXN1bHRUeXBlO1xuXG4gICAgICAgICAgICByZXN1bHQgPSBbXG4gICAgICAgICAgICAgICAgaHNsLFxuICAgICAgICAgICAgICAgIG5ldyBIU0woc2hpZnQoaHNsLmgsIDE4MCksIGhzbC5zLCBoc2wubClcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQubWFwKGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZltcInRvXCIrcmV0dXJuQXMudG9VcHBlckNhc2UoKV0oZWwpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc3BsaXRDb21wbGVtZW50YXJ5OiBmdW5jdGlvbihjb2xvciwgb3B0aW9ucyl7XG4gICAgICAgICAgICB2YXIgb3B0ID0gJC5leHRlbmQoe30sIENvbG9yc0RlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgICAgICAgICAgdmFyIGhzbCA9IHRoaXMudG9IU0woY29sb3IpO1xuICAgICAgICAgICAgdmFyIGggPSBoc2wuaDtcbiAgICAgICAgICAgIHZhciByZXN1bHQsIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgcmV0dXJuQXMgPSBvcHQucmVzdWx0VHlwZTtcbiAgICAgICAgICAgIHZhciBhbmdsZSA9IG9wdC5hbmdsZTtcblxuICAgICAgICAgICAgcmVzdWx0ID0gW1xuICAgICAgICAgICAgICAgIGhzbCxcbiAgICAgICAgICAgICAgICBuZXcgSFNMKHNoaWZ0KGgsIDE4MCAtIGFuZ2xlKSwgaHNsLnMsIGhzbC5sICksXG4gICAgICAgICAgICAgICAgbmV3IEhTTChzaGlmdChoLCAxODAgKyBhbmdsZSksIGhzbC5zLCBoc2wubCApXG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0Lm1hcChmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbGZbXCJ0b1wiK3JldHVybkFzLnRvVXBwZXJDYXNlKCldKGVsKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRvdWJsZUNvbXBsZW1lbnRhcnk6IGZ1bmN0aW9uKGNvbG9yLCBvcHRpb25zKXtcbiAgICAgICAgICAgIHZhciBvcHQgPSAkLmV4dGVuZCh7fSwgQ29sb3JzRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgICAgICAgICB2YXIgcmV0dXJuQXMgPSBvcHQucmVzdWx0VHlwZTtcbiAgICAgICAgICAgIHZhciBhbmdsZSA9IG9wdC5hbmdsZTtcbiAgICAgICAgICAgIHZhciBoc2wgPSB0aGlzLnRvSFNMKGNvbG9yKTtcbiAgICAgICAgICAgIHZhciBoID0gaHNsLmg7XG4gICAgICAgICAgICB2YXIgcmVzdWx0LCBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgcmVzdWx0ID0gW1xuICAgICAgICAgICAgICAgIGhzbCxcbiAgICAgICAgICAgICAgICBuZXcgSFNMKHNoaWZ0KGgsIDE4MCksIGhzbC5zLCBoc2wubCApLFxuICAgICAgICAgICAgICAgIG5ldyBIU0woc2hpZnQoaCwgYW5nbGUpLCBoc2wucywgaHNsLmwgKSxcbiAgICAgICAgICAgICAgICBuZXcgSFNMKHNoaWZ0KGgsIDE4MCArIGFuZ2xlKSwgaHNsLnMsIGhzbC5sIClcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQubWFwKGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZltcInRvXCIrcmV0dXJuQXMudG9VcHBlckNhc2UoKV0oZWwpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc3F1YXJlOiBmdW5jdGlvbihjb2xvciwgb3B0aW9ucyl7XG4gICAgICAgICAgICB2YXIgb3B0ID0gJC5leHRlbmQoe30sIENvbG9yc0RlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgICAgICAgICAgdmFyIHJldHVybkFzID0gb3B0LnJlc3VsdFR5cGU7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gW10sIGk7XG4gICAgICAgICAgICB2YXIgaHNsID0gdGhpcy50b0hTTChjb2xvcik7XG4gICAgICAgICAgICB2YXIgaCA9IGhzbC5oICwgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKGhzbCk7XG5cbiAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPCA0OyBpKyspIHtcbiAgICAgICAgICAgICAgICBoID0gc2hpZnQoaCwgOTAuMCk7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IEhTTChoLCBoc2wucywgaHNsLmwpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5tYXAoZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgICAgIHJldHVybiBzZWxmW1widG9cIityZXR1cm5Bcy50b1VwcGVyQ2FzZSgpXShlbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICB0ZXRyYWRpYzogZnVuY3Rpb24oY29sb3IsIG9wdGlvbnMpe1xuICAgICAgICAgICAgdmFyIG9wdCA9ICQuZXh0ZW5kKHt9LCBDb2xvcnNEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICAgICAgICAgIHZhciByZXR1cm5BcyA9IG9wdC5yZXN1bHRUeXBlO1xuICAgICAgICAgICAgdmFyIGFuZ2xlID0gb3B0LmFuZ2xlO1xuICAgICAgICAgICAgdmFyIHJlc3VsdDtcbiAgICAgICAgICAgIHZhciBoc2wgPSB0aGlzLnRvSFNMKGNvbG9yKTtcbiAgICAgICAgICAgIHZhciBoID0gaHNsLmg7XG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIHJlc3VsdCA9IFtcbiAgICAgICAgICAgICAgICBoc2wsXG4gICAgICAgICAgICAgICAgbmV3IEhTTChzaGlmdChoLCAxODApLCBoc2wucywgaHNsLmwpLFxuICAgICAgICAgICAgICAgIG5ldyBIU0woc2hpZnQoaCwgMTgwIC0gYW5nbGUpLCBoc2wucywgaHNsLmwpLFxuICAgICAgICAgICAgICAgIG5ldyBIU0woc2hpZnQoaCwgLWFuZ2xlKSwgaHNsLnMsIGhzbC5sKVxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5tYXAoZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgICAgIHJldHVybiBzZWxmW1widG9cIityZXR1cm5Bcy50b1VwcGVyQ2FzZSgpXShlbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICB0cmlhZGljOiBmdW5jdGlvbihjb2xvciwgb3B0aW9ucyl7XG4gICAgICAgICAgICB2YXIgb3B0ID0gJC5leHRlbmQoe30sIENvbG9yc0RlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgICAgICAgICAgdmFyIHJldHVybkFzID0gb3B0LnJlc3VsdFR5cGU7XG4gICAgICAgICAgICB2YXIgcmVzdWx0O1xuICAgICAgICAgICAgdmFyIGhzbCA9IHRoaXMudG9IU0woY29sb3IpO1xuICAgICAgICAgICAgdmFyIGggPSBoc2wuaDtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgcmVzdWx0ID0gW1xuICAgICAgICAgICAgICAgIGhzbCxcbiAgICAgICAgICAgICAgICBuZXcgSFNMKHNoaWZ0KGgsMTIwKSwgaHNsLnMsIGhzbC5sKSxcbiAgICAgICAgICAgICAgICBuZXcgSFNMKHNoaWZ0KGgsMjQwKSwgaHNsLnMsIGhzbC5sKVxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5tYXAoZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgICAgIHJldHVybiBzZWxmW1widG9cIityZXR1cm5Bcy50b1VwcGVyQ2FzZSgpXShlbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBhbmFsb2dvdXM6IGZ1bmN0aW9uKGNvbG9yLCBvcHRpb25zKXtcbiAgICAgICAgICAgIHZhciBvcHQgPSAkLmV4dGVuZCh7fSwgQ29sb3JzRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgICAgICAgICB2YXIgcmV0dXJuQXMgPSBvcHQucmVzdWx0VHlwZTtcbiAgICAgICAgICAgIHZhciBhbmdsZSA9IG9wdC5hbmdsZTtcblxuICAgICAgICAgICAgdmFyIGhzbCA9IHRoaXMudG9IU0woY29sb3IpO1xuICAgICAgICAgICAgdmFyIHJlc3VsdCwgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIHJlc3VsdCA9IFtcbiAgICAgICAgICAgICAgICBoc2wsXG4gICAgICAgICAgICAgICAgbmV3IEhTTChzaGlmdChoc2wuaCwgLWFuZ2xlKSwgaHNsLnMsIGhzbC5sKSxcbiAgICAgICAgICAgICAgICBuZXcgSFNMKHNoaWZ0KGhzbC5oLCArYW5nbGUpLCBoc2wucywgaHNsLmwpXG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0Lm1hcChmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbGZbXCJ0b1wiK3JldHVybkFzLnRvVXBwZXJDYXNlKCldKGVsKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNyZWF0ZVNjaGVtZTogZnVuY3Rpb24oY29sb3IsIG5hbWUsIG9wdGlvbnMpe1xuICAgICAgICAgICAgc3dpdGNoIChuYW1lLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiYW5hbG9nb3VzXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcImFuYWxvZ1wiOiByZXR1cm4gdGhpcy5hbmFsb2dvdXMoY29sb3IsIG9wdGlvbnMpO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBcInRyaWFkaWNcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwidHJpYWRcIjogcmV0dXJuIHRoaXMudHJpYWRpYyhjb2xvciwgb3B0aW9ucyk7XG5cbiAgICAgICAgICAgICAgICBjYXNlIFwidGV0cmFkaWNcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwidGV0cmFcIjogcmV0dXJuIHRoaXMudGV0cmFkaWMoY29sb3IsIG9wdGlvbnMpO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBcIm1vbm9jaHJvbWF0aWNcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwibW9ub1wiOiByZXR1cm4gdGhpcy5tb25vY2hyb21hdGljKGNvbG9yLCBvcHRpb25zKTtcblxuICAgICAgICAgICAgICAgIGNhc2UgXCJjb21wbGVtZW50YXJ5XCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcImNvbXBsZW1lbnRcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiY29tcFwiOiByZXR1cm4gdGhpcy5jb21wbGVtZW50YXJ5KGNvbG9yLCBvcHRpb25zKTtcblxuICAgICAgICAgICAgICAgIGNhc2UgXCJkb3VibGUtY29tcGxlbWVudGFyeVwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJkb3VibGUtY29tcGxlbWVudFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJkb3VibGVcIjogcmV0dXJuIHRoaXMuZG91YmxlQ29tcGxlbWVudGFyeShjb2xvciwgb3B0aW9ucyk7XG5cbiAgICAgICAgICAgICAgICBjYXNlIFwic3BsaXQtY29tcGxlbWVudGFyeVwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJzcGxpdC1jb21wbGVtZW50XCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcInNwbGl0XCI6IHJldHVybiB0aGlzLnNwbGl0Q29tcGxlbWVudGFyeShjb2xvciwgb3B0aW9ucyk7XG5cbiAgICAgICAgICAgICAgICBjYXNlIFwic3F1YXJlXCI6IHJldHVybiB0aGlzLnNxdWFyZShjb2xvciwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgY2FzZSBcIm1hdGVyaWFsXCI6IHJldHVybiB0aGlzLm1hdGVyaWFsUGFsZXR0ZShjb2xvciwgb3B0aW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0U2NoZW1lOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlU2NoZW1lLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcbiAgICAgICAgfSxcblxuICAgICAgICBhZGQ6IGZ1bmN0aW9uKHZhbDEsIHZhbDIsIHJldHVybkFzKXtcbiAgICAgICAgICAgIHZhciBjb2xvcjEgPSB0eXBlb2YgdmFsMSA9PT0gXCJzdHJpbmdcIiA/IHRoaXMucGFyc2UodmFsMSkgOiB2YWwxO1xuICAgICAgICAgICAgdmFyIGNvbG9yMiA9IHR5cGVvZiB2YWwyID09PSBcInN0cmluZ1wiID8gdGhpcy5wYXJzZSh2YWwyKSA6IHZhbDI7XG4gICAgICAgICAgICB2YXIgYzEgPSB0aGlzLnRvUkdCQShjb2xvcjEpO1xuICAgICAgICAgICAgdmFyIGMyID0gdGhpcy50b1JHQkEoY29sb3IyKTtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBuZXcgUkdCQSgpO1xuICAgICAgICAgICAgdmFyIHRvID0gKFwiXCIrcmV0dXJuQXMpLnRvTG93ZXJDYXNlKCkgfHwgXCJoZXhcIjtcblxuICAgICAgICAgICAgcmVzdWx0LnIgPSBNYXRoLnJvdW5kKChjMS5yICsgYzIucikgLyAyKTtcbiAgICAgICAgICAgIHJlc3VsdC5nID0gTWF0aC5yb3VuZCgoYzEuZyArIGMyLmcpIC8gMik7XG4gICAgICAgICAgICByZXN1bHQuYiA9IE1hdGgucm91bmQoKGMxLmIgKyBjMi5iKSAvIDIpO1xuICAgICAgICAgICAgcmVzdWx0LmEgPSBNYXRoLnJvdW5kKChjMS5hICsgYzIuYSkgLyAyKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXNbXCJ0b1wiK3RvLnRvVXBwZXJDYXNlKCldKHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIENvbG9yID0gZnVuY3Rpb24oY29sb3IsIG9wdGlvbnMpe1xuICAgICAgICB0aGlzLl9zZXRWYWx1ZShjb2xvcik7XG4gICAgICAgIHRoaXMuX3NldE9wdGlvbnMob3B0aW9ucyk7XG4gICAgfVxuXG4gICAgQ29sb3IucHJvdG90eXBlID0ge1xuICAgICAgICBfc2V0VmFsdWU6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgIHZhciBfY29sb3I7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29sb3IgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICBfY29sb3IgPSBDb2xvcnMucGFyc2UoY29sb3IpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBfY29sb3IgPSBjb2xvcjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFDb2xvcnMuaXNDb2xvcihfY29sb3IpKSB7XG4gICAgICAgICAgICAgICAgX2NvbG9yID0gXCIjMDAwMDAwXCI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gX2NvbG9yO1xuICAgICAgICAgICAgdGhpcy5fdHlwZSA9IENvbG9ycy5jb2xvclR5cGUodGhpcy5fdmFsdWUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9zZXRPcHRpb25zOiBmdW5jdGlvbihvcHRpb25zKXtcbiAgICAgICAgICAgIG9wdGlvbnMgPSB0eXBlb2Ygb3B0aW9ucyA9PT0gXCJvYmplY3RcIiA/IG9wdGlvbnMgOiB7fTtcbiAgICAgICAgICAgIHRoaXMuX29wdGlvbnMgPSAkLmV4dGVuZCh7fSwgQ29sb3JzRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0T3B0aW9uczogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcHRpb25zO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldE9wdGlvbnM6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgICAgICAgICAgdGhpcy5fc2V0T3B0aW9ucyhvcHRpb25zKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24oY29sb3Ipe1xuICAgICAgICAgICAgdGhpcy5fc2V0VmFsdWUoY29sb3IpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldFZhbHVlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5uZWw6IGZ1bmN0aW9uKGNoLCB2YWwpe1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRUeXBlID0gdGhpcy5fdHlwZS50b1VwcGVyQ2FzZSgpO1xuXG4gICAgICAgICAgICBpZiAoW1wicmVkXCIsIFwiZ3JlZW5cIiwgXCJibHVlXCJdLmluZGV4T2YoY2gpID4gLTEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvUkdCKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdmFsdWVbY2hbMF1dID0gdmFsO1xuICAgICAgICAgICAgICAgIHRoaXNbXCJ0b1wiK2N1cnJlbnRUeXBlXSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNoID09PSBcImFscGhhXCIgJiYgdGhpcy5fdmFsdWUuYSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlLmEgPSB2YWw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoW1wiaHVlXCIsIFwic2F0dXJhdGlvblwiLCBcInZhbHVlXCJdLmluZGV4T2YoY2gpID4gLTEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvSFNWKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdmFsdWVbY2hbMF1dID0gdmFsO1xuICAgICAgICAgICAgICAgIHRoaXNbXCJ0b1wiK2N1cnJlbnRUeXBlXSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKFtcImxpZ2h0bmVzc1wiXS5pbmRleE9mKGNoKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50b0hTTCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlW2NoWzBdXSA9IHZhbDtcbiAgICAgICAgICAgICAgICB0aGlzW1widG9cIitjdXJyZW50VHlwZV0oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChbXCJjeWFuXCIsIFwibWFnZW50YVwiLCBcInllbGxvd1wiLCBcImJsYWNrXCJdLmluZGV4T2YoY2gpID4gLTEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvQ01ZSygpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlW2NoWzBdXSA9IHZhbDtcbiAgICAgICAgICAgICAgICB0aGlzW1widG9cIitjdXJyZW50VHlwZV0oKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbm5lbHM6IGZ1bmN0aW9uKG9iail7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgICQuZWFjaChvYmosIGZ1bmN0aW9uKGtleSwgdmFsKXtcbiAgICAgICAgICAgICAgICB0aGF0LmNoYW5uZWwoa2V5LCB2YWwpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvUkdCOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gQ29sb3JzLnRvUkdCKHRoaXMuX3ZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSBUeXBlcy5SR0I7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICByZ2I6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUgPyBuZXcgQ29sb3IoQ29sb3JzLnRvUkdCKHRoaXMuX3ZhbHVlKSkgOiB1bmRlZmluZWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9SR0JBOiBmdW5jdGlvbihhbHBoYSkge1xuICAgICAgICAgICAgaWYgKENvbG9ycy5pc1JHQkEodGhpcy5fdmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFscGhhKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gQ29sb3JzLnRvUkdCQSh0aGlzLl92YWx1ZSwgYWxwaGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdmFsdWUgPSBDb2xvcnMudG9SR0JBKHRoaXMuX3ZhbHVlLCBhbHBoYSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl90eXBlID0gVHlwZXMuUkdCQTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJnYmE6IGZ1bmN0aW9uKGFscGhhKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUgPyBuZXcgQ29sb3IoQ29sb3JzLnRvUkdCQSh0aGlzLl92YWx1ZSwgYWxwaGEpKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgfSxcblxuICAgICAgICB0b0hFWDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLl92YWx1ZSA9IENvbG9ycy50b0hFWCh0aGlzLl92YWx1ZSk7XG4gICAgICAgICAgICB0aGlzLl90eXBlID0gVHlwZXMuSEVYO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGV4OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZSA/IG5ldyBDb2xvcihDb2xvcnMudG9IRVgodGhpcy5fdmFsdWUpKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgfSxcblxuICAgICAgICB0b0hTVjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLl92YWx1ZSA9IENvbG9ycy50b0hTVih0aGlzLl92YWx1ZSk7XG4gICAgICAgICAgICB0aGlzLl90eXBlID0gVHlwZXMuSFNWO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaHN2OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZSA/IG5ldyBDb2xvcihDb2xvcnMudG9IU1YodGhpcy5fdmFsdWUpKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgfSxcblxuICAgICAgICB0b0hTTDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLl92YWx1ZSA9IENvbG9ycy50b0hTTCh0aGlzLl92YWx1ZSk7XG4gICAgICAgICAgICB0aGlzLl90eXBlID0gVHlwZXMuSFNMO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaHNsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZSA/IG5ldyBDb2xvcihDb2xvcnMudG9IU0wodGhpcy5fdmFsdWUpKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgfSxcblxuICAgICAgICB0b0hTTEE6IGZ1bmN0aW9uKGFscGhhKSB7XG4gICAgICAgICAgICBpZiAoQ29sb3JzLmlzSFNMQSh0aGlzLl92YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWxwaGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdmFsdWUgPSBDb2xvcnMudG9IU0xBKHRoaXMuX3ZhbHVlLCBhbHBoYSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl92YWx1ZSA9IENvbG9ycy50b0hTTEEodGhpcy5fdmFsdWUsIGFscGhhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSBUeXBlcy5IU0xBO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaHNsYTogZnVuY3Rpb24oYWxwaGEpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZSA/IG5ldyBDb2xvcihDb2xvcnMudG9IU0xBKHRoaXMuX3ZhbHVlLCBhbHBoYSkpIDogdW5kZWZpbmVkO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvQ01ZSzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLl92YWx1ZSA9IENvbG9ycy50b0NNWUsodGhpcy5fdmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5fdHlwZSA9IFR5cGVzLkNNWUs7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBjbXlrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZSA/IG5ldyBDb2xvcihDb2xvcnMudG9DTVlLKHRoaXMuX3ZhbHVlKSkgOiB1bmRlZmluZWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9XZWJzYWZlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gQ29sb3JzLndlYnNhZmUodGhpcy5fdmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5fdHlwZSA9IENvbG9ycy5jb2xvclR5cGUodGhpcy5fdmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgd2Vic2FmZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUgPyBuZXcgQ29sb3IoQ29sb3JzLndlYnNhZmUodGhpcy5fdmFsdWUpKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgfSxcblxuICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUgPyBDb2xvcnMuY29sb3JUb1N0cmluZyh0aGlzLl92YWx1ZSkgOiBcInVuZGVmaW5lZFwiO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvRGFya2VuOiBmdW5jdGlvbihhbW91bnQpIHtcbiAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gQ29sb3JzLmRhcmtlbih0aGlzLl92YWx1ZSwgYW1vdW50KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRhcmtlbjogZnVuY3Rpb24oYW1vdW50KXtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ29sb3IoQ29sb3JzLmRhcmtlbih0aGlzLl92YWx1ZSwgYW1vdW50KSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9MaWdodGVuOiBmdW5jdGlvbihhbW91bnQpIHtcbiAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gQ29sb3JzLmxpZ2h0ZW4odGhpcy5fdmFsdWUsIGFtb3VudCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBsaWdodGVuOiBmdW5jdGlvbihhbW91bnQpe1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBDb2xvcihDb2xvcnMubGlnaHRlbih0aGlzLl92YWx1ZSwgYW1vdW50KSlcbiAgICAgICAgfSxcblxuICAgICAgICBpc0Rhcms6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlID8gQ29sb3JzLmlzRGFyayh0aGlzLl92YWx1ZSkgOiB1bmRlZmluZWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNMaWdodDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUgPyBDb2xvcnMuaXNMaWdodCh0aGlzLl92YWx1ZSkgOiB1bmRlZmluZWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9IdWVTaGlmdDogZnVuY3Rpb24oaHVlLCBzYXR1cmF0aW9uLCB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5fdmFsdWUgPSBDb2xvcnMuaHVlU2hpZnQodGhpcy5fdmFsdWUsIGh1ZSwgc2F0dXJhdGlvbiwgdmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaHVlU2hpZnQ6IGZ1bmN0aW9uIChodWUsIHNhdHVyYXRpb24sIHZhbHVlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IENvbG9yKENvbG9ycy5odWVTaGlmdCh0aGlzLl92YWx1ZSwgaHVlLCBzYXR1cmF0aW9uLCB2YWx1ZSkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvR3JheXNjYWxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gQ29sb3JzLmdyYXlzY2FsZSh0aGlzLl92YWx1ZSwgdGhpcy5fdHlwZSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBncmF5c2NhbGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gbmV3IENvbG9yKENvbG9ycy5ncmF5c2NhbGUodGhpcy5fdmFsdWUsIHRoaXMuX3R5cGUpKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0eXBlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBDb2xvcnMuY29sb3JUeXBlKHRoaXMuX3ZhbHVlKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjcmVhdGVTY2hlbWU6IGZ1bmN0aW9uKG5hbWUsIGZvcm1hdCwgb3B0aW9ucykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlXG4gICAgICAgICAgICAgICAgPyBDb2xvcnMuY3JlYXRlU2NoZW1lKHRoaXMuX3ZhbHVlLCBuYW1lLCBmb3JtYXQsIG9wdGlvbnMpXG4gICAgICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0U2NoZW1lOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlU2NoZW1lLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXF1YWw6IGZ1bmN0aW9uKGNvbG9yKSB7XG4gICAgICAgICAgICByZXR1cm4gQ29sb3JzLmVxdWFsKHRoaXMuX3ZhbHVlLCBjb2xvcik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9BZGQ6IGZ1bmN0aW9uKGNvbG9yKXtcbiAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gQ29sb3JzLmFkZCh0aGlzLl92YWx1ZSwgY29sb3IsIHRoaXMuX3R5cGUpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYWRkOiBmdW5jdGlvbihjb2xvcil7XG4gICAgICAgICAgICByZXR1cm4gbmV3IENvbG9yKENvbG9ycy5hZGQodGhpcy5fdmFsdWUsIGNvbG9yLCB0aGlzLl90eXBlKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBNZXRyby5jb2xvcnMgPSBDb2xvcnMuaW5pdCgpO1xuICAgIHdpbmRvdy5Db2xvciA9IE1ldHJvLkNvbG9yID0gQ29sb3I7XG4gICAgd2luZG93LkNvbG9yUHJpbWl0aXZlID0gTWV0cm8uY29sb3JQcmltaXRpdmUgPSB7XG4gICAgICAgIFJHQjogUkdCLFxuICAgICAgICBSR0JBOiBSR0JBLFxuICAgICAgICBIU1Y6IEhTVixcbiAgICAgICAgSFNMOiBIU0wsXG4gICAgICAgIEhTTEE6IEhTTEEsXG4gICAgICAgIENNWUs6IENNWUtcbiAgICB9O1xuXG4gICAgaWYgKHdpbmRvdy5NRVRST19HTE9CQUxfQ09NTU9OID09PSB0cnVlKSB7XG4gICAgICAgIHdpbmRvdy5Db2xvcnMgPSBNZXRyby5jb2xvcnM7XG4gICAgfVxuXG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgY29va2llRGlzY2xhaW1lckRlZmF1bHRzID0ge1xuICAgICAgICBuYW1lOiAnY29va2llc19hY2NlcHRlZCcsXG4gICAgICAgIHRlbXBsYXRlOiBudWxsLFxuICAgICAgICB0ZW1wbGF0ZVNvdXJjZTogbnVsbCxcbiAgICAgICAgYWNjZXB0QnV0dG9uOiAnLmNvb2tpZS1hY2NlcHQtYnV0dG9uJyxcbiAgICAgICAgY2FuY2VsQnV0dG9uOiAnLmNvb2tpZS1jYW5jZWwtYnV0dG9uJyxcbiAgICAgICAgbWVzc2FnZTogJ091ciB3ZWJzaXRlIHVzZXMgY29va2llcyB0byBtb25pdG9yIHRyYWZmaWMgb24gb3VyIHdlYnNpdGUgYW5kIGVuc3VyZSB0aGF0IHdlIGNhbiBwcm92aWRlIG91ciBjdXN0b21lcnMgd2l0aCB0aGUgYmVzdCBvbmxpbmUgZXhwZXJpZW5jZSBwb3NzaWJsZS4nLFxuICAgICAgICBkdXJhdGlvbjogXCIzMGRheXNcIixcbiAgICAgICAgY2xzQ29udGFpbmVyOiBcIlwiLFxuICAgICAgICBjbHNNZXNzYWdlOiBcIlwiLFxuICAgICAgICBjbHNCdXR0b25zOiBcIlwiLFxuICAgICAgICBjbHNBY2NlcHRCdXR0b246IFwiYWxlcnRcIixcbiAgICAgICAgY2xzQ2FuY2VsQnV0dG9uOiBcIlwiLFxuICAgICAgICBvbkFjY2VwdDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EZWNsaW5lOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmNvb2tpZURpc2NsYWltZXIgPSB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBjb29raWUgPSBNZXRyby5jb29raWU7XG5cbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBjb29raWVEaXNjbGFpbWVyRGVmYXVsdHMsIG9wdGlvbnMpO1xuICAgICAgICAgICAgdGhpcy5kaXNjbGFpbWVyID0gJChcIjxkaXY+XCIpO1xuXG4gICAgICAgICAgICBpZiAoY29va2llLmdldENvb2tpZSh0aGlzLm9wdGlvbnMubmFtZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnRlbXBsYXRlKSB7XG4gICAgICAgICAgICAgICAgZmV0Y2godGhpcy5vcHRpb25zLnRlbXBsYXRlKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihNZXRyby5mZXRjaC50ZXh0KVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuY3JlYXRlKGRhdGEpXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMudGVtcGxhdGVTb3VyY2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZSgkKHRoaXMub3B0aW9ucy50ZW1wbGF0ZVNvdXJjZSkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNyZWF0ZTogZnVuY3Rpb24oaHRtbCl7XG4gICAgICAgICAgICB2YXIgY29va2llID0gTWV0cm8uY29va2llO1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnMsIHdyYXBwZXIgPSB0aGlzLmRpc2NsYWltZXIsIGJ1dHRvbnM7XG5cbiAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJjb29raWUtZGlzY2xhaW1lci1ibG9ja1wiKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhvLmNsc0NvbnRhaW5lcik7XG5cbiAgICAgICAgICAgIGlmICghaHRtbCkge1xuICAgICAgICAgICAgICAgIGJ1dHRvbnMgPSAkKFwiPGRpdj5cIilcbiAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKFwiY29va2llLWRpc2NsYWltZXItYWN0aW9uc1wiKVxuICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3Moby5jbHNCdXR0b25zKVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCAkKCc8YnV0dG9uPicpLmFkZENsYXNzKCdidXR0b24gY29va2llLWFjY2VwdC1idXR0b24nKS5hZGRDbGFzcyhvLmNsc0FjY2VwdEJ1dHRvbikuaHRtbCgnQWNjZXB0JykgKVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCAkKCc8YnV0dG9uPicpLmFkZENsYXNzKCdidXR0b24gY29va2llLWNhbmNlbC1idXR0b24nKS5hZGRDbGFzcyhvLmNsc0NhbmNlbEJ1dHRvbikuaHRtbCgnQ2FuY2VsJykgKTtcblxuICAgICAgICAgICAgICAgIHdyYXBwZXJcbiAgICAgICAgICAgICAgICAgICAgLmh0bWwoICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhvLmNsc01lc3NhZ2UpLmh0bWwoby5tZXNzYWdlKSApXG4gICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoICQoXCI8aHI+XCIpLmFkZENsYXNzKCd0aGluJykgKVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKGJ1dHRvbnMpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGh0bWwgaW5zdGFuY2VvZiAkKSB7XG4gICAgICAgICAgICAgICAgd3JhcHBlci5hcHBlbmQoaHRtbCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHdyYXBwZXIuaHRtbChodG1sKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgd3JhcHBlci5hcHBlbmRUbygkKCdib2R5JykpO1xuXG4gICAgICAgICAgICB3cmFwcGVyLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgby5hY2NlcHRCdXR0b24sIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGR1ciA9IDA7XG4gICAgICAgICAgICAgICAgdmFyIGR1cmF0aW9ucyA9IChcIlwiK28uZHVyYXRpb24pLnRvQXJyYXkoXCIgXCIpO1xuXG4gICAgICAgICAgICAgICAgJC5lYWNoKGR1cmF0aW9ucywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBcIlwiK3RoaXM7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkLmluY2x1ZGVzKFwiZGF5XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkdXIgKz0gcGFyc2VJbnQoZCkqMjQqNjAqNjAqMTAwMDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGlmIChkLmluY2x1ZGVzKFwiaG91clwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZHVyICs9IHBhcnNlSW50KGQpKjYwKjYwKjEwMDA7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgICAgICAgICBpZiAoZC5pbmNsdWRlcyhcIm1pblwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZHVyICs9IHBhcnNlSW50KGQpKjYwKjEwMDA7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgICAgICAgICBpZiAoZC5pbmNsdWRlcyhcInNlY1wiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZHVyICs9IHBhcnNlSW50KGQpKjEwMDA7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkdXIgKz0gcGFyc2VJbnQoZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgY29va2llLnNldENvb2tpZShvLm5hbWUsIHRydWUsIGR1cik7XG4gICAgICAgICAgICAgICAgVXRpbHMuZXhlYyhvLm9uQWNjZXB0KTtcbiAgICAgICAgICAgICAgICB3cmFwcGVyLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHdyYXBwZXIub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBvLmNhbmNlbEJ1dHRvbiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBVdGlscy5leGVjKG8ub25EZWNsaW5lKTtcbiAgICAgICAgICAgICAgICB3cmFwcGVyLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIENvb2tpZURlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIHBhdGg6IFwiL1wiLFxuICAgICAgICBleHBpcmVzOiBudWxsLFxuICAgICAgICBtYXhBZ2U6IG51bGwsXG4gICAgICAgIGRvbWFpbjogbnVsbCxcbiAgICAgICAgc2VjdXJlOiBmYWxzZSxcbiAgICAgICAgc2FtZXNpdGU6IG51bGxcbiAgICB9XG5cbiAgICBNZXRyby5jb29raWVTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIENvb2tpZURlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgQ29va2llRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9Db29raWVTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmNvb2tpZVNldHVwKHdpbmRvd1tcIm1ldHJvQ29va2llU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLmNvb2tpZSA9IHtcbiAgICAgICAgZ2V0Q29va2llczogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBhID0gZG9jdW1lbnQuY29va2llLnRvQXJyYXkoXCI7XCIpO1xuICAgICAgICAgICAgdmFyIG8gPSB7fTtcbiAgICAgICAgICAgICQuZWFjaChhLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBpID0gdGhpcy5zcGxpdCgnPScpO1xuICAgICAgICAgICAgICAgIG9baVswXV0gPSBpWzFdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gbztcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRDb29raWU6IGZ1bmN0aW9uKG5hbWUpe1xuICAgICAgICAgICAgdmFyIGNvb2tpZU5hbWUgPSBlbmNvZGVVUklDb21wb25lbnQobmFtZSkgKyBcIj1cIjtcbiAgICAgICAgICAgIHZhciBjb29raWVzID0gZG9jdW1lbnQuY29va2llLnRvQXJyYXkoXCI7XCIpO1xuICAgICAgICAgICAgdmFyIGksIGNvb2tpZTtcblxuICAgICAgICAgICAgZm9yKGkgPSAwOyBpIDwgY29va2llcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvb2tpZSA9IGNvb2tpZXNbaV07XG4gICAgICAgICAgICAgICAgd2hpbGUgKGNvb2tpZS5jaGFyQXQoMCkgPT09ICcgJykge1xuICAgICAgICAgICAgICAgICAgICBjb29raWUgPSBjb29raWUuc3Vic3RyaW5nKDEsIGNvb2tpZS5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY29va2llLmluZGV4T2YoY29va2llTmFtZSkgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChjb29raWUuc3Vic3RyaW5nKGNvb2tpZU5hbWUubGVuZ3RoLCBjb29raWUubGVuZ3RoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0Q29va2llOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSwgb3B0aW9ucyl7XG4gICAgICAgICAgICB2YXIgZGF0ZTtcbiAgICAgICAgICAgIHZhciBjb29raWVOYW1lID0gZW5jb2RlVVJJQ29tcG9uZW50KG5hbWUpO1xuICAgICAgICAgICAgdmFyIGNvb2tpZVZhbHVlID0gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKTtcbiAgICAgICAgICAgIHZhciBvcHQsIGEgPSBbXTtcblxuICAgICAgICAgICAgaWYgKG9wdGlvbnMgJiYgdHlwZW9mIG9wdGlvbnMgIT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICAgICAgICBkYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgICAgICBkYXRlLnNldFRpbWUoZGF0ZS5nZXRUaW1lKCkrKHBhcnNlSW50KG9wdGlvbnMpKSk7XG4gICAgICAgICAgICAgICAgb3B0ID0gJC5leHRlbmQoe30sIENvb2tpZURlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICAgICAgZXhwaXJlczogZGF0ZS50b1VUQ1N0cmluZygpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG9wdCA9ICQuZXh0ZW5kKHt9LCBDb29raWVEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJC5lYWNoKG9wdCwgZnVuY3Rpb24oa2V5LCB2YWwpe1xuICAgICAgICAgICAgICAgIGlmIChrZXkgIT09ICdzZWN1cmUnICYmIHZhbCkge1xuICAgICAgICAgICAgICAgICAgICBhLnB1c2goQ2FrZS5kYXNoZWROYW1lKGtleSkgKyBcIj1cIiArIHZhbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdzZWN1cmUnICYmIHZhbCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBhLnB1c2goIFwic2VjdXJlXCIgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZG9jdW1lbnQuY29va2llID0gY29va2llTmFtZSArICc9JyArIGNvb2tpZVZhbHVlICsgXCI7IFwiICsgIGEuam9pbihcIjsgXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlbENvb2tpZTogZnVuY3Rpb24obmFtZSl7XG4gICAgICAgICAgICB0aGlzLnNldENvb2tpZShuYW1lLCBmYWxzZSwge1xuICAgICAgICAgICAgICAgIG1heEFnZTogLTFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBDb3VudGRvd25EZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBjb3VudGRvd25EZWZlcnJlZDogMCxcbiAgICAgICAgc3RvcE9uQmx1cjogdHJ1ZSxcbiAgICAgICAgYW5pbWF0ZTogXCJub25lXCIsXG4gICAgICAgIGVhc2U6IFwibGluZWFyXCIsXG4gICAgICAgIGR1cmF0aW9uOiA2MDAsXG4gICAgICAgIGlucHV0Rm9ybWF0OiBudWxsLFxuICAgICAgICBsb2NhbGU6IE1FVFJPX0xPQ0FMRSxcbiAgICAgICAgZGF5czogMCxcbiAgICAgICAgaG91cnM6IDAsXG4gICAgICAgIG1pbnV0ZXM6IDAsXG4gICAgICAgIHNlY29uZHM6IDAsXG4gICAgICAgIGRhdGU6IG51bGwsXG4gICAgICAgIHN0YXJ0OiB0cnVlLFxuICAgICAgICBjbHNDb3VudGRvd246IFwiXCIsXG4gICAgICAgIGNsc1BhcnQ6IFwiXCIsXG4gICAgICAgIGNsc1plcm86IFwiXCIsXG4gICAgICAgIGNsc0FsYXJtOiBcIlwiLFxuICAgICAgICBjbHNEYXlzOiBcIlwiLFxuICAgICAgICBjbHNIb3VyczogXCJcIixcbiAgICAgICAgY2xzTWludXRlczogXCJcIixcbiAgICAgICAgY2xzU2Vjb25kczogXCJcIixcbiAgICAgICAgb25BbGFybTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25UaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvblplcm86IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQmxpbms6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQ291bnRkb3duQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmNvdW50ZG93blNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgQ291bnRkb3duRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBDb3VudGRvd25EZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0NvdW50ZG93blNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8uY291bnRkb3duU2V0dXAod2luZG93W1wibWV0cm9Db3VudGRvd25TZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdjb3VudGRvd24nLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgQ291bnRkb3duRGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIGxvY2FsZTogTWV0cm8ubG9jYWxlc1tcImVuLVVTXCJdLFxuICAgICAgICAgICAgICAgIGJyZWFrcG9pbnQ6IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCksXG4gICAgICAgICAgICAgICAgYmxpbmtJbnRlcnZhbDogbnVsbCxcbiAgICAgICAgICAgICAgICB0aWNrSW50ZXJ2YWw6IG51bGwsXG4gICAgICAgICAgICAgICAgemVyb0RheXNGaXJlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgemVyb0hvdXJzRmlyZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHplcm9NaW51dGVzRmlyZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHplcm9TZWNvbmRzRmlyZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGZvbnRTaXplOiBwYXJzZUludChVdGlscy5nZXRTdHlsZU9uZShlbGVtLCBcImZvbnQtc2l6ZVwiKSksXG4gICAgICAgICAgICAgICAgY3VycmVudDoge1xuICAgICAgICAgICAgICAgICAgICBkOiAwLCBoOiAwLCBtOiAwLCBzOiAwXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpbmFjdGl2ZVRhYjogZmFsc2UsXG4gICAgICAgICAgICAgICAgaWQ6IFV0aWxzLmVsZW1lbnRJZChcImNvdW50ZG93blwiKSxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogNjAwXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICB0aGlzLmxvY2FsZSA9IE1ldHJvLmxvY2FsZXNbby5sb2NhbGVdICE9PSB1bmRlZmluZWQgPyBNZXRyby5sb2NhbGVzW28ubG9jYWxlXSA6IE1ldHJvLmxvY2FsZXNbXCJlbi1VU1wiXTtcblxuICAgICAgICAgICAgdGhpcy5kdXJhdGlvbiA9ICgrby5kdXJhdGlvbiA8PSAwIHx8ICtvLmR1cmF0aW9uID49IDEwMDApID8gNjAwIDogK28uZHVyYXRpb247XG5cbiAgICAgICAgICAgIHRoaXMuX2J1aWxkKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfc2V0QnJlYWtwb2ludDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGRtID0gODY0MDAwMDAsIGhtID0gMzYwMDAwMCwgbW0gPSA2MDAwMCwgc20gPSAxMDAwO1xuXG4gICAgICAgICAgICB0aGlzLmJyZWFrcG9pbnQgPSBkYXRldGltZSgpLnRpbWUoKTtcblxuICAgICAgICAgICAgaWYgKG8uZGF0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYnJlYWtwb2ludCA9IChvLmlucHV0Rm9ybWF0ID8gRGF0ZXRpbWUuZnJvbShvLmRhdGUsIG8uaW5wdXRGb3JtYXQpIDogZGF0ZXRpbWUoby5kYXRlKSkudGltZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocGFyc2VJbnQoby5kYXlzKSA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJyZWFrcG9pbnQgKz0gcGFyc2VJbnQoby5kYXlzKSAqIGRtO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHBhcnNlSW50KG8uaG91cnMpID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYnJlYWtwb2ludCArPSBwYXJzZUludChvLmhvdXJzKSAqIGhtO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHBhcnNlSW50KG8ubWludXRlcykgPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5icmVha3BvaW50ICs9IHBhcnNlSW50KG8ubWludXRlcykgKiBtbTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwYXJzZUludChvLnNlY29uZHMpID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYnJlYWtwb2ludCArPSBwYXJzZUludChvLnNlY29uZHMpICogc207XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2J1aWxkOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHBhcnRzID0gW1wiZGF5c1wiLCBcImhvdXJzXCIsIFwibWludXRlc1wiLCBcInNlY29uZHNcIl07XG4gICAgICAgICAgICB2YXIgZG0gPSAyNCo2MCo2MCoxMDAwO1xuICAgICAgICAgICAgdmFyIGRlbHRhX2RheXM7XG4gICAgICAgICAgICB2YXIgbm93ID0gZGF0ZXRpbWUoKS50aW1lKCk7XG4gICAgICAgICAgICB2YXIgZGlnaXQ7XG5cbiAgICAgICAgICAgIGlmICghZWxlbWVudC5hdHRyKFwiaWRcIikpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJpZFwiLCBVdGlscy5lbGVtZW50SWQoXCJjb3VudGRvd25cIikpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUoZWxlbWVudC5hdHRyKFwiaWRcIikpKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwiaWRcIiwgVXRpbHMuZWxlbWVudElkKFwiY291bnRkb3duXCIpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImNvdW50ZG93blwiKS5hZGRDbGFzcyhvLmNsc0NvdW50ZG93bik7XG5cbiAgICAgICAgICAgIHRoaXMuX3NldEJyZWFrcG9pbnQoKTtcblxuICAgICAgICAgICAgZGVsdGFfZGF5cyA9IE1hdGgucm91bmQoKHRoYXQuYnJlYWtwb2ludCAtIG5vdykgLyBkbSk7XG5cbiAgICAgICAgICAgICQuZWFjaChwYXJ0cywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgcGFydCA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInBhcnQgXCIgKyB0aGlzKS5hZGRDbGFzcyhvLmNsc1BhcnQpLmF0dHIoXCJkYXRhLWxhYmVsXCIsIHRoYXQubG9jYWxlW1wiY2FsZW5kYXJcIl1bXCJ0aW1lXCJdW3RoaXNdKS5hcHBlbmRUbyhlbGVtZW50KTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzID09PSBcImRheXNcIikge3BhcnQuYWRkQ2xhc3Moby5jbHNEYXlzKTt9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMgPT09IFwiaG91cnNcIikge3BhcnQuYWRkQ2xhc3Moby5jbHNIb3Vycyk7fVxuICAgICAgICAgICAgICAgIGlmICh0aGlzID09PSBcIm1pbnV0ZXNcIikge3BhcnQuYWRkQ2xhc3Moby5jbHNNaW51dGVzKTt9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMgPT09IFwic2Vjb25kc1wiKSB7cGFydC5hZGRDbGFzcyhvLmNsc1NlY29uZHMpO31cblxuICAgICAgICAgICAgICAgICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImRpZ2l0XCIpLmFwcGVuZFRvKHBhcnQpO1xuICAgICAgICAgICAgICAgICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImRpZ2l0XCIpLmFwcGVuZFRvKHBhcnQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMgPT09IFwiZGF5c1wiICYmIGRlbHRhX2RheXMgPj0gMTAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IFN0cmluZyhNYXRoLnJvdW5kKGRlbHRhX2RheXMvMTAwKSkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImRpZ2l0XCIpLmFwcGVuZFRvKHBhcnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZGlnaXQgPSBlbGVtZW50LmZpbmQoXCIuZGlnaXRcIik7XG4gICAgICAgICAgICBkaWdpdC5hcHBlbmQoJChcIjxzcGFuIGNsYXNzPSdkaWdpdC1wbGFjZWhvbGRlcic+XCIpLmh0bWwoXCIwXCIpKTtcbiAgICAgICAgICAgIGRpZ2l0LmFwcGVuZCgkKFwiPHNwYW4gY2xhc3M9J2RpZ2l0LXZhbHVlJz5cIikuaHRtbChcIjBcIikpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJjb3VudGRvd24tY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICBpZiAoby5zdGFydCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnQoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy50aWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKFwidmlzaWJpbGl0eWNoYW5nZVwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQuaGlkZGVuKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQucGF1c2UoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnJlc3VtZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHtuczogdGhpcy5pZH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGJsaW5rOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICBlbGVtZW50LnRvZ2dsZUNsYXNzKFwiYmxpbmtcIik7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImJsaW5rXCIsIHtcbiAgICAgICAgICAgICAgICB0aW1lOiB0aGlzLmN1cnJlbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRpY2s6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBkbSA9IDI0KjYwKjYwLCBobSA9IDYwKjYwLCBtbSA9IDYwLCBzbSA9IDE7XG4gICAgICAgICAgICB2YXIgbGVmdCwgbm93ID0gZGF0ZXRpbWUoKS50aW1lKCk7XG4gICAgICAgICAgICB2YXIgZCwgaCwgbSwgcztcbiAgICAgICAgICAgIHZhciBkYXlzID0gZWxlbWVudC5maW5kKFwiLmRheXNcIiksXG4gICAgICAgICAgICAgICAgaG91cnMgPSBlbGVtZW50LmZpbmQoXCIuaG91cnNcIiksXG4gICAgICAgICAgICAgICAgbWludXRlcyA9IGVsZW1lbnQuZmluZChcIi5taW51dGVzXCIpLFxuICAgICAgICAgICAgICAgIHNlY29uZHMgPSBlbGVtZW50LmZpbmQoXCIuc2Vjb25kc1wiKTtcblxuICAgICAgICAgICAgbGVmdCA9IE1hdGguZmxvb3IoKHRoaXMuYnJlYWtwb2ludCAtIG5vdykvMTAwMCk7XG5cbiAgICAgICAgICAgIGlmIChsZWZ0IDw9IC0xKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdG9wKCk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhvLmNsc0FsYXJtKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImFsYXJtXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZTogbm93XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkID0gTWF0aC5mbG9vcihsZWZ0IC8gZG0pO1xuXG4gICAgICAgICAgICBsZWZ0IC09IGQgKiBkbTtcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnQuZCAhPT0gZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudC5kID0gZDtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXcoXCJkYXlzXCIsIGQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnplcm9EYXlzRmlyZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuemVyb0RheXNGaXJlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGRheXMuYWRkQ2xhc3Moby5jbHNaZXJvKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJ6ZXJvXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnQ6IFwiZGF5c1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGRheXNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBoID0gTWF0aC5mbG9vcihsZWZ0IC8gaG0pO1xuICAgICAgICAgICAgbGVmdCAtPSBoKmhtO1xuICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudC5oICE9PSBoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50LmggPSBoO1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhdyhcImhvdXJzXCIsIGgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZCA9PT0gMCAmJiBoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuemVyb0hvdXJzRmlyZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuemVyb0hvdXJzRmlyZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBob3Vycy5hZGRDbGFzcyhvLmNsc1plcm8pO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInplcm9cIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFydDogXCJob3Vyc1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGhvdXJzXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbSA9IE1hdGguZmxvb3IobGVmdCAvIG1tKTtcbiAgICAgICAgICAgIGxlZnQgLT0gbSptbTtcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnQubSAhPT0gbSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudC5tID0gbTtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXcoXCJtaW51dGVzXCIsIG0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZCA9PT0gMCAmJiBoID09PSAwICYmIG0gPT09IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy56ZXJvTWludXRlc0ZpcmVkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnplcm9NaW51dGVzRmlyZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBtaW51dGVzLmFkZENsYXNzKG8uY2xzWmVybyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiemVyb1wiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJ0OiBcIm1pbnV0ZXNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBtaW51dGVzXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzID0gTWF0aC5mbG9vcihsZWZ0IC8gc20pO1xuICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudC5zICE9PSBzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50LnMgPSBzO1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhdyhcInNlY29uZHNcIiwgcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkID09PSAwICYmIGggPT09IDAgJiYgbSA9PT0gMCAmJiBzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuemVyb1NlY29uZHNGaXJlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy56ZXJvU2Vjb25kc0ZpcmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgc2Vjb25kcy5hZGRDbGFzcyhvLmNsc1plcm8pO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInplcm9cIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFydDogXCJzZWNvbmRzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogc2Vjb25kc1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwidGlja1wiLCB7XG4gICAgICAgICAgICAgICAgZGF5czogZCxcbiAgICAgICAgICAgICAgICBob3VyczogaCxcbiAgICAgICAgICAgICAgICBtaW51dGVzOiBtLFxuICAgICAgICAgICAgICAgIHNlY29uZHM6IHNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRyYXc6IGZ1bmN0aW9uKHBhcnQsIHZhbHVlKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGRpZ2l0cywgZGlnaXRzX2xlbmd0aCwgZGlnaXRfdmFsdWUsIGRpZ2l0X2N1cnJlbnQsIGRpZ2l0O1xuICAgICAgICAgICAgdmFyIGxlbiwgaSwgZHVyYXRpb24gPSB0aGlzLmR1cmF0aW9uO1xuXG4gICAgICAgICAgICB2YXIgc2xpZGVEaWdpdCA9IGZ1bmN0aW9uKGRpZ2l0LCB2YWx1ZSl7XG4gICAgICAgICAgICAgICAgdmFyIGRpZ2l0X2NvcHksIGhlaWdodCA9IGRpZ2l0LmhlaWdodCgpO1xuXG4gICAgICAgICAgICAgICAgZGlnaXQuc2libGluZ3MoXCItb2xkLWRpZ2l0XCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIGRpZ2l0X2NvcHkgPSBkaWdpdC5jbG9uZSgpLmFwcGVuZFRvKGRpZ2l0LnBhcmVudCgpKTtcbiAgICAgICAgICAgICAgICBkaWdpdF9jb3B5LmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogLTEgKiBoZWlnaHQgKyAncHgnXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBkaWdpdFxuICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCItb2xkLWRpZ2l0XCIpXG4gICAgICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZHVyOiBkdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGVhc2U6IG8uZWFzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRG9uZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGRpZ2l0X2NvcHlcbiAgICAgICAgICAgICAgICAgICAgLmh0bWwodmFsdWUpXG4gICAgICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cjogZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBlYXNlOiBvLmVhc2VcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgZmFkZURpZ2l0ID0gZnVuY3Rpb24oZGlnaXQsIHZhbHVlKXtcbiAgICAgICAgICAgICAgICB2YXIgZGlnaXRfY29weTtcbiAgICAgICAgICAgICAgICBkaWdpdC5zaWJsaW5ncyhcIi1vbGQtZGlnaXRcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgZGlnaXRfY29weSA9IGRpZ2l0LmNsb25lKCkuYXBwZW5kVG8oZGlnaXQucGFyZW50KCkpO1xuICAgICAgICAgICAgICAgIGRpZ2l0X2NvcHkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZGlnaXRcbiAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKFwiLW9sZC1kaWdpdFwiKVxuICAgICAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBkcmF3OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cjogZHVyYXRpb24gLyAyLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWFzZTogby5lYXNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgb25Eb25lOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZGlnaXRfY29weVxuICAgICAgICAgICAgICAgICAgICAuaHRtbCh2YWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBkdXI6IGR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWFzZTogby5lYXNlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHpvb21EaWdpdCA9IGZ1bmN0aW9uKGRpZ2l0LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhciBkaWdpdF9jb3B5LCBoZWlnaHQgPSBkaWdpdC5oZWlnaHQoKSwgZnMgPSBwYXJzZUludChkaWdpdC5zdHlsZShcImZvbnQtc2l6ZVwiKSk7XG5cbiAgICAgICAgICAgICAgICBkaWdpdC5zaWJsaW5ncyhcIi1vbGQtZGlnaXRcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgZGlnaXRfY29weSA9IGRpZ2l0LmNsb25lKCkuYXBwZW5kVG8oZGlnaXQucGFyZW50KCkpO1xuICAgICAgICAgICAgICAgIGRpZ2l0X2NvcHkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwLFxuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBkaWdpdFxuICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCItb2xkLWRpZ2l0XCIpXG4gICAgICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiAwXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZHVyOiBkdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGVhc2U6IG8uZWFzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRG9uZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGRpZ2l0X2NvcHlcbiAgICAgICAgICAgICAgICAgICAgLmh0bWwodmFsdWUpXG4gICAgICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250U2l6ZTogWzAsIGZzXVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cjogZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBlYXNlOiBvLmVhc2VcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YWx1ZSA9IFwiXCIrdmFsdWU7XG5cbiAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9ICcwJyt2YWx1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGVuID0gdmFsdWUubGVuZ3RoO1xuXG4gICAgICAgICAgICBkaWdpdHMgPSBlbGVtZW50LmZpbmQoXCIuXCIrcGFydCtcIiAuZGlnaXQ6bm90KC1vbGQtZGlnaXQpXCIpO1xuICAgICAgICAgICAgZGlnaXRzX2xlbmd0aCA9IGRpZ2l0cy5sZW5ndGg7XG5cbiAgICAgICAgICAgIGZvcihpID0gMDsgaSA8IGxlbjsgaSsrKXtcbiAgICAgICAgICAgICAgICBkaWdpdCA9IGRpZ2l0cy5lcShkaWdpdHNfbGVuZ3RoIC0gMSkuZmluZChcIi5kaWdpdC12YWx1ZVwiKTtcbiAgICAgICAgICAgICAgICBkaWdpdF92YWx1ZSA9IE1hdGguZmxvb3IoIHBhcnNlSW50KHZhbHVlKSAvIE1hdGgucG93KDEwLCBpKSApICUgMTA7XG4gICAgICAgICAgICAgICAgZGlnaXRfY3VycmVudCA9IHBhcnNlSW50KGRpZ2l0LnRleHQoKSk7XG5cbiAgICAgICAgICAgICAgICBkaWdpdHNfbGVuZ3RoLS07XG5cbiAgICAgICAgICAgICAgICBpZiAoZGlnaXRfY3VycmVudCA9PT0gZGlnaXRfdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc3dpdGNoICgoXCJcIitvLmFuaW1hdGUpLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInNsaWRlXCI6IHNsaWRlRGlnaXQoZGlnaXQsIGRpZ2l0X3ZhbHVlKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJmYWRlXCI6IGZhZGVEaWdpdChkaWdpdCwgZGlnaXRfdmFsdWUpOyBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInpvb21cIjogem9vbURpZ2l0KGRpZ2l0LCBkaWdpdF92YWx1ZSk7IGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBkaWdpdC5odG1sKGRpZ2l0X3ZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGlmIChlbGVtZW50LmRhdGEoXCJwYXVzZWRcIikgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuYmxpbmtJbnRlcnZhbCk7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMudGlja0ludGVydmFsKTtcblxuICAgICAgICAgICAgZWxlbWVudC5kYXRhKFwicGF1c2VkXCIsIGZhbHNlKTtcblxuICAgICAgICAgICAgdGhpcy5fc2V0QnJlYWtwb2ludCgpO1xuICAgICAgICAgICAgdGhpcy50aWNrKCk7XG5cbiAgICAgICAgICAgIHRoaXMuYmxpbmtJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCl7dGhhdC5ibGluaygpO30sIDUwMCk7XG4gICAgICAgICAgICB0aGlzLnRpY2tJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCl7dGhhdC50aWNrKCk7fSwgMTAwMCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc3RvcDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmJsaW5rSW50ZXJ2YWwpO1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpY2tJbnRlcnZhbCk7XG4gICAgICAgICAgICBlbGVtZW50LmRhdGEoXCJwYXVzZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuZGlnaXRcIikuaHRtbChcIjBcIik7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnQgPSB7XG4gICAgICAgICAgICAgICAgZDogMCwgaDowLCBtOiAwLCBzOjBcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgcGF1c2U6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuYmxpbmtJbnRlcnZhbCk7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMudGlja0ludGVydmFsKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwicGF1c2VkXCIsIHRydWUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlc3VtZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmRhdGEoXCJwYXVzZWRcIiwgZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy5ibGlua0ludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXt0aGF0LmJsaW5rKCk7fSwgNTAwKTtcbiAgICAgICAgICAgIHRoaXMudGlja0ludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXt0aGF0LnRpY2soKTt9LCAxMDAwKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZXNldDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmJsaW5rSW50ZXJ2YWwpO1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpY2tJbnRlcnZhbCk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5wYXJ0XCIpLnJlbW92ZUNsYXNzKG8uY2xzWmVybyk7XG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuZGlnaXRcIikuaHRtbChcIjBcIik7XG5cbiAgICAgICAgICAgIHRoaXMuX3NldEJyZWFrcG9pbnQoKTtcblxuICAgICAgICAgICAgZWxlbWVudC5kYXRhKFwicGF1c2VkXCIsIGZhbHNlKTtcblxuICAgICAgICAgICAgdGhpcy50aWNrKCk7XG5cbiAgICAgICAgICAgIHRoaXMuYmxpbmtJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCl7dGhhdC5ibGluaygpO30sIDUwMCk7XG4gICAgICAgICAgICB0aGlzLnRpY2tJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCl7dGhhdC50aWNrKCk7fSwgMTAwMCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlUGxheTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmVsZW1lbnQuYXR0cihcImRhdGEtcGF1c2VcIikgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhdXNlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpc1BhdXNlZDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQuZGF0YShcInBhdXNlZFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRCcmVha3BvaW50OiBmdW5jdGlvbihhc0RhdGUpe1xuICAgICAgICAgICAgcmV0dXJuIGFzRGF0ZSA9PT0gdHJ1ZSA/IG5ldyBEYXRlKHRoaXMuYnJlYWtwb2ludCkgOiB0aGlzLmJyZWFrcG9pbnQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0TGVmdDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBkbSA9IDI0KjYwKjYwKjEwMDAsIGhtID0gNjAqNjAqMTAwMCwgbW0gPSA2MCoxMDAwLCBzbSA9IDEwMDA7XG4gICAgICAgICAgICB2YXIgbm93ID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTtcbiAgICAgICAgICAgIHZhciBsZWZ0X3NlY29uZHMgPSBNYXRoLmZsb29yKHRoaXMuYnJlYWtwb2ludCAtIG5vdyk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGRheXM6IE1hdGgucm91bmQobGVmdF9zZWNvbmRzIC8gZG0pLFxuICAgICAgICAgICAgICAgIGhvdXJzOiBNYXRoLnJvdW5kKGxlZnRfc2Vjb25kcyAvIGhtKSxcbiAgICAgICAgICAgICAgICBtaW51dGVzOiBNYXRoLnJvdW5kKGxlZnRfc2Vjb25kcyAvIG1tKSxcbiAgICAgICAgICAgICAgICBzZWNvbmRzOiBNYXRoLnJvdW5kKGxlZnRfc2Vjb25kcyAvIHNtKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcblxuICAgICAgICBpMThuOiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHBhcnRzID0gW1wiZGF5c1wiLCBcImhvdXJzXCIsIFwibWludXRlc1wiLCBcInNlY29uZHNcIl07XG5cblxuICAgICAgICAgICAgaWYgKHZhbCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG8ubG9jYWxlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKE1ldHJvLmxvY2FsZXNbdmFsXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgby5sb2NhbGUgPSB2YWw7XG4gICAgICAgICAgICB0aGlzLmxvY2FsZSA9IE1ldHJvLmxvY2FsZXNbby5sb2NhbGVdO1xuXG4gICAgICAgICAgICAkLmVhY2gocGFydHMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGNscyA9IFwiLnBhcnQuXCIgKyB0aGlzO1xuICAgICAgICAgICAgICAgIHZhciBwYXJ0ID0gZWxlbWVudC5maW5kKGNscyk7XG4gICAgICAgICAgICAgICAgcGFydC5hdHRyKFwiZGF0YS1sYWJlbFwiLCB0aGF0LmxvY2FsZVtcImNhbGVuZGFyXCJdW1widGltZVwiXVt0aGlzXSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyTG9jYWxlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgbG9jYWxlID0gZWxlbWVudC5hdHRyKCdkYXRhLWxvY2FsZScpO1xuICAgICAgICAgICAgdGhpcy5pMThuKGxvY2FsZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyLCBuZXdWYWwpe1xuICAgICAgICAgICAgc3dpdGNoIChhdHRyKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtcGF1c2VcIjogdGhpcy50b2dnbGVQbGF5KCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLWxvY2FsZVwiOiB0aGlzLmkxOG4obmV3VmFsKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtZHVyYXRpb25cIjogdGhpcy5kdXJhdGlvbiA9ICtuZXdWYWwgPD0gMCB8fCArbmV3VmFsID49IDEwMDAgPyA2MDAgOiArbmV3VmFsOyBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmJsaW5rSW50ZXJ2YWwpO1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpY2tJbnRlcnZhbCk7XG5cbiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihcInZpc2liaWxpdHljaGFuZ2VcIiwge25zOiB0aGlzLmlkfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBDb3VudGVyRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgc3RhcnRPblZpZXdwb3J0OiB0cnVlLFxuICAgICAgICBjb3VudGVyRGVmZXJyZWQ6IDAsXG4gICAgICAgIGR1cmF0aW9uOiAyMDAwLFxuICAgICAgICB2YWx1ZTogMCxcbiAgICAgICAgZnJvbTogMCxcbiAgICAgICAgdGltZW91dDogMCxcbiAgICAgICAgZGVsaW1pdGVyOiBcIixcIixcbiAgICAgICAgcHJlZml4OiBcIlwiLFxuICAgICAgICBzdWZmaXg6IFwiXCIsXG4gICAgICAgIG9uU3RhcnQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uU3RvcDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25UaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNvdW50ZXJDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uY291bnRlclNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgQ291bnRlckRlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgQ291bnRlckRlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvQ291bnRlclNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8uY291bnRlclNldHVwKHdpbmRvd1tcIm1ldHJvQ291bnRlclNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ2NvdW50ZXInLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgQ291bnRlckRlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICBudW1iZXJzOiBbXSxcbiAgICAgICAgICAgICAgICBodG1sOiAkKGVsZW0pLmh0bWwoKSxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBpZDogVXRpbHMuZWxlbWVudElkKFwiY291bnRlclwiKVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImNvdW50ZXItY3JlYXRlXCIpO1xuICAgICAgICAgICAgdGhpcy5fcnVuKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgJC53aW5kb3coKS5vbihcInNjcm9sbFwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmIChvLnN0YXJ0T25WaWV3cG9ydCA9PT0gdHJ1ZSAmJiBVdGlscy5pblZpZXdwb3J0KGVsZW1lbnRbMF0pICYmICF0aGF0LnN0YXJ0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5zdGFydCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHtuczogdGhpcy5pZH0pXG4gICAgICAgIH0sXG5cbiAgICAgICAgX3J1bjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICB0aGlzLnN0YXJ0ZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgaWYgKG8uc3RhcnRPblZpZXdwb3J0ICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaW5WaWV3cG9ydChlbGVtZW50WzBdKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHN0YXJ0SW5WaWV3cG9ydDogZnVuY3Rpb24odmFsLCBmcm9tKXtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShmcm9tKSkge1xuICAgICAgICAgICAgICAgIG8uZnJvbSA9ICtmcm9tO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZSh2YWwpKSB7XG4gICAgICAgICAgICAgICAgby52YWx1ZSA9ICt2YWw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9ydW4oKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzdGFydDogZnVuY3Rpb24odmFsLCBmcm9tKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoZnJvbSkpIHtcbiAgICAgICAgICAgICAgICBvLmZyb20gPSArZnJvbTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUodmFsKSkge1xuICAgICAgICAgICAgICAgIG8udmFsdWUgPSArdmFsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnN0YXJ0ZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJzdGFydFwiKTtcblxuICAgICAgICAgICAgZWxlbWVudC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBkcmF3OiB7XG4gICAgICAgICAgICAgICAgICAgIGlubmVySFRNTDogW28uZnJvbSwgby52YWx1ZV1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRlZmVyOiBvLnRpbWVvdXQsXG4gICAgICAgICAgICAgICAgZHVyOiBvLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgIG9uRnJhbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwidGlja1wiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogK3RoaXMuaW5uZXJIVE1MXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlubmVySFRNTCA9IG8ucHJlZml4ICsgTnVtYmVyKHRoaXMuaW5uZXJIVE1MKS5mb3JtYXQoMCwgMCwgby5kZWxpbWl0ZXIpICsgby5zdWZmaXhcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uRG9uZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwic3RvcFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlc2V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5zdGFydGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuaHRtbCh0aGlzLmh0bWwpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0ciwgdmFsKXtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAoYXR0ciA9PT0gXCJkYXRhLXZhbHVlXCIpIHtcbiAgICAgICAgICAgICAgICBvLnZhbHVlID0gK3ZhbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhdHRyID09PSBcImRhdGEtZnJvbVwiKSB7XG4gICAgICAgICAgICAgICAgby5mcm9tID0gK3ZhbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgJC53aW5kb3coKS5vZmYoXCJzY3JvbGxcIiwge25zOiB0aGlzLmlkfSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgQ3ViZURlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGN1YmVEZWZlcnJlZDogMCxcbiAgICAgICAgcnVsZXM6IG51bGwsXG4gICAgICAgIGNvbG9yOiBudWxsLFxuICAgICAgICBmbGFzaENvbG9yOiBudWxsLFxuICAgICAgICBmbGFzaEludGVydmFsOiAxMDAwLFxuICAgICAgICBudW1iZXJzOiBmYWxzZSxcbiAgICAgICAgb2ZmQmVmb3JlOiB0cnVlLFxuICAgICAgICBhdHRlbnVhdGlvbjogLjMsXG4gICAgICAgIHN0b3BPbkJsdXI6IGZhbHNlLFxuICAgICAgICBjZWxsczogNCxcbiAgICAgICAgbWFyZ2luOiA4LFxuICAgICAgICBzaG93QXhpczogZmFsc2UsXG4gICAgICAgIGF4aXNTdHlsZTogXCJhcnJvd1wiLCAvL2xpbmVcbiAgICAgICAgY2VsbENsaWNrOiBmYWxzZSxcbiAgICAgICAgYXV0b1Jlc3RhcnQ6IDUwMDAsXG5cbiAgICAgICAgY2xzQ3ViZTogXCJcIixcbiAgICAgICAgY2xzQ2VsbDogXCJcIixcbiAgICAgICAgY2xzU2lkZTogXCJcIixcbiAgICAgICAgY2xzU2lkZUxlZnQ6IFwiXCIsXG4gICAgICAgIGNsc1NpZGVSaWdodDogXCJcIixcbiAgICAgICAgY2xzU2lkZVRvcDogXCJcIixcbiAgICAgICAgY2xzU2lkZUxlZnRDZWxsOiBcIlwiLFxuICAgICAgICBjbHNTaWRlUmlnaHRDZWxsOiBcIlwiLFxuICAgICAgICBjbHNTaWRlVG9wQ2VsbDogXCJcIixcbiAgICAgICAgY2xzQXhpczogXCJcIixcbiAgICAgICAgY2xzQXhpc1g6IFwiXCIsXG4gICAgICAgIGNsc0F4aXNZOiBcIlwiLFxuICAgICAgICBjbHNBeGlzWjogXCJcIixcblxuICAgICAgICBjdXN0b206IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uVGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25DdWJlQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmN1YmVTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIEN1YmVEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIEN1YmVEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0N1YmVTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmN1YmVTZXR1cCh3aW5kb3dbXCJtZXRyb0N1YmVTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uY3ViZURlZmF1bHRSdWxlcyA9IFtcbiAgICAgICAge1xuICAgICAgICAgICAgb246IHsndG9wJzogWzE2XSwgICAgICAnbGVmdCc6IFs0XSwgICAgICAgICAncmlnaHQnOiBbMV19LFxuICAgICAgICAgICAgb2ZmOiB7J3RvcCc6IFsxMywgNF0sICAgJ2xlZnQnOiBbMSwgMTZdLCAgICAgJ3JpZ2h0JzogWzEzLCA0XX1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgb246IHsndG9wJzogWzEyLCAxNV0sICAnbGVmdCc6IFszLCA4XSwgICAgICAncmlnaHQnOiBbMiwgNV19LFxuICAgICAgICAgICAgb2ZmOiB7J3RvcCc6IFs5LCA2LCAzXSwgJ2xlZnQnOiBbNSwgMTAsIDE1XSwgJ3JpZ2h0JzogWzE0LCAxMSwgOF19XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIG9uOiB7J3RvcCc6IFsxMV0sICAgICAgJ2xlZnQnOiBbN10sICAgICAgICAgJ3JpZ2h0JzogWzZdfSxcbiAgICAgICAgICAgIG9mZjogeyd0b3AnOiBbMSwgMiwgNV0sICdsZWZ0JzogWzksIDEzLCAxNF0sICdyaWdodCc6IFsxNSwgMTIsIDE2XX1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgb246IHsndG9wJzogWzgsIDE0XSwgICAnbGVmdCc6IFsyLCAxMl0sICAgICAncmlnaHQnOiBbOSwgM119LFxuICAgICAgICAgICAgb2ZmOiB7J3RvcCc6IFsxNl0sICAgICAgJ2xlZnQnOiBbNF0sICAgICAgICAgJ3JpZ2h0JzogWzFdfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBvbjogeyd0b3AnOiBbMTAsIDddLCAgICdsZWZ0JzogWzYsIDExXSwgICAgICdyaWdodCc6IFsxMCwgN119LFxuICAgICAgICAgICAgb2ZmOiB7J3RvcCc6IFsxMiwgMTVdLCAgJ2xlZnQnOiBbMywgOF0sICAgICAgJ3JpZ2h0JzogWzIsIDVdfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBvbjogeyd0b3AnOiBbMTMsIDRdLCAgICdsZWZ0JzogWzEsIDE2XSwgICAgICdyaWdodCc6IFsxMywgNF19LFxuICAgICAgICAgICAgb2ZmOiB7J3RvcCc6IFsxMV0sICAgICAgJ2xlZnQnOiBbN10sICAgICAgICAgJ3JpZ2h0JzogWzZdfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBvbjogeyd0b3AnOiBbOSwgNiwgM10sICdsZWZ0JzogWzUsIDEwLCAxNV0sICdyaWdodCc6IFsxNCwgMTEsIDhdfSxcbiAgICAgICAgICAgIG9mZjogeyd0b3AnOiBbOCwgMTRdLCAgICdsZWZ0JzogWzIsIDEyXSwgICAgICdyaWdodCc6IFs5LCAzXX1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgb246IHsndG9wJzogWzEsIDIsIDVdLCAnbGVmdCc6IFs5LCAxMywgMTRdLCAncmlnaHQnOiBbMTUsIDEyLCAxNl19LFxuICAgICAgICAgICAgb2ZmOiB7J3RvcCc6IFsxMCwgN10sICAgJ2xlZnQnOiBbNiwgMTFdLCAgICAgJ3JpZ2h0JzogWzEwLCA3XX1cbiAgICAgICAgfVxuICAgIF07XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ2N1YmUnLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgQ3ViZURlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICBpZDogVXRpbHMuZWxlbWVudElkKFwiY3ViZVwiKSxcbiAgICAgICAgICAgICAgICBydWxlczogbnVsbCxcbiAgICAgICAgICAgICAgICBpbnRlcnZhbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgcnVsZUludGVydmFsOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBydW5uaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBpbnRlcnZhbHM6IFtdXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAoby5ydWxlcyA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMucnVsZXMgPSBNZXRyby5jdWJlRGVmYXVsdFJ1bGVzO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJzZVJ1bGVzKG8ucnVsZXMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVDdWJlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiY3ViZS1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9wYXJzZVJ1bGVzOiBmdW5jdGlvbihydWxlcyl7XG5cbiAgICAgICAgICAgIGlmIChydWxlcyA9PT0gdW5kZWZpbmVkIHx8IHJ1bGVzID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNPYmplY3QocnVsZXMpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ydWxlcyA9IFV0aWxzLmlzT2JqZWN0KHJ1bGVzKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ydWxlcyA9IEpTT04ucGFyc2UocnVsZXMpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwiVW5rbm93biBvciBlbXB0eSBydWxlcyBmb3IgY2VsbCBmbGFzaGluZyFcIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUN1YmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBzaWRlcyA9IFsnbGVmdCcsICdyaWdodCcsICd0b3AnXTtcbiAgICAgICAgICAgIHZhciBpZCA9IFV0aWxzLmVsZW1lbnRJZChcImN1YmVcIik7XG4gICAgICAgICAgICB2YXIgY2VsbHNfY291bnQgPSBNYXRoLnBvdyhvLmNlbGxzLCAyKTtcblxuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImN1YmVcIikuYWRkQ2xhc3Moby5jbHNDdWJlKTtcblxuICAgICAgICAgICAgaWYgKCFlbGVtZW50LmF0dHIoJ2lkJykpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoJ2lkJywgaWQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmlkID0gZWxlbWVudC5hdHRyKCdpZCcpO1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVDc3NGb3JGbGFzaENvbG9yKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVDc3NGb3JDZWxsU2l6ZSgpO1xuXG4gICAgICAgICAgICAkLmVhY2goc2lkZXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIHNpZGUsIGNlbGwsIGk7XG5cbiAgICAgICAgICAgICAgICBzaWRlID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwic2lkZSBcIiArIHRoaXMrXCItc2lkZVwiKS5hZGRDbGFzcyhvLmNsc1NpZGUpLmFwcGVuZFRvKGVsZW1lbnQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMgPT09ICdsZWZ0Jykge3NpZGUuYWRkQ2xhc3Moby5jbHNTaWRlTGVmdCk7fVxuICAgICAgICAgICAgICAgIGlmICh0aGlzID09PSAncmlnaHQnKSB7c2lkZS5hZGRDbGFzcyhvLmNsc1NpZGVSaWdodCk7fVxuICAgICAgICAgICAgICAgIGlmICh0aGlzID09PSAndG9wJykge3NpZGUuYWRkQ2xhc3Moby5jbHNTaWRlVG9wKTt9XG5cbiAgICAgICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCBjZWxsc19jb3VudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNlbGwgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJjdWJlLWNlbGxcIikuYWRkQ2xhc3MoXCJjZWxsLWlkLVwiKyhpKzEpKS5hZGRDbGFzcyhvLmNsc0NlbGwpO1xuICAgICAgICAgICAgICAgICAgICBjZWxsLmRhdGEoXCJpZFwiLCBpICsgMSkuZGF0YShcInNpZGVcIiwgdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIGNlbGwuYXBwZW5kVG8oc2lkZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvLm51bWJlcnMgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuaHRtbChpICsgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmFyIGNlbGxzICA9IGVsZW1lbnQuZmluZChcIi5jdWJlLWNlbGxcIik7XG4gICAgICAgICAgICBpZiAoby5jb2xvciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmIChNZXRyby5jb2xvcnMuaXNDb2xvcihvLmNvbG9yKSkge1xuICAgICAgICAgICAgICAgICAgICBjZWxscy5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBvLmNvbG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IG8uY29sb3JcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjZWxscy5hZGRDbGFzcyhvLmNvbG9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBheGlzID0gWyd4JywgJ3knLCAneiddO1xuICAgICAgICAgICAgJC5lYWNoKGF4aXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGF4aXNfbmFtZSA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdmFyIGF4ID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiYXhpcyBcIiArIG8uYXhpc1N0eWxlKS5hZGRDbGFzcyhcImF4aXMtXCIrYXhpc19uYW1lKS5hZGRDbGFzcyhvLmNsc0F4aXMpO1xuICAgICAgICAgICAgICAgIGlmIChheGlzX25hbWUgPT09IFwieFwiKSBheC5hZGRDbGFzcyhvLmNsc0F4aXNYKTtcbiAgICAgICAgICAgICAgICBpZiAoYXhpc19uYW1lID09PSBcInlcIikgYXguYWRkQ2xhc3Moby5jbHNBeGlzWSk7XG4gICAgICAgICAgICAgICAgaWYgKGF4aXNfbmFtZSA9PT0gXCJ6XCIpIGF4LmFkZENsYXNzKG8uY2xzQXhpc1opO1xuICAgICAgICAgICAgICAgIGF4LmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChvLnNob3dBeGlzID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5heGlzXCIpLmhpZGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fcnVuKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3J1bjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBpbnRlcnZhbCA9IDA7XG5cbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCk7XG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuY3ViZS1jZWxsXCIpLnJlbW92ZUNsYXNzKFwibGlnaHRcIik7XG5cbiAgICAgICAgICAgIGlmIChvLmN1c3RvbSAhPT0gTWV0cm8ubm9vcCkge1xuICAgICAgICAgICAgICAgIFV0aWxzLmV4ZWMoby5jdXN0b20sIFtlbGVtZW50XSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmN1YmUtY2VsbFwiKS5yZW1vdmVDbGFzcyhcImxpZ2h0XCIpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5fc3RhcnQoKTtcblxuICAgICAgICAgICAgICAgIGludGVydmFsID0gVXRpbHMuaXNPYmplY3QodGhpcy5ydWxlcykgPyBVdGlscy5vYmplY3RMZW5ndGgodGhpcy5ydWxlcykgOiAwO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5pbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3N0YXJ0KCk7XG4gICAgICAgICAgICAgICAgfSwgaW50ZXJ2YWwgKiBvLmZsYXNoSW50ZXJ2YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVDc3NGb3JDZWxsU2l6ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHNoZWV0ID0gTWV0cm8uc2hlZXQ7XG4gICAgICAgICAgICB2YXIgd2lkdGg7XG4gICAgICAgICAgICB2YXIgY2VsbF9zaXplO1xuXG4gICAgICAgICAgICBpZiAoby5tYXJnaW4gPT09IDggJiYgby5jZWxscyA9PT0gNCkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHdpZHRoID0gcGFyc2VJbnQoVXRpbHMuZ2V0U3R5bGVPbmUoZWxlbWVudCwgJ3dpZHRoJykpO1xuICAgICAgICAgICAgY2VsbF9zaXplID0gTWF0aC5jZWlsKCh3aWR0aCAvIDIgLSBvLm1hcmdpbiAqIG8uY2VsbHMgKiAyKSAvIG8uY2VsbHMpO1xuICAgICAgICAgICAgVXRpbHMuYWRkQ3NzUnVsZShzaGVldCwgXCIjXCIrZWxlbWVudC5hdHRyKCdpZCcpK1wiIC5zaWRlIC5jdWJlLWNlbGxcIiwgXCJ3aWR0aDogXCIrY2VsbF9zaXplK1wicHghaW1wb3J0YW50OyBoZWlnaHQ6IFwiK2NlbGxfc2l6ZStcInB4IWltcG9ydGFudDsgbWFyZ2luOiBcIiArIG8ubWFyZ2luICsgXCJweCFpbXBvcnRhbnQ7XCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVDc3NGb3JGbGFzaENvbG9yOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgc2hlZXQgPSBNZXRyby5zaGVldDtcbiAgICAgICAgICAgIHZhciBydWxlMTtcbiAgICAgICAgICAgIHZhciBydWxlMjtcbiAgICAgICAgICAgIHZhciBydWxlczEgPSBbXTtcbiAgICAgICAgICAgIHZhciBydWxlczIgPSBbXTtcbiAgICAgICAgICAgIHZhciBpO1xuXG4gICAgICAgICAgICBpZiAoby5mbGFzaENvbG9yID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcnVsZTEgPSBcIjAgMCAxMHB4IFwiICsgTWV0cm8uY29sb3JzLnRvUkdCQShvLmZsYXNoQ29sb3IsIDEpO1xuICAgICAgICAgICAgcnVsZTIgPSBcIjAgMCAxMHB4IFwiICsgTWV0cm8uY29sb3JzLnRvUkdCQShvLmZsYXNoQ29sb3IsIG8uYXR0ZW51YXRpb24pO1xuXG4gICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCAzOyBpKyspIHtcbiAgICAgICAgICAgICAgICBydWxlczEucHVzaChydWxlMSk7XG4gICAgICAgICAgICAgICAgcnVsZXMyLnB1c2gocnVsZTIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBVdGlscy5hZGRDc3NSdWxlKHNoZWV0LCBcIkBrZXlmcmFtZXMgcHVsc2FyLWNlbGwtXCIrZWxlbWVudC5hdHRyKCdpZCcpLCBcIjAlLCAxMDAlIHsgXCIgKyBcImJveC1zaGFkb3c6IFwiICsgcnVsZXMxLmpvaW4oXCIsXCIpICsgXCJ9IDUwJSB7IFwiICsgXCJib3gtc2hhZG93OiBcIiArIHJ1bGVzMi5qb2luKFwiLFwiKSArIFwiIH1cIik7XG4gICAgICAgICAgICBVdGlscy5hZGRDc3NSdWxlKHNoZWV0LCBcIiNcIitlbGVtZW50LmF0dHIoJ2lkJykrXCIgLnNpZGUgLmN1YmUtY2VsbC5saWdodFwiLCBcImFuaW1hdGlvbjogcHVsc2FyLWNlbGwtXCIgKyBlbGVtZW50LmF0dHIoJ2lkJykgKyBcIiAyLjVzIDBzIGVhc2Utb3V0IGluZmluaXRlOyBcIiArIFwiYmFja2dyb3VuZC1jb2xvcjogXCIgKyBvLmZsYXNoQ29sb3IgKyBcIiFpbXBvcnRhbnQ7IGJvcmRlci1jb2xvcjogXCIgKyBvLmZsYXNoQ29sb3IrXCIhaW1wb3J0YW50O1wiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICAkKHdpbmRvdykub24oTWV0cm8uZXZlbnRzLmJsdXIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKG8uc3RvcE9uQmx1ciA9PT0gdHJ1ZSAmJiB0aGF0LnJ1bm5pbmcgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fc3RvcCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHtuczogZWxlbWVudC5hdHRyKFwiaWRcIil9KTtcblxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKE1ldHJvLmV2ZW50cy5mb2N1cywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAoby5zdG9wT25CbHVyID09PSB0cnVlICYmIHRoYXQucnVubmluZyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fc3RhcnQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB7bnM6IGVsZW1lbnQuYXR0cihcImlkXCIpfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5jdWJlLWNlbGxcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAoby5jZWxsQ2xpY2sgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNlbGwgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICBjZWxsLnRvZ2dsZUNsYXNzKFwibGlnaHRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3N0YXJ0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuY3ViZS1jZWxsXCIpLnJlbW92ZUNsYXNzKFwibGlnaHRcIik7XG5cbiAgICAgICAgICAgIHRoaXMucnVubmluZyA9IHRydWU7XG5cbiAgICAgICAgICAgICQuZWFjaCh0aGlzLnJ1bGVzLCBmdW5jdGlvbihpbmRleCwgcnVsZSl7XG4gICAgICAgICAgICAgICAgdGhhdC5fZXhlY1J1bGUoaW5kZXgsIHJ1bGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3N0b3A6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCk7XG4gICAgICAgICAgICAkLmVhY2godGhpcy5pbnRlcnZhbHMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG5cbiAgICAgICAgX3RpY2s6IGZ1bmN0aW9uKGluZGV4LCBzcGVlZCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICBpZiAoc3BlZWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHNwZWVkID0gby5mbGFzaEludGVydmFsICogaW5kZXg7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBpbnRlcnZhbCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInRpY2tcIiwge1xuICAgICAgICAgICAgICAgICAgICBpbmRleDogaW5kZXhcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgIFV0aWxzLmFycmF5RGVsZXRlKHRoYXQuaW50ZXJ2YWxzLCBpbnRlcnZhbCk7XG4gICAgICAgICAgICB9LCBzcGVlZCk7XG4gICAgICAgICAgICB0aGlzLmludGVydmFscy5wdXNoKGludGVydmFsKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfdG9nZ2xlOiBmdW5jdGlvbihjZWxsLCBmdW5jLCB0aW1lLCBzcGVlZCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICBpZiAoc3BlZWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHNwZWVkID0gdGhpcy5vcHRpb25zLmZsYXNoSW50ZXJ2YWwgKiB0aW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGludGVydmFsID0gc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGNlbGxbZnVuYyA9PT0gJ29uJyA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnXShcImxpZ2h0XCIpO1xuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgIFV0aWxzLmFycmF5RGVsZXRlKHRoYXQuaW50ZXJ2YWxzLCBpbnRlcnZhbCk7XG4gICAgICAgICAgICB9LCBzcGVlZCk7XG4gICAgICAgICAgICB0aGlzLmludGVydmFscy5wdXNoKGludGVydmFsKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzdGFydDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuX3N0YXJ0KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc3RvcDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuX3N0b3AoKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b1J1bGU6IGZ1bmN0aW9uKGluZGV4LCBzcGVlZCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgcnVsZXMgPSB0aGlzLnJ1bGVzO1xuXG4gICAgICAgICAgICBpZiAocnVsZXMgPT09IG51bGwgfHwgcnVsZXMgPT09IHVuZGVmaW5lZCB8fCBydWxlc1tpbmRleF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMucnVsZUludGVydmFsKTtcbiAgICAgICAgICAgIHRoaXMucnVsZUludGVydmFsID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5jdWJlLWNlbGxcIikucmVtb3ZlQ2xhc3MoXCJsaWdodFwiKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IGluZGV4OyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9leGVjUnVsZShpLCBydWxlc1tpXSwgc3BlZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzSW50KG8uYXV0b1Jlc3RhcnQpICYmIG8uYXV0b1Jlc3RhcnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ydWxlSW50ZXJ2YWwgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3J1bigpO1xuICAgICAgICAgICAgICAgIH0sIG8uYXV0b1Jlc3RhcnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9leGVjUnVsZTogZnVuY3Rpb24oaW5kZXgsIHJ1bGUsIHNwZWVkKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBzaWRlcyA9IFsnbGVmdCcsICdyaWdodCcsICd0b3AnXTtcblxuICAgICAgICAgICAgdGhpcy5fdGljayhpbmRleCwgc3BlZWQpO1xuXG4gICAgICAgICAgICAkLmVhY2goc2lkZXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIHNpZGVfY2xhc3MgPSBcIi5cIit0aGlzK1wiLXNpZGVcIjtcbiAgICAgICAgICAgICAgICB2YXIgc2lkZV9uYW1lID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgY2VsbHNfb24gPSBydWxlW1wib25cIl0gIT09IHVuZGVmaW5lZCAmJiBydWxlW1wib25cIl1bc2lkZV9uYW1lXSAhPT0gdW5kZWZpbmVkID8gcnVsZVtcIm9uXCJdW3NpZGVfbmFtZV0gOiBmYWxzZTtcbiAgICAgICAgICAgICAgICB2YXIgY2VsbHNfb2ZmID0gcnVsZVtcIm9mZlwiXSAhPT0gdW5kZWZpbmVkICYmIHJ1bGVbXCJvZmZcIl1bc2lkZV9uYW1lXSAhPT0gdW5kZWZpbmVkID8gcnVsZVtcIm9mZlwiXVtzaWRlX25hbWVdIDogZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBpZiAoY2VsbHNfb24gIT09IGZhbHNlKSAkLmVhY2goY2VsbHNfb24sIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjZWxsX2luZGV4ID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNlbGwgPSBlbGVtZW50LmZpbmQoc2lkZV9jbGFzcyArIFwiIC5jZWxsLWlkLVwiK2NlbGxfaW5kZXgpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3RvZ2dsZShjZWxsLCAnb24nLCBpbmRleCwgc3BlZWQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKGNlbGxzX29mZiAhPT0gZmFsc2UpICQuZWFjaChjZWxsc19vZmYsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjZWxsX2luZGV4ID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNlbGwgPSBlbGVtZW50LmZpbmQoc2lkZV9jbGFzcyArIFwiIC5jZWxsLWlkLVwiK2NlbGxfaW5kZXgpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3RvZ2dsZShjZWxsLCAnb2ZmJywgaW5kZXgsIHNwZWVkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJ1bGU6IGZ1bmN0aW9uKHIpe1xuICAgICAgICAgICAgaWYgKHIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJ1bGVzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5fcGFyc2VSdWxlcyhyKSAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMucnVsZXMgPSByO1xuICAgICAgICAgICAgdGhpcy5zdG9wKCk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZmluZChcIi5jdWJlLWNlbGxcIikucmVtb3ZlQ2xhc3MoXCJsaWdodFwiKTtcbiAgICAgICAgICAgIHRoaXMuX3J1bigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGF4aXM6IGZ1bmN0aW9uKHNob3cpe1xuICAgICAgICAgICAgdmFyIGZ1bmMgPSBzaG93ID09PSB0cnVlID8gXCJzaG93XCIgOiBcImhpZGVcIjtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5maW5kKFwiLmF4aXNcIilbZnVuY10oKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VSdWxlczogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHJ1bGVzID0gZWxlbWVudC5hdHRyKFwiZGF0YS1ydWxlc1wiKTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9wYXJzZVJ1bGVzKHJ1bGVzKSAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5jdWJlLWNlbGxcIikucmVtb3ZlQ2xhc3MoXCJsaWdodFwiKTtcbiAgICAgICAgICAgIG8ucnVsZXMgPSBydWxlcztcbiAgICAgICAgICAgIHRoaXMuX3J1bigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF4aXNWaXNpYmlsaXR5OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgdmlzaWJpbGl0eSA9IEpTT04ucGFyc2UoZWxlbWVudC5hdHRyKFwiZGF0YS1zaG93LWF4aXNcIikpID09PSB0cnVlO1xuICAgICAgICAgICAgdmFyIGZ1bmMgPSB2aXNpYmlsaXR5ID8gXCJzaG93XCIgOiBcImhpZGVcIjtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5heGlzXCIpW2Z1bmNdKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXhpc1N0eWxlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgc3R5bGUgPSBlbGVtZW50LmF0dHIoXCJkYXRhLWF4aXMtc3R5bGVcIik7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5heGlzXCIpLnJlbW92ZUNsYXNzKFwiYXJyb3cgbGluZSBuby1zdHlsZVwiKS5hZGRDbGFzcyhzdHlsZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgICAgIHN3aXRjaCAoYXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLXJ1bGVzXCI6IHRoaXMuY2hhbmdlUnVsZXMoKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtc2hvdy1heGlzXCI6IHRoaXMuY2hhbmdlQXhpc1Zpc2liaWxpdHkoKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtYXhpcy1zdHlsZVwiOiB0aGlzLmNoYW5nZUF4aXNTdHlsZSgpOyBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCk7XG4gICAgICAgICAgICB0aGlzLmludGVydmFsID0gbnVsbDtcblxuICAgICAgICAgICAgJCh3aW5kb3cpLm9mZihNZXRyby5ldmVudHMuYmx1ciwge25zOiBlbGVtZW50LmF0dHIoXCJpZFwiKX0pO1xuICAgICAgICAgICAgJCh3aW5kb3cpLm9mZihNZXRyby5ldmVudHMuZm9jdXMse25zOiBlbGVtZW50LmF0dHIoXCJpZFwiKX0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmN1YmUtY2VsbFwiKTtcblxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBEYXRlUGlja2VyRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgbGFiZWw6IFwiXCIsXG4gICAgICAgIGRhdGVwaWNrZXJEZWZlcnJlZDogMCxcbiAgICAgICAgZ210OiAwLFxuICAgICAgICBmb3JtYXQ6IFwiWVlZWS1NTS1ERFwiLFxuICAgICAgICBpbnB1dEZvcm1hdDogbnVsbCxcbiAgICAgICAgbG9jYWxlOiBNRVRST19MT0NBTEUsXG4gICAgICAgIHZhbHVlOiBudWxsLFxuICAgICAgICBkaXN0YW5jZTogMyxcbiAgICAgICAgbW9udGg6IHRydWUsXG4gICAgICAgIGRheTogdHJ1ZSxcbiAgICAgICAgeWVhcjogdHJ1ZSxcbiAgICAgICAgbWluWWVhcjogbnVsbCxcbiAgICAgICAgbWF4WWVhcjogbnVsbCxcbiAgICAgICAgZGVmYXVsdFllYXJEaXN0YW5jZTogMTAwLFxuICAgICAgICBzY3JvbGxTcGVlZDogNCxcbiAgICAgICAgY29weUlubGluZVN0eWxlczogZmFsc2UsXG4gICAgICAgIGNsc1BpY2tlcjogXCJcIixcbiAgICAgICAgY2xzUGFydDogXCJcIixcbiAgICAgICAgY2xzTW9udGg6IFwiXCIsXG4gICAgICAgIGNsc0RheTogXCJcIixcbiAgICAgICAgY2xzWWVhcjogXCJcIixcbiAgICAgICAgY2xzTGFiZWw6IFwiXCIsXG4gICAgICAgIGNsc0J1dHRvbjogXCJcIixcbiAgICAgICAgY2xzT2tCdXR0b246IFwiXCIsXG4gICAgICAgIGNsc0NhbmNlbEJ1dHRvbjogXCJcIixcbiAgICAgICAgb2tCdXR0b25JY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tY2hlY2snPjwvc3Bhbj5cIixcbiAgICAgICAgY2FuY2VsQnV0dG9uSWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLWNyb3NzJz48L3NwYW4+XCIsXG4gICAgICAgIG9uU2V0OiBNZXRyby5ub29wLFxuICAgICAgICBvbk9wZW46IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQ2xvc2U6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uU2Nyb2xsOiBNZXRyby5ub29wLFxuICAgICAgICBvbkRhdGVQaWNrZXJDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uZGF0ZVBpY2tlclNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgRGF0ZVBpY2tlckRlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgRGF0ZVBpY2tlckRlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvRGF0ZVBpY2tlclNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8uZGF0ZVBpY2tlclNldHVwKHdpbmRvd1tcIm1ldHJvRGF0ZVBpY2tlclNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ2RhdGUtcGlja2VyJywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIERhdGVQaWNrZXJEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgcGlja2VyOiBudWxsLFxuICAgICAgICAgICAgICAgIGlzT3BlbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgdmFsdWU6IGRhdGV0aW1lKCksXG4gICAgICAgICAgICAgICAgbG9jYWxlOiBudWxsLFxuICAgICAgICAgICAgICAgIGxpc3RUaW1lcjoge1xuICAgICAgICAgICAgICAgICAgICBkYXk6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIG1vbnRoOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICB5ZWFyOiBudWxsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBkYXRlID0gZGF0ZXRpbWUoKTtcblxuICAgICAgICAgICAgaWYgKG8uZGlzdGFuY2UgPCAxKSB7XG4gICAgICAgICAgICAgICAgby5kaXN0YW5jZSA9IDE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKGVsZW1lbnQudmFsKCkpKSB7XG4gICAgICAgICAgICAgICAgby52YWx1ZSA9IGVsZW1lbnQudmFsKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8udmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IG8uaW5wdXRGb3JtYXQgPyBEYXRldGltZS5mcm9tKG8udmFsdWUsIG8uaW5wdXRGb3JtYXQsIG8ubG9jYWxlKSA6IGRhdGV0aW1lKG8udmFsdWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoTWV0cm8ubG9jYWxlc1tvLmxvY2FsZV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIG8ubG9jYWxlID0gTUVUUk9fTE9DQUxFO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmxvY2FsZSA9IE1ldHJvLmxvY2FsZXNbby5sb2NhbGVdWydjYWxlbmRhciddO1xuXG4gICAgICAgICAgICBpZiAoby5taW5ZZWFyID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgby5taW5ZZWFyID0gZGF0ZS55ZWFyKCkgLSBvLmRlZmF1bHRZZWFyRGlzdGFuY2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLm1heFllYXIgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBvLm1heFllYXIgPSBkYXRlLnllYXIoKSArIG8uZGVmYXVsdFllYXJEaXN0YW5jZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcbiAgICAgICAgICAgIHRoaXMuX3NldCgpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJkYXRlcGlja2VyLWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVN0cnVjdHVyZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHBpY2tlciwgbW9udGgsIGRheSwgeWVhciwgaSwgajtcbiAgICAgICAgICAgIHZhciBkYXRlV3JhcHBlciwgc2VsZWN0V3JhcHBlciwgc2VsZWN0QmxvY2ssIGFjdGlvbkJsb2NrO1xuXG4gICAgICAgICAgICB2YXIgaWQgPSBVdGlscy5lbGVtZW50SWQoXCJkYXRlcGlja2VyXCIpO1xuXG4gICAgICAgICAgICBwaWNrZXIgPSAkKFwiPGRpdj5cIikuYXR0cihcImlkXCIsIGlkKS5hZGRDbGFzcyhcIndoZWVsLXBpY2tlciBkYXRlLXBpY2tlciBcIiArIGVsZW1lbnRbMF0uY2xhc3NOYW1lKS5hZGRDbGFzcyhvLmNsc1BpY2tlcik7XG5cbiAgICAgICAgICAgIHBpY2tlci5pbnNlcnRCZWZvcmUoZWxlbWVudCk7XG4gICAgICAgICAgICBlbGVtZW50LmFwcGVuZFRvKHBpY2tlcik7XG5cbiAgICAgICAgICAgIGlmIChvLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gJChcIjxsYWJlbD5cIikuYWRkQ2xhc3MoXCJsYWJlbC1mb3ItaW5wdXRcIikuYWRkQ2xhc3Moby5jbHNMYWJlbCkuaHRtbChvLmxhYmVsKS5pbnNlcnRCZWZvcmUocGlja2VyKTtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5hdHRyKFwiaWRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwuYXR0cihcImZvclwiLCBlbGVtZW50LmF0dHIoXCJpZFwiKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmF0dHIoXCJkaXJcIikgPT09IFwicnRsXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwuYWRkQ2xhc3MoXCJydGxcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkYXRlV3JhcHBlciA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImRhdGUtd3JhcHBlclwiKS5hcHBlbmRUbyhwaWNrZXIpO1xuXG4gICAgICAgICAgICBpZiAoby5tb250aCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIG1vbnRoID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwibW9udGhcIikuYWRkQ2xhc3Moby5jbHNQYXJ0KS5hZGRDbGFzcyhvLmNsc01vbnRoKS5hcHBlbmRUbyhkYXRlV3JhcHBlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoby5kYXkgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBkYXkgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJkYXlcIikuYWRkQ2xhc3Moby5jbHNQYXJ0KS5hZGRDbGFzcyhvLmNsc0RheSkuYXBwZW5kVG8oZGF0ZVdyYXBwZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG8ueWVhciA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHllYXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJ5ZWFyXCIpLmFkZENsYXNzKG8uY2xzUGFydCkuYWRkQ2xhc3Moby5jbHNZZWFyKS5hcHBlbmRUbyhkYXRlV3JhcHBlcik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNlbGVjdFdyYXBwZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJzZWxlY3Qtd3JhcHBlclwiKS5hcHBlbmRUbyhwaWNrZXIpO1xuXG4gICAgICAgICAgICBzZWxlY3RCbG9jayA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInNlbGVjdC1ibG9ja1wiKS5hcHBlbmRUbyhzZWxlY3RXcmFwcGVyKTtcblxuICAgICAgICAgICAgaWYgKG8ubW9udGggPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBtb250aCA9ICQoXCI8dWw+XCIpLmFkZENsYXNzKFwic2VsLW1vbnRoXCIpLmFwcGVuZFRvKHNlbGVjdEJsb2NrKTtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgby5kaXN0YW5jZTsgaSsrKSAkKFwiPGxpPlwiKS5odG1sKFwiJm5ic3A7XCIpLmRhdGEoXCJ2YWx1ZVwiLCAtMSkuYXBwZW5kVG8obW9udGgpO1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAxMjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICQoXCI8bGk+XCIpLmFkZENsYXNzKFwianMtbW9udGgtXCIraStcIiBqcy1tb250aC1yZWFsLVwiK3RoaXMubG9jYWxlWydtb250aHMnXVtpXS50b0xvd2VyQ2FzZSgpKS5odG1sKHRoaXMubG9jYWxlWydtb250aHMnXVtpXSkuZGF0YShcInZhbHVlXCIsIGkpLmFwcGVuZFRvKG1vbnRoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG8uZGlzdGFuY2U7IGkrKykgJChcIjxsaT5cIikuaHRtbChcIiZuYnNwO1wiKS5kYXRhKFwidmFsdWVcIiwgLTEpLmFwcGVuZFRvKG1vbnRoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uZGF5ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZGF5ID0gJChcIjx1bD5cIikuYWRkQ2xhc3MoXCJzZWwtZGF5XCIpLmFwcGVuZFRvKHNlbGVjdEJsb2NrKTtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgby5kaXN0YW5jZTsgaSsrKSAkKFwiPGxpPlwiKS5odG1sKFwiJm5ic3A7XCIpLmRhdGEoXCJ2YWx1ZVwiLCAtMSkuYXBwZW5kVG8oZGF5KTtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMzE7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAkKFwiPGxpPlwiKS5hZGRDbGFzcyhcImpzLWRheS1cIitpK1wiIGpzLWRheS1yZWFsLVwiKyhpKzEpKS5odG1sKGkgKyAxKS5kYXRhKFwidmFsdWVcIiwgaSArIDEpLmFwcGVuZFRvKGRheSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBvLmRpc3RhbmNlOyBpKyspICQoXCI8bGk+XCIpLmh0bWwoXCImbmJzcDtcIikuZGF0YShcInZhbHVlXCIsIC0xKS5hcHBlbmRUbyhkYXkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby55ZWFyID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgeWVhciA9ICQoXCI8dWw+XCIpLmFkZENsYXNzKFwic2VsLXllYXJcIikuYXBwZW5kVG8oc2VsZWN0QmxvY2spO1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBvLmRpc3RhbmNlOyBpKyspICQoXCI8bGk+XCIpLmh0bWwoXCImbmJzcDtcIikuZGF0YShcInZhbHVlXCIsIC0xKS5hcHBlbmRUbyh5ZWFyKTtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSBvLm1pblllYXIsIGogPSAwOyBpIDw9IG8ubWF4WWVhcjsgaSsrLCBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgJChcIjxsaT5cIikuYWRkQ2xhc3MoXCJqcy15ZWFyLVwiKyBqICsgXCIganMteWVhci1yZWFsLVwiICsgaSkuaHRtbChpKS5kYXRhKFwidmFsdWVcIiwgaSkuYXBwZW5kVG8oeWVhcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBvLmRpc3RhbmNlOyBpKyspICQoXCI8bGk+XCIpLmh0bWwoXCImbmJzcDtcIikuZGF0YShcInZhbHVlXCIsIC0xKS5hcHBlbmRUbyh5ZWFyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2VsZWN0QmxvY2suaGVpZ2h0KChvLmRpc3RhbmNlICogMiArIDEpICogNDApO1xuXG4gICAgICAgICAgICBhY3Rpb25CbG9jayA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImFjdGlvbi1ibG9ja1wiKS5hcHBlbmRUbyhzZWxlY3RXcmFwcGVyKTtcbiAgICAgICAgICAgICQoXCI8YnV0dG9uPlwiKS5hdHRyKFwidHlwZVwiLCBcImJ1dHRvblwiKS5hZGRDbGFzcyhcImJ1dHRvbiBhY3Rpb24tb2tcIikuYWRkQ2xhc3Moby5jbHNCdXR0b24pLmFkZENsYXNzKG8uY2xzT2tCdXR0b24pLmh0bWwoby5va0J1dHRvbkljb24pLmFwcGVuZFRvKGFjdGlvbkJsb2NrKTtcbiAgICAgICAgICAgICQoXCI8YnV0dG9uPlwiKS5hdHRyKFwidHlwZVwiLCBcImJ1dHRvblwiKS5hZGRDbGFzcyhcImJ1dHRvbiBhY3Rpb24tY2FuY2VsXCIpLmFkZENsYXNzKG8uY2xzQnV0dG9uKS5hZGRDbGFzcyhvLmNsc0NhbmNlbEJ1dHRvbikuaHRtbChvLmNhbmNlbEJ1dHRvbkljb24pLmFwcGVuZFRvKGFjdGlvbkJsb2NrKTtcblxuXG4gICAgICAgICAgICBlbGVtZW50WzBdLmNsYXNzTmFtZSA9ICcnO1xuICAgICAgICAgICAgaWYgKG8uY29weUlubGluZVN0eWxlcyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBlbGVtZW50WzBdLnN0eWxlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHBpY2tlci5jc3MoZWxlbWVudFswXS5zdHlsZVtpXSwgZWxlbWVudC5jc3MoZWxlbWVudFswXS5zdHlsZVtpXSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGVsZW1lbnQucHJvcChcImRpc2FibGVkXCIpKSB7XG4gICAgICAgICAgICAgICAgcGlja2VyLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMucGlja2VyID0gcGlja2VyO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgcGlja2VyID0gdGhpcy5waWNrZXI7XG5cbiAgICAgICAgICAgIHBpY2tlci5vbihNZXRyby5ldmVudHMuc3RhcnQsIFwiLnNlbGVjdC1ibG9jayB1bFwiLCBmdW5jdGlvbihlKXtcblxuICAgICAgICAgICAgICAgIGlmIChlLmNoYW5nZWRUb3VjaGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdmFyIHBhZ2VZID0gVXRpbHMucGFnZVhZKGUpLnk7XG5cbiAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vbihNZXRyby5ldmVudHMubW92ZSwgZnVuY3Rpb24oZSl7XG5cbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnNjcm9sbFRvcCAtPSBvLnNjcm9sbFNwZWVkICogKHBhZ2VZICA+IFV0aWxzLnBhZ2VYWShlKS55ID8gLTEgOiAxKTtcblxuICAgICAgICAgICAgICAgICAgICBwYWdlWSA9IFV0aWxzLnBhZ2VYWShlKS55O1xuICAgICAgICAgICAgICAgIH0sIHtuczogcGlja2VyLmF0dHIoXCJpZFwiKX0pO1xuXG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkub24oTWV0cm8uZXZlbnRzLnN0b3AsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihNZXRyby5ldmVudHMubW92ZSwge25zOiBwaWNrZXIuYXR0cihcImlkXCIpfSk7XG4gICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihNZXRyby5ldmVudHMuc3RvcCwge25zOiBwaWNrZXIuYXR0cihcImlkXCIpfSk7XG4gICAgICAgICAgICAgICAgfSwge25zOiBwaWNrZXIuYXR0cihcImlkXCIpfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcGlja2VyLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgaWYgKHRoYXQuaXNPcGVuID09PSBmYWxzZSkgdGhhdC5vcGVuKCk7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBwaWNrZXIub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5hY3Rpb24tb2tcIiwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgdmFyIG0sIGQsIHk7XG4gICAgICAgICAgICAgICAgdmFyIHNtID0gcGlja2VyLmZpbmQoXCIuc2VsLW1vbnRoIGxpLmFjdGl2ZVwiKSxcbiAgICAgICAgICAgICAgICAgICAgc2QgPSBwaWNrZXIuZmluZChcIi5zZWwtZGF5IGxpLmFjdGl2ZVwiKSxcbiAgICAgICAgICAgICAgICAgICAgc3kgPSBwaWNrZXIuZmluZChcIi5zZWwteWVhciBsaS5hY3RpdmVcIik7XG5cbiAgICAgICAgICAgICAgICBtID0gc20ubGVuZ3RoID09PSAwID8gdGhhdC52YWx1ZS5nZXRNb250aCgpIDogc20uZGF0YShcInZhbHVlXCIpO1xuICAgICAgICAgICAgICAgIGQgPSBzZC5sZW5ndGggPT09IDAgPyB0aGF0LnZhbHVlLmdldERhdGUoKSA6IHNkLmRhdGEoXCJ2YWx1ZVwiKTtcbiAgICAgICAgICAgICAgICB5ID0gc3kubGVuZ3RoID09PSAwID8gdGhhdC52YWx1ZS5nZXRGdWxsWWVhcigpIDogc3kuZGF0YShcInZhbHVlXCIpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC52YWx1ZSA9IGRhdGV0aW1lKHksIG0sIGQpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2NvcnJlY3QoKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9zZXQoKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHBpY2tlci5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmFjdGlvbi1jYW5jZWxcIiwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgdGhhdC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmFyIHNjcm9sbExhdGVuY3kgPSAxNTA7XG4gICAgICAgICAgICAkLmVhY2goW1wibW9udGhcIiwgXCJkYXlcIiwgXCJ5ZWFyXCJdLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBwYXJ0ID0gdGhpcywgbGlzdCA9IHBpY2tlci5maW5kKFwiLnNlbC1cIitwYXJ0KTtcblxuICAgICAgICAgICAgICAgIGxpc3Qub24oXCJzY3JvbGxcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQuaXNPcGVuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5saXN0VGltZXJbcGFydF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhhdC5saXN0VGltZXJbcGFydF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQubGlzdFRpbWVyW3BhcnRdID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGF0Lmxpc3RUaW1lcltwYXJ0XSkgdGhhdC5saXN0VGltZXJbcGFydF0gPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXQsIHRhcmdldEVsZW1lbnQsIHNjcm9sbFRvcDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQubGlzdFRpbWVyW3BhcnRdID0gbnVsbDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCA9IE1hdGgucm91bmQoKE1hdGguY2VpbChsaXN0LnNjcm9sbFRvcCgpKSAvIDQwKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRFbGVtZW50ID0gbGlzdC5maW5kKFwiLmpzLVwiICsgcGFydCArIFwiLVwiICsgdGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3AgPSB0YXJnZXRFbGVtZW50LnBvc2l0aW9uKCkudG9wIC0gKG8uZGlzdGFuY2UgKiA0MCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0LmZpbmQoXCIuYWN0aXZlXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdFswXS5zY3JvbGxUb3AgPSBzY3JvbGxUb3A7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RWxlbWVudC5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5leGVjKG8ub25TY3JvbGwsIFt0YXJnZXRFbGVtZW50LCBsaXN0LCBwaWNrZXJdLCBsaXN0WzBdKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgc2Nyb2xsTGF0ZW5jeSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NvcnJlY3Q6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgbSA9IHRoaXMudmFsdWUubW9udGgoKSxcbiAgICAgICAgICAgICAgICBkID0gdGhpcy52YWx1ZS5kYXkoKSxcbiAgICAgICAgICAgICAgICB5ID0gdGhpcy52YWx1ZS55ZWFyKCk7XG5cbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSBkYXRldGltZSh5LCBtLCBkKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfc2V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgcGlja2VyID0gdGhpcy5waWNrZXI7XG4gICAgICAgICAgICB2YXIgbSA9IHRoaXMubG9jYWxlWydtb250aHMnXVt0aGlzLnZhbHVlLm1vbnRoKCldLFxuICAgICAgICAgICAgICAgIGQgPSB0aGlzLnZhbHVlLmRheSgpLFxuICAgICAgICAgICAgICAgIHkgPSB0aGlzLnZhbHVlLnllYXIoKTtcblxuICAgICAgICAgICAgaWYgKG8ubW9udGggPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBwaWNrZXIuZmluZChcIi5tb250aFwiKS5odG1sKG0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG8uZGF5ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgcGlja2VyLmZpbmQoXCIuZGF5XCIpLmh0bWwoZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoby55ZWFyID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgcGlja2VyLmZpbmQoXCIueWVhclwiKS5odG1sKHkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LnZhbCh0aGlzLnZhbHVlLmZvcm1hdChvLmZvcm1hdCwgby5sb2NhbGUpKS50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJzZXRcIiwge1xuICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnZhbHVlLnZhbCgpLFxuICAgICAgICAgICAgICAgIGVsZW1lbnRWYWx1ZTogZWxlbWVudC52YWwoKSxcbiAgICAgICAgICAgICAgICBwaWNrZXI6IHBpY2tlclxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcblxuICAgICAgICBvcGVuOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgcGlja2VyID0gdGhpcy5waWNrZXI7XG4gICAgICAgICAgICB2YXIgbSA9IHRoaXMudmFsdWUubW9udGgoKSwgZCA9IHRoaXMudmFsdWUuZGF5KCkgLSAxLCB5ID0gdGhpcy52YWx1ZS55ZWFyKCk7XG4gICAgICAgICAgICB2YXIgbV9saXN0LCBkX2xpc3QsIHlfbGlzdDtcbiAgICAgICAgICAgIHZhciBzZWxlY3Rfd3JhcHBlciA9IHBpY2tlci5maW5kKFwiLnNlbGVjdC13cmFwcGVyXCIpO1xuICAgICAgICAgICAgdmFyIHNlbGVjdF93cmFwcGVyX2luX3ZpZXdwb3J0LCBzZWxlY3Rfd3JhcHBlcl9yZWN0O1xuXG4gICAgICAgICAgICBzZWxlY3Rfd3JhcHBlci5wYXJlbnQoKS5yZW1vdmVDbGFzcyhcImZvci10b3AgZm9yLWJvdHRvbVwiKTtcbiAgICAgICAgICAgIHNlbGVjdF93cmFwcGVyLnNob3coMCk7XG4gICAgICAgICAgICBwaWNrZXIuZmluZChcImxpXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuXG4gICAgICAgICAgICBzZWxlY3Rfd3JhcHBlcl9pbl92aWV3cG9ydCA9IFV0aWxzLmluVmlld3BvcnQoc2VsZWN0X3dyYXBwZXJbMF0pO1xuICAgICAgICAgICAgc2VsZWN0X3dyYXBwZXJfcmVjdCA9IFV0aWxzLnJlY3Qoc2VsZWN0X3dyYXBwZXJbMF0pO1xuXG4gICAgICAgICAgICBpZiAoIXNlbGVjdF93cmFwcGVyX2luX3ZpZXdwb3J0ICYmIHNlbGVjdF93cmFwcGVyX3JlY3QudG9wID4gMCkge1xuICAgICAgICAgICAgICAgIHNlbGVjdF93cmFwcGVyLnBhcmVudCgpLmFkZENsYXNzKFwiZm9yLWJvdHRvbVwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFzZWxlY3Rfd3JhcHBlcl9pbl92aWV3cG9ydCAmJiBzZWxlY3Rfd3JhcHBlcl9yZWN0LnRvcCA8IDApIHtcbiAgICAgICAgICAgICAgICBzZWxlY3Rfd3JhcHBlci5wYXJlbnQoKS5hZGRDbGFzcyhcImZvci10b3BcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLm1vbnRoID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgbV9saXN0ID0gcGlja2VyLmZpbmQoXCIuc2VsLW1vbnRoXCIpO1xuICAgICAgICAgICAgICAgIG1fbGlzdFxuICAgICAgICAgICAgICAgICAgICAuc2Nyb2xsVG9wKDApXG4gICAgICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IG1fbGlzdC5maW5kKFwibGkuanMtbW9udGgtXCIgKyBtKS5hZGRDbGFzcyhcImFjdGl2ZVwiKS5wb3NpdGlvbigpLnRvcCAtICg0MCAqIG8uZGlzdGFuY2UpXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZHVyOiAxMDBcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoby5kYXkgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBkX2xpc3QgPSBwaWNrZXIuZmluZChcIi5zZWwtZGF5XCIpO1xuICAgICAgICAgICAgICAgIGRfbGlzdFxuICAgICAgICAgICAgICAgICAgICAuc2Nyb2xsVG9wKDApXG4gICAgICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IGRfbGlzdC5maW5kKFwibGkuanMtZGF5LVwiICsgZCkuYWRkQ2xhc3MoXCJhY3RpdmVcIikucG9zaXRpb24oKS50b3AgLSAoNDAgKiBvLmRpc3RhbmNlKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cjogMTAwXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG8ueWVhciA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHlfbGlzdCA9IHBpY2tlci5maW5kKFwiLnNlbC15ZWFyXCIpO1xuICAgICAgICAgICAgICAgIHlfbGlzdFxuICAgICAgICAgICAgICAgICAgICAuc2Nyb2xsVG9wKDApXG4gICAgICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IHlfbGlzdC5maW5kKFwibGkuanMteWVhci1yZWFsLVwiICsgeSkuYWRkQ2xhc3MoXCJhY3RpdmVcIikucG9zaXRpb24oKS50b3AgLSAoNDAgKiBvLmRpc3RhbmNlKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cjogMTAwXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcIm9wZW5cIiwge1xuICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnZhbHVlLnZhbCgpLFxuICAgICAgICAgICAgICAgIHBpY2tlcjogcGlja2VyXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgcGlja2VyID0gdGhpcy5waWNrZXI7XG4gICAgICAgICAgICBwaWNrZXIuZmluZChcIi5zZWxlY3Qtd3JhcHBlclwiKS5oaWRlKDApO1xuICAgICAgICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiY2xvc2VcIiwge1xuICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnZhbHVlLnZhbCgpLFxuICAgICAgICAgICAgICAgIHBpY2tlcjogcGlja2VyXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICB2YWw6IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC52YWwoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IG8uaW5wdXRGb3JtYXQgPyBEYXRldGltZS5mcm9tKHZhbHVlLCBvLmlucHV0Rm9ybWF0LCBvLmxvY2FsZSkgOiBkYXRldGltZSh2YWx1ZSk7XG5cbiAgICAgICAgICAgIHRoaXMuX3NldCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRhdGU6IGZ1bmN0aW9uKHQsIGYpe1xuICAgICAgICAgICAgaWYgKHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLnZhbCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSBEYXRldGltZS5mcm9tKHQsIGYsIHRoaXMub3B0aW9ucy5sb2NhbGUpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3NldCgpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpMThuOiBmdW5jdGlvbihsb2NhbGUpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgbW9udGgsIGk7XG5cbiAgICAgICAgICAgIG8ubG9jYWxlID0gbG9jYWxlID8gbG9jYWxlIDogZWxlbWVudC5hdHRyKFwiZGF0YS1sb2NhbGVcIik7XG4gICAgICAgICAgICB0aGlzLmxvY2FsZSA9IE1ldHJvLmxvY2FsZXNbby5sb2NhbGVdWydjYWxlbmRhciddO1xuXG4gICAgICAgICAgICBpZiAoby5tb250aCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIG1vbnRoID0gIGVsZW1lbnQuY2xvc2VzdChcIi5kYXRlLXBpY2tlclwiKS5maW5kKFwiLnNlbC1tb250aFwiKS5odG1sKFwiXCIpO1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBvLmRpc3RhbmNlOyBpKyspICQoXCI8bGk+XCIpLmh0bWwoXCImbmJzcDtcIikuZGF0YShcInZhbHVlXCIsIC0xKS5hcHBlbmRUbyhtb250aCk7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDEyOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgJChcIjxsaT5cIikuYWRkQ2xhc3MoXCJqcy1tb250aC1cIitpK1wiIGpzLW1vbnRoLXJlYWwtXCIrdGhpcy5sb2NhbGVbJ21vbnRocyddW2ldLnRvTG93ZXJDYXNlKCkpLmh0bWwodGhpcy5sb2NhbGVbJ21vbnRocyddW2ldKS5kYXRhKFwidmFsdWVcIiwgaSkuYXBwZW5kVG8obW9udGgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgby5kaXN0YW5jZTsgaSsrKSAkKFwiPGxpPlwiKS5odG1sKFwiJm5ic3A7XCIpLmRhdGEoXCJ2YWx1ZVwiLCAtMSkuYXBwZW5kVG8obW9udGgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9zZXQoKTtcbiAgICAgICAgfSxcblxuXG4gICAgICAgIGRpc2FibGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnBhcmVudCgpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZW5hYmxlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmRhdGEoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50KCkucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGVTdGF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmVsZW0uZGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmFibGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHIsIG5ld1ZhbHVlKXtcbiAgICAgICAgICAgIHN3aXRjaCAoYXR0cikge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkaXNhYmxlZFwiOiB0aGlzLnRvZ2dsZVN0YXRlKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLXZhbHVlXCI6IHRoaXMudmFsKG5ld1ZhbHVlKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtbG9jYWxlXCI6IHRoaXMuaTE4bihuZXdWYWx1ZSk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLWZvcm1hdFwiOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuZm9ybWF0ID0gbmV3VmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIHBpY2tlciA9IHRoaXMucGlja2VyO1xuXG4gICAgICAgICAgICAkLmVhY2goW1wibW90aFwiLCBcImRheVwiLCBcInllYXJcIl0sIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgcGlja2VyLmZpbmQoXCIuc2VsLVwiK3RoaXMpLm9mZihcInNjcm9sbFwiKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBwaWNrZXIub2ZmKE1ldHJvLmV2ZW50cy5zdGFydCwgXCIuc2VsZWN0LWJsb2NrIHVsXCIpO1xuICAgICAgICAgICAgcGlja2VyLm9mZihNZXRyby5ldmVudHMuY2xpY2spO1xuICAgICAgICAgICAgcGlja2VyLm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmFjdGlvbi1va1wiKTtcbiAgICAgICAgICAgIHBpY2tlci5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5hY3Rpb24tY2FuY2VsXCIpO1xuXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgJChkb2N1bWVudCkub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBmdW5jdGlvbigpe1xuICAgICAgICAkLmVhY2goJChcIi5kYXRlLXBpY2tlclwiKSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICQodGhpcykuZmluZChcImlucHV0XCIpLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBNZXRyby5nZXRQbHVnaW4odGhpcywgXCJkYXRlcGlja2VyXCIpLmNsb3NlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgRGlhbG9nRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgZGlhbG9nRGVmZXJyZWQ6IDAsXG4gICAgICAgIGNsb3NlQnV0dG9uOiBmYWxzZSxcbiAgICAgICAgbGVhdmVPdmVybGF5T25DbG9zZTogZmFsc2UsXG4gICAgICAgIHRvVG9wOiBmYWxzZSxcbiAgICAgICAgdG9Cb3R0b206IGZhbHNlLFxuICAgICAgICBsb2NhbGU6IE1FVFJPX0xPQ0FMRSxcbiAgICAgICAgdGl0bGU6IFwiXCIsXG4gICAgICAgIGNvbnRlbnQ6IFwiXCIsXG4gICAgICAgIGFjdGlvbnM6IHt9LFxuICAgICAgICBhY3Rpb25zQWxpZ246IFwicmlnaHRcIixcbiAgICAgICAgZGVmYXVsdEFjdGlvbjogdHJ1ZSxcbiAgICAgICAgb3ZlcmxheTogdHJ1ZSxcbiAgICAgICAgb3ZlcmxheUNvbG9yOiAnIzAwMDAwMCcsXG4gICAgICAgIG92ZXJsYXlBbHBoYTogLjUsXG4gICAgICAgIG92ZXJsYXlDbGlja0Nsb3NlOiBmYWxzZSxcbiAgICAgICAgd2lkdGg6ICc0ODAnLFxuICAgICAgICBoZWlnaHQ6ICdhdXRvJyxcbiAgICAgICAgc2hhZG93OiB0cnVlLFxuICAgICAgICBjbG9zZUFjdGlvbjogdHJ1ZSxcbiAgICAgICAgY2xzRGlhbG9nOiBcIlwiLFxuICAgICAgICBjbHNUaXRsZTogXCJcIixcbiAgICAgICAgY2xzQ29udGVudDogXCJcIixcbiAgICAgICAgY2xzQWN0aW9uOiBcIlwiLFxuICAgICAgICBjbHNEZWZhdWx0QWN0aW9uOiBcIlwiLFxuICAgICAgICBjbHNPdmVybGF5OiBcIlwiLFxuICAgICAgICBhdXRvSGlkZTogMCxcbiAgICAgICAgcmVtb3ZlT25DbG9zZTogZmFsc2UsXG4gICAgICAgIHNob3c6IGZhbHNlLFxuXG4gICAgICAgIF9ydW50aW1lOiBmYWxzZSxcblxuICAgICAgICBvblNob3c6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uSGlkZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25PcGVuOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNsb3NlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkRpYWxvZ0NyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5kaWFsb2dTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIERpYWxvZ0RlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgRGlhbG9nRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9EaWFsb2dTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmRpYWxvZ1NldHVwKHdpbmRvd1tcIm1ldHJvRGlhbG9nU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnZGlhbG9nJywge1xuICAgICAgICBfY291bnRlcjogMCxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIERpYWxvZ0RlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICBpbnRlcnZhbDogbnVsbCxcbiAgICAgICAgICAgICAgICBvdmVybGF5OiBudWxsLFxuICAgICAgICAgICAgICAgIGlkOiBVdGlscy5lbGVtZW50SWQoXCJkaWFsb2dcIilcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB0aGlzLmxvY2FsZSA9IE1ldHJvLmxvY2FsZXNbby5sb2NhbGVdICE9PSB1bmRlZmluZWQgPyBNZXRyby5sb2NhbGVzW28ubG9jYWxlXSA6IE1ldHJvLmxvY2FsZXNbXCJlbi1VU1wiXTtcbiAgICAgICAgICAgIHRoaXMuX2J1aWxkKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2J1aWxkOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGJvZHkgPSAkKFwiYm9keVwiKTtcbiAgICAgICAgICAgIHZhciBvdmVybGF5O1xuXG4gICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwiZGlhbG9nXCIpO1xuXG4gICAgICAgICAgICBpZiAoby5zaGFkb3cgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwic2hhZG93LW9uXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby50aXRsZSAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0VGl0bGUoby50aXRsZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmNvbnRlbnQgIT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldENvbnRlbnQoby5jb250ZW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uZGVmYXVsdEFjdGlvbiA9PT0gdHJ1ZSB8fCAoby5hY3Rpb25zICE9PSBmYWxzZSAmJiB0eXBlb2Ygby5hY3Rpb25zID09PSAnb2JqZWN0JyAmJiBVdGlscy5vYmplY3RMZW5ndGgoby5hY3Rpb25zKSA+IDApKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJ1dHRvbnMgPSBlbGVtZW50LmZpbmQoXCIuZGlhbG9nLWFjdGlvbnNcIik7XG4gICAgICAgICAgICAgICAgdmFyIGJ1dHRvbjtcblxuICAgICAgICAgICAgICAgIGlmIChidXR0b25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBidXR0b25zID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiZGlhbG9nLWFjdGlvbnNcIikuYWRkQ2xhc3MoXCJ0ZXh0LVwiK28uYWN0aW9uc0FsaWduKS5hcHBlbmRUbyhlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoby5kZWZhdWx0QWN0aW9uID09PSB0cnVlICYmIChVdGlscy5vYmplY3RMZW5ndGgoby5hY3Rpb25zKSA9PT0gMCAmJiBlbGVtZW50LmZpbmQoXCIuZGlhbG9nLWFjdGlvbnMgPiAqXCIpLmxlbmd0aCA9PT0gMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uID0gJChcIjxidXR0b24+XCIpLmFkZENsYXNzKFwiYnV0dG9uIGpzLWRpYWxvZy1jbG9zZVwiKS5hZGRDbGFzcyhvLmNsc0RlZmF1bHRBY3Rpb24pLmh0bWwodGhpcy5sb2NhbGVbXCJidXR0b25zXCJdW1wib2tcIl0pO1xuICAgICAgICAgICAgICAgICAgICBidXR0b24uYXBwZW5kVG8oYnV0dG9ucyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzT2JqZWN0KG8uYWN0aW9ucykpICQuZWFjaChVdGlscy5pc09iamVjdChvLmFjdGlvbnMpLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9ICQoXCI8YnV0dG9uPlwiKS5hZGRDbGFzcyhcImJ1dHRvblwiKS5hZGRDbGFzcyhpdGVtLmNscykuaHRtbChpdGVtLmNhcHRpb24pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5vbmNsaWNrICE9PSB1bmRlZmluZWQpIGJ1dHRvbi5vbihNZXRyby5ldmVudHMuY2xpY2ssIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5leGVjKGl0ZW0ub25jbGljaywgW2VsZW1lbnRdKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5hcHBlbmRUbyhidXR0b25zKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8ub3ZlcmxheSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIG92ZXJsYXkgID0gdGhpcy5fb3ZlcmxheSgpO1xuICAgICAgICAgICAgICAgIHRoaXMub3ZlcmxheSA9IG92ZXJsYXk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmNsb3NlQWN0aW9uID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmpzLWRpYWxvZy1jbG9zZVwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBjbG9zZXIgPSBlbGVtZW50LmZpbmQoXCJjbG9zZXJcIik7XG4gICAgICAgICAgICBpZiAoY2xvc2VyLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNsb3NlciA9ICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJidXR0b24gc3F1YXJlIGNsb3NlciBqcy1kaWFsb2ctY2xvc2VcIik7XG4gICAgICAgICAgICAgICAgY2xvc2VyLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG8uY2xvc2VCdXR0b24gIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBjbG9zZXIuaGlkZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LmNzcyh7XG4gICAgICAgICAgICAgICAgd2lkdGg6IG8ud2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBvLmhlaWdodCxcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiBcImhpZGRlblwiLFxuICAgICAgICAgICAgICAgIHRvcDogJzEwMCUnLFxuICAgICAgICAgICAgICAgIGxlZnQ6ICggJCh3aW5kb3cpLndpZHRoKCkgLSBlbGVtZW50Lm91dGVyV2lkdGgoKSApIC8gMlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3Moby5jbHNEaWFsb2cpO1xuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmRpYWxvZy10aXRsZVwiKS5hZGRDbGFzcyhvLmNsc1RpdGxlKTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5kaWFsb2ctY29udGVudFwiKS5hZGRDbGFzcyhvLmNsc0NvbnRlbnQpO1xuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmRpYWxvZy1hY3Rpb25zXCIpLmFkZENsYXNzKG8uY2xzQWN0aW9uKTtcblxuICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRUbyhib2R5KTtcblxuICAgICAgICAgICAgaWYgKG8uc2hvdykge1xuICAgICAgICAgICAgICAgIHRoaXMub3BlbigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkKHdpbmRvdykub24oTWV0cm8uZXZlbnRzLnJlc2l6ZSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0LnNldFBvc2l0aW9uKCk7XG4gICAgICAgICAgICB9LCB7bnM6IHRoaXMuaWR9KTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiZGlhbG9nLWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX292ZXJsYXk6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdmFyIG92ZXJsYXkgPSAkKFwiPGRpdj5cIik7XG4gICAgICAgICAgICBvdmVybGF5LmFkZENsYXNzKFwib3ZlcmxheVwiKS5hZGRDbGFzcyhvLmNsc092ZXJsYXkpO1xuXG4gICAgICAgICAgICBpZiAoby5vdmVybGF5Q29sb3IgPT09ICd0cmFuc3BhcmVudCcpIHtcbiAgICAgICAgICAgICAgICBvdmVybGF5LmFkZENsYXNzKFwidHJhbnNwYXJlbnRcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG92ZXJsYXkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogTWV0cm8uY29sb3JzLnRvUkdCQShvLm92ZXJsYXlDb2xvciwgby5vdmVybGF5QWxwaGEpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBvdmVybGF5O1xuICAgICAgICB9LFxuXG4gICAgICAgIGhpZGU6IGZ1bmN0aW9uKGNhbGxiYWNrKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHRpbWVvdXQgPSAwO1xuICAgICAgICAgICAgaWYgKG8ub25IaWRlICE9PSBNZXRyby5ub29wKSB7XG4gICAgICAgICAgICAgICAgdGltZW91dCA9IDUwMDtcblxuICAgICAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImhpZGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgVXRpbHMuZXhlYyhjYWxsYmFjaywgbnVsbCwgZWxlbWVudFswXSk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiBcImhpZGRlblwiLFxuICAgICAgICAgICAgICAgICAgICB0b3A6IFwiMTAwJVwiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LCB0aW1lb3V0KTtcbiAgICAgICAgfSxcblxuICAgICAgICBzaG93OiBmdW5jdGlvbihjYWxsYmFjayl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24oKTtcbiAgICAgICAgICAgIGVsZW1lbnQuY3NzKHtcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiBcInZpc2libGVcIlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInNob3dcIik7XG5cbiAgICAgICAgICAgIFV0aWxzLmV4ZWMoY2FsbGJhY2ssIG51bGwsIGVsZW1lbnRbMF0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldFBvc2l0aW9uOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgdG9wLCBib3R0b207XG4gICAgICAgICAgICBpZiAoby50b1RvcCAhPT0gdHJ1ZSAmJiBvLnRvQm90dG9tICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdG9wID0gKCAkKHdpbmRvdykuaGVpZ2h0KCkgLSBlbGVtZW50Lm91dGVySGVpZ2h0KCkgKSAvIDI7XG4gICAgICAgICAgICAgICAgaWYgKHRvcCA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdG9wID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYm90dG9tID0gXCJhdXRvXCI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChvLnRvVG9wID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvcCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGJvdHRvbSA9IFwiYXV0b1wiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoby50b1RvcCAhPT0gdHJ1ZSAmJiBvLnRvQm90dG9tID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGJvdHRvbSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRvcCA9IFwiYXV0b1wiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsZW1lbnQuY3NzKHtcbiAgICAgICAgICAgICAgICB0b3A6IHRvcCxcbiAgICAgICAgICAgICAgICBib3R0b206IGJvdHRvbSxcbiAgICAgICAgICAgICAgICBsZWZ0OiAoICQod2luZG93KS53aWR0aCgpIC0gZWxlbWVudC5vdXRlcldpZHRoKCkgKSAvIDJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldENvbnRlbnQ6IGZ1bmN0aW9uKGMpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgY29udGVudCA9IGVsZW1lbnQuZmluZChcIi5kaWFsb2ctY29udGVudFwiKTtcbiAgICAgICAgICAgIGlmIChjb250ZW50Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJkaWFsb2ctY29udGVudFwiKTtcbiAgICAgICAgICAgICAgICBjb250ZW50LmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIVV0aWxzLmlzUShjKSAmJiBVdGlscy5pc0Z1bmMoYykpIHtcbiAgICAgICAgICAgICAgICBjID0gVXRpbHMuZXhlYyhjKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzUShjKSkge1xuICAgICAgICAgICAgICAgIGMuYXBwZW5kVG8oY29udGVudCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQuaHRtbChjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZXRUaXRsZTogZnVuY3Rpb24odCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciB0aXRsZSA9IGVsZW1lbnQuZmluZChcIi5kaWFsb2ctdGl0bGVcIik7XG4gICAgICAgICAgICBpZiAodGl0bGUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGl0bGUgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJkaWFsb2ctdGl0bGVcIik7XG4gICAgICAgICAgICAgICAgdGl0bGUuYXBwZW5kVG8oZWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aXRsZS5odG1sKHQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNsb3NlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAoIVV0aWxzLmJvb2woby5sZWF2ZU92ZXJsYXlPbkNsb3NlKSkge1xuICAgICAgICAgICAgICAgICQoJ2JvZHknKS5maW5kKCcub3ZlcmxheScpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmhpZGUoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmRhdGEoXCJvcGVuXCIsIGZhbHNlKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImNsb3NlXCIpXG5cbiAgICAgICAgICAgICAgICBpZiAoby5yZW1vdmVPbkNsb3NlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb3BlbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgaWYgKG8ub3ZlcmxheSA9PT0gdHJ1ZSAmJiAkKFwiLm92ZXJsYXlcIikubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vdmVybGF5LmFwcGVuZFRvKCQoXCJib2R5XCIpKTtcbiAgICAgICAgICAgICAgICBpZiAoby5vdmVybGF5Q2xpY2tDbG9zZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm92ZXJsYXkub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2hvdyhmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwib3BlblwiKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuZGF0YShcIm9wZW5cIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KG8uYXV0b0hpZGUpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIHBhcnNlSW50KG8uYXV0b0hpZGUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIGlmIChlbGVtZW50LmRhdGEoJ29wZW4nKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNPcGVuOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5kYXRhKCdvcGVuJykgPT09IHRydWU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lICovXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSl7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmpzLWRpYWxvZy1jbG9zZVwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5idXR0b25cIikub2ZmKE1ldHJvLmV2ZW50cy5jbGljayk7XG4gICAgICAgICAgICAkKHdpbmRvdykub2ZmKE1ldHJvLmV2ZW50cy5yZXNpemUse25zOiB0aGlzLmlkfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBNZXRyby5kaWFsb2cgPSB7XG4gICAgICAgIGlzRGlhbG9nOiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICByZXR1cm4gVXRpbHMuaXNNZXRyb09iamVjdChlbCwgXCJkaWFsb2dcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb3BlbjogZnVuY3Rpb24oZWwsIGNvbnRlbnQsIHRpdGxlKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0RpYWxvZyhlbCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZGlhbG9nID0gTWV0cm8uZ2V0UGx1Z2luKGVsLCBcImRpYWxvZ1wiKTtcbiAgICAgICAgICAgIGlmICh0aXRsZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgZGlhbG9nLnNldFRpdGxlKHRpdGxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb250ZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBkaWFsb2cuc2V0Q29udGVudChjb250ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRpYWxvZy5vcGVuKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0RpYWxvZyhlbCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBNZXRyby5nZXRQbHVnaW4oJChlbClbMF0sIFwiZGlhbG9nXCIpLmNsb3NlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNEaWFsb2coZWwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKCQoZWwpWzBdLCBcImRpYWxvZ1wiKS50b2dnbGUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBpc09wZW46IGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0RpYWxvZyhlbCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBNZXRyby5nZXRQbHVnaW4oJChlbClbMF0sIFwiZGlhbG9nXCIpLmlzT3BlbigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZTogZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzRGlhbG9nKGVsKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBkaWFsb2cgPSBNZXRyby5nZXRQbHVnaW4oJChlbClbMF0sIFwiZGlhbG9nXCIpO1xuICAgICAgICAgICAgZGlhbG9nLm9wdGlvbnMucmVtb3ZlT25DbG9zZSA9IHRydWU7XG4gICAgICAgICAgICBkaWFsb2cuY2xvc2UoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgICAgICAgICAgdmFyIGRsZztcblxuICAgICAgICAgICAgZGxnID0gJChcIjxkaXY+XCIpLmFwcGVuZFRvKCQoXCJib2R5XCIpKTtcblxuICAgICAgICAgICAgdmFyIGRsZ19vcHRpb25zID0gJC5leHRlbmQoe30sIHtcbiAgICAgICAgICAgICAgICBzaG93OiB0cnVlLFxuICAgICAgICAgICAgICAgIGNsb3NlQWN0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgIHJlbW92ZU9uQ2xvc2U6IHRydWVcbiAgICAgICAgICAgIH0sIChvcHRpb25zICE9PSB1bmRlZmluZWQgPyBvcHRpb25zIDoge30pKTtcblxuICAgICAgICAgICAgZGxnX29wdGlvbnMuX3J1bnRpbWUgPSB0cnVlO1xuXG4gICAgICAgICAgICByZXR1cm4gTWV0cm8ubWFrZVBsdWdpbihkbGcsIFwiZGlhbG9nXCIsIGRsZ19vcHRpb25zKTtcbiAgICAgICAgfVxuICAgIH07XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgRG9udXREZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBkb251dERlZmVycmVkOiAwLFxuICAgICAgICBzaXplOiAxMDAsXG4gICAgICAgIGhvbGU6IC44LFxuICAgICAgICB2YWx1ZTogMCxcbiAgICAgICAgYmFja2dyb3VuZDogXCIjZmZmZmZmXCIsXG4gICAgICAgIGNvbG9yOiBcIlwiLFxuICAgICAgICBzdHJva2U6IFwiI2QxZDhlN1wiLFxuICAgICAgICBmaWxsOiBcIiM0OTY0OWZcIixcbiAgICAgICAgZm9udFNpemU6IDAsXG4gICAgICAgIHRvdGFsOiAxMDAsXG4gICAgICAgIGNhcDogXCIlXCIsXG4gICAgICAgIHNob3dUZXh0OiB0cnVlLFxuICAgICAgICBzaG93VmFsdWU6IGZhbHNlLFxuICAgICAgICBhbmltYXRlOiAwLFxuICAgICAgICBvbkNoYW5nZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EcmF3VmFsdWU6IGZ1bmN0aW9uKHYpe3JldHVybiB2fSxcbiAgICAgICAgb25Eb251dENyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5kb251dFNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgRG9udXREZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIERvbnV0RGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9Eb251dFNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8uZG9udXRTZXR1cCh3aW5kb3dbXCJtZXRyb0RvbnV0U2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnZG9udXQnLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgRG9udXREZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IDAsXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uX2NoYW5nZV9pbnRlcnZhbDogbnVsbFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImRvbnV0XCIpO1xuXG4gICAgICAgICAgICB0aGlzLl9zZXRFbGVtZW50U2l6ZSgpO1xuICAgICAgICAgICAgdGhpcy5fZHJhdygpO1xuICAgICAgICAgICAgdGhpcy5fYWRkRXZlbnRzKCk7XG4gICAgICAgICAgICB0aGlzLnZhbChvLnZhbHVlKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiZG9udXQtY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfc2V0RWxlbWVudFNpemU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciB3aWR0aCA9IG8uc2l6ZTtcblxuICAgICAgICAgICAgZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiBvLmJhY2tncm91bmRcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50LmNzcyh7XG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBlbGVtZW50LndpZHRoKClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9kcmF3OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgaHRtbCA9IFwiXCI7XG4gICAgICAgICAgICB2YXIgcmFkaXVzID0gZWxlbWVudC53aWR0aCgpIC8gMlxuICAgICAgICAgICAgdmFyIHIgPSByYWRpdXMgICogKDEgLSAoMSAtIG8uaG9sZSkgLyAyKTtcbiAgICAgICAgICAgIHZhciB3aWR0aCA9IHJhZGl1cyAqICgxIC0gby5ob2xlKTtcbiAgICAgICAgICAgIHZhciB0cmFuc2Zvcm0gPSAncm90YXRlKC05MCAnICsgcmFkaXVzICsgJywnICsgcmFkaXVzICsgJyknO1xuICAgICAgICAgICAgdmFyIGZvbnRTaXplID0gby5mb250U2l6ZSA9PT0gMCA/IHIgKiBvLmhvbGUgKiAwLjYgOiBvLmZvbnRTaXplO1xuXG4gICAgICAgICAgICBodG1sICs9IFwiPHN2Zz5cIjtcbiAgICAgICAgICAgIGh0bWwgKz0gXCIgICA8Y2lyY2xlIGNsYXNzPSdkb251dC1iYWNrJyByPSdcIisocikrXCJweCcgY3g9J1wiKyhyYWRpdXMpK1wicHgnIGN5PSdcIisocmFkaXVzKStcInB4JyB0cmFuc2Zvcm09J1wiKyh0cmFuc2Zvcm0pK1wiJyBmaWxsPSdub25lJyBzdHJva2U9J1wiKyhvLnN0cm9rZSkrXCInIHN0cm9rZS13aWR0aD0nXCIrKHdpZHRoKStcIicvPlwiO1xuICAgICAgICAgICAgaHRtbCArPSBcIiAgIDxjaXJjbGUgY2xhc3M9J2RvbnV0LWZpbGwnIHI9J1wiKyhyKStcInB4JyBjeD0nXCIrKHJhZGl1cykrXCJweCcgY3k9J1wiKyhyYWRpdXMpK1wicHgnIHRyYW5zZm9ybT0nXCIrKHRyYW5zZm9ybSkrXCInIGZpbGw9J25vbmUnIHN0cm9rZT0nXCIrKG8uZmlsbCkrXCInIHN0cm9rZS13aWR0aD0nXCIrKHdpZHRoKStcIicvPlwiO1xuXG4gICAgICAgICAgICBpZiAoby5zaG93VGV4dCA9PT0gdHJ1ZSlcbiAgICAgICAgICAgICAgICBodG1sICs9IFwiICAgPHRleHQgY2xhc3M9J2RvbnV0LXRpdGxlJyB4PSdcIisocmFkaXVzKStcInB4JyB5PSdcIisocmFkaXVzKStcInB4JyBkeT0nXCIrKGZvbnRTaXplLzMpK1wicHgnIHRleHQtYW5jaG9yPSdtaWRkbGUnIGZpbGw9J1wiKyhvLmNvbG9yICE9PSBcIlwiID8gby5jb2xvcjogby5maWxsKStcIicgZm9udC1zaXplPSdcIisoZm9udFNpemUpK1wicHgnPjwvdGV4dD5cIjtcblxuICAgICAgICAgICAgaHRtbCArPSBcIjwvc3ZnPlwiO1xuXG4gICAgICAgICAgICBlbGVtZW50Lmh0bWwoaHRtbCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2FkZEV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKFwicmVzaXplXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5fc2V0RWxlbWVudFNpemUoKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9kcmF3KCk7XG4gICAgICAgICAgICAgICAgdGhhdC52YWwodGhhdC52YWx1ZSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuXG4gICAgICAgIF9zZXRWYWx1ZTogZnVuY3Rpb24odil7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdmFyIGZpbGwgPSBlbGVtZW50LmZpbmQoXCIuZG9udXQtZmlsbFwiKTtcbiAgICAgICAgICAgIHZhciB0aXRsZSA9IGVsZW1lbnQuZmluZChcIi5kb251dC10aXRsZVwiKTtcbiAgICAgICAgICAgIHZhciByYWRpdXMgPSBlbGVtZW50LndpZHRoKCkgLyAyXG4gICAgICAgICAgICB2YXIgciA9IHJhZGl1cyAgKiAoMSAtICgxIC0gby5ob2xlKSAvIDIpO1xuICAgICAgICAgICAgdmFyIGNpcmN1bWZlcmVuY2UgPSBNYXRoLnJvdW5kKDIgKiBNYXRoLlBJICogcik7XG4gICAgICAgICAgICB2YXIgdGl0bGVfdmFsdWUgPSAoby5zaG93VmFsdWUgPyB2IDogVXRpbHMucGVyY2VudChvLnRvdGFsLCB2LCB0cnVlKSkvKiAgKyAoby5jYXApKi87XG4gICAgICAgICAgICB2YXIgZmlsbF92YWx1ZSA9IE1hdGgucm91bmQoKCgrdiAqIGNpcmN1bWZlcmVuY2UpIC8gby50b3RhbCkpOy8vICsgJyAnICsgY2lyY3VtZmVyZW5jZTtcblxuICAgICAgICAgICAgdmFyIHNkYSA9IGZpbGwuYXR0cihcInN0cm9rZS1kYXNoYXJyYXlcIik7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHNkYSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgIHNkYSA9IDA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNkYSA9ICtzZGEuc3BsaXQoXCIgXCIpWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGRlbHRhID0gZmlsbF92YWx1ZSAtIHNkYTtcblxuICAgICAgICAgICAgZmlsbC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBkcmF3OiBmdW5jdGlvbih0LCBwKXtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFwic3Ryb2tlLWRhc2hhcnJheVwiLCAoc2RhICsgZGVsdGEgKiBwICkgKyAnICcgKyBjaXJjdW1mZXJlbmNlKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGR1cjogby5hbmltYXRlXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICB0aXRsZS5odG1sKE1ldHJvLnV0aWxzLmV4ZWMoby5vbkRyYXdWYWx1ZSwgW3RpdGxlX3ZhbHVlICsgby5jYXBdKSk7XG5cbiAgICAgICAgICAgIC8vIHRpdGxlLmFuaW1hdGUoe1xuICAgICAgICAgICAgLy8gICAgIGRyYXc6IHtcbiAgICAgICAgICAgIC8vICAgICAgICAgaW5uZXJIVE1MOiB0aXRsZV92YWx1ZVxuICAgICAgICAgICAgLy8gICAgIH0sXG4gICAgICAgICAgICAvLyAgICAgZHVyOiBvLmFuaW1hdGUsXG4gICAgICAgICAgICAvLyAgICAgb25GcmFtZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIC8vICAgICAgICAgdGhpcy5pbm5lckhUTUwgPSBNZXRyby51dGlscy5leGVjKG8ub25EcmF3VmFsdWUsIFt0aGlzLmlubmVySFRNTCArIG8uY2FwXSk7XG4gICAgICAgICAgICAvLyAgICAgfVxuICAgICAgICAgICAgLy8gfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdmFsOiBmdW5jdGlvbih2KXtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAodiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHBhcnNlSW50KHYpIDwgMCB8fCBwYXJzZUludCh2KSA+IG8udG90YWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX3NldFZhbHVlKHYpO1xuXG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdjtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiY2hhbmdlXCIsIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy52YWx1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0Q29sb3I6IGZ1bmN0aW9uKG9iail7XG4gICAgICAgICAgICB2YXIgdmFsaWRLZXlzID0gW1wiYmFja2dyb3VuZCwgZmlsbCwgc3Ryb2tlLCBjb2xvclwiXVxuXG4gICAgICAgICAgICAkLmVhY2gob2JqLCBmdW5jdGlvbihrZXksIHZhbCl7XG4gICAgICAgICAgICAgICAgaWYgKHZhbGlkS2V5cy5pbmRleE9mKGtleSkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uc1trZXldID0gdmFsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgdGhpcy5fZHJhdygpO1xuICAgICAgICAgICAgdGhpcy52YWwodGhpcy52YWx1ZSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZVZhbHVlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy52YWwodGhpcy5lbGVtZW50LmF0dHIoXCJkYXRhLXZhbHVlXCIpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHIsIHZhbCl7XG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHIpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS12YWx1ZVwiOiB0aGlzLmNoYW5nZVZhbHVlKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLWJhY2tncm91bmRcIjogdGhpcy5zZXRDb2xvcih7XCJiYWNrZ3JvdW5kXCI6IHZhbH0pOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1maWxsXCI6IHRoaXMuc2V0Q29sb3Ioe1wiZmlsbFwiOiB2YWx9KTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtc3Ryb2tlXCI6IHRoaXMuc2V0Q29sb3Ioe1wic3Ryb2tlXCI6IHZhbH0pOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1jb2xvclwiOiB0aGlzLnNldENvbG9yKHtcImNvbG9yXCI6IHZhbH0pOyBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4vKiBlc2xpbnQtZGlzYWJsZSAqL1xuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIERvdWJsZVNlbGVjdEJveERlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGhlaWdodDogXCJhdXRvXCIsXG4gICAgICAgIG11bHRpU2VsZWN0OiBmYWxzZSxcblxuICAgICAgICBtb3ZlUmlnaHRJY29uOiBcIjxzcGFuPiZyc2FxdW87PC9zcGFuPlwiLFxuICAgICAgICBtb3ZlUmlnaHRBbGxJY29uOiBcIjxzcGFuPiZyYXF1bzs8L3NwYW4+XCIsXG4gICAgICAgIG1vdmVMZWZ0SWNvbjogXCI8c3Bhbj4mbHNhcXVvOzwvc3Bhbj5cIixcbiAgICAgICAgbW92ZUxlZnRBbGxJY29uOiBcIjxzcGFuPiZsYXF1bzs8L3NwYW4+XCIsXG5cbiAgICAgICAgY2xzQm94OiBcIlwiLFxuICAgICAgICBjbHNNb3ZlQnV0dG9uOiBcIlwiLFxuICAgICAgICBjbHNNb3ZlUmlnaHRCdXR0b246IFwiXCIsXG4gICAgICAgIGNsc01vdmVSaWdodEFsbEJ1dHRvbjogXCJcIixcbiAgICAgICAgY2xzTW92ZUxlZnRCdXR0b246IFwiXCIsXG4gICAgICAgIGNsc01vdmVMZWZ0QWxsQnV0dG9uOiBcIlwiLFxuICAgICAgICBjbHNMaXN0TGVmdDogXCJcIixcbiAgICAgICAgY2xzTGlzdFJpZ2h0OiBcIlwiLFxuXG4gICAgICAgIG9uRG91YmxlU2VsZWN0Qm94Q3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmRvdWJsZVNlbGVjdEJveFNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgRG91YmxlU2VsZWN0Qm94RGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBEb3VibGVTZWxlY3RCb3hEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0RvdWJsZVNlbGVjdEJveFNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8uZG91YmxlU2VsZWN0Qm94U2V0dXAod2luZG93W1wibWV0cm9Eb3VibGVTZWxlY3RCb3hTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdkb3VibGUtc2VsZWN0LWJveCcsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBEb3VibGVTZWxlY3RCb3hEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgLy8gZGVmaW5lIGluc3RhbmNlIHZhcnMgaGVyZVxuICAgICAgICAgICAgICAgIHNlbGVjdDE6IG51bGwsXG4gICAgICAgICAgICAgICAgc2VsZWN0MjogbnVsbCxcbiAgICAgICAgICAgICAgICBsaXN0MTogbnVsbCxcbiAgICAgICAgICAgICAgICBsaXN0MjogbnVsbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5jaGlsZHJlbihcInNlbGVjdFwiKS5sZW5ndGggIT09IDIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb21wb25lbnQgRG91YmxlU2VsZWN0Qm94IHJlcXVpcmVkIHR3byBzZWxlY3QgZWxlbWVudHMhXCIpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVN0cnVjdHVyZSgpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlRXZlbnRzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudCgnZG91YmxlLXNlbGVjdC1ib3gtY3JlYXRlJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2RyYXdMaXN0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICB0aGlzLmxpc3QxLmNsZWFyKCk7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdDEuZmluZChcIm9wdGlvblwiKS5lYWNoKGZ1bmN0aW9uKGksIG9wdGlvbil7XG4gICAgICAgICAgICAgICAgdmFyICRvcCA9ICQob3B0aW9uKTtcbiAgICAgICAgICAgICAgICB2YXIgaHRtbCA9ICRvcC5hdHRyKFwiZGF0YS10ZW1wbGF0ZVwiKSA/ICRvcC5hdHRyKFwiZGF0YS10ZW1wbGF0ZVwiKS5yZXBsYWNlKC9cXCQxL2csICRvcC50ZXh0KCkpIDogJG9wLnRleHQoKTtcblxuICAgICAgICAgICAgICAgIHRoYXQubGlzdDEuYXBwZW5kKFxuICAgICAgICAgICAgICAgICAgICAkKFwiPGxpPlwiKS5odG1sKGh0bWwpLmF0dHIoXCJkYXRhLXZhbHVlXCIsIG9wdGlvbi52YWx1ZSkuZGF0YShcIm9wdGlvblwiLCBvcHRpb24pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMubGlzdDIuY2xlYXIoKTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Mi5maW5kKFwib3B0aW9uXCIpLmVhY2goZnVuY3Rpb24oaSwgb3B0aW9uKXtcbiAgICAgICAgICAgICAgICB2YXIgJG9wID0gJChvcHRpb24pO1xuICAgICAgICAgICAgICAgIHZhciBodG1sID0gJG9wLmF0dHIoXCJkYXRhLXRlbXBsYXRlXCIpID8gJG9wLmF0dHIoXCJkYXRhLXRlbXBsYXRlXCIpLnJlcGxhY2UoL1xcJDEvZywgJG9wLnRleHQoKSkgOiAkb3AudGV4dCgpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5saXN0Mi5hcHBlbmQoXG4gICAgICAgICAgICAgICAgICAgICQoXCI8bGk+XCIpLmh0bWwoaHRtbCkuYXR0cihcImRhdGEtdmFsdWVcIiwgb3B0aW9uLnZhbHVlKS5kYXRhKFwib3B0aW9uXCIsIG9wdGlvbilcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlU3RydWN0dXJlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHNlbGVjdHMgPSBlbGVtZW50LmNoaWxkcmVuKFwic2VsZWN0XCIpO1xuICAgICAgICAgICAgdmFyIHNlbGVjdDEgPSBzZWxlY3RzLmVxKDApO1xuICAgICAgICAgICAgdmFyIHNlbGVjdDIgPSBzZWxlY3RzLmVxKDEpO1xuICAgICAgICAgICAgdmFyIGNvbnRyb2xzID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY29udHJvbHNcIikuaW5zZXJ0QmVmb3JlKHNlbGVjdDIpO1xuICAgICAgICAgICAgdmFyIGxpc3QxLCBsaXN0MjtcblxuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImRvdWJsZS1zZWxlY3QtYm94XCIpLmFkZENsYXNzKG8uY2xzQm94KS5jc3Moe1xuICAgICAgICAgICAgICAgIGhlaWdodDogby5oZWlnaHRcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzZWxlY3RzLnByb3AoXCJtdWx0aXBsZVwiLCB0cnVlKTtcblxuICAgICAgICAgICAgY29udHJvbHMuYXBwZW5kKFxuICAgICAgICAgICAgICAgICQoW1xuICAgICAgICAgICAgICAgICAgICAkKFwiPGJ1dHRvbj5cIikuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIikuYWRkQ2xhc3MoXCJidXR0b24gLS1tb3ZlLXJpZ2h0XCIpLmFkZENsYXNzKG8uY2xzTW92ZUJ1dHRvbikuYWRkQ2xhc3Moby5jbHNNb3ZlUmlnaHRCdXR0b24pLmh0bWwoby5tb3ZlUmlnaHRJY29uKSxcbiAgICAgICAgICAgICAgICAgICAgJChcIjxidXR0b24+XCIpLmF0dHIoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpLmFkZENsYXNzKFwiYnV0dG9uIC0tbW92ZS1yaWdodC1hbGxcIikuYWRkQ2xhc3Moby5jbHNNb3ZlQnV0dG9uKS5hZGRDbGFzcyhvLmNsc01vdmVSaWdodEFsbEJ1dHRvbikuaHRtbChvLm1vdmVSaWdodEFsbEljb24pLFxuICAgICAgICAgICAgICAgICAgICAkKFwiPGJ1dHRvbj5cIikuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIikuYWRkQ2xhc3MoXCJidXR0b24gLS1tb3ZlLWxlZnQtYWxsXCIpLmFkZENsYXNzKG8uY2xzTW92ZUJ1dHRvbikuYWRkQ2xhc3Moby5jbHNNb3ZlTGVmdEFsbEJ1dHRvbikuaHRtbChvLm1vdmVMZWZ0QWxsSWNvbiksXG4gICAgICAgICAgICAgICAgICAgICQoXCI8YnV0dG9uPlwiKS5hdHRyKFwidHlwZVwiLCBcImJ1dHRvblwiKS5hZGRDbGFzcyhcImJ1dHRvbiAtLW1vdmUtbGVmdFwiKS5hZGRDbGFzcyhvLmNsc01vdmVCdXR0b24pLmFkZENsYXNzKG8uY2xzTW92ZUxlZnRCdXR0b24pLmh0bWwoby5tb3ZlTGVmdEljb24pLFxuICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICApXG5cbiAgICAgICAgICAgIGxpc3QxID0gJChcIjx1bD5cIikuYWRkQ2xhc3MoXCItLWxpc3QxXCIpLmFkZENsYXNzKG8uY2xzTGlzdExlZnQpLmluc2VydEJlZm9yZShzZWxlY3QxKTtcbiAgICAgICAgICAgIGxpc3QyID0gJChcIjx1bD5cIikuYWRkQ2xhc3MoXCItLWxpc3QyXCIpLmFkZENsYXNzKG8uY2xzTGlzdFJpZ2h0KS5pbnNlcnRCZWZvcmUoc2VsZWN0Mik7XG5cblxuICAgICAgICAgICAgdGhpcy5zZWxlY3QxID0gc2VsZWN0MTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0MiA9IHNlbGVjdDI7XG4gICAgICAgICAgICB0aGlzLmxpc3QxID0gbGlzdDE7XG4gICAgICAgICAgICB0aGlzLmxpc3QyID0gbGlzdDI7XG5cbiAgICAgICAgICAgIHRoaXMuX2RyYXdMaXN0KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX21vdmVJdGVtczogZnVuY3Rpb24oaXRlbXMsIHRhcmdldHMpe1xuICAgICAgICAgICAgJC5lYWNoKGl0ZW1zLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciAkaXRlbSA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbiA9ICRpdGVtLmRhdGEoJ29wdGlvbicpO1xuXG4gICAgICAgICAgICAgICAgJChvcHRpb24pLmFwcGVuZFRvKHRhcmdldHNbMF0pO1xuICAgICAgICAgICAgICAgICRpdGVtLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpLmFwcGVuZFRvKHRhcmdldHNbMV0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcblxuICAgICAgICBfbW92ZTogZnVuY3Rpb24oZGlyLCBzY29wZSl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmIChzY29wZSA9PT0gJ3NlbGVjdGVkJykge1xuICAgICAgICAgICAgICAgIGlmIChkaXIgPT09ICdsdHInKSB7IC8vIGxlZnQgdG8gcmlnaHRcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fbW92ZUl0ZW1zKHRoaXMubGlzdDEuZmluZChcImxpLmFjdGl2ZVwiKSwgW3RoYXQuc2VsZWN0MiwgdGhhdC5saXN0Ml0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX21vdmVJdGVtcyh0aGlzLmxpc3QyLmZpbmQoXCJsaS5hY3RpdmVcIiksIFt0aGF0LnNlbGVjdDEsIHRoYXQubGlzdDFdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChkaXIgPT09ICdsdHInKSB7IC8vIGxlZnQgdG8gcmlnaHRcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fbW92ZUl0ZW1zKHRoaXMubGlzdDEuZmluZChcImxpXCIpLCBbdGhhdC5zZWxlY3QyLCB0aGF0Lmxpc3QyXSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fbW92ZUl0ZW1zKHRoaXMubGlzdDIuZmluZChcImxpXCIpLCBbdGhhdC5zZWxlY3QxLCB0aGF0Lmxpc3QxXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgaXRlbXMgPSBlbGVtZW50LmZpbmQoXCJsaVwiKTtcblxuICAgICAgICAgICAgaXRlbXMub24oXCJjbGlja1wiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciAkZWwgPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgaWYgKG8ubXVsdGlTZWxlY3QgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQubGlzdDEuZmluZChcImxpXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lmxpc3QyLmZpbmQoXCJsaVwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkZWwuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXRlbXMub24oXCJkYmxjbGlja1wiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciAkZWwgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIHZhciBkaXIgPSAkZWwucGFyZW50KCkuaGFzQ2xhc3MoXCItLWxpc3QxXCIpID8gJ2x0cicgOiAncnRsJztcbiAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSAnc2VsZWN0ZWQnO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5saXN0MS5maW5kKFwibGlcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgdGhhdC5saXN0Mi5maW5kKFwibGlcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG5cbiAgICAgICAgICAgICAgICAkZWwuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9tb3ZlKGRpciwgc2NvcGUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oXCJjbGlja1wiLCBcImJ1dHRvblwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBidG4gPSAkKHRoaXMpXG4gICAgICAgICAgICAgICAgaWYgKGJ0bi5oYXNDbGFzcyhcIi0tbW92ZS1yaWdodFwiKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9tb3ZlKCdsdHInLCAnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGJ0bi5oYXNDbGFzcyhcIi0tbW92ZS1yaWdodC1hbGxcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fbW92ZSgnbHRyJywgJ2FsbCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYnRuLmhhc0NsYXNzKFwiLS1tb3ZlLWxlZnRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fbW92ZSgncnRsJywgJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChidG4uaGFzQ2xhc3MoXCItLW1vdmUtbGVmdC1hbGxcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fbW92ZSgncnRsJywgJ2FsbCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlByZXNzZWQgdW5yZWdpc3RlcmVkIGJ1dHRvbiFcIilcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHIsIG5ld1ZhbHVlKXtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcbi8qIGVzbGludC1lbmFibGUgKi9cblxyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBEb3VibGVTbGlkZXJEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBkb3VibGVzbGlkZXJEZWZlcnJlZDogMCxcbiAgICAgICAgcm91bmRWYWx1ZTogdHJ1ZSxcbiAgICAgICAgbWluOiAwLFxuICAgICAgICBtYXg6IDEwMCxcbiAgICAgICAgYWNjdXJhY3k6IDAsXG4gICAgICAgIHNob3dNaW5NYXg6IGZhbHNlLFxuICAgICAgICBtaW5NYXhQb3NpdGlvbjogTWV0cm8ucG9zaXRpb24uVE9QLFxuICAgICAgICB2YWx1ZU1pbjogbnVsbCxcbiAgICAgICAgdmFsdWVNYXg6IG51bGwsXG4gICAgICAgIGhpbnQ6IGZhbHNlLFxuICAgICAgICBoaW50QWx3YXlzOiBmYWxzZSxcbiAgICAgICAgaGludFBvc2l0aW9uTWluOiBNZXRyby5wb3NpdGlvbi5UT1AsXG4gICAgICAgIGhpbnRQb3NpdGlvbk1heDogTWV0cm8ucG9zaXRpb24uVE9QLFxuICAgICAgICBoaW50TWFza01pbjogXCIkMVwiLFxuICAgICAgICBoaW50TWFza01heDogXCIkMVwiLFxuICAgICAgICB0YXJnZXQ6IG51bGwsXG4gICAgICAgIHNpemU6IDAsXG5cbiAgICAgICAgY2xzU2xpZGVyOiBcIlwiLFxuICAgICAgICBjbHNCYWNrc2lkZTogXCJcIixcbiAgICAgICAgY2xzQ29tcGxldGU6IFwiXCIsXG4gICAgICAgIGNsc01hcmtlcjogXCJcIixcbiAgICAgICAgY2xzTWFya2VyTWluOiBcIlwiLFxuICAgICAgICBjbHNNYXJrZXJNYXg6IFwiXCIsXG4gICAgICAgIGNsc0hpbnQ6IFwiXCIsXG4gICAgICAgIGNsc0hpbnRNaW46IFwiXCIsXG4gICAgICAgIGNsc0hpbnRNYXg6IFwiXCIsXG4gICAgICAgIGNsc01pbk1heDogXCJcIixcbiAgICAgICAgY2xzTWluOiBcIlwiLFxuICAgICAgICBjbHNNYXg6IFwiXCIsXG5cbiAgICAgICAgb25TdGFydDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25TdG9wOiBNZXRyby5ub29wLFxuICAgICAgICBvbk1vdmU6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQ2hhbmdlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNoYW5nZVZhbHVlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkZvY3VzOiBNZXRyby5ub29wLFxuICAgICAgICBvbkJsdXI6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uRG91YmxlU2xpZGVyQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmRvdWJsZVNsaWRlclNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgRG91YmxlU2xpZGVyRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBEb3VibGVTbGlkZXJEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0RvdWJsZVNsaWRlclNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8uZG91YmxlU2xpZGVyU2V0dXAod2luZG93W1wibWV0cm9Eb3VibGVTbGlkZXJTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdkb3VibGUtc2xpZGVyJywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIERvdWJsZVNsaWRlckRlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICBzbGlkZXI6IG51bGwsXG4gICAgICAgICAgICAgICAgdmFsdWVNaW46IG51bGwsXG4gICAgICAgICAgICAgICAgdmFsdWVNYXg6IG51bGwsXG4gICAgICAgICAgICAgICAga2V5SW50ZXJ2YWw6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlkOiBVdGlscy5lbGVtZW50SWQoXCJzbGlkZXJcIilcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIHRoaXMudmFsdWVNaW4gPSBVdGlscy5pc1ZhbHVlKG8udmFsdWVNaW4pID8gK28udmFsdWVNaW4gOiArby5taW47XG4gICAgICAgICAgICB0aGlzLnZhbHVlTWF4ID0gVXRpbHMuaXNWYWx1ZShvLnZhbHVlTWF4KSA/ICtvLnZhbHVlTWF4IDogK28ubWF4O1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTbGlkZXIoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLnZhbCh0aGlzLnZhbHVlTWluLCB0aGlzLnZhbHVlTWF4KTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiZG91YmxlLXNsaWRlci1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVNsaWRlcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHNsaWRlcl93cmFwcGVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwic2xpZGVyLXdyYXBwZXJcIik7XG4gICAgICAgICAgICB2YXIgc2xpZGVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwic2xpZGVyXCIpLmFkZENsYXNzKG8uY2xzU2xpZGVyKS5hZGRDbGFzcyh0aGlzLmVsZW0uY2xhc3NOYW1lKTtcbiAgICAgICAgICAgIHZhciBiYWNrc2lkZSA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImJhY2tzaWRlXCIpLmFkZENsYXNzKG8uY2xzQmFja3NpZGUpO1xuICAgICAgICAgICAgdmFyIGNvbXBsZXRlID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY29tcGxldGVcIikuYWRkQ2xhc3Moby5jbHNDb21wbGV0ZSk7XG4gICAgICAgICAgICB2YXIgbWFya2VyTWluID0gJChcIjxidXR0b24+XCIpLmF0dHIoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpLmFkZENsYXNzKFwibWFya2VyIG1hcmtlci1taW5cIikuYWRkQ2xhc3Moby5jbHNNYXJrZXIpLmFkZENsYXNzKG8uY2xzTWFya2VyTWluKTtcbiAgICAgICAgICAgIHZhciBtYXJrZXJNYXggPSAkKFwiPGJ1dHRvbj5cIikuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIikuYWRkQ2xhc3MoXCJtYXJrZXIgbWFya2VyLW1heFwiKS5hZGRDbGFzcyhvLmNsc01hcmtlcikuYWRkQ2xhc3Moby5jbHNNYXJrZXJNYXgpO1xuICAgICAgICAgICAgdmFyIGhpbnRNaW4gPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJoaW50IGhpbnQtbWluXCIpLmFkZENsYXNzKG8uaGludFBvc2l0aW9uTWluICsgXCItc2lkZVwiKS5hZGRDbGFzcyhvLmNsc0hpbnQpLmFkZENsYXNzKG8uY2xzSGludE1pbik7XG4gICAgICAgICAgICB2YXIgaGludE1heCA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImhpbnQgaGludC1tYXhcIikuYWRkQ2xhc3Moby5oaW50UG9zaXRpb25NYXggKyBcIi1zaWRlXCIpLmFkZENsYXNzKG8uY2xzSGludCkuYWRkQ2xhc3Moby5jbHNIaW50TWF4KTtcbiAgICAgICAgICAgIHZhciBpO1xuXG4gICAgICAgICAgICBpZiAoby5zaXplID4gMCkge1xuICAgICAgICAgICAgICAgIHNsaWRlci5vdXRlcldpZHRoKG8uc2l6ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNsaWRlci5pbnNlcnRCZWZvcmUoZWxlbWVudCk7XG4gICAgICAgICAgICBlbGVtZW50LmFwcGVuZFRvKHNsaWRlcik7XG4gICAgICAgICAgICBzbGlkZXJfd3JhcHBlci5pbnNlcnRCZWZvcmUoc2xpZGVyKTtcbiAgICAgICAgICAgIHNsaWRlci5hcHBlbmRUbyhzbGlkZXJfd3JhcHBlcik7XG5cbiAgICAgICAgICAgIGJhY2tzaWRlLmFwcGVuZFRvKHNsaWRlcik7XG4gICAgICAgICAgICBjb21wbGV0ZS5hcHBlbmRUbyhzbGlkZXIpO1xuICAgICAgICAgICAgbWFya2VyTWluLmFwcGVuZFRvKHNsaWRlcik7XG4gICAgICAgICAgICBtYXJrZXJNYXguYXBwZW5kVG8oc2xpZGVyKTtcbiAgICAgICAgICAgIGhpbnRNaW4uYXBwZW5kVG8obWFya2VyTWluKTtcbiAgICAgICAgICAgIGhpbnRNYXguYXBwZW5kVG8obWFya2VyTWF4KTtcblxuICAgICAgICAgICAgaWYgKG8uaGludEFsd2F5cyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICQoW2hpbnRNaW4sIGhpbnRNYXhdKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBcImJsb2NrXCJcbiAgICAgICAgICAgICAgICB9KS5hZGRDbGFzcyhcInBlcm1hbmVudC1oaW50XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5zaG93TWluTWF4ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1pbl9tYXhfd3JhcHBlciA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInNsaWRlci1taW4tbWF4XCIpLmFkZENsYXNzKG8uY2xzTWluTWF4KTtcbiAgICAgICAgICAgICAgICAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwic2xpZGVyLXRleHQtbWluXCIpLmFkZENsYXNzKG8uY2xzTWluKS5odG1sKG8ubWluKS5hcHBlbmRUbyhtaW5fbWF4X3dyYXBwZXIpO1xuICAgICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJzbGlkZXItdGV4dC1tYXhcIikuYWRkQ2xhc3Moby5jbHNNYXgpLmh0bWwoby5tYXgpLmFwcGVuZFRvKG1pbl9tYXhfd3JhcHBlcik7XG4gICAgICAgICAgICAgICAgaWYgKG8ubWluTWF4UG9zaXRpb24gPT09IE1ldHJvLnBvc2l0aW9uLlRPUCkge1xuICAgICAgICAgICAgICAgICAgICBtaW5fbWF4X3dyYXBwZXIuaW5zZXJ0QmVmb3JlKHNsaWRlcik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbWluX21heF93cmFwcGVyLmluc2VydEFmdGVyKHNsaWRlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50WzBdLmNsYXNzTmFtZSA9ICcnO1xuICAgICAgICAgICAgaWYgKG8uY29weUlubGluZVN0eWxlcyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBlbGVtZW50WzBdLnN0eWxlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHNsaWRlci5jc3MoZWxlbWVudFswXS5zdHlsZVtpXSwgZWxlbWVudC5jc3MoZWxlbWVudFswXS5zdHlsZVtpXSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuaXMoXCI6ZGlzYWJsZWRcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmFibGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5zbGlkZXIgPSBzbGlkZXI7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgc2xpZGVyID0gdGhpcy5zbGlkZXIsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgbWFya2VyID0gc2xpZGVyLmZpbmQoXCIubWFya2VyXCIpO1xuXG4gICAgICAgICAgICBtYXJrZXIub24oTWV0cm8uZXZlbnRzLnN0YXJ0QWxsLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBfbWFya2VyID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgaGludCA9IF9tYXJrZXIuZmluZChcIi5oaW50XCIpO1xuICAgICAgICAgICAgICAgIGlmIChvLmhpbnQgPT09IHRydWUgJiYgby5oaW50QWx3YXlzICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGhpbnQuZmFkZUluKDMwMCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkub24oTWV0cm8uZXZlbnRzLm1vdmVBbGwsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9tb3ZlKGUpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJtb3ZlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbjogdGhhdC52YWx1ZU1pbixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heDogdGhhdC52YWx1ZU1heFxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH0sIHtuczogdGhhdC5pZH0pO1xuXG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkub24oTWV0cm8uZXZlbnRzLnN0b3BBbGwsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihNZXRyby5ldmVudHMubW92ZUFsbCwge25zOiB0aGF0LmlkfSk7XG4gICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihNZXRyby5ldmVudHMuc3RvcEFsbCwge25zOiB0aGF0LmlkfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG8uaGludEFsd2F5cyAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGludC5mYWRlT3V0KDMwMCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJzdG9wXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbjogdGhhdC52YWx1ZU1pbixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heDogdGhhdC52YWx1ZU1heFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LCB7bnM6IHRoYXQuaWR9KTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInN0YXJ0XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgbWluOiB0aGF0LnZhbHVlTWluLFxuICAgICAgICAgICAgICAgICAgICBtYXg6IHRoYXQudmFsdWVNYXhcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtYXJrZXIub24oTWV0cm8uZXZlbnRzLmZvY3VzLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImZvY3VzXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgbWluOiB0aGF0LnZhbHVlTWluLFxuICAgICAgICAgICAgICAgICAgICBtYXg6IHRoYXQudmFsdWVNYXhcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtYXJrZXIub24oTWV0cm8uZXZlbnRzLmJsdXIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiYmx1clwiLCB7XG4gICAgICAgICAgICAgICAgICAgIG1pbjogdGhhdC52YWx1ZU1pbixcbiAgICAgICAgICAgICAgICAgICAgbWF4OiB0aGF0LnZhbHVlTWF4XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKE1ldHJvLmV2ZW50cy5yZXNpemUsZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0LnZhbCh0aGF0LnZhbHVlTWluLCB0aGF0LnZhbHVlTWF4KTtcbiAgICAgICAgICAgIH0sIHtuczogdGhhdC5pZH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jb252ZXJ0OiBmdW5jdGlvbih2LCBob3cpe1xuICAgICAgICAgICAgdmFyIHNsaWRlciA9IHRoaXMuc2xpZGVyLCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGxlbmd0aCA9IHNsaWRlci5vdXRlcldpZHRoKCkgLSBzbGlkZXIuZmluZChcIi5tYXJrZXJcIikub3V0ZXJXaWR0aCgpO1xuICAgICAgICAgICAgc3dpdGNoIChob3cpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwicGl4MnByY1wiOiByZXR1cm4gKCB2ICogMTAwIC8gbGVuZ3RoICk7XG4gICAgICAgICAgICAgICAgY2FzZSBcInBpeDJ2YWxcIjogcmV0dXJuICggdGhpcy5fY29udmVydCh2LCAncGl4MnByYycpICogKChvLm1heCAtIG8ubWluKSAvIDEwMCkgKyBvLm1pbiApO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJ2YWwycHJjXCI6IHJldHVybiAoICh2IC0gby5taW4pLyggKG8ubWF4IC0gby5taW4pIC8gMTAwICkgICk7XG4gICAgICAgICAgICAgICAgY2FzZSBcInByYzJwaXhcIjogcmV0dXJuICggdiAvICggMTAwIC8gbGVuZ3RoICkpO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJ2YWwycGl4XCI6IHJldHVybiAoIHRoaXMuX2NvbnZlcnQodGhpcy5fY29udmVydCh2LCAndmFsMnByYycpLCAncHJjMnBpeCcpICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jb3JyZWN0OiBmdW5jdGlvbih2YWx1ZSl7XG4gICAgICAgICAgICB2YXIgcmVzID0gdmFsdWU7XG4gICAgICAgICAgICB2YXIgYWNjdXJhY3kgID0gdGhpcy5vcHRpb25zLmFjY3VyYWN5O1xuICAgICAgICAgICAgdmFyIG1pbiA9IHRoaXMub3B0aW9ucy5taW4sIG1heCA9IHRoaXMub3B0aW9ucy5tYXg7XG4gICAgICAgICAgICB2YXIgX2RlYyA9IGZ1bmN0aW9uKHYpe1xuICAgICAgICAgICAgICAgIHJldHVybiB2ICUgMSA9PT0gMCA/IDAgOiB2LnRvU3RyaW5nKCkuc3BsaXQoXCIuXCIpWzFdLmxlbmd0aDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChhY2N1cmFjeSA9PT0gMCB8fCBpc05hTihhY2N1cmFjeSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXMgPSBNYXRoLnJvdW5kKHZhbHVlL2FjY3VyYWN5KSphY2N1cmFjeTtcblxuICAgICAgICAgICAgaWYgKHJlcyA8IG1pbikge1xuICAgICAgICAgICAgICAgIHJlcyA9IG1pbjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHJlcyA+IG1heCkge1xuICAgICAgICAgICAgICAgIHJlcyA9IG1heDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHJlcy50b0ZpeGVkKF9kZWMoYWNjdXJhY3kpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfbW92ZTogZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gJChlLnRhcmdldCkuY2xvc2VzdChcIi5tYXJrZXJcIik7XG4gICAgICAgICAgICB2YXIgaXNNaW4gPSB0YXJnZXQuaGFzQ2xhc3MoXCJtYXJrZXItbWluXCIpO1xuICAgICAgICAgICAgdmFyIHNsaWRlciA9IHRoaXMuc2xpZGVyO1xuICAgICAgICAgICAgdmFyIG9mZnNldCA9IHNsaWRlci5vZmZzZXQoKSxcbiAgICAgICAgICAgICAgICBtYXJrZXJfc2l6ZSA9IHNsaWRlci5maW5kKFwiLm1hcmtlclwiKS5vdXRlcldpZHRoKCksXG4gICAgICAgICAgICAgICAgbWFya2VyTWluID0gc2xpZGVyLmZpbmQoXCIubWFya2VyLW1pblwiKSxcbiAgICAgICAgICAgICAgICBtYXJrZXJNYXggPSBzbGlkZXIuZmluZChcIi5tYXJrZXItbWF4XCIpLFxuICAgICAgICAgICAgICAgIGxlbmd0aCA9IHNsaWRlci5vdXRlcldpZHRoKCksXG4gICAgICAgICAgICAgICAgY1BpeCwgY1N0YXJ0LCBjU3RvcDtcblxuICAgICAgICAgICAgY1BpeCA9IFV0aWxzLnBhZ2VYWShlKS54IC0gb2Zmc2V0LmxlZnQgLSBtYXJrZXJfc2l6ZSAvIDI7XG5cbiAgICAgICAgICAgIGlmIChpc01pbikge1xuICAgICAgICAgICAgICAgIGNTdGFydCA9IDA7XG4gICAgICAgICAgICAgICAgY1N0b3AgPSBwYXJzZUludChtYXJrZXJNYXguY3NzKFwibGVmdFwiKSkgLSBtYXJrZXJfc2l6ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY1N0YXJ0ID0gcGFyc2VJbnQobWFya2VyTWluLmNzcyhcImxlZnRcIikpICsgbWFya2VyX3NpemU7XG4gICAgICAgICAgICAgICAgY1N0b3AgPSBsZW5ndGggLSBtYXJrZXJfc2l6ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGNQaXggPCBjU3RhcnQgfHwgY1BpeCA+IGNTdG9wKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpc1tpc01pbiA/IFwidmFsdWVNaW5cIiA6IFwidmFsdWVNYXhcIl0gPSB0aGlzLl9jb3JyZWN0KHRoaXMuX2NvbnZlcnQoY1BpeCwgJ3BpeDJ2YWwnKSk7XG5cbiAgICAgICAgICAgIHRoaXMuX3JlZHJhdygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9oaW50OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBvID0gdGhpcy5vcHRpb25zLCBzbGlkZXIgPSB0aGlzLnNsaWRlciwgaGludCA9IHNsaWRlci5maW5kKFwiLmhpbnRcIik7XG5cbiAgICAgICAgICAgIGhpbnQuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBfaGludCA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgdmFyIGlzTWluID0gX2hpbnQuaGFzQ2xhc3MoXCJoaW50LW1pblwiKTtcbiAgICAgICAgICAgICAgICB2YXIgX21hc2sgPSBpc01pbiA/IG8uaGludE1hc2tNaW4gOiBvLmhpbnRNYXNrTWF4O1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9ICsoaXNNaW4gPyB0aGF0LnZhbHVlTWluIDogdGhhdC52YWx1ZU1heCkgfHwgMDtcbiAgICAgICAgICAgICAgICBfaGludC50ZXh0KF9tYXNrLnJlcGxhY2UoXCIkMVwiLCB2YWx1ZS50b0ZpeGVkKFV0aWxzLmRlY0NvdW50KG8uYWNjdXJhY3kpKSkpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfdmFsdWU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciB2MSA9ICt0aGlzLnZhbHVlTWluIHx8IDAsIHYyID0gK3RoaXMudmFsdWVNYXggfHwgMDtcbiAgICAgICAgICAgIHZhciB2YWx1ZTtcblxuICAgICAgICAgICAgaWYgKG8ucm91bmRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHYxID0gdjEudG9GaXhlZChVdGlscy5kZWNDb3VudChvLmFjY3VyYWN5KSk7XG4gICAgICAgICAgICAgICAgdjIgPSB2Mi50b0ZpeGVkKFV0aWxzLmRlY0NvdW50KG8uYWNjdXJhY3kpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFsdWUgPSBbdjEsIHYyXS5qb2luKFwiLCBcIik7XG5cbiAgICAgICAgICAgIGlmIChlbGVtZW50WzBdLnRhZ05hbWUgPT09IFwiSU5QVVRcIikge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQudmFsKHZhbHVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8udGFyZ2V0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQoby50YXJnZXQpO1xuICAgICAgICAgICAgICAgIGlmICh0YXJnZXQubGVuZ3RoICE9PSAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHRhcmdldCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRhZ05hbWUgPT09IFwiSU5QVVRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudmFsKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC50ZXh0KHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHQudHJpZ2dlcihcImNoYW5nZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJjaGFuZ2UtdmFsdWVcIiwge1xuICAgICAgICAgICAgICAgIHZhbDogdmFsdWVcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJjaGFuZ2VcIiwge1xuICAgICAgICAgICAgICAgIHZhbDogdmFsdWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9tYXJrZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgc2xpZGVyID0gdGhpcy5zbGlkZXI7XG4gICAgICAgICAgICB2YXIgbWFya2VyTWluID0gc2xpZGVyLmZpbmQoXCIubWFya2VyLW1pblwiKTtcbiAgICAgICAgICAgIHZhciBtYXJrZXJNYXggPSBzbGlkZXIuZmluZChcIi5tYXJrZXItbWF4XCIpO1xuICAgICAgICAgICAgdmFyIGNvbXBsZXRlID0gc2xpZGVyLmZpbmQoXCIuY29tcGxldGVcIik7XG4gICAgICAgICAgICB2YXIgbWFya2VyX3NpemUgPSBwYXJzZUludChVdGlscy5nZXRTdHlsZU9uZShtYXJrZXJNaW4sIFwid2lkdGhcIikpO1xuICAgICAgICAgICAgdmFyIHNsaWRlcl92aXNpYmxlID0gVXRpbHMuaXNWaXNpYmxlKHNsaWRlcik7XG5cbiAgICAgICAgICAgIGlmIChzbGlkZXJfdmlzaWJsZSkge1xuICAgICAgICAgICAgICAgICQoW21hcmtlck1pbiwgbWFya2VyTWF4XSkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgJ21hcmdpbi10b3AnOiAwLFxuICAgICAgICAgICAgICAgICAgICAnbWFyZ2luLWxlZnQnOiAwXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzbGlkZXJfdmlzaWJsZSkge1xuICAgICAgICAgICAgICAgIG1hcmtlck1pbi5jc3MoJ2xlZnQnLCB0aGlzLl9jb252ZXJ0KHRoaXMudmFsdWVNaW4sICd2YWwycGl4JykpO1xuICAgICAgICAgICAgICAgIG1hcmtlck1heC5jc3MoJ2xlZnQnLCB0aGlzLl9jb252ZXJ0KHRoaXMudmFsdWVNYXgsICd2YWwycGl4JykpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBtYXJrZXJNaW4uY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgJ2xlZnQnOiAodGhpcy5fY29udmVydCh0aGlzLnZhbHVlTWluLCAndmFsMnByYycpKSArIFwiJVwiLFxuICAgICAgICAgICAgICAgICAgICAnbWFyZ2luLXRvcCc6IHRoaXMuX2NvbnZlcnQodGhpcy52YWx1ZU1pbiwgJ3ZhbDJwcmMnKSA9PT0gMCA/IDAgOiAtMSAqIG1hcmtlcl9zaXplIC8gMlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIG1hcmtlck1heC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAnbGVmdCc6ICh0aGlzLl9jb252ZXJ0KHRoaXMudmFsdWVNYXgsICd2YWwycHJjJykpICsgXCIlXCIsXG4gICAgICAgICAgICAgICAgICAgICdtYXJnaW4tdG9wJzogdGhpcy5fY29udmVydCh0aGlzLnZhbHVlTWF4LCAndmFsMnByYycpID09PSAwID8gMCA6IC0xICogbWFya2VyX3NpemUgLyAyXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbXBsZXRlLmNzcyh7XG4gICAgICAgICAgICAgICAgXCJsZWZ0XCI6IHRoaXMuX2NvbnZlcnQodGhpcy52YWx1ZU1pbiwgJ3ZhbDJwaXgnKSxcbiAgICAgICAgICAgICAgICBcIndpZHRoXCI6IHRoaXMuX2NvbnZlcnQodGhpcy52YWx1ZU1heCwgJ3ZhbDJwaXgnKSAtIHRoaXMuX2NvbnZlcnQodGhpcy52YWx1ZU1pbiwgJ3ZhbDJwaXgnKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3JlZHJhdzogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuX21hcmtlcigpO1xuICAgICAgICAgICAgdGhpcy5fdmFsdWUoKTtcbiAgICAgICAgICAgIHRoaXMuX2hpbnQoKTtcbiAgICAgICAgfSxcblxuICAgICAgICB2YWw6IGZ1bmN0aW9uKHZNaW4sIHZNYXgpe1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZSh2TWluKSAmJiAhVXRpbHMuaXNWYWx1ZSh2TWF4KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBbdGhpcy52YWx1ZU1pbiwgdGhpcy52YWx1ZU1heF07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh2TWluIDwgby5taW4pIHZNaW4gPSBvLm1pbjtcbiAgICAgICAgICAgIGlmICh2TWF4IDwgby5taW4pIHZNYXggPSBvLm1pbjtcblxuICAgICAgICAgICAgaWYgKHZNaW4gPiBvLm1heCkgdk1pbiA9IG8ubWF4O1xuICAgICAgICAgICAgaWYgKHZNYXggPiBvLm1heCkgdk1heCA9IG8ubWF4O1xuXG4gICAgICAgICAgICB0aGlzLnZhbHVlTWluID0gdGhpcy5fY29ycmVjdCh2TWluKTtcbiAgICAgICAgICAgIHRoaXMudmFsdWVNYXggPSB0aGlzLl9jb3JyZWN0KHZNYXgpO1xuXG4gICAgICAgICAgICB0aGlzLl9yZWRyYXcoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VWYWx1ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIHZhbE1pbiA9ICtlbGVtZW50LmF0dHIoXCJkYXRhLXZhbHVlLW1pblwiKTtcbiAgICAgICAgICAgIHZhciB2YWxNYXggPSArZWxlbWVudC5hdHRyKFwiZGF0YS12YWx1ZS1tYXhcIik7XG4gICAgICAgICAgICB0aGlzLnZhbCh2YWxNaW4sIHZhbE1heCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgZWxlbWVudC5kYXRhKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICBlbGVtZW50LnBhcmVudCgpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZW5hYmxlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICBlbGVtZW50LmRhdGEoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XG4gICAgICAgICAgICBlbGVtZW50LnBhcmVudCgpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlU3RhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiAodGhpcy5lbGVtLmRpc2FibGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgICAgIHN3aXRjaCAoYXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLXZhbHVlLW1pblwiOiB0aGlzLmNoYW5nZVZhbHVlKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLXZhbHVlLW1heFwiOiB0aGlzLmNoYW5nZVZhbHVlKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2Rpc2FibGVkJzogdGhpcy50b2dnbGVTdGF0ZSgpOyBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIHNsaWRlciA9IHRoaXMuc2xpZGVyO1xuICAgICAgICAgICAgdmFyIG1hcmtlciA9IHNsaWRlci5maW5kKFwiLm1hcmtlclwiKTtcblxuICAgICAgICAgICAgbWFya2VyLm9mZihNZXRyby5ldmVudHMuc3RhcnRBbGwpO1xuICAgICAgICAgICAgbWFya2VyLm9mZihNZXRyby5ldmVudHMuZm9jdXMpO1xuICAgICAgICAgICAgbWFya2VyLm9mZihNZXRyby5ldmVudHMuYmx1cik7XG4gICAgICAgICAgICBtYXJrZXIub2ZmKE1ldHJvLmV2ZW50cy5rZXlkb3duKTtcbiAgICAgICAgICAgIG1hcmtlci5vZmYoTWV0cm8uZXZlbnRzLmtleXVwKTtcbiAgICAgICAgICAgIHNsaWRlci5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrKTtcbiAgICAgICAgICAgICQod2luZG93KS5vZmYoTWV0cm8uZXZlbnRzLnJlc2l6ZSwge25zOiB0aGlzLmlkfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgRHJhZ0l0ZW1zRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgZHJhZ2l0ZW1zRGVmZXJyZWQ6IDAsXG4gICAgICAgIHRhcmdldDogbnVsbCxcbiAgICAgICAgZHJhZ0l0ZW06IFwibGlcIixcbiAgICAgICAgZHJhZ01hcmtlcjogXCIuZHJhZy1pdGVtLW1hcmtlclwiLFxuICAgICAgICBkcmF3RHJhZ01hcmtlcjogZmFsc2UsXG4gICAgICAgIGNsc0RyYWdJdGVtQXZhdGFyOiBcIlwiLFxuICAgICAgICBjbHNEcmFnSXRlbTogXCJcIixcbiAgICAgICAgY2FuRHJhZzogdHJ1ZSxcbiAgICAgICAgb25EcmFnU3RhcnRJdGVtOiBNZXRyby5ub29wLFxuICAgICAgICBvbkRyYWdNb3ZlSXRlbTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EcmFnRHJvcEl0ZW06IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uVGFyZ2V0OiBNZXRyby5ub29wLFxuICAgICAgICBvblRhcmdldEluOiBNZXRyby5ub29wLCAvL1RPRE9cbiAgICAgICAgb25UYXJnZXRPdXQ6IE1ldHJvLm5vb3AsIC8vVE9ET1xuICAgICAgICBvbkRyYWdJdGVtc0NyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5kcmFnSXRlbXNTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIERyYWdJdGVtc0RlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgRHJhZ0l0ZW1zRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9EcmFnSXRlbXNTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmRyYWdJdGVtc1NldHVwKHdpbmRvd1tcIm1ldHJvRHJhZ0l0ZW1zU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnZHJhZy1pdGVtcycsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBEcmFnSXRlbXNEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgaWQ6IFV0aWxzLmVsZW1lbnRJZChcImRyYWdJdGVtc1wiKSxcbiAgICAgICAgICAgICAgICBjYW5EcmFnOiBmYWxzZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiZHJhZy1pdGVtcy1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImRyYWctaXRlbXMtdGFyZ2V0XCIpO1xuXG4gICAgICAgICAgICBpZiAoby5kcmF3RHJhZ01hcmtlciA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZChvLmRyYWdJdGVtKS5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJkcmFnLWl0ZW0tbWFya2VyXCIpLmFwcGVuZFRvKHRoaXMpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG8uY2FuRHJhZyA/IHRoaXMub24oKSA6IHRoaXMub2ZmKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBkb2MgPSAkLmRvY3VtZW50KCksIGJvZHkgPSAkLmJvZHkoKTtcbiAgICAgICAgICAgIHZhciBvZmZzZXQsIHNoaWZ0ID0ge3RvcDogMCwgbGVmdDogMH0sIHdpZHRoLCBoZWlnaHQ7XG5cbiAgICAgICAgICAgIHZhciBtb3ZlID0gZnVuY3Rpb24oZSwgYXZhdGFyLCBkcmFnSXRlbSl7XG4gICAgICAgICAgICAgICAgdmFyIHggPSBVdGlscy5wYWdlWFkoZSkueCwgeSA9IFV0aWxzLnBhZ2VYWShlKS55O1xuICAgICAgICAgICAgICAgIHZhciBfdG9wID0geSAtIHNoaWZ0LnRvcDtcbiAgICAgICAgICAgICAgICB2YXIgX2xlZnQgPSB4IC0gc2hpZnQubGVmdDtcblxuICAgICAgICAgICAgICAgIGF2YXRhci5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB0b3A6IF90b3AsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IF9sZWZ0XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZG9jdW1lbnQuZWxlbWVudHNGcm9tUG9pbnQoeCwgeSkuZmlsdGVyKGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICQoZWwpLmhhc0NsYXNzKCdkcmFnLWl0ZW1zLXRhcmdldCcpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInRhcmdldFwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgc2libGluZyA9IGRvY3VtZW50LmVsZW1lbnRzRnJvbVBvaW50KHgsIHkpLmZpbHRlcihmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciAkZWwgPSAkKGVsKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICQubWF0Y2hlcyhlbCwgby5kcmFnSXRlbSkgJiYgISRlbC5oYXNDbGFzcyhcImRyYWdnZWQtaXRlbS1hdmF0YXJcIik7XG4gICAgICAgICAgICAgICAgfSlbMF07XG5cbiAgICAgICAgICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUoc2libGluZykpIHtcbiAgICAgICAgICAgICAgICAgICAgZHJhZ0l0ZW0uYXBwZW5kVG8odGFyZ2V0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgJHNpYmxpbmcgPSAkKHNpYmxpbmcpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgJHNpYmxpbmdfb2Zmc2V0ID0gJHNpYmxpbmcub2Zmc2V0KCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvZmZzZXRZID0geSAtICRzaWJsaW5nX29mZnNldC50b3A7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvZmZzZXRYID0geCAtICRzaWJsaW5nX29mZnNldC5sZWZ0O1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2lkZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRpbSA9IHt3OiAkc2libGluZy53aWR0aCgpLCBoOiAkc2libGluZy5oZWlnaHQoKX07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9mZnNldFggPCBkaW0udyAvIDMgJiYgKG9mZnNldFkgPCBkaW0uaCAvIDIgfHwgb2Zmc2V0WSA+IGRpbS5oIC8gMikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpZGUgPSAnbGVmdCc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2Zmc2V0WCA+IGRpbS53ICogMiAvIDMgJiYgKG9mZnNldFkgPCBkaW0uaCAvIDIgfHwgb2Zmc2V0WSA+IGRpbS5oIC8gMikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpZGUgPSAncmlnaHQnO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9mZnNldFggPiBkaW0udyAvIDMgJiYgb2Zmc2V0WCA8IGRpbS53ICogMiAvIDMgJiYgb2Zmc2V0WSA+IGRpbS5oIC8gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2lkZSA9ICdib3R0b20nO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2lkZSA9IFwidG9wXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoISRzaWJsaW5nLmhhc0NsYXNzKFwiZHJhZ2dlZC1pdGVtXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2lkZSA9PT0gXCJ0b3BcIiB8fCBzaWRlID09PSBcImxlZnRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdJdGVtLmluc2VydEJlZm9yZSgkc2libGluZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdJdGVtLmluc2VydEFmdGVyKCRzaWJsaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLnN0YXJ0QWxsLCAoby5kcmF3RHJhZ01hcmtlciA/IG8uZHJhZ01hcmtlciA6IG8uZHJhZ0l0ZW0pLCBmdW5jdGlvbihlX3N0YXJ0KXtcbiAgICAgICAgICAgICAgICB2YXIgZHJhZ0l0ZW0gPSAkKGVfc3RhcnQudGFyZ2V0KS5jbG9zZXN0KG8uZHJhZ0l0ZW0pO1xuICAgICAgICAgICAgICAgIHZhciBhdmF0YXI7XG5cbiAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNSaWdodE1vdXNlKGVfc3RhcnQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHRoYXQuY2FuRHJhZyAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGRyYWdJdGVtLmFkZENsYXNzKFwiZHJhZ2dlZC1pdGVtXCIpLmFkZENsYXNzKG8uY2xzRHJhZ0l0ZW0pO1xuICAgICAgICAgICAgICAgIGF2YXRhciA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImRyYWdnZWQtaXRlbS1hdmF0YXJcIikuYWRkQ2xhc3Moby5jbHNEcmFnSXRlbUF2YXRhcik7XG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gZHJhZ0l0ZW0ub2Zmc2V0KCk7XG4gICAgICAgICAgICAgICAgd2lkdGggPSBkcmFnSXRlbS53aWR0aCgpO1xuICAgICAgICAgICAgICAgIGhlaWdodCA9IGRyYWdJdGVtLmhlaWdodCgpO1xuICAgICAgICAgICAgICAgIHNoaWZ0LnRvcCA9IFV0aWxzLnBhZ2VYWShlX3N0YXJ0KS55IC0gb2Zmc2V0LnRvcDtcbiAgICAgICAgICAgICAgICBzaGlmdC5sZWZ0ID0gVXRpbHMucGFnZVhZKGVfc3RhcnQpLnggLSBvZmZzZXQubGVmdDtcblxuICAgICAgICAgICAgICAgIGF2YXRhci5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB0b3A6IG9mZnNldC50b3AsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IG9mZnNldC5sZWZ0LFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0XG4gICAgICAgICAgICAgICAgfSkuYXBwZW5kVG8oYm9keSk7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJkcmFnLXN0YXJ0LWl0ZW1cIiwge1xuICAgICAgICAgICAgICAgICAgICBkcmFnSXRlbTogZHJhZ0l0ZW1bMF0sXG4gICAgICAgICAgICAgICAgICAgIGF2YXRhcjogYXZhdGFyWzBdXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBkb2Mub24oTWV0cm8uZXZlbnRzLm1vdmVBbGwsIGZ1bmN0aW9uKGVfbW92ZSl7XG5cbiAgICAgICAgICAgICAgICAgICAgbW92ZShlX21vdmUsIGF2YXRhciwgZHJhZ0l0ZW0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImRyYWctbW92ZS1pdGVtXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdJdGVtOiBkcmFnSXRlbVswXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGF2YXRhcjogYXZhdGFyWzBdXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGVfbW92ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgfSwge25zOiB0aGF0LmlkLCBwYXNzaXZlOiBmYWxzZX0pO1xuXG4gICAgICAgICAgICAgICAgZG9jLm9uKE1ldHJvLmV2ZW50cy5zdG9wQWxsLCBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImRyYWctZHJvcC1pdGVtXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdJdGVtOiBkcmFnSXRlbVswXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGF2YXRhcjogYXZhdGFyWzBdXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGRyYWdJdGVtLnJlbW92ZUNsYXNzKFwiZHJhZ2dlZC1pdGVtXCIpLnJlbW92ZUNsYXNzKG8uY2xzRHJhZ0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBhdmF0YXIucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgZG9jLm9mZihNZXRyby5ldmVudHMubW92ZUFsbCwge25zOiB0aGF0LmlkfSk7XG4gICAgICAgICAgICAgICAgICAgIGRvYy5vZmYoTWV0cm8uZXZlbnRzLnN0b3BBbGwsIHtuczogdGhhdC5pZH0pO1xuXG4gICAgICAgICAgICAgICAgfSwge25zOiB0aGF0LmlkfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoby5kcmF3RHJhZ01hcmtlcikge1xuICAgICAgICAgICAgICAgICAgICBlX3N0YXJ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGVfc3RhcnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb246IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmNhbkRyYWcgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQoXCIuZHJhZy1pdGVtLW1hcmtlclwiKS5zaG93KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb2ZmOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5jYW5EcmFnID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZmluZChcIi5kcmFnLWl0ZW0tbWFya2VyXCIpLmhpZGUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmNhbkRyYWcgPSB0aGlzLmNhbkRyYWcgPyB0aGlzLm9mZigpIDogdGhpcy5vbigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY2hhbmdlQ2FuRHJhZyA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgby5jYW5EdGFnID0gSlNPTi5wYXJzZShlbGVtZW50LmF0dHIoXCJkYXRhLWNhbi1kcmFnXCIpKTtcbiAgICAgICAgICAgICAgICBvLmNhbkR0YWcgPyB0aGF0Lm9uKCkgOiB0aGF0Lm9mZigpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZU5hbWUgPT09IFwiZGF0YS1jYW4tZHJhZ1wiKSB7XG4gICAgICAgICAgICAgICAgY2hhbmdlQ2FuRHJhZygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5zdGFydEFsbCwgKG8uZHJhd0RyYWdNYXJrZXIgPyBvLmRyYWdNYXJrZXIgOiBvLmRyYWdJdGVtKSk7XG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIERyYWdnYWJsZURlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGRyYWdDb250ZXh0OiBudWxsLFxuICAgICAgICBkcmFnZ2FibGVEZWZlcnJlZDogMCxcbiAgICAgICAgZHJhZ0VsZW1lbnQ6ICdzZWxmJyxcbiAgICAgICAgZHJhZ0FyZWE6IFwicGFyZW50XCIsXG4gICAgICAgIHRpbWVvdXQ6IDAsXG4gICAgICAgIGJvdW5kYXJ5UmVzdHJpY3Rpb246IHRydWUsXG4gICAgICAgIG9uQ2FuRHJhZzogTWV0cm8ubm9vcF90cnVlLFxuICAgICAgICBvbkRyYWdTdGFydDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EcmFnU3RvcDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EcmFnTW92ZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EcmFnZ2FibGVDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uZHJhZ2dhYmxlU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBEcmFnZ2FibGVEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIERyYWdnYWJsZURlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvRHJhZ2dhYmxlU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5kcmFnZ2FibGVTZXR1cCh3aW5kb3dbXCJtZXRyb0RyYWdnYWJsZVNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ2RyYWdnYWJsZScsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBEcmFnZ2FibGVEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgZHJhZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgbW92ZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgYmFja3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnNvcjogJ2RlZmF1bHQnLFxuICAgICAgICAgICAgICAgICAgICB6SW5kZXg6ICcwJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZHJhZ0FyZWE6IG51bGwsXG4gICAgICAgICAgICAgICAgZHJhZ0VsZW1lbnQ6IG51bGwsXG4gICAgICAgICAgICAgICAgaWQ6IFV0aWxzLmVsZW1lbnRJZChcImRyYWdnYWJsZVwiKVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJkcmFnZ2FibGUtY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgb2Zmc2V0ID0gZWxlbWVudC5vZmZzZXQoKTtcbiAgICAgICAgICAgIHZhciBkcmFnRWxlbWVudCAgPSBvLmRyYWdFbGVtZW50ICE9PSAnc2VsZicgPyBlbGVtZW50LmZpbmQoby5kcmFnRWxlbWVudCkgOiBlbGVtZW50O1xuXG4gICAgICAgICAgICBlbGVtZW50LmRhdGEoXCJjYW5EcmFnXCIsIHRydWUpO1xuXG4gICAgICAgICAgICB0aGlzLmRyYWdFbGVtZW50ID0gZHJhZ0VsZW1lbnQ7XG5cbiAgICAgICAgICAgIGRyYWdFbGVtZW50WzBdLm9uZHJhZ3N0YXJ0ID0gZnVuY3Rpb24oKXtyZXR1cm4gZmFsc2U7fTtcblxuICAgICAgICAgICAgZWxlbWVudC5jc3MoXCJwb3NpdGlvblwiLCBcImFic29sdXRlXCIpO1xuXG4gICAgICAgICAgICBpZiAoby5kcmFnQXJlYSA9PT0gJ2RvY3VtZW50JyB8fCBvLmRyYWdBcmVhID09PSAnd2luZG93Jykge1xuICAgICAgICAgICAgICAgIG8uZHJhZ0FyZWEgPSBcImJvZHlcIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2V0SW1tZWRpYXRlKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5kcmFnQXJlYSA9IG8uZHJhZ0FyZWEgPT09ICdwYXJlbnQnID8gZWxlbWVudC5wYXJlbnQoKSA6ICQoby5kcmFnQXJlYSk7XG4gICAgICAgICAgICAgICAgaWYgKG8uZHJhZ0FyZWEgIT09ICdwYXJlbnQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kVG8odGhhdC5kcmFnQXJlYSk7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogb2Zmc2V0LnRvcCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IG9mZnNldC5sZWZ0XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIWVsZW1lbnQuYXR0cihcImlkXCIpKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwiaWRcIiwgVXRpbHMuZWxlbWVudElkKFwiZHJhZ2dhYmxlXCIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0ge1xuICAgICAgICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgICAgICAgeTogMFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy5kcmFnRWxlbWVudC5vbihNZXRyby5ldmVudHMuc3RhcnRBbGwsIGZ1bmN0aW9uKGUpe1xuXG4gICAgICAgICAgICAgICAgdmFyIGNvb3JkID0gby5kcmFnQXJlYSAhPT0gXCJwYXJlbnRcIiA/IGVsZW1lbnQub2Zmc2V0KCkgOiBlbGVtZW50LnBvc2l0aW9uKCksXG4gICAgICAgICAgICAgICAgICAgIHNoaWZ0WCA9IFV0aWxzLnBhZ2VYWShlKS54IC0gY29vcmQubGVmdCxcbiAgICAgICAgICAgICAgICAgICAgc2hpZnRZID0gVXRpbHMucGFnZVhZKGUpLnkgLSBjb29yZC50b3A7XG5cbiAgICAgICAgICAgICAgICB2YXIgbW92ZUVsZW1lbnQgPSBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvcCA9IFV0aWxzLnBhZ2VYWShlKS55IC0gc2hpZnRZO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGVmdCA9IFV0aWxzLnBhZ2VYWShlKS54IC0gc2hpZnRYO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChvLmJvdW5kYXJ5UmVzdHJpY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b3AgPCAwKSB0b3AgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxlZnQgPCAwKSBsZWZ0ID0gMDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvcCA+IHRoYXQuZHJhZ0FyZWEub3V0ZXJIZWlnaHQoKSAtIGVsZW1lbnQub3V0ZXJIZWlnaHQoKSkgdG9wID0gdGhhdC5kcmFnQXJlYS5vdXRlckhlaWdodCgpIC0gZWxlbWVudC5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxlZnQgPiB0aGF0LmRyYWdBcmVhLm91dGVyV2lkdGgoKSAtIGVsZW1lbnQub3V0ZXJXaWR0aCgpKSBsZWZ0ID0gdGhhdC5kcmFnQXJlYS5vdXRlcldpZHRoKCkgLSBlbGVtZW50Lm91dGVyV2lkdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uLnkgPSB0b3A7XG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uLnggPSBsZWZ0O1xuXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGxlZnQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3A6IHRvcFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5kYXRhKFwiY2FuRHJhZ1wiKSA9PT0gZmFsc2UgfHwgVXRpbHMuZXhlYyhvLm9uQ2FuRHJhZywgW2VsZW1lbnRdKSAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChNZXRyby5pc1RvdWNoYWJsZSA9PT0gZmFsc2UgJiYgZS53aGljaCAhPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoYXQuZHJhZyA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICB0aGF0LmJhY2t1cC5jdXJzb3IgPSBlbGVtZW50LmNzcyhcImN1cnNvclwiKTtcbiAgICAgICAgICAgICAgICB0aGF0LmJhY2t1cC56SW5kZXggPSBlbGVtZW50LmNzcyhcInotaW5kZXhcIik7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwiZHJhZ2dhYmxlXCIpO1xuXG4gICAgICAgICAgICAgICAgbW92ZUVsZW1lbnQoZSk7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJkcmFnLXN0YXJ0XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiBvLmRyYWdDb250ZXh0XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vbihNZXRyby5ldmVudHMubW92ZUFsbCwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgbW92ZUVsZW1lbnQoZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZHJhZy1tb3ZlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6IG8uZHJhZ0NvbnRleHRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9LCB7bnM6IHRoYXQuaWQsIHBhc3NpdmU6IGZhbHNlfSk7XG5cbiAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vbihNZXRyby5ldmVudHMuc3RvcEFsbCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAvLyAgICAgY3Vyc29yOiB0aGF0LmJhY2t1cC5jdXJzb3IsXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICB6SW5kZXg6IHRoYXQuYmFja3VwLnpJbmRleFxuICAgICAgICAgICAgICAgICAgICAvLyB9KTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcyhcImRyYWdnYWJsZVwiKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5kcmFnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vZmYoTWV0cm8uZXZlbnRzLm1vdmVBbGwsIHtuczogdGhhdC5pZH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudCkub2ZmKE1ldHJvLmV2ZW50cy5zdG9wQWxsLCB7bnM6IHRoYXQuaWR9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuZHJhZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lm1vdmUgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJkcmFnLXN0b3BcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dDogby5kcmFnQ29udGV4dFxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH0sIHtuczogdGhhdC5pZH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb2ZmOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmRhdGEoXCJjYW5EcmFnXCIsIGZhbHNlKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwiY2FuRHJhZ1wiLCB0cnVlKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgKi9cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lLCBuZXdWYWx1ZSl7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdGhpcy5kcmFnRWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLnN0YXJ0QWxsKTtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgRHJvcGRvd25EZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBkcm9wZG93bkRlZmVycmVkOiAwLFxuICAgICAgICBkcm9wRmlsdGVyOiBudWxsLFxuICAgICAgICB0b2dnbGVFbGVtZW50OiBudWxsLFxuICAgICAgICBub0Nsb3NlOiBmYWxzZSxcbiAgICAgICAgZHVyYXRpb246IDUwLFxuICAgICAgICBjaGVja0Ryb3BVcDogZmFsc2UsXG4gICAgICAgIGRyb3BVcDogZmFsc2UsXG4gICAgICAgIG9uRHJvcDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25VcDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Ecm9wZG93bkNyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5kcm9wZG93blNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgRHJvcGRvd25EZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIERyb3Bkb3duRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9Ecm9wZG93blNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8uZHJvcGRvd25TZXR1cCh3aW5kb3dbXCJtZXRyb0Ryb3Bkb3duU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnZHJvcGRvd24nLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgRHJvcGRvd25EZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgX3RvZ2dsZTogbnVsbCxcbiAgICAgICAgICAgICAgICBkaXNwbGF5T3JpZ2luOiBudWxsLFxuICAgICAgICAgICAgICAgIGlzT3BlbjogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJkcm9wZG93bi1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5oYXNDbGFzcyhcIm9wZW5cIikpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKFwib3BlblwiKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQub3Blbih0cnVlKTtcbiAgICAgICAgICAgICAgICB9LDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciB0b2dnbGU7XG5cbiAgICAgICAgICAgIGlmIChvLmRyb3BVcCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJkcm9wLXVwXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0b2dnbGUgPSBvLnRvZ2dsZUVsZW1lbnQgIT09IG51bGwgPyAkKG8udG9nZ2xlRWxlbWVudCkgOiBlbGVtZW50LnNpYmxpbmdzKCcuZHJvcGRvd24tdG9nZ2xlJykubGVuZ3RoID4gMCA/IGVsZW1lbnQuc2libGluZ3MoJy5kcm9wZG93bi10b2dnbGUnKSA6IGVsZW1lbnQucHJldigpO1xuXG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlPcmlnaW4gPSBVdGlscy5nZXRTdHlsZU9uZShlbGVtZW50LCBcImRpc3BsYXlcIik7XG5cbiAgICAgICAgICAgIGlmIChlbGVtZW50Lmhhc0NsYXNzKFwidi1tZW51XCIpKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImZvci1kcm9wZG93blwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcblxuICAgICAgICAgICAgdGhpcy5fdG9nZ2xlID0gdG9nZ2xlO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgdG9nZ2xlID0gdGhpcy5fdG9nZ2xlLCBwYXJlbnQgPSBlbGVtZW50LnBhcmVudCgpO1xuXG4gICAgICAgICAgICB0b2dnbGUub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICBwYXJlbnQuc2libGluZ3MocGFyZW50WzBdLnRhZ05hbWUpLnJlbW92ZUNsYXNzKFwiYWN0aXZlLWNvbnRhaW5lclwiKTtcbiAgICAgICAgICAgICAgICAkKFwiLmFjdGl2ZS1jb250YWluZXJcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmUtY29udGFpbmVyXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuY3NzKCdkaXNwbGF5JykgIT09ICdub25lJyAmJiAhZWxlbWVudC5oYXNDbGFzcygna2VlcC1vcGVuJykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fY2xvc2UoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnW2RhdGEtcm9sZSo9ZHJvcGRvd25dJykuZWFjaChmdW5jdGlvbihpLCBlbCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVsZW1lbnQucGFyZW50cygnW2RhdGEtcm9sZSo9ZHJvcGRvd25dJykuaXMoZWwpICYmICEkKGVsKS5oYXNDbGFzcygna2VlcC1vcGVuJykgJiYgJChlbCkuY3NzKCdkaXNwbGF5JykgIT09ICdub25lJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZShvLmRyb3BGaWx0ZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2Nsb3NlKGVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJChlbCkuY2xvc2VzdChvLmRyb3BGaWx0ZXIpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2Nsb3NlKGVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50Lmhhc0NsYXNzKCdob3Jpem9udGFsJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmlzaWJpbGl0eSc6ICdoaWRkZW4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5JzogJ2Jsb2NrJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGRyZW5fd2lkdGggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGVsZW1lbnQuY2hpbGRyZW4oJ2xpJyksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW5fd2lkdGggKz0gJCh0aGlzKS5vdXRlcldpZHRoKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmlzaWJpbGl0eSc6ICd2aXNpYmxlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzcGxheSc6ICdub25lJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmNzcygnd2lkdGgnLCBjaGlsZHJlbl93aWR0aCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fb3BlbihlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50LmFkZENsYXNzKFwiYWN0aXZlLWNvbnRhaW5lclwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKG8ubm9DbG9zZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJrZWVwLW9wZW5cIikub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAvL2UucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJChlbGVtZW50KS5maW5kKCdsaS5kaXNhYmxlZCBhJykub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY2xvc2U6IGZ1bmN0aW9uKGVsLCBpbW1lZGlhdGUpe1xuICAgICAgICAgICAgZWwgPSAkKGVsKTtcblxuICAgICAgICAgICAgdmFyIGRyb3Bkb3duICA9IE1ldHJvLmdldFBsdWdpbihlbCwgXCJkcm9wZG93blwiKTtcbiAgICAgICAgICAgIHZhciB0b2dnbGUgPSBkcm9wZG93bi5fdG9nZ2xlO1xuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBkcm9wZG93bi5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGZ1bmMgPSBcInNsaWRlVXBcIjtcblxuICAgICAgICAgICAgdG9nZ2xlLnJlbW92ZUNsYXNzKCdhY3RpdmUtdG9nZ2xlJykucmVtb3ZlQ2xhc3MoXCJhY3RpdmUtY29udHJvbFwiKTtcbiAgICAgICAgICAgIGRyb3Bkb3duLmVsZW1lbnQucGFyZW50KCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmUtY29udGFpbmVyXCIpO1xuXG4gICAgICAgICAgICBpZiAoaW1tZWRpYXRlKSB7XG4gICAgICAgICAgICAgICAgZnVuYyA9ICdoaWRlJ1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbFtmdW5jXShpbW1lZGlhdGUgPyAwIDogb3B0aW9ucy5kdXJhdGlvbiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5fZmlyZUV2ZW50KFwiY2xvc2VcIik7XG4gICAgICAgICAgICAgICAgZHJvcGRvd24uX2ZpcmVFdmVudChcInVwXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLmRyb3BVcCAmJiBvcHRpb25zLmNoZWNrRHJvcFVwKSB7XG4gICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJkcm9wLXVwXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIFRPRE8gQWRkIGNvbnRyb2w6IGlmIG5vIHNwYWNlIGZvciBkcm9wLWRvd24gYW5kIG5vIHNwYWNlIGZvciBkcm9wLXVwLCBlbGVtZW50IHdpbGwgbXVzdCBkcm9wLWRvd25cbiAgICAgICAgX29wZW46IGZ1bmN0aW9uKGVsLCBpbW1lZGlhdGUpe1xuICAgICAgICAgICAgZWwgPSAkKGVsKTtcblxuICAgICAgICAgICAgdmFyIGRyb3Bkb3duICA9IE1ldHJvLmdldFBsdWdpbihlbCwgXCJkcm9wZG93blwiKTtcbiAgICAgICAgICAgIHZhciB0b2dnbGUgPSBkcm9wZG93bi5fdG9nZ2xlO1xuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBkcm9wZG93bi5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGZ1bmMgPSBcInNsaWRlRG93blwiO1xuXG4gICAgICAgICAgICB0b2dnbGUuYWRkQ2xhc3MoJ2FjdGl2ZS10b2dnbGUnKS5hZGRDbGFzcyhcImFjdGl2ZS1jb250cm9sXCIpO1xuXG4gICAgICAgICAgICBlbFtmdW5jXShpbW1lZGlhdGUgPyAwIDogb3B0aW9ucy5kdXJhdGlvbiwgZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5kcm9wVXAgJiYgb3B0aW9ucy5jaGVja0Ryb3BVcCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBkcm9wZG93bi5lbGVtZW50LnJlbW92ZUNsYXNzKFwiZHJvcC11cFwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFVdGlscy5pblZpZXdwb3J0KGRyb3Bkb3duLmVsZW1lbnRbMF0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkcm9wZG93bi5lbGVtZW50LmFkZENsYXNzKFwiZHJvcC11cFwiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFVdGlscy5pblZpZXdwb3J0KGRyb3Bkb3duLmVsZW1lbnRbMF0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJvcGRvd24uZWxlbWVudC5yZW1vdmVDbGFzcyhcImRyb3AtdXBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBkcm9wZG93bi5fZmlyZUV2ZW50KFwib3BlblwiKTtcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5fZmlyZUV2ZW50KFwiZHJvcFwiKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyB0aGlzLl9maXJlRXZlbnQoXCJkcm9wXCIpO1xuXG4gICAgICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKGltbWVkaWF0ZSl7XG4gICAgICAgICAgICB0aGlzLl9jbG9zZSh0aGlzLmVsZW1lbnQsIGltbWVkaWF0ZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb3BlbjogZnVuY3Rpb24oaW1tZWRpYXRlKXtcbiAgICAgICAgICAgIHRoaXMuX29wZW4odGhpcy5lbGVtZW50LCBpbW1lZGlhdGUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzT3BlbilcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lICovXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5fdG9nZ2xlLm9mZihNZXRyby5ldmVudHMuY2xpY2spO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAkKGRvY3VtZW50KS5vbihNZXRyby5ldmVudHMuY2xpY2ssIGZ1bmN0aW9uKCl7XG4gICAgICAgICQoJ1tkYXRhLXJvbGUqPWRyb3Bkb3duXScpLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbCA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgIGlmIChlbC5jc3MoJ2Rpc3BsYXknKSE9PSdub25lJyAmJiAhZWwuaGFzQ2xhc3MoJ2tlZXAtb3BlbicpICYmICFlbC5oYXNDbGFzcygnc3RheS1vcGVuJykgJiYgIWVsLmhhc0NsYXNzKCdpZ25vcmUtZG9jdW1lbnQtY2xpY2snKSkge1xuICAgICAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbihlbCwgJ2Ryb3Bkb3duJykuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbiAoTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIEV4cG9ydCA9IHtcblxuICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICBjc3ZEZWxpbWl0ZXI6IFwiXFx0XCIsXG4gICAgICAgICAgICBjc3ZOZXdMaW5lOiBcIlxcclxcblwiLFxuICAgICAgICAgICAgaW5jbHVkZUhlYWRlcjogdHJ1ZVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldHVwOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBiYXNlNjQ6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICByZXR1cm4gd2luZG93LmJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KGRhdGEpKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYjY0dG9CbG9iOiBmdW5jdGlvbiAoYjY0RGF0YSwgY29udGVudFR5cGUsIHNsaWNlU2l6ZSkge1xuICAgICAgICAgICAgY29udGVudFR5cGUgPSBjb250ZW50VHlwZSB8fCAnJztcbiAgICAgICAgICAgIHNsaWNlU2l6ZSA9IHNsaWNlU2l6ZSB8fCA1MTI7XG5cbiAgICAgICAgICAgIHZhciBieXRlQ2hhcmFjdGVycyA9IHdpbmRvdy5hdG9iKGI2NERhdGEpO1xuICAgICAgICAgICAgdmFyIGJ5dGVBcnJheXMgPSBbXTtcblxuICAgICAgICAgICAgdmFyIG9mZnNldDtcbiAgICAgICAgICAgIGZvciAob2Zmc2V0ID0gMDsgb2Zmc2V0IDwgYnl0ZUNoYXJhY3RlcnMubGVuZ3RoOyBvZmZzZXQgKz0gc2xpY2VTaXplKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNsaWNlID0gYnl0ZUNoYXJhY3RlcnMuc2xpY2Uob2Zmc2V0LCBvZmZzZXQgKyBzbGljZVNpemUpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGJ5dGVOdW1iZXJzID0gbmV3IEFycmF5KHNsaWNlLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgdmFyIGk7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNsaWNlLmxlbmd0aDsgaSA9IGkgKyAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ5dGVOdW1iZXJzW2ldID0gc2xpY2UuY2hhckNvZGVBdChpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgYnl0ZUFycmF5ID0gbmV3IHdpbmRvdy5VaW50OEFycmF5KGJ5dGVOdW1iZXJzKTtcblxuICAgICAgICAgICAgICAgIGJ5dGVBcnJheXMucHVzaChieXRlQXJyYXkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gbmV3IEJsb2IoYnl0ZUFycmF5cywge1xuICAgICAgICAgICAgICAgIHR5cGU6IGNvbnRlbnRUeXBlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICB0YWJsZVRvQ1NWOiBmdW5jdGlvbiAodGFibGUsIGZpbGVuYW1lLCBvcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIgbztcbiAgICAgICAgICAgIHZhciBib2R5LCBoZWFkLCBkYXRhID0gXCJcIjtcbiAgICAgICAgICAgIHZhciBpLCBqLCByb3csIGNlbGw7XG5cbiAgICAgICAgICAgIG8gPSAkLmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKTtcblxuICAgICAgICAgICAgdGFibGUgPSAkKHRhYmxlKVswXTtcblxuICAgICAgICAgICAgaWYgKFV0aWxzLmJvb2woby5pbmNsdWRlSGVhZGVyKSkge1xuXG4gICAgICAgICAgICAgICAgaGVhZCA9IHRhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoXCJ0aGVhZFwiKVswXTtcblxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBoZWFkLnJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgcm93ID0gaGVhZC5yb3dzW2ldO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgcm93LmNlbGxzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsID0gcm93LmNlbGxzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSArPSAoaiA/IG8uY3N2RGVsaW1pdGVyIDogJycpICsgY2VsbC50ZXh0Q29udGVudC50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZGF0YSArPSBvLmNzdk5ld0xpbmU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBib2R5ID0gdGFibGUucXVlcnlTZWxlY3RvckFsbChcInRib2R5XCIpWzBdO1xuXG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYm9keS5yb3dzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgcm93ID0gYm9keS5yb3dzW2ldO1xuICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCByb3cuY2VsbHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbCA9IHJvdy5jZWxsc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSArPSAoaiA/IG8uY3N2RGVsaW1pdGVyIDogJycpICsgY2VsbC50ZXh0Q29udGVudC50cmltKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRhdGEgKz0gby5jc3ZOZXdMaW5lO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShmaWxlbmFtZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVEb3dubG9hZCh0aGlzLmJhc2U2NChcIlxcdUZFRkZcIiArIGRhdGEpLCAnYXBwbGljYXRpb24vY3N2JywgZmlsZW5hbWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgfSxcblxuICAgICAgICBjcmVhdGVEb3dubG9hZDogZnVuY3Rpb24gKGRhdGEsIGNvbnRlbnRUeXBlLCBmaWxlbmFtZSkge1xuICAgICAgICAgICAgdmFyIGJsb2IsIGFuY2hvciwgdXJsO1xuXG4gICAgICAgICAgICBhbmNob3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgICAgICAgICBhbmNob3Iuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhbmNob3IpO1xuXG4gICAgICAgICAgICBibG9iID0gdGhpcy5iNjR0b0Jsb2IoZGF0YSwgY29udGVudFR5cGUpO1xuXG4gICAgICAgICAgICB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgICAgICAgIGFuY2hvci5ocmVmID0gdXJsO1xuICAgICAgICAgICAgYW5jaG9yLmRvd25sb2FkID0gZmlsZW5hbWUgfHwgVXRpbHMuZWxlbWVudElkKFwiZG93bmxvYWRcIik7XG4gICAgICAgICAgICBhbmNob3IuY2xpY2soKTtcbiAgICAgICAgICAgIHdpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGFuY2hvcik7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSxcblxuICAgICAgICBhcnJheVRvQ3N2OiBmdW5jdGlvbihhcnJheSwgZmlsZW5hbWUsIG9wdGlvbnMpe1xuICAgICAgICAgICAgdmFyIG8sIGRhdGEgPSBcIlwiLCBpLCByb3c7XG5cbiAgICAgICAgICAgIG8gPSAkLmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKTtcblxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgcm93ID0gYXJyYXlbaV07XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJvdyAhPT0gXCJvYmplY3RcIikge1xuICAgICAgICAgICAgICAgICAgICBkYXRhICs9IHJvdyArIG8uY3N2TmV3TGluZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkLmVhY2gocm93LCBmdW5jdGlvbihrZXksIHZhbCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhICs9IChrZXkgPyBvLmNzdkRlbGltaXRlciA6ICcnKSArIHZhbC50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSArPSBvLmNzdk5ld0xpbmU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShmaWxlbmFtZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVEb3dubG9hZCh0aGlzLmJhc2U2NChcIlxcdUZFRkZcIiArIGRhdGEpLCAnYXBwbGljYXRpb24vY3N2JywgZmlsZW5hbWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBNZXRyby5leHBvcnQgPSBFeHBvcnQuaW5pdCgpO1xuXG4gICAgaWYgKHdpbmRvdy5NRVRST19HTE9CQUxfQ09NTU9OID09PSB0cnVlKSB7XG4gICAgICAgIHdpbmRvdy5FeHBvcnQgPSBNZXRyby5leHBvcnQ7XG4gICAgfVxufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIEZpbGVEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBmaWxlRGVmZXJyZWQ6IDAsXG4gICAgICAgIGxhYmVsOiBcIlwiLFxuICAgICAgICBtb2RlOiBcImlucHV0XCIsXG4gICAgICAgIGJ1dHRvblRpdGxlOiBcIkNob29zZSBmaWxlKHMpXCIsXG4gICAgICAgIGZpbGVzVGl0bGU6IFwiZmlsZShzKSBzZWxlY3RlZFwiLFxuICAgICAgICBkcm9wVGl0bGU6IFwiPHN0cm9uZz5DaG9vc2UgYSBmaWxlKHMpPC9zdHJvbmc+IG9yIGRyb3AgaXQgaGVyZVwiLFxuICAgICAgICBkcm9wSWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLXVwbG9hZCc+PC9zcGFuPlwiLFxuICAgICAgICBwcmVwZW5kOiBcIlwiLFxuICAgICAgICBjbHNDb21wb25lbnQ6IFwiXCIsXG4gICAgICAgIGNsc1ByZXBlbmQ6IFwiXCIsXG4gICAgICAgIGNsc0J1dHRvbjogXCJcIixcbiAgICAgICAgY2xzQ2FwdGlvbjogXCJcIixcbiAgICAgICAgY2xzTGFiZWw6IFwiXCIsXG4gICAgICAgIGNvcHlJbmxpbmVTdHlsZXM6IGZhbHNlLFxuICAgICAgICBvblNlbGVjdDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25GaWxlQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmZpbGVTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIEZpbGVEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIEZpbGVEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0ZpbGVTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmZpbGVTZXR1cCh3aW5kb3dbXCJtZXRyb0ZpbGVTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdmaWxlJywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIEZpbGVEZWZhdWx0Q29uZmlnKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJmaWxlLWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVN0cnVjdHVyZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9ICQoXCI8bGFiZWw+XCIpLmFkZENsYXNzKChvLm1vZGUgPT09IFwiaW5wdXRcIiA/IFwiIGZpbGUgXCIgOiBvLm1vZGUgPT09IFwiYnV0dG9uXCIgPyBcIiBmaWxlLWJ1dHRvbiBcIiA6IFwiIGRyb3Atem9uZSBcIikgKyBlbGVtZW50WzBdLmNsYXNzTmFtZSkuYWRkQ2xhc3Moby5jbHNDb21wb25lbnQpO1xuICAgICAgICAgICAgdmFyIGNhcHRpb24gPSAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwiY2FwdGlvblwiKS5hZGRDbGFzcyhvLmNsc0NhcHRpb24pO1xuICAgICAgICAgICAgdmFyIGZpbGVzID0gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcImZpbGVzXCIpLmFkZENsYXNzKG8uY2xzQ2FwdGlvbik7XG4gICAgICAgICAgICB2YXIgaWNvbiwgYnV0dG9uO1xuXG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5pbnNlcnRCZWZvcmUoZWxlbWVudCk7XG4gICAgICAgICAgICBlbGVtZW50LmFwcGVuZFRvKGNvbnRhaW5lcik7XG5cbiAgICAgICAgICAgIGlmIChvLm1vZGUgPT09ICdkcm9wJyB8fCBvLm1vZGUgPT09ICdkcm9wem9uZScpIHtcbiAgICAgICAgICAgICAgICBpY29uID0gJChvLmRyb3BJY29uKS5hZGRDbGFzcyhcImljb25cIikuYXBwZW5kVG8oY29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICBjYXB0aW9uLmh0bWwoby5kcm9wVGl0bGUpLmluc2VydEFmdGVyKGljb24pO1xuICAgICAgICAgICAgICAgIGZpbGVzLmh0bWwoXCIwXCIgKyBcIiBcIiArIG8uZmlsZXNUaXRsZSkuaW5zZXJ0QWZ0ZXIoY2FwdGlvbik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG8ubW9kZSA9PT0gJ2J1dHRvbicpIHtcblxuICAgICAgICAgICAgICAgIGJ1dHRvbiA9ICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJidXR0b25cIikuYXR0cihcInRhYmluZGV4XCIsIC0xKS5odG1sKG8uYnV0dG9uVGl0bGUpO1xuICAgICAgICAgICAgICAgIGJ1dHRvbi5hcHBlbmRUbyhjb250YWluZXIpO1xuICAgICAgICAgICAgICAgIGJ1dHRvbi5hZGRDbGFzcyhvLmNsc0J1dHRvbik7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY2FwdGlvbi5pbnNlcnRCZWZvcmUoZWxlbWVudCk7XG5cbiAgICAgICAgICAgICAgICBidXR0b24gPSAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwiYnV0dG9uXCIpLmF0dHIoXCJ0YWJpbmRleFwiLCAtMSkuaHRtbChvLmJ1dHRvblRpdGxlKTtcbiAgICAgICAgICAgICAgICBidXR0b24uYXBwZW5kVG8oY29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICBidXR0b24uYWRkQ2xhc3Moby5jbHNCdXR0b24pO1xuXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuYXR0cignZGlyJykgPT09ICdydGwnICkge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJydGxcIik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG8ucHJlcGVuZCAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcHJlcGVuZCA9ICQoXCI8ZGl2PlwiKS5odG1sKG8ucHJlcGVuZCk7XG4gICAgICAgICAgICAgICAgICAgIHByZXBlbmQuYWRkQ2xhc3MoXCJwcmVwZW5kXCIpLmFkZENsYXNzKG8uY2xzUHJlcGVuZCkuYXBwZW5kVG8oY29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnRbMF0uY2xhc3NOYW1lID0gJyc7XG5cbiAgICAgICAgICAgIGlmIChvLmNvcHlJbmxpbmVTdHlsZXMgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGVsZW1lbnRbMF0uc3R5bGUubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jc3MoZWxlbWVudFswXS5zdHlsZVtpXSwgZWxlbWVudC5jc3MoZWxlbWVudFswXS5zdHlsZVtpXSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8ubGFiZWwpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGFiZWwgPSAkKFwiPGxhYmVsPlwiKS5hZGRDbGFzcyhcImxhYmVsLWZvci1pbnB1dFwiKS5hZGRDbGFzcyhvLmNsc0xhYmVsKS5odG1sKG8ubGFiZWwpLmluc2VydEJlZm9yZShjb250YWluZXIpO1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmF0dHIoXCJpZFwiKSkge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbC5hdHRyKFwiZm9yXCIsIGVsZW1lbnQuYXR0cihcImlkXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuYXR0cihcImRpclwiKSA9PT0gXCJydGxcIikge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbC5hZGRDbGFzcyhcInJ0bFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChlbGVtZW50LmlzKFwiOmRpc2FibGVkXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBlbGVtZW50LmNsb3Nlc3QoXCJsYWJlbFwiKTtcbiAgICAgICAgICAgIHZhciBjYXB0aW9uID0gY29udGFpbmVyLmZpbmQoXCIuY2FwdGlvblwiKTtcbiAgICAgICAgICAgIHZhciBmaWxlcyA9IGNvbnRhaW5lci5maW5kKFwiLmZpbGVzXCIpO1xuICAgICAgICAgICAgdmFyIGZvcm0gPSBlbGVtZW50LmNsb3Nlc3QoXCJmb3JtXCIpO1xuXG4gICAgICAgICAgICBpZiAoZm9ybS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBmb3JtLm9uKFwicmVzZXRcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5jbGVhcigpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiYnV0dG9uXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgZWxlbWVudFswXS5jbGljaygpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNoYW5nZSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgZmkgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHZhciBmaWxlX25hbWVzID0gW107XG4gICAgICAgICAgICAgICAgdmFyIGVudHJ5O1xuXG4gICAgICAgICAgICAgICAgLy8gaWYgKGZpLmZpbGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIC8vIH1cblxuICAgICAgICAgICAgICAgIEFycmF5LmZyb20oZmkuZmlsZXMpLmZvckVhY2goZnVuY3Rpb24oZmlsZSl7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVfbmFtZXMucHVzaChmaWxlLm5hbWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKG8ubW9kZSA9PT0gXCJpbnB1dFwiKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgZW50cnkgPSBmaWxlX25hbWVzLmpvaW4oXCIsIFwiKTtcblxuICAgICAgICAgICAgICAgICAgICBjYXB0aW9uLmh0bWwoZW50cnkpO1xuICAgICAgICAgICAgICAgICAgICBjYXB0aW9uLmF0dHIoJ3RpdGxlJywgZW50cnkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVzLmh0bWwoZWxlbWVudFswXS5maWxlcy5sZW5ndGggKyBcIiBcIiArby5maWxlc1RpdGxlKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJzZWxlY3RcIiwge1xuICAgICAgICAgICAgICAgICAgICBmaWxlczogZmkuZmlsZXNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5mb2N1cywgZnVuY3Rpb24oKXtjb250YWluZXIuYWRkQ2xhc3MoXCJmb2N1c2VkXCIpO30pO1xuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuYmx1ciwgZnVuY3Rpb24oKXtjb250YWluZXIucmVtb3ZlQ2xhc3MoXCJmb2N1c2VkXCIpO30pO1xuXG4gICAgICAgICAgICBpZiAoby5tb2RlICE9PSBcImlucHV0XCIpIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXIub24oJ2RyYWcgZHJhZ3N0YXJ0IGRyYWdlbmQgZHJhZ292ZXIgZHJhZ2VudGVyIGRyYWdsZWF2ZSBkcm9wJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5vbignZHJhZ2VudGVyIGRyYWdvdmVyJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwiZHJvcC1vblwiKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5vbignZHJhZ2xlYXZlJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLnJlbW92ZUNsYXNzKFwiZHJvcC1vblwiKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5vbignZHJvcCcsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50WzBdLmZpbGVzID0gZS5kYXRhVHJhbnNmZXIuZmlsZXM7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVzLmh0bWwoZWxlbWVudFswXS5maWxlcy5sZW5ndGggKyBcIiBcIiArby5maWxlc1RpdGxlKTtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLnJlbW92ZUNsYXNzKFwiZHJvcC1vblwiKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNsZWFyOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICBpZiAoby5tb2RlID09PSBcImlucHV0XCIpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnNpYmxpbmdzKFwiLmNhcHRpb25cIikuaHRtbChcIlwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5zaWJsaW5ncyhcIi5jYXB0aW9uXCIpLmh0bWwoby5kcm9wVGl0bGUpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuc2libGluZ3MoXCIuZmlsZXNcIikuaHRtbChcIjBcIiArIFwiIFwiICsgby5maWxlc1RpdGxlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC52YWwoXCJcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50KCkuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRpc2FibGVkXCIsIGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnQoKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZVN0YXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbS5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZURpcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmVsZW1lbnQuYXR0cihcImRpclwiKSA9PT0gJ3J0bCcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50KCkuYWRkQ2xhc3MoXCJydGxcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnQoKS5yZW1vdmVDbGFzcyhcInJ0bFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHJpYnV0ZU5hbWUpe1xuICAgICAgICAgICAgc3dpdGNoIChhdHRyaWJ1dGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnZGlzYWJsZWQnOiB0aGlzLnRvZ2dsZVN0YXRlKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2Rpcic6IHRoaXMudG9nZ2xlRGlyKCk7IGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBwYXJlbnQgPSBlbGVtZW50LnBhcmVudCgpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNoYW5nZSk7XG4gICAgICAgICAgICBwYXJlbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCJidXR0b25cIik7XG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgR3JhZGllbnRCb3hEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBncmFkaWVudFR5cGU6IFwibGluZWFyXCIsIC8vIGxpbmVhciwgcmFkaWFsXG4gICAgICAgIGdyYWRpZW50U2hhcGU6IFwiXCIsXG4gICAgICAgIGdyYWRpZW50UG9zaXRpb246IFwiXCIsXG4gICAgICAgIGdyYWRpZW50U2l6ZTogXCJcIixcbiAgICAgICAgZ3JhZGllbnRDb2xvcnM6IFwiIzAwMCwgI2ZmZlwiLFxuICAgICAgICBncmFkaWVudFJlcGVhdDogZmFsc2UsXG4gICAgICAgIG9uR3JhZGllbnRCb3hDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uZ3JhZGllbnRCb3hTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIEdyYWRpZW50Qm94RGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBHcmFkaWVudEJveERlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvR3JhZGllbnRCb3hTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmdyYWRpZW50Qm94U2V0dXAod2luZG93W1wibWV0cm9HcmFkaWVudEJveFNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ2dyYWRpZW50LWJveCcsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBHcmFkaWVudEJveERlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICAvLyBkZWZpbmUgaW5zdGFuY2UgdmFycyBoZXJlXG4gICAgICAgICAgICAgICAgY29sb3JzOiBbXSxcbiAgICAgICAgICAgICAgICBzaGFwZTogXCJcIixcbiAgICAgICAgICAgICAgICBzaXplOiBcIlwiLFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBcIlwiLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwibGluZWFyXCIsXG4gICAgICAgICAgICAgICAgZnVuYzogXCJsaW5lYXItZ3JhZGllbnRcIixcbiAgICAgICAgICAgICAgICByZXBlYXQ6IGZhbHNlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdGhpcy5jb2xvcnMgPSBvLmdyYWRpZW50Q29sb3JzLnRvQXJyYXkoXCIsXCIpO1xuICAgICAgICAgICAgdGhpcy50eXBlID0gby5ncmFkaWVudFR5cGUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHRoaXMuc2hhcGUgPSBvLmdyYWRpZW50U2hhcGUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHRoaXMuc2l6ZSA9IG8uZ3JhZGllbnRTaXplLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICB0aGlzLnJlcGVhdCA9IG8uZ3JhZGllbnRSZXBlYXQ7XG4gICAgICAgICAgICB0aGlzLmZ1bmMgPSAodGhpcy5yZXBlYXQgPyBcInJlcGVhdGluZy1cIiA6IFwiXCIpICsgdGhpcy50eXBlICsgXCItZ3JhZGllbnRcIjtcblxuXG4gICAgICAgICAgICBpZiAodGhpcy50eXBlID09PSBcImxpbmVhclwiKSB7XG4gICAgICAgICAgICAgICAgaWYgKCAhby5ncmFkaWVudFBvc2l0aW9uICkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBvc2l0aW9uID0gXCJ0byBib3R0b21cIjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBvc2l0aW9uID0gaXNOYU4oby5ncmFkaWVudFBvc2l0aW9uKSA9PT0gZmFsc2UgPyBvLmdyYWRpZW50UG9zaXRpb24gKyBcImRlZ1wiIDogby5ncmFkaWVudFBvc2l0aW9uO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBvc2l0aW9uLmluZGV4T2YoXCJkZWdcIikgPT09IC0xICYmIHRoaXMucG9zaXRpb24uaW5kZXhPZihcInRvIFwiKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSBcInRvIFwiICsgdGhpcy5wb3NpdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbiA9IG8uZ3JhZGllbnRQb3NpdGlvbi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnBvc2l0aW9uICYmIHRoaXMucG9zaXRpb24uaW5kZXhPZihcImF0IFwiKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbiA9IFwiYXQgXCIgKyB0aGlzLnBvc2l0aW9uO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7XG4gICAgICAgICAgICB0aGlzLl9zZXRHcmFkaWVudCgpO1xuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KCdncmFkaWVudC1ib3gtY3JlYXRlJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVN0cnVjdHVyZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5hZGRDbGFzcyhcImdyYWRpZW50LWJveFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfc2V0R3JhZGllbnQ6IGZ1bmN0aW9uICgpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgZ3JhZGllbnRSdWxlLCBncmFkaWVudE9wdGlvbnMgPSBbXTtcblxuICAgICAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gXCJyYWRpYWxcIiAmJiB0aGlzLnNoYXBlKSB7XG4gICAgICAgICAgICAgICAgZ3JhZGllbnRPcHRpb25zLnB1c2godGhpcy5zaGFwZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnR5cGUgPT09IFwicmFkaWFsXCIgJiYgdGhpcy5zaXplKSB7XG4gICAgICAgICAgICAgICAgZ3JhZGllbnRPcHRpb25zLnB1c2godGhpcy5zaXplKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMucG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICBncmFkaWVudE9wdGlvbnMucHVzaCgodGhpcy5wb3NpdGlvbi5pbmRleE9mKFwiYXRcIikgPT09IC0xID8gXCJhdCBcIiA6IFwiXCIpICsgdGhpcy5wb3NpdGlvbik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGdyYWRpZW50UnVsZSA9IHRoaXMuZnVuYyArIFwiKFwiICsgKGdyYWRpZW50T3B0aW9ucy5sZW5ndGggPyBncmFkaWVudE9wdGlvbnMuam9pbihcIiBcIikgKyBcIiwgXCIgOiBcIlwiKSArIHRoaXMuY29sb3JzLmpvaW4oXCIsIFwiKSArIFwiKVwiO1xuXG4gICAgICAgICAgICBlbGVtZW50LmNzcyh7XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZDogZ3JhZGllbnRSdWxlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHIsIG5ld1ZhbHVlKXtcbiAgICAgICAgICAgIGlmIChhdHRyLmluZGV4T2YoXCJkYXRhLWdyYWRpZW50LVwiKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHIpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1ncmFkaWVudC10eXBlXCI6IHRoaXMudHlwZSA9IG5ld1ZhbHVlOyB0aGlzLmZ1bmMgPSBuZXdWYWx1ZS50b0xvd2VyQ2FzZSgpICsgXCItZ3JhZGllbnRcIjsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtZ3JhZGllbnQtY29sb3JzXCI6IHRoaXMuY29sb3JzID0gbmV3VmFsdWUgPyBuZXdWYWx1ZS50b0FycmF5KFwiLFwiKSA6IFtcIiNmZmZcIiwgXCIjMDAwXCJdOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1ncmFkaWVudC1zaGFwZVwiOiB0aGlzLnNoYXBlID0gbmV3VmFsdWUudG9Mb3dlckNhc2UoKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtZ3JhZGllbnQtc2l6ZVwiOiB0aGlzLnNpemUgPSBuZXdWYWx1ZS50b0xvd2VyQ2FzZSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1ncmFkaWVudC1wb3NpdGlvblwiOiB0aGlzLnBvc2l0aW9uID0gbmV3VmFsdWUudG9Mb3dlckNhc2UoKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtZ3JhZGllbnQtcmVwZWF0XCI6IHRoaXMucmVwZWF0ID0gVXRpbHMuYm9vbChuZXdWYWx1ZSk7IGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9zZXRHcmFkaWVudCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBHcmF2YXRhckRlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGdyYXZhdGFyRGVmZXJyZWQ6IDAsXG4gICAgICAgIGVtYWlsOiBcIlwiLFxuICAgICAgICBzaXplOiA4MCxcbiAgICAgICAgZGVmYXVsdDogXCJtcFwiLFxuICAgICAgICBvbkdyYXZhdGFyQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmdyYXZhdGFyU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBHcmF2YXRhckRlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgR3JhdmF0YXJEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0dyYXZhdGFyU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5ncmF2YXRhclNldHVwKHdpbmRvd1tcIm1ldHJvR3JhdmF0YXJTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdncmF2YXRhcicsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBHcmF2YXRhckRlZmF1bHRDb25maWcpO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIHRoaXMuZ2V0KCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImdyYXZhdGFyLWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0SW1hZ2U6IGZ1bmN0aW9uKGVtYWlsLCBzaXplLCBkZWYsIGlzX29iamVjdCl7XG4gICAgICAgICAgICB2YXIgaW1hZ2UgPSAkKFwiPGltZz5cIikuYXR0cignYWx0JywgZW1haWwpO1xuXG4gICAgICAgICAgICBpbWFnZS5hdHRyKFwic3JjXCIsIHRoaXMuZ2V0SW1hZ2VTcmMoZW1haWwsIHNpemUpKTtcblxuICAgICAgICAgICAgcmV0dXJuIGlzX29iamVjdCA9PT0gdHJ1ZSA/IGltYWdlIDogaW1hZ2VbMF07XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0SW1hZ2VTcmM6IGZ1bmN0aW9uKGVtYWlsLCBzaXplLCBkZWYpe1xuICAgICAgICAgICAgaWYgKGVtYWlsID09PSB1bmRlZmluZWQgfHwgZW1haWwudHJpbSgpID09PSAnJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzaXplID0gc2l6ZSB8fCA4MDtcbiAgICAgICAgICAgIGRlZiA9IE1ldHJvLnV0aWxzLmVuY29kZVVSSShkZWYpIHx8ICc0MDQnO1xuXG4gICAgICAgICAgICByZXR1cm4gXCIvL3d3dy5ncmF2YXRhci5jb20vYXZhdGFyL1wiICsgTWV0cm8ubWQ1KChlbWFpbC50b0xvd2VyQ2FzZSgpKS50cmltKCkpICsgJz9zaXplPScgKyBzaXplICsgJyZkPScgKyBkZWY7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgaW1nID0gZWxlbWVudFswXS50YWdOYW1lID09PSAnSU1HJyA/IGVsZW1lbnQgOiBlbGVtZW50LmZpbmQoXCJpbWdcIik7XG5cbiAgICAgICAgICAgIGlmIChpbWcubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaW1nLmF0dHIoXCJzcmNcIiwgdGhpcy5nZXRJbWFnZVNyYyhvLmVtYWlsLCBvLnNpemUsIG8uZGVmYXVsdCkpO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICByZXNpemU6IGZ1bmN0aW9uKG5ld19zaXplKXtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5zaXplID0gbmV3X3NpemUgIT09IHVuZGVmaW5lZCA/IG5ld19zaXplIDogdGhpcy5lbGVtZW50LmF0dHIoXCJkYXRhLXNpemVcIik7XG4gICAgICAgICAgICB0aGlzLmdldCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGVtYWlsOiBmdW5jdGlvbihuZXdfZW1haWwpe1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmVtYWlsID0gbmV3X2VtYWlsICE9PSB1bmRlZmluZWQgPyBuZXdfZW1haWwgOiB0aGlzLmVsZW1lbnQuYXR0cihcImRhdGEtZW1haWxcIik7XG4gICAgICAgICAgICB0aGlzLmdldCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSl7XG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdkYXRhLXNpemUnOiB0aGlzLnJlc2l6ZSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdkYXRhLWVtYWlsJzogdGhpcy5lbWFpbCgpOyBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIEhpbnREZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBoaW50RGVmZXJyZWQ6IDAsXG4gICAgICAgIGhpbnRIaWRlOiA1MDAwLFxuICAgICAgICBjbHNIaW50OiBcIlwiLFxuICAgICAgICBoaW50VGV4dDogXCJcIixcbiAgICAgICAgaGludFBvc2l0aW9uOiBNZXRyby5wb3NpdGlvbi5UT1AsXG4gICAgICAgIGhpbnRPZmZzZXQ6IDQsXG4gICAgICAgIG9uSGludFNob3c6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uSGludEhpZGU6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uSGludENyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5oaW50U2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBIaW50RGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBIaW50RGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9IaW50U2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5oaW50U2V0dXAod2luZG93W1wibWV0cm9IaW50U2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnaGludCcsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBIaW50RGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIGhpbnQ6IG51bGwsXG4gICAgICAgICAgICAgICAgaGludF9zaXplOiB7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAwLFxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDBcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGlkOiBVdGlscy5lbGVtZW50SWQoXCJoaW50XCIpXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiaGludC1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IHRoaXMuZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBvdmVyID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmVudGVyLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIG92ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvdmVyKSByZXR1cm47XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5jcmVhdGVIaW50KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICgrby5oaW50SGlkZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LnJlbW92ZUhpbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIG8uaGludEhpZGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgby5oaW50RGVmZXJyZWQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmxlYXZlLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIG92ZXIgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGF0LnJlbW92ZUhpbnQoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKHdpbmRvdykub24oTWV0cm8uZXZlbnRzLnNjcm9sbCtcIiBcIitNZXRyby5ldmVudHMucmVzaXplLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmICh0aGF0LmhpbnQgIT09IG51bGwpIHRoYXQuc2V0UG9zaXRpb24oKTtcbiAgICAgICAgICAgIH0sIHtuczogdGhpcy5pZH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNyZWF0ZUhpbnQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbSA9IHRoaXMuZWxlbSwgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBoaW50ID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiaGludFwiKS5hZGRDbGFzcyhvLmNsc0hpbnQpLmh0bWwoby5oaW50VGV4dCk7XG5cbiAgICAgICAgICAgIHRoaXMuaGludCA9IGhpbnQ7XG4gICAgICAgICAgICB0aGlzLmhpbnRfc2l6ZSA9IFV0aWxzLmhpZGRlbkVsZW1lbnRTaXplKGhpbnQpO1xuXG4gICAgICAgICAgICAkKFwiLmhpbnQ6bm90KC5wZXJtYW5lbnQtaGludClcIikucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIGlmIChlbGVtLnRhZ05hbWUgPT09ICdURCcgfHwgZWxlbS50YWdOYW1lID09PSAnVEgnKSB7XG4gICAgICAgICAgICAgICAgdmFyIHdycCA9ICQoXCI8ZGl2Lz5cIikuY3NzKFwiZGlzcGxheVwiLCBcImlubGluZS1ibG9ja1wiKS5odG1sKGVsZW1lbnQuaHRtbCgpKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lmh0bWwod3JwKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQgPSB3cnA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24oKTtcblxuICAgICAgICAgICAgaGludC5hcHBlbmRUbygkKCdib2R5JykpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJoaW50LXNob3dcIiwge1xuICAgICAgICAgICAgICAgIGhpbnQ6IGhpbnRbMF1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0UG9zaXRpb246IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgaGludCA9IHRoaXMuaGludCwgaGludF9zaXplID0gdGhpcy5oaW50X3NpemUsIG8gPSB0aGlzLm9wdGlvbnMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGlmIChvLmhpbnRQb3NpdGlvbiA9PT0gTWV0cm8ucG9zaXRpb24uQk9UVE9NKSB7XG4gICAgICAgICAgICAgICAgaGludC5hZGRDbGFzcygnYm90dG9tJyk7XG4gICAgICAgICAgICAgICAgaGludC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB0b3A6IGVsZW1lbnQub2Zmc2V0KCkudG9wIC0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpICsgZWxlbWVudC5vdXRlckhlaWdodCgpICsgby5oaW50T2Zmc2V0LFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBlbGVtZW50Lm9mZnNldCgpLmxlZnQgKyBlbGVtZW50Lm91dGVyV2lkdGgoKS8yIC0gaGludF9zaXplLndpZHRoLzIgIC0gJCh3aW5kb3cpLnNjcm9sbExlZnQoKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChvLmhpbnRQb3NpdGlvbiA9PT0gTWV0cm8ucG9zaXRpb24uUklHSFQpIHtcbiAgICAgICAgICAgICAgICBoaW50LmFkZENsYXNzKCdyaWdodCcpO1xuICAgICAgICAgICAgICAgIGhpbnQuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBlbGVtZW50Lm9mZnNldCgpLnRvcCArIGVsZW1lbnQub3V0ZXJIZWlnaHQoKS8yIC0gaGludF9zaXplLmhlaWdodC8yIC0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpLFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBlbGVtZW50Lm9mZnNldCgpLmxlZnQgKyBlbGVtZW50Lm91dGVyV2lkdGgoKSAtICQod2luZG93KS5zY3JvbGxMZWZ0KCkgKyBvLmhpbnRPZmZzZXRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoby5oaW50UG9zaXRpb24gPT09IE1ldHJvLnBvc2l0aW9uLkxFRlQpIHtcbiAgICAgICAgICAgICAgICBoaW50LmFkZENsYXNzKCdsZWZ0Jyk7XG4gICAgICAgICAgICAgICAgaGludC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB0b3A6IGVsZW1lbnQub2Zmc2V0KCkudG9wICsgZWxlbWVudC5vdXRlckhlaWdodCgpLzIgLSBoaW50X3NpemUuaGVpZ2h0LzIgLSAkKHdpbmRvdykuc2Nyb2xsVG9wKCksXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IGVsZW1lbnQub2Zmc2V0KCkubGVmdCAtIGhpbnRfc2l6ZS53aWR0aCAtICQod2luZG93KS5zY3JvbGxMZWZ0KCkgLSBvLmhpbnRPZmZzZXRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaGludC5hZGRDbGFzcygndG9wJyk7XG4gICAgICAgICAgICAgICAgaGludC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB0b3A6IGVsZW1lbnQub2Zmc2V0KCkudG9wIC0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpIC0gaGludF9zaXplLmhlaWdodCAtIG8uaGludE9mZnNldCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogZWxlbWVudC5vZmZzZXQoKS5sZWZ0IC0gJCh3aW5kb3cpLnNjcm9sbExlZnQoKSArIGVsZW1lbnQub3V0ZXJXaWR0aCgpLzIgLSBoaW50X3NpemUud2lkdGgvMlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZUhpbnQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgaGludCA9IHRoaXMuaGludDtcbiAgICAgICAgICAgIHZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHRpbWVvdXQgPSBvcHRpb25zLm9uSGludEhpZGUgPT09IE1ldHJvLm5vb3AgPyAwIDogMzAwO1xuXG4gICAgICAgICAgICBpZiAoaGludCAhPT0gbnVsbCkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiaGludC1oaWRlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgaGludDogaGludFswXVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBoaW50LmhpZGUoMCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpbnQucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmhpbnQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LCB0aW1lb3V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VUZXh0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmhpbnRUZXh0ID0gdGhpcy5lbGVtZW50LmF0dHIoXCJkYXRhLWhpbnQtdGV4dFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHJpYnV0ZU5hbWUpe1xuICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZU5hbWUgPT09IFwiZGF0YS1oaW50LXRleHRcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlVGV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlSGludCgpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmVudGVyICsgXCItaGludFwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5sZWF2ZSArIFwiLWhpbnRcIik7XG4gICAgICAgICAgICAkKHdpbmRvdykub2ZmKE1ldHJvLmV2ZW50cy5zY3JvbGwgKyBcIi1oaW50XCIpO1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgSG90a2V5ID0ge1xuICAgICAgICBzcGVjaWFsS2V5czoge1xuICAgICAgICAgICAgODogXCJiYWNrc3BhY2VcIiwgOTogXCJ0YWJcIiwgMTM6IFwicmV0dXJuXCIsIDE2OiBcInNoaWZ0XCIsIDE3OiBcImN0cmxcIiwgMTg6IFwiYWx0XCIsIDE5OiBcInBhdXNlXCIsXG4gICAgICAgICAgICAyMDogXCJjYXBzbG9ja1wiLCAyNzogXCJlc2NcIiwgMzI6IFwic3BhY2VcIiwgMzM6IFwicGFnZXVwXCIsIDM0OiBcInBhZ2Vkb3duXCIsIDM1OiBcImVuZFwiLCAzNjogXCJob21lXCIsXG4gICAgICAgICAgICAzNzogXCJsZWZ0XCIsIDM4OiBcInVwXCIsIDM5OiBcInJpZ2h0XCIsIDQwOiBcImRvd25cIiwgNDU6IFwiaW5zZXJ0XCIsIDQ2OiBcImRlbFwiLFxuICAgICAgICAgICAgOTY6IFwiMFwiLCA5NzogXCIxXCIsIDk4OiBcIjJcIiwgOTk6IFwiM1wiLCAxMDA6IFwiNFwiLCAxMDE6IFwiNVwiLCAxMDI6IFwiNlwiLCAxMDM6IFwiN1wiLFxuICAgICAgICAgICAgMTA0OiBcIjhcIiwgMTA1OiBcIjlcIiwgMTA2OiBcIipcIiwgMTA3OiBcIitcIiwgMTA5OiBcIi1cIiwgMTEwOiBcIi5cIiwgMTExIDogXCIvXCIsXG4gICAgICAgICAgICAxMTI6IFwiZjFcIiwgMTEzOiBcImYyXCIsIDExNDogXCJmM1wiLCAxMTU6IFwiZjRcIiwgMTE2OiBcImY1XCIsIDExNzogXCJmNlwiLCAxMTg6IFwiZjdcIiwgMTE5OiBcImY4XCIsXG4gICAgICAgICAgICAxMjA6IFwiZjlcIiwgMTIxOiBcImYxMFwiLCAxMjI6IFwiZjExXCIsIDEyMzogXCJmMTJcIiwgMTQ0OiBcIm51bWxvY2tcIiwgMTQ1OiBcInNjcm9sbFwiLCAxODg6IFwiLFwiLCAxOTA6IFwiLlwiLFxuICAgICAgICAgICAgMTkxOiBcIi9cIiwgMjI0OiBcIm1ldGFcIiB9LFxuXG4gICAgICAgIHNoaWZ0TnVtczoge1xuICAgICAgICAgICAgXCJ+XCI6XCJgXCIsIFwiIVwiOlwiMVwiLCBcIkBcIjpcIjJcIiwgXCIjXCI6XCIzXCIsIFwiJFwiOlwiNFwiLCBcIiVcIjpcIjVcIiwgXCJeXCI6XCI2XCIsIFwiJlwiOlwiN1wiLFxuICAgICAgICAgICAgXCIqXCI6XCI4XCIsIFwiKFwiOlwiOVwiLCBcIilcIjpcIjBcIiwgXCJfXCI6XCItXCIsIFwiK1wiOlwiPVwiLCBcIjpcIjpcIjtcIiwgXCJcXFwiXCI6XCInXCIsIFwiPFwiOlwiLFwiLFxuICAgICAgICAgICAgXCI+XCI6XCIuXCIsICBcIj9cIjpcIi9cIiwgICBcInxcIjpcIlxcXFxcIlxuICAgICAgICB9LFxuXG4gICAgICAgIHNoaWZ0TnVtc0ludmVyc2U6IHtcbiAgICAgICAgICAgIFwiYFwiOiBcIn5cIiwgXCIxXCI6IFwiIVwiLCBcIjJcIjogXCJAXCIsIFwiM1wiOiBcIiNcIiwgXCI0XCI6IFwiJFwiLCBcIjVcIjogXCIlXCIsIFwiNlwiOiBcIl5cIiwgXCI3XCI6IFwiJlwiLFxuICAgICAgICAgICAgXCI4XCI6IFwiKlwiLCBcIjlcIjogXCIoXCIsIFwiMFwiOiBcIilcIiwgXCItXCI6IFwiX1wiLCBcIj1cIjogXCIrXCIsIFwiO1wiOiBcIjogXCIsIFwiJ1wiOiBcIlxcXCJcIiwgXCIsXCI6IFwiPFwiLFxuICAgICAgICAgICAgXCIuXCI6IFwiPlwiLCAgXCIvXCI6IFwiP1wiLCAgXCJcXFxcXCI6IFwifFwiXG4gICAgICAgIH0sXG5cbiAgICAgICAgdGV4dEFjY2VwdGluZ0lucHV0VHlwZXM6IFtcbiAgICAgICAgICAgIFwidGV4dFwiLCBcInBhc3N3b3JkXCIsIFwibnVtYmVyXCIsIFwiZW1haWxcIiwgXCJ1cmxcIiwgXCJyYW5nZVwiLCBcImRhdGVcIiwgXCJtb250aFwiLCBcIndlZWtcIiwgXCJ0aW1lXCIsIFwiZGF0ZXRpbWVcIixcbiAgICAgICAgICAgIFwiZGF0ZXRpbWUtbG9jYWxcIiwgXCJzZWFyY2hcIiwgXCJjb2xvclwiLCBcInRlbFwiXG4gICAgICAgIF0sXG5cbiAgICAgICAgZ2V0S2V5OiBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgIHZhciBrZXksIGsgPSBlLmtleUNvZGUsIGNoYXIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCBrICkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIGlmKCBlLnNoaWZ0S2V5ICl7XG4gICAgICAgICAgICAgICAga2V5ID0gSG90a2V5LnNoaWZ0TnVtc1sgY2hhciBdID8gSG90a2V5LnNoaWZ0TnVtc1sgY2hhciBdIDogY2hhcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGtleSA9IEhvdGtleS5zcGVjaWFsS2V5c1sgayBdID09PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgPyBjaGFyXG4gICAgICAgICAgICAgICAgICAgIDogSG90a2V5LnNwZWNpYWxLZXlzWyBrIF07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBIb3RrZXkuZ2V0TW9kaWZpZXIoZSkubGVuZ3RoID8gSG90a2V5LmdldE1vZGlmaWVyKGUpLmpvaW4oXCIrXCIpICsgXCIrXCIgKyBrZXkgOiBrZXk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0TW9kaWZpZXI6IGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgdmFyIG0gPSBbXTtcbiAgICAgICAgICAgIGlmIChlLmFsdEtleSkge20ucHVzaChcImFsdFwiKTt9XG4gICAgICAgICAgICBpZiAoZS5jdHJsS2V5KSB7bS5wdXNoKFwiY3RybFwiKTt9XG4gICAgICAgICAgICBpZiAoZS5zaGlmdEtleSkge20ucHVzaChcInNoaWZ0XCIpO31cbiAgICAgICAgICAgIHJldHVybiBtO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGJpbmRLZXkoa2V5LCBmbil7XG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICQodGhpcykub24oTWV0cm8uZXZlbnRzLmtleXVwK1wiLmhvdGtleS1tZXRob2QtXCIra2V5LCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICB2YXIgX2tleSA9IEhvdGtleS5nZXRLZXkoZSk7XG4gICAgICAgICAgICAgICAgdmFyIGVsID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgaHJlZiA9IFwiXCIrZWwuYXR0cihcImhyZWZcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAoa2V5ICE9PSBfa2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoZWwuaXMoXCJhXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChocmVmICYmIGhyZWYudHJpbSgpICE9PSBcIiNcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBocmVmO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgVXRpbHMuZXhlYyhmbiwgW2UsIF9rZXksIGtleV0sIHRoaXMpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAkLmZuLmhvdGtleSA9IGJpbmRLZXk7XG5cbiAgICBpZiAod2luZG93Lk1FVFJPX0pRVUVSWSAmJiB3aW5kb3cuanF1ZXJ5X3ByZXNlbnQpIHtcbiAgICAgICAgalF1ZXJ5LmZuLmhvdGtleSA9IGJpbmRLZXk7XG4gICAgfVxuXG4gICAgLy8gVE9ETyBrZXl1cCBvciBrZXlkb3duID9cbiAgICAkKGRvY3VtZW50KS5vbihNZXRyby5ldmVudHMua2V5dXAgKyBcIi5ob3RrZXktZGF0YVwiLCBmdW5jdGlvbihlKXtcbiAgICAgICAgdmFyIGVsLCBmbiwga2V5LCBocmVmO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIChNRVRST19IT1RLRVlTX0ZJTFRFUl9JTlBVVF9BQ0NFUFRJTkdfRUxFTUVOVFMgJiYgL3RleHRhcmVhfGlucHV0fHNlbGVjdC9pLnRlc3QoZS50YXJnZXQubm9kZU5hbWUpKSB8fFxuICAgICAgICAgICAgKE1FVFJPX0hPVEtFWVNfRklMVEVSX0NPTlRFTlRfRURJVEFCTEUgJiYgJChlLnRhcmdldCkuYXR0cignY29udGVudGVkaXRhYmxlJykpIHx8XG4gICAgICAgICAgICAoTUVUUk9fSE9US0VZU19GSUxURVJfVEVYVF9JTlBVVFMgJiYgSG90a2V5LnRleHRBY2NlcHRpbmdJbnB1dFR5cGVzLmluZGV4T2YoZS50YXJnZXQudHlwZSkgPiAtMSlcbiAgICAgICAgKVxuICAgICAgICB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBrZXkgPSBIb3RrZXkuZ2V0S2V5KGUpO1xuXG4gICAgICAgIGlmIChVdGlscy5rZXlJbk9iamVjdChNZXRyby5ob3RrZXlzLCBrZXkpKSB7XG4gICAgICAgICAgICBlbCA9ICQoTWV0cm8uaG90a2V5c1trZXldWzBdKTtcbiAgICAgICAgICAgIGZuID0gTWV0cm8uaG90a2V5c1trZXldWzFdO1xuICAgICAgICAgICAgaHJlZiA9IChcIlwiK2VsLmF0dHIoXCJocmVmXCIpKS50cmltKCk7XG5cbiAgICAgICAgICAgIGlmIChmbikge1xuICAgICAgICAgICAgICAgIFV0aWxzLmV4ZWMoZm4pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoZWwuaXMoXCJhXCIpICYmIGhyZWYgJiYgaHJlZi5sZW5ndGggPiAwICYmIGhyZWYudHJpbSgpICE9PSBcIiNcIikge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGhyZWY7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZWwuY2xpY2soKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFRPRE8gYWRkIGRlc3Ryb3lcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBIdG1sQ29udGFpbmVyRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgaHRtbGNvbnRhaW5lckRlZmVycmVkOiAwLFxuICAgICAgICBtZXRob2Q6IFwiZ2V0XCIsXG4gICAgICAgIGh0bWxTb3VyY2U6IG51bGwsXG4gICAgICAgIHJlcXVlc3REYXRhOiBudWxsLFxuICAgICAgICByZXF1ZXN0T3B0aW9uczogbnVsbCxcbiAgICAgICAgaW5zZXJ0TW9kZTogXCJkZWZhdWx0XCIsIC8vIHJlcGxhY2UsIGFwcGVuZCwgcHJlcGVuZFxuICAgICAgICBvbkh0bWxMb2FkOiBNZXRyby5ub29wLFxuICAgICAgICBvbkh0bWxMb2FkRmFpbDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25IdG1sTG9hZERvbmU6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uSHRtbENvbnRhaW5lckNyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5odG1sQ29udGFpbmVyU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBIdG1sQ29udGFpbmVyRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBIdG1sQ29udGFpbmVyRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9IdG1sQ29udGFpbmVyU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5odG1sQ29udGFpbmVyU2V0dXAod2luZG93W1wibWV0cm9IdG1sQ29udGFpbmVyU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnaHRtbC1jb250YWluZXInLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgSHRtbENvbnRhaW5lckRlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICAgICAgICAgIG9wdDoge30sXG4gICAgICAgICAgICAgICAgaHRtbFNvdXJjZTogJydcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygby5yZXF1ZXN0RGF0YSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBvLnJlcXVlc3REYXRhID0gSlNPTi5wYXJzZShvLnJlcXVlc3REYXRhKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzT2JqZWN0KG8ucmVxdWVzdERhdGEpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gVXRpbHMuaXNPYmplY3Qoby5yZXF1ZXN0RGF0YSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygby5yZXF1ZXN0T3B0aW9ucyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBvLnJlcXVlc3RPcHRpb25zID0gSlNPTi5wYXJzZShvLnJlcXVlc3RPcHRpb25zKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzT2JqZWN0KG8ucmVxdWVzdE9wdGlvbnMpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHQgPSBVdGlscy5pc09iamVjdChvLnJlcXVlc3RPcHRpb25zKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgby5tZXRob2QgPSBvLm1ldGhvZC50b1VwcGVyQ2FzZSgpO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLmh0bWxTb3VyY2UpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5odG1sU291cmNlID0gby5odG1sU291cmNlO1xuICAgICAgICAgICAgICAgIHRoaXMuX2xvYWQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiaHRtbC1jb250YWluZXItY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfbG9hZDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBmZXRjaERhdGEgPSB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiBvLm1ldGhvZFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuZGF0YSkgZmV0Y2hEYXRhWydib2R5J10gPSB0aGlzLmRhdGE7XG4gICAgICAgICAgICBpZiAodGhpcy5vcHQpIGZldGNoRGF0YVsnaGVhZGVycyddID0gdGhpcy5vcHQ7XG5cbiAgICAgICAgICAgIGZldGNoKHRoaXMuaHRtbFNvdXJjZSwgZmV0Y2hEYXRhKVxuICAgICAgICAgICAgLnRoZW4oTWV0cm8uZmV0Y2guc3RhdHVzKVxuICAgICAgICAgICAgLnRoZW4oTWV0cm8uZmV0Y2gudGV4dClcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgIHZhciBfZGF0YSA9ICQoZGF0YSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoX2RhdGEubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIF9kYXRhID0gJChcIjxkaXY+XCIpLmh0bWwoZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc3dpdGNoIChvLmluc2VydE1vZGUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwicHJlcGVuZFwiOiBlbGVtZW50LnByZXBlbmQoX2RhdGEpOyBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImFwcGVuZFwiOiBlbGVtZW50LmFwcGVuZChfZGF0YSk7IGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwicmVwbGFjZVwiOiBfZGF0YS5pbnNlcnRCZWZvcmUoZWxlbWVudCkuc2NyaXB0KCk7IGVsZW1lbnQucmVtb3ZlKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50Lmh0bWwoX2RhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImh0bWwtbG9hZFwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZTogby5odG1sU291cmNlLFxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YTogdGhhdC5kYXRhLFxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0T3B0aW9uczogdGhhdC5vcHRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3Ipe1xuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImh0bWwtbG9hZC1mYWlsXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBsb2FkOiBmdW5jdGlvbihzb3VyY2UsIGRhdGEsIG9wdCl7XG4gICAgICAgICAgICBpZiAoc291cmNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5odG1sU291cmNlID0gc291cmNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IFV0aWxzLmlzT2JqZWN0KGRhdGEpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAob3B0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHQgPSBVdGlscy5pc09iamVjdChvcHQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9sb2FkKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdmFyIGNoYW5nZUhUTUxTb3VyY2UgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBodG1sID0gZWxlbWVudC5hdHRyKFwiZGF0YS1odG1sLXNvdXJjZVwiKTtcbiAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNOdWxsKGh0bWwpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChodG1sLnRyaW0oKSA9PT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50Lmh0bWwoXCJcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG8uaHRtbFNvdXJjZSA9IGh0bWw7XG4gICAgICAgICAgICAgICAgdGhhdC5fbG9hZCgpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGNoYW5nZUluc2VydE1vZGUgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBhdHRyID0gZWxlbWVudC5hdHRyKFwiZGF0YS1pbnNlcnQtbW9kZVwiKTtcbiAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShhdHRyKSkge1xuICAgICAgICAgICAgICAgICAgICBvLmluc2VydE1vZGUgPSBhdHRyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBjaGFuZ2VSZXF1ZXN0RGF0YSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBlbGVtZW50LmF0dHIoXCJkYXRhLXJlcXVlc3QtZGF0YVwiKTtcbiAgICAgICAgICAgICAgICB0aGF0LmxvYWQoby5odG1sU291cmNlLCBkYXRhKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHN3aXRjaCAoYXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLWh0bWwtc291cmNlXCI6IGNoYW5nZUhUTUxTb3VyY2UoKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtaW5zZXJ0LW1vZGVcIjogY2hhbmdlSW5zZXJ0TW9kZSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1yZXF1ZXN0LWRhdGFcIjogY2hhbmdlUmVxdWVzdERhdGEoKTsgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXt9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBJbWFnZUJveERlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGltYWdlOiBudWxsLFxuICAgICAgICBzaXplOiBcImNvdmVyXCIsXG4gICAgICAgIHJlcGVhdDogZmFsc2UsXG4gICAgICAgIGNvbG9yOiBcInRyYW5zcGFyZW50XCIsXG4gICAgICAgIGF0dGFjaG1lbnQ6IFwic2Nyb2xsXCIsXG4gICAgICAgIG9yaWdpbjogXCJib3JkZXJcIixcbiAgICAgICAgb25JbWFnZUJveENyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5pbWFnZUJveFNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgSW1hZ2VCb3hEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIEltYWdlQm94RGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9JbWFnZUJveFNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8uaW1hZ2VCb3hTZXR1cCh3aW5kb3dbXCJtZXRyb0ltYWdlQm94U2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnaW1hZ2UtYm94Jywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIEltYWdlQm94RGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIC8vIGRlZmluZSBpbnN0YW5jZSB2YXJzIGhlcmVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVN0cnVjdHVyZSgpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoJ2ltYWdlLWJveC1jcmVhdGUnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlU3RydWN0dXJlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJpbWFnZS1ib3hcIik7XG5cbiAgICAgICAgICAgIHRoaXMuX2RyYXdJbWFnZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9kcmF3SW1hZ2U6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBpbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgICAgICAgICAgdmFyIHBvcnRyYWl0O1xuXG4gICAgICAgICAgICBpZiAoIWVsZW1lbnQuYXR0cihcImRhdGEtb3JpZ2luYWxcIikpXG4gICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwiZGF0YS1vcmlnaW5hbFwiLCBvLmltYWdlKTtcblxuICAgICAgICAgICAgZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogXCJ1cmwoXCIrby5pbWFnZStcIilcIixcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kU2l6ZTogby5zaXplLFxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRSZXBlYXQ6IG8ucmVwZWF0ID8gXCJyZXBlYXRcIiA6IFwibm8tcmVwZWF0XCIsXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBvLmNvbG9yLFxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRBdHRhY2htZW50OiBvLmF0dGFjaG1lbnQsXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZE9yaWdpbjogby5vcmlnaW5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpbWFnZS5zcmMgPSBvLmltYWdlO1xuICAgICAgICAgICAgaW1hZ2Uub25sb2FkID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBwb3J0cmFpdCA9IHRoaXMuaGVpZ2h0ID49IHRoaXMud2lkdGg7XG4gICAgICAgICAgICAgICAgZWxlbWVudFxuICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJpbWFnZS1ib3hfX3BvcnRyYWl0IGltYWdlLWJveF9fbGFuZHNjYXBlXCIpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcImltYWdlLWJveF9fXCIgKyAocG9ydHJhaXQgPyBcInBvcnRyYWl0XCIgOiBcImxhbmRzY2FwZVwiKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyLCBuZXdWYWx1ZSl7XG4gICAgICAgICAgICB2YXIgYXR0ck5hbWUgPSBhdHRyLnJlcGxhY2UoXCJkYXRhLVwiLCBcIlwiKTtcblxuICAgICAgICAgICAgaWYgKFtcImltYWdlXCIsIFwic2l6ZVwiLCBcInJlcGVhdFwiLCBcImNvbG9yXCIsIFwiYXR0YWNobWVudFwiLCBcIm9yaWdpblwiXS5pbmRleE9mKGF0dHJOYW1lKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zW2F0dHJOYW1lXSA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgICAgIHRoaXMuX2RyYXdJbWFnZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgSW1hZ2VDb21wYXJlRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgaW1hZ2Vjb21wYXJlRGVmZXJyZWQ6IDAsXG4gICAgICAgIHdpZHRoOiBcIjEwMCVcIixcbiAgICAgICAgaGVpZ2h0OiBcImF1dG9cIixcbiAgICAgICAgb25TbGlkZXJNb3ZlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkltYWdlQ29tcGFyZUNyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5pbWFnZUNvbXBhcmVTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIEltYWdlQ29tcGFyZURlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgSW1hZ2VDb21wYXJlRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9JbWFnZUNvbXBhcmVTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmltYWdlQ29tcGFyZVNldHVwKHdpbmRvd1tcIm1ldHJvSW1hZ2VDb21wYXJlU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnaW1hZ2UtY29tcGFyZScsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBJbWFnZUNvbXBhcmVEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgaWQ6IFV0aWxzLmVsZW1lbnRJZChcImltYWdlLWNvbXBhcmVcIilcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVN0cnVjdHVyZSgpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlRXZlbnRzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImltYWdlLWNvbXBhcmUtY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlU3RydWN0dXJlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY29udGFpbmVyLCBjb250YWluZXJfb3ZlcmxheSwgc2xpZGVyO1xuICAgICAgICAgICAgdmFyIGltYWdlcywgZWxlbWVudF93aWR0aCwgZWxlbWVudF9oZWlnaHQ7XG5cbiAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZShlbGVtZW50LmF0dHIoXCJpZFwiKSkpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJpZFwiLCBVdGlscy5lbGVtZW50SWQoXCJpbWFnZS1jb21wYXJlXCIpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImltYWdlLWNvbXBhcmVcIikuY3NzKHtcbiAgICAgICAgICAgICAgICB3aWR0aDogby53aWR0aFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnRfd2lkdGggPSBlbGVtZW50LndpZHRoKCk7XG5cbiAgICAgICAgICAgIHN3aXRjaCAoby5oZWlnaHQpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiMTYvOVwiOiBlbGVtZW50X2hlaWdodCA9IFV0aWxzLmFzcGVjdFJhdGlvSChlbGVtZW50X3dpZHRoLCBvLmhlaWdodCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCIyMS85XCI6IGVsZW1lbnRfaGVpZ2h0ID0gVXRpbHMuYXNwZWN0UmF0aW9IKGVsZW1lbnRfd2lkdGgsIG8uaGVpZ2h0KTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcIjQvM1wiOiBlbGVtZW50X2hlaWdodCA9IFV0aWxzLmFzcGVjdFJhdGlvSChlbGVtZW50X3dpZHRoLCBvLmhlaWdodCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJhdXRvXCI6IGVsZW1lbnRfaGVpZ2h0ID0gVXRpbHMuYXNwZWN0UmF0aW9IKGVsZW1lbnRfd2lkdGgsIFwiMTYvOVwiKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDogZWxlbWVudF9oZWlnaHQgPSBvLmhlaWdodDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgIGhlaWdodDogZWxlbWVudF9oZWlnaHRcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJpbWFnZS1jb250YWluZXJcIikuYXBwZW5kVG8oZWxlbWVudCk7XG4gICAgICAgICAgICBjb250YWluZXJfb3ZlcmxheSA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImltYWdlLWNvbnRhaW5lci1vdmVybGF5XCIpLmFwcGVuZFRvKGVsZW1lbnQpLmNzcyh7XG4gICAgICAgICAgICAgICAgd2lkdGg6IGVsZW1lbnRfd2lkdGggLyAyXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc2xpZGVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiaW1hZ2Utc2xpZGVyXCIpLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgc2xpZGVyLmNzcyh7XG4gICAgICAgICAgICAgICAgdG9wOiBlbGVtZW50X2hlaWdodCAvIDIgLSBzbGlkZXIuaGVpZ2h0KCkgLyAyLFxuICAgICAgICAgICAgICAgIGxlZnQ6IGVsZW1lbnRfd2lkdGggLyAyIC0gc2xpZGVyLndpZHRoKCkgLyAyXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaW1hZ2VzID0gZWxlbWVudC5maW5kKFwiaW1nXCIpO1xuXG4gICAgICAgICAgICAkLmVhY2goaW1hZ2VzLCBmdW5jdGlvbihpKXtcbiAgICAgICAgICAgICAgICB2YXIgaW1nID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiaW1hZ2Utd3JhcHBlclwiKTtcbiAgICAgICAgICAgICAgICBpbWcuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGVsZW1lbnRfd2lkdGgsXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogZWxlbWVudF9oZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogXCJ1cmwoXCIrdGhpcy5zcmMrXCIpXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpbWcuYXBwZW5kVG8oaSA9PT0gMCA/IGNvbnRhaW5lciA6IGNvbnRhaW5lcl9vdmVybGF5KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIHZhciBvdmVybGF5ID0gZWxlbWVudC5maW5kKFwiLmltYWdlLWNvbnRhaW5lci1vdmVybGF5XCIpO1xuICAgICAgICAgICAgdmFyIHNsaWRlciA9IGVsZW1lbnQuZmluZChcIi5pbWFnZS1zbGlkZXJcIik7XG5cbiAgICAgICAgICAgIHNsaWRlci5vbihNZXRyby5ldmVudHMuc3RhcnRBbGwsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIHcgPSBlbGVtZW50LndpZHRoKCk7XG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkub24oTWV0cm8uZXZlbnRzLm1vdmVBbGwsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IFV0aWxzLmdldEN1cnNvclBvc2l0aW9uWChlbGVtZW50WzBdLCBlKSwgbGVmdF9wb3M7XG4gICAgICAgICAgICAgICAgICAgIGlmICh4IDwgMCkgeCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGlmICh4ID4gdykgeCA9IHc7XG4gICAgICAgICAgICAgICAgICAgIG92ZXJsYXkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiB4XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBsZWZ0X3BvcyA9IHggLSBzbGlkZXIud2lkdGgoKSAvIDI7XG4gICAgICAgICAgICAgICAgICAgIHNsaWRlci5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogbGVmdF9wb3NcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwic2xpZGVyLW1vdmVcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgeDogeCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGw6IGxlZnRfcG9zXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sIHtuczogdGhhdC5pZH0pO1xuXG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkub24oTWV0cm8uZXZlbnRzLnN0b3BBbGwsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihNZXRyby5ldmVudHMubW92ZUFsbCwge25zOiB0aGF0LmlkfSk7XG4gICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihNZXRyby5ldmVudHMuc3RvcEFsbCwge25zOiB0aGF0LmlkfSk7XG4gICAgICAgICAgICAgICAgfSwge25zOiB0aGF0LmlkfSlcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKHdpbmRvdykub24oTWV0cm8uZXZlbnRzLnJlc2l6ZSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudF93aWR0aCA9IGVsZW1lbnQud2lkdGgoKSwgZWxlbWVudF9oZWlnaHQ7XG5cbiAgICAgICAgICAgICAgICBpZiAoby53aWR0aCAhPT0gXCIxMDAlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG8uaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCIxNi85XCI6IGVsZW1lbnRfaGVpZ2h0ID0gVXRpbHMuYXNwZWN0UmF0aW9IKGVsZW1lbnRfd2lkdGgsIG8uaGVpZ2h0KTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCIyMS85XCI6IGVsZW1lbnRfaGVpZ2h0ID0gVXRpbHMuYXNwZWN0UmF0aW9IKGVsZW1lbnRfd2lkdGgsIG8uaGVpZ2h0KTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCI0LzNcIjogZWxlbWVudF9oZWlnaHQgPSBVdGlscy5hc3BlY3RSYXRpb0goZWxlbWVudF93aWR0aCwgby5oZWlnaHQpOyBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImF1dG9cIjogZWxlbWVudF9oZWlnaHQgPSBVdGlscy5hc3BlY3RSYXRpb0goZWxlbWVudF93aWR0aCwgXCIxNi85XCIpOyBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogZWxlbWVudF9oZWlnaHQgPSBvLmhlaWdodDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogZWxlbWVudF9oZWlnaHRcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICQuZWFjaChlbGVtZW50LmZpbmQoXCIuaW1hZ2Utd3JhcHBlclwiKSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGVsZW1lbnRfd2lkdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGVsZW1lbnRfaGVpZ2h0XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuaW1hZ2UtY29udGFpbmVyLW92ZXJsYXlcIikuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGVsZW1lbnRfd2lkdGggLyAyXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzbGlkZXIuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBlbGVtZW50X2hlaWdodCAvIDIgLSBzbGlkZXIuaGVpZ2h0KCkgLyAyLFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBlbGVtZW50X3dpZHRoIC8gMiAtIHNsaWRlci53aWR0aCgpIC8gMlxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9LCB7bnM6IHRoaXMuaWR9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgKi9cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5zdGFydCk7XG4gICAgICAgICAgICAkKHdpbmRvdykub2ZmKE1ldHJvLmV2ZW50cy5yZXNpemUsIHtuczogdGhpcy5pZH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgSW1hZ2VHcmlkRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgdXNlQmFja2dyb3VuZDogZmFsc2UsXG4gICAgICAgIGJhY2tncm91bmRTaXplOiBcImNvdmVyXCIsXG4gICAgICAgIGJhY2tncm91bmRQb3NpdGlvbjogXCJ0b3AgbGVmdFwiLFxuXG4gICAgICAgIGNsc0ltYWdlR3JpZDogXCJcIixcbiAgICAgICAgY2xzSW1hZ2VHcmlkSXRlbTogXCJcIixcbiAgICAgICAgY2xzSW1hZ2VHcmlkSW1hZ2U6IFwiXCIsXG5cbiAgICAgICAgb25JdGVtQ2xpY2s6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uRHJhd0l0ZW06IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uSW1hZ2VHcmlkQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmltYWdlR3JpZFNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgSW1hZ2VHcmlkRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBJbWFnZUdyaWREZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0ltYWdlR3JpZFNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8uaW1hZ2VHcmlkU2V0dXAod2luZG93W1wibWV0cm9JbWFnZUdyaWRTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdpbWFnZS1ncmlkJywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIEltYWdlR3JpZERlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICAvLyBkZWZpbmUgaW5zdGFuY2UgdmFycyBoZXJlXG4gICAgICAgICAgICAgICAgaXRlbXM6IFtdXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLml0ZW1zID0gdGhpcy5lbGVtZW50LmNoaWxkcmVuKFwiaW1nXCIpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudCgnaW1hZ2UtZ3JpZC1jcmVhdGUnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlU3RydWN0dXJlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJpbWFnZS1ncmlkXCIpLmFkZENsYXNzKG8uY2xzSW1hZ2VHcmlkKTtcblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlSXRlbXMoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuaW1hZ2UtZ3JpZF9faXRlbVwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcIml0ZW0tY2xpY2tcIiwge1xuICAgICAgICAgICAgICAgICAgICBpdGVtOiB0aGlzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlSXRlbXM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLml0ZW1zO1xuXG4gICAgICAgICAgICBlbGVtZW50LmNsZWFyKCk7XG5cbiAgICAgICAgICAgIGl0ZW1zLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgZWwgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIHZhciBzcmMgPSB0aGlzLnNyYztcbiAgICAgICAgICAgICAgICB2YXIgd3JhcHBlciA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImltYWdlLWdyaWRfX2l0ZW1cIikuYWRkQ2xhc3Moby5jbHNJbWFnZUdyaWRJdGVtKS5hcHBlbmRUbyhlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XG5cbiAgICAgICAgICAgICAgICBpbWcuc3JjID0gc3JjO1xuICAgICAgICAgICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgcG9ydCA9IHRoaXMuaGVpZ2h0ID49IHRoaXMud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIHdyYXBwZXIuYWRkQ2xhc3MocG9ydCA/IFwiaW1hZ2UtZ3JpZF9faXRlbS1wb3J0cmFpdFwiIDogXCJpbWFnZS1ncmlkX19pdGVtLWxhbmRzY2FwZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgZWwuYWRkQ2xhc3Moby5jbHNJbWFnZUdyaWRJbWFnZSkuYXBwZW5kVG8od3JhcHBlcik7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG8udXNlQmFja2dyb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiBcInVybChcIitzcmMrXCIpXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRSZXBlYXQ6IFwibm8tcmVwZWF0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiBvLmJhY2tncm91bmRTaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kUG9zaXRpb246IG8uYmFja2dyb3VuZFBvc2l0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImRhdGEtb3JpZ2luYWxcIiwgZWwuYXR0cihcImRhdGEtb3JpZ2luYWxcIikgfHwgc3JjKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwiZGF0YS10aXRsZVwiLCBlbC5hdHRyKFwiYWx0XCIpIHx8IGVsLmF0dHIoXCJkYXRhLXRpdGxlXCIpIHx8IFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWwudmlzaWJsZShmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJkcmF3LWl0ZW1cIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbTogd3JhcHBlclswXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiBlbFswXVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHIsIHZhbCl7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgaWYgKGF0dHIgPT09IFwiZGF0YS11c2UtYmFja2dyb3VuZFwiKSB7XG4gICAgICAgICAgICAgICAgby51c2VCYWNrZ3JvdW5kID0gVXRpbHMuYm9vbCh2YWwpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUl0ZW1zKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChhdHRyID09PSBcImRhdGEtYmFja2dyb3VuZC1zaXplXCIpIHtcbiAgICAgICAgICAgICAgICBvLmJhY2tncm91bmRTaXplID0gdmFsO1xuICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUl0ZW1zKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChhdHRyID09PSBcImRhdGEtYmFja2dyb3VuZC1wb3NpdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgby5iYWNrZ3JvdW5kUG9zaXRpb24gPSB2YWw7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlSXRlbXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgSW1hZ2VNYWduaWZpZXJEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBpbWFnZW1hZ25pZmllckRlZmVycmVkOiAwLFxuICAgICAgICB3aWR0aDogXCIxMDAlXCIsXG4gICAgICAgIGhlaWdodDogXCJhdXRvXCIsXG4gICAgICAgIGxlbnNTaXplOiAxMDAsXG4gICAgICAgIGxlbnNUeXBlOiBcInNxdWFyZVwiLCAvLyBzcXVhcmUsIGNpcmNsZVxuICAgICAgICBtYWduaWZpZXJab29tOiAyLFxuICAgICAgICBtYWduaWZpZXJNb2RlOiBcImdsYXNzXCIsIC8vIGdsYXNzLCB6b29tXG4gICAgICAgIG1hZ25pZmllclpvb21FbGVtZW50OiBudWxsLFxuXG4gICAgICAgIGNsc01hZ25pZmllcjogXCJcIixcbiAgICAgICAgY2xzTGVuczogXCJcIixcbiAgICAgICAgY2xzWm9vbTogXCJcIixcblxuICAgICAgICBvbk1hZ25pZmllck1vdmU6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uSW1hZ2VNYWduaWZpZXJDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uaW1hZ2VNYWduaWZpZXJTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIEltYWdlTWFnbmlmaWVyRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBJbWFnZU1hZ25pZmllckRlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvSW1hZ2VNYWduaWZpZXJTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmltYWdlTWFnbmlmaWVyU2V0dXAod2luZG93W1wibWV0cm9JbWFnZU1hZ25pZmllclNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ2ltYWdlLW1hZ25pZmllcicsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBJbWFnZU1hZ25pZmllckRlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICB6b29tRWxlbWVudDogbnVsbCxcbiAgICAgICAgICAgICAgICBpZDogVXRpbHMuZWxlbWVudElkKFwiaW1hZ2UtbWFnbmlmaWVyXCIpXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJpbWFnZS1tYWduaWZpZXItY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlU3RydWN0dXJlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgbWFnbmlmaWVyLCBlbGVtZW50X3dpZHRoLCBlbGVtZW50X2hlaWdodDtcbiAgICAgICAgICAgIHZhciBpbWFnZSA9IGVsZW1lbnQuZmluZChcImltZ1wiKTtcblxuICAgICAgICAgICAgaWYgKGltYWdlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkltYWdlIG5vdCBkZWZpbmVkXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUoZWxlbWVudC5hdHRyKFwiaWRcIikpKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwiaWRcIiwgVXRpbHMuZWxlbWVudElkKFwiaW1hZ2UtbWFnbmlmaWVyXCIpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImltYWdlLW1hZ25pZmllclwiKS5jc3Moe1xuICAgICAgICAgICAgICAgIHdpZHRoOiBvLndpZHRoXG4gICAgICAgICAgICB9KS5hZGRDbGFzcyhvLmNsc01hZ25pZmllcik7XG5cbiAgICAgICAgICAgIGVsZW1lbnRfd2lkdGggPSBlbGVtZW50LndpZHRoKCk7XG5cbiAgICAgICAgICAgIHN3aXRjaCAoby5oZWlnaHQpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiMTYvOVwiOiBlbGVtZW50X2hlaWdodCA9IFV0aWxzLmFzcGVjdFJhdGlvSChlbGVtZW50X3dpZHRoLCBvLmhlaWdodCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCIyMS85XCI6IGVsZW1lbnRfaGVpZ2h0ID0gVXRpbHMuYXNwZWN0UmF0aW9IKGVsZW1lbnRfd2lkdGgsIG8uaGVpZ2h0KTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcIjQvM1wiOiBlbGVtZW50X2hlaWdodCA9IFV0aWxzLmFzcGVjdFJhdGlvSChlbGVtZW50X3dpZHRoLCBvLmhlaWdodCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJhdXRvXCI6IGVsZW1lbnRfaGVpZ2h0ID0gVXRpbHMuYXNwZWN0UmF0aW9IKGVsZW1lbnRfd2lkdGgsIFwiMTYvOVwiKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDogZWxlbWVudF9oZWlnaHQgPSBvLmhlaWdodDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgIGhlaWdodDogZWxlbWVudF9oZWlnaHRcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgeCA9IGVsZW1lbnRfd2lkdGggLyAyIC0gby5sZW5zU2l6ZSAvIDI7XG4gICAgICAgICAgICB2YXIgeSA9IGVsZW1lbnRfaGVpZ2h0IC8gMiAtIG8ubGVuc1NpemUgLyAyO1xuXG4gICAgICAgICAgICBpZiAoby5tYWduaWZpZXJNb2RlID09PSBcImdsYXNzXCIpIHtcblxuICAgICAgICAgICAgICAgIG1hZ25pZmllciA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImltYWdlLW1hZ25pZmllci1nbGFzc1wiKS5hcHBlbmRUbyhlbGVtZW50KTtcbiAgICAgICAgICAgICAgICBtYWduaWZpZXIuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG8ubGVuc1NpemUsXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogby5sZW5zU2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiBvLmxlbnNUeXBlICE9PSBcImNpcmNsZVwiID8gMCA6IFwiNTAlXCIsXG4gICAgICAgICAgICAgICAgICAgIHRvcDogeSxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogeCxcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiBcInVybChcIiArIGltYWdlWzBdLnNyYyArIFwiKVwiLFxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kUmVwZWF0OiBcIm5vLXJlcGVhdFwiLFxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kUG9zaXRpb246IFwiLVwiICsgKCh4ICogby5tYWduaWZpZXJab29tKSAtIG8ubGVuc1NpemUgLyA0ICsgNCkgKyBcInB4IC1cIiArICgoeSAqIG8ubWFnbmlmaWVyWm9vbSkgLSBvLmxlbnNTaXplIC8gNCArIDQpICsgXCJweFwiLFxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kU2l6ZTogKGltYWdlWzBdLndpZHRoICogby5tYWduaWZpZXJab29tKSArIFwicHggXCIgKyAoaW1hZ2VbMF0uaGVpZ2h0ICogby5tYWduaWZpZXJab29tKSArIFwicHhcIlxuICAgICAgICAgICAgICAgIH0pLmFkZENsYXNzKG8uY2xzTGVucyk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBtYWduaWZpZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJpbWFnZS1tYWduaWZpZXItZ2xhc3NcIikuYXBwZW5kVG8oZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgbWFnbmlmaWVyLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiBvLmxlbnNTaXplLFxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IG8ubGVuc1NpemUsXG4gICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogMCxcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDEsXG4gICAgICAgICAgICAgICAgICAgIHRvcDogeSxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogeFxuICAgICAgICAgICAgICAgIH0pLmFkZENsYXNzKG8uY2xzTGVucyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUoby5tYWduaWZpZXJab29tRWxlbWVudCkgfHwgJChvLm1hZ25pZmllclpvb21FbGVtZW50KS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy56b29tRWxlbWVudCA9ICQoXCI8ZGl2PlwiKS5pbnNlcnRBZnRlcihlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnpvb21FbGVtZW50ID0gJChvLm1hZ25pZmllclpvb21FbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgem9vbV9lbGVtZW50X3dpZHRoID0gbWFnbmlmaWVyWzBdLm9mZnNldFdpZHRoICogby5tYWduaWZpZXJab29tO1xuICAgICAgICAgICAgICAgIHZhciB6b29tX2VsZW1lbnRfaGVpZ2h0ID0gbWFnbmlmaWVyWzBdLm9mZnNldEhlaWdodCAqIG8ubWFnbmlmaWVyWm9vbTtcbiAgICAgICAgICAgICAgICB2YXIgY3ggPSB6b29tX2VsZW1lbnRfd2lkdGggLyBvLmxlbnNTaXplO1xuICAgICAgICAgICAgICAgIHZhciBjeSA9IHpvb21fZWxlbWVudF9oZWlnaHQgLyBvLmxlbnNTaXplO1xuXG4gICAgICAgICAgICAgICAgdGhpcy56b29tRWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogem9vbV9lbGVtZW50X3dpZHRoLFxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHpvb21fZWxlbWVudF9oZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogXCJ1cmwoXCIgKyBpbWFnZVswXS5zcmMgKyBcIilcIixcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFJlcGVhdDogXCJuby1yZXBlYXRcIixcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFBvc2l0aW9uOiBcIi1cIiArICh4ICogY3gpICsgXCJweCAtXCIgKyAoeSAqIGN5KSArIFwicHhcIixcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6IChpbWFnZVswXS53aWR0aCAqIGN4KSArIFwicHggXCIgKyAoaW1hZ2VbMF0uaGVpZ2h0ICogY3kpICsgXCJweFwiXG4gICAgICAgICAgICAgICAgfSkuYWRkQ2xhc3Moby5jbHNab29tKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGdsYXNzID0gZWxlbWVudC5maW5kKFwiLmltYWdlLW1hZ25pZmllci1nbGFzc1wiKTtcbiAgICAgICAgICAgIHZhciBnbGFzc19zaXplID0gZ2xhc3NbMF0ub2Zmc2V0V2lkdGggLyAyO1xuICAgICAgICAgICAgdmFyIGltYWdlID0gZWxlbWVudC5maW5kKFwiaW1nXCIpWzBdO1xuICAgICAgICAgICAgdmFyIHpvb21FbGVtZW50ID0gdGhpcy56b29tRWxlbWVudDtcbiAgICAgICAgICAgIHZhciBjeCwgY3k7XG5cbiAgICAgICAgICAgICQod2luZG93KS5vbihNZXRyby5ldmVudHMucmVzaXplLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciB4ID0gZWxlbWVudC53aWR0aCgpIC8gMiAtIG8ubGVuc1NpemUgLyAyO1xuICAgICAgICAgICAgICAgIHZhciB5ID0gZWxlbWVudC5oZWlnaHQoKSAvIDIgLSBvLmxlbnNTaXplIC8gMjtcblxuICAgICAgICAgICAgICAgIGlmIChvLm1hZ25pZmllck1vZGUgPT09IFwiZ2xhc3NcIikge1xuICAgICAgICAgICAgICAgICAgICBnbGFzcy5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFBvc2l0aW9uOiBcIi1cIiArICgoeCAqIG8ubWFnbmlmaWVyWm9vbSkgLSBvLmxlbnNTaXplIC8gNCArIDQpICsgXCJweCAtXCIgKyAoKHkgKiBvLm1hZ25pZmllclpvb20pIC0gby5sZW5zU2l6ZSAvIDQgKyA0KSArIFwicHhcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiAoaW1hZ2Uud2lkdGggKiBvLm1hZ25pZmllclpvb20pICsgXCJweCBcIiArIChpbWFnZS5oZWlnaHQgKiBvLm1hZ25pZmllclpvb20pICsgXCJweFwiXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHtuczogdGhpcy5pZH0pXG5cbiAgICAgICAgICAgIGlmIChvLm1hZ25pZmllck1vZGUgIT09IFwiZ2xhc3NcIikge1xuICAgICAgICAgICAgICAgIGN4ID0gem9vbUVsZW1lbnRbMF0ub2Zmc2V0V2lkdGggLyBnbGFzc19zaXplIC8gMjtcbiAgICAgICAgICAgICAgICBjeSA9IHpvb21FbGVtZW50WzBdLm9mZnNldEhlaWdodCAvIGdsYXNzX3NpemUgLyAyO1xuXG4gICAgICAgICAgICAgICAgem9vbUVsZW1lbnQuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6IChpbWFnZS53aWR0aCAqIGN4KSArIFwicHggXCIgKyAoaW1hZ2UuaGVpZ2h0ICogY3kpICsgXCJweFwiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBsZW5zX21vdmUgPSBmdW5jdGlvbihwb3Mpe1xuICAgICAgICAgICAgICAgIHZhciB4LCB5O1xuICAgICAgICAgICAgICAgIHZhciBtYWdpYyA9IDQsIHpvb20gPSBwYXJzZUludChvLm1hZ25pZmllclpvb20pO1xuXG4gICAgICAgICAgICAgICAgaWYgKG8ubWFnbmlmaWVyTW9kZSA9PT0gXCJnbGFzc1wiKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgeCA9IHBvcy54O1xuICAgICAgICAgICAgICAgICAgICB5ID0gcG9zLnk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHggPiBpbWFnZS53aWR0aCAtIChnbGFzc19zaXplIC8gem9vbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHggPSBpbWFnZS53aWR0aCAtIChnbGFzc19zaXplIC8gem9vbSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHggPCBnbGFzc19zaXplIC8gem9vbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgeCA9IGdsYXNzX3NpemUgLyB6b29tO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh5ID4gaW1hZ2UuaGVpZ2h0IC0gKGdsYXNzX3NpemUgLyB6b29tKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgeSA9IGltYWdlLmhlaWdodCAtIChnbGFzc19zaXplIC8gem9vbSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHkgPCBnbGFzc19zaXplIC8gem9vbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgeSA9IGdsYXNzX3NpemUgLyB6b29tO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgZ2xhc3MuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogeSAtIGdsYXNzX3NpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiB4IC0gZ2xhc3Nfc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRQb3NpdGlvbjogXCItXCIgKyAoKHggKiB6b29tKSAtIGdsYXNzX3NpemUgKyBtYWdpYykgKyBcInB4IC1cIiArICgoeSAqIHpvb20pIC0gZ2xhc3Nfc2l6ZSArIG1hZ2ljKSArIFwicHhcIlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIHggPSBwb3MueCAtIChnbGFzc19zaXplKTtcbiAgICAgICAgICAgICAgICAgICAgeSA9IHBvcy55IC0gKGdsYXNzX3NpemUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh4ID4gaW1hZ2Uud2lkdGggLSBnbGFzc19zaXplICogMikge3ggPSBpbWFnZS53aWR0aCAtIGdsYXNzX3NpemUgKiAyO31cbiAgICAgICAgICAgICAgICAgICAgaWYgKHggPCAwKSB7eCA9IDA7fVxuICAgICAgICAgICAgICAgICAgICBpZiAoeSA+IGltYWdlLmhlaWdodCAtIGdsYXNzX3NpemUgKiAyKSB7eSA9IGltYWdlLmhlaWdodCAtIGdsYXNzX3NpemUgKiAyO31cbiAgICAgICAgICAgICAgICAgICAgaWYgKHkgPCAwKSB7eSA9IDA7fVxuXG4gICAgICAgICAgICAgICAgICAgIGdsYXNzLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3A6IHksXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiB4XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHpvb21FbGVtZW50LmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kUG9zaXRpb246IFwiLVwiICsgKHggKiBjeCkgKyBcInB4IC1cIiArICh5ICogY3kpICsgXCJweFwiXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLm1vdmUsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIHZhciBwb3MgPSBVdGlscy5nZXRDdXJzb3JQb3NpdGlvbihpbWFnZSwgZSk7XG5cbiAgICAgICAgICAgICAgICBsZW5zX21vdmUocG9zKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcIm1hZ25pZmllci1tb3ZlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zOiBwb3MsXG4gICAgICAgICAgICAgICAgICAgIGdsYXNzOiBnbGFzc1swXSxcbiAgICAgICAgICAgICAgICAgICAgem9vbUVsZW1lbnQ6IHpvb21FbGVtZW50ID8gem9vbUVsZW1lbnRbMF0gOiB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5sZWF2ZSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgeCA9IGVsZW1lbnQud2lkdGgoKSAvIDIgLSBvLmxlbnNTaXplIC8gMjtcbiAgICAgICAgICAgICAgICB2YXIgeSA9IGVsZW1lbnQuaGVpZ2h0KCkgLyAyIC0gby5sZW5zU2l6ZSAvIDI7XG5cbiAgICAgICAgICAgICAgICBnbGFzcy5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiB5LFxuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogeFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBsZW5zX21vdmUoe1xuICAgICAgICAgICAgICAgICAgICB4OiB4ICsgby5sZW5zU2l6ZSAvIDIsIHk6IHkgKyBvLmxlbnNTaXplIC8gMlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lICovXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSl7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLm1vdmUpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmxlYXZlKTtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBJbWFnZVBsYWNlaG9sZGVyRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgc2l6ZTogXCIxMDB4MTAwXCIsXG4gICAgICAgIHdpZHRoOiBudWxsLFxuICAgICAgICBoZWlnaHQ6IG51bGwsXG4gICAgICAgIGNvbG9yOiBcIiNmOGY4ZjhcIixcbiAgICAgICAgdGV4dENvbG9yOiBcIiMyOTI5MjlcIixcbiAgICAgICAgZm9udDogXCIxMnB4IHNhbnMtc2VyaWZcIixcbiAgICAgICAgdGV4dDogXCJcIixcbiAgICAgICAgc2hvd1RleHQ6IHRydWUsXG4gICAgICAgIG9uSW1hZ2VQbGFjZWhvbGRlckNyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5pbWFnZVBsYWNlaG9sZGVyU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBJbWFnZVBsYWNlaG9sZGVyRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBJbWFnZVBsYWNlaG9sZGVyRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9JbWFnZVBsYWNlaG9sZGVyU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5pbWFnZVBsYWNlaG9sZGVyU2V0dXAod2luZG93W1wibWV0cm9JbWFnZVBsYWNlaG9sZGVyU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnaW1hZ2UtcGxhY2Vob2xkZXInLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgSW1hZ2VQbGFjZWhvbGRlckRlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICAvLyBkZWZpbmUgaW5zdGFuY2UgdmFycyBoZXJlXG4gICAgICAgICAgICAgICAgd2lkdGg6IDAsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoJ2ltYWdlLXBsYWNlaG9sZGVyLWNyZWF0ZScpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBzaXplID0gby5zaXplLnRvQXJyYXkoXCJ4XCIpO1xuXG4gICAgICAgICAgICB0aGlzLndpZHRoID0gby53aWR0aCA/IG8ud2lkdGggOiBzaXplWzBdO1xuICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSBvLmhlaWdodCA/IG8uaGVpZ2h0IDogc2l6ZVsxXTtcblxuICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwic3JjXCIsIHRoaXMuX2NyZWF0ZVBsYWNlaG9sZGVyKCkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVBsYWNlaG9sZGVyOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKSxcbiAgICAgICAgICAgICAgICBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcblxuICAgICAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aCwgaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG5cbiAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IHBhcnNlSW50KHdpZHRoKTtcbiAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBwYXJzZUludChoZWlnaHQpO1xuXG4gICAgICAgICAgICAvLyBiYWNrZ3JvdW5kXG4gICAgICAgICAgICBjb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gby5jb2xvcjtcbiAgICAgICAgICAgIGNvbnRleHQuZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICAgICAgICAgIC8vIHRleHRcbiAgICAgICAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gby50ZXh0Q29sb3I7XG4gICAgICAgICAgICBjb250ZXh0LmZvbnQgPSBvLmZvbnQ7XG5cbiAgICAgICAgICAgIGNvbnRleHQudHJhbnNsYXRlKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMik7XG4gICAgICAgICAgICBjb250ZXh0LnRleHRBbGlnbiA9ICdjZW50ZXInO1xuICAgICAgICAgICAgY29udGV4dC50ZXh0QmFzZWxpbmUgPSAnbWlkZGxlJztcblxuICAgICAgICAgICAgaWYgKG8uc2hvd1RleHQpXG4gICAgICAgICAgICAgICAgY29udGV4dC5maWxsVGV4dChvLnRleHQgPyBvLnRleHQgOiB3aWR0aCArIFwiIFxcdTAwZDcgXCIgKyBoZWlnaHQsIDAsIDApO1xuXG4gICAgICAgICAgICByZXR1cm4gY2FudmFzLnRvRGF0YVVSTCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0ciwgbmV3VmFsdWUpe1xuICAgICAgICAvLyB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBJbmZvQm94RGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgaW5mb2JveERlZmVycmVkOiAwLFxuICAgICAgICB0eXBlOiBcIlwiLFxuICAgICAgICB3aWR0aDogNDgwLFxuICAgICAgICBoZWlnaHQ6IFwiYXV0b1wiLFxuICAgICAgICBvdmVybGF5OiB0cnVlLFxuICAgICAgICBvdmVybGF5Q29sb3I6ICcjMDAwMDAwJyxcbiAgICAgICAgb3ZlcmxheUFscGhhOiAuNSxcbiAgICAgICAgb3ZlcmxheUNsaWNrQ2xvc2U6IGZhbHNlLFxuICAgICAgICBhdXRvSGlkZTogMCxcbiAgICAgICAgcmVtb3ZlT25DbG9zZTogZmFsc2UsXG4gICAgICAgIGNsb3NlQnV0dG9uOiB0cnVlLFxuICAgICAgICBjbHNCb3g6IFwiXCIsXG4gICAgICAgIGNsc0JveENvbnRlbnQ6IFwiXCIsXG4gICAgICAgIGNsc092ZXJsYXk6IFwiXCIsXG4gICAgICAgIG9uT3BlbjogTWV0cm8ubm9vcCxcbiAgICAgICAgb25DbG9zZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25JbmZvQm94Q3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmluZm9Cb3hTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIEluZm9Cb3hEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIEluZm9Cb3hEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0luZm9Cb3hTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmluZm9Cb3hTZXR1cCh3aW5kb3dbXCJtZXRyb0luZm9Cb3hTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdpbmZvLWJveCcsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBJbmZvQm94RGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIG92ZXJsYXk6IG51bGwsXG4gICAgICAgICAgICAgICAgaWQ6IFV0aWxzLmVsZW1lbnRJZChcImluZm8tYm94XCIpXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJpbmZvLWJveC1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9vdmVybGF5OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIHZhciBvdmVybGF5ID0gJChcIjxkaXY+XCIpO1xuICAgICAgICAgICAgb3ZlcmxheS5hZGRDbGFzcyhcIm92ZXJsYXlcIikuYWRkQ2xhc3Moby5jbHNPdmVybGF5KTtcblxuICAgICAgICAgICAgaWYgKG8ub3ZlcmxheUNvbG9yID09PSAndHJhbnNwYXJlbnQnKSB7XG4gICAgICAgICAgICAgICAgb3ZlcmxheS5hZGRDbGFzcyhcInRyYW5zcGFyZW50XCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvdmVybGF5LmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IE1ldHJvLmNvbG9ycy50b1JHQkEoby5vdmVybGF5Q29sb3IsIG8ub3ZlcmxheUFscGhhKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gb3ZlcmxheTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlU3RydWN0dXJlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY2xvc2VyLCBjb250ZW50O1xuXG4gICAgICAgICAgICBpZiAoby5vdmVybGF5ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vdmVybGF5ID0gdGhpcy5fb3ZlcmxheSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwiaW5mby1ib3hcIikuYWRkQ2xhc3Moby50eXBlKS5hZGRDbGFzcyhvLmNsc0JveCk7XG5cbiAgICAgICAgICAgIGNsb3NlciA9IGVsZW1lbnQuZmluZChcImNsb3NlclwiKTtcbiAgICAgICAgICAgIGlmIChjbG9zZXIubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgY2xvc2VyID0gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcImJ1dHRvbiBzcXVhcmUgY2xvc2VyXCIpO1xuICAgICAgICAgICAgICAgIGNsb3Nlci5hcHBlbmRUbyhlbGVtZW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uY2xvc2VCdXR0b24gIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBjbG9zZXIuaGlkZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb250ZW50ID0gZWxlbWVudC5maW5kKFwiLmluZm8tYm94LWNvbnRlbnRcIik7XG4gICAgICAgICAgICBpZiAoY29udGVudC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29udGVudC5hZGRDbGFzcyhvLmNsc0JveENvbnRlbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LmNzcyh7XG4gICAgICAgICAgICAgICAgd2lkdGg6IG8ud2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBvLmhlaWdodCxcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiBcImhpZGRlblwiLFxuICAgICAgICAgICAgICAgIHRvcDogJzEwMCUnLFxuICAgICAgICAgICAgICAgIGxlZnQ6ICggJCh3aW5kb3cpLndpZHRoKCkgLSBlbGVtZW50Lm91dGVyV2lkdGgoKSApIC8gMlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kVG8oJCgnYm9keScpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuY2xvc2VyXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5jbG9zZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5qcy1kaWFsb2ctY2xvc2VcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0LmNsb3NlKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKE1ldHJvLmV2ZW50cy5yZXNpemUsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5yZXBvc2l0aW9uKCk7XG4gICAgICAgICAgICB9LCB7bnM6IHRoaXMuaWR9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfc2V0UG9zaXRpb246IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIGVsZW1lbnQuY3NzKHtcbiAgICAgICAgICAgICAgICB0b3A6ICggJCh3aW5kb3cpLmhlaWdodCgpIC0gZWxlbWVudC5vdXRlckhlaWdodCgpICkgLyAyLFxuICAgICAgICAgICAgICAgIGxlZnQ6ICggJCh3aW5kb3cpLndpZHRoKCkgLSBlbGVtZW50Lm91dGVyV2lkdGgoKSApIC8gMlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVwb3NpdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuX3NldFBvc2l0aW9uKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0Q29udGVudDogZnVuY3Rpb24oYyl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBjb250ZW50ID0gZWxlbWVudC5maW5kKFwiLmluZm8tYm94LWNvbnRlbnRcIik7XG4gICAgICAgICAgICBpZiAoY29udGVudC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29udGVudC5odG1sKGMpO1xuICAgICAgICAgICAgdGhpcy5yZXBvc2l0aW9uKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0VHlwZTogZnVuY3Rpb24odCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJzdWNjZXNzIGluZm8gYWxlcnQgd2FybmluZ1wiKS5hZGRDbGFzcyh0KTtcbiAgICAgICAgfSxcblxuICAgICAgICBvcGVuOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICAvLyBpZiAoby5vdmVybGF5ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAvLyAgICAgdGhpcy5vdmVybGF5LmFwcGVuZFRvKCQoXCJib2R5XCIpKTtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIGlmIChvLm92ZXJsYXkgPT09IHRydWUgJiYgJChcIi5vdmVybGF5XCIpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMub3ZlcmxheS5hcHBlbmRUbygkKFwiYm9keVwiKSk7XG4gICAgICAgICAgICAgICAgaWYgKG8ub3ZlcmxheUNsaWNrQ2xvc2UgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vdmVybGF5Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9zZXRQb3NpdGlvbigpO1xuXG4gICAgICAgICAgICBlbGVtZW50LmNzcyh7XG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogXCJ2aXNpYmxlXCJcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJvcGVuXCIpO1xuXG4gICAgICAgICAgICBlbGVtZW50LmRhdGEoXCJvcGVuXCIsIHRydWUpO1xuXG4gICAgICAgICAgICBpZiAocGFyc2VJbnQoby5hdXRvSGlkZSkgPiAwKSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSwgcGFyc2VJbnQoby5hdXRvSGlkZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNsb3NlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmIChvLm92ZXJsYXkgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAkKCdib2R5JykuZmluZCgnLm92ZXJsYXknKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6IFwiaGlkZGVuXCIsXG4gICAgICAgICAgICAgICAgdG9wOiBcIjEwMCVcIlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImNsb3NlXCIpO1xuXG4gICAgICAgICAgICBlbGVtZW50LmRhdGEoXCJvcGVuXCIsIGZhbHNlKTtcblxuICAgICAgICAgICAgaWYgKG8ucmVtb3ZlT25DbG9zZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNPcGVuOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5kYXRhKFwib3BlblwiKSA9PT0gdHJ1ZTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgKi9cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKFwiYWxsXCIpO1xuICAgICAgICAgICAgJCh3aW5kb3cpLm9mZihNZXRyby5ldmVudHMucmVzaXplLCB7bnM6IHRoaXMuaWR9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIE1ldHJvWydpbmZvYm94J10gPSB7XG4gICAgICAgIGlzSW5mb0JveDogZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgcmV0dXJuIFV0aWxzLmlzTWV0cm9PYmplY3QoZWwsIFwiaW5mb2JveFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvcGVuOiBmdW5jdGlvbihlbCwgYywgdCl7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNJbmZvQm94KGVsKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBpYiA9IE1ldHJvLmdldFBsdWdpbihlbCwgXCJpbmZvYm94XCIpO1xuICAgICAgICAgICAgaWYgKGMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGliLnNldENvbnRlbnQoYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWIuc2V0VHlwZSh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGliLm9wZW4oKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjbG9zZTogZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzSW5mb0JveChlbCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgaWIgPSBNZXRyby5nZXRQbHVnaW4oZWwsIFwiaW5mb2JveFwiKTtcbiAgICAgICAgICAgIGliLmNsb3NlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0Q29udGVudDogZnVuY3Rpb24oZWwsIGMpe1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzSW5mb0JveChlbCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChjID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBjID0gXCJcIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGliID0gTWV0cm8uZ2V0UGx1Z2luKGVsLCBcImluZm9ib3hcIik7XG4gICAgICAgICAgICBpYi5zZXRDb250ZW50KGMpO1xuICAgICAgICAgICAgaWIucmVwb3NpdGlvbigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldFR5cGU6IGZ1bmN0aW9uKGVsLCB0KXtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0luZm9Cb3goZWwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgaWIgPSBNZXRyby5nZXRQbHVnaW4oZWwsIFwiaW5mb2JveFwiKTtcbiAgICAgICAgICAgIGliLnNldFR5cGUodCk7XG4gICAgICAgICAgICBpYi5yZXBvc2l0aW9uKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNPcGVuOiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNJbmZvQm94KGVsKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBpYiA9IE1ldHJvLmdldFBsdWdpbihlbCwgXCJpbmZvYm94XCIpO1xuICAgICAgICAgICAgcmV0dXJuIGliLmlzT3BlbigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNyZWF0ZTogZnVuY3Rpb24oYywgdCwgbywgb3Blbil7XG4gICAgICAgICAgICB2YXIgJCQgPSBVdGlscy4kKCk7XG4gICAgICAgICAgICB2YXIgZWwsIGliLCBib3hfdHlwZTtcblxuICAgICAgICAgICAgYm94X3R5cGUgPSB0ICE9PSB1bmRlZmluZWQgPyB0IDogXCJcIjtcblxuICAgICAgICAgICAgZWwgPSAkJChcIjxkaXY+XCIpLmFwcGVuZFRvKCQkKFwiYm9keVwiKSk7XG4gICAgICAgICAgICAkJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiaW5mby1ib3gtY29udGVudFwiKS5hcHBlbmRUbyhlbCk7XG5cbiAgICAgICAgICAgIHZhciBpYl9vcHRpb25zID0gJCQuZXh0ZW5kKHt9LCB7XG4gICAgICAgICAgICAgICAgcmVtb3ZlT25DbG9zZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0eXBlOiBib3hfdHlwZVxuICAgICAgICAgICAgfSwgKG8gIT09IHVuZGVmaW5lZCA/IG8gOiB7fSkpO1xuXG4gICAgICAgICAgICBpYl9vcHRpb25zLl9ydW50aW1lID0gdHJ1ZTtcblxuICAgICAgICAgICAgZWwuaW5mb2JveChpYl9vcHRpb25zKTtcblxuICAgICAgICAgICAgaWIgPSBNZXRyby5nZXRQbHVnaW4oZWwsICdpbmZvYm94Jyk7XG4gICAgICAgICAgICBpYi5zZXRDb250ZW50KGMpO1xuICAgICAgICAgICAgaWYgKG9wZW4gIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgaWIub3BlbigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZWw7XG4gICAgICAgIH1cbiAgICB9O1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgSW5wdXRNYXNrRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgbWFza1BhdHRlcm46IFwiLlwiLFxuICAgICAgICBtYXNrOiBudWxsLFxuICAgICAgICBtYXNrUGxhY2Vob2xkZXI6IFwiX1wiLFxuICAgICAgICBtYXNrRWRpdGFibGVTdGFydDogMCxcbiAgICAgICAgdGhyZXNob2xkSW50ZXJ2YWw6IDMwMCxcbiAgICAgICAgb25DaGFyOiBNZXRyby5ub29wLFxuICAgICAgICBvbklucHV0TWFza0NyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5pbnB1dE1hc2tTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIElucHV0TWFza0RlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgSW5wdXRNYXNrRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9JbnB1dE1hc2tTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmlucHV0TWFza1NldHVwKHdpbmRvd1tcIm1ldHJvSW5wdXRNYXNrU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnaW5wdXQtbWFzaycsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICBpZiAoJC5kZXZpY2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbS5zZXRBdHRyaWJ1dGUpIGVsZW0uc2V0QXR0cmlidXRlKFwicGxhY2Vob2xkZXJcIiwgb3B0aW9ucy5tYXNrKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJUaGUgY29tcG9uZW50IGlucHV0LW1hc2sgY2FuJ3QgYmUgaW5pdGlhbGl6ZWQsIGJlY2F1c2UgeW91IHJ1biBpdCBvbiBhIG1vYmlsZSBkZXZpY2UhXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBJbnB1dE1hc2tEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgLy8gZGVmaW5lIGluc3RhbmNlIHZhcnMgaGVyZVxuICAgICAgICAgICAgICAgIHBhdHRlcm46IG51bGwsXG4gICAgICAgICAgICAgICAgbWFzazogXCJcIixcbiAgICAgICAgICAgICAgICBtYXNrQXJyYXk6IFtdLFxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBcIlwiLFxuICAgICAgICAgICAgICAgIGxlbmd0aDogMCxcbiAgICAgICAgICAgICAgICB0aHJlc2hvbGRUaW1lcjogbnVsbCxcbiAgICAgICAgICAgICAgICBpZDogVXRpbHMuZWxlbWVudElkKFwiaW5wdXQtbWFza1wiKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KCdpbnB1dC1tYXNrLWNyZWF0ZScpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgaWYgKCFvLm1hc2spIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1lvdSBtdXN0IHByb3ZpZGUgYSBwYXR0ZXJuIGZvciBtYXNrZWQgaW5wdXQuJylcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvLm1hc2tQbGFjZWhvbGRlciAhPT0gJ3N0cmluZycgfHwgby5tYXNrUGxhY2Vob2xkZXIubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTWFzayBwbGFjZWhvbGRlciBzaG91bGQgYmUgYSBzaW5nbGUgY2hhcmFjdGVyIG9yIGFuIGVtcHR5IHN0cmluZy4nKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gby5tYXNrUGxhY2Vob2xkZXI7XG4gICAgICAgICAgICB0aGlzLm1hc2sgPSAoXCJcIitvLm1hc2spO1xuICAgICAgICAgICAgdGhpcy5tYXNrQXJyYXkgPSB0aGlzLm1hc2suc3BsaXQoXCJcIik7XG4gICAgICAgICAgICB0aGlzLnBhdHRlcm4gPSBuZXcgUmVnRXhwKFwiXlwiK28ubWFza1BhdHRlcm4rXCIrJFwiKTtcbiAgICAgICAgICAgIHRoaXMubGVuZ3RoID0gdGhpcy5tYXNrLmxlbmd0aDtcblxuICAgICAgICAgICAgdGhpcy5fc2hvd1ZhbHVlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBlZGl0YWJsZVN0YXJ0ID0gby5tYXNrRWRpdGFibGVTdGFydDtcbiAgICAgICAgICAgIHZhciBpZCA9IHRoaXMuaWQ7XG5cbiAgICAgICAgICAgIHZhciBjaGVja0VkaXRhYmxlUG9zaXRpb24gPSBmdW5jdGlvbihwb3Mpe1xuICAgICAgICAgICAgICAgIGlmIChwb3MgPCBlZGl0YWJsZVN0YXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFBvc2l0aW9uKGVkaXRhYmxlU3RhcnQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgY2hlY2tFZGl0YWJsZUNoYXIgPSBmdW5jdGlvbihwb3Mpe1xuICAgICAgICAgICAgICAgIHJldHVybiBwb3MgPCB0aGF0Lm1hc2subGVuZ3RoICYmIHRoYXQubWFzay5jaGFyQXQocG9zKSA9PT0gdGhhdC5wbGFjZWhvbGRlcjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGZpbmROZXh0RWRpdGFibGVQb3NpdGlvbiA9IGZ1bmN0aW9uIChwb3Mpe1xuICAgICAgICAgICAgICAgIHZhciBpLCBhID0gdGhhdC5tYXNrQXJyYXk7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGkgPSBwb3M7IGkgPD0gYS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYVtpXSA9PT0gdGhhdC5wbGFjZWhvbGRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBvcztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNldFBvc2l0aW9uID0gZnVuY3Rpb24ocG9zKXtcbiAgICAgICAgICAgICAgICB0aGF0LmVsZW0uc2V0U2VsZWN0aW9uUmFuZ2UocG9zLCBwb3MpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgY2xlYXJUaHJlc2hvbGRJbnRlcnZhbCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGF0LnRocmVzaG9sZFRpbWVyKTtcbiAgICAgICAgICAgICAgICB0aGF0LnRocmVzaG9sZFRpbWVyID0gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5vbihcImNoYW5nZVwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlID09PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGF0Lm1hc2s7XG4gICAgICAgICAgICAgICAgICAgIHNldFBvc2l0aW9uKGVkaXRhYmxlU3RhcnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHtuczogaWR9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihcImZvY3VzIGNsaWNrXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgY2hlY2tFZGl0YWJsZVBvc2l0aW9uKHRoaXMuc2VsZWN0aW9uU3RhcnQpO1xuICAgICAgICAgICAgICAgIHNldFBvc2l0aW9uKGZpbmROZXh0RWRpdGFibGVQb3NpdGlvbih0aGlzLnNlbGVjdGlvblN0YXJ0KSk7XG4gICAgICAgICAgICB9LCB7bnM6IGlkfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oXCJrZXlkb3duXCIsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIHZhciBwb3MgPSB0aGlzLnNlbGVjdGlvblN0YXJ0O1xuICAgICAgICAgICAgICAgIHZhciB2YWwgPSB0aGlzLnZhbHVlO1xuICAgICAgICAgICAgICAgIHZhciBjb2RlID0gZS5jb2RlLCBrZXkgPSBlLmtleTtcblxuICAgICAgICAgICAgICAgIGlmIChjb2RlID09PSBcIkFycm93UmlnaHRcIiB8fCBjb2RlID09PSBcIkVuZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwb3MgPj0gdGhhdC5sZW5ndGggJiYgKFtcIkJhY2tzcGFjZVwiLCBcIkhvbWVcIiwgXCJBcnJvd0xlZnRcIiwgXCJBcnJvd1VwXCJdLmluZGV4T2YoY29kZSkgPT09IC0xKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG9uJ3QgbW92ZSBvdmVyIG1hc2sgbGVuZ3RoXG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29kZSA9PT0gXCJIb21lXCIgfHwgY29kZSA9PT0gXCJBcnJvd1VwXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEdvdG8gZWRpdGFibGUgc3RhcnQgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFBvc2l0aW9uKGVkaXRhYmxlU3RhcnQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPT09IFwiQXJyb3dMZWZ0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3MgLSAxIDwgZWRpdGFibGVTdGFydCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvbid0IG1vdmUgYmVoaW5kIGEgZWRpdGFibGUgc3RhcnQgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29kZSA9PT0gXCJCYWNrc3BhY2VcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBvcyAtIDEgPj0gZWRpdGFibGVTdGFydCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGVja0VkaXRhYmxlQ2hhcihwb3MgLSAxKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy52YWx1ZS5jaGFyQXQocG9zIC0gMSkgIT09IHRoYXQucGxhY2Vob2xkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlcGxhY2UgY2hhciBpZiBpdCBpcyBub3QgYSBtYXNrIHBsYWNlaG9sZGVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsLnN1YnN0cigwLCBwb3MgLSAxKSArIHRoYXQucGxhY2Vob2xkZXIgKyB2YWwuc3Vic3RyKHBvcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTW92ZSB0byBwcmV2IGNoYXIgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRQb3NpdGlvbihwb3MgLSAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb2RlID09PSBcIlNwYWNlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFBvc2l0aW9uKHBvcyArIDEpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF0aGF0LnBhdHRlcm4udGVzdChrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tFZGl0YWJsZUNoYXIocG9zKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWwuc3Vic3RyKDAsIHBvcykgKyAoby5vbkNoYXIgPT09IE1ldHJvLm5vb3AgPyBrZXkgOiBVdGlscy5leGVjKG8ub25DaGFyLCBba2V5XSwgdGhpcykpICsgdmFsLnN1YnN0cihwb3MgKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRQb3NpdGlvbihmaW5kTmV4dEVkaXRhYmxlUG9zaXRpb24ocG9zICsgMSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwge25zOiBpZH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKFwia2V5dXBcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgZWwgPSB0aGlzO1xuXG4gICAgICAgICAgICAgICAgY2xlYXJUaHJlc2hvbGRJbnRlcnZhbCgpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC50aHJlc2hvbGRUaW1lciA9IHNldEludGVydmFsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGhyZXNob2xkSW50ZXJ2YWwoKTtcbiAgICAgICAgICAgICAgICAgICAgc2V0UG9zaXRpb24oZmluZE5leHRFZGl0YWJsZVBvc2l0aW9uKGVsLnNlbGVjdGlvblN0YXJ0KSk7XG4gICAgICAgICAgICAgICAgfSwgby50aHJlc2hvbGRJbnRlcnZhbClcbiAgICAgICAgICAgIH0sIHtuczogaWR9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfc2hvd1ZhbHVlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtID0gdGhpcy5lbGVtO1xuICAgICAgICAgICAgdmFyIGEgPSBuZXcgQXJyYXkodGhpcy5sZW5ndGgpO1xuICAgICAgICAgICAgdmFyIHZhbDtcbiAgICAgICAgICAgIGlmICghZWxlbS52YWx1ZSkge1xuICAgICAgICAgICAgICAgIGVsZW0udmFsdWUgPSB0aGlzLm1hc2s7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhbCA9IGVsZW0udmFsdWU7XG4gICAgICAgICAgICAgICAgJC5lYWNoKHRoaXMubWFza0FycmF5LCBmdW5jdGlvbihpLCB2KXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbFtpXSAhPT0gdiAmJiAhdGhhdC5wYXR0ZXJuLnRlc3QodmFsW2ldKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYVtpXSA9IHRoYXQucGxhY2Vob2xkZXI7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhW2ldID0gdmFsW2ldO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtLnZhbHVlID0gYS5qb2luKFwiXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgaWQgPSB0aGlzLmlkO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9mZihcImNoYW5nZVwiLCB7bnM6IGlkfSk7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihcImZvY3VzXCIsIHtuczogaWR9KTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKFwiY2xpY2tcIiwge25zOiBpZH0pO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoXCJrZXlkb3duXCIsIHtuczogaWR9KTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKFwia2V5dXBcIiwge25zOiBpZH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XG5cclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgTWF0ZXJpYWxJbnB1dERlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIG1hdGVyaWFsaW5wdXREZWZlcnJlZDogMCxcbiAgICAgICAgbGFiZWw6IFwiXCIsXG4gICAgICAgIGluZm9ybWVyOiBcIlwiLFxuICAgICAgICBpY29uOiBcIlwiLFxuXG4gICAgICAgIHBlcm1hbmVudExhYmVsOiBmYWxzZSxcblxuICAgICAgICBjbHNDb21wb25lbnQ6IFwiXCIsXG4gICAgICAgIGNsc0lucHV0OiBcIlwiLFxuICAgICAgICBjbHNMYWJlbDogXCJcIixcbiAgICAgICAgY2xzSW5mb3JtZXI6IFwiXCIsXG4gICAgICAgIGNsc0ljb246IFwiXCIsXG4gICAgICAgIGNsc0xpbmU6IFwiXCIsXG5cbiAgICAgICAgb25JbnB1dENyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5tYXRlcmlhbElucHV0U2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBNYXRlcmlhbElucHV0RGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBNYXRlcmlhbElucHV0RGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9NYXRlcmlhbElucHV0U2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5tYXRlcmlhbElucHV0U2V0dXAod2luZG93W1wibWV0cm9NYXRlcmlhbElucHV0U2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnbWF0ZXJpYWwtaW5wdXQnLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgTWF0ZXJpYWxJbnB1dERlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICBoaXN0b3J5OiBbXSxcbiAgICAgICAgICAgICAgICBoaXN0b3J5SW5kZXg6IC0xXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJpbnB1dC1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJpbnB1dC1tYXRlcmlhbCBcIiArIGVsZW1lbnRbMF0uY2xhc3NOYW1lKTtcblxuICAgICAgICAgICAgZWxlbWVudFswXS5jbGFzc05hbWUgPSBcIlwiO1xuICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwiYXV0b2NvbXBsZXRlXCIsIFwibm9wZVwiKTtcblxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuYXR0cihcInR5cGVcIikgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcInR5cGVcIiwgXCJ0ZXh0XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKGVsZW1lbnQpO1xuICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRUbyhjb250YWluZXIpO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLmxhYmVsKSkge1xuICAgICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuaHRtbChvLmxhYmVsKS5hZGRDbGFzcyhcImxhYmVsXCIpLmFkZENsYXNzKG8uY2xzTGFiZWwpLmluc2VydEFmdGVyKGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5pbmZvcm1lcikpIHtcbiAgICAgICAgICAgICAgICAkKFwiPHNwYW4+XCIpLmh0bWwoby5pbmZvcm1lcikuYWRkQ2xhc3MoXCJpbmZvcm1lclwiKS5hZGRDbGFzcyhvLmNsc0luZm9ybWVyKS5pbnNlcnRBZnRlcihlbGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8uaWNvbikpIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJ3aXRoLWljb25cIik7XG4gICAgICAgICAgICAgICAgJChcIjxzcGFuPlwiKS5odG1sKG8uaWNvbikuYWRkQ2xhc3MoXCJpY29uXCIpLmFkZENsYXNzKG8uY2xzSWNvbikuaW5zZXJ0QWZ0ZXIoZWxlbWVudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmQoJChcIjxocj5cIikuYWRkQ2xhc3Moby5jbHNMaW5lKSk7XG5cbiAgICAgICAgICAgIGlmIChvLnBlcm1hbmVudExhYmVsID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwicGVybWFuZW50LWxhYmVsXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb250YWluZXIuYWRkQ2xhc3Moby5jbHNDb21wb25lbnQpO1xuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhvLmNsc0lucHV0KTtcblxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuaXMoXCI6ZGlzYWJsZWRcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmFibGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xlYXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQudmFsKCcnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkaXNhYmxlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmRhdGEoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnQoKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGVuYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwiZGlzYWJsZWRcIiwgZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnBhcmVudCgpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlU3RhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiAodGhpcy5lbGVtLmRpc2FibGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGVOYW1lID09PSAnZGlzYWJsZWQnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50b2dnbGVTdGF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgSW5wdXREZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBpbnB1dERlZmVycmVkOiAwLFxuXG4gICAgICAgIGxhYmVsOiBcIlwiLFxuXG4gICAgICAgIGF1dG9jb21wbGV0ZTogbnVsbCxcbiAgICAgICAgYXV0b2NvbXBsZXRlVXJsOiBudWxsLFxuICAgICAgICBhdXRvY29tcGxldGVVcmxNZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgIGF1dG9jb21wbGV0ZVVybEtleTogbnVsbCxcbiAgICAgICAgYXV0b2NvbXBsZXRlRGl2aWRlcjogXCIsXCIsXG4gICAgICAgIGF1dG9jb21wbGV0ZUxpc3RIZWlnaHQ6IDIwMCxcblxuICAgICAgICBoaXN0b3J5OiBmYWxzZSxcbiAgICAgICAgaGlzdG9yeVByZXNldDogXCJcIixcbiAgICAgICAgaGlzdG9yeURpdmlkZXI6IFwifFwiLFxuICAgICAgICBwcmV2ZW50U3VibWl0OiBmYWxzZSxcbiAgICAgICAgZGVmYXVsdFZhbHVlOiBcIlwiLFxuICAgICAgICBzaXplOiBcImRlZmF1bHRcIixcbiAgICAgICAgcHJlcGVuZDogXCJcIixcbiAgICAgICAgYXBwZW5kOiBcIlwiLFxuICAgICAgICBjb3B5SW5saW5lU3R5bGVzOiBmYWxzZSxcbiAgICAgICAgc2VhcmNoQnV0dG9uOiBmYWxzZSxcbiAgICAgICAgY2xlYXJCdXR0b246IHRydWUsXG4gICAgICAgIHJldmVhbEJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgY2xlYXJCdXR0b25JY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tY3Jvc3MnPjwvc3Bhbj5cIixcbiAgICAgICAgcmV2ZWFsQnV0dG9uSWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLWV5ZSc+PC9zcGFuPlwiLFxuICAgICAgICBzZWFyY2hCdXR0b25JY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tc2VhcmNoJz48L3NwYW4+XCIsXG4gICAgICAgIGN1c3RvbUJ1dHRvbnM6IFtdLFxuICAgICAgICBzZWFyY2hCdXR0b25DbGljazogJ3N1Ym1pdCcsXG5cbiAgICAgICAgY2xzQ29tcG9uZW50OiBcIlwiLFxuICAgICAgICBjbHNJbnB1dDogXCJcIixcbiAgICAgICAgY2xzUHJlcGVuZDogXCJcIixcbiAgICAgICAgY2xzQXBwZW5kOiBcIlwiLFxuICAgICAgICBjbHNDbGVhckJ1dHRvbjogXCJcIixcbiAgICAgICAgY2xzUmV2ZWFsQnV0dG9uOiBcIlwiLFxuICAgICAgICBjbHNDdXN0b21CdXR0b246IFwiXCIsXG4gICAgICAgIGNsc1NlYXJjaEJ1dHRvbjogXCJcIixcbiAgICAgICAgY2xzTGFiZWw6IFwiXCIsXG5cbiAgICAgICAgb25BdXRvY29tcGxldGVTZWxlY3Q6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uSGlzdG9yeUNoYW5nZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25IaXN0b3J5VXA6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uSGlzdG9yeURvd246IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQ2xlYXJDbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25SZXZlYWxDbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25TZWFyY2hCdXR0b25DbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25FbnRlckNsaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvbklucHV0Q3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmlucHV0U2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBJbnB1dERlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgSW5wdXREZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0lucHV0U2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5pbnB1dFNldHVwKHdpbmRvd1tcIm1ldHJvSW5wdXRTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdpbnB1dCcsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBJbnB1dERlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICBoaXN0b3J5OiBbXSxcbiAgICAgICAgICAgICAgICBoaXN0b3J5SW5kZXg6IC0xLFxuICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZTogW11cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVN0cnVjdHVyZSgpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlRXZlbnRzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImlucHV0LWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVN0cnVjdHVyZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJpbnB1dCBcIiArIGVsZW1lbnRbMF0uY2xhc3NOYW1lKTtcbiAgICAgICAgICAgIHZhciBidXR0b25zID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiYnV0dG9uLWdyb3VwXCIpO1xuICAgICAgICAgICAgdmFyIGNsZWFyQnV0dG9uLCByZXZlYWxCdXR0b24sIHNlYXJjaEJ1dHRvbjtcblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5oaXN0b3J5UHJlc2V0KSkge1xuICAgICAgICAgICAgICAgICQuZWFjaChvLmhpc3RvcnlQcmVzZXQudG9BcnJheShvLmhpc3RvcnlEaXZpZGVyKSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5oaXN0b3J5LnB1c2godGhpcyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhhdC5oaXN0b3J5SW5kZXggPSB0aGF0Lmhpc3RvcnkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuYXR0cihcInR5cGVcIikgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcInR5cGVcIiwgXCJ0ZXh0XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKGVsZW1lbnQpO1xuICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRUbyhjb250YWluZXIpO1xuICAgICAgICAgICAgYnV0dG9ucy5hcHBlbmRUbyhjb250YWluZXIpO1xuXG4gICAgICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUoZWxlbWVudC52YWwoKS50cmltKCkpKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC52YWwoby5kZWZhdWx0VmFsdWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5jbGVhckJ1dHRvbiA9PT0gdHJ1ZSAmJiAhZWxlbWVudFswXS5yZWFkT25seSkge1xuICAgICAgICAgICAgICAgIGNsZWFyQnV0dG9uID0gJChcIjxidXR0b24+XCIpLmFkZENsYXNzKFwiYnV0dG9uIGlucHV0LWNsZWFyLWJ1dHRvblwiKS5hZGRDbGFzcyhvLmNsc0NsZWFyQnV0dG9uKS5hdHRyKFwidGFiaW5kZXhcIiwgLTEpLmF0dHIoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpLmh0bWwoby5jbGVhckJ1dHRvbkljb24pO1xuICAgICAgICAgICAgICAgIGNsZWFyQnV0dG9uLmFwcGVuZFRvKGJ1dHRvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuYXR0cigndHlwZScpID09PSAncGFzc3dvcmQnICYmIG8ucmV2ZWFsQnV0dG9uID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgcmV2ZWFsQnV0dG9uID0gJChcIjxidXR0b24+XCIpLmFkZENsYXNzKFwiYnV0dG9uIGlucHV0LXJldmVhbC1idXR0b25cIikuYWRkQ2xhc3Moby5jbHNSZXZlYWxCdXR0b24pLmF0dHIoXCJ0YWJpbmRleFwiLCAtMSkuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIikuaHRtbChvLnJldmVhbEJ1dHRvbkljb24pO1xuICAgICAgICAgICAgICAgIHJldmVhbEJ1dHRvbi5hcHBlbmRUbyhidXR0b25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvLnNlYXJjaEJ1dHRvbiA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHNlYXJjaEJ1dHRvbiA9ICQoXCI8YnV0dG9uPlwiKS5hZGRDbGFzcyhcImJ1dHRvbiBpbnB1dC1zZWFyY2gtYnV0dG9uXCIpLmFkZENsYXNzKG8uY2xzU2VhcmNoQnV0dG9uKS5hdHRyKFwidGFiaW5kZXhcIiwgLTEpLmF0dHIoXCJ0eXBlXCIsIG8uc2VhcmNoQnV0dG9uQ2xpY2sgPT09ICdzdWJtaXQnID8gXCJzdWJtaXRcIiA6IFwiYnV0dG9uXCIpLmh0bWwoby5zZWFyY2hCdXR0b25JY29uKTtcbiAgICAgICAgICAgICAgICBzZWFyY2hCdXR0b24uYXBwZW5kVG8oYnV0dG9ucyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8ucHJlcGVuZCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJlcGVuZCA9ICQoXCI8ZGl2PlwiKS5odG1sKG8ucHJlcGVuZCk7XG4gICAgICAgICAgICAgICAgcHJlcGVuZC5hZGRDbGFzcyhcInByZXBlbmRcIikuYWRkQ2xhc3Moby5jbHNQcmVwZW5kKS5hcHBlbmRUbyhjb250YWluZXIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLmFwcGVuZCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgYXBwZW5kID0gJChcIjxkaXY+XCIpLmh0bWwoby5hcHBlbmQpO1xuICAgICAgICAgICAgICAgIGFwcGVuZC5hZGRDbGFzcyhcImFwcGVuZFwiKS5hZGRDbGFzcyhvLmNsc0FwcGVuZCkuYXBwZW5kVG8oY29udGFpbmVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvLmN1c3RvbUJ1dHRvbnMgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICBvLmN1c3RvbUJ1dHRvbnMgPSBVdGlscy5pc09iamVjdChvLmN1c3RvbUJ1dHRvbnMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZW9mIG8uY3VzdG9tQnV0dG9ucyA9PT0gXCJvYmplY3RcIiAmJiBVdGlscy5vYmplY3RMZW5ndGgoby5jdXN0b21CdXR0b25zKSA+IDApIHtcbiAgICAgICAgICAgICAgICAkLmVhY2goby5jdXN0b21CdXR0b25zLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXN0b21CdXR0b24gPSAkKFwiPGJ1dHRvbj5cIik7XG5cbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJidXR0b24gaW5wdXQtY3VzdG9tLWJ1dHRvblwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKG8uY2xzQ3VzdG9tQnV0dG9uKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKGl0ZW0uY2xzKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0YWJpbmRleFwiLCAtMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHlwZVwiLCBcImJ1dHRvblwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmh0bWwoaXRlbS5odG1sKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5hdHRyICYmIHR5cGVvZiBpdGVtLmF0dHIgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goaXRlbS5hdHRyLCBmdW5jdGlvbihrLCB2KXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21CdXR0b24uYXR0cihDYWtlLmRhc2hlZE5hbWUoayksIHYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjdXN0b21CdXR0b24uZGF0YShcImFjdGlvblwiLCBpdGVtLm9uY2xpY2spO1xuXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbUJ1dHRvbi5hcHBlbmRUbyhidXR0b25zKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoZWxlbWVudC5hdHRyKCdkYXRhLWV4Y2xhaW0nKSkpIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYXR0cignZGF0YS1leGNsYWltJywgZWxlbWVudC5hdHRyKCdkYXRhLWV4Y2xhaW0nKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChlbGVtZW50LmF0dHIoJ2RpcicpID09PSAncnRsJyApIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJydGxcIikuYXR0cihcImRpclwiLCBcInJ0bFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudFswXS5jbGFzc05hbWUgPSAnJztcbiAgICAgICAgICAgIGlmIChvLmNvcHlJbmxpbmVTdHlsZXMgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGVsZW1lbnRbMF0uc3R5bGUubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jc3MoZWxlbWVudFswXS5zdHlsZVtpXSwgZWxlbWVudC5jc3MoZWxlbWVudFswXS5zdHlsZVtpXSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKG8uY2xzQ29tcG9uZW50KTtcbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3Moby5jbHNJbnB1dCk7XG5cbiAgICAgICAgICAgIGlmIChvLnNpemUgIT09IFwiZGVmYXVsdFwiKSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiBvLnNpemVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFVdGlscy5pc051bGwoby5hdXRvY29tcGxldGUpIHx8ICFVdGlscy5pc051bGwoby5hdXRvY29tcGxldGVVcmwpKSB7XG4gICAgICAgICAgICAgICAgJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiYXV0b2NvbXBsZXRlLWxpc3RcIikuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgbWF4SGVpZ2h0OiBvLmF1dG9jb21wbGV0ZUxpc3RIZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IFwibm9uZVwiXG4gICAgICAgICAgICAgICAgfSkuYXBwZW5kVG8oY29udGFpbmVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5hdXRvY29tcGxldGUpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGF1dG9jb21wbGV0ZV9vYmogPSBVdGlscy5pc09iamVjdChvLmF1dG9jb21wbGV0ZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoYXV0b2NvbXBsZXRlX29iaiAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRvY29tcGxldGUgPSBhdXRvY29tcGxldGVfb2JqO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXV0b2NvbXBsZXRlID0gby5hdXRvY29tcGxldGUudG9BcnJheShvLmF1dG9jb21wbGV0ZURpdmlkZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5hdXRvY29tcGxldGVVcmwpKSB7XG4gICAgICAgICAgICAgICAgZmV0Y2goby5hdXRvY29tcGxldGVVcmwsIHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBvLmF1dG9jb21wbGV0ZVVybE1ldGhvZFxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UudGV4dCgpXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0RhdGEgPSBbXTtcblxuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3RGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoby5hdXRvY29tcGxldGVVcmxLZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdEYXRhID0gbmV3RGF0YVtvLmF1dG9jb21wbGV0ZVVybEtleV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0RhdGEgPSBkYXRhLnNwbGl0KFwiXFxuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5hdXRvY29tcGxldGUgPSB0aGF0LmF1dG9jb21wbGV0ZS5jb25jYXQobmV3RGF0YSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gJChcIjxsYWJlbD5cIikuYWRkQ2xhc3MoXCJsYWJlbC1mb3ItaW5wdXRcIikuYWRkQ2xhc3Moby5jbHNMYWJlbCkuaHRtbChvLmxhYmVsKS5pbnNlcnRCZWZvcmUoY29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5hdHRyKFwiaWRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwuYXR0cihcImZvclwiLCBlbGVtZW50LmF0dHIoXCJpZFwiKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmF0dHIoXCJkaXJcIikgPT09IFwicnRsXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwuYWRkQ2xhc3MoXCJydGxcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5pcyhcIjpkaXNhYmxlZFwiKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY29udGFpbmVyID0gZWxlbWVudC5jbG9zZXN0KFwiLmlucHV0XCIpO1xuICAgICAgICAgICAgdmFyIGF1dG9jb21wbGV0ZUxpc3QgPSBjb250YWluZXIuZmluZChcIi5hdXRvY29tcGxldGUtbGlzdFwiKTtcblxuICAgICAgICAgICAgY29udGFpbmVyLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuaW5wdXQtY2xlYXItYnV0dG9uXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGN1cnIgPSBlbGVtZW50LnZhbCgpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQudmFsKFV0aWxzLmlzVmFsdWUoby5kZWZhdWx0VmFsdWUpID8gby5kZWZhdWx0VmFsdWUgOiBcIlwiKS5maXJlKCdjbGVhcicpLmZpcmUoJ2NoYW5nZScpLmZpcmUoJ2tleXVwJykuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICBpZiAoYXV0b2NvbXBsZXRlTGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZUxpc3QuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IFwibm9uZVwiXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiY2xlYXItY2xpY2tcIiwge1xuICAgICAgICAgICAgICAgICAgICBwcmV2OiBjdXJyLFxuICAgICAgICAgICAgICAgICAgICB2YWw6IGVsZW1lbnQudmFsKClcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmlucHV0LXJldmVhbC1idXR0b25cIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5hdHRyKCd0eXBlJykgPT09ICdwYXNzd29yZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKCd0eXBlJywgJ3RleHQnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoJ3R5cGUnLCAncGFzc3dvcmQnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJyZXZlYWwtY2xpY2tcIiwge1xuICAgICAgICAgICAgICAgICAgICB2YWw6IGVsZW1lbnQudmFsKClcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmlucHV0LXNlYXJjaC1idXR0b25cIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAoby5zZWFyY2hCdXR0b25DbGljayAhPT0gJ3N1Ym1pdCcpIHtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJzZWFyY2gtYnV0dG9uLWNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbDogZWxlbWVudC52YWwoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbjogdGhpc1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybS5zdWJtaXQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gY29udGFpbmVyLm9uKE1ldHJvLmV2ZW50cy5zdG9wLCBcIi5pbnB1dC1yZXZlYWwtYnV0dG9uXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAvLyAgICAgZWxlbWVudC5hdHRyKCd0eXBlJywgJ3Bhc3N3b3JkJykuZm9jdXMoKTtcbiAgICAgICAgICAgIC8vIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXIub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5pbnB1dC1jdXN0b20tYnV0dG9uXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGJ1dHRvbiA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IGJ1dHRvbi5kYXRhKFwiYWN0aW9uXCIpO1xuICAgICAgICAgICAgICAgIFV0aWxzLmV4ZWMoYWN0aW9uLCBbZWxlbWVudC52YWwoKSwgYnV0dG9uXSwgdGhpcyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMua2V5dXAsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIHZhciB2YWwgPSBlbGVtZW50LnZhbCgpLnRyaW0oKTtcblxuICAgICAgICAgICAgICAgIGlmIChvLmhpc3RvcnkgJiYgZS5rZXlDb2RlID09PSBNZXRyby5rZXlDb2RlLkVOVEVSICYmIHZhbCAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnZhbChcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5oaXN0b3J5LnB1c2godmFsKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5oaXN0b3J5SW5kZXggPSB0aGF0Lmhpc3RvcnkubGVuZ3RoIC0gMTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJoaXN0b3J5LWNoYW5nZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWw6IHZhbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpc3Rvcnk6IHRoYXQuaGlzdG9yeSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpc3RvcnlJbmRleDogdGhhdC5oaXN0b3J5SW5kZXhcbiAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICBpZiAoby5wcmV2ZW50U3VibWl0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoby5oaXN0b3J5ICYmIGUua2V5Q29kZSA9PT0gTWV0cm8ua2V5Q29kZS5VUF9BUlJPVykge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lmhpc3RvcnlJbmRleC0tO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5oaXN0b3J5SW5kZXggPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC52YWwoXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnZhbCh0aGF0Lmhpc3RvcnlbdGhhdC5oaXN0b3J5SW5kZXhdKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiaGlzdG9yeS1kb3duXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw6IGVsZW1lbnQudmFsKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlzdG9yeTogdGhhdC5oaXN0b3J5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpc3RvcnlJbmRleDogdGhhdC5oaXN0b3J5SW5kZXhcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Lmhpc3RvcnlJbmRleCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChvLmhpc3RvcnkgJiYgZS5rZXlDb2RlID09PSBNZXRyby5rZXlDb2RlLkRPV05fQVJST1cpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5oaXN0b3J5SW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQuaGlzdG9yeUluZGV4IDwgdGhhdC5oaXN0b3J5Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC52YWwoXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnZhbCh0aGF0Lmhpc3RvcnlbdGhhdC5oaXN0b3J5SW5kZXhdKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiaGlzdG9yeS11cFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiBlbGVtZW50LnZhbCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpc3Rvcnk6IHRoYXQuaGlzdG9yeSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5SW5kZXg6IHRoYXQuaGlzdG9yeUluZGV4XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5oaXN0b3J5SW5kZXggPSB0aGF0Lmhpc3RvcnkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmtleWRvd24sIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IE1ldHJvLmtleUNvZGUuRU5URVIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZW50ZXItY2xpY2tcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiBlbGVtZW50LnZhbCgpXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5ibHVyLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5yZW1vdmVDbGFzcyhcImZvY3VzZWRcIik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuZm9jdXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwiZm9jdXNlZFwiKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5pbnB1dCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgdmFsID0gdGhpcy52YWx1ZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2RyYXdBdXRvY29tcGxldGVMaXN0KHZhbCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuYXV0b2NvbXBsZXRlLWxpc3QgLml0ZW1cIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgdmFsID0gJCh0aGlzKS5hdHRyKFwiZGF0YS1hdXRvY29tcGxldGUtdmFsdWVcIik7XG4gICAgICAgICAgICAgICAgZWxlbWVudC52YWwodmFsKTtcbiAgICAgICAgICAgICAgICBhdXRvY29tcGxldGVMaXN0LmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IFwibm9uZVwiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImF1dG9jb21wbGV0ZS1zZWxlY3RcIiwge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfZHJhd0F1dG9jb21wbGV0ZUxpc3Q6IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgY29udGFpbmVyID0gZWxlbWVudC5jbG9zZXN0KFwiLmlucHV0XCIpO1xuICAgICAgICAgICAgdmFyIGF1dG9jb21wbGV0ZUxpc3QgPSBjb250YWluZXIuZmluZChcIi5hdXRvY29tcGxldGUtbGlzdFwiKTtcbiAgICAgICAgICAgIHZhciBpdGVtcztcblxuICAgICAgICAgICAgaWYgKGF1dG9jb21wbGV0ZUxpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhdXRvY29tcGxldGVMaXN0Lmh0bWwoXCJcIik7XG5cbiAgICAgICAgICAgIGl0ZW1zID0gdGhpcy5hdXRvY29tcGxldGUuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih2YWwpID4gLTE7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYXV0b2NvbXBsZXRlTGlzdC5jc3Moe1xuICAgICAgICAgICAgICAgIGRpc3BsYXk6IGl0ZW1zLmxlbmd0aCA+IDAgPyBcImJsb2NrXCIgOiBcIm5vbmVcIlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQuZWFjaChpdGVtcywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgdiA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gdi50b0xvd2VyQ2FzZSgpLmluZGV4T2YodmFsKSwgY29udGVudDtcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcIml0ZW1cIikuYXR0cihcImRhdGEtYXV0b2NvbXBsZXRlLXZhbHVlXCIsIHYpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBcIjxzdHJvbmc+XCIrdi5zdWJzdHIoMCwgdmFsLmxlbmd0aCkrXCI8L3N0cm9uZz5cIit2LnN1YnN0cih2YWwubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gdi5zdWJzdHIoMCwgaW5kZXgpICsgXCI8c3Ryb25nPlwiK3Yuc3Vic3RyKGluZGV4LCB2YWwubGVuZ3RoKStcIjwvc3Ryb25nPlwiK3Yuc3Vic3RyKGluZGV4ICsgdmFsLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaXRlbS5odG1sKGNvbnRlbnQpLmFwcGVuZFRvKGF1dG9jb21wbGV0ZUxpc3QpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZHJhdy1hdXRvY29tcGxldGUtaXRlbVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW06IGl0ZW1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0SGlzdG9yeTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmhpc3Rvcnk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0SGlzdG9yeUluZGV4OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGlzdG9yeUluZGV4O1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldEhpc3RvcnlJbmRleDogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeUluZGV4ID0gdmFsID49IHRoaXMuaGlzdG9yeS5sZW5ndGggPyB0aGlzLmhpc3RvcnkubGVuZ3RoIC0gMSA6IHZhbDtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRIaXN0b3J5OiBmdW5jdGlvbihoaXN0b3J5LCBhcHBlbmQpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIGlmIChVdGlscy5pc051bGwoaGlzdG9yeSkpIHJldHVybjtcbiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShoaXN0b3J5KSAmJiB0eXBlb2YgaGlzdG9yeSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBoaXN0b3J5ID0gaGlzdG9yeS50b0FycmF5KG8uaGlzdG9yeURpdmlkZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFwcGVuZCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICQuZWFjaChoaXN0b3J5LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaGlzdG9yeS5wdXNoKHRoaXMpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9IGVsc2V7XG4gICAgICAgICAgICAgICAgdGhpcy5oaXN0b3J5ID0gaGlzdG9yeTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeUluZGV4ID0gdGhpcy5oaXN0b3J5Lmxlbmd0aCAtIDE7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xlYXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQudmFsKCcnKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b0RlZmF1bHQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQudmFsKFV0aWxzLmlzVmFsdWUodGhpcy5vcHRpb25zLmRlZmF1bHRWYWx1ZSkgPyB0aGlzLm9wdGlvbnMuZGVmYXVsdFZhbHVlIDogXCJcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50KCkuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRpc2FibGVkXCIsIGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnQoKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZVN0YXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbS5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldEF1dG9jb21wbGV0ZUxpc3Q6IGZ1bmN0aW9uKGwpe1xuICAgICAgICAgICAgdmFyIGF1dG9jb21wbGV0ZV9saXN0ID0gVXRpbHMuaXNPYmplY3QobCk7XG4gICAgICAgICAgICBpZiAoYXV0b2NvbXBsZXRlX2xpc3QgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hdXRvY29tcGxldGUgPSBhdXRvY29tcGxldGVfbGlzdDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGwgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmF1dG9jb21wbGV0ZSA9IGwudG9BcnJheSh0aGlzLm9wdGlvbnMuYXV0b2NvbXBsZXRlRGl2aWRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgICAgIHN3aXRjaCAoYXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ2Rpc2FibGVkJzogdGhpcy50b2dnbGVTdGF0ZSgpOyBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgcGFyZW50ID0gZWxlbWVudC5wYXJlbnQoKTtcbiAgICAgICAgICAgIHZhciBjbGVhckJ0biA9IHBhcmVudC5maW5kKFwiLmlucHV0LWNsZWFyLWJ1dHRvblwiKTtcbiAgICAgICAgICAgIHZhciByZXZlYWxCdG4gPSBwYXJlbnQuZmluZChcIi5pbnB1dC1yZXZlYWwtYnV0dG9uXCIpO1xuICAgICAgICAgICAgdmFyIGN1c3RvbUJ0biA9IHBhcmVudC5maW5kKFwiLmlucHV0LWN1c3RvbS1idXR0b25cIik7XG5cbiAgICAgICAgICAgIGlmIChjbGVhckJ0bi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJCdG4ub2ZmKE1ldHJvLmV2ZW50cy5jbGljayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmV2ZWFsQnRuLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICByZXZlYWxCdG4ub2ZmKE1ldHJvLmV2ZW50cy5zdGFydCk7XG4gICAgICAgICAgICAgICAgcmV2ZWFsQnRuLm9mZihNZXRyby5ldmVudHMuc3RvcCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3VzdG9tQnRuLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBjbGVhckJ0bi5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmJsdXIpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmZvY3VzKTtcblxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgICQoZG9jdW1lbnQpLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oKXtcbiAgICAgICAgJCgnLmlucHV0IC5hdXRvY29tcGxldGUtbGlzdCcpLmhpZGUoKTtcbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBLZXlsb2NrRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAga2V5bG9ja0RlZmVycmVkOiAwLFxuXG4gICAgICAgIHN0YXRlT25JY29uOiBcIjxzcGFuPiZ0aW1lczs8L3NwYW4+XCIsXG4gICAgICAgIHN0YXRlT2ZmSWNvbjogXCI8c3Bhbj4mY2hlY2ttYXJrOzwvc3Bhbj5cIixcblxuICAgICAgICB0cmFuc2l0aW9uOiB0cnVlLFxuXG4gICAgICAgIG9uQ2FwdGlvbjogXCJcIixcbiAgICAgICAgb2ZmQ2FwdGlvbjogXCJcIixcbiAgICAgICAgY2FwdGlvblBvc2l0aW9uOiBcInJpZ2h0XCIsXG5cbiAgICAgICAgY2xzS2V5bG9jazogXCJcIixcbiAgICAgICAgY2xzU3RhdGVPbjogXCJcIixcbiAgICAgICAgY2xzU3RhdGVPZmY6IFwiXCIsXG4gICAgICAgIGNsc0NhcHRpb246IFwiXCIsXG4gICAgICAgIGNsc0ljb246IFwiXCIsXG4gICAgICAgIGNsc09uQ2FwdGlvbjogXCJcIixcbiAgICAgICAgY2xzT2ZmQ2FwdGlvbjogXCJcIixcblxuICAgICAgICBvbktleWxvY2tDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8ua2V5bG9ja1NldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgS2V5bG9ja0RlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgS2V5bG9ja0RlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvS2V5bG9ja1NldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8ua2V5bG9ja1NldHVwKHdpbmRvd1tcIm1ldHJvS2V5bG9ja1NldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ2tleWxvY2snLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgS2V5bG9ja0RlZmF1bHRDb25maWcpO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY29udGFpbmVyO1xuICAgICAgICAgICAgdmFyIGljb24gPSAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwiaWNvblwiKS5hZGRDbGFzcyhvLmNsc0ljb24pO1xuICAgICAgICAgICAgdmFyIGNhcHRpb24gPSAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwiY2FwdGlvblwiKS5hZGRDbGFzcyhvLmNsc0NhcHRpb24pO1xuICAgICAgICAgICAgdmFyIHN0YXRlT25JY29uID0gJChvLnN0YXRlT25JY29uKS5hZGRDbGFzcyhcInN0YXRlLW9uXCIpLmFkZENsYXNzKG8uY2xzU3RhdGVPbik7XG4gICAgICAgICAgICB2YXIgc3RhdGVPZmZJY29uID0gJChvLnN0YXRlT2ZmSWNvbikuYWRkQ2xhc3MoXCJzdGF0ZS1vZmZcIikuYWRkQ2xhc3Moby5jbHNTdGF0ZU9mZik7XG4gICAgICAgICAgICB2YXIgb25DYXB0aW9uID0gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcInN0YXRlLW9uXCIpLmFkZENsYXNzKG8uY2xzT25DYXB0aW9uKS5odG1sKG8ub25DYXB0aW9uKTtcbiAgICAgICAgICAgIHZhciBvZmZDYXB0aW9uID0gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcInN0YXRlLW9mZlwiKS5hZGRDbGFzcyhvLmNsc09mZkNhcHRpb24pLmh0bWwoby5vZmZDYXB0aW9uKTtcblxuICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwidHlwZVwiLCBcImNoZWNrYm94XCIpO1xuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5hdHRyKFwicmVhZG9ubHlcIikgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQub24oXCJjbGlja1wiLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnRhaW5lciA9IGVsZW1lbnQud3JhcChcbiAgICAgICAgICAgICAgICAkKFwiPGxhYmVsPlwiKS5hZGRDbGFzcyhcImtleWxvY2tcIikuYWRkQ2xhc3Moby5jbHNLZXlsb2NrKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWNvbi5hcHBlbmRUbyhjb250YWluZXIpO1xuICAgICAgICAgICAgY2FwdGlvbi5hcHBlbmRUbyhjb250YWluZXIpO1xuXG4gICAgICAgICAgICBzdGF0ZU9uSWNvbi5hcHBlbmRUbyhpY29uKTtcbiAgICAgICAgICAgIHN0YXRlT2ZmSWNvbi5hcHBlbmRUbyhpY29uKTtcblxuICAgICAgICAgICAgb25DYXB0aW9uLmFwcGVuZFRvKGNhcHRpb24pO1xuICAgICAgICAgICAgb2ZmQ2FwdGlvbi5hcHBlbmRUbyhjYXB0aW9uKTtcblxuICAgICAgICAgICAgaWYgKG8udHJhbnNpdGlvbiA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcInRyYW5zaXRpb24tb25cIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmNhcHRpb25Qb3NpdGlvbiA9PT0gJ2xlZnQnKSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwiY2FwdGlvbi1sZWZ0XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50WzBdLmNsYXNzTmFtZSA9ICcnO1xuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5pcygnOmRpc2FibGVkJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmFibGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwia2V5bG9jay1jcmVhdGVcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50KCkuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRpc2FibGVkXCIsIGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnQoKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZVN0YXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbS5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZTogZnVuY3Rpb24odil7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgaWYgKCFVdGlscy5pc1ZhbHVlKHYpKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5wcm9wKFwiY2hlY2tlZFwiLCAhVXRpbHMuYm9vbChlbGVtZW50LnByb3AoXCJjaGVja2VkXCIpKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQucHJvcChcImNoZWNrZWRcIiwgdiA9PT0gMSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSl7XG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdkaXNhYmxlZCc6IHRoaXMudG9nZ2xlU3RhdGUoKTsgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIC8vdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIEtleXBhZERlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGtleXBhZERlZmVycmVkOiAwLFxuICAgICAgICBsYWJlbDogXCJcIixcbiAgICAgICAga2V5U2l6ZTogNDgsXG4gICAgICAgIGtleXM6IFwiMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOSwgMFwiLFxuICAgICAgICBleGNlcHRLZXlzOiBcIlwiLFxuICAgICAgICBrZXlTZXBhcmF0b3I6IFwiXCIsXG4gICAgICAgIHRyaW1TZXBhcmF0b3I6IGZhbHNlLFxuICAgICAgICBrZXlEZWxpbWl0ZXI6IFwiLFwiLFxuICAgICAgICBjb3B5SW5saW5lU3R5bGVzOiBmYWxzZSxcbiAgICAgICAgdGFyZ2V0OiBudWxsLFxuICAgICAgICBrZXlMZW5ndGg6IDAsXG4gICAgICAgIHNodWZmbGU6IGZhbHNlLFxuICAgICAgICBzaHVmZmxlQ291bnQ6IDMsXG4gICAgICAgIHBvc2l0aW9uOiBNZXRyby5wb3NpdGlvbi5CT1RUT01fTEVGVCwgLy90b3AtbGVmdCwgdG9wLCB0b3AtcmlnaHQsIHJpZ2h0LCBib3R0b20tcmlnaHQsIGJvdHRvbSwgYm90dG9tLWxlZnQsIGxlZnRcbiAgICAgICAgZHluYW1pY1Bvc2l0aW9uOiBmYWxzZSxcbiAgICAgICAgc2VydmljZUJ1dHRvbnM6IHRydWUsXG4gICAgICAgIHNob3dWYWx1ZTogdHJ1ZSxcbiAgICAgICAgb3BlbjogZmFsc2UsXG4gICAgICAgIHNpemVBc0tleXM6IGZhbHNlLFxuXG4gICAgICAgIGNsc0tleXBhZDogXCJcIixcbiAgICAgICAgY2xzSW5wdXQ6IFwiXCIsXG4gICAgICAgIGNsc0tleXM6IFwiXCIsXG4gICAgICAgIGNsc0tleTogXCJcIixcbiAgICAgICAgY2xzU2VydmljZUtleTogXCJcIixcbiAgICAgICAgY2xzQmFja3NwYWNlOiBcIlwiLFxuICAgICAgICBjbHNDbGVhcjogXCJcIixcbiAgICAgICAgY2xzTGFiZWw6IFwiXCIsXG5cbiAgICAgICAgb25DaGFuZ2U6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQ2xlYXI6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQmFja3NwYWNlOiBNZXRyby5ub29wLFxuICAgICAgICBvblNodWZmbGU6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uS2V5OiBNZXRyby5ub29wLFxuICAgICAgICBvbktleXBhZENyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5rZXlwYWRTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIEtleXBhZERlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgS2V5cGFkRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9LZXlwYWRTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmtleXBhZFNldHVwKHdpbmRvd1tcIm1ldHJvS2V5cGFkU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgna2V5cGFkJywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIEtleXBhZERlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogZWxlbS50YWdOYW1lID09PSAnSU5QVVQnID8gZWxlbS52YWx1ZSA6IGVsZW0uaW5uZXJUZXh0LFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uczogW1widG9wLWxlZnRcIiwgXCJ0b3BcIiwgXCJ0b3AtcmlnaHRcIiwgXCJyaWdodFwiLCBcImJvdHRvbS1yaWdodFwiLCBcImJvdHRvbVwiLCBcImJvdHRvbS1sZWZ0XCIsIFwibGVmdFwiXSxcbiAgICAgICAgICAgICAgICBrZXlwYWQ6IG51bGwsXG4gICAgICAgICAgICAgICAga2V5czogW10sXG4gICAgICAgICAgICAgICAga2V5c190b193b3JrOiBbXSxcbiAgICAgICAgICAgICAgICBleGNlcHRLZXlzOiBbXVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdGhpcy5rZXlzID0gby5rZXlzLnRvQXJyYXkoby5rZXlEZWxpbWl0ZXIpO1xuICAgICAgICAgICAgdGhpcy5rZXlzX3RvX3dvcmsgPSB0aGlzLmtleXM7XG4gICAgICAgICAgICB0aGlzLmV4Y2VwdEtleXMgPSBvLmV4Y2VwdEtleXMudG9BcnJheShvLmtleURlbGltaXRlcik7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUtleXBhZCgpO1xuICAgICAgICAgICAgaWYgKG8uc2h1ZmZsZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2h1ZmZsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlS2V5cygpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlRXZlbnRzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImtleXBhZC1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVLZXlwYWQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBwYXJlbnQgPSBlbGVtZW50LnBhcmVudCgpO1xuICAgICAgICAgICAgdmFyIGtleXBhZCwga2V5cztcblxuICAgICAgICAgICAgaWYgKHBhcmVudC5oYXNDbGFzcyhcImlucHV0XCIpKSB7XG4gICAgICAgICAgICAgICAga2V5cGFkID0gcGFyZW50O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBrZXlwYWQgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJpbnB1dFwiKS5hZGRDbGFzcyhlbGVtZW50WzBdLmNsYXNzTmFtZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGtleXBhZC5hZGRDbGFzcyhcImtleXBhZFwiKTtcbiAgICAgICAgICAgIGlmIChrZXlwYWQuY3NzKFwicG9zaXRpb25cIikgPT09IFwic3RhdGljXCIgfHwga2V5cGFkLmNzcyhcInBvc2l0aW9uXCIpID09PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAga2V5cGFkLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBcInJlbGF0aXZlXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuYXR0cihcInR5cGVcIikgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcInR5cGVcIiwgXCJ0ZXh0XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBrZXlwYWQuaW5zZXJ0QmVmb3JlKGVsZW1lbnQpO1xuXG4gICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJyZWFkb25seVwiLCB0cnVlKTtcbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kVG8oa2V5cGFkKTtcblxuICAgICAgICAgICAga2V5cyA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImtleXNcIikuYWRkQ2xhc3Moby5jbHNLZXlzKTtcbiAgICAgICAgICAgIGtleXMuYXBwZW5kVG8oa2V5cGFkKTtcbiAgICAgICAgICAgIHRoaXMuX3NldEtleXNQb3NpdGlvbigpO1xuXG4gICAgICAgICAgICBpZiAoby5vcGVuID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAga2V5cy5hZGRDbGFzcyhcIm9wZW4ga2VlcC1vcGVuXCIpO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIGVsZW1lbnRbMF0uY2xhc3NOYW1lID0gJyc7XG4gICAgICAgICAgICBpZiAoby5jb3B5SW5saW5lU3R5bGVzID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBlbGVtZW50WzBdLnN0eWxlLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBrZXlwYWQuY3NzKGVsZW1lbnRbMF0uc3R5bGVbaV0sIGVsZW1lbnQuY3NzKGVsZW1lbnRbMF0uc3R5bGVbaV0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3Moby5jbHNJbnB1dCk7XG4gICAgICAgICAgICBrZXlwYWQuYWRkQ2xhc3Moby5jbHNLZXlwYWQpO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5ibHVyLCBmdW5jdGlvbigpe2tleXBhZC5yZW1vdmVDbGFzcyhcImZvY3VzZWRcIik7fSk7XG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5mb2N1cywgZnVuY3Rpb24oKXtrZXlwYWQuYWRkQ2xhc3MoXCJmb2N1c2VkXCIpO30pO1xuXG4gICAgICAgICAgICBpZiAoby5sYWJlbCkge1xuICAgICAgICAgICAgICAgIHZhciBsYWJlbCA9ICQoXCI8bGFiZWw+XCIpLmFkZENsYXNzKFwibGFiZWwtZm9yLWlucHV0XCIpLmFkZENsYXNzKG8uY2xzTGFiZWwpLmh0bWwoby5sYWJlbCkuaW5zZXJ0QmVmb3JlKGtleXBhZCk7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuYXR0cihcImlkXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsLmF0dHIoXCJmb3JcIiwgZWxlbWVudC5hdHRyKFwiaWRcIikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5hdHRyKFwiZGlyXCIpID09PSBcInJ0bFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsLmFkZENsYXNzKFwicnRsXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uZGlzYWJsZWQgPT09IHRydWUgfHwgZWxlbWVudC5pcyhcIjpkaXNhYmxlZFwiKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmtleXBhZCA9IGtleXBhZDtcbiAgICAgICAgfSxcblxuICAgICAgICBfc2V0S2V5c1Bvc2l0aW9uOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIga2V5cGFkID0gZWxlbWVudC5wYXJlbnQoKTtcbiAgICAgICAgICAgIHZhciBrZXlzID0ga2V5cGFkLmZpbmQoXCIua2V5c1wiKTtcbiAgICAgICAgICAgIGtleXMucmVtb3ZlQ2xhc3ModGhpcy5wb3NpdGlvbnMuam9pbihcIiBcIikpLmFkZENsYXNzKG8ucG9zaXRpb24pXG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUtleXM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBrZXlwYWQgPSBlbGVtZW50LnBhcmVudCgpO1xuICAgICAgICAgICAgdmFyIGtleSwga2V5cyA9IGtleXBhZC5maW5kKFwiLmtleXNcIik7XG4gICAgICAgICAgICB2YXIgZmFjdG9yID0gTWF0aC5yb3VuZChNYXRoLnNxcnQodGhpcy5rZXlzLmxlbmd0aCArIDIpKTtcbiAgICAgICAgICAgIHZhciBrZXlfc2l6ZSA9IG8ua2V5U2l6ZTtcbiAgICAgICAgICAgIHZhciB3aWR0aDtcblxuICAgICAgICAgICAga2V5cy5odG1sKFwiXCIpO1xuXG4gICAgICAgICAgICAkLmVhY2godGhpcy5rZXlzX3RvX3dvcmssIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAga2V5ID0gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcImtleVwiKS5hZGRDbGFzcyhvLmNsc0tleSkuaHRtbCh0aGlzKTtcbiAgICAgICAgICAgICAgICBrZXkuZGF0YShcImtleVwiLCB0aGlzKTtcbiAgICAgICAgICAgICAgICBrZXkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG8ua2V5U2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBvLmtleVNpemUsXG4gICAgICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6IG8ua2V5U2l6ZSAtIDRcbiAgICAgICAgICAgICAgICB9KS5hcHBlbmRUbyhrZXlzKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoby5zZXJ2aWNlQnV0dG9ucyA9PT0gdHJ1ZSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHNlcnZpY2Vfa2V5cyA9IFsnJmxhcnI7JywgJyZ0aW1lczsnXTtcblxuICAgICAgICAgICAgICAgICQuZWFjaChzZXJ2aWNlX2tleXMsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAga2V5ID0gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcImtleSBzZXJ2aWNlLWtleVwiKS5hZGRDbGFzcyhvLmNsc0tleSkuYWRkQ2xhc3Moby5jbHNTZXJ2aWNlS2V5KS5odG1sKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcyA9PT0gJyZsYXJyOycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleS5hZGRDbGFzcyhvLmNsc0JhY2tzcGFjZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMgPT09ICcmdGltZXM7Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAga2V5LmFkZENsYXNzKG8uY2xzQ2xlYXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGtleS5kYXRhKFwia2V5XCIsIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICBrZXkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBvLmtleVNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IG8ua2V5U2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6IG8ua2V5U2l6ZSAtIDRcbiAgICAgICAgICAgICAgICAgICAgfSkuYXBwZW5kVG8oa2V5cyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHdpZHRoID0gZmFjdG9yICogKGtleV9zaXplICsgMikgLSA2O1xuICAgICAgICAgICAga2V5cy5vdXRlcldpZHRoKHdpZHRoKTtcblxuICAgICAgICAgICAgaWYgKG8uc2l6ZUFzS2V5cyA9PT0gdHJ1ZSAmJiBbJ3RvcC1sZWZ0JywgJ3RvcCcsICd0b3AtcmlnaHQnLCAnYm90dG9tLWxlZnQnLCAnYm90dG9tJywgJ2JvdHRvbS1yaWdodCddLmluZGV4T2Yoby5wb3NpdGlvbikgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAga2V5cGFkLm91dGVyV2lkdGgoa2V5cy5vdXRlcldpZHRoKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIga2V5cGFkID0gZWxlbWVudC5wYXJlbnQoKTtcbiAgICAgICAgICAgIHZhciBrZXlzID0ga2V5cGFkLmZpbmQoXCIua2V5c1wiKTtcblxuICAgICAgICAgICAga2V5cy5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmtleVwiLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICB2YXIga2V5ID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIga2V5VmFsdWUgPSBrZXkuZGF0YShcImtleVwiKTtcbiAgICAgICAgICAgICAgICB2YXIgY3JvcDtcblxuICAgICAgICAgICAgICAgIGlmIChrZXkuZGF0YSgna2V5JykgIT09ICcmbGFycjsnICYmIGtleS5kYXRhKCdrZXknKSAhPT0gJyZ0aW1lczsnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG8ua2V5TGVuZ3RoID4gMCAmJiAoXCJcIit0aGF0LnZhbHVlKS5sZW5ndGggPT09IG8ua2V5TGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5leGNlcHRLZXlzLmluZGV4T2Yoa2V5VmFsdWUpID09PSAtMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQudmFsdWUgPSB0aGF0LnZhbHVlICsgKHRoYXQudmFsdWUgIT09IFwiXCIgPyBvLmtleVNlcGFyYXRvciA6IFwiXCIpICsga2V5VmFsdWU7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG8uc2h1ZmZsZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5zaHVmZmxlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9jcmVhdGVLZXlzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoby5keW5hbWljUG9zaXRpb24gPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG8ucG9zaXRpb24gPSB0aGF0LnBvc2l0aW9uc1skLnJhbmRvbSgwLCB0aGF0LnBvc2l0aW9ucy5sZW5ndGggLSAxKV07XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9zZXRLZXlzUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImtleVwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6IGtleS5kYXRhKFwia2V5XCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiB0aGF0LnZhbHVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleS5kYXRhKCdrZXknKSA9PT0gJyZ0aW1lczsnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LnZhbHVlID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImNsZWFyXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkuZGF0YSgna2V5JykgPT09ICcmbGFycjsnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjcm9wID0gby5rZXlTZXBhcmF0b3IgJiYgdGhhdC52YWx1ZVt0aGF0LnZhbHVlLmxlbmd0aCAtIDFdICE9PSBvLmtleVNlcGFyYXRvciA/IDIgOiAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC52YWx1ZSA9ICh0aGF0LnZhbHVlLnN1YnN0cmluZygwLCB0aGF0LnZhbHVlLmxlbmd0aCAtIGNyb3ApKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImJhY2tzcGFjZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiB0aGF0LnZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChvLnNob3dWYWx1ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudFswXS50YWdOYW1lID09PSBcIklOUFVUXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudmFsKHRoYXQudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC50ZXh0KHRoYXQudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KCdjaGFuZ2UnLCB7XG4gICAgICAgICAgICAgICAgICAgIHZhbDogdGhhdC52YWxcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC8vIGVsZW1lbnQudHJpZ2dlcignY2hhbmdlJyk7XG4gICAgICAgICAgICAgICAgLy8gVXRpbHMuZXhlYyhvLm9uQ2hhbmdlLCBbdGhhdC52YWx1ZV0sIGVsZW1lbnRbMF0pO1xuXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAga2V5cGFkLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgaWYgKG8ub3BlbiA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChrZXlzLmhhc0NsYXNzKFwib3BlblwiKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBrZXlzLnJlbW92ZUNsYXNzKFwib3BlblwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBrZXlzLmFkZENsYXNzKFwib3BlblwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoby50YXJnZXQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jaGFuZ2UsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0ID0gJChvLnRhcmdldCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodFswXS50YWdOYW1lID09PSBcIklOUFVUXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHQudmFsKHRoYXQudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC50ZXh0KHRoYXQudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2h1ZmZsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvLnNodWZmbGVDb3VudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5rZXlzX3RvX3dvcmsgPSB0aGlzLmtleXNfdG9fd29yay5zaHVmZmxlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInNodWZmbGVcIiwge1xuICAgICAgICAgICAgICAgIGtleXNUb1dvcms6IHRoaXMua2V5c190b193b3JrLFxuICAgICAgICAgICAgICAgIGtleXM6IHRoaXMua2V5c1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2h1ZmZsZUtleXM6IGZ1bmN0aW9uKGNvdW50KXtcbiAgICAgICAgICAgIGlmIChjb3VudCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgY291bnQgPSB0aGlzLm9wdGlvbnMuc2h1ZmZsZUNvdW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5rZXlzX3RvX3dvcmsgPSB0aGlzLmtleXNfdG9fd29yay5zaHVmZmxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVLZXlzKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdmFsOiBmdW5jdGlvbih2KXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIHYgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gby50cmltU2VwYXJhdG9yID8gdGhpcy52YWx1ZS5yZXBsYWNlKG5ldyBSZWdFeHAoby5rZXlTZXBhcmF0b3IsIFwiZ1wiKSkgOiB0aGlzLnZhbHVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gXCJcIit2O1xuXG4gICAgICAgICAgICBpZiAoZWxlbWVudFswXS50YWdOYW1lID09PSBcIklOUFVUXCIpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnZhbCh2KTtcbiAgICAgICAgICAgICAgICAvLyBzZXQgY3Vyc29yIHRvIGVuZCBwb3NpdGlvblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnRleHQodilcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb3BlbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIGtleXBhZCA9IGVsZW1lbnQucGFyZW50KCk7XG4gICAgICAgICAgICB2YXIga2V5cyA9IGtleXBhZC5maW5kKFwiLmtleXNcIik7XG5cbiAgICAgICAgICAgIGtleXMuYWRkQ2xhc3MoXCJvcGVuXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNsb3NlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIga2V5cGFkID0gZWxlbWVudC5wYXJlbnQoKTtcbiAgICAgICAgICAgIHZhciBrZXlzID0ga2V5cGFkLmZpbmQoXCIua2V5c1wiKTtcblxuICAgICAgICAgICAga2V5cy5yZW1vdmVDbGFzcyhcIm9wZW5cIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50KCkuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRpc2FibGVkXCIsIGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnQoKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZVN0YXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbS5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldFBvc2l0aW9uOiBmdW5jdGlvbihwb3Mpe1xuICAgICAgICAgICAgdmFyIG5ld19wb3NpdGlvbiA9IHBvcyAhPT0gdW5kZWZpbmVkID8gcG9zIDogdGhpcy5lbGVtZW50LmF0dHIoXCJkYXRhLXBvc2l0aW9uXCIpO1xuICAgICAgICAgICAgaWYgKHRoaXMucG9zaXRpb25zLmluZGV4T2YobmV3X3Bvc2l0aW9uKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnBvc2l0aW9uID0gbmV3X3Bvc2l0aW9uO1xuICAgICAgICAgICAgdGhpcy5fc2V0S2V5c1Bvc2l0aW9uKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgICAgIHN3aXRjaCAoYXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ2Rpc2FibGVkJzogdGhpcy50b2dnbGVTdGF0ZSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdkYXRhLXBvc2l0aW9uJzogdGhpcy5zZXRQb3NpdGlvbigpOyBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIGtleXBhZCA9IHRoaXMua2V5cGFkLCBrZXlzID0ga2V5cGFkLmZpbmQoXCIua2V5c1wiKTtcblxuICAgICAgICAgICAga2V5cGFkLm9mZihNZXRyby5ldmVudHMuY2xpY2spO1xuICAgICAgICAgICAga2V5cy5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5rZXlcIik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuY2hhbmdlKTtcblxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgICQoZG9jdW1lbnQpLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIGtleXBhZHMgPSAkKFwiLmtleXBhZCAua2V5c1wiKTtcbiAgICAgICAgJC5lYWNoKGtleXBhZHMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiAoISQodGhpcykuaGFzQ2xhc3MoXCJrZWVwLW9wZW5cIikpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKFwib3BlblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBMaWdodGJveERlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGxvb3A6IHRydWUsXG4gICAgICAgIHNvdXJjZTogXCJpbWdcIixcblxuICAgICAgICBpY29uQ2xvc2U6IFwiPHNwYW4gY2xhc3M9J2RlZmF1bHQtaWNvbi1jcm9zcyc+XCIsXG4gICAgICAgIGljb25QcmV2OiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tY2hldnJvbi1sZWZ0Jz5cIixcbiAgICAgICAgaWNvbk5leHQ6IFwiPHNwYW4gY2xhc3M9J2RlZmF1bHQtaWNvbi1jaGV2cm9uLXJpZ2h0Jz5cIixcblxuICAgICAgICBjbHNOZXh0OiBcIlwiLFxuICAgICAgICBjbHNQcmV2OiBcIlwiLFxuICAgICAgICBjbHNDbG9zZTogXCJcIixcbiAgICAgICAgY2xzSW1hZ2U6IFwiXCIsXG4gICAgICAgIGNsc0ltYWdlQ29udGFpbmVyOiBcIlwiLFxuICAgICAgICBjbHNJbWFnZVdyYXBwZXI6IFwiXCIsXG4gICAgICAgIGNsc0xpZ2h0Ym94OiBcIlwiLFxuXG4gICAgICAgIG9uRHJhd0ltYWdlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkxpZ2h0Ym94Q3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmxpZ2h0Ym94U2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBMaWdodGJveERlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgTGlnaHRib3hEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0xpZ2h0Ym94U2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5saWdodGJveFNldHVwKHdpbmRvd1tcIm1ldHJvTGlnaHRib3hTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdsaWdodGJveCcsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBMaWdodGJveERlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICAvLyBkZWZpbmUgaW5zdGFuY2UgdmFycyBoZXJlXG4gICAgICAgICAgICAgICAgb3ZlcmxheTogbnVsbCxcbiAgICAgICAgICAgICAgICBsaWdodGJveDogbnVsbCxcbiAgICAgICAgICAgICAgICBjdXJyZW50OiBudWxsLFxuICAgICAgICAgICAgICAgIGl0ZW1zOiBbXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmICghby5zb3VyY2UpIHtcbiAgICAgICAgICAgICAgICBvLnNvdXJjZSA9IFwiaW1nXCI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVN0cnVjdHVyZSgpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlRXZlbnRzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudCgnbGlnaHRib3gtY3JlYXRlJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVN0cnVjdHVyZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGxpZ2h0Ym94LCBvdmVybGF5O1xuXG4gICAgICAgICAgICBvdmVybGF5ID0gJChcIi5saWdodGJveC1vdmVybGF5XCIpO1xuXG4gICAgICAgICAgICBpZiAob3ZlcmxheS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBvdmVybGF5ID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwibGlnaHRib3gtb3ZlcmxheVwiKS5hcHBlbmRUbyhcImJvZHlcIikuaGlkZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsaWdodGJveCA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImxpZ2h0Ym94XCIpLmFkZENsYXNzKG8uY2xzTGlnaHRib3gpLmFwcGVuZFRvKFwiYm9keVwiKS5oaWRlKCk7XG5cbiAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJsaWdodGJveF9fcHJldlwiKS5hZGRDbGFzcyhvLmNsc1ByZXYpLmh0bWwoby5pY29uUHJldikuYXBwZW5kVG8obGlnaHRib3gpO1xuICAgICAgICAgICAgJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcImxpZ2h0Ym94X19uZXh0XCIpLmFkZENsYXNzKG8uY2xzTmV4dCkuaHRtbChvLmljb25OZXh0KS5hcHBlbmRUbyhsaWdodGJveCk7XG4gICAgICAgICAgICAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwibGlnaHRib3hfX2Nsb3NlclwiKS5hZGRDbGFzcyhvLmNsc0Nsb3NlKS5odG1sKG8uaWNvbkNsb3NlKS5hcHBlbmRUbyhsaWdodGJveCk7XG4gICAgICAgICAgICAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJsaWdodGJveF9faW1hZ2VcIikuYWRkQ2xhc3Moby5jbHNJbWFnZUNvbnRhaW5lcikuYXBwZW5kVG8obGlnaHRib3gpO1xuXG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudCA9IGxpZ2h0Ym94WzBdO1xuICAgICAgICAgICAgdGhpcy5saWdodGJveCA9IGxpZ2h0Ym94O1xuICAgICAgICAgICAgdGhpcy5vdmVybGF5ID0gb3ZlcmxheTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGxpZ2h0Ym94ID0gJCh0aGlzLmNvbXBvbmVudCk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBvLnNvdXJjZSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0Lm9wZW4odGhpcyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbGlnaHRib3gub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5saWdodGJveF9fY2xvc2VyXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5jbG9zZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGxpZ2h0Ym94Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIubGlnaHRib3hfX3ByZXZcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0LnByZXYoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBsaWdodGJveC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmxpZ2h0Ym94X19uZXh0XCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5uZXh0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfc2V0dXBJdGVtczogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGl0ZW1zID0gZWxlbWVudC5maW5kKG8uc291cmNlKTtcblxuICAgICAgICAgICAgaWYgKGl0ZW1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBpdGVtcztcbiAgICAgICAgfSxcblxuICAgICAgICBfZ290bzogZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyICRlbCA9ICQoZWwpO1xuICAgICAgICAgICAgdmFyIGltZyA9ICQoXCI8aW1nPlwiKSwgc3JjO1xuICAgICAgICAgICAgdmFyIGltYWdlQ29udGFpbmVyLCBpbWFnZVdyYXBwZXIsIGFjdGl2aXR5O1xuXG4gICAgICAgICAgICBpbWFnZUNvbnRhaW5lciA9IHRoaXMubGlnaHRib3guZmluZChcIi5saWdodGJveF9faW1hZ2VcIik7XG5cbiAgICAgICAgICAgIGltYWdlQ29udGFpbmVyLmZpbmQoXCIubGlnaHRib3hfX2ltYWdlLXdyYXBwZXJcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICBpbWFnZVdyYXBwZXIgPSAkKFwiPGRpdj5cIilcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJsaWdodGJveF9faW1hZ2Utd3JhcHBlclwiKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhvLmNsc0ltYWdlV3JhcHBlcilcbiAgICAgICAgICAgICAgICAuYXR0cihcImRhdGEtdGl0bGVcIiwgKCRlbC5hdHRyKFwiYWx0XCIpIHx8ICRlbC5hdHRyKFwiZGF0YS10aXRsZVwiKSB8fCBcIlwiKSlcbiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oaW1hZ2VDb250YWluZXIpO1xuXG4gICAgICAgICAgICBhY3Rpdml0eSA9ICQoXCI8ZGl2PlwiKS5hcHBlbmRUbyhpbWFnZVdyYXBwZXIpO1xuXG4gICAgICAgICAgICBNZXRyby5tYWtlUGx1Z2luKGFjdGl2aXR5LCBcImFjdGl2aXR5XCIsIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcImN5Y2xlXCIsXG4gICAgICAgICAgICAgICAgc3R5bGU6IFwiY29sb3JcIlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuY3VycmVudCA9IGVsO1xuXG4gICAgICAgICAgICBpZiAoZWwudGFnTmFtZSA9PT0gXCJJTUdcIiB8fCBlbC50YWdOYW1lID09PSBcIkRJVlwiKSB7XG4gICAgICAgICAgICAgICAgc3JjID0gJGVsLmF0dHIoXCJkYXRhLW9yaWdpbmFsXCIpIHx8ICRlbC5hdHRyKFwic3JjXCIpO1xuICAgICAgICAgICAgICAgIGltZy5hdHRyKFwic3JjXCIsIHNyYyk7XG4gICAgICAgICAgICAgICAgaW1nWzBdLm9ubG9hZCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3J0ID0gdGhpcy5oZWlnaHQgPiB0aGlzLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICBpbWcuYWRkQ2xhc3MocG9ydCA/IFwibGlnaHRib3hfX2ltYWdlLXBvcnRyYWl0XCIgOiBcImxpZ2h0Ym94X19pbWFnZS1sYW5kc2NhcGVcIikuYWRkQ2xhc3Moby5jbHNJbWFnZSk7XG4gICAgICAgICAgICAgICAgICAgIGltZy5hdHRyKFwiYWx0XCIsICRlbC5hdHRyKFwiYWx0XCIpKTtcbiAgICAgICAgICAgICAgICAgICAgaW1nLmFwcGVuZFRvKGltYWdlV3JhcHBlcik7XG4gICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJkcmF3LWltYWdlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiBpbWdbMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtOiBpbWFnZVdyYXBwZXJbMF1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9pbmRleDogZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gLTE7XG5cbiAgICAgICAgICAgIHRoaXMuaXRlbXMuZWFjaChmdW5jdGlvbihpKXtcbiAgICAgICAgICAgICAgICBpZiAodGhpcyA9PT0gZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gaW5kZXg7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbmV4dDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBpbmRleCwgY3VycmVudCA9IHRoaXMuY3VycmVudDtcblxuICAgICAgICAgICAgaW5kZXggPSB0aGlzLl9pbmRleChjdXJyZW50KTtcblxuICAgICAgICAgICAgaWYgKGluZGV4ICsgMSA+PSB0aGlzLml0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMubG9vcCkge1xuICAgICAgICAgICAgICAgICAgICBpbmRleCA9IC0xO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2dvdG8odGhpcy5pdGVtc1tpbmRleCArIDFdKTtcbiAgICAgICAgfSxcblxuICAgICAgICBwcmV2OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGluZGV4LCBjdXJyZW50ID0gdGhpcy5jdXJyZW50O1xuXG4gICAgICAgICAgICBpbmRleCA9IHRoaXMuX2luZGV4KGN1cnJlbnQpO1xuXG4gICAgICAgICAgICBpZiAoaW5kZXggLSAxIDwgMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMubG9vcCkge1xuICAgICAgICAgICAgICAgICAgICBpbmRleCA9IHRoaXMuaXRlbXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2dvdG8odGhpcy5pdGVtc1tpbmRleCAtIDFdKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvcGVuOiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICB0aGlzLl9zZXR1cEl0ZW1zKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2dvdG8oZWwpO1xuXG4gICAgICAgICAgICB0aGlzLm92ZXJsYXkuc2hvdygpO1xuICAgICAgICAgICAgdGhpcy5saWdodGJveC5zaG93KCk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNsb3NlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5vdmVybGF5LmhpZGUoKTtcbiAgICAgICAgICAgIHRoaXMubGlnaHRib3guaGlkZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgTGlzdERlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGxvY2FsZTogTUVUUk9fTE9DQUxFLFxuICAgICAgICBsaXN0RGVmZXJyZWQ6IDAsXG4gICAgICAgIHRlbXBsYXRlQmVnaW5Ub2tlbjogXCI8JVwiLFxuICAgICAgICB0ZW1wbGF0ZUVuZFRva2VuOiBcIiU+XCIsXG4gICAgICAgIHBhZ2luYXRpb25EaXN0YW5jZTogNSxcbiAgICAgICAgcGFnaW5hdGlvblNob3J0TW9kZTogdHJ1ZSxcbiAgICAgICAgdGhvdXNhbmRTZXBhcmF0b3I6IFwiLFwiLFxuICAgICAgICBkZWNpbWFsU2VwYXJhdG9yOiBcIixcIixcbiAgICAgICAgaXRlbVRhZzogXCJsaVwiLFxuICAgICAgICBkZWZhdWx0VGVtcGxhdGVUYWc6IFwiZGl2XCIsXG4gICAgICAgIHNvcnRDbGFzczogbnVsbCxcbiAgICAgICAgc29ydERpcjogXCJhc2NcIixcbiAgICAgICAgc29ydEluaXRpYWw6IHRydWUsXG4gICAgICAgIGZpbHRlckNsYXNzOiBudWxsLFxuICAgICAgICBmaWx0ZXI6IG51bGwsXG4gICAgICAgIGZpbHRlclN0cmluZzogXCJcIixcbiAgICAgICAgZmlsdGVyczogbnVsbCxcbiAgICAgICAgc291cmNlOiBudWxsLFxuICAgICAgICBzaG93SXRlbXNTdGVwczogZmFsc2UsXG4gICAgICAgIHNob3dTZWFyY2g6IGZhbHNlLFxuICAgICAgICBzaG93TGlzdEluZm86IGZhbHNlLFxuICAgICAgICBzaG93UGFnaW5hdGlvbjogZmFsc2UsXG4gICAgICAgIHNob3dBY3Rpdml0eTogdHJ1ZSxcbiAgICAgICAgbXV0ZUxpc3Q6IHRydWUsXG4gICAgICAgIGl0ZW1zOiAtMSxcbiAgICAgICAgaXRlbXNTdGVwczogXCJhbGwsIDEwLDI1LDUwLDEwMFwiLFxuICAgICAgICBpdGVtc0FsbFRpdGxlOiBcIlNob3cgYWxsXCIsXG4gICAgICAgIGxpc3RJdGVtc0NvdW50VGl0bGU6IFwiU2hvdyBlbnRyaWVzOlwiLFxuICAgICAgICBsaXN0U2VhcmNoVGl0bGU6IFwiU2VhcmNoOlwiLFxuICAgICAgICBsaXN0SW5mb1RpdGxlOiBcIlNob3dpbmcgJDEgdG8gJDIgb2YgJDMgZW50cmllc1wiLFxuICAgICAgICBwYWdpbmF0aW9uUHJldlRpdGxlOiBcIlByZXZcIixcbiAgICAgICAgcGFnaW5hdGlvbk5leHRUaXRsZTogXCJOZXh0XCIsXG4gICAgICAgIGFjdGl2aXR5VHlwZTogXCJjeWNsZVwiLFxuICAgICAgICBhY3Rpdml0eVN0eWxlOiBcImNvbG9yXCIsXG4gICAgICAgIGFjdGl2aXR5VGltZW91dDogMTAwLFxuICAgICAgICBzZWFyY2hXcmFwcGVyOiBudWxsLFxuICAgICAgICByb3dzV3JhcHBlcjogbnVsbCxcbiAgICAgICAgaW5mb1dyYXBwZXI6IG51bGwsXG4gICAgICAgIHBhZ2luYXRpb25XcmFwcGVyOiBudWxsLFxuICAgICAgICBjbHNDb21wb25lbnQ6IFwiXCIsXG4gICAgICAgIGNsc0xpc3Q6IFwiXCIsXG4gICAgICAgIGNsc0xpc3RJdGVtOiBcIlwiLFxuICAgICAgICBjbHNMaXN0VG9wOiBcIlwiLFxuICAgICAgICBjbHNJdGVtc0NvdW50OiBcIlwiLFxuICAgICAgICBjbHNTZWFyY2g6IFwiXCIsXG4gICAgICAgIGNsc0xpc3RCb3R0b206IFwiXCIsXG4gICAgICAgIGNsc0xpc3RJbmZvOiBcIlwiLFxuICAgICAgICBjbHNMaXN0UGFnaW5hdGlvbjogXCJcIixcbiAgICAgICAgY2xzUGFnaW5hdGlvbjogXCJcIixcbiAgICAgICAgY2xzVGVtcGxhdGVUYWc6IFwiXCIsXG4gICAgICAgIG9uRHJhdzogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EcmF3SXRlbTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Tb3J0U3RhcnQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uU29ydFN0b3A6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uU29ydEl0ZW1Td2l0Y2g6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uU2VhcmNoOiBNZXRyby5ub29wLFxuICAgICAgICBvblJvd3NDb3VudENoYW5nZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EYXRhTG9hZDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EYXRhTG9hZGVkOiBNZXRyby5ub29wLFxuICAgICAgICBvbkRhdGFMb2FkRXJyb3I6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uRmlsdGVySXRlbUFjY2VwdGVkOiBNZXRyby5ub29wLFxuICAgICAgICBvbkZpbHRlckl0ZW1EZWNsaW5lZDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25MaXN0Q3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLmxpc3RTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIExpc3REZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIExpc3REZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb0xpc3RTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmxpc3RTZXR1cCh3aW5kb3dbXCJtZXRyb0xpc3RTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdsaXN0Jywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIExpc3REZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgY3VycmVudFBhZ2U6IDEsXG4gICAgICAgICAgICAgICAgcGFnZXNDb3VudDogMSxcbiAgICAgICAgICAgICAgICBmaWx0ZXJTdHJpbmc6IFwiXCIsXG4gICAgICAgICAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgICAgICAgICAgICBhY3Rpdml0eTogbnVsbCxcbiAgICAgICAgICAgICAgICBidXN5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICBmaWx0ZXJzOiBbXSxcbiAgICAgICAgICAgICAgICB3cmFwcGVySW5mbzogbnVsbCxcbiAgICAgICAgICAgICAgICB3cmFwcGVyU2VhcmNoOiBudWxsLFxuICAgICAgICAgICAgICAgIHdyYXBwZXJSb3dzOiBudWxsLFxuICAgICAgICAgICAgICAgIHdyYXBwZXJQYWdpbmF0aW9uOiBudWxsLFxuICAgICAgICAgICAgICAgIGZpbHRlckluZGV4OiBudWxsLFxuICAgICAgICAgICAgICAgIGZpbHRlcnNJbmRleGVzOiBbXSxcbiAgICAgICAgICAgICAgICBpdGVtVGVtcGxhdGU6IG51bGwsXG5cbiAgICAgICAgICAgICAgICBzb3J0OiB7XG4gICAgICAgICAgICAgICAgICAgIGRpcjogXCJhc2NcIixcbiAgICAgICAgICAgICAgICAgICAgY29sSW5kZXg6IDBcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgaGVhZGVyOiBudWxsLFxuICAgICAgICAgICAgICAgIGl0ZW1zOiBbXVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmIChvLnNvdXJjZSkge1xuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImRhdGEtbG9hZFwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZTogby5zb3VyY2VcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGZldGNoKG8uc291cmNlKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihNZXRyby5mZXRjaC5zdGF0dXMpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKE1ldHJvLmZldGNoLmpzb24pXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZGF0YS1sb2FkZWRcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogby5zb3VyY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9idWlsZChkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImRhdGEtbG9hZC1lcnJvclwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBvLnNvdXJjZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGF0Ll9idWlsZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9idWlsZDogZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUl0ZW1zRnJvbUpTT04oZGF0YSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUl0ZW1zRnJvbUhUTUwoKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJsaXN0LWNyZWF0ZVwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlSXRlbXNGcm9tSFRNTDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjbHNUZW1wbGF0ZVRhZyA9IChcIlwiK28uY2xzVGVtcGxhdGVUYWcpLnRvQXJyYXkoXCIsXCIpXG5cbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBbXTtcblxuICAgICAgICAgICAgJC5lYWNoKGVsZW1lbnQuY2hpbGRyZW4oby5pdGVtVGFnKSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgdGFnQ2hpbGRyZW4gPSAkKHRoaXMpLmNoaWxkcmVuKFwiKlwiKTtcblxuICAgICAgICAgICAgICAgIGlmIChjbHNUZW1wbGF0ZVRhZy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNsc1RlbXBsYXRlVGFnLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFnQ2hpbGRyZW4uYWRkQ2xhc3MoY2xzVGVtcGxhdGVUYWdbMF0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFnQ2hpbGRyZW4uZWFjaChmdW5jdGlvbiAoaSwgY2hpbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGNoaWxkKS5hZGRDbGFzcyhjbHNUZW1wbGF0ZVRhZ1tpXSA/IGNsc1RlbXBsYXRlVGFnW2ldIDogY2xzVGVtcGxhdGVUYWdbY2xzVGVtcGxhdGVUYWcubGVuZ3RoIC0gMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGF0Lml0ZW1zLnB1c2godGhpcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlSXRlbXNGcm9tSlNPTjogZnVuY3Rpb24oc291cmNlKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjbHNUZW1wbGF0ZVRhZyA9IChcIlwiK28uY2xzVGVtcGxhdGVUYWcpLnRvQXJyYXkoXCIsXCIpXG5cbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBbXTtcblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoc291cmNlLnRlbXBsYXRlKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXRlbVRlbXBsYXRlID0gc291cmNlLnRlbXBsYXRlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShzb3VyY2UuaGVhZGVyKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGVhZGVyID0gc291cmNlLmhlYWRlcjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoc291cmNlLmRhdGEpKSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKHNvdXJjZS5kYXRhLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9ICcnLCByb3cgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KG8uaXRlbVRhZyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0cGwgPSB0aGF0Lml0ZW1UZW1wbGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhZ0NoaWxkcmVuO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZSh0cGwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHJvdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gKz0gXCI8XCIrby5kZWZhdWx0VGVtcGxhdGVUYWcrXCI+XCIrcm93W2ldK1wiPC9cIitvLmRlZmF1bHRUZW1wbGF0ZVRhZytcIj5cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBNZXRyby50ZW1wbGF0ZSh0cGwsIHJvdywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZ2luVG9rZW46IG8udGVtcGxhdGVCZWdpblRva2VuLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZFRva2VuOiBvLnRlbXBsYXRlRW5kVG9rZW5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbGkuaW5uZXJIVE1MID0gaXRlbTtcbiAgICAgICAgICAgICAgICAgICAgdGFnQ2hpbGRyZW4gPSAkKGxpKS5jaGlsZHJlbihcIipcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNsc1RlbXBsYXRlVGFnLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNsc1RlbXBsYXRlVGFnLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ0NoaWxkcmVuLmFkZENsYXNzKGNsc1RlbXBsYXRlVGFnWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnQ2hpbGRyZW4uZWFjaChmdW5jdGlvbiAoaSwgY2hpbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChjaGlsZCkuYWRkQ2xhc3MoY2xzVGVtcGxhdGVUYWdbaV0gPyBjbHNUZW1wbGF0ZVRhZ1tpXSA6IGNsc1RlbXBsYXRlVGFnW2Nsc1RlbXBsYXRlVGFnLmxlbmd0aCAtIDFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5pdGVtcy5wdXNoKGxpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlVG9wQmxvY2s6IGZ1bmN0aW9uICgpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHRvcF9ibG9jayA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImxpc3QtdG9wXCIpLmFkZENsYXNzKG8uY2xzTGlzdFRvcCkuaW5zZXJ0QmVmb3JlKGVsZW1lbnQpO1xuICAgICAgICAgICAgdmFyIHNlYXJjaF9ibG9jaywgc2VhcmNoX2lucHV0LCByb3dzX2Jsb2NrLCByb3dzX3NlbGVjdDtcblxuICAgICAgICAgICAgc2VhcmNoX2Jsb2NrID0gVXRpbHMuaXNWYWx1ZSh0aGlzLndyYXBwZXJTZWFyY2gpID8gdGhpcy53cmFwcGVyU2VhcmNoIDogJChcIjxkaXY+XCIpLmFkZENsYXNzKFwibGlzdC1zZWFyY2gtYmxvY2tcIikuYWRkQ2xhc3Moby5jbHNTZWFyY2gpLmFwcGVuZFRvKHRvcF9ibG9jayk7XG5cbiAgICAgICAgICAgIHNlYXJjaF9pbnB1dCA9ICQoXCI8aW5wdXQ+XCIpLmF0dHIoXCJ0eXBlXCIsIFwidGV4dFwiKS5hcHBlbmRUbyhzZWFyY2hfYmxvY2spO1xuICAgICAgICAgICAgc2VhcmNoX2lucHV0LmlucHV0KHtcbiAgICAgICAgICAgICAgICBwcmVwZW5kOiBvLmxpc3RTZWFyY2hUaXRsZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChvLnNob3dTZWFyY2ggIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBzZWFyY2hfYmxvY2suaGlkZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByb3dzX2Jsb2NrID0gVXRpbHMuaXNWYWx1ZSh0aGlzLndyYXBwZXJSb3dzKSA/IHRoaXMud3JhcHBlclJvd3MgOiAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJsaXN0LXJvd3MtYmxvY2tcIikuYWRkQ2xhc3Moby5jbHNJdGVtc0NvdW50KS5hcHBlbmRUbyh0b3BfYmxvY2spO1xuXG4gICAgICAgICAgICByb3dzX3NlbGVjdCA9ICQoXCI8c2VsZWN0PlwiKS5hcHBlbmRUbyhyb3dzX2Jsb2NrKTtcbiAgICAgICAgICAgICQuZWFjaChvLml0ZW1zU3RlcHMudG9BcnJheSgpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbiA9ICQoXCI8b3B0aW9uPlwiKS5hdHRyKFwidmFsdWVcIiwgdGhpcyA9PT0gXCJhbGxcIiA/IC0xIDogdGhpcykudGV4dCh0aGlzID09PSBcImFsbFwiID8gby5pdGVtc0FsbFRpdGxlIDogdGhpcykuYXBwZW5kVG8ocm93c19zZWxlY3QpO1xuICAgICAgICAgICAgICAgIGlmICgrdGhpcyA9PT0gK28uaXRlbXMpIG9wdGlvbi5hdHRyKFwic2VsZWN0ZWRcIiwgXCJzZWxlY3RlZFwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcm93c19zZWxlY3Quc2VsZWN0KHtcbiAgICAgICAgICAgICAgICBmaWx0ZXI6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHByZXBlbmQ6IG8ubGlzdEl0ZW1zQ291bnRUaXRsZSxcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoK3ZhbCA9PT0gK28uaXRlbXMpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgby5pdGVtcyA9IHBhcnNlSW50KHZhbCk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBhZ2UgPSAxO1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9kcmF3KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwicm93cy1jb3VudC1jaGFuZ2VcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiB2YWxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChvLnNob3dJdGVtc1N0ZXBzICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgcm93c19ibG9jay5oaWRlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0b3BfYmxvY2s7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUJvdHRvbUJsb2NrOiBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGJvdHRvbV9ibG9jayA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImxpc3QtYm90dG9tXCIpLmFkZENsYXNzKG8uY2xzTGlzdEJvdHRvbSkuaW5zZXJ0QWZ0ZXIoZWxlbWVudCk7XG4gICAgICAgICAgICB2YXIgaW5mbywgcGFnaW5hdGlvbjtcblxuICAgICAgICAgICAgaW5mbyA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImxpc3QtaW5mb1wiKS5hZGRDbGFzcyhvLmNsc0xpc3RJbmZvKS5hcHBlbmRUbyhib3R0b21fYmxvY2spO1xuICAgICAgICAgICAgaWYgKG8uc2hvd0xpc3RJbmZvICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgaW5mby5oaWRlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBhZ2luYXRpb24gPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJsaXN0LXBhZ2luYXRpb25cIikuYWRkQ2xhc3Moby5jbHNMaXN0UGFnaW5hdGlvbikuYXBwZW5kVG8oYm90dG9tX2Jsb2NrKTtcbiAgICAgICAgICAgIGlmIChvLnNob3dQYWdpbmF0aW9uICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgcGFnaW5hdGlvbi5oaWRlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBib3R0b21fYmxvY2s7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVN0cnVjdHVyZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBsaXN0X2NvbXBvbmVudDtcbiAgICAgICAgICAgIHZhciB3X3NlYXJjaCA9ICQoby5zZWFyY2hXcmFwcGVyKSxcbiAgICAgICAgICAgICAgICB3X2luZm8gPSAkKG8uaW5mb1dyYXBwZXIpLFxuICAgICAgICAgICAgICAgIHdfcm93cyA9ICQoby5yb3dzV3JhcHBlciksXG4gICAgICAgICAgICAgICAgd19wYWdpbmcgPSAkKG8ucGFnaW5hdGlvbldyYXBwZXIpO1xuXG4gICAgICAgICAgICBpZiAod19zZWFyY2gubGVuZ3RoID4gMCkge3RoaXMud3JhcHBlclNlYXJjaCA9IHdfc2VhcmNoO31cbiAgICAgICAgICAgIGlmICh3X2luZm8ubGVuZ3RoID4gMCkge3RoaXMud3JhcHBlckluZm8gPSB3X2luZm87fVxuICAgICAgICAgICAgaWYgKHdfcm93cy5sZW5ndGggPiAwKSB7dGhpcy53cmFwcGVyUm93cyA9IHdfcm93czt9XG4gICAgICAgICAgICBpZiAod19wYWdpbmcubGVuZ3RoID4gMCkge3RoaXMud3JhcHBlclBhZ2luYXRpb24gPSB3X3BhZ2luZzt9XG5cbiAgICAgICAgICAgIGlmICghZWxlbWVudC5wYXJlbnQoKS5oYXNDbGFzcyhcImxpc3QtY29tcG9uZW50XCIpKSB7XG4gICAgICAgICAgICAgICAgbGlzdF9jb21wb25lbnQgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJsaXN0LWNvbXBvbmVudFwiKS5pbnNlcnRCZWZvcmUoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRUbyhsaXN0X2NvbXBvbmVudCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxpc3RfY29tcG9uZW50ID0gZWxlbWVudC5wYXJlbnQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGlzdF9jb21wb25lbnQuYWRkQ2xhc3Moby5jbHNDb21wb25lbnQpO1xuXG4gICAgICAgICAgICB0aGlzLmFjdGl2aXR5ID0gICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImxpc3QtcHJvZ3Jlc3NcIikuYXBwZW5kVG8obGlzdF9jb21wb25lbnQpO1xuICAgICAgICAgICAgJChcIjxkaXY+XCIpLmFjdGl2aXR5KHtcbiAgICAgICAgICAgICAgICB0eXBlOiBvLmFjdGl2aXR5VHlwZSxcbiAgICAgICAgICAgICAgICBzdHlsZTogby5hY3Rpdml0eVN0eWxlXG4gICAgICAgICAgICB9KS5hcHBlbmRUbyh0aGlzLmFjdGl2aXR5KTtcblxuICAgICAgICAgICAgaWYgKG8uc2hvd0FjdGl2aXR5ICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3Rpdml0eS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiBcImhpZGRlblwiXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gZWxlbWVudC5odG1sKFwiXCIpLmFkZENsYXNzKG8uY2xzTGlzdCk7XG4gICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKG8uY2xzTGlzdCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVRvcEJsb2NrKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVCb3R0b21CbG9jaygpO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLmZpbHRlclN0cmluZykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlclN0cmluZyA9IG8uZmlsdGVyU3RyaW5nO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgZmlsdGVyX2Z1bmM7XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8uZmlsdGVyKSkge1xuICAgICAgICAgICAgICAgIGZpbHRlcl9mdW5jID0gVXRpbHMuaXNGdW5jKG8uZmlsdGVyKTtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyX2Z1bmMgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcl9mdW5jID0gVXRpbHMuZnVuYyhvLmZpbHRlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoYXQuZmlsdGVySW5kZXggPSB0aGF0LmFkZEZpbHRlcihmaWx0ZXJfZnVuYyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8uZmlsdGVycykgJiYgdHlwZW9mIG8uZmlsdGVycyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAkLmVhY2goby5maWx0ZXJzLnRvQXJyYXkoKSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2Z1bmMgPSBVdGlscy5pc0Z1bmModGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJfZnVuYyAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuZmlsdGVyc0luZGV4ZXMucHVzaCh0aGF0LmFkZEZpbHRlcihmaWx0ZXJfZnVuYykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSAxO1xuXG4gICAgICAgICAgICBpZiAoby5zb3J0SW5pdGlhbCAhPT0gZmFsc2UpXG4gICAgICAgICAgICAgICAgdGhpcy5zb3J0aW5nKG8uc29ydENsYXNzLCBvLnNvcnREaXIsIHRydWUpO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHRoaXMuZHJhdygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgY29tcG9uZW50ID0gZWxlbWVudC5wYXJlbnQoKTtcbiAgICAgICAgICAgIHZhciBzZWFyY2ggPSBjb21wb25lbnQuZmluZChcIi5saXN0LXNlYXJjaC1ibG9jayBpbnB1dFwiKTtcbiAgICAgICAgICAgIHZhciBjdXN0b21TZWFyY2g7XG5cbiAgICAgICAgICAgIHNlYXJjaC5vbihNZXRyby5ldmVudHMuaW5wdXRjaGFuZ2UsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5maWx0ZXJTdHJpbmcgPSB0aGlzLnZhbHVlLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIGlmICh0aGF0LmZpbHRlclN0cmluZ1t0aGF0LmZpbHRlclN0cmluZy5sZW5ndGggLSAxXSA9PT0gXCI6XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhhdC5jdXJyZW50UGFnZSA9IDE7XG4gICAgICAgICAgICAgICAgdGhhdC5fZHJhdygpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKHRoaXMud3JhcHBlclNlYXJjaCkpIHtcbiAgICAgICAgICAgICAgICBjdXN0b21TZWFyY2ggPSB0aGlzLndyYXBwZXJTZWFyY2guZmluZChcImlucHV0XCIpO1xuICAgICAgICAgICAgICAgIGlmIChjdXN0b21TZWFyY2gubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBjdXN0b21TZWFyY2gub24oTWV0cm8uZXZlbnRzLmlucHV0Y2hhbmdlLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5maWx0ZXJTdHJpbmcgPSB0aGlzLnZhbHVlLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQuZmlsdGVyU3RyaW5nW3RoYXQuZmlsdGVyU3RyaW5nLmxlbmd0aCAtIDFdID09PSBcIjpcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnRQYWdlID0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2RyYXcoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBwYWdlTGlua0NsaWNrKGwpe1xuICAgICAgICAgICAgICAgIHZhciBsaW5rID0gJChsKTtcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGxpbmsucGFyZW50KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5oYXNDbGFzcyhcImFjdGl2ZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmhhc0NsYXNzKFwic2VydmljZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobGluay5kYXRhKFwicGFnZVwiKSA9PT0gXCJwcmV2XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBhZ2UtLTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LmN1cnJlbnRQYWdlID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5jdXJyZW50UGFnZSA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnRQYWdlKys7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5jdXJyZW50UGFnZSA+IHRoYXQucGFnZXNDb3VudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBhZ2UgPSB0aGF0LnBhZ2VzQ291bnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnRQYWdlID0gbGluay5kYXRhKFwicGFnZVwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9kcmF3KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbXBvbmVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLnBhZ2luYXRpb24gLnBhZ2UtbGlua1wiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHBhZ2VMaW5rQ2xpY2sodGhpcylcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZSh0aGlzLndyYXBwZXJQYWdpbmF0aW9uKSkge1xuICAgICAgICAgICAgICAgIHRoaXMud3JhcHBlclBhZ2luYXRpb24ub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5wYWdpbmF0aW9uIC5wYWdlLWxpbmtcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgcGFnZUxpbmtDbGljayh0aGlzKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9pbmZvOiBmdW5jdGlvbihzdGFydCwgc3RvcCwgbGVuZ3RoKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGNvbXBvbmVudCA9IGVsZW1lbnQucGFyZW50KCk7XG4gICAgICAgICAgICB2YXIgaW5mbyA9IFV0aWxzLmlzVmFsdWUodGhpcy53cmFwcGVySW5mbykgPyB0aGlzLndyYXBwZXJJbmZvIDogY29tcG9uZW50LmZpbmQoXCIubGlzdC1pbmZvXCIpO1xuICAgICAgICAgICAgdmFyIHRleHQ7XG5cbiAgICAgICAgICAgIGlmIChpbmZvLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzdG9wID4gbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgc3RvcCA9IGxlbmd0aDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMuaXRlbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgc3RhcnQgPSBzdG9wID0gbGVuZ3RoID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGV4dCA9IG8ubGlzdEluZm9UaXRsZTtcbiAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoXCIkMVwiLCBzdGFydCk7XG4gICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKFwiJDJcIiwgc3RvcCk7XG4gICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKFwiJDNcIiwgbGVuZ3RoKTtcbiAgICAgICAgICAgIGluZm8uaHRtbCh0ZXh0KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfcGFnaW5nOiBmdW5jdGlvbihsZW5ndGgpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY29tcG9uZW50ID0gZWxlbWVudC5wYXJlbnQoKTtcbiAgICAgICAgICAgIHRoaXMucGFnZXNDb3VudCA9IE1hdGguY2VpbChsZW5ndGggLyBvLml0ZW1zKTsgLy8g0JrQvtGB0YLRi9C70YxcbiAgICAgICAgICAgIE1ldHJvLnBhZ2luYXRpb24oe1xuICAgICAgICAgICAgICAgIGxlbmd0aDogbGVuZ3RoLFxuICAgICAgICAgICAgICAgIHJvd3M6IG8uaXRlbXMsXG4gICAgICAgICAgICAgICAgY3VycmVudDogdGhpcy5jdXJyZW50UGFnZSxcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IFV0aWxzLmlzVmFsdWUodGhpcy53cmFwcGVyUGFnaW5hdGlvbikgPyB0aGlzLndyYXBwZXJQYWdpbmF0aW9uIDogY29tcG9uZW50LmZpbmQoXCIubGlzdC1wYWdpbmF0aW9uXCIpLFxuICAgICAgICAgICAgICAgIGNsYVBhZ2luYXRpb246IG8uY2xzUGFnaW5hdGlvbixcbiAgICAgICAgICAgICAgICBwcmV2VGl0bGU6IG8ucGFnaW5hdGlvblByZXZUaXRsZSxcbiAgICAgICAgICAgICAgICBuZXh0VGl0bGU6IG8ucGFnaW5hdGlvbk5leHRUaXRsZSxcbiAgICAgICAgICAgICAgICBkaXN0YW5jZTogby5wYWdpbmF0aW9uU2hvcnRNb2RlID09PSB0cnVlID8gby5wYWdpbmF0aW9uRGlzdGFuY2UgOiAwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfZmlsdGVyOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLFxuICAgICAgICAgICAgICAgIG8gPSB0aGlzLm9wdGlvbnMsXG4gICAgICAgICAgICAgICAgaXRlbXMsIGksIGRhdGEsIGluc2V0LCBjMSwgcmVzdWx0O1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZSh0aGlzLmZpbHRlclN0cmluZykgfHwgdGhpcy5maWx0ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBpdGVtcyA9IHRoaXMuaXRlbXMuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgICAgICAgICAgICAgICBkYXRhID0gXCJcIjtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLmZpbHRlckNsYXNzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXQgPSBpdGVtLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoby5maWx0ZXJDbGFzcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnNldC5sZW5ndGggPiAwKSBmb3IgKGkgPSAwOyBpIDwgaW5zZXQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhICs9IGluc2V0W2ldLnRleHRDb250ZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGl0ZW0udGV4dENvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjMSA9IGRhdGEucmVwbGFjZSgvW1xcblxccl0rfFtcXHNdezIsfS9nLCAnICcpLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBVdGlscy5pc1ZhbHVlKHRoYXQuZmlsdGVyU3RyaW5nKSA/IGMxLmluZGV4T2YodGhhdC5maWx0ZXJTdHJpbmcpID4gLTEgOiB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUgJiYgdGhhdC5maWx0ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGF0LmZpbHRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoVXRpbHMuZXhlYyh0aGF0LmZpbHRlcnNbaV0sIFtpdGVtXSkgIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZmlsdGVyLWl0ZW0tYWNjZXB0ZWRcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IGl0ZW1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImZpbHRlci1pdGVtLWRlY2xpbmVkXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtOiBpdGVtXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInNlYXJjaFwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaDogdGhhdC5maWx0ZXJTdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBpdGVtc1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGl0ZW1zID0gdGhpcy5pdGVtcztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9kcmF3OiBmdW5jdGlvbihjYil7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBpO1xuICAgICAgICAgICAgdmFyIHN0YXJ0ID0gby5pdGVtcyA9PT0gLTEgPyAwIDogby5pdGVtcyAqICh0aGlzLmN1cnJlbnRQYWdlIC0gMSksXG4gICAgICAgICAgICAgICAgc3RvcCA9IG8uaXRlbXMgPT09IC0xID8gdGhpcy5pdGVtcy5sZW5ndGggLSAxIDogc3RhcnQgKyBvLml0ZW1zIC0gMTtcbiAgICAgICAgICAgIHZhciBpdGVtcztcblxuICAgICAgICAgICAgaXRlbXMgPSB0aGlzLl9maWx0ZXIoKTtcblxuICAgICAgICAgICAgZWxlbWVudC5jaGlsZHJlbihvLml0ZW1UYWcpLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICBmb3IgKGkgPSBzdGFydDsgaSA8PSBzdG9wOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShpdGVtc1tpXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgJChpdGVtc1tpXSkuYWRkQ2xhc3Moby5jbHNMaXN0SXRlbSkuYXBwZW5kVG8oZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiZHJhdy1pdGVtXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbTogaXRlbXNbaV1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9pbmZvKHN0YXJ0ICsgMSwgc3RvcCArIDEsIGl0ZW1zLmxlbmd0aCk7XG4gICAgICAgICAgICB0aGlzLl9wYWdpbmcoaXRlbXMubGVuZ3RoKTtcblxuICAgICAgICAgICAgdGhpcy5hY3Rpdml0eS5oaWRlKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImRyYXdcIik7XG5cbiAgICAgICAgICAgIGlmIChjYiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgVXRpbHMuZXhlYyhjYiwgW2VsZW1lbnRdLCBlbGVtZW50WzBdKVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9nZXRJdGVtQ29udGVudDogZnVuY3Rpb24oaXRlbSl7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucywgJGl0ZW0gPSAkKGl0ZW0pO1xuICAgICAgICAgICAgdmFyIGksIGluc2V0LCBkYXRhO1xuICAgICAgICAgICAgdmFyIGZvcm1hdCwgZm9ybWF0TWFzayA9IFV0aWxzLmlzVmFsdWUoJGl0ZW0uZGF0YShcImZvcm1hdE1hc2tcIikpID8gJGl0ZW0uZGF0YShcImZvcm1hdE1hc2tcIikgOiBudWxsO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLnNvcnRDbGFzcykpIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gXCJcIjtcbiAgICAgICAgICAgICAgICBpbnNldCA9ICQoaXRlbSkuZmluZChcIi5cIitvLnNvcnRDbGFzcyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaW5zZXQubGVuZ3RoID4gMCkgZm9yIChpID0gMDsgaSA8IGluc2V0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEgKz0gaW5zZXRbaV0udGV4dENvbnRlbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvcm1hdCA9IGluc2V0Lmxlbmd0aCA+IDAgPyBpbnNldFswXS5nZXRBdHRyaWJ1dGUoXCJkYXRhLWZvcm1hdFwiKSA6IFwiXCI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBpdGVtLnRleHRDb250ZW50O1xuICAgICAgICAgICAgICAgIGZvcm1hdCA9IGl0ZW0uZ2V0QXR0cmlidXRlKFwiZGF0YS1mb3JtYXRcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRhdGEgPSAoXCJcIitkYXRhKS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1tcXG5cXHJdK3xbXFxzXXsyLH0vZywgJyAnKS50cmltKCk7XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKGZvcm1hdCkpIHtcblxuICAgICAgICAgICAgICAgIGlmIChbJ251bWJlcicsICdpbnQnLCAnaW50ZWdlcicsICdmbG9hdCcsICdtb25leSddLmluZGV4T2YoZm9ybWF0KSAhPT0gLTEgJiYgKG8udGhvdXNhbmRTZXBhcmF0b3IgIT09IFwiLFwiIHx8IG8uZGVjaW1hbFNlcGFyYXRvciAhPT0gXCIuXCIgKSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhID0gVXRpbHMucGFyc2VOdW1iZXIoZGF0YSwgby50aG91c2FuZFNlcGFyYXRvciwgby5kZWNpbWFsU2VwYXJhdG9yKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGZvcm1hdCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiZGF0ZVwiOiBkYXRhID0gZm9ybWF0TWFzayA/IERhdGV0aW1lLmZyb20oZGF0YSwgZm9ybWF0TWFzaywgby5sb2NhbGUpIDogZGF0ZXRpbWUoZGF0YSk7IGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwibnVtYmVyXCI6IGRhdGEgPSBOdW1iZXIoZGF0YSk7IGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiaW50XCI6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJpbnRlZ2VyXCI6IGRhdGEgPSBwYXJzZUludChkYXRhKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJmbG9hdFwiOiBkYXRhID0gcGFyc2VGbG9hdChkYXRhKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJtb25leVwiOiBkYXRhID0gVXRpbHMucGFyc2VNb25leShkYXRhKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJjYXJkXCI6IGRhdGEgPSBVdGlscy5wYXJzZUNhcmQoZGF0YSk7IGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwicGhvbmVcIjogZGF0YSA9IFV0aWxzLnBhcnNlUGhvbmUoZGF0YSk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVsZXRlSXRlbTogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgICAgdmFyIGksIGRlbGV0ZUluZGV4ZXMgPSBbXSwgaXRlbTtcbiAgICAgICAgICAgIHZhciBpc19mdW5jID0gVXRpbHMuaXNGdW5jKHZhbHVlKTtcblxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpdGVtID0gdGhpcy5pdGVtc1tpXTtcblxuICAgICAgICAgICAgICAgIGlmIChpc19mdW5jKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChVdGlscy5leGVjKHZhbHVlLCBbaXRlbV0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVJbmRleGVzLnB1c2goaSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50ZXh0Q29udGVudC5pbmNsdWRlcyh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZUluZGV4ZXMucHVzaChpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5pdGVtcyA9IFV0aWxzLmFycmF5RGVsZXRlQnlNdWx0aXBsZUtleXModGhpcy5pdGVtcywgZGVsZXRlSW5kZXhlcyk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRyYXc6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZHJhdygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNvcnRpbmc6IGZ1bmN0aW9uKHNvdXJjZSwgZGlyLCByZWRyYXcpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShzb3VyY2UpKSB7XG4gICAgICAgICAgICAgICAgby5zb3J0Q2xhc3MgPSBzb3VyY2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShkaXIpICYmIFtcImFzY1wiLCBcImRlc2NcIl0uaW5kZXhPZihkaXIpID4gLTEpIHtcbiAgICAgICAgICAgICAgICBvLnNvcnREaXI9IGRpcjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwic29ydC1zdGFydFwiLCB7XG4gICAgICAgICAgICAgICAgaXRlbXM6IHRoaXMuaXRlbXNcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLml0ZW1zLnNvcnQoZnVuY3Rpb24oYSwgYil7XG4gICAgICAgICAgICAgICAgdmFyIGMxID0gdGhhdC5fZ2V0SXRlbUNvbnRlbnQoYSk7XG4gICAgICAgICAgICAgICAgdmFyIGMyID0gdGhhdC5fZ2V0SXRlbUNvbnRlbnQoYik7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IDA7XG5cbiAgICAgICAgICAgICAgICBpZiAoYzEgPCBjMikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBvLnNvcnREaXIgPT09IFwiYXNjXCIgPyAtMSA6IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjMSA+IGMyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IG8uc29ydERpciA9PT0gXCJhc2NcIiA/IDEgOiAtMTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICE9PSAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwic29ydC1pdGVtLXN3aXRjaFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhOiBhLFxuICAgICAgICAgICAgICAgICAgICAgICAgYjogYixcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdDogcmVzdWx0XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwic29ydC1zdG9wXCIsIHtcbiAgICAgICAgICAgICAgICBpdGVtczogdGhpcy5pdGVtc1xuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgaWYgKHJlZHJhdyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RyYXcoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZmlsdGVyOiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJTdHJpbmcgPSB2YWwudHJpbSgpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gMTtcbiAgICAgICAgICAgIHRoaXMuX2RyYXcoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBsb2FkRGF0YTogZnVuY3Rpb24oc291cmNlKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoc291cmNlKSAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG8uc291cmNlID0gc291cmNlO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJkYXRhLWxvYWRcIiwge1xuICAgICAgICAgICAgICAgIHNvdXJjZTogby5zb3VyY2VcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBmZXRjaChvLnNvdXJjZSlcbiAgICAgICAgICAgICAgICAudGhlbihNZXRyby5mZXRjaC5zdGF0dXMpXG4gICAgICAgICAgICAgICAgLnRoZW4oTWV0cm8uZmV0Y2guanNvbilcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZGF0YS1sb2FkZWRcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBvLnNvdXJjZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fY3JlYXRlSXRlbXNGcm9tSlNPTihkYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50Lmh0bWwoXCJcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5maWx0ZXJTdHJpbmcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmZpbHRlclN0cmluZyA9IG8uZmlsdGVyU3RyaW5nO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbHRlcl9mdW5jO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8uZmlsdGVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2Z1bmMgPSBVdGlscy5pc0Z1bmMoby5maWx0ZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlcl9mdW5jID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9mdW5jID0gVXRpbHMuZnVuYyhvLmZpbHRlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmZpbHRlckluZGV4ID0gdGhhdC5hZGRGaWx0ZXIoZmlsdGVyX2Z1bmMpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5maWx0ZXJzKSAmJiB0eXBlb2Ygby5maWx0ZXJzID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKG8uZmlsdGVycy50b0FycmF5KCksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2Z1bmMgPSBVdGlscy5pc0Z1bmModGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlcl9mdW5jICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmZpbHRlcnNJbmRleGVzLnB1c2godGhhdC5hZGRGaWx0ZXIoZmlsdGVyX2Z1bmMpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBhZ2UgPSAxO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuc29ydGluZyhvLnNvcnRDbGFzcywgby5zb3J0RGlyLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImRhdGEtbG9hZC1lcnJvclwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2U6IG8uc291cmNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgbmV4dDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0aGlzLml0ZW1zLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2UrKztcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRQYWdlID4gdGhpcy5wYWdlc0NvdW50KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IHRoaXMucGFnZXNDb3VudDtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fZHJhdygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHByZXY6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiAodGhpcy5pdGVtcy5sZW5ndGggPT09IDApIHJldHVybiA7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlLS07XG4gICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50UGFnZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSAxO1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9kcmF3KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZmlyc3Q6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiAodGhpcy5pdGVtcy5sZW5ndGggPT09IDApIHJldHVybiA7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gMTtcbiAgICAgICAgICAgIHRoaXMuX2RyYXcoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBsYXN0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHRoaXMuaXRlbXMubGVuZ3RoID09PSAwKSByZXR1cm4gO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IHRoaXMucGFnZXNDb3VudDtcbiAgICAgICAgICAgIHRoaXMuX2RyYXcoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBwYWdlOiBmdW5jdGlvbihudW0pe1xuICAgICAgICAgICAgaWYgKG51bSA8PSAwKSB7XG4gICAgICAgICAgICAgICAgbnVtID0gMTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG51bSA+IHRoaXMucGFnZXNDb3VudCkge1xuICAgICAgICAgICAgICAgIG51bSA9IHRoaXMucGFnZXNDb3VudDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IG51bTtcbiAgICAgICAgICAgIHRoaXMuX2RyYXcoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBhZGRGaWx0ZXI6IGZ1bmN0aW9uKGYsIHJlZHJhdyl7XG4gICAgICAgICAgICB2YXIgZnVuYyA9IFV0aWxzLmlzRnVuYyhmKTtcbiAgICAgICAgICAgIGlmIChmdW5jID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmZpbHRlcnMucHVzaChmdW5jKTtcblxuICAgICAgICAgICAgaWYgKHJlZHJhdyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSAxO1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhdygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJzLmxlbmd0aCAtIDE7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVtb3ZlRmlsdGVyOiBmdW5jdGlvbihrZXksIHJlZHJhdyl7XG4gICAgICAgICAgICBVdGlscy5hcnJheURlbGV0ZUJ5S2V5KHRoaXMuZmlsdGVycywga2V5KTtcbiAgICAgICAgICAgIGlmIChyZWRyYXcgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZUZpbHRlcnM6IGZ1bmN0aW9uKHJlZHJhdyl7XG4gICAgICAgICAgICB0aGlzLmZpbHRlcnMgPSBbXTtcbiAgICAgICAgICAgIGlmIChyZWRyYXcgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBnZXRGaWx0ZXJzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVycztcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRGaWx0ZXJJbmRleDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbHRlckluZGV4O1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldEZpbHRlcnNJbmRleGVzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyc0luZGV4ZXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdmFyIGNoYW5nZVNvcnREaXIgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBkaXIgPSBlbGVtZW50LmF0dHIoXCJkYXRhLXNvcnQtZGlyXCIpO1xuICAgICAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZShkaXIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG8uc29ydERpciA9IGRpcjtcbiAgICAgICAgICAgICAgICB0aGF0LnNvcnRpbmcoby5zb3J0Q2xhc3MsIG8uc29ydERpciwgdHJ1ZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgY2hhbmdlU29ydENsYXNzID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZWxlbWVudC5hdHRyKFwiZGF0YS1zb3J0LXNvdXJjZVwiKTtcbiAgICAgICAgICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUodGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBvLnNvcnRDbGFzcyA9IHRhcmdldDtcbiAgICAgICAgICAgICAgICB0aGF0LnNvcnRpbmcoby5zb3J0Q2xhc3MsIG8uc29ydERpciwgdHJ1ZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgY2hhbmdlRmlsdGVyU3RyaW5nID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyID0gZWxlbWVudC5hdHRyKFwiZGF0YS1maWx0ZXItc3RyaW5nXCIpO1xuICAgICAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZShmaWx0ZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG8uZmlsdGVyU3RyaW5nID0gZmlsdGVyO1xuICAgICAgICAgICAgICAgIHRoYXQuZmlsdGVyKG8uZmlsdGVyU3RyaW5nKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHN3aXRjaCAoYXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLXNvcnQtZGlyXCI6IGNoYW5nZVNvcnREaXIoKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtc29ydC1zb3VyY2VcIjogY2hhbmdlU29ydENsYXNzKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLWZpbHRlci1zdHJpbmdcIjogY2hhbmdlRmlsdGVyU3RyaW5nKCk7IGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBjb21wb25lbnQgPSBlbGVtZW50LnBhcmVudCgpO1xuICAgICAgICAgICAgdmFyIHNlYXJjaCA9IGNvbXBvbmVudC5maW5kKFwiLmxpc3Qtc2VhcmNoLWJsb2NrIGlucHV0XCIpO1xuICAgICAgICAgICAgdmFyIGN1c3RvbVNlYXJjaDtcblxuICAgICAgICAgICAgc2VhcmNoLm9mZihNZXRyby5ldmVudHMuaW5wdXRjaGFuZ2UpO1xuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUodGhpcy53cmFwcGVyU2VhcmNoKSkge1xuICAgICAgICAgICAgICAgIGN1c3RvbVNlYXJjaCA9IHRoaXMud3JhcHBlclNlYXJjaC5maW5kKFwiaW5wdXRcIik7XG4gICAgICAgICAgICAgICAgaWYgKGN1c3RvbVNlYXJjaC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbVNlYXJjaC5vZmYoTWV0cm8uZXZlbnRzLmlucHV0Y2hhbmdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbXBvbmVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5wYWdpbmF0aW9uIC5wYWdlLWxpbmtcIik7XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKHRoaXMud3JhcHBlclBhZ2luYXRpb24pKSB7XG4gICAgICAgICAgICAgICAgdGhpcy53cmFwcGVyUGFnaW5hdGlvbi5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5wYWdpbmF0aW9uIC5wYWdlLWxpbmtcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgTGlzdFZpZXdEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBsaXN0dmlld0RlZmVycmVkOiAwLFxuICAgICAgICBzZWxlY3RhYmxlOiBmYWxzZSxcbiAgICAgICAgY2hlY2tTdHlsZTogMSxcbiAgICAgICAgZHVyYXRpb246IDEwMCxcbiAgICAgICAgdmlldzogTWV0cm8ubGlzdFZpZXcuTElTVCxcbiAgICAgICAgc2VsZWN0Q3VycmVudDogdHJ1ZSxcbiAgICAgICAgc3RydWN0dXJlOiB7fSxcbiAgICAgICAgb25Ob2RlSW5zZXJ0OiBNZXRyby5ub29wLFxuICAgICAgICBvbk5vZGVEZWxldGU6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uTm9kZUNsZWFuOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNvbGxhcHNlTm9kZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25FeHBhbmROb2RlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkdyb3VwTm9kZUNsaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvbk5vZGVDbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Ob2RlRGJsY2xpY2s6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uTGlzdFZpZXdDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8ubGlzdFZpZXdTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIExpc3RWaWV3RGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBMaXN0Vmlld0RlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvTGlzdFZpZXdTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLmxpc3RWaWV3U2V0dXAod2luZG93W1wibWV0cm9MaXN0Vmlld1NldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ2xpc3R2aWV3Jywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIExpc3RWaWV3RGVmYXVsdENvbmZpZyk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlVmlldygpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlRXZlbnRzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImxpc3R2aWV3LWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUljb246IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgdmFyIGljb24sIHNyYztcblxuICAgICAgICAgICAgc3JjID0gVXRpbHMuaXNUYWcoZGF0YSkgPyAkKGRhdGEpIDogJChcIjxpbWc+XCIpLmF0dHIoXCJzcmNcIiwgZGF0YSk7XG4gICAgICAgICAgICBpY29uID0gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcImljb25cIik7XG4gICAgICAgICAgICBpY29uLmh0bWwoc3JjLm91dGVySFRNTCgpKTtcblxuICAgICAgICAgICAgcmV0dXJuIGljb247XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUNhcHRpb246IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgcmV0dXJuICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImNhcHRpb25cIikuaHRtbChkYXRhKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlQ29udGVudDogZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICByZXR1cm4gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY29udGVudFwiKS5odG1sKGRhdGEpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVUb2dnbGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcIm5vZGUtdG9nZ2xlXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVOb2RlOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBub2RlO1xuXG4gICAgICAgICAgICBub2RlID0gJChcIjxsaT5cIik7XG5cbiAgICAgICAgICAgIGlmIChkYXRhLmNhcHRpb24gIT09IHVuZGVmaW5lZCB8fCBkYXRhLmNvbnRlbnQgIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImRhdGFcIik7XG4gICAgICAgICAgICAgICAgbm9kZS5wcmVwZW5kKGQpO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLmNhcHRpb24gIT09IHVuZGVmaW5lZCkgZC5hcHBlbmQodGhhdC5fY3JlYXRlQ2FwdGlvbihkYXRhLmNhcHRpb24pKTtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5jb250ZW50ICE9PSB1bmRlZmluZWQpIGQuYXBwZW5kKHRoYXQuX2NyZWF0ZUNvbnRlbnQoZGF0YS5jb250ZW50KSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkYXRhLmljb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIG5vZGUucHJlcGVuZCh0aGlzLl9jcmVhdGVJY29uKGRhdGEuaWNvbikpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoVXRpbHMub2JqZWN0TGVuZ3RoKG8uc3RydWN0dXJlKSA+IDApICQuZWFjaChvLnN0cnVjdHVyZSwgZnVuY3Rpb24oa2V5LCB2YWwpe1xuICAgICAgICAgICAgICAgIGlmIChkYXRhW2tleV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJub2RlLWRhdGEgaXRlbS1kYXRhLVwiK2tleSkuYWRkQ2xhc3MoZGF0YVt2YWxdKS5odG1sKGRhdGFba2V5XSkuYXBwZW5kVG8obm9kZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBub2RlO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVWaWV3OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIG5vZGVzID0gZWxlbWVudC5maW5kKFwibGlcIik7XG4gICAgICAgICAgICB2YXIgc3RydWN0X2xlbmd0aCA9IFV0aWxzLm9iamVjdExlbmd0aChvLnN0cnVjdHVyZSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJsaXN0dmlld1wiKTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcInVsXCIpLmFkZENsYXNzKFwibGlzdHZpZXdcIik7XG5cbiAgICAgICAgICAgICQuZWFjaChub2RlcywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgbm9kZSA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhKFwiY2FwdGlvblwiKSAhPT0gdW5kZWZpbmVkIHx8IG5vZGUuZGF0YShcImNvbnRlbnRcIikgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImRhdGFcIik7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUucHJlcGVuZChkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YShcImNhcHRpb25cIikgIT09IHVuZGVmaW5lZCkgZGF0YS5hcHBlbmQodGhhdC5fY3JlYXRlQ2FwdGlvbihub2RlLmRhdGEoXCJjYXB0aW9uXCIpKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGEoXCJjb250ZW50XCIpICE9PSB1bmRlZmluZWQpIGRhdGEuYXBwZW5kKHRoYXQuX2NyZWF0ZUNvbnRlbnQobm9kZS5kYXRhKFwiY29udGVudFwiKSkpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGEoJ2ljb24nKSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUucHJlcGVuZCh0aGF0Ll9jcmVhdGVJY29uKG5vZGUuZGF0YSgnaWNvbicpKSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4oXCJ1bFwiKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUuYWRkQ2xhc3MoXCJub2RlLWdyb3VwXCIpO1xuICAgICAgICAgICAgICAgICAgICBub2RlLmFwcGVuZCh0aGF0Ll9jcmVhdGVUb2dnbGUoKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGEoXCJjb2xsYXBzZWRcIikgIT09IHRydWUpIG5vZGUuYWRkQ2xhc3MoXCJleHBhbmRlZFwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBub2RlLmFkZENsYXNzKFwibm9kZVwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobm9kZS5oYXNDbGFzcyhcIm5vZGVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNiID0gJChcIjxpbnB1dCB0eXBlPSdjaGVja2JveCcgZGF0YS1yb2xlPSdjaGVja2JveCcgZGF0YS1zdHlsZT0nXCIrby5jaGVja1N0eWxlK1wiJz5cIik7XG4gICAgICAgICAgICAgICAgICAgIGNiLmRhdGEoXCJub2RlXCIsIG5vZGUpO1xuICAgICAgICAgICAgICAgICAgICBub2RlLnByZXBlbmQoY2IpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChzdHJ1Y3RfbGVuZ3RoID4gMCkgJC5lYWNoKG8uc3RydWN0dXJlLCBmdW5jdGlvbihrZXkpe1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhKGtleSkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJChcIjxkaXY+XCIpLmFkZENsYXNzKFwibm9kZS1kYXRhIGl0ZW0tZGF0YS1cIitrZXkpLmFkZENsYXNzKG5vZGUuZGF0YShrZXkpKS5odG1sKG5vZGUuZGF0YShrZXkpKS5hcHBlbmRUbyhub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMudG9nZ2xlU2VsZWN0YWJsZSgpO1xuXG4gICAgICAgICAgICB0aGlzLnZpZXcoby52aWV3KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5kYmxjbGljaywgXCIubm9kZVwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBub2RlID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJub2RlLWRibGNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZTogbm9kZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5ub2RlXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIG5vZGUgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5ub2RlXCIpLnJlbW92ZUNsYXNzKFwiY3VycmVudFwiKTtcbiAgICAgICAgICAgICAgICBub2RlLnRvZ2dsZUNsYXNzKFwiY3VycmVudFwiKTtcbiAgICAgICAgICAgICAgICBpZiAoby5zZWxlY3RDdXJyZW50ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5ub2RlXCIpLnJlbW92ZUNsYXNzKFwiY3VycmVudC1zZWxlY3RcIik7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUudG9nZ2xlQ2xhc3MoXCJjdXJyZW50LXNlbGVjdFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwibm9kZS1jbGlja1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGU6IG5vZGVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIubm9kZS10b2dnbGVcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgbm9kZSA9ICQodGhpcykuY2xvc2VzdChcImxpXCIpO1xuICAgICAgICAgICAgICAgIHRoYXQudG9nZ2xlTm9kZShub2RlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIubm9kZS1ncm91cCA+IC5kYXRhID4gLmNhcHRpb25cIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgbm9kZSA9ICQodGhpcykuY2xvc2VzdChcImxpXCIpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5ub2RlLWdyb3VwXCIpLnJlbW92ZUNsYXNzKFwiY3VycmVudC1ncm91cFwiKTtcbiAgICAgICAgICAgICAgICBub2RlLmFkZENsYXNzKFwiY3VycmVudC1ncm91cFwiKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImdyb3VwLW5vZGUtY2xpY2tcIiwge1xuICAgICAgICAgICAgICAgICAgICBub2RlOiBub2RlXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5kYmxjbGljaywgXCIubm9kZS1ncm91cCA+IC5kYXRhID4gLmNhcHRpb25cIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgbm9kZSA9ICQodGhpcykuY2xvc2VzdChcImxpXCIpO1xuICAgICAgICAgICAgICAgIHRoYXQudG9nZ2xlTm9kZShub2RlKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcIm5vZGUtZGJsLWNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZTogbm9kZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdmlldzogZnVuY3Rpb24odil7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgaWYgKHYgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvLnZpZXc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG8udmlldyA9IHY7XG5cbiAgICAgICAgICAgICQuZWFjaChNZXRyby5saXN0VmlldywgZnVuY3Rpb24oaSwgdil7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcyhcInZpZXctXCIrdik7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKFwidWxcIikucmVtb3ZlQ2xhc3MoXCJ2aWV3LVwiK3YpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJ2aWV3LVwiICsgby52aWV3KTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcInVsXCIpLmFkZENsYXNzKFwidmlldy1cIiArIG8udmlldyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlTm9kZTogZnVuY3Rpb24obm9kZSl7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBmdW5jO1xuXG4gICAgICAgICAgICBub2RlPSQobm9kZSk7XG5cbiAgICAgICAgICAgIGlmICghbm9kZS5oYXNDbGFzcyhcIm5vZGUtZ3JvdXBcIikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBub2RlLnRvZ2dsZUNsYXNzKFwiZXhwYW5kZWRcIik7XG5cbiAgICAgICAgICAgIGZ1bmMgPSBub2RlLmhhc0NsYXNzKFwiZXhwYW5kZWRcIikgIT09IHRydWUgPyBcInNsaWRlVXBcIiA6IFwic2xpZGVEb3duXCI7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImNvbGxhcHNlLW5vZGVcIiwge1xuICAgICAgICAgICAgICAgIG5vZGU6IG5vZGVcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBub2RlLmNoaWxkcmVuKFwidWxcIilbZnVuY10oby5kdXJhdGlvbik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlU2VsZWN0YWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGZ1bmMgPSBvLnNlbGVjdGFibGUgPT09IHRydWUgPyBcImFkZENsYXNzXCIgOiBcInJlbW92ZUNsYXNzXCI7XG4gICAgICAgICAgICBlbGVtZW50W2Z1bmNdKFwic2VsZWN0YWJsZVwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcInVsXCIpW2Z1bmNdKFwic2VsZWN0YWJsZVwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBhZGQ6IGZ1bmN0aW9uKG5vZGUsIGRhdGEpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0O1xuICAgICAgICAgICAgdmFyIG5ld19ub2RlO1xuICAgICAgICAgICAgdmFyIHRvZ2dsZTtcblxuICAgICAgICAgICAgaWYgKG5vZGUgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSBlbGVtZW50O1xuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIG5vZGU9JChub2RlKTtcblxuICAgICAgICAgICAgICAgIGlmICghbm9kZS5oYXNDbGFzcyhcIm5vZGUtZ3JvdXBcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0YXJnZXQgPSBub2RlLmNoaWxkcmVuKFwidWxcIik7XG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gJChcIjx1bD5cIikuYWRkQ2xhc3MoXCJsaXN0dmlld1wiKS5hZGRDbGFzcyhcInZpZXctXCIrby52aWV3KS5hcHBlbmRUbyhub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlID0gdGhpcy5fY3JlYXRlVG9nZ2xlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRvZ2dsZS5hcHBlbmRUbyhub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5hZGRDbGFzcyhcImV4cGFuZGVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbmV3X25vZGUgPSB0aGlzLl9jcmVhdGVOb2RlKGRhdGEpO1xuXG4gICAgICAgICAgICBuZXdfbm9kZS5hZGRDbGFzcyhcIm5vZGVcIikuYXBwZW5kVG8odGFyZ2V0KTtcblxuICAgICAgICAgICAgdmFyIGNiID0gJChcIjxpbnB1dCB0eXBlPSdjaGVja2JveCc+XCIpO1xuICAgICAgICAgICAgY2IuZGF0YShcIm5vZGVcIiwgbmV3X25vZGUpO1xuICAgICAgICAgICAgbmV3X25vZGUucHJlcGVuZChjYik7XG4gICAgICAgICAgICBNZXRyby5tYWtlUGx1Z2luKGNiLCBcImNoZWNrYm94XCIsIHt9KTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwibm9kZS1pbnNlcnRcIiwge1xuICAgICAgICAgICAgICAgIG5ld05vZGU6IG5ld19ub2RlLFxuICAgICAgICAgICAgICAgIHBhcmVudE5vZGU6IG5vZGUsXG4gICAgICAgICAgICAgICAgbGlzdDogdGFyZ2V0XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIG5ld19ub2RlO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFkZEdyb3VwOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIG5vZGU7XG5cbiAgICAgICAgICAgIGRlbGV0ZSBkYXRhWydpY29uJ107XG5cbiAgICAgICAgICAgIG5vZGUgPSB0aGlzLl9jcmVhdGVOb2RlKGRhdGEpO1xuICAgICAgICAgICAgbm9kZS5hZGRDbGFzcyhcIm5vZGUtZ3JvdXBcIikuYXBwZW5kVG8oZWxlbWVudCk7XG4gICAgICAgICAgICBub2RlLmFwcGVuZCh0aGlzLl9jcmVhdGVUb2dnbGUoKSk7XG4gICAgICAgICAgICBub2RlLmFkZENsYXNzKFwiZXhwYW5kZWRcIik7XG4gICAgICAgICAgICBub2RlLmFwcGVuZCgkKFwiPHVsPlwiKS5hZGRDbGFzcyhcImxpc3R2aWV3XCIpLmFkZENsYXNzKFwidmlldy1cIitvLnZpZXcpKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwibm9kZS1pbnNlcnRcIiwge1xuICAgICAgICAgICAgICAgIG5ld05vZGU6IG5vZGUsXG4gICAgICAgICAgICAgICAgcGFyZW50Tm9kZTogbnVsbCxcbiAgICAgICAgICAgICAgICBsaXN0OiBlbGVtZW50XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICByZXR1cm4gbm9kZTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbnNlcnRCZWZvcmU6IGZ1bmN0aW9uKG5vZGUsIGRhdGEpe1xuICAgICAgICAgICAgdmFyIG5ld19ub2RlLCBwYXJlbnRfbm9kZSwgbGlzdDtcblxuICAgICAgICAgICAgbm9kZT0kKG5vZGUpO1xuXG4gICAgICAgICAgICBpZiAoIW5vZGUubGVuZ3RoKSB7cmV0dXJuO31cblxuICAgICAgICAgICAgbmV3X25vZGUgPSB0aGlzLl9jcmVhdGVOb2RlKGRhdGEpO1xuICAgICAgICAgICAgbmV3X25vZGUuYWRkQ2xhc3MoXCJub2RlXCIpLmluc2VydEJlZm9yZShub2RlKTtcbiAgICAgICAgICAgIHBhcmVudF9ub2RlID0gbmV3X25vZGUuY2xvc2VzdChcIi5ub2RlXCIpO1xuICAgICAgICAgICAgbGlzdCA9IG5ld19ub2RlLmNsb3Nlc3QoXCJ1bFwiKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwibm9kZS1pbnNlcnRcIiwge1xuICAgICAgICAgICAgICAgIG5ld05vZGU6IG5ld19ub2RlLFxuICAgICAgICAgICAgICAgIHBhcmVudE5vZGU6IHBhcmVudF9ub2RlLFxuICAgICAgICAgICAgICAgIGxpc3Q6IGxpc3RcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gbmV3X25vZGU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5zZXJ0QWZ0ZXI6IGZ1bmN0aW9uKG5vZGUsIGRhdGEpe1xuICAgICAgICAgICAgdmFyIG5ld19ub2RlLCBwYXJlbnRfbm9kZSwgbGlzdDtcblxuICAgICAgICAgICAgbm9kZT0kKG5vZGUpO1xuXG4gICAgICAgICAgICBpZiAoIW5vZGUubGVuZ3RoKSB7cmV0dXJuO31cblxuICAgICAgICAgICAgbmV3X25vZGUgPSB0aGlzLl9jcmVhdGVOb2RlKGRhdGEpO1xuICAgICAgICAgICAgbmV3X25vZGUuYWRkQ2xhc3MoXCJub2RlXCIpLmluc2VydEFmdGVyKG5vZGUpO1xuICAgICAgICAgICAgcGFyZW50X25vZGUgPSBuZXdfbm9kZS5jbG9zZXN0KFwiLm5vZGVcIik7XG4gICAgICAgICAgICBsaXN0ID0gbmV3X25vZGUuY2xvc2VzdChcInVsXCIpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJub2RlLWluc2VydFwiLCB7XG4gICAgICAgICAgICAgICAgbmV3Tm9kZTogbmV3X25vZGUsXG4gICAgICAgICAgICAgICAgcGFyZW50Tm9kZTogcGFyZW50X25vZGUsXG4gICAgICAgICAgICAgICAgbGlzdDogbGlzdFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBuZXdfbm9kZTtcbiAgICAgICAgfSxcblxuICAgICAgICBkZWw6IGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIG5vZGU9JChub2RlKTtcblxuICAgICAgICAgICAgaWYgKCFub2RlLmxlbmd0aCkge3JldHVybjt9XG5cbiAgICAgICAgICAgIHZhciBwYXJlbnRfbGlzdCA9IG5vZGUuY2xvc2VzdChcInVsXCIpO1xuICAgICAgICAgICAgdmFyIHBhcmVudF9ub2RlID0gcGFyZW50X2xpc3QuY2xvc2VzdChcImxpXCIpO1xuICAgICAgICAgICAgbm9kZS5yZW1vdmUoKTtcbiAgICAgICAgICAgIGlmIChwYXJlbnRfbGlzdC5jaGlsZHJlbigpLmxlbmd0aCA9PT0gMCAmJiAhcGFyZW50X2xpc3QuaXMoZWxlbWVudCkpIHtcbiAgICAgICAgICAgICAgICBwYXJlbnRfbGlzdC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBwYXJlbnRfbm9kZS5yZW1vdmVDbGFzcyhcImV4cGFuZGVkXCIpO1xuICAgICAgICAgICAgICAgIHBhcmVudF9ub2RlLmNoaWxkcmVuKFwiLm5vZGUtdG9nZ2xlXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJub2RlLWRlbGV0ZVwiLCB7XG4gICAgICAgICAgICAgICAgbm9kZTogbm9kZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xlYW46IGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICAgICAgbm9kZT0kKG5vZGUpO1xuXG4gICAgICAgICAgICBpZiAoIW5vZGUubGVuZ3RoKSB7cmV0dXJuO31cblxuICAgICAgICAgICAgbm9kZS5jaGlsZHJlbihcInVsXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgbm9kZS5yZW1vdmVDbGFzcyhcImV4cGFuZGVkXCIpO1xuICAgICAgICAgICAgbm9kZS5jaGlsZHJlbihcIi5ub2RlLXRvZ2dsZVwiKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwibm9kZS1jbGVhblwiLCB7XG4gICAgICAgICAgICAgICAgbm9kZTogbm9kZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0U2VsZWN0ZWQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBub2RlcyA9IFtdO1xuXG4gICAgICAgICAgICAkLmVhY2goZWxlbWVudC5maW5kKFwiOmNoZWNrZWRcIiksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGNoZWNrID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICBub2Rlcy5wdXNoKGNoZWNrLmNsb3Nlc3QoXCIubm9kZVwiKVswXSlcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gbm9kZXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xlYXJTZWxlY3RlZDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5maW5kKFwiOmNoZWNrZWRcIikucHJvcChcImNoZWNrZWRcIiwgZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnRyaWdnZXIoJ2NoYW5nZScpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNlbGVjdEFsbDogZnVuY3Rpb24obW9kZSl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZmluZChcIi5ub2RlID4gLmNoZWNrYm94IGlucHV0XCIpLnByb3AoXCJjaGVja2VkXCIsIG1vZGUgIT09IGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC50cmlnZ2VyKCdjaGFuZ2UnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZWxlY3RCeUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSwgYXR0cmlidXRlVmFsdWUsIHNlbGVjdCkge1xuICAgICAgICAgICAgaWYgKHNlbGVjdCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBzZWxlY3QgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQoJ2xpWycgKyBhdHRyaWJ1dGVOYW1lICsgJz1cIicgKyBhdHRyaWJ1dGVWYWx1ZSArICdcIl0nICsgJyA+IC5jaGVja2JveCBpbnB1dCcpLnByb3AoXCJjaGVja2VkXCIsIHNlbGVjdCk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQudHJpZ2dlcignY2hhbmdlJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdmFyIGNoYW5nZVZpZXcgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBuZXdfdmlldyA9IFwidmlldy1cIitlbGVtZW50LmF0dHIoXCJkYXRhLXZpZXdcIik7XG4gICAgICAgICAgICAgICAgdGhhdC52aWV3KG5ld192aWV3KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBjaGFuZ2VTZWxlY3RhYmxlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBvLnNlbGVjdGFibGUgPSBKU09OLnBhcnNlKGVsZW1lbnQuYXR0cihcImRhdGEtc2VsZWN0YWJsZVwiKSkgPT09IHRydWU7XG4gICAgICAgICAgICAgICAgdGhhdC50b2dnbGVTZWxlY3RhYmxlKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS12aWV3XCI6IGNoYW5nZVZpZXcoKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtc2VsZWN0YWJsZVwiOiBjaGFuZ2VTZWxlY3RhYmxlKCk7IGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5ub2RlXCIpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5ub2RlLXRvZ2dsZVwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIubm9kZS1ncm91cCA+IC5kYXRhID4gLmNhcHRpb25cIik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuZGJsY2xpY2ssIFwiLm5vZGUtZ3JvdXAgPiAuZGF0YSA+IC5jYXB0aW9uXCIpO1xuXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgTWFycXVlZURlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGl0ZW1zOiBudWxsLFxuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwiI2ZmZlwiLFxuICAgICAgICBjb2xvcjogXCIjMDAwXCIsXG4gICAgICAgIGJvcmRlclNpemU6IDAsXG4gICAgICAgIGJvcmRlckNvbG9yOiBcInRyYW5zcGFyZW50XCIsXG4gICAgICAgIGxvb3A6IHRydWUsXG4gICAgICAgIGhlaWdodDogXCJhdXRvXCIsXG4gICAgICAgIHdpZHRoOiBcImF1dG9cIixcbiAgICAgICAgZHVyYXRpb246IDEwMDAwLFxuICAgICAgICBkaXJlY3Rpb246IFwibGVmdFwiLFxuICAgICAgICBlYXNlOiBcImxpbmVhclwiLFxuICAgICAgICBtb2RlOiBcImRlZmF1bHRcIiwgLy8gZGVmYXVsdCB8fCBhY2NlbnRcbiAgICAgICAgYWNjZW50UGF1c2U6IDIwMDAsXG4gICAgICAgIGZpcnN0UGF1c2U6IDEwMDAsXG4gICAgICAgIHN0b3BPbkhvdmVyOiBmYWxzZSxcblxuICAgICAgICBjbHNNYXJxdWVlOiBcIlwiLFxuICAgICAgICBjbHNNYXJxdWVlSXRlbTogXCJcIixcblxuICAgICAgICBvbk1hcnF1ZWVJdGVtOiBNZXRyby5ub29wLFxuICAgICAgICBvbk1hcnF1ZWVJdGVtQ29tcGxldGU6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uTWFycXVlZUNvbXBsZXRlOiBNZXRyby5ub29wLFxuICAgICAgICBvbk1hcnF1ZWVDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8ubWFycXVlZVNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgTWFycXVlZURlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgTWFycXVlZURlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvTWFycXVlZVNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8ubWFycXVlZVNldHVwKHdpbmRvd1tcIm1ldHJvTWFycXVlZVNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ21hcnF1ZWUnLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgTWFycXVlZURlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICAvLyBkZWZpbmUgaW5zdGFuY2UgdmFycyBoZXJlXG4gICAgICAgICAgICAgICAgaXRlbXM6IFtdLFxuICAgICAgICAgICAgICAgIHJ1bm5pbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGN1cnJlbnQ6IC0xXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoJ21hcnF1ZWUtY3JlYXRlJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVN0cnVjdHVyZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwibWFycXVlZVwiKS5hZGRDbGFzcyhvLmNsc01hcnF1ZWUpO1xuXG4gICAgICAgICAgICBlbGVtZW50LmNzcyh7XG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBvLmhlaWdodCxcbiAgICAgICAgICAgICAgICB3aWR0aDogby53aWR0aCxcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IE1ldHJvLmNvbG9ycy5pc0NvbG9yKG8uYmFja2dyb3VuZENvbG9yKSA/IG8uYmFja2dyb3VuZENvbG9yIDogTWFycXVlZURlZmF1bHRDb25maWcuYmFja2dyb3VuZENvbG9yLFxuICAgICAgICAgICAgICAgIGNvbG9yOiBNZXRyby5jb2xvcnMuaXNDb2xvcihvLmNvbG9yKSA/IG8uY29sb3IgOiBNYXJxdWVlRGVmYXVsdENvbmZpZy5jb2xvcixcbiAgICAgICAgICAgICAgICBib3JkZXJTdHlsZTogXCJzb2xpZFwiLFxuICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiBvLmJvcmRlclNpemUsXG4gICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IE1ldHJvLmNvbG9ycy5pc0NvbG9yKG8uYm9yZGVyQ29sb3IpID8gby5ib3JkZXJDb2xvciA6IE1hcnF1ZWVEZWZhdWx0Q29uZmlnLmJvcmRlckNvbG9yXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5zZXRJdGVtcyhvLml0ZW1zKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50ID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMuaXRlbXMubGVuZ3RoKSB0aGlzLnN0YXJ0KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0SXRlbXM6IGZ1bmN0aW9uKGl0ZW1zLCByZXBsYWNlKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGRpciA9IG8uZGlyZWN0aW9uLnRvTG93ZXJDYXNlKCksIGg7XG5cbiAgICAgICAgICAgIGl0ZW1zID0gTWV0cm8udXRpbHMuaXNPYmplY3QoaXRlbXMpO1xuXG4gICAgICAgICAgICBpZiAoaXRlbXMgJiYgcmVwbGFjZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xlYXIoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGl0ZW1zICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICQuZWFjaChpdGVtcywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVsID0gJCh0aGlzKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZWwubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICAgICAgZWwuYXBwZW5kVG8oZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kKCAkKFwiPGRpdj5cIikuaHRtbCh0aGlzKSApO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBlbGVtZW50LmNoaWxkcmVuKFwiKlwiKS5hZGRDbGFzcyhcIm1hcnF1ZWVfX2l0ZW1cIikuYWRkQ2xhc3Moby5jbHNNYXJxdWVlSXRlbSkuaXRlbXMoKTtcblxuICAgICAgICAgICAgaWYgKGRpciA9PT0gXCJsZWZ0XCIgfHwgZGlyID09PSBcInJpZ2h0XCIpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMuaXRlbXMpLmFkZENsYXNzKFwibW92ZUxlZnRSaWdodFwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJCh0aGlzLml0ZW1zKS5hZGRDbGFzcyhcIm1vdmVVcERvd25cIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmhlaWdodCA9PT0gXCJhdXRvXCIpIHtcbiAgICAgICAgICAgICAgICBoID0gMDtcbiAgICAgICAgICAgICAgICAkKHRoaXMuaXRlbXMpLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCArJCh0aGlzKS5vdXRlckhlaWdodCh0cnVlKSA+IGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGggPSArJCh0aGlzKS5vdXRlckhlaWdodCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuaGVpZ2h0KGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgfSxcblxuXG4gICAgICAgIHNldEl0ZW06IGZ1bmN0aW9uKGluZGV4LCB2YWx1ZSl7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gJCh0aGlzLml0ZW1zW2luZGV4XSksIGgsIG8gPSB0aGlzLm9wdGlvbnMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGlmICghdGFyZ2V0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGFyZ2V0Lmh0bWwodmFsdWUpXG5cbiAgICAgICAgICAgIGlmIChvLmhlaWdodCA9PT0gXCJhdXRvXCIpIHtcbiAgICAgICAgICAgICAgICBoID0gMDtcbiAgICAgICAgICAgICAgICAkKHRoaXMuaXRlbXMpLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCArJCh0aGlzKS5vdXRlckhlaWdodCh0cnVlKSA+IGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGggPSArJCh0aGlzKS5vdXRlckhlaWdodCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuaGVpZ2h0KGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgfSxcblxuICAgICAgICBhZGRJdGVtOiBmdW5jdGlvbihpdGVtLCBpbmRleCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBpbnMsICRpdGVtID0gJChpdGVtKSwgdHJnO1xuXG4gICAgICAgICAgICBpbnMgPSAkaXRlbS5sZW5ndGggPyAkaXRlbSA6ICQoXCI8ZGl2PlwiKS5odG1sKGl0ZW0pO1xuXG4gICAgICAgICAgICBpZiAoTWV0cm8udXRpbHMuaXNOdWxsKGluZGV4KSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kKGlucyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRyZyA9IHRoaXMuaXRlbXNbaW5kZXhdXG4gICAgICAgICAgICAgICAgaWYgKHRyZykge1xuICAgICAgICAgICAgICAgICAgICBpbnMuaW5zZXJ0QmVmb3JlKHRyZyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hcHBlbmQoaW5zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpc1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmVudGVyLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmIChvLnN0b3BPbkhvdmVyKVxuICAgICAgICAgICAgICAgICAgICAkLnBhdXNlQWxsKHRoYXQuaXRlbXMpO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMubGVhdmUsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKG8uc3RvcE9uSG92ZXIpXG4gICAgICAgICAgICAgICAgICAgICQucmVzdW1lQWxsKHRoYXQuaXRlbXMpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcblxuICAgICAgICBzdGFydDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGNoYWluID0gW10sIGRpciA9IG8uZGlyZWN0aW9uLnRvTG93ZXJDYXNlKCksIG1vZGUgPSBvLm1vZGUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHZhciBtYWdpYyA9IDIwO1xuICAgICAgICAgICAgdmFyIGVhc2UgPSBvLmVhc2UudG9BcnJheShcIixcIik7XG4gICAgICAgICAgICB2YXIgZHVyID0gK28uZHVyYXRpb247XG5cbiAgICAgICAgICAgIGlmIChtb2RlID09PSBcImRlZmF1bHRcIikge1xuICAgICAgICAgICAgICAgICQuZWFjaCh0aGlzLml0ZW1zLCBmdW5jdGlvbiAoaSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZWwgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZHJhdztcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZWwuYXR0cihcImRhdGEtZGlyZWN0aW9uXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXIgPSBlbC5hdHRyKFwiZGF0YS1kaXJlY3Rpb25cIikudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbC5hdHRyKFwiZGF0YS1kdXJhdGlvblwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZHVyID0gK2VsLmF0dHIoXCJkYXRhLWR1cmF0aW9uXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKFtcImxlZnRcIiwgXCJyaWdodFwiXS5pbmRleE9mKGRpcikgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZHJhdyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBkaXIgPT09IFwibGVmdFwiID8gW2VsZW1lbnQud2lkdGgoKSwgLSQodGhpcykud2lkdGgoKSAtIG1hZ2ljXSA6IFstJCh0aGlzKS53aWR0aCgpIC0gbWFnaWMsIGVsZW1lbnQud2lkdGgoKV1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXcgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBkaXIgPT09IFwidXBcIiA/IFtlbGVtZW50LmhlaWdodCgpLCAtJCh0aGlzKS5oZWlnaHQoKSAtIG1hZ2ljXSA6IFstJCh0aGlzKS5oZWlnaHQoKSAtIG1hZ2ljLCBlbGVtZW50LmhlaWdodCgpXVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY2hhaW4ucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbDogdGhpcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXc6IGRyYXcsXG4gICAgICAgICAgICAgICAgICAgICAgICBkdXI6IGR1cixcbiAgICAgICAgICAgICAgICAgICAgICAgIGVhc2U6IFwibGluZWFyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcjogaSA9PT0gMCA/ICtvLmZpcnN0UGF1c2UgOiAwXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkLmVhY2godGhpcy5pdGVtcywgZnVuY3Rpb24oaSl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbCA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBoYWxmLCBkcmF3MSwgZHJhdzI7XG4gICAgICAgICAgICAgICAgICAgIGR1ciA9IG8uZHVyYXRpb24gLyAyO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbC5hdHRyKFwiZGF0YS1kaXJlY3Rpb25cIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpciA9IGVsLmF0dHIoXCJkYXRhLWRpcmVjdGlvblwiKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGVsLmF0dHIoXCJkYXRhLWR1cmF0aW9uXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkdXIgPSArZWwuYXR0cihcImRhdGEtZHVyYXRpb25cIikgLyAyO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGVsLmF0dHIoXCJkYXRhLWVhc2VcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVhc2UgPSBlbC5hdHRyKFwiZGF0YS1lYXNlXCIpLnRvQXJyYXkoXCIsXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKFtcImxlZnRcIiwgXCJyaWdodFwiXS5pbmRleE9mKGRpcikgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFsZiA9IGVsZW1lbnQud2lkdGgoKSAvIDIgLSAkKHRoaXMpLndpZHRoKCkgLyAyO1xuICAgICAgICAgICAgICAgICAgICAgICAgZHJhdzEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogZGlyID09PSBcImxlZnRcIiA/IFtlbGVtZW50LndpZHRoKCksIGhhbGZdIDogWy0kKHRoaXMpLndpZHRoKCkgLSBtYWdpYywgaGFsZl1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXcyID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGRpciA9PT0gXCJsZWZ0XCIgPyBbaGFsZiwgLSQodGhpcykud2lkdGgoKSAtIG1hZ2ljXSA6IFtoYWxmLCBlbGVtZW50LndpZHRoKCkgKyBtYWdpY11cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbGYgPSBlbGVtZW50LmhlaWdodCgpIC8gMiAtICQodGhpcykuaGVpZ2h0KCkgLyAyO1xuICAgICAgICAgICAgICAgICAgICAgICAgZHJhdzEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBkaXIgPT09IFwidXBcIiA/IFtlbGVtZW50LmhlaWdodCgpLCBoYWxmXSA6IFstJCh0aGlzKS5oZWlnaHQoKSAtIG1hZ2ljLCBoYWxmXVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZHJhdzIgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBkaXIgPT09IFwidXBcIiA/IFtoYWxmLCAtJCh0aGlzKS5oZWlnaHQoKSAtIG1hZ2ljXSA6IFtoYWxmLCBlbGVtZW50LmhlaWdodCgpICsgbWFnaWNdXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjaGFpbi5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsOiB0aGlzLFxuICAgICAgICAgICAgICAgICAgICAgICAgZHJhdzogZHJhdzEsXG4gICAgICAgICAgICAgICAgICAgICAgICBkdXI6IGR1cixcbiAgICAgICAgICAgICAgICAgICAgICAgIGVhc2U6IGVhc2VbMF0gfHwgXCJsaW5lYXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyOiBpID09PSAwID8gK28uZmlyc3RQYXVzZSA6IDBcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGNoYWluLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgZWw6IHRoaXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBkcmF3OiBkcmF3MixcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cjogZHVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWFzZTogZWFzZVsxXSA/IGVhc2VbMV0gOiBlYXNlWzBdID8gZWFzZVswXSA6IFwibGluZWFyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcjogK28uYWNjZW50UGF1c2VcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMucnVubmluZyA9IHRydWU7XG5cbiAgICAgICAgICAgICQuY2hhaW4oY2hhaW4sIHtcbiAgICAgICAgICAgICAgICBsb29wOiBvLmxvb3AsXG4gICAgICAgICAgICAgICAgb25DaGFpbkl0ZW06IE1ldHJvLnV0aWxzLmlzRnVuYyhvLm9uTWFycXVlZUl0ZW0pLFxuICAgICAgICAgICAgICAgIG9uQ2hhaW5JdGVtQ29tcGxldGU6IE1ldHJvLnV0aWxzLmlzRnVuYyhvLm9uTWFycXVlZUl0ZW1Db21wbGV0ZSksXG4gICAgICAgICAgICAgICAgb25DaGFpbkNvbXBsZXRlOiBNZXRyby51dGlscy5pc0Z1bmMoby5vbk1hcnF1ZWVDb21wbGV0ZSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgfSxcblxuICAgICAgICBzdG9wOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAkLnN0b3BBbGwodGhpcy5pdGVtcyk7XG4gICAgICAgICAgICByZXR1cm4gdGhpc1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcblxyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBNYXN0ZXJEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBtYXN0ZXJEZWZlcnJlZDogMCxcbiAgICAgICAgZWZmZWN0OiBcInNsaWRlXCIsIC8vIHNsaWRlLCBmYWRlLCBzd2l0Y2gsIHNsb3dkb3duLCBjdXN0b21cbiAgICAgICAgZWZmZWN0RnVuYzogXCJsaW5lYXJcIixcbiAgICAgICAgZHVyYXRpb246IE1FVFJPX0FOSU1BVElPTl9EVVJBVElPTixcblxuICAgICAgICBjb250cm9sUHJldjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLWxlZnQtYXJyb3cnPjwvc3Bhbj5cIixcbiAgICAgICAgY29udHJvbE5leHQ6IFwiPHNwYW4gY2xhc3M9J2RlZmF1bHQtaWNvbi1yaWdodC1hcnJvdyc+PC9zcGFuPlwiLFxuICAgICAgICBjb250cm9sVGl0bGU6IFwiTWFzdGVyLCBwYWdlICQxIG9mICQyXCIsXG4gICAgICAgIGJhY2tncm91bmRJbWFnZTogXCJcIixcblxuICAgICAgICBjbHNNYXN0ZXI6IFwiXCIsXG4gICAgICAgIGNsc0NvbnRyb2xzOiBcIlwiLFxuICAgICAgICBjbHNDb250cm9sUHJldjogXCJcIixcbiAgICAgICAgY2xzQ29udHJvbE5leHQ6IFwiXCIsXG4gICAgICAgIGNsc0NvbnRyb2xUaXRsZTogXCJcIixcbiAgICAgICAgY2xzUGFnZXM6IFwiXCIsXG4gICAgICAgIGNsc1BhZ2U6IFwiXCIsXG5cbiAgICAgICAgb25CZWZvcmVQYWdlOiBNZXRyby5ub29wX3RydWUsXG4gICAgICAgIG9uQmVmb3JlTmV4dDogTWV0cm8ubm9vcF90cnVlLFxuICAgICAgICBvbkJlZm9yZVByZXY6IE1ldHJvLm5vb3BfdHJ1ZSxcbiAgICAgICAgb25OZXh0UGFnZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25QcmV2UGFnZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25NYXN0ZXJDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8ubWFzdGVyU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBNYXN0ZXJEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIE1hc3RlckRlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvTWFzdGVyU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5tYXN0ZXJTZXR1cCh3aW5kb3dbXCJtZXRyb01hc3RlclNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ21hc3RlcicsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBNYXN0ZXJEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgcGFnZXM6IFtdLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRJbmRleDogMCxcbiAgICAgICAgICAgICAgICBpc0FuaW1hdGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlkOiBVdGlscy5lbGVtZW50SWQoXCJtYXN0ZXJcIilcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJtYXN0ZXJcIikuYWRkQ2xhc3Moby5jbHNNYXN0ZXIpO1xuICAgICAgICAgICAgZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogXCJ1cmwoXCIrby5iYWNrZ3JvdW5kSW1hZ2UrXCIpXCJcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVDb250cm9scygpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlUGFnZXMoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJtYXN0ZXItY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlQ29udHJvbHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjb250cm9sc19wb3NpdGlvbiA9IFsndG9wJywgJ2JvdHRvbSddO1xuICAgICAgICAgICAgdmFyIGNvbnRyb2xzLCB0aXRsZSwgcGFnZXMgPSBlbGVtZW50LmZpbmQoXCIucGFnZVwiKTtcblxuICAgICAgICAgICAgdGl0bGUgPSBTdHJpbmcoby5jb250cm9sVGl0bGUpLnJlcGxhY2UoXCIkMVwiLCBcIjFcIik7XG4gICAgICAgICAgICB0aXRsZSA9IFN0cmluZyh0aXRsZSkucmVwbGFjZShcIiQyXCIsIHBhZ2VzLmxlbmd0aCk7XG5cbiAgICAgICAgICAgICQuZWFjaChjb250cm9sc19wb3NpdGlvbiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBjb250cm9scyA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImNvbnRyb2xzIGNvbnRyb2xzLVwiK3RoaXMpLmFkZENsYXNzKG8uY2xzQ29udHJvbHMpLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJwcmV2XCIpLmFkZENsYXNzKG8uY2xzQ29udHJvbFByZXYpLmh0bWwoby5jb250cm9sUHJldikuYXBwZW5kVG8oY29udHJvbHMpO1xuICAgICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJuZXh0XCIpLmFkZENsYXNzKG8uY2xzQ29udHJvbE5leHQpLmh0bWwoby5jb250cm9sTmV4dCkuYXBwZW5kVG8oY29udHJvbHMpO1xuICAgICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJ0aXRsZVwiKS5hZGRDbGFzcyhvLmNsc0NvbnRyb2xUaXRsZSkuaHRtbCh0aXRsZSkuYXBwZW5kVG8oY29udHJvbHMpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuX2VuYWJsZUNvbnRyb2woXCJwcmV2XCIsIGZhbHNlKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfZW5hYmxlQ29udHJvbDogZnVuY3Rpb24odHlwZSwgc3RhdGUpe1xuICAgICAgICAgICAgdmFyIGNvbnRyb2wgPSB0aGlzLmVsZW1lbnQuZmluZChcIi5jb250cm9scyAuXCIgKyB0eXBlKTtcbiAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGNvbnRyb2wucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29udHJvbC5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9zZXRUaXRsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aXRsZSA9IHRoaXMuZWxlbWVudC5maW5kKFwiLmNvbnRyb2xzIC50aXRsZVwiKTtcblxuICAgICAgICAgICAgdmFyIHRpdGxlX3N0ciA9IHRoaXMub3B0aW9ucy5jb250cm9sVGl0bGUucmVwbGFjZShcIiQxXCIsIHRoaXMuY3VycmVudEluZGV4ICsgMSk7XG4gICAgICAgICAgICB0aXRsZV9zdHIgPSB0aXRsZV9zdHIucmVwbGFjZShcIiQyXCIsIFN0cmluZyh0aGlzLnBhZ2VzLmxlbmd0aCkpO1xuXG4gICAgICAgICAgICB0aXRsZS5odG1sKHRpdGxlX3N0cik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVBhZ2VzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHBhZ2VzID0gZWxlbWVudC5maW5kKFwiLnBhZ2VzXCIpO1xuICAgICAgICAgICAgdmFyIHBhZ2UgPSBlbGVtZW50LmZpbmQoXCIucGFnZVwiKTtcblxuICAgICAgICAgICAgaWYgKHBhZ2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHBhZ2VzID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwicGFnZXNcIikuYXBwZW5kVG8oZWxlbWVudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBhZ2VzLmFkZENsYXNzKG8uY2xzUGFnZXMpO1xuXG4gICAgICAgICAgICAkLmVhY2gocGFnZSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgcCA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgaWYgKHAuZGF0YShcImNvdmVyXCIpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiBcInVybChcIitwLmRhdGEoJ2NvdmVyJykrXCIpXCJcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiBcInVybChcIitvLmJhY2tncm91bmRJbWFnZStcIilcIlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBwLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IFwiMTAwJVwiXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBwLmFkZENsYXNzKG8uY2xzUGFnZSkuaGlkZSgwKTtcblxuICAgICAgICAgICAgICAgIHRoYXQucGFnZXMucHVzaChwKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBwYWdlLmFwcGVuZFRvKHBhZ2VzKTtcblxuICAgICAgICAgICAgdGhpcy5jdXJyZW50SW5kZXggPSAwO1xuICAgICAgICAgICAgaWYgKHRoaXMucGFnZXNbdGhpcy5jdXJyZW50SW5kZXhdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wYWdlc1t0aGlzLmN1cnJlbnRJbmRleF0uZGF0YShcImNvdmVyXCIpICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogXCJ1cmwoXCIrdGhpcy5wYWdlc1t0aGlzLmN1cnJlbnRJbmRleF0uZGF0YSgnY292ZXInKStcIilcIlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5wYWdlc1t0aGlzLmN1cnJlbnRJbmRleF0uY3NzKFwibGVmdFwiLCBcIjBcIikuc2hvdygwKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VzLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoYXQucGFnZXNbMF0ub3V0ZXJIZWlnaHQodHJ1ZSkgKyAyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5jb250cm9scyAucHJldlwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmICh0aGF0LmlzQW5pbWF0ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgIFV0aWxzLmV4ZWMoby5vbkJlZm9yZVByZXYsIFt0aGF0LmN1cnJlbnRJbmRleCwgdGhhdC5wYWdlc1t0aGF0LmN1cnJlbnRJbmRleF0sIGVsZW1lbnRdKSA9PT0gdHJ1ZSAmJlxuICAgICAgICAgICAgICAgICAgICBVdGlscy5leGVjKG8ub25CZWZvcmVQYWdlLCBbXCJwcmV2XCIsIHRoYXQuY3VycmVudEluZGV4LCB0aGF0LnBhZ2VzW3RoYXQuY3VycmVudEluZGV4XSwgZWxlbWVudF0pID09PSB0cnVlXG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQucHJldigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuY29udHJvbHMgLm5leHRcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAodGhhdC5pc0FuaW1hdGUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICBVdGlscy5leGVjKG8ub25CZWZvcmVOZXh0LCBbdGhhdC5jdXJyZW50SW5kZXgsIHRoYXQucGFnZXNbdGhhdC5jdXJyZW50SW5kZXhdLCBlbGVtZW50XSkgPT09IHRydWUgJiZcbiAgICAgICAgICAgICAgICAgICAgVXRpbHMuZXhlYyhvLm9uQmVmb3JlUGFnZSwgW1wibmV4dFwiLCB0aGF0LmN1cnJlbnRJbmRleCwgdGhhdC5wYWdlc1t0aGF0LmN1cnJlbnRJbmRleF0sIGVsZW1lbnRdKSA9PT0gdHJ1ZVxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lm5leHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKE1ldHJvLmV2ZW50cy5yZXNpemUsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLnBhZ2VzXCIpLmhlaWdodCh0aGF0LnBhZ2VzW3RoYXQuY3VycmVudEluZGV4XS5vdXRlckhlaWdodCh0cnVlKSArIDIpO1xuICAgICAgICAgICAgfSwge25zOiB0aGlzLmlkfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3NsaWRlVG9QYWdlOiBmdW5jdGlvbihpbmRleCl7XG4gICAgICAgICAgICB2YXIgY3VycmVudCwgbmV4dCwgdG87XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnBhZ2VzW2luZGV4XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudEluZGV4ID09PSBpbmRleCkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRvID0gaW5kZXggPiB0aGlzLmN1cnJlbnRJbmRleCA/IFwibmV4dFwiIDogXCJwcmV2XCI7XG4gICAgICAgICAgICBjdXJyZW50ID0gdGhpcy5wYWdlc1t0aGlzLmN1cnJlbnRJbmRleF07XG4gICAgICAgICAgICBuZXh0ID0gdGhpcy5wYWdlc1tpbmRleF07XG5cbiAgICAgICAgICAgIHRoaXMuY3VycmVudEluZGV4ID0gaW5kZXg7XG5cbiAgICAgICAgICAgIHRoaXMuX2VmZmVjdChjdXJyZW50LCBuZXh0LCB0byk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3NsaWRlVG86IGZ1bmN0aW9uKHRvKXtcbiAgICAgICAgICAgIHZhciBjdXJyZW50LCBuZXh0LCBmb3J3YXJkID0gdG8udG9Mb3dlckNhc2UoKSA9PT0gJ25leHQnO1xuXG4gICAgICAgICAgICBjdXJyZW50ID0gdGhpcy5wYWdlc1t0aGlzLmN1cnJlbnRJbmRleF07XG5cbiAgICAgICAgICAgIGlmIChmb3J3YXJkICkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRJbmRleCArIDEgPj0gdGhpcy5wYWdlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50SW5kZXgrKztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudEluZGV4IC0gMSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50SW5kZXgtLTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbmV4dCA9IHRoaXMucGFnZXNbdGhpcy5jdXJyZW50SW5kZXhdO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoZm9yd2FyZCA/IFwibmV4dC1wYWdlXCIgOiBcInByZXYtcGFnZVwiLCB7XG4gICAgICAgICAgICAgICAgY3VycmVudDogY3VycmVudCxcbiAgICAgICAgICAgICAgICBuZXh0OiBuZXh0LFxuICAgICAgICAgICAgICAgIGZvcndhcmQ6IGZvcndhcmRcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLl9lZmZlY3QoY3VycmVudCwgbmV4dCwgdG8pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9lZmZlY3Q6IGZ1bmN0aW9uKGN1cnJlbnQsIG5leHQsIHRvKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBvdXQgPSBlbGVtZW50LndpZHRoKCk7XG4gICAgICAgICAgICB2YXIgcGFnZXMgPSBlbGVtZW50LmZpbmQoXCIucGFnZXNcIik7XG5cbiAgICAgICAgICAgIHRoaXMuX3NldFRpdGxlKCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRJbmRleCA9PT0gdGhpcy5wYWdlcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlQ29udHJvbChcIm5leHRcIiwgZmFsc2UpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVDb250cm9sKFwibmV4dFwiLCB0cnVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudEluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlQ29udHJvbChcInByZXZcIiwgZmFsc2UpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVDb250cm9sKFwicHJldlwiLCB0cnVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuaXNBbmltYXRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBwYWdlcy5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBuZXh0Lm91dGVySGVpZ2h0KHRydWUpICsgMlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LDApO1xuXG4gICAgICAgICAgICBwYWdlcy5jc3MoXCJvdmVyZmxvd1wiLCBcImhpZGRlblwiKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gZmluaXNoKCl7XG4gICAgICAgICAgICAgICAgaWYgKG5leHQuZGF0YShcImNvdmVyXCIpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiBcInVybChcIituZXh0LmRhdGEoJ2NvdmVyJykrXCIpXCJcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiBcInVybChcIitvLmJhY2tncm91bmRJbWFnZStcIilcIlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcGFnZXMuY3NzKFwib3ZlcmZsb3dcIiwgXCJpbml0aWFsXCIpO1xuICAgICAgICAgICAgICAgIHRoYXQuaXNBbmltYXRlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIF9zbGlkZSgpe1xuICAgICAgICAgICAgICAgIGN1cnJlbnRcbiAgICAgICAgICAgICAgICAgICAgLnN0b3AodHJ1ZSlcbiAgICAgICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IHRvID09PSBcIm5leHRcIiA/IC1vdXQgOiBvdXRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBkdXI6IG8uZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBlYXNlOiBvLmVmZmVjdEZ1bmMsXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkRvbmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudC5oaWRlKDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIG5leHRcbiAgICAgICAgICAgICAgICAgICAgLnN0b3AodHJ1ZSlcbiAgICAgICAgICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiB0byA9PT0gXCJuZXh0XCIgPyBvdXQgOiAtb3V0XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5zaG93KDApXG4gICAgICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZHVyOiBvLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWFzZTogby5lZmZlY3RGdW5jLFxuICAgICAgICAgICAgICAgICAgICAgICAgb25Eb25lOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmlzaCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gX3N3aXRjaCgpe1xuICAgICAgICAgICAgICAgIGN1cnJlbnQuaGlkZSgpO1xuXG4gICAgICAgICAgICAgICAgbmV4dC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgICAgICAgICB9KS5zaG93KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGZpbmlzaCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBfZmFkZSgpe1xuICAgICAgICAgICAgICAgIGN1cnJlbnQuZmFkZU91dChvLmR1cmF0aW9uKTtcblxuICAgICAgICAgICAgICAgIG5leHQuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwLFxuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwXG4gICAgICAgICAgICAgICAgfSkuZmFkZUluKG8uZHVyYXRpb24sIFwibGluZWFyXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGZpbmlzaCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzd2l0Y2ggKG8uZWZmZWN0KSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImZhZGVcIjogX2ZhZGUoKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcInN3aXRjaFwiOiBfc3dpdGNoKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IF9zbGlkZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHRvUGFnZTogZnVuY3Rpb24oaW5kZXgpe1xuICAgICAgICAgICAgdGhpcy5fc2xpZGVUb1BhZ2UoaW5kZXgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG5leHQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLl9zbGlkZVRvKFwibmV4dFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBwcmV2OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5fc2xpZGVUbyhcInByZXZcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlRWZmZWN0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmVmZmVjdCA9IHRoaXMuZWxlbWVudC5hdHRyKFwiZGF0YS1lZmZlY3RcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlRWZmZWN0RnVuYzogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5lZmZlY3RGdW5jID0gdGhpcy5lbGVtZW50LmF0dHIoXCJkYXRhLWVmZmVjdC1mdW5jXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUVmZmVjdER1cmF0aW9uOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmR1cmF0aW9uID0gdGhpcy5lbGVtZW50LmF0dHIoXCJkYXRhLWR1cmF0aW9uXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSl7XG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1lZmZlY3RcIjogdGhpcy5jaGFuZ2VFZmZlY3QoKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtZWZmZWN0LWZ1bmNcIjogdGhpcy5jaGFuZ2VFZmZlY3RGdW5jKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLWR1cmF0aW9uXCI6IHRoaXMuY2hhbmdlRWZmZWN0RHVyYXRpb24oKTsgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmNvbnRyb2xzIC5wcmV2XCIpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5jb250cm9scyAubmV4dFwiKTtcbiAgICAgICAgICAgICQod2luZG93KS5vZmYoTWV0cm8uZXZlbnRzLnJlc2l6ZSx7bnM6IHRoaXMuaWR9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIE1ldHJvLm1kNSA9IGZ1bmN0aW9uIChzdHJpbmcpIHtcbiAgICAgICAgZnVuY3Rpb24gUm90YXRlTGVmdChsVmFsdWUsIGlTaGlmdEJpdHMpIHtcbiAgICAgICAgICAgIHJldHVybiAobFZhbHVlPDxpU2hpZnRCaXRzKSB8IChsVmFsdWU+Pj4oMzItaVNoaWZ0Qml0cykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gQWRkVW5zaWduZWQobFgsbFkpIHtcbiAgICAgICAgICAgIHZhciBsWDQsbFk0LGxYOCxsWTgsbFJlc3VsdDtcbiAgICAgICAgICAgIGxYOCA9IChsWCAmIDB4ODAwMDAwMDApO1xuICAgICAgICAgICAgbFk4ID0gKGxZICYgMHg4MDAwMDAwMCk7XG4gICAgICAgICAgICBsWDQgPSAobFggJiAweDQwMDAwMDAwKTtcbiAgICAgICAgICAgIGxZNCA9IChsWSAmIDB4NDAwMDAwMDApO1xuICAgICAgICAgICAgbFJlc3VsdCA9IChsWCAmIDB4M0ZGRkZGRkYpKyhsWSAmIDB4M0ZGRkZGRkYpO1xuICAgICAgICAgICAgaWYgKGxYNCAmIGxZNCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAobFJlc3VsdCBeIDB4ODAwMDAwMDAgXiBsWDggXiBsWTgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGxYNCB8IGxZNCkge1xuICAgICAgICAgICAgICAgIGlmIChsUmVzdWx0ICYgMHg0MDAwMDAwMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGxSZXN1bHQgXiAweEMwMDAwMDAwIF4gbFg4IF4gbFk4KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGxSZXN1bHQgXiAweDQwMDAwMDAwIF4gbFg4IF4gbFk4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiAobFJlc3VsdCBeIGxYOCBeIGxZOCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBGKHgseSx6KSB7IHJldHVybiAoeCAmIHkpIHwgKCh+eCkgJiB6KTsgfVxuICAgICAgICBmdW5jdGlvbiBHKHgseSx6KSB7IHJldHVybiAoeCAmIHopIHwgKHkgJiAofnopKTsgfVxuICAgICAgICBmdW5jdGlvbiBIKHgseSx6KSB7IHJldHVybiAoeCBeIHkgXiB6KTsgfVxuICAgICAgICBmdW5jdGlvbiBJKHgseSx6KSB7IHJldHVybiAoeSBeICh4IHwgKH56KSkpOyB9XG5cbiAgICAgICAgZnVuY3Rpb24gRkYoYSxiLGMsZCx4LHMsYWMpIHtcbiAgICAgICAgICAgIGEgPSBBZGRVbnNpZ25lZChhLCBBZGRVbnNpZ25lZChBZGRVbnNpZ25lZChGKGIsIGMsIGQpLCB4KSwgYWMpKTtcbiAgICAgICAgICAgIHJldHVybiBBZGRVbnNpZ25lZChSb3RhdGVMZWZ0KGEsIHMpLCBiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIEdHKGEsYixjLGQseCxzLGFjKSB7XG4gICAgICAgICAgICBhID0gQWRkVW5zaWduZWQoYSwgQWRkVW5zaWduZWQoQWRkVW5zaWduZWQoRyhiLCBjLCBkKSwgeCksIGFjKSk7XG4gICAgICAgICAgICByZXR1cm4gQWRkVW5zaWduZWQoUm90YXRlTGVmdChhLCBzKSwgYik7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBISChhLGIsYyxkLHgscyxhYykge1xuICAgICAgICAgICAgYSA9IEFkZFVuc2lnbmVkKGEsIEFkZFVuc2lnbmVkKEFkZFVuc2lnbmVkKEgoYiwgYywgZCksIHgpLCBhYykpO1xuICAgICAgICAgICAgcmV0dXJuIEFkZFVuc2lnbmVkKFJvdGF0ZUxlZnQoYSwgcyksIGIpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gSUkoYSxiLGMsZCx4LHMsYWMpIHtcbiAgICAgICAgICAgIGEgPSBBZGRVbnNpZ25lZChhLCBBZGRVbnNpZ25lZChBZGRVbnNpZ25lZChJKGIsIGMsIGQpLCB4KSwgYWMpKTtcbiAgICAgICAgICAgIHJldHVybiBBZGRVbnNpZ25lZChSb3RhdGVMZWZ0KGEsIHMpLCBiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIENvbnZlcnRUb1dvcmRBcnJheShzdHJpbmcpIHtcbiAgICAgICAgICAgIHZhciBsV29yZENvdW50O1xuICAgICAgICAgICAgdmFyIGxNZXNzYWdlTGVuZ3RoID0gc3RyaW5nLmxlbmd0aDtcbiAgICAgICAgICAgIHZhciBsTnVtYmVyT2ZXb3Jkc190ZW1wMT1sTWVzc2FnZUxlbmd0aCArIDg7XG4gICAgICAgICAgICB2YXIgbE51bWJlck9mV29yZHNfdGVtcDI9KGxOdW1iZXJPZldvcmRzX3RlbXAxLShsTnVtYmVyT2ZXb3Jkc190ZW1wMSAlIDY0KSkvNjQ7XG4gICAgICAgICAgICB2YXIgbE51bWJlck9mV29yZHMgPSAobE51bWJlck9mV29yZHNfdGVtcDIrMSkqMTY7XG4gICAgICAgICAgICB2YXIgbFdvcmRBcnJheT1BcnJheShsTnVtYmVyT2ZXb3Jkcy0xKTtcbiAgICAgICAgICAgIHZhciBsQnl0ZVBvc2l0aW9uID0gMDtcbiAgICAgICAgICAgIHZhciBsQnl0ZUNvdW50ID0gMDtcbiAgICAgICAgICAgIHdoaWxlICggbEJ5dGVDb3VudCA8IGxNZXNzYWdlTGVuZ3RoICkge1xuICAgICAgICAgICAgICAgIGxXb3JkQ291bnQgPSAobEJ5dGVDb3VudC0obEJ5dGVDb3VudCAlIDQpKS80O1xuICAgICAgICAgICAgICAgIGxCeXRlUG9zaXRpb24gPSAobEJ5dGVDb3VudCAlIDQpKjg7XG4gICAgICAgICAgICAgICAgbFdvcmRBcnJheVtsV29yZENvdW50XSA9IChsV29yZEFycmF5W2xXb3JkQ291bnRdIHwgKHN0cmluZy5jaGFyQ29kZUF0KGxCeXRlQ291bnQpPDxsQnl0ZVBvc2l0aW9uKSk7XG4gICAgICAgICAgICAgICAgbEJ5dGVDb3VudCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbFdvcmRDb3VudCA9IChsQnl0ZUNvdW50LShsQnl0ZUNvdW50ICUgNCkpLzQ7XG4gICAgICAgICAgICBsQnl0ZVBvc2l0aW9uID0gKGxCeXRlQ291bnQgJSA0KSo4O1xuICAgICAgICAgICAgbFdvcmRBcnJheVtsV29yZENvdW50XSA9IGxXb3JkQXJyYXlbbFdvcmRDb3VudF0gfCAoMHg4MDw8bEJ5dGVQb3NpdGlvbik7XG4gICAgICAgICAgICBsV29yZEFycmF5W2xOdW1iZXJPZldvcmRzLTJdID0gbE1lc3NhZ2VMZW5ndGg8PDM7XG4gICAgICAgICAgICBsV29yZEFycmF5W2xOdW1iZXJPZldvcmRzLTFdID0gbE1lc3NhZ2VMZW5ndGg+Pj4yOTtcbiAgICAgICAgICAgIHJldHVybiBsV29yZEFycmF5O1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gV29yZFRvSGV4KGxWYWx1ZSkge1xuICAgICAgICAgICAgdmFyIFdvcmRUb0hleFZhbHVlPVwiXCIsV29yZFRvSGV4VmFsdWVfdGVtcD1cIlwiLGxCeXRlLGxDb3VudDtcbiAgICAgICAgICAgIGZvciAobENvdW50ID0gMDtsQ291bnQ8PTM7bENvdW50KyspIHtcbiAgICAgICAgICAgICAgICBsQnl0ZSA9IChsVmFsdWU+Pj4obENvdW50KjgpKSAmIDI1NTtcbiAgICAgICAgICAgICAgICBXb3JkVG9IZXhWYWx1ZV90ZW1wID0gXCIwXCIgKyBsQnl0ZS50b1N0cmluZygxNik7XG4gICAgICAgICAgICAgICAgV29yZFRvSGV4VmFsdWUgPSBXb3JkVG9IZXhWYWx1ZSArIFdvcmRUb0hleFZhbHVlX3RlbXAuc3Vic3RyKFdvcmRUb0hleFZhbHVlX3RlbXAubGVuZ3RoLTIsMik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gV29yZFRvSGV4VmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBVdGY4RW5jb2RlKHN0cmluZykge1xuICAgICAgICAgICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoL1xcclxcbi9nLFwiXFxuXCIpO1xuICAgICAgICAgICAgdmFyIHV0ZnRleHQgPSBcIlwiO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBuID0gMDsgbiA8IHN0cmluZy5sZW5ndGg7IG4rKykge1xuXG4gICAgICAgICAgICAgICAgdmFyIGMgPSBzdHJpbmcuY2hhckNvZGVBdChuKTtcblxuICAgICAgICAgICAgICAgIGlmIChjIDwgMTI4KSB7XG4gICAgICAgICAgICAgICAgICAgIHV0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZigoYyA+IDEyNykgJiYgKGMgPCAyMDQ4KSkge1xuICAgICAgICAgICAgICAgICAgICB1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMgPj4gNikgfCAxOTIpO1xuICAgICAgICAgICAgICAgICAgICB1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMgJiA2MykgfCAxMjgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjID4+IDEyKSB8IDIyNCk7XG4gICAgICAgICAgICAgICAgICAgIHV0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgPj4gNikgJiA2MykgfCAxMjgpO1xuICAgICAgICAgICAgICAgICAgICB1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMgJiA2MykgfCAxMjgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdXRmdGV4dDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciB4PVtdO1xuICAgICAgICB2YXIgayxBQSxCQixDQyxERCxhLGIsYyxkO1xuICAgICAgICB2YXIgUzExPTcsIFMxMj0xMiwgUzEzPTE3LCBTMTQ9MjI7XG4gICAgICAgIHZhciBTMjE9NSwgUzIyPTkgLCBTMjM9MTQsIFMyND0yMDtcbiAgICAgICAgdmFyIFMzMT00LCBTMzI9MTEsIFMzMz0xNiwgUzM0PTIzO1xuICAgICAgICB2YXIgUzQxPTYsIFM0Mj0xMCwgUzQzPTE1LCBTNDQ9MjE7XG5cbiAgICAgICAgc3RyaW5nID0gVXRmOEVuY29kZShzdHJpbmcpO1xuXG4gICAgICAgIHggPSBDb252ZXJ0VG9Xb3JkQXJyYXkoc3RyaW5nKTtcblxuICAgICAgICBhID0gMHg2NzQ1MjMwMTsgYiA9IDB4RUZDREFCODk7IGMgPSAweDk4QkFEQ0ZFOyBkID0gMHgxMDMyNTQ3NjtcblxuICAgICAgICBmb3IgKGs9MDtrPHgubGVuZ3RoO2srPTE2KSB7XG4gICAgICAgICAgICBBQT1hOyBCQj1iOyBDQz1jOyBERD1kO1xuICAgICAgICAgICAgYT1GRihhLGIsYyxkLHhba10sIFMxMSwweEQ3NkFBNDc4KTtcbiAgICAgICAgICAgIGQ9RkYoZCxhLGIsYyx4W2srMV0sIFMxMiwweEU4QzdCNzU2KTtcbiAgICAgICAgICAgIGM9RkYoYyxkLGEsYix4W2srMl0sIFMxMywweDI0MjA3MERCKTtcbiAgICAgICAgICAgIGI9RkYoYixjLGQsYSx4W2srM10sIFMxNCwweEMxQkRDRUVFKTtcbiAgICAgICAgICAgIGE9RkYoYSxiLGMsZCx4W2srNF0sIFMxMSwweEY1N0MwRkFGKTtcbiAgICAgICAgICAgIGQ9RkYoZCxhLGIsYyx4W2srNV0sIFMxMiwweDQ3ODdDNjJBKTtcbiAgICAgICAgICAgIGM9RkYoYyxkLGEsYix4W2srNl0sIFMxMywweEE4MzA0NjEzKTtcbiAgICAgICAgICAgIGI9RkYoYixjLGQsYSx4W2srN10sIFMxNCwweEZENDY5NTAxKTtcbiAgICAgICAgICAgIGE9RkYoYSxiLGMsZCx4W2srOF0sIFMxMSwweDY5ODA5OEQ4KTtcbiAgICAgICAgICAgIGQ9RkYoZCxhLGIsYyx4W2srOV0sIFMxMiwweDhCNDRGN0FGKTtcbiAgICAgICAgICAgIGM9RkYoYyxkLGEsYix4W2srMTBdLFMxMywweEZGRkY1QkIxKTtcbiAgICAgICAgICAgIGI9RkYoYixjLGQsYSx4W2srMTFdLFMxNCwweDg5NUNEN0JFKTtcbiAgICAgICAgICAgIGE9RkYoYSxiLGMsZCx4W2srMTJdLFMxMSwweDZCOTAxMTIyKTtcbiAgICAgICAgICAgIGQ9RkYoZCxhLGIsYyx4W2srMTNdLFMxMiwweEZEOTg3MTkzKTtcbiAgICAgICAgICAgIGM9RkYoYyxkLGEsYix4W2srMTRdLFMxMywweEE2Nzk0MzhFKTtcbiAgICAgICAgICAgIGI9RkYoYixjLGQsYSx4W2srMTVdLFMxNCwweDQ5QjQwODIxKTtcbiAgICAgICAgICAgIGE9R0coYSxiLGMsZCx4W2srMV0sIFMyMSwweEY2MUUyNTYyKTtcbiAgICAgICAgICAgIGQ9R0coZCxhLGIsYyx4W2srNl0sIFMyMiwweEMwNDBCMzQwKTtcbiAgICAgICAgICAgIGM9R0coYyxkLGEsYix4W2srMTFdLFMyMywweDI2NUU1QTUxKTtcbiAgICAgICAgICAgIGI9R0coYixjLGQsYSx4W2tdLCBTMjQsMHhFOUI2QzdBQSk7XG4gICAgICAgICAgICBhPUdHKGEsYixjLGQseFtrKzVdLCBTMjEsMHhENjJGMTA1RCk7XG4gICAgICAgICAgICBkPUdHKGQsYSxiLGMseFtrKzEwXSxTMjIsMHgyNDQxNDUzKTtcbiAgICAgICAgICAgIGM9R0coYyxkLGEsYix4W2srMTVdLFMyMywweEQ4QTFFNjgxKTtcbiAgICAgICAgICAgIGI9R0coYixjLGQsYSx4W2srNF0sIFMyNCwweEU3RDNGQkM4KTtcbiAgICAgICAgICAgIGE9R0coYSxiLGMsZCx4W2srOV0sIFMyMSwweDIxRTFDREU2KTtcbiAgICAgICAgICAgIGQ9R0coZCxhLGIsYyx4W2srMTRdLFMyMiwweEMzMzcwN0Q2KTtcbiAgICAgICAgICAgIGM9R0coYyxkLGEsYix4W2srM10sIFMyMywweEY0RDUwRDg3KTtcbiAgICAgICAgICAgIGI9R0coYixjLGQsYSx4W2srOF0sIFMyNCwweDQ1NUExNEVEKTtcbiAgICAgICAgICAgIGE9R0coYSxiLGMsZCx4W2srMTNdLFMyMSwweEE5RTNFOTA1KTtcbiAgICAgICAgICAgIGQ9R0coZCxhLGIsYyx4W2srMl0sIFMyMiwweEZDRUZBM0Y4KTtcbiAgICAgICAgICAgIGM9R0coYyxkLGEsYix4W2srN10sIFMyMywweDY3NkYwMkQ5KTtcbiAgICAgICAgICAgIGI9R0coYixjLGQsYSx4W2srMTJdLFMyNCwweDhEMkE0QzhBKTtcbiAgICAgICAgICAgIGE9SEgoYSxiLGMsZCx4W2srNV0sIFMzMSwweEZGRkEzOTQyKTtcbiAgICAgICAgICAgIGQ9SEgoZCxhLGIsYyx4W2srOF0sIFMzMiwweDg3NzFGNjgxKTtcbiAgICAgICAgICAgIGM9SEgoYyxkLGEsYix4W2srMTFdLFMzMywweDZEOUQ2MTIyKTtcbiAgICAgICAgICAgIGI9SEgoYixjLGQsYSx4W2srMTRdLFMzNCwweEZERTUzODBDKTtcbiAgICAgICAgICAgIGE9SEgoYSxiLGMsZCx4W2srMV0sIFMzMSwweEE0QkVFQTQ0KTtcbiAgICAgICAgICAgIGQ9SEgoZCxhLGIsYyx4W2srNF0sIFMzMiwweDRCREVDRkE5KTtcbiAgICAgICAgICAgIGM9SEgoYyxkLGEsYix4W2srN10sIFMzMywweEY2QkI0QjYwKTtcbiAgICAgICAgICAgIGI9SEgoYixjLGQsYSx4W2srMTBdLFMzNCwweEJFQkZCQzcwKTtcbiAgICAgICAgICAgIGE9SEgoYSxiLGMsZCx4W2srMTNdLFMzMSwweDI4OUI3RUM2KTtcbiAgICAgICAgICAgIGQ9SEgoZCxhLGIsYyx4W2tdLCBTMzIsMHhFQUExMjdGQSk7XG4gICAgICAgICAgICBjPUhIKGMsZCxhLGIseFtrKzNdLCBTMzMsMHhENEVGMzA4NSk7XG4gICAgICAgICAgICBiPUhIKGIsYyxkLGEseFtrKzZdLCBTMzQsMHg0ODgxRDA1KTtcbiAgICAgICAgICAgIGE9SEgoYSxiLGMsZCx4W2srOV0sIFMzMSwweEQ5RDREMDM5KTtcbiAgICAgICAgICAgIGQ9SEgoZCxhLGIsYyx4W2srMTJdLFMzMiwweEU2REI5OUU1KTtcbiAgICAgICAgICAgIGM9SEgoYyxkLGEsYix4W2srMTVdLFMzMywweDFGQTI3Q0Y4KTtcbiAgICAgICAgICAgIGI9SEgoYixjLGQsYSx4W2srMl0sIFMzNCwweEM0QUM1NjY1KTtcbiAgICAgICAgICAgIGE9SUkoYSxiLGMsZCx4W2tdLCBTNDEsMHhGNDI5MjI0NCk7XG4gICAgICAgICAgICBkPUlJKGQsYSxiLGMseFtrKzddLCBTNDIsMHg0MzJBRkY5Nyk7XG4gICAgICAgICAgICBjPUlJKGMsZCxhLGIseFtrKzE0XSxTNDMsMHhBQjk0MjNBNyk7XG4gICAgICAgICAgICBiPUlJKGIsYyxkLGEseFtrKzVdLCBTNDQsMHhGQzkzQTAzOSk7XG4gICAgICAgICAgICBhPUlJKGEsYixjLGQseFtrKzEyXSxTNDEsMHg2NTVCNTlDMyk7XG4gICAgICAgICAgICBkPUlJKGQsYSxiLGMseFtrKzNdLCBTNDIsMHg4RjBDQ0M5Mik7XG4gICAgICAgICAgICBjPUlJKGMsZCxhLGIseFtrKzEwXSxTNDMsMHhGRkVGRjQ3RCk7XG4gICAgICAgICAgICBiPUlJKGIsYyxkLGEseFtrKzFdLCBTNDQsMHg4NTg0NUREMSk7XG4gICAgICAgICAgICBhPUlJKGEsYixjLGQseFtrKzhdLCBTNDEsMHg2RkE4N0U0Rik7XG4gICAgICAgICAgICBkPUlJKGQsYSxiLGMseFtrKzE1XSxTNDIsMHhGRTJDRTZFMCk7XG4gICAgICAgICAgICBjPUlJKGMsZCxhLGIseFtrKzZdLCBTNDMsMHhBMzAxNDMxNCk7XG4gICAgICAgICAgICBiPUlJKGIsYyxkLGEseFtrKzEzXSxTNDQsMHg0RTA4MTFBMSk7XG4gICAgICAgICAgICBhPUlJKGEsYixjLGQseFtrKzRdLCBTNDEsMHhGNzUzN0U4Mik7XG4gICAgICAgICAgICBkPUlJKGQsYSxiLGMseFtrKzExXSxTNDIsMHhCRDNBRjIzNSk7XG4gICAgICAgICAgICBjPUlJKGMsZCxhLGIseFtrKzJdLCBTNDMsMHgyQUQ3RDJCQik7XG4gICAgICAgICAgICBiPUlJKGIsYyxkLGEseFtrKzldLCBTNDQsMHhFQjg2RDM5MSk7XG4gICAgICAgICAgICBhPUFkZFVuc2lnbmVkKGEsQUEpO1xuICAgICAgICAgICAgYj1BZGRVbnNpZ25lZChiLEJCKTtcbiAgICAgICAgICAgIGM9QWRkVW5zaWduZWQoYyxDQyk7XG4gICAgICAgICAgICBkPUFkZFVuc2lnbmVkKGQsREQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHRlbXAgPSBXb3JkVG9IZXgoYSkrV29yZFRvSGV4KGIpK1dvcmRUb0hleChjKStXb3JkVG9IZXgoZCk7XG5cbiAgICAgICAgcmV0dXJuIHRlbXAudG9Mb3dlckNhc2UoKTtcbiAgICB9O1xuXG4gICAgaWYgKHdpbmRvdy5NRVRST19HTE9CQUxfQ09NTU9OID09PSB0cnVlKSB7XG4gICAgICAgIHdpbmRvdy5tZDUgPSBNZXRyby5tZDU7XG4gICAgfVxufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIE5hdmlnYXRpb25WaWV3RGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgbmF2dmlld0RlZmVycmVkOiAwLFxuICAgICAgICBjb21wYWN0OiBcIm1kXCIsXG4gICAgICAgIGV4cGFuZDogXCJsZ1wiLFxuICAgICAgICB0b2dnbGU6IG51bGwsXG4gICAgICAgIGFjdGl2ZVN0YXRlOiBmYWxzZSxcbiAgICAgICAgb25NZW51SXRlbUNsaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvbk5hdnZpZXdDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8ubmF2Vmlld1NldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgTmF2aWdhdGlvblZpZXdEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIE5hdmlnYXRpb25WaWV3RGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9OYXZWaWV3U2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5uYXZWaWV3U2V0dXAod2luZG93W1wibWV0cm9OYXZWaWV3U2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnbmF2LXZpZXcnLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgTmF2aWdhdGlvblZpZXdEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgcGFuZTogbnVsbCxcbiAgICAgICAgICAgICAgICBjb250ZW50OiBudWxsLFxuICAgICAgICAgICAgICAgIHBhbmVUb2dnbGU6IG51bGwsXG4gICAgICAgICAgICAgICAgaWQ6IFV0aWxzLmVsZW1lbnRJZChcIm5hdnZpZXdcIiksXG4gICAgICAgICAgICAgICAgbWVudVNjcm9sbERpc3RhbmNlOiAwLFxuICAgICAgICAgICAgICAgIG1lbnVTY3JvbGxTdGVwOiAwXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVN0cnVjdHVyZSgpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlRXZlbnRzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcIm5hdnZpZXctY3JlYXRlXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jYWxjTWVudUhlaWdodDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBwYW5lLCBtZW51X2NvbnRhaW5lcjtcbiAgICAgICAgICAgIHZhciBlbGVtZW50c19oZWlnaHQgPSAwO1xuXG4gICAgICAgICAgICBwYW5lID0gZWxlbWVudC5jaGlsZHJlbihcIi5uYXZ2aWV3LXBhbmVcIik7XG4gICAgICAgICAgICBpZiAocGFuZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG1lbnVfY29udGFpbmVyID0gcGFuZS5jaGlsZHJlbihcIi5uYXZ2aWV3LW1lbnUtY29udGFpbmVyXCIpO1xuXG4gICAgICAgICAgICBpZiAobWVudV9jb250YWluZXIubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJC5lYWNoKG1lbnVfY29udGFpbmVyLnByZXZBbGwoKSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBlbGVtZW50c19oZWlnaHQgKz0gJCh0aGlzKS5vdXRlckhlaWdodCh0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkLmVhY2gobWVudV9jb250YWluZXIubmV4dEFsbCgpLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGVsZW1lbnRzX2hlaWdodCArPSAkKHRoaXMpLm91dGVySGVpZ2h0KHRydWUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1lbnVfY29udGFpbmVyLmNzcyh7XG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBcImNhbGMoMTAwJSAtIFwiKyhlbGVtZW50c19oZWlnaHQpK1wicHgpXCJcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLm1lbnVTY3JvbGxTdGVwID0gNDg7XG4gICAgICAgICAgICB0aGlzLm1lbnVTY3JvbGxEaXN0YW5jZSA9IFV0aWxzLm5lYXJlc3QobWVudV9jb250YWluZXJbMF0uc2Nyb2xsSGVpZ2h0IC0gbWVudV9jb250YWluZXIuaGVpZ2h0KCksIDQ4KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfcmVjYWxjOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmICh0aGF0LnBhbmUud2lkdGgoKSA9PT0gNDgpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImpzLWNvbXBhY3RcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcyhcImpzLWNvbXBhY3RcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoYXQuX2NhbGNNZW51SGVpZ2h0KCk7XG4gICAgICAgICAgICB9LCAyMDApO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBwYW5lLCBjb250ZW50LCB0b2dnbGUsIG1lbnUvKiwgbWVudV9jb250YWluZXIsIG1lbnVfaCwgbWVudV9jb250YWluZXJfaCovO1xuXG4gICAgICAgICAgICBlbGVtZW50XG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKFwibmF2dmlld1wiKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhvLmNvbXBhY3QgIT09IGZhbHNlID8gXCJuYXZ2aWV3LWNvbXBhY3QtXCIrby5jb21wYWN0IDogXCJcIilcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3Moby5leHBhbmQgIT09IGZhbHNlID8gXCJuYXZ2aWV3LWV4cGFuZC1cIitvLmV4cGFuZCA6IFwiXCIpO1xuXG4gICAgICAgICAgICBwYW5lID0gZWxlbWVudC5jaGlsZHJlbihcIi5uYXZ2aWV3LXBhbmVcIik7XG4gICAgICAgICAgICBjb250ZW50ID0gZWxlbWVudC5jaGlsZHJlbihcIi5uYXZ2aWV3LWNvbnRlbnRcIik7XG4gICAgICAgICAgICB0b2dnbGUgPSAkKG8udG9nZ2xlKTtcbiAgICAgICAgICAgIG1lbnUgPSBwYW5lLmNoaWxkcmVuKFwiLm5hdnZpZXctbWVudVwiKTtcblxuICAgICAgICAgICAgaWYgKG1lbnUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgbWVudS5wcmV2QWxsKCkucmV2ZXJzZSgpLndyYXBBbGwoJChcIjxkaXY+XCIpLmFkZENsYXNzKFwibmF2dmlldy1jb250YWluZXJcIikpO1xuICAgICAgICAgICAgICAgIG1lbnUud3JhcCgkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJuYXZ2aWV3LW1lbnUtY29udGFpbmVyXCIpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5wYW5lID0gcGFuZS5sZW5ndGggPiAwID8gcGFuZSA6IG51bGw7XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSBjb250ZW50Lmxlbmd0aCA+IDAgPyBjb250ZW50IDogbnVsbDtcbiAgICAgICAgICAgIHRoaXMucGFuZVRvZ2dsZSA9IHRvZ2dsZS5sZW5ndGggPiAwID8gdG9nZ2xlIDogbnVsbDtcblxuICAgICAgICAgICAgdGhpcy5fcmVjYWxjKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBtZW51X2NvbnRhaW5lciA9IGVsZW1lbnQuZmluZChcIi5uYXZ2aWV3LW1lbnUtY29udGFpbmVyXCIpO1xuICAgICAgICAgICAgdmFyIG1lbnUgPSBtZW51X2NvbnRhaW5lci5jaGlsZHJlbihcIi5uYXZ2aWV3LW1lbnVcIik7XG5cbiAgICAgICAgICAgIG1lbnVfY29udGFpbmVyLm9uKFwibW91c2V3aGVlbFwiLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICB2YXIgcGFuZV93aWR0aCA9IGVsZW1lbnQuZmluZChcIi5uYXZ2aWV3LXBhbmVcIikud2lkdGgoKTtcbiAgICAgICAgICAgICAgICB2YXIgZGlyID0gZS5kZWx0YVkgPiAwID8gLTEgOiAxO1xuICAgICAgICAgICAgICAgIHZhciBzdGVwID0gdGhhdC5tZW51U2Nyb2xsU3RlcDtcbiAgICAgICAgICAgICAgICB2YXIgZGlzdGFuY2UgPSB0aGF0Lm1lbnVTY3JvbGxEaXN0YW5jZTtcbiAgICAgICAgICAgICAgICB2YXIgdG9wID0gcGFyc2VJbnQobWVudS5jc3MoJ3RvcCcpKTtcblxuICAgICAgICAgICAgICAgIGlmIChwYW5lX3dpZHRoID4gNDggLyp8fCAhZWxlbWVudC5oYXNDbGFzcyhcImNvbXBhY3RlZFwiKSAqLykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYoZGlyID09PSAtMSAmJiBNYXRoLmFicyh0b3ApIDw9IGRpc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lbnUuY3NzKCd0b3AnLCBwYXJzZUludChtZW51LmNzcygndG9wJykpICsgc3RlcCAqIGRpcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYoZGlyID09PSAxICYmIHRvcCA8PSAtc3RlcCkge1xuICAgICAgICAgICAgICAgICAgICBtZW51LmNzcygndG9wJywgcGFyc2VJbnQobWVudS5jc3MoJ3RvcCcpKSArIHN0ZXAgKiBkaXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIucHVsbC1idXR0b24sIC5ob2xkZXJcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0LnB1bGxDbGljayh0aGlzKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIubmF2dmlldy1tZW51IGxpXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKG8uYWN0aXZlU3RhdGUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLm5hdnZpZXctbWVudSBsaVwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS50b2dnbGVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLm5hdnZpZXctbWVudSBsaSA+IGFcIiwgZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcIm1lbnUtaXRlbS1jbGlja1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW06IHRoaXNcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnBhbmVUb2dnbGUgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhbmVUb2dnbGUub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnBhbmUudG9nZ2xlQ2xhc3MoXCJvcGVuXCIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICQod2luZG93KS5vbihNZXRyby5ldmVudHMucmVzaXplLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBtZW51X2gsIG1lbnVfY29udGFpbmVyX2gsXG4gICAgICAgICAgICAgICAgICAgIG1lbnVfY29udGFpbmVyID0gZWxlbWVudC5jaGlsZHJlbihcIi5uYXZ2aWV3LW1lbnUtY29udGFpbmVyXCIpLFxuICAgICAgICAgICAgICAgICAgICBtZW51O1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoYXQucGFuZS5oYXNDbGFzcyhcIm9wZW5cIikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fcmVjYWxjKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcyhcImV4cGFuZGVkXCIpO1xuICAgICAgICAgICAgICAgIHRoYXQucGFuZS5yZW1vdmVDbGFzcyhcIm9wZW5cIik7XG5cbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS53aWR0aCgpIDw9IE1ldHJvLm1lZGlhX3NpemVzWyhcIlwiK28uY29tcGFjdCkudG9VcHBlckNhc2UoKV0pIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcyhcImNvbXBhY3RlZFwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobWVudV9jb250YWluZXIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lbnUgPSBtZW51X2NvbnRhaW5lci5jaGlsZHJlbihcIi5uYXZ2aWV3LW1lbnVcIik7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVudV9oID0gbWVudS5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVfY29udGFpbmVyX2ggPSBtZW51X2NvbnRhaW5lci5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQubWVudVNjcm9sbFN0ZXAgPSBtZW51LmNoaWxkcmVuKFwiOm5vdCguaXRlbS1zZXBhcmF0b3IpLCA6bm90KC5pdGVtLWhlYWRlcilcIilbMF0uY2xpZW50SGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5tZW51U2Nyb2xsRGlzdGFuY2UgPSBtZW51X2ggPiBtZW51X2NvbnRhaW5lcl9oID8gVXRpbHMubmVhcmVzdChtZW51X2ggLSBtZW51X2NvbnRhaW5lcl9oLCB0aGF0Lm1lbnVTY3JvbGxTdGVwKSA6IDA7XG4gICAgICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoYXQuX3JlY2FsYygpO1xuXG4gICAgICAgICAgICB9LCB7bnM6IHRoaXMuaWR9KVxuICAgICAgICB9LFxuXG4gICAgICAgIF90b2dnbGVQYW5lTW9kZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIHBhbmUgPSB0aGlzLnBhbmU7XG4gICAgICAgICAgICB2YXIgcGFuZV9jb21wYWN0ID0gcGFuZS53aWR0aCgpIDwgMjgwO1xuXG4gICAgICAgICAgICBpZiAoKHBhbmVfY29tcGFjdCB8fCBlbGVtZW50Lmhhc0NsYXNzKFwiZXhwYW5kZWRcIikpICYmICFlbGVtZW50Lmhhc0NsYXNzKFwiY29tcGFjdGVkXCIpKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC50b2dnbGVDbGFzcyhcImV4cGFuZGVkXCIpO1xuICAgICAgICAgICAgfSBlbHNlXG5cbiAgICAgICAgICAgIGlmIChlbGVtZW50Lmhhc0NsYXNzKFwiY29tcGFjdGVkXCIpIHx8ICFwYW5lX2NvbXBhY3QpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnRvZ2dsZUNsYXNzKFwiY29tcGFjdGVkXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgcHVsbENsaWNrOiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgaW5wdXQ7XG5cbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSAkKGVsKTtcblxuICAgICAgICAgICAgaWYgKHRhcmdldCAmJiB0YXJnZXQuaGFzQ2xhc3MoXCJob2xkZXJcIikpIHtcbiAgICAgICAgICAgICAgICBpbnB1dCA9IHRhcmdldC5wYXJlbnQoKS5maW5kKFwiaW5wdXRcIik7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC5mb2N1cygpO1xuICAgICAgICAgICAgICAgIH0sIDIwMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGF0LnBhbmUuaGFzQ2xhc3MoXCJvcGVuXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5jbG9zZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90b2dnbGVQYW5lTW9kZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9yZWNhbGMoKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb3BlbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMucGFuZS5hZGRDbGFzcyhcIm9wZW5cIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLnBhbmUucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBwYW5lID0gdGhpcy5wYW5lO1xuICAgICAgICAgICAgcGFuZS5oYXNDbGFzcyhcIm9wZW5cIikgPyBwYW5lLnJlbW92ZUNsYXNzKFwib3BlblwiKSA6IHBhbmUuYWRkQ2xhc3MoXCJvcGVuXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZU1vZGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLl90b2dnbGVQYW5lTW9kZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSAqL1xuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHJpYnV0ZU5hbWUpe1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5wdWxsLWJ1dHRvbiwgLmhvbGRlclwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIubmF2dmlldy1tZW51IGxpXCIpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5uYXZ2aWV3LW1lbnUgbGkgPiBhXCIpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5wYW5lVG9nZ2xlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wYW5lVG9nZ2xlLm9mZihNZXRyby5ldmVudHMuY2xpY2spO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkKHdpbmRvdykub2ZmKE1ldHJvLmV2ZW50cy5yZXNpemUse25zOiB0aGlzLmlkfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgTm90aWZ5RGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgY29udGFpbmVyOiBudWxsLFxuICAgICAgICB3aWR0aDogMjIwLFxuICAgICAgICB0aW1lb3V0OiBNRVRST19USU1FT1VULFxuICAgICAgICBkdXJhdGlvbjogTUVUUk9fQU5JTUFUSU9OX0RVUkFUSU9OLFxuICAgICAgICBkaXN0YW5jZTogXCJtYXhcIixcbiAgICAgICAgYW5pbWF0aW9uOiBcImxpbmVhclwiLFxuICAgICAgICBvbkNsaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNsb3NlOiBNZXRyby5ub29wLFxuICAgICAgICBvblNob3c6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQXBwZW5kOiBNZXRyby5ub29wLFxuICAgICAgICBvbk5vdGlmeUNyZWF0ZTogTWV0cm8ubm9vcFxuXG4gICAgfTtcblxuICAgIE1ldHJvLm5vdGlmeVNldHVwID0gZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgICAgIE5vdGlmeURlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgTm90aWZ5RGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9Ob3RpZnlTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLm5vdGlmeVNldHVwKHdpbmRvd1tcIm1ldHJvTm90aWZ5U2V0dXBcIl0pO1xuICAgIH1cblxuICAgIHZhciBOb3RpZnkgPSB7XG5cbiAgICAgICAgY29udGFpbmVyOiBudWxsLFxuXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgfSxcblxuICAgICAgICBub3RpZmllczogW10sXG5cbiAgICAgICAgc2V0dXA6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIE5vdGlmeURlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICByZXNldDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciByZXNldF9vcHRpb25zID0ge1xuICAgICAgICAgICAgICAgIHdpZHRoOiAyMjAsXG4gICAgICAgICAgICAgICAgdGltZW91dDogTUVUUk9fVElNRU9VVCxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogTUVUUk9fQU5JTUFUSU9OX0RVUkFUSU9OLFxuICAgICAgICAgICAgICAgIGRpc3RhbmNlOiBcIm1heFwiLFxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogXCJsaW5lYXJcIlxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBOb3RpZnlEZWZhdWx0Q29uZmlnLCByZXNldF9vcHRpb25zKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlQ29udGFpbmVyOiBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICB2YXIgY29udGFpbmVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwibm90aWZ5LWNvbnRhaW5lclwiKTtcbiAgICAgICAgICAgICQoXCJib2R5XCIpLnByZXBlbmQoY29udGFpbmVyKTtcblxuICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcbiAgICAgICAgfSxcblxuICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zKXtcbiAgICAgICAgICAgIHZhciBub3RpZnksIHRoYXQgPSB0aGlzLCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIG0sIHQsIGlkID0gVXRpbHMuZWxlbWVudElkKFwibm90aWZ5XCIpO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNOdWxsKG9wdGlvbnMpKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUobWVzc2FnZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG5vdGlmeSA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcIm5vdGlmeVwiKS5hdHRyKFwiaWRcIiwgaWQpO1xuICAgICAgICAgICAgbm90aWZ5LmNzcyh7XG4gICAgICAgICAgICAgICAgd2lkdGg6IG8ud2lkdGhcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAodGl0bGUpIHtcbiAgICAgICAgICAgICAgICB0ID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwibm90aWZ5LXRpdGxlXCIpLmh0bWwodGl0bGUpO1xuICAgICAgICAgICAgICAgIG5vdGlmeS5wcmVwZW5kKHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbSA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcIm5vdGlmeS1tZXNzYWdlXCIpLmh0bWwobWVzc2FnZSk7XG4gICAgICAgICAgICBtLmFwcGVuZFRvKG5vdGlmeSk7XG5cbiAgICAgICAgICAgIC8vIFNldCBvcHRpb25zXG4gICAgICAgICAgICAvKlxuICAgICAgICAgICAgKiBrZWVwT3BlbiwgY2xzLCB3aWR0aCwgY2FsbGJhY2tcbiAgICAgICAgICAgICogKi9cbiAgICAgICAgICAgIGlmIChvcHRpb25zICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5jbHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBub3RpZnkuYWRkQ2xhc3Mob3B0aW9ucy5jbHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy53aWR0aCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vdGlmeS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG9wdGlvbnMud2lkdGhcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBub3RpZnkub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIFV0aWxzLmV4ZWMoVXRpbHMuaXNWYWx1ZShvcHRpb25zLm9uQ2xpY2spID8gb3B0aW9ucy5vbkNsaWNrIDogby5vbkNsaWNrLCBudWxsLCB0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGF0LmtpbGwoJCh0aGlzKS5jbG9zZXN0KFwiLm5vdGlmeVwiKSwgVXRpbHMuaXNWYWx1ZShvcHRpb25zLm9uQ2xvc2UpID8gb3B0aW9ucy5vbkNsb3NlIDogby5vbkNsb3NlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBTaG93XG4gICAgICAgICAgICBpZiAoTm90aWZ5LmNvbnRhaW5lciA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIE5vdGlmeS5jb250YWluZXIgPSBOb3RpZnkuX2NyZWF0ZUNvbnRhaW5lcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbm90aWZ5LmFwcGVuZFRvKE5vdGlmeS5jb250YWluZXIpO1xuXG4gICAgICAgICAgICBub3RpZnkuaGlkZShmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgVXRpbHMuZXhlYyhVdGlscy5pc1ZhbHVlKG9wdGlvbnMub25BcHBlbmQpID8gb3B0aW9ucy5vbkFwcGVuZCA6IG8ub25BcHBlbmQsIG51bGwsIG5vdGlmeVswXSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgZHVyYXRpb24gPSBVdGlscy5pc1ZhbHVlKG9wdGlvbnMuZHVyYXRpb24pID8gb3B0aW9ucy5kdXJhdGlvbiA6IG8uZHVyYXRpb247XG4gICAgICAgICAgICAgICAgdmFyIGFuaW1hdGlvbiA9IFV0aWxzLmlzVmFsdWUob3B0aW9ucy5hbmltYXRpb24pID8gb3B0aW9ucy5hbmltYXRpb24gOiBvLmFuaW1hdGlvbjtcbiAgICAgICAgICAgICAgICB2YXIgZGlzdGFuY2UgPSBVdGlscy5pc1ZhbHVlKG9wdGlvbnMuZGlzdGFuY2UpID8gb3B0aW9ucy5kaXN0YW5jZSA6IG8uZGlzdGFuY2U7XG5cbiAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2UgPT09IFwibWF4XCIgfHwgaXNOYU4oZGlzdGFuY2UpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlID0gJCh3aW5kb3cpLmhlaWdodCgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG5vdGlmeVxuICAgICAgICAgICAgICAgICAgICAuc2hvdygpXG4gICAgICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW5Ub3A6IFtkaXN0YW5jZSwgNF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogWzAsIDFdXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZHVyOiBkdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGVhc2U6IGFuaW1hdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRG9uZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5leGVjKG8ub25Ob3RpZnlDcmVhdGUsIG51bGwsIHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLmtlZXBPcGVuID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSAqL1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5raWxsKG5vdGlmeSwgVXRpbHMuaXNWYWx1ZShvcHRpb25zLm9uQ2xvc2UpID8gb3B0aW9ucy5vbkNsb3NlIDogby5vbkNsb3NlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgby50aW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5leGVjKFV0aWxzLmlzVmFsdWUob3B0aW9ucy5vblNob3cpID8gb3B0aW9ucy5vblNob3cgOiBvLm9uU2hvdywgbnVsbCwgbm90aWZ5WzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGtpbGw6IGZ1bmN0aW9uKG5vdGlmeSwgY2FsbGJhY2spe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgbm90aWZ5Lm9mZihNZXRyby5ldmVudHMuY2xpY2spO1xuICAgICAgICAgICAgbm90aWZ5LmZhZGVPdXQoby5kdXJhdGlvbiwgJ2xpbmVhcicsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgVXRpbHMuZXhlYyhVdGlscy5pc1ZhbHVlKGNhbGxiYWNrKSA/IGNhbGxiYWNrIDogdGhhdC5vcHRpb25zLm9uQ2xvc2UsIG51bGwsIG5vdGlmeVswXSk7XG4gICAgICAgICAgICAgICAgbm90aWZ5LnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAga2lsbEFsbDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHZhciBub3RpZmllcyA9ICQoXCIubm90aWZ5XCIpO1xuICAgICAgICAgICAgJC5lYWNoKG5vdGlmaWVzLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQua2lsbCgkKHRoaXMpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIE1ldHJvWydub3RpZnknXSA9IE5vdGlmeS5zZXR1cCgpO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgTWV0cm8ucGFnaW5hdGlvbiA9IGZ1bmN0aW9uKGMpe1xuICAgICAgICB2YXIgZGVmQ29uZiA9IHtcbiAgICAgICAgICAgIGxlbmd0aDogMCxcbiAgICAgICAgICAgIHJvd3M6IDAsXG4gICAgICAgICAgICBjdXJyZW50OiAwLFxuICAgICAgICAgICAgdGFyZ2V0OiBcImJvZHlcIixcbiAgICAgICAgICAgIGNsc1BhZ2luYXRpb246IFwiXCIsXG4gICAgICAgICAgICBwcmV2VGl0bGU6IFwiUHJldlwiLFxuICAgICAgICAgICAgbmV4dFRpdGxlOiBcIk5leHRcIixcbiAgICAgICAgICAgIGRpc3RhbmNlOiA1XG4gICAgICAgIH0sIGNvbmY7XG4gICAgICAgIHZhciBwYWdpbmF0aW9uO1xuICAgICAgICB2YXIgcGFnaW5hdGlvbl93cmFwcGVyO1xuICAgICAgICB2YXIgaSwgcHJldiwgbmV4dDtcbiAgICAgICAgdmFyIHNob3J0RGlzdGFuY2U7XG5cbiAgICAgICAgY29uZiA9ICQuZXh0ZW5kKCB7fSwgZGVmQ29uZiwgYyk7XG5cbiAgICAgICAgc2hvcnREaXN0YW5jZSA9IHBhcnNlSW50KGNvbmYuZGlzdGFuY2UpO1xuICAgICAgICBwYWdpbmF0aW9uX3dyYXBwZXIgPSAkKGNvbmYudGFyZ2V0KTtcbiAgICAgICAgcGFnaW5hdGlvbl93cmFwcGVyLmh0bWwoXCJcIik7XG4gICAgICAgIHBhZ2luYXRpb24gPSAkKFwiPHVsPlwiKS5hZGRDbGFzcyhcInBhZ2luYXRpb25cIikuYWRkQ2xhc3MoY29uZi5jbHNQYWdpbmF0aW9uKS5hcHBlbmRUbyhwYWdpbmF0aW9uX3dyYXBwZXIpO1xuXG4gICAgICAgIGlmIChjb25mLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjb25mLnJvd3MgPT09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uZi5wYWdlcyA9IE1hdGguY2VpbChjb25mLmxlbmd0aCAvIGNvbmYucm93cyk7XG5cbiAgICAgICAgdmFyIGFkZF9pdGVtID0gZnVuY3Rpb24oaXRlbV90aXRsZSwgaXRlbV90eXBlLCBkYXRhKXtcbiAgICAgICAgICAgIHZhciBsaSwgYTtcblxuICAgICAgICAgICAgbGkgPSAkKFwiPGxpPlwiKS5hZGRDbGFzcyhcInBhZ2UtaXRlbVwiKS5hZGRDbGFzcyhpdGVtX3R5cGUpO1xuICAgICAgICAgICAgYSAgPSAkKFwiPGE+XCIpLmFkZENsYXNzKFwicGFnZS1saW5rXCIpLmh0bWwoaXRlbV90aXRsZSk7XG4gICAgICAgICAgICBhLmRhdGEoXCJwYWdlXCIsIGRhdGEpO1xuICAgICAgICAgICAgYS5hcHBlbmRUbyhsaSk7XG5cbiAgICAgICAgICAgIHJldHVybiBsaTtcbiAgICAgICAgfTtcblxuICAgICAgICBwcmV2ID0gYWRkX2l0ZW0oY29uZi5wcmV2VGl0bGUsIFwic2VydmljZSBwcmV2LXBhZ2VcIiwgXCJwcmV2XCIpO1xuICAgICAgICBwYWdpbmF0aW9uLmFwcGVuZChwcmV2KTtcblxuICAgICAgICBwYWdpbmF0aW9uLmFwcGVuZChhZGRfaXRlbSgxLCBjb25mLmN1cnJlbnQgPT09IDEgPyBcImFjdGl2ZVwiIDogXCJcIiwgMSkpO1xuXG4gICAgICAgIGlmIChzaG9ydERpc3RhbmNlID09PSAwIHx8IGNvbmYucGFnZXMgPD0gNykge1xuICAgICAgICAgICAgZm9yIChpID0gMjsgaSA8IGNvbmYucGFnZXM7IGkrKykge1xuICAgICAgICAgICAgICAgIHBhZ2luYXRpb24uYXBwZW5kKGFkZF9pdGVtKGksIGkgPT09IGNvbmYuY3VycmVudCA/IFwiYWN0aXZlXCIgOiBcIlwiLCBpKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoY29uZi5jdXJyZW50IDwgc2hvcnREaXN0YW5jZSkge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDI7IGkgPD0gc2hvcnREaXN0YW5jZTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb24uYXBwZW5kKGFkZF9pdGVtKGksIGkgPT09IGNvbmYuY3VycmVudCA/IFwiYWN0aXZlXCIgOiBcIlwiLCBpKSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGNvbmYucGFnZXMgPiBzaG9ydERpc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb24uYXBwZW5kKGFkZF9pdGVtKFwiLi4uXCIsIFwibm8tbGlua1wiLCBudWxsKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChjb25mLmN1cnJlbnQgPD0gY29uZi5wYWdlcyAmJiBjb25mLmN1cnJlbnQgPiBjb25mLnBhZ2VzIC0gc2hvcnREaXN0YW5jZSArIDEpIHtcbiAgICAgICAgICAgICAgICBpZiAoY29uZi5wYWdlcyA+IHNob3J0RGlzdGFuY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbi5hcHBlbmQoYWRkX2l0ZW0oXCIuLi5cIiwgXCJuby1saW5rXCIsIG51bGwpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmb3IgKGkgPSBjb25mLnBhZ2VzIC0gc2hvcnREaXN0YW5jZSArIDE7IGkgPCBjb25mLnBhZ2VzOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbi5hcHBlbmQoYWRkX2l0ZW0oaSwgaSA9PT0gY29uZi5jdXJyZW50ID8gXCJhY3RpdmVcIiA6IFwiXCIsIGkpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHBhZ2luYXRpb24uYXBwZW5kKGFkZF9pdGVtKFwiLi4uXCIsIFwibm8tbGlua1wiLCBudWxsKSk7XG5cbiAgICAgICAgICAgICAgICBwYWdpbmF0aW9uLmFwcGVuZChhZGRfaXRlbShjb25mLmN1cnJlbnQgLSAxLCBcIlwiLCBjb25mLmN1cnJlbnQgLSAxKSk7XG4gICAgICAgICAgICAgICAgcGFnaW5hdGlvbi5hcHBlbmQoYWRkX2l0ZW0oY29uZi5jdXJyZW50LCBcImFjdGl2ZVwiLCBjb25mLmN1cnJlbnQpKTtcbiAgICAgICAgICAgICAgICBwYWdpbmF0aW9uLmFwcGVuZChhZGRfaXRlbShjb25mLmN1cnJlbnQgKyAxLCBcIlwiLCBjb25mLmN1cnJlbnQgKyAxKSk7XG5cbiAgICAgICAgICAgICAgICBwYWdpbmF0aW9uLmFwcGVuZChhZGRfaXRlbShcIi4uLlwiLCBcIm5vLWxpbmtcIiwgbnVsbCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbmYucGFnZXMgPiAxIHx8IGNvbmYuY3VycmVudCA8IGNvbmYucGFnZXMpIHBhZ2luYXRpb24uYXBwZW5kKGFkZF9pdGVtKGNvbmYucGFnZXMsIGNvbmYuY3VycmVudCA9PT0gY29uZi5wYWdlcyA/IFwiYWN0aXZlXCIgOiBcIlwiLCBjb25mLnBhZ2VzKSk7XG5cbiAgICAgICAgbmV4dCA9IGFkZF9pdGVtKGNvbmYubmV4dFRpdGxlLCBcInNlcnZpY2UgbmV4dC1wYWdlXCIsIFwibmV4dFwiKTtcbiAgICAgICAgcGFnaW5hdGlvbi5hcHBlbmQobmV4dCk7XG5cbiAgICAgICAgaWYgKGNvbmYuY3VycmVudCA9PT0gMSkge1xuICAgICAgICAgICAgcHJldi5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbmYuY3VycmVudCA9PT0gY29uZi5wYWdlcykge1xuICAgICAgICAgICAgbmV4dC5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbmYubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBwYWdpbmF0aW9uLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICBwYWdpbmF0aW9uLmNoaWxkcmVuKCkuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwYWdpbmF0aW9uO1xuICAgIH07XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgUGFuZWxEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBwYW5lbERlZmVycmVkOiAwLFxuICAgICAgICBpZDogbnVsbCxcbiAgICAgICAgdGl0bGVDYXB0aW9uOiBcIlwiLFxuICAgICAgICB0aXRsZUljb246IFwiXCIsXG4gICAgICAgIGNvbGxhcHNpYmxlOiBmYWxzZSxcbiAgICAgICAgY29sbGFwc2VkOiBmYWxzZSxcbiAgICAgICAgY29sbGFwc2VEdXJhdGlvbjogTUVUUk9fQU5JTUFUSU9OX0RVUkFUSU9OLFxuICAgICAgICB3aWR0aDogXCJhdXRvXCIsXG4gICAgICAgIGhlaWdodDogXCJhdXRvXCIsXG4gICAgICAgIGRyYWdnYWJsZTogZmFsc2UsXG5cbiAgICAgICAgY3VzdG9tQnV0dG9uczogbnVsbCxcbiAgICAgICAgY2xzQ3VzdG9tQnV0dG9uOiBcIlwiLFxuXG4gICAgICAgIGNsc1BhbmVsOiBcIlwiLFxuICAgICAgICBjbHNUaXRsZTogXCJcIixcbiAgICAgICAgY2xzVGl0bGVDYXB0aW9uOiBcIlwiLFxuICAgICAgICBjbHNUaXRsZUljb246IFwiXCIsXG4gICAgICAgIGNsc0NvbnRlbnQ6IFwiXCIsXG4gICAgICAgIGNsc0NvbGxhcHNlVG9nZ2xlOiBcIlwiLFxuXG4gICAgICAgIG9uQ29sbGFwc2U6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uRXhwYW5kOiBNZXRyby5ub29wLFxuICAgICAgICBvbkRyYWdTdGFydDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EcmFnU3RvcDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EcmFnTW92ZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25QYW5lbENyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5wYW5lbFNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgUGFuZWxEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIFBhbmVsRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9QYW5lbFNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8ucGFuZWxTZXR1cCh3aW5kb3dbXCJtZXRyb1BhbmVsU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgncGFuZWwnLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgUGFuZWxEZWZhdWx0Q29uZmlnKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2FkZEN1c3RvbUJ1dHRvbnM6IGZ1bmN0aW9uKGJ1dHRvbnMpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgdGl0bGUgPSBlbGVtZW50LmNsb3Nlc3QoXCIucGFuZWxcIikuZmluZChcIi5wYW5lbC10aXRsZVwiKTtcbiAgICAgICAgICAgIHZhciBidXR0b25zQ29udGFpbmVyLCBjdXN0b21CdXR0b25zID0gW107XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgYnV0dG9ucyA9PT0gXCJzdHJpbmdcIiAmJiBidXR0b25zLmluZGV4T2YoXCJ7XCIpID4gLTEpIHtcbiAgICAgICAgICAgICAgICBjdXN0b21CdXR0b25zID0gSlNPTi5wYXJzZShidXR0b25zKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGJ1dHRvbnMgPT09IFwic3RyaW5nXCIgJiYgVXRpbHMuaXNPYmplY3QoYnV0dG9ucykpIHtcbiAgICAgICAgICAgICAgICBjdXN0b21CdXR0b25zID0gVXRpbHMuaXNPYmplY3QoYnV0dG9ucyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBidXR0b25zID09PSBcIm9iamVjdFwiICYmIFV0aWxzLm9iamVjdExlbmd0aChidXR0b25zKSA+IDApIHtcbiAgICAgICAgICAgICAgICBjdXN0b21CdXR0b25zID0gYnV0dG9ucztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwiVW5rbm93biBmb3JtYXQgZm9yIGN1c3RvbSBidXR0b25zXCIsIGJ1dHRvbnMpO1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aXRsZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJObyBwbGFjZSBmb3IgY3VzdG9tIGJ1dHRvbnNcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYnV0dG9uc0NvbnRhaW5lciA9IHRpdGxlLmZpbmQoXCIuY3VzdG9tLWJ1dHRvbnNcIik7XG5cbiAgICAgICAgICAgIGlmIChidXR0b25zQ29udGFpbmVyLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGJ1dHRvbnNDb250YWluZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJjdXN0b20tYnV0dG9uc1wiKS5hcHBlbmRUbyh0aXRsZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGJ1dHRvbnNDb250YWluZXIuZmluZChcIi5idG4tY3VzdG9tXCIpLm9mZihNZXRyby5ldmVudHMuY2xpY2spO1xuICAgICAgICAgICAgICAgIGJ1dHRvbnNDb250YWluZXIuaHRtbChcIlwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJC5lYWNoKGN1c3RvbUJ1dHRvbnMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB0aGlzO1xuICAgICAgICAgICAgICAgIHZhciBjdXN0b21CdXR0b24gPSAkKFwiPHNwYW4+XCIpO1xuXG4gICAgICAgICAgICAgICAgY3VzdG9tQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcImJ1dHRvbiBidG4tY3VzdG9tXCIpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhvLmNsc0N1c3RvbUJ1dHRvbilcbiAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKGl0ZW0uY2xzKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRhYmluZGV4XCIsIC0xKVxuICAgICAgICAgICAgICAgICAgICAuaHRtbChpdGVtLmh0bWwpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uYXR0ciAmJiB0eXBlb2YgaXRlbS5hdHRyID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICAkLmVhY2goaXRlbS5hdHRyLCBmdW5jdGlvbihrLCB2KXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbUJ1dHRvbi5hdHRyKENha2UuZGFzaGVkTmFtZShrKSwgdik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGN1c3RvbUJ1dHRvbi5kYXRhKFwiYWN0aW9uXCIsIGl0ZW0ub25jbGljayk7XG5cbiAgICAgICAgICAgICAgICBidXR0b25zQ29udGFpbmVyLnByZXBlbmQoY3VzdG9tQnV0dG9uKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aXRsZS5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmJ0bi1jdXN0b21cIiwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzUmlnaHRNb3VzZShlKSkgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHZhciBidXR0b24gPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIHZhciBhY3Rpb24gPSBidXR0b24uZGF0YShcImFjdGlvblwiKTtcbiAgICAgICAgICAgICAgICBVdGlscy5leGVjKGFjdGlvbiwgW2J1dHRvbl0sIHRoaXMpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBwYW5lbCA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInBhbmVsXCIpLmFkZENsYXNzKG8uY2xzUGFuZWwpO1xuICAgICAgICAgICAgdmFyIGlkID0gby5pZCA/IG8uaWQgOiBVdGlscy5lbGVtZW50SWQoXCJwYW5lbFwiKTtcbiAgICAgICAgICAgIHZhciBvcmlnaW5hbF9jbGFzc2VzID0gZWxlbWVudFswXS5jbGFzc05hbWU7XG4gICAgICAgICAgICB2YXIgdGl0bGU7XG5cbiAgICAgICAgICAgIHBhbmVsLmF0dHIoXCJpZFwiLCBpZCkuYWRkQ2xhc3Mob3JpZ2luYWxfY2xhc3Nlcyk7XG4gICAgICAgICAgICBwYW5lbC5pbnNlcnRCZWZvcmUoZWxlbWVudCk7XG4gICAgICAgICAgICBlbGVtZW50LmFwcGVuZFRvKHBhbmVsKTtcblxuICAgICAgICAgICAgZWxlbWVudFswXS5jbGFzc05hbWUgPSAnJztcbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJwYW5lbC1jb250ZW50XCIpLmFkZENsYXNzKG8uY2xzQ29udGVudCkuYXBwZW5kVG8ocGFuZWwpO1xuXG4gICAgICAgICAgICBpZiAoby50aXRsZUNhcHRpb24gIT09IFwiXCIgfHwgby50aXRsZUljb24gIT09IFwiXCIgfHwgby5jb2xsYXBzaWJsZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRpdGxlID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwicGFuZWwtdGl0bGVcIikuYWRkQ2xhc3Moby5jbHNUaXRsZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoby50aXRsZUNhcHRpb24gIT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcImNhcHRpb25cIikuYWRkQ2xhc3Moby5jbHNUaXRsZUNhcHRpb24pLmh0bWwoby50aXRsZUNhcHRpb24pLmFwcGVuZFRvKHRpdGxlKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChvLnRpdGxlSWNvbiAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICAkKG8udGl0bGVJY29uKS5hZGRDbGFzcyhcImljb25cIikuYWRkQ2xhc3Moby5jbHNUaXRsZUljb24pLmFwcGVuZFRvKHRpdGxlKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChvLmNvbGxhcHNpYmxlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2xsYXBzZVRvZ2dsZSA9ICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJkcm9wZG93bi10b2dnbGUgbWFya2VyLWNlbnRlciBhY3RpdmUtdG9nZ2xlXCIpLmFkZENsYXNzKG8uY2xzQ29sbGFwc2VUb2dnbGUpLmFwcGVuZFRvKHRpdGxlKTtcbiAgICAgICAgICAgICAgICAgICAgTWV0cm8ubWFrZVBsdWdpbihlbGVtZW50LCBcImNvbGxhcHNlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUVsZW1lbnQ6IGNvbGxhcHNlVG9nZ2xlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IG8uY29sbGFwc2VEdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ29sbGFwc2U6IG8ub25Db2xsYXBzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRXhwYW5kOiBvLm9uRXhwYW5kXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChvLmNvbGxhcHNlZCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2xsYXBzZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGl0bGUuYXBwZW5kVG8ocGFuZWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGl0bGUgJiYgVXRpbHMuaXNWYWx1ZShvLmN1c3RvbUJ1dHRvbnMpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYWRkQ3VzdG9tQnV0dG9ucyhvLmN1c3RvbUJ1dHRvbnMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5kcmFnZ2FibGUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZHJhZ0VsZW1lbnQ7XG5cbiAgICAgICAgICAgICAgICBpZiAodGl0bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZHJhZ0VsZW1lbnQgPSB0aXRsZS5maW5kKFwiLmNhcHRpb24sIC5pY29uXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRyYWdFbGVtZW50ID0gcGFuZWw7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgTWV0cm8ubWFrZVBsdWdpbihwYW5lbCwgXCJkcmFnZ2FibGVcIiwge1xuICAgICAgICAgICAgICAgICAgICBkcmFnQ29udGV4dDogcGFuZWxbMF0sXG4gICAgICAgICAgICAgICAgICAgIGRyYWdFbGVtZW50OiBkcmFnRWxlbWVudCxcbiAgICAgICAgICAgICAgICAgICAgb25EcmFnU3RhcnQ6IG8ub25EcmFnU3RhcnQsXG4gICAgICAgICAgICAgICAgICAgIG9uRHJhZ1N0b3A6IG8ub25EcmFnU3RvcCxcbiAgICAgICAgICAgICAgICAgICAgb25EcmFnTW92ZTogby5vbkRyYWdNb3ZlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLndpZHRoICE9PSBcImF1dG9cIiAmJiBwYXJzZUludChvLndpZHRoKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgcGFuZWwub3V0ZXJXaWR0aChwYXJzZUludChvLndpZHRoKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmhlaWdodCAhPT0gXCJhdXRvXCIgJiYgcGFyc2VJbnQoby5oZWlnaHQpID49IDApIHtcbiAgICAgICAgICAgICAgICBwYW5lbC5vdXRlckhlaWdodChwYXJzZUludChvLmhlaWdodCkpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuY3NzKHtvdmVyZmxvdzogXCJhdXRvXCJ9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5wYW5lbCA9IHBhbmVsO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJwYW5lbC1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgcGFuZWw6IHBhbmVsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjdXN0b21CdXR0b25zOiBmdW5jdGlvbihidXR0b25zKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hZGRDdXN0b21CdXR0b25zKGJ1dHRvbnMpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNvbGxhcHNlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNNZXRyb09iamVjdChlbGVtZW50LCAnY29sbGFwc2UnKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKGVsZW1lbnQsICdjb2xsYXBzZScpLmNvbGxhcHNlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb3BlbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZXhwYW5kKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmNvbGxhcHNlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXhwYW5kOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNNZXRyb09iamVjdChlbGVtZW50LCAnY29sbGFwc2UnKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKGVsZW1lbnQsICdjb2xsYXBzZScpLmV4cGFuZCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSAqL1xuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHJpYnV0ZU5hbWUpe1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgaWYgKG8uY29sbGFwc2libGUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBNZXRyby5nZXRQbHVnaW4oZWxlbWVudCwgXCJjb2xsYXBzZVwiKS5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmRyYWdnYWJsZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbihlbGVtZW50LCBcImRyYWdnYWJsZVwiKS5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgUG9wb3ZlckRlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIHBvcG92ZXJEZWZlcnJlZDogMCxcbiAgICAgICAgcG9wb3ZlclRleHQ6IFwiXCIsXG4gICAgICAgIHBvcG92ZXJIaWRlOiAzMDAwLFxuICAgICAgICBwb3BvdmVyVGltZW91dDogMTAsXG4gICAgICAgIHBvcG92ZXJPZmZzZXQ6IDEwLFxuICAgICAgICBwb3BvdmVyVHJpZ2dlcjogTWV0cm8ucG9wb3ZlckV2ZW50cy5IT1ZFUixcbiAgICAgICAgcG9wb3ZlclBvc2l0aW9uOiBNZXRyby5wb3NpdGlvbi5UT1AsXG4gICAgICAgIGhpZGVPbkxlYXZlOiBmYWxzZSxcbiAgICAgICAgY2xvc2VCdXR0b246IHRydWUsXG4gICAgICAgIGNsc1BvcG92ZXI6IFwiXCIsXG4gICAgICAgIGNsc1BvcG92ZXJDb250ZW50OiBcIlwiLFxuICAgICAgICBvblBvcG92ZXJTaG93OiBNZXRyby5ub29wLFxuICAgICAgICBvblBvcG92ZXJIaWRlOiBNZXRyby5ub29wLFxuICAgICAgICBvblBvcG92ZXJDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8ucG9wb3ZlclNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgUG9wb3ZlckRlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgUG9wb3ZlckRlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvUG9wb3ZlclNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8ucG9wb3ZlclNldHVwKHdpbmRvd1tcIm1ldHJvUG9wb3ZlclNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ3BvcG92ZXInLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgUG9wb3ZlckRlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICBwb3BvdmVyOiBudWxsLFxuICAgICAgICAgICAgICAgIHBvcG92ZXJlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgc2l6ZToge1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogMCxcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAwXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpZDogVXRpbHMuZWxlbWVudElkKFwicG9wb3ZlclwiKVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInBvcG92ZXItY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBldmVudDtcblxuICAgICAgICAgICAgc3dpdGNoIChvLnBvcG92ZXJUcmlnZ2VyKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBNZXRyby5wb3BvdmVyRXZlbnRzLkNMSUNLOiBldmVudCA9IE1ldHJvLmV2ZW50cy5jbGljazsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBNZXRyby5wb3BvdmVyRXZlbnRzLkZPQ1VTOiBldmVudCA9IE1ldHJvLmV2ZW50cy5mb2N1czsgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDogZXZlbnQgPSBNZXRyby5ldmVudHMuZW50ZXI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oZXZlbnQsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKHRoYXQucG9wb3ZlciAhPT0gbnVsbCB8fCB0aGF0LnBvcG92ZXJlZCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuY3JlYXRlUG9wb3ZlcigpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInBvcG92ZXItc2hvd1wiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3BvdmVyOiB0aGF0LnBvcG92ZXJcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG8ucG9wb3ZlckhpZGUgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5yZW1vdmVQb3BvdmVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBvLnBvcG92ZXJIaWRlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIG8ucG9wb3ZlclRpbWVvdXQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChvLmhpZGVPbkxlYXZlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMubGVhdmUsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQucmVtb3ZlUG9wb3ZlcigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkKHdpbmRvdykub24oTWV0cm8uZXZlbnRzLnNjcm9sbCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAodGhhdC5wb3BvdmVyICE9PSBudWxsKSB0aGF0LnNldFBvc2l0aW9uKCk7XG4gICAgICAgICAgICB9LCB7bnM6IHRoaXMuaWR9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRQb3NpdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBwb3BvdmVyID0gdGhpcy5wb3BvdmVyLCBzaXplID0gdGhpcy5zaXplLCBvID0gdGhpcy5vcHRpb25zLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICBpZiAoby5wb3BvdmVyUG9zaXRpb24gPT09IE1ldHJvLnBvc2l0aW9uLkJPVFRPTSkge1xuICAgICAgICAgICAgICAgIHBvcG92ZXIuYWRkQ2xhc3MoJ2JvdHRvbScpO1xuICAgICAgICAgICAgICAgIHBvcG92ZXIuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBlbGVtZW50Lm9mZnNldCgpLnRvcCAtICQod2luZG93KS5zY3JvbGxUb3AoKSArIGVsZW1lbnQub3V0ZXJIZWlnaHQoKSArIG8ucG9wb3Zlck9mZnNldCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogZWxlbWVudC5vZmZzZXQoKS5sZWZ0ICsgZWxlbWVudC5vdXRlcldpZHRoKCkvMiAtIHNpemUud2lkdGgvMiAgLSAkKHdpbmRvdykuc2Nyb2xsTGVmdCgpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG8ucG9wb3ZlclBvc2l0aW9uID09PSBNZXRyby5wb3NpdGlvbi5SSUdIVCkge1xuICAgICAgICAgICAgICAgIHBvcG92ZXIuYWRkQ2xhc3MoJ3JpZ2h0Jyk7XG4gICAgICAgICAgICAgICAgcG9wb3Zlci5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB0b3A6IGVsZW1lbnQub2Zmc2V0KCkudG9wICsgZWxlbWVudC5vdXRlckhlaWdodCgpLzIgLSBzaXplLmhlaWdodC8yIC0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpLFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBlbGVtZW50Lm9mZnNldCgpLmxlZnQgKyBlbGVtZW50Lm91dGVyV2lkdGgoKSAtICQod2luZG93KS5zY3JvbGxMZWZ0KCkgKyBvLnBvcG92ZXJPZmZzZXRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoby5wb3BvdmVyUG9zaXRpb24gPT09IE1ldHJvLnBvc2l0aW9uLkxFRlQpIHtcbiAgICAgICAgICAgICAgICBwb3BvdmVyLmFkZENsYXNzKCdsZWZ0Jyk7XG4gICAgICAgICAgICAgICAgcG9wb3Zlci5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB0b3A6IGVsZW1lbnQub2Zmc2V0KCkudG9wICsgZWxlbWVudC5vdXRlckhlaWdodCgpLzIgLSBzaXplLmhlaWdodC8yIC0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpLFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBlbGVtZW50Lm9mZnNldCgpLmxlZnQgLSBzaXplLndpZHRoIC0gJCh3aW5kb3cpLnNjcm9sbExlZnQoKSAtIG8ucG9wb3Zlck9mZnNldFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwb3BvdmVyLmFkZENsYXNzKCd0b3AnKTtcbiAgICAgICAgICAgICAgICBwb3BvdmVyLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogZWxlbWVudC5vZmZzZXQoKS50b3AgLSAkKHdpbmRvdykuc2Nyb2xsVG9wKCkgLSBzaXplLmhlaWdodCAtIG8ucG9wb3Zlck9mZnNldCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogZWxlbWVudC5vZmZzZXQoKS5sZWZ0ICsgZWxlbWVudC5vdXRlcldpZHRoKCkvMiAtIHNpemUud2lkdGgvMiAgLSAkKHdpbmRvdykuc2Nyb2xsTGVmdCgpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY3JlYXRlUG9wb3ZlcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbSA9IHRoaXMuZWxlbSwgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBwb3BvdmVyO1xuICAgICAgICAgICAgdmFyIG5lYl9wb3M7XG4gICAgICAgICAgICB2YXIgaWQgPSBVdGlscy5lbGVtZW50SWQoXCJwb3BvdmVyXCIpO1xuICAgICAgICAgICAgdmFyIGNsb3NlQnV0dG9uO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5wb3BvdmVyZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwb3BvdmVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwicG9wb3ZlciBuZWJcIikuYWRkQ2xhc3Moby5jbHNQb3BvdmVyKTtcbiAgICAgICAgICAgIHBvcG92ZXIuYXR0cihcImlkXCIsIGlkKTtcblxuICAgICAgICAgICAgJChcIjxkaXY+XCIpLmFkZENsYXNzKFwicG9wb3Zlci1jb250ZW50XCIpLmFkZENsYXNzKG8uY2xzUG9wb3ZlckNvbnRlbnQpLmh0bWwoby5wb3BvdmVyVGV4dCkuYXBwZW5kVG8ocG9wb3Zlcik7XG5cbiAgICAgICAgICAgIGlmIChvLnBvcG92ZXJIaWRlID09PSAwICYmIG8uY2xvc2VCdXR0b24gPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBjbG9zZUJ1dHRvbiA9ICQoXCI8YnV0dG9uPlwiKS5hZGRDbGFzcyhcImJ1dHRvbiBzcXVhcmUgc21hbGwgcG9wb3Zlci1jbG9zZS1idXR0b24gYmctd2hpdGVcIikuaHRtbChcIiZ0aW1lcztcIikuYXBwZW5kVG8ocG9wb3Zlcik7XG4gICAgICAgICAgICAgICAgY2xvc2VCdXR0b24ub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnJlbW92ZVBvcG92ZXIoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3dpdGNoIChvLnBvcG92ZXJQb3NpdGlvbikge1xuICAgICAgICAgICAgICAgIGNhc2UgTWV0cm8ucG9zaXRpb24uVE9QOiBuZWJfcG9zID0gXCJuZWItc1wiOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIE1ldHJvLnBvc2l0aW9uLkJPVFRPTTogbmViX3BvcyA9IFwibmViLW5cIjsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBNZXRyby5wb3NpdGlvbi5SSUdIVDogbmViX3BvcyA9IFwibmViLXdcIjsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBNZXRyby5wb3NpdGlvbi5MRUZUOiBuZWJfcG9zID0gXCJuZWItZVwiOyBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcG9wb3Zlci5hZGRDbGFzcyhuZWJfcG9zKTtcblxuICAgICAgICAgICAgaWYgKG8uY2xvc2VCdXR0b24gIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBwb3BvdmVyLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5yZW1vdmVQb3BvdmVyKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMucG9wb3ZlciA9IHBvcG92ZXI7XG4gICAgICAgICAgICB0aGlzLnNpemUgPSBVdGlscy5oaWRkZW5FbGVtZW50U2l6ZShwb3BvdmVyKTtcblxuICAgICAgICAgICAgaWYgKGVsZW0udGFnTmFtZSA9PT0gJ1REJyB8fCBlbGVtLnRhZ05hbWUgPT09ICdUSCcpIHtcbiAgICAgICAgICAgICAgICB2YXIgd3JwID0gJChcIjxkaXYvPlwiKS5jc3MoXCJkaXNwbGF5XCIsIFwiaW5saW5lLWJsb2NrXCIpLmh0bWwoZWxlbWVudC5odG1sKCkpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuaHRtbCh3cnApO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQgPSB3cnA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24oKTtcblxuICAgICAgICAgICAgcG9wb3Zlci5hcHBlbmRUbygkKCdib2R5JykpO1xuXG4gICAgICAgICAgICB0aGlzLnBvcG92ZXJlZCA9IHRydWU7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInBvcG92ZXItY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBwb3BvdmVyOiBwb3BvdmVyXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICByZW1vdmVQb3BvdmVyOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIHRpbWVvdXQgPSB0aGlzLm9wdGlvbnMub25Qb3BvdmVySGlkZSA9PT0gTWV0cm8ubm9vcCA/IDAgOiAzMDA7XG4gICAgICAgICAgICB2YXIgcG9wb3ZlciA9IHRoaXMucG9wb3ZlcjtcblxuICAgICAgICAgICAgaWYgKCF0aGlzLnBvcG92ZXJlZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInBvcG92ZXItaGlkZVwiLCB7XG4gICAgICAgICAgICAgICAgcG9wb3ZlcjogcG9wb3ZlclxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBwb3BvdmVyLmhpZGUoMCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgcG9wb3Zlci5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5wb3BvdmVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5wb3BvdmVyZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sIHRpbWVvdXQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnBvcG92ZXJlZCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0LmNyZWF0ZVBvcG92ZXIoKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInBvcG92ZXItc2hvd1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIHBvcG92ZXI6IHRoYXQucG9wb3ZlclxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKG8ucG9wb3ZlckhpZGUgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQucmVtb3ZlUG9wb3ZlcigpO1xuICAgICAgICAgICAgICAgICAgICB9LCBvLnBvcG92ZXJIaWRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBvLnBvcG92ZXJUaW1lb3V0KTtcbiAgICAgICAgfSxcblxuICAgICAgICBoaWRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVQb3BvdmVyKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdmFyIGNoYW5nZVRleHQgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIG8ucG9wb3ZlclRleHQgPSBlbGVtZW50LmF0dHIoXCJkYXRhLXBvcG92ZXItdGV4dFwiKTtcbiAgICAgICAgICAgICAgICBpZiAodGhhdC5wb3BvdmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQucG9wb3Zlci5maW5kKFwiLnBvcG92ZXItY29udGVudFwiKS5odG1sKG8ucG9wb3ZlclRleHQpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnNldFBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGNoYW5nZVBvc2l0aW9uID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBvLnBvcG92ZXJQb3NpdGlvbiA9IGVsZW1lbnQuYXR0cihcImRhdGEtcG9wb3Zlci1wb3NpdGlvblwiKTtcbiAgICAgICAgICAgICAgICB0aGF0LnNldFBvc2l0aW9uKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1wb3BvdmVyLXRleHRcIjogY2hhbmdlVGV4dCgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1wb3BvdmVyLXBvc2l0aW9uXCI6IGNoYW5nZVBvc2l0aW9uKCk7IGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBldmVudDtcblxuICAgICAgICAgICAgc3dpdGNoIChvLnBvcG92ZXJUcmlnZ2VyKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBNZXRyby5wb3BvdmVyRXZlbnRzLkNMSUNLOiBldmVudCA9IE1ldHJvLmV2ZW50cy5jbGljazsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBNZXRyby5wb3BvdmVyRXZlbnRzLkZPQ1VTOiBldmVudCA9IE1ldHJvLmV2ZW50cy5mb2N1czsgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDogZXZlbnQgPSBNZXRyby5ldmVudHMuZW50ZXI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKGV2ZW50KTtcblxuICAgICAgICAgICAgaWYgKG8uaGlkZU9uTGVhdmUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMubGVhdmUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkKHdpbmRvdykub2ZmKE1ldHJvLmV2ZW50cy5zY3JvbGwse25zOiB0aGlzLmlkfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgUHJvZ3Jlc3NEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBwcm9ncmVzc0RlZmVycmVkOiAwLFxuICAgICAgICBzaG93VmFsdWU6IGZhbHNlLFxuICAgICAgICB2YWx1ZVBvc2l0aW9uOiBcImZyZWVcIiwgLy8gY2VudGVyLCBmcmVlXG4gICAgICAgIHNob3dMYWJlbDogZmFsc2UsXG4gICAgICAgIGxhYmVsUG9zaXRpb246IFwiYmVmb3JlXCIsIC8vIGJlZm9yZSwgYWZ0ZXJcbiAgICAgICAgbGFiZWxUZW1wbGF0ZTogXCJcIixcbiAgICAgICAgdmFsdWU6IDAsXG4gICAgICAgIGJ1ZmZlcjogMCxcbiAgICAgICAgdHlwZTogXCJiYXJcIixcbiAgICAgICAgc21hbGw6IGZhbHNlLFxuICAgICAgICBjbHNCYWNrOiBcIlwiLFxuICAgICAgICBjbHNCYXI6IFwiXCIsXG4gICAgICAgIGNsc0J1ZmZlcjogXCJcIixcbiAgICAgICAgY2xzVmFsdWU6IFwiXCIsXG4gICAgICAgIGNsc0xhYmVsOiBcIlwiLFxuICAgICAgICBvblZhbHVlQ2hhbmdlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkJ1ZmZlckNoYW5nZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Db21wbGV0ZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25CdWZmZXJlZDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Qcm9ncmVzc0NyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5wcm9ncmVzc1NldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgUHJvZ3Jlc3NEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIFByb2dyZXNzRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9Qcm9ncmVzc1NldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8ucHJvZ3Jlc3NTZXR1cCh3aW5kb3dbXCJtZXRyb1Byb2dyZXNzU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgncHJvZ3Jlc3MnLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgUHJvZ3Jlc3NEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IDAsXG4gICAgICAgICAgICAgICAgYnVmZmVyOiAwXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHZhbHVlO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIG8udHlwZSA9PT0gXCJzdHJpbmdcIikgby50eXBlID0gby50eXBlLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgICAgIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAuaHRtbChcIlwiKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcInByb2dyZXNzXCIpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBfcHJvZ3Jlc3MoKXtcbiAgICAgICAgICAgICAgICAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJiYXJcIikuYXBwZW5kVG8oZWxlbWVudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIF9idWZmZXIoKXtcbiAgICAgICAgICAgICAgICAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJiYXJcIikuYXBwZW5kVG8oZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiYnVmZmVyXCIpLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBfbG9hZCgpe1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJ3aXRoLWxvYWRcIik7XG4gICAgICAgICAgICAgICAgJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiYmFyXCIpLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImJ1ZmZlclwiKS5hcHBlbmRUbyhlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJsb2FkXCIpLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBfbGluZSgpe1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJsaW5lXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzd2l0Y2ggKG8udHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJidWZmZXJcIjogX2J1ZmZlcigpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwibG9hZFwiOiBfbG9hZCgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwibGluZVwiOiBfbGluZSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBfcHJvZ3Jlc3MoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8udHlwZSAhPT0gJ2xpbmUnKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwidmFsdWVcIikuYWRkQ2xhc3Moby5jbHNWYWx1ZSkuYXBwZW5kVG8oZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgaWYgKG8udmFsdWVQb3NpdGlvbiA9PT0gXCJjZW50ZXJcIikgdmFsdWUuYWRkQ2xhc3MoXCJjZW50ZXJlZFwiKTtcbiAgICAgICAgICAgICAgICBpZiAoby5zaG93VmFsdWUgPT09IGZhbHNlKSB2YWx1ZS5oaWRlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLnNtYWxsID09PSB0cnVlKSBlbGVtZW50LmFkZENsYXNzKFwic21hbGxcIik7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3Moby5jbHNCYWNrKTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5iYXJcIikuYWRkQ2xhc3Moby5jbHNCYXIpO1xuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmJ1ZmZlclwiKS5hZGRDbGFzcyhvLmNsc0J1ZmZlcik7XG5cbiAgICAgICAgICAgIGlmIChvLnNob3dMYWJlbCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHZhciBsYWJlbCA9ICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJwcm9ncmVzcy1sYWJlbFwiKS5hZGRDbGFzcyhvLmNsc0xhYmVsKS5odG1sKG8ubGFiZWxUZW1wbGF0ZSA9PT0gXCJcIiA/IG8udmFsdWUrXCIlXCIgOiBvLmxhYmVsVGVtcGxhdGUucmVwbGFjZShcIiVWQUwlXCIsIG8udmFsdWUpKTtcbiAgICAgICAgICAgICAgICBpZiAoby5sYWJlbFBvc2l0aW9uID09PSAnYmVmb3JlJykge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbC5pbnNlcnRCZWZvcmUoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwuaW5zZXJ0QWZ0ZXIoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnZhbChvLnZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMuYnVmZihvLmJ1ZmZlcik7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInByb2dyZXNzLWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdmFsOiBmdW5jdGlvbih2KXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGVsZW1lbnQuZmluZChcIi52YWx1ZVwiKTtcblxuICAgICAgICAgICAgaWYgKHYgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGF0LnZhbHVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgYmFyICA9IGVsZW1lbnQuZmluZChcIi5iYXJcIik7XG5cbiAgICAgICAgICAgIGlmIChiYXIubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gcGFyc2VJbnQodiwgMTApO1xuXG4gICAgICAgICAgICBiYXIuY3NzKFwid2lkdGhcIiwgdGhpcy52YWx1ZSArIFwiJVwiKTtcbiAgICAgICAgICAgIHZhbHVlLmh0bWwodGhpcy52YWx1ZStcIiVcIik7XG5cbiAgICAgICAgICAgIHZhciBkaWZmID0gZWxlbWVudC53aWR0aCgpIC0gYmFyLndpZHRoKCk7XG4gICAgICAgICAgICB2YXIgdmFsdWVQb3NpdGlvbiA9IHZhbHVlLndpZHRoKCkgPiBkaWZmID8ge2xlZnQ6IFwiYXV0b1wiLCByaWdodDogZGlmZiArICdweCd9IDoge2xlZnQ6IHYgKyAnJSd9O1xuXG4gICAgICAgICAgICBpZiAoby52YWx1ZVBvc2l0aW9uID09PSBcImZyZWVcIikgdmFsdWUuY3NzKHZhbHVlUG9zaXRpb24pO1xuXG4gICAgICAgICAgICBpZiAoby5zaG93TGFiZWwgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGFiZWwgPSBlbGVtZW50W28ubGFiZWxQb3NpdGlvbiA9PT0gXCJiZWZvcmVcIiA/IFwicHJldlwiIDogXCJuZXh0XCJdKFwiLnByb2dyZXNzLWxhYmVsXCIpO1xuICAgICAgICAgICAgICAgIGlmIChsYWJlbC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwuaHRtbChvLmxhYmVsVGVtcGxhdGUgPT09IFwiXCIgPyBvLnZhbHVlK1wiJVwiIDogby5sYWJlbFRlbXBsYXRlLnJlcGxhY2UoXCIlVkFMJVwiLCBvLnZhbHVlKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJ2YWx1ZS1jaGFuZ2VcIiwge1xuICAgICAgICAgICAgICAgIHZhbDogdGhpcy52YWx1ZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlID09PSAxMDApIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImNvbXBsZXRlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsOiB0aGlzLnZhbHVlXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBidWZmOiBmdW5jdGlvbih2KXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgaWYgKHYgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGF0LmJ1ZmZlcjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGJhciAgPSBlbGVtZW50LmZpbmQoXCIuYnVmZmVyXCIpO1xuXG4gICAgICAgICAgICBpZiAoYmFyLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5idWZmZXIgPSBwYXJzZUludCh2LCAxMCk7XG5cbiAgICAgICAgICAgIGJhci5jc3MoXCJ3aWR0aFwiLCB0aGlzLmJ1ZmZlciArIFwiJVwiKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiYnVmZmVyLWNoYW5nZVwiLCB7XG4gICAgICAgICAgICAgICAgdmFsOiB0aGlzLmJ1ZmZlclxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmJ1ZmZlciA9PT0gMTAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiYnVmZmVyZWRcIiwge1xuICAgICAgICAgICAgICAgICAgICB2YWw6IHRoaXMuYnVmZmVyXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlVmFsdWU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLnZhbCh0aGlzLmVsZW1lbnQuYXR0cignZGF0YS12YWx1ZScpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VCdWZmZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmJ1ZmYodGhpcy5lbGVtZW50LmF0dHIoJ2RhdGEtYnVmZmVyJykpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSl7XG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdkYXRhLXZhbHVlJzogdGhpcy5jaGFuZ2VWYWx1ZSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdkYXRhLWJ1ZmZlcic6IHRoaXMuY2hhbmdlQnVmZmVyKCk7IGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgUmFkaW9EZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICByYWRpb0RlZmVycmVkOiAwLFxuICAgICAgICB0cmFuc2l0aW9uOiB0cnVlLFxuICAgICAgICBzdHlsZTogMSxcbiAgICAgICAgY2FwdGlvbjogXCJcIixcbiAgICAgICAgY2FwdGlvblBvc2l0aW9uOiBcInJpZ2h0XCIsXG4gICAgICAgIGNsc1JhZGlvOiBcIlwiLFxuICAgICAgICBjbHNDaGVjazogXCJcIixcbiAgICAgICAgY2xzQ2FwdGlvbjogXCJcIixcbiAgICAgICAgb25SYWRpb0NyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5yYWRpb1NldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgUmFkaW9EZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIFJhZGlvRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9SYWRpb1NldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8ucmFkaW9TZXR1cCh3aW5kb3dbXCJtZXRyb1JhZGlvU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgncmFkaW8nLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgUmFkaW9EZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgb3JpZ2luOiB7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJcIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVN0cnVjdHVyZSgpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlRXZlbnRzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInJhZGlvLWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVN0cnVjdHVyZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHJhZGlvID0gJChcIjxsYWJlbD5cIikuYWRkQ2xhc3MoXCJyYWRpbyBcIiArIGVsZW1lbnRbMF0uY2xhc3NOYW1lKS5hZGRDbGFzcyhvLnN0eWxlID09PSAyID8gXCJzdHlsZTJcIiA6IFwiXCIpO1xuICAgICAgICAgICAgdmFyIGNoZWNrID0gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcImNoZWNrXCIpO1xuICAgICAgICAgICAgdmFyIGNhcHRpb24gPSAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwiY2FwdGlvblwiKS5odG1sKG8uY2FwdGlvbik7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcInR5cGVcIiwgXCJyYWRpb1wiKTtcblxuICAgICAgICAgICAgcmFkaW8uaW5zZXJ0QmVmb3JlKGVsZW1lbnQpO1xuICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRUbyhyYWRpbyk7XG4gICAgICAgICAgICBjaGVjay5hcHBlbmRUbyhyYWRpbyk7XG4gICAgICAgICAgICBjYXB0aW9uLmFwcGVuZFRvKHJhZGlvKTtcblxuICAgICAgICAgICAgaWYgKG8udHJhbnNpdGlvbiA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHJhZGlvLmFkZENsYXNzKFwidHJhbnNpdGlvbi1vblwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uY2FwdGlvblBvc2l0aW9uID09PSAnbGVmdCcpIHtcbiAgICAgICAgICAgICAgICByYWRpby5hZGRDbGFzcyhcImNhcHRpb24tbGVmdFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5vcmlnaW4uY2xhc3NOYW1lID0gZWxlbWVudFswXS5jbGFzc05hbWU7XG4gICAgICAgICAgICBlbGVtZW50WzBdLmNsYXNzTmFtZSA9ICcnO1xuXG4gICAgICAgICAgICByYWRpby5hZGRDbGFzcyhvLmNsc1JhZGlvKTtcbiAgICAgICAgICAgIGNhcHRpb24uYWRkQ2xhc3Moby5jbHNDYXB0aW9uKTtcbiAgICAgICAgICAgIGNoZWNrLmFkZENsYXNzKG8uY2xzQ2hlY2spO1xuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5pcygnOmRpc2FibGVkJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmFibGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIGNoZWNrID0gZWxlbWVudC5zaWJsaW5ncyhcIi5jaGVja1wiKTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihcImZvY3VzXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgY2hlY2suYWRkQ2xhc3MoXCJmb2N1c2VkXCIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oXCJibHVyXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgY2hlY2sucmVtb3ZlQ2xhc3MoXCJmb2N1c2VkXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50KCkuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRpc2FibGVkXCIsIGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnQoKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZVN0YXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbS5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBwYXJlbnQgPSBlbGVtZW50LnBhcmVudCgpO1xuXG4gICAgICAgICAgICB2YXIgY2hhbmdlU3R5bGUgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBuZXdfc3R5bGUgPSBwYXJzZUludChlbGVtZW50LmF0dHIoXCJkYXRhLXN0eWxlXCIpKTtcblxuICAgICAgICAgICAgICAgIGlmICghVXRpbHMuaXNJbnQobmV3X3N0eWxlKSkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgby5zdHlsZSA9IG5ld19zdHlsZTtcbiAgICAgICAgICAgICAgICBwYXJlbnQucmVtb3ZlQ2xhc3MoXCJzdHlsZTEgc3R5bGUyXCIpLmFkZENsYXNzKFwic3R5bGVcIituZXdfc3R5bGUpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc3dpdGNoIChhdHRyaWJ1dGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnZGlzYWJsZWQnOiB0aGlzLnRvZ2dsZVN0YXRlKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2RhdGEtc3R5bGUnOiBjaGFuZ2VTdHlsZSgpOyBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIFJhdGluZ0RlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIHJhdGluZ0RlZmVycmVkOiAwLFxuICAgICAgICBsYWJlbDogXCJcIixcbiAgICAgICAgc3RhdGljOiBmYWxzZSxcbiAgICAgICAgdGl0bGU6IG51bGwsXG4gICAgICAgIHZhbHVlOiAwLFxuICAgICAgICB2YWx1ZXM6IG51bGwsXG4gICAgICAgIG1lc3NhZ2U6IFwiXCIsXG4gICAgICAgIHN0YXJzOiA1LFxuICAgICAgICBzdGFyQ29sb3I6IG51bGwsXG4gICAgICAgIHN0YXJlZENvbG9yOiBudWxsLFxuICAgICAgICByb3VuZEZ1bmM6IFwicm91bmRcIiwgLy8gY2VpbCwgZmxvb3IsIHJvdW5kXG4gICAgICAgIGhhbGY6IHRydWUsXG4gICAgICAgIGNsc1JhdGluZzogXCJcIixcbiAgICAgICAgY2xzVGl0bGU6IFwiXCIsXG4gICAgICAgIGNsc1N0YXJzOiBcIlwiLFxuICAgICAgICBjbHNSZXN1bHQ6IFwiXCIsXG4gICAgICAgIGNsc0xhYmVsOiBcIlwiLFxuICAgICAgICBvblN0YXJDbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25SYXRpbmdDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8ucmF0aW5nU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBSYXRpbmdEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIFJhdGluZ0RlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvUmF0aW5nU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5yYXRpbmdTZXR1cCh3aW5kb3dbXCJtZXRyb1JhdGluZ1NldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ3JhdGluZycsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBSYXRpbmdEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IDAsXG4gICAgICAgICAgICAgICAgb3JpZ2luVmFsdWU6IDAsXG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbXSxcbiAgICAgICAgICAgICAgICByYXRlOiAwLFxuICAgICAgICAgICAgICAgIHJhdGluZzogbnVsbFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBpO1xuXG4gICAgICAgICAgICBpZiAoaXNOYU4oby52YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICBvLnZhbHVlID0gMDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgby52YWx1ZSA9IHBhcnNlRmxvYXQoby52YWx1ZSkudG9GaXhlZCgxKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8udmFsdWVzICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoby52YWx1ZXMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWVzID0gby52YWx1ZXM7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygby52YWx1ZXMgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSBvLnZhbHVlcy50b0FycmF5KClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvcihpID0gMTsgaSA8PSBvLnN0YXJzOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZXMucHVzaChpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMub3JpZ2luVmFsdWUgPSBvLnZhbHVlO1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IG8udmFsdWUgPiAwID8gTWF0aFtvLnJvdW5kRnVuY10oby52YWx1ZSkgOiAwO1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVSYXRpbmcoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJyYXRpbmctY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlUmF0aW5nOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIHZhciBpZCA9IFV0aWxzLmVsZW1lbnRJZChcInJhdGluZ1wiKTtcbiAgICAgICAgICAgIHZhciByYXRpbmcgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJyYXRpbmcgXCIgKyBTdHJpbmcoZWxlbWVudFswXS5jbGFzc05hbWUpLnJlcGxhY2UoXCJkLWJsb2NrXCIsIFwiZC1mbGV4XCIpKS5hZGRDbGFzcyhvLmNsc1JhdGluZyk7XG4gICAgICAgICAgICB2YXIgaSwgc3RhcnMsIHJlc3VsdCwgbGk7XG4gICAgICAgICAgICB2YXIgc2hlZXQgPSBNZXRyby5zaGVldDtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IG8uc3RhdGljID8gTWF0aC5mbG9vcih0aGlzLm9yaWdpblZhbHVlKSA6IHRoaXMudmFsdWU7XG5cbiAgICAgICAgICAgIGVsZW1lbnQudmFsKHRoaXMudmFsdWUpO1xuXG4gICAgICAgICAgICByYXRpbmcuYXR0cihcImlkXCIsIGlkKTtcblxuICAgICAgICAgICAgcmF0aW5nLmluc2VydEJlZm9yZShlbGVtZW50KTtcbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kVG8ocmF0aW5nKTtcblxuICAgICAgICAgICAgc3RhcnMgPSAkKFwiPHVsPlwiKS5hZGRDbGFzcyhcInN0YXJzXCIpLmFkZENsYXNzKG8uY2xzU3RhcnMpLmFwcGVuZFRvKHJhdGluZyk7XG5cbiAgICAgICAgICAgIGZvcihpID0gMTsgaSA8PSBvLnN0YXJzOyBpKyspIHtcbiAgICAgICAgICAgICAgICBsaSA9ICQoXCI8bGk+XCIpLmRhdGEoXCJ2YWx1ZVwiLCB0aGlzLnZhbHVlc1tpLTFdKS5hcHBlbmRUbyhzdGFycyk7XG4gICAgICAgICAgICAgICAgaWYgKGkgPD0gdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgbGkuYWRkQ2xhc3MoXCJvblwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlc3VsdCA9ICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJyZXN1bHRcIikuYWRkQ2xhc3Moby5jbHNSZXN1bHQpLmFwcGVuZFRvKHJhdGluZyk7XG5cbiAgICAgICAgICAgIHJlc3VsdC5odG1sKG8ubWVzc2FnZSk7XG5cbiAgICAgICAgICAgIGlmIChvLnN0YXJDb2xvciAhPT0gbnVsbCAmJiBNZXRyby5jb2xvcnMuaXNDb2xvcihvLnN0YXJDb2xvcikpIHtcbiAgICAgICAgICAgICAgICBVdGlscy5hZGRDc3NSdWxlKHNoZWV0LCBcIiNcIiArIGlkICsgXCIgLnN0YXJzOmhvdmVyIGxpXCIsIFwiY29sb3I6IFwiICsgby5zdGFyQ29sb3IgKyBcIjtcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoby5zdGFyZWRDb2xvciAhPT0gbnVsbCAmJiBNZXRyby5jb2xvcnMuaXNDb2xvcihvLnN0YXJlZENvbG9yKSkge1xuICAgICAgICAgICAgICAgIFV0aWxzLmFkZENzc1J1bGUoc2hlZXQsIFwiI1wiK2lkK1wiIC5zdGFycyBsaS5vblwiLCBcImNvbG9yOiBcIitvLnN0YXJlZENvbG9yK1wiO1wiKTtcbiAgICAgICAgICAgICAgICBVdGlscy5hZGRDc3NSdWxlKHNoZWV0LCBcIiNcIitpZCtcIiAuc3RhcnMgbGkuaGFsZjo6YWZ0ZXJcIiwgXCJjb2xvcjogXCIrby5zdGFyZWRDb2xvcitcIjtcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLnRpdGxlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRpdGxlID0gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcInRpdGxlXCIpLmFkZENsYXNzKG8uY2xzVGl0bGUpLmh0bWwoby50aXRsZSk7XG4gICAgICAgICAgICAgICAgcmF0aW5nLnByZXBlbmQodGl0bGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5zdGF0aWMgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICByYXRpbmcuYWRkQ2xhc3MoXCJzdGF0aWNcIik7XG4gICAgICAgICAgICAgICAgaWYgKG8uaGFsZiA9PT0gdHJ1ZSl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkZWMgPSBNYXRoLnJvdW5kKCh0aGlzLm9yaWdpblZhbHVlICUgMSkgKiAxMCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkZWMgPiAwICYmIGRlYyA8PSA5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByYXRpbmcuZmluZCgnLnN0YXJzIGxpLm9uJykubGFzdCgpLm5leHQoXCJsaVwiKS5hZGRDbGFzcyhcImhhbGYgaGFsZi1cIiArICggZGVjICogMTApKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudFswXS5jbGFzc05hbWUgPSAnJztcbiAgICAgICAgICAgIGlmIChvLmNvcHlJbmxpbmVTdHlsZXMgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZWxlbWVudFswXS5zdHlsZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICByYXRpbmcuY3NzKGVsZW1lbnRbMF0uc3R5bGVbaV0sIGVsZW1lbnQuY3NzKGVsZW1lbnRbMF0uc3R5bGVbaV0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gJChcIjxsYWJlbD5cIikuYWRkQ2xhc3MoXCJsYWJlbC1mb3ItaW5wdXRcIikuYWRkQ2xhc3Moby5jbHNMYWJlbCkuaHRtbChvLmxhYmVsKS5pbnNlcnRCZWZvcmUocmF0aW5nKTtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5hdHRyKFwiaWRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwuYXR0cihcImZvclwiLCBlbGVtZW50LmF0dHIoXCJpZFwiKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmF0dHIoXCJkaXJcIikgPT09IFwicnRsXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwuYWRkQ2xhc3MoXCJydGxcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5pcyhcIjpkaXNhYmxlZFwiKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnJhdGluZyA9IHJhdGluZztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHJhdGluZyA9IHRoaXMucmF0aW5nO1xuXG4gICAgICAgICAgICByYXRpbmcub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5zdGFycyBsaVwiLCBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgaWYgKG8uc3RhdGljID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN0YXIgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHN0YXIuZGF0YShcInZhbHVlXCIpO1xuICAgICAgICAgICAgICAgIHN0YXIuYWRkQ2xhc3MoXCJzY2FsZVwiKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHN0YXIucmVtb3ZlQ2xhc3MoXCJzY2FsZVwiKTtcbiAgICAgICAgICAgICAgICB9LCAzMDApO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQudmFsKHZhbHVlKS50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuICAgICAgICAgICAgICAgIHN0YXIuYWRkQ2xhc3MoXCJvblwiKTtcbiAgICAgICAgICAgICAgICBzdGFyLnByZXZBbGwoKS5hZGRDbGFzcyhcIm9uXCIpO1xuICAgICAgICAgICAgICAgIHN0YXIubmV4dEFsbCgpLnJlbW92ZUNsYXNzKFwib25cIik7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJzdGFyLWNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBzdGFyOiBzdGFyWzBdXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHZhbDogZnVuY3Rpb24odil7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgcmF0aW5nID0gdGhpcy5yYXRpbmc7XG5cbiAgICAgICAgICAgIGlmICh2ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHYgPiAwID8gTWF0aFtvLnJvdW5kRnVuY10odikgOiAwO1xuICAgICAgICAgICAgZWxlbWVudC52YWwodGhpcy52YWx1ZSkudHJpZ2dlcihcImNoYW5nZVwiKTtcblxuICAgICAgICAgICAgdmFyIHN0YXJzID0gcmF0aW5nLmZpbmQoXCIuc3RhcnMgbGlcIikucmVtb3ZlQ2xhc3MoXCJvblwiKTtcbiAgICAgICAgICAgICQuZWFjaChzdGFycywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgc3RhciA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXIuZGF0YShcInZhbHVlXCIpIDw9IHRoYXQudmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgc3Rhci5hZGRDbGFzcyhcIm9uXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBtc2c6IGZ1bmN0aW9uKG0pe1xuICAgICAgICAgICAgdmFyIHJhdGluZyA9IHRoaXMucmF0aW5nO1xuICAgICAgICAgICAgaWYgKG0gPT09ICB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmF0aW5nLmZpbmQoXCIucmVzdWx0XCIpLmh0bWwobSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBzdGF0aWM6IGZ1bmN0aW9uIChtb2RlKSB7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciByYXRpbmcgPSB0aGlzLnJhdGluZztcblxuICAgICAgICAgICAgby5zdGF0aWMgPSBtb2RlO1xuXG4gICAgICAgICAgICBpZiAobW9kZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHJhdGluZy5hZGRDbGFzcyhcInN0YXRpY1wiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmF0aW5nLnJlbW92ZUNsYXNzKFwic3RhdGljXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZVZhbHVlOiBmdW5jdGlvbihhKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYSA9PT0gXCJ2YWx1ZVwiID8gZWxlbWVudC52YWwoKSA6IGVsZW1lbnQuYXR0cihcImRhdGEtdmFsdWVcIik7XG4gICAgICAgICAgICB0aGlzLnZhbCh2YWx1ZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlTWVzc2FnZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBlbGVtZW50LmF0dHIoXCJkYXRhLW1lc3NhZ2VcIik7XG4gICAgICAgICAgICB0aGlzLm1zZyhtZXNzYWdlKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGVTdGF0aWM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBpc1N0YXRpYyA9IEpTT04ucGFyc2UoZWxlbWVudC5hdHRyKFwiZGF0YS1zdGF0aWNcIikpID09PSB0cnVlO1xuXG4gICAgICAgICAgICB0aGlzLnN0YXRpYyhpc1N0YXRpYyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50KCkuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRpc2FibGVkXCIsIGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnQoKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZVN0YXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbS5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSl7XG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwidmFsdWVcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS12YWx1ZVwiOiB0aGlzLmNoYW5nZUF0dHJpYnV0ZVZhbHVlKGF0dHJpYnV0ZU5hbWUpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGlzYWJsZWRcIjogdGhpcy50b2dnbGVTdGF0ZSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1tZXNzYWdlXCI6IHRoaXMuY2hhbmdlQXR0cmlidXRlTWVzc2FnZSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1zdGF0aWNcIjogdGhpcy5jaGFuZ2VBdHRyaWJ1dGVTdGF0aWMoKTsgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIHJhdGluZyA9IHRoaXMucmF0aW5nO1xuXG4gICAgICAgICAgICByYXRpbmcub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuc3RhcnMgbGlcIik7XG5cbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgUmVzaXphYmxlRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgcmVzaXphYmxlRGVmZXJyZWQ6IDAsXG4gICAgICAgIGNhblJlc2l6ZTogdHJ1ZSxcbiAgICAgICAgcmVzaXplRWxlbWVudDogXCIucmVzaXplLWVsZW1lbnRcIixcbiAgICAgICAgbWluV2lkdGg6IDAsXG4gICAgICAgIG1pbkhlaWdodDogMCxcbiAgICAgICAgbWF4V2lkdGg6IDAsXG4gICAgICAgIG1heEhlaWdodDogMCxcbiAgICAgICAgcHJlc2VydmVSYXRpbzogZmFsc2UsXG4gICAgICAgIG9uUmVzaXplU3RhcnQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uUmVzaXplU3RvcDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25SZXNpemU6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uUmVzaXphYmxlQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLnJlc2l6YWJsZVNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgUmVzaXphYmxlRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBSZXNpemFibGVEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb1Jlc2l6YWJsZVNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8ucmVzaXphYmxlU2V0dXAod2luZG93W1wibWV0cm9SZXNpemFibGVTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdyZXNpemFibGUnLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgUmVzaXphYmxlRGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIHJlc2l6ZXI6IG51bGwsXG4gICAgICAgICAgICAgICAgaWQ6IFV0aWxzLmVsZW1lbnRJZChcInJlc2l6YWJsZVwiKVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJyZXNpemFibGUtY3JlYXRlXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgZWxlbWVudC5kYXRhKFwiY2FuUmVzaXplXCIsIHRydWUpO1xuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcInJlc2l6YWJsZS1lbGVtZW50XCIpO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLnJlc2l6ZUVsZW1lbnQpICYmIGVsZW1lbnQuZmluZChvLnJlc2l6ZUVsZW1lbnQpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2l6ZXIgPSBlbGVtZW50LmZpbmQoby5yZXNpemVFbGVtZW50KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNpemVyID0gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcInJlc2l6ZS1lbGVtZW50XCIpLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LmRhdGEoXCJjYW5SZXNpemVcIiwgby5jYW5SZXNpemUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIHRoaXMucmVzaXplci5vbihNZXRyby5ldmVudHMuc3RhcnQsIGZ1bmN0aW9uKGUpe1xuXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuZGF0YSgnY2FuUmVzaXplJykgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN0YXJ0WFkgPSBVdGlscy5wYWdlWFkoZSk7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXJ0V2lkdGggPSBwYXJzZUludChlbGVtZW50Lm91dGVyV2lkdGgoKSk7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXJ0SGVpZ2h0ID0gcGFyc2VJbnQoZWxlbWVudC5vdXRlckhlaWdodCgpKTtcbiAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IHt3aWR0aDogc3RhcnRXaWR0aCwgaGVpZ2h0OiBzdGFydEhlaWdodH07XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwic3RvcC1wb2ludGVyXCIpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwicmVzaXplLXN0YXJ0XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogc2l6ZVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkub24oTWV0cm8uZXZlbnRzLm1vdmUsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgbW92ZVhZID0gVXRpbHMucGFnZVhZKGUpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBzdGFydFdpZHRoICsgbW92ZVhZLnggLSBzdGFydFhZLngsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHN0YXJ0SGVpZ2h0ICsgbW92ZVhZLnkgLSBzdGFydFhZLnlcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoby5tYXhXaWR0aCA+IDAgJiYgc2l6ZS53aWR0aCA+IG8ubWF4V2lkdGgpIHtyZXR1cm4gdHJ1ZTt9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvLm1pbldpZHRoID4gMCAmJiBzaXplLndpZHRoIDwgby5taW5XaWR0aCkge3JldHVybiB0cnVlO31cblxuICAgICAgICAgICAgICAgICAgICBpZiAoby5tYXhIZWlnaHQgPiAwICYmIHNpemUuaGVpZ2h0ID4gby5tYXhIZWlnaHQpIHtyZXR1cm4gdHJ1ZTt9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvLm1pbkhlaWdodCA+IDAgJiYgc2l6ZS5oZWlnaHQgPCBvLm1pbkhlaWdodCkge3JldHVybiB0cnVlO31cblxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmNzcyhzaXplKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJyZXNpemVcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogc2l6ZVxuICAgICAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgfSwge25zOiB0aGF0LmlkfSk7XG5cbiAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vbihNZXRyby5ldmVudHMuc3RvcCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcyhcInN0b3AtcG9pbnRlclwiKTtcblxuICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vZmYoTWV0cm8uZXZlbnRzLm1vdmUsIHtuczogdGhhdC5pZH0pO1xuICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vZmYoTWV0cm8uZXZlbnRzLnN0b3AsIHtuczogdGhhdC5pZH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBzaXplID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHBhcnNlSW50KGVsZW1lbnQub3V0ZXJXaWR0aCgpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogcGFyc2VJbnQoZWxlbWVudC5vdXRlckhlaWdodCgpKVxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInJlc2l6ZS1zdG9wXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IHNpemVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9LCB7bnM6IHRoYXQuaWR9KTtcblxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBvZmY6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImNhblJlc2l6ZVwiLCBmYWxzZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb246IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImNhblJlc2l6ZVwiLCB0cnVlKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHJpYnV0ZU5hbWUpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIHZhciBjYW5SZXNpemUgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIG8uY2FuUmVzaXplID0gSlNPTi5wYXJzZShlbGVtZW50LmF0dHIoJ2RhdGEtY2FuLXJlc2l6ZScpKSA9PT0gdHJ1ZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHN3aXRjaCAoYXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLWNhbi1yZXNpemVcIjogY2FuUmVzaXplKCk7IGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLnJlc2l6ZXIub2ZmKE1ldHJvLmV2ZW50cy5zdGFydCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgUmVzaXplckRlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIHJlc2l6ZXJEZWZlcnJlZDogMCxcbiAgICAgICAgb25NZWRpYVBvaW50OiBNZXRyby5ub29wLFxuICAgICAgICBvbk1lZGlhUG9pbnRFbnRlcjogTWV0cm8ubm9vcCxcbiAgICAgICAgb25NZWRpYVBvaW50TGVhdmU6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uV2luZG93UmVzaXplOiBNZXRyby5ub29wLFxuICAgICAgICBvbkVsZW1lbnRSZXNpemU6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uUmVzaXplckNyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5yZXNpemVyU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBSZXNpemVyRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBSZXNpemVyRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9SZXNpemVyU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5yZXNpemVyU2V0dXAod2luZG93W1wibWV0cm9SZXNpemVyU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgncmVzaXplcicsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBSZXNpemVyRGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIHNpemU6IHt3aWR0aDogMCwgaGVpZ2h0OiAwfSxcbiAgICAgICAgICAgICAgICBtZWRpYTogd2luZG93Lk1FVFJPX01FRElBLFxuICAgICAgICAgICAgICAgIGlkOiBVdGlscy5lbGVtZW50SWQoXCJyZXNpemVyXCIpXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLnNpemUgPSB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IGVsZW1lbnQud2lkdGgoKSxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IGVsZW1lbnQuaGVpZ2h0KClcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVN0cnVjdHVyZSgpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlRXZlbnRzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInJlc2l6ZXItY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlU3RydWN0dXJlOiBmdW5jdGlvbigpe1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgd2luID0gJC53aW5kb3coKTtcblxuICAgICAgICAgICAgd2luLm9uKFwicmVzaXplXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIHdpbmRvd1dpZHRoID0gd2luLndpZHRoKCksIHdpbmRvd0hlaWdodCA9IHdpbi5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudFdpZHRoID0gZWxlbWVudC53aWR0aCgpLCBlbGVtZW50SGVpZ2h0ID0gZWxlbWVudC5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICB2YXIgb2xkU2l6ZSA9IHRoYXQuc2l6ZTtcbiAgICAgICAgICAgICAgICB2YXIgcG9pbnQ7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJ3aW5kb3ctcmVzaXplXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHdpbmRvd1dpZHRoLFxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHdpbmRvd0hlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgbWVkaWE6IHdpbmRvdy5NRVRST19NRURJQVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoYXQuc2l6ZS53aWR0aCAhPT0gZWxlbWVudFdpZHRoIHx8IHRoYXQuc2l6ZS5oZWlnaHQgIT09IGVsZW1lbnRIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5zaXplID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGVsZW1lbnRXaWR0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogZWxlbWVudEhlaWdodFxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImVsZW1lbnQtcmVzaXplXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBlbGVtZW50V2lkdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGVsZW1lbnRIZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRTaXplOiBvbGRTaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVkaWE6IHdpbmRvdy5NRVRST19NRURJQVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0aGF0Lm1lZGlhLmxlbmd0aCAhPT0gd2luZG93Lk1FVFJPX01FRElBLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5tZWRpYS5sZW5ndGggPiB3aW5kb3cuTUVUUk9fTUVESUEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludCA9IHRoYXQubWVkaWEuZmlsdGVyKGZ1bmN0aW9uKHgpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhd2luZG93Lk1FVFJPX01FRElBLmluY2x1ZGVzKHgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcIm1lZGlhLXBvaW50LWxlYXZlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogcG9pbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVkaWE6IHdpbmRvdy5NRVRST19NRURJQVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50ID0gd2luZG93Lk1FVFJPX01FRElBLmZpbHRlcihmdW5jdGlvbih4KXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIXRoYXQubWVkaWEuaW5jbHVkZXMoeCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwibWVkaWEtcG9pbnQtZW50ZXJcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiBwb2ludCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWRpYTogd2luZG93Lk1FVFJPX01FRElBXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQubWVkaWEgPSB3aW5kb3cuTUVUUk9fTUVESUE7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwibWVkaWEtcG9pbnRcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQ6IHBvaW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVkaWE6IHdpbmRvdy5NRVRST19NRURJQVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB7bnM6IHRoaXMuaWR9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICQod2luZG93KS5vZmYoXCJyZXNpemVcIiwge25zOiB0aGlzLmlkfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBSaWJib25NZW51RGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgcmliYm9ubWVudURlZmVycmVkOiAwLFxuICAgICAgICBvblN0YXRpYzogTWV0cm8ubm9vcCxcbiAgICAgICAgb25CZWZvcmVUYWI6IE1ldHJvLm5vb3BfdHJ1ZSxcbiAgICAgICAgb25UYWI6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uUmliYm9uTWVudUNyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5yaWJib25NZW51U2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBSaWJib25NZW51RGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBSaWJib25NZW51RGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9SaWJib25NZW51U2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5yaWJib25NZW51U2V0dXAod2luZG93W1wibWV0cm9SaWJib25NZW51U2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgncmliYm9uLW1lbnUnLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgUmliYm9uTWVudURlZmF1bHRDb25maWcpO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVN0cnVjdHVyZSgpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlRXZlbnRzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInJpYmJvbi1tZW51LWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVN0cnVjdHVyZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwicmliYm9uLW1lbnVcIik7XG5cbiAgICAgICAgICAgIHZhciB0YWJzID0gZWxlbWVudC5maW5kKFwiLnRhYnMtaG9sZGVyIGxpOm5vdCguc3RhdGljKVwiKTtcbiAgICAgICAgICAgIHZhciBhY3RpdmVfdGFiID0gZWxlbWVudC5maW5kKFwiLnRhYnMtaG9sZGVyIGxpLmFjdGl2ZVwiKTtcbiAgICAgICAgICAgIGlmIChhY3RpdmVfdGFiLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wZW4oJChhY3RpdmVfdGFiWzBdKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0YWJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuKCQodGFic1swXSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGZsdWVudEdyb3VwcyA9IGVsZW1lbnQuZmluZChcIi5yaWJib24tdG9nZ2xlLWdyb3VwXCIpO1xuICAgICAgICAgICAgJC5lYWNoKGZsdWVudEdyb3VwcywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgZyA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgZy5idXR0b25ncm91cCh7XG4gICAgICAgICAgICAgICAgICAgIGNsc0FjdGl2ZTogXCJhY3RpdmVcIlxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIGd3ID0gMDtcbiAgICAgICAgICAgICAgICB2YXIgYnRucyA9IGcuZmluZChcIi5yaWJib24taWNvbi1idXR0b25cIik7XG4gICAgICAgICAgICAgICAgJC5lYWNoKGJ0bnMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBiID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHcgPSBiLm91dGVyV2lkdGgodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh3ID4gZ3cpIGd3ID0gdztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGcuY3NzKFwid2lkdGhcIiwgZ3cgKiBNYXRoLmNlaWwoYnRucy5sZW5ndGggLyAzKSArIDQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLnRhYnMtaG9sZGVyIGxpIGFcIiwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgdmFyIGxpbmsgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIHZhciB0YWIgPSAkKHRoaXMpLnBhcmVudChcImxpXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRhYi5oYXNDbGFzcyhcInN0YXRpY1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoby5vblN0YXRpYyA9PT0gTWV0cm8ubm9vcCAmJiBsaW5rLmF0dHIoXCJocmVmXCIpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSBsaW5rLmF0dHIoXCJocmVmXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwic3RhdGljXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWI6IHRhYlswXVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoVXRpbHMuZXhlYyhvLm9uQmVmb3JlVGFiLCBbdGFiWzBdXSwgZWxlbWVudFswXSkgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQub3Blbih0YWJbMF0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG5cbiAgICAgICAgb3BlbjogZnVuY3Rpb24odGFiKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyICR0YWIgPSAkKHRhYik7XG4gICAgICAgICAgICB2YXIgdGFicyA9IGVsZW1lbnQuZmluZChcIi50YWJzLWhvbGRlciBsaVwiKTtcbiAgICAgICAgICAgIHZhciBzZWN0aW9ucyA9IGVsZW1lbnQuZmluZChcIi5jb250ZW50LWhvbGRlciAuc2VjdGlvblwiKTtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSAkdGFiLmNoaWxkcmVuKFwiYVwiKS5hdHRyKFwiaHJlZlwiKTtcbiAgICAgICAgICAgIHZhciB0YXJnZXRfc2VjdGlvbiA9IHRhcmdldCAhPT0gXCIjXCIgPyBlbGVtZW50LmZpbmQodGFyZ2V0KSA6IG51bGw7XG5cbiAgICAgICAgICAgIHRhYnMucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICAkdGFiLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuXG4gICAgICAgICAgICBzZWN0aW9ucy5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgIGlmICh0YXJnZXRfc2VjdGlvbikgdGFyZ2V0X3NlY3Rpb24uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInRhYlwiLCB7XG4gICAgICAgICAgICAgICAgdGFiOiAkdGFiWzBdXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi50YWJzLWhvbGRlciBsaSBhXCIpO1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBSaXBwbGVEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICByaXBwbGVEZWZlcnJlZDogMCxcbiAgICAgICAgcmlwcGxlQ29sb3I6IFwiI2ZmZlwiLFxuICAgICAgICByaXBwbGVBbHBoYTogLjQsXG4gICAgICAgIHJpcHBsZVRhcmdldDogXCJkZWZhdWx0XCIsXG4gICAgICAgIG9uUmlwcGxlQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLnJpcHBsZVNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgUmlwcGxlRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBSaXBwbGVEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb1JpcHBsZVNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8ucmlwcGxlU2V0dXAod2luZG93W1wibWV0cm9SaXBwbGVTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgdmFyIGdldFJpcHBsZSA9IGZ1bmN0aW9uKHRhcmdldCwgY29sb3IsIGFscGhhLCBldmVudCl7XG4gICAgICAgIHZhciBlbCA9ICQodGFyZ2V0KTtcbiAgICAgICAgdmFyIHJlY3QgPSBVdGlscy5yZWN0KGVsWzBdKTtcbiAgICAgICAgdmFyIHgsIHk7XG4gICAgICAgIHZhciBDb2xvcnMgPSBNZXRyby5jb2xvcnM7XG5cbiAgICAgICAgaWYgKGVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZShjb2xvcikpIHtcbiAgICAgICAgICAgIGNvbG9yID0gXCIjZmZmXCI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUoYWxwaGEpKSB7XG4gICAgICAgICAgICBhbHBoYSA9IC40O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVsLmNzcygncG9zaXRpb24nKSA9PT0gJ3N0YXRpYycpIHtcbiAgICAgICAgICAgIGVsLmNzcygncG9zaXRpb24nLCAncmVsYXRpdmUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsLmNzcyh7XG4gICAgICAgICAgICBvdmVyZmxvdzogJ2hpZGRlbidcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJChcIi5yaXBwbGVcIikucmVtb3ZlKCk7XG5cbiAgICAgICAgdmFyIHNpemUgPSBNYXRoLm1heChlbC5vdXRlcldpZHRoKCksIGVsLm91dGVySGVpZ2h0KCkpO1xuXG4gICAgICAgIC8vIEFkZCB0aGUgZWxlbWVudFxuICAgICAgICB2YXIgcmlwcGxlID0gJChcIjxzcGFuIGNsYXNzPSdyaXBwbGUnPjwvc3Bhbj5cIikuY3NzKHtcbiAgICAgICAgICAgIHdpZHRoOiBzaXplLFxuICAgICAgICAgICAgaGVpZ2h0OiBzaXplXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGVsLnByZXBlbmQocmlwcGxlKTtcblxuICAgICAgICBpZiAoZXZlbnQpIHtcbiAgICAgICAgICAgIC8vIEdldCB0b3VjaCBwb2ludCB4LCB5XG4gICAgICAgICAgICB4ID0gZXZlbnQucGFnZVggLSBlbC5vZmZzZXQoKS5sZWZ0IC0gcmlwcGxlLndpZHRoKCkvMjtcbiAgICAgICAgICAgIHkgPSBldmVudC5wYWdlWSAtIGVsLm9mZnNldCgpLnRvcCAtIHJpcHBsZS5oZWlnaHQoKS8yO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gR2V0IHRoZSBjZW50ZXIgb2YgdGhlIGVsZW1lbnRcbiAgICAgICAgICAgIHggPSByZWN0LndpZHRoIC8gMiAtIHJpcHBsZS53aWR0aCgpLzI7XG4gICAgICAgICAgICB5ID0gcmVjdC5oZWlnaHQgLyAyIC0gcmlwcGxlLmhlaWdodCgpLzI7XG4gICAgICAgIH1cblxuICAgICAgICByaXBwbGUuY3NzKHtcbiAgICAgICAgICAgIGJhY2tncm91bmQ6IENvbG9ycy50b1JHQkEoY29sb3IsIGFscGhhKSxcbiAgICAgICAgICAgIHdpZHRoOiBzaXplLFxuICAgICAgICAgICAgaGVpZ2h0OiBzaXplLFxuICAgICAgICAgICAgdG9wOiB5ICsgJ3B4JyxcbiAgICAgICAgICAgIGxlZnQ6IHggKyAncHgnXG4gICAgICAgIH0pLmFkZENsYXNzKFwicmlwcGxlRWZmZWN0XCIpO1xuXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJpcHBsZS5yZW1vdmUoKTtcbiAgICAgICAgfSwgNDAwKTtcbiAgICB9O1xuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdyaXBwbGUnLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgUmlwcGxlRGVmYXVsdENvbmZpZyk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gby5yaXBwbGVUYXJnZXQgPT09ICdkZWZhdWx0JyA/IG51bGwgOiBvLnJpcHBsZVRhcmdldDtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIHRhcmdldCwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZ2V0UmlwcGxlKHRoaXMsIG8ucmlwcGxlQ29sb3IsIG8ucmlwcGxlQWxwaGEsIGUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInJpb3BwbGUtY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHJpYnV0ZU5hbWUpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNoYW5nZUNvbG9yKCl7XG4gICAgICAgICAgICAgICAgdmFyIGNvbG9yID0gZWxlbWVudC5hdHRyKFwiZGF0YS1yaXBwbGUtY29sb3JcIik7XG4gICAgICAgICAgICAgICAgaWYgKCFNZXRyby5jb2xvcnMuaXNDb2xvcihjb2xvcikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBvLnJpcHBsZUNvbG9yID0gY29sb3I7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNoYW5nZUFscGhhKCl7XG4gICAgICAgICAgICAgICAgdmFyIGFscGhhID0gK2VsZW1lbnQuYXR0cihcImRhdGEtcmlwcGxlLWFscGhhXCIpO1xuICAgICAgICAgICAgICAgIGlmIChpc05hTihhbHBoYSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBvLnJpcHBsZUNvbG9yID0gYWxwaGE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHN3aXRjaCAoYXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLXJpcHBsZS1jb2xvclwiOiBjaGFuZ2VDb2xvcigpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1yaXBwbGUtYWxwaGFcIjogY2hhbmdlQWxwaGEoKTsgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IG8ucmlwcGxlVGFyZ2V0ID09PSAnZGVmYXVsdCcgPyBudWxsIDogby5yaXBwbGVUYXJnZXQ7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuY2xpY2ssIHRhcmdldCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIE1ldHJvLnJpcHBsZSA9IGdldFJpcHBsZTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuLyogZXNsaW50LWRpc2FibGUgKi9cbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBTZWFyY2hlckRlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIG9uU2VhcmNoZXJDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uc2VhcmNoZXJTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIFNlYXJjaGVyRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBTZWFyY2hlckRlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvU2VhcmNoZXJTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLnNlYXJjaGVyU2V0dXAod2luZG93W1wibWV0cm9TZWFyY2hlclNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ3NlYXJjaGVyJywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIFNlYXJjaGVyRGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIC8vIGRlZmluZSBpbnN0YW5jZSB2YXJzIGhlcmVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KCdzZWFyY2hlci1jcmVhdGUnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlU3RydWN0dXJlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0ciwgbmV3VmFsdWUpe1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xuLyogZXNsaW50LWVuYWJsZSAqL1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBTZWxlY3REZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBsYWJlbDogXCJcIixcbiAgICAgICAgc2l6ZTogXCJub3JtYWxcIixcbiAgICAgICAgc2VsZWN0RGVmZXJyZWQ6IDAsXG4gICAgICAgIGNsZWFyQnV0dG9uOiBmYWxzZSxcbiAgICAgICAgY2xlYXJCdXR0b25JY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tY3Jvc3MnPjwvc3Bhbj5cIixcbiAgICAgICAgdXNlUGxhY2Vob2xkZXI6IGZhbHNlLFxuICAgICAgICBwbGFjZWhvbGRlcjogXCJcIixcbiAgICAgICAgYWRkRW1wdHlWYWx1ZTogZmFsc2UsXG4gICAgICAgIGVtcHR5VmFsdWU6IFwiXCIsXG4gICAgICAgIGR1cmF0aW9uOiAwLFxuICAgICAgICBwcmVwZW5kOiBcIlwiLFxuICAgICAgICBhcHBlbmQ6IFwiXCIsXG4gICAgICAgIGZpbHRlclBsYWNlaG9sZGVyOiBcIlNlYXJjaC4uLlwiLFxuICAgICAgICBmaWx0ZXI6IHRydWUsXG4gICAgICAgIGNvcHlJbmxpbmVTdHlsZXM6IGZhbHNlLFxuICAgICAgICBkcm9wSGVpZ2h0OiAyMDAsXG4gICAgICAgIGRyb3BXaWR0aDogbnVsbCxcbiAgICAgICAgZHJvcEZ1bGxTaXplOiBmYWxzZSxcbiAgICAgICAgY2hlY2tEcm9wVXA6IHRydWUsXG4gICAgICAgIGRyb3BVcDogZmFsc2UsXG4gICAgICAgIHNob3dHcm91cE5hbWU6IGZhbHNlLFxuICAgICAgICBzaG9ydFRhZzogdHJ1ZSxcblxuICAgICAgICBjbHNTZWxlY3Q6IFwiXCIsXG4gICAgICAgIGNsc1NlbGVjdElucHV0OiBcIlwiLFxuICAgICAgICBjbHNQcmVwZW5kOiBcIlwiLFxuICAgICAgICBjbHNBcHBlbmQ6IFwiXCIsXG4gICAgICAgIGNsc09wdGlvbjogXCJcIixcbiAgICAgICAgY2xzT3B0aW9uQWN0aXZlOiBcIlwiLFxuICAgICAgICBjbHNPcHRpb25Hcm91cDogXCJcIixcbiAgICAgICAgY2xzRHJvcExpc3Q6IFwiXCIsXG4gICAgICAgIGNsc0Ryb3BDb250YWluZXI6IFwiXCIsXG4gICAgICAgIGNsc1NlbGVjdGVkSXRlbTogXCJcIixcbiAgICAgICAgY2xzU2VsZWN0ZWRJdGVtUmVtb3ZlcjogXCJcIixcbiAgICAgICAgY2xzTGFiZWw6IFwiXCIsXG4gICAgICAgIGNsc0dyb3VwTmFtZTogXCJcIixcblxuICAgICAgICBvbkNsZWFyOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNoYW5nZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25VcDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Ecm9wOiBNZXRyby5ub29wLFxuICAgICAgICBvbkl0ZW1TZWxlY3Q6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uSXRlbURlc2VsZWN0OiBNZXRyby5ub29wLFxuICAgICAgICBvblNlbGVjdENyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5zZWxlY3RTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIFNlbGVjdERlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgU2VsZWN0RGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9TZWxlY3RTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLnNlbGVjdFNldHVwKHdpbmRvd1tcIm1ldHJvU2VsZWN0U2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnc2VsZWN0Jywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIFNlbGVjdERlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICBsaXN0OiBudWxsLFxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBudWxsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTZWxlY3QoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJzZWxlY3QtY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfc2V0UGxhY2Vob2xkZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBpbnB1dCA9IGVsZW1lbnQuc2libGluZ3MoXCIuc2VsZWN0LWlucHV0XCIpO1xuICAgICAgICAgICAgaWYgKG8udXNlUGxhY2Vob2xkZXIgPT09IHRydWUgJiYgKCFVdGlscy5pc1ZhbHVlKGVsZW1lbnQudmFsKCkpIHx8IGVsZW1lbnQudmFsKCkgPT0gby5lbXB0eVZhbHVlKSkge1xuICAgICAgICAgICAgICAgIGlucHV0Lmh0bWwodGhpcy5wbGFjZWhvbGRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2FkZFRhZzogZnVuY3Rpb24odmFsLCBkYXRhKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHRhZywgdGFnU2l6ZSwgY29udGFpbmVyID0gZWxlbWVudC5jbG9zZXN0KFwiLnNlbGVjdFwiKTtcbiAgICAgICAgICAgIHRhZyA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInRhZ1wiKS5hZGRDbGFzcyhvLnNob3J0VGFnID8gXCJzaG9ydC10YWdcIiA6IFwiXCIpLmFkZENsYXNzKG8uY2xzU2VsZWN0ZWRJdGVtKS5odG1sKFwiPHNwYW4gY2xhc3M9J3RpdGxlJz5cIit2YWwrXCI8L3NwYW4+XCIpLmRhdGEoXCJvcHRpb25cIiwgZGF0YSk7XG4gICAgICAgICAgICAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwicmVtb3ZlclwiKS5hZGRDbGFzcyhvLmNsc1NlbGVjdGVkSXRlbVJlbW92ZXIpLmh0bWwoXCImdGltZXM7XCIpLmFwcGVuZFRvKHRhZyk7XG5cbiAgICAgICAgICAgIGlmIChjb250YWluZXIuaGFzQ2xhc3MoXCJpbnB1dC1sYXJnZVwiKSkge1xuICAgICAgICAgICAgICAgIHRhZ1NpemUgPSBcImxhcmdlXCI7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRhaW5lci5oYXNDbGFzcyhcImlucHV0LXNtYWxsXCIpKSB7XG4gICAgICAgICAgICAgICAgdGFnU2l6ZSA9IFwic21hbGxcIlxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0YWcuYWRkQ2xhc3ModGFnU2l6ZSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0YWc7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2FkZE9wdGlvbjogZnVuY3Rpb24oaXRlbSwgcGFyZW50LCBpbnB1dCwgbXVsdGlwbGUsIGdyb3VwKXtcbiAgICAgICAgICAgIHZhciBvcHRpb24gPSAkKGl0ZW0pO1xuICAgICAgICAgICAgdmFyIGwsIGE7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBodG1sID0gVXRpbHMuaXNWYWx1ZShvcHRpb24uYXR0cignZGF0YS10ZW1wbGF0ZScpKSA/IG9wdGlvbi5hdHRyKCdkYXRhLXRlbXBsYXRlJykucmVwbGFjZShcIiQxXCIsIGl0ZW0udGV4dCk6aXRlbS50ZXh0O1xuICAgICAgICAgICAgdmFyIGRpc3BsYXlWYWx1ZSA9IG9wdGlvbi5hdHRyKFwiZGF0YS1kaXNwbGF5XCIpO1xuXG4gICAgICAgICAgICBsID0gJChcIjxsaT5cIikuYWRkQ2xhc3Moby5jbHNPcHRpb24pLmRhdGEoXCJvcHRpb25cIiwgaXRlbSkuYXR0cihcImRhdGEtdGV4dFwiLCBpdGVtLnRleHQpLmF0dHIoJ2RhdGEtdmFsdWUnLCBpdGVtLnZhbHVlID8gaXRlbS52YWx1ZSA6IFwiXCIpO1xuICAgICAgICAgICAgYSA9ICQoXCI8YT5cIikuaHRtbChodG1sKTtcblxuICAgICAgICAgICAgaWYgKGRpc3BsYXlWYWx1ZSkge1xuICAgICAgICAgICAgICAgIGwuYXR0cihcImRhdGEtZGlzcGxheVwiLCBkaXNwbGF5VmFsdWUpO1xuICAgICAgICAgICAgICAgIGh0bWwgPSBkaXNwbGF5VmFsdWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGwuYWRkQ2xhc3MoaXRlbS5jbGFzc05hbWUpO1xuXG4gICAgICAgICAgICBsLmRhdGEoXCJncm91cFwiLCBncm91cCk7XG5cbiAgICAgICAgICAgIGlmIChvcHRpb24uaXMoXCI6ZGlzYWJsZWRcIikpIHtcbiAgICAgICAgICAgICAgICBsLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvcHRpb24uaXMoXCI6c2VsZWN0ZWRcIikpIHtcblxuICAgICAgICAgICAgICAgIGlmIChvLnNob3dHcm91cE5hbWUgJiYgZ3JvdXApIHtcbiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSBcIiZuYnNwOzxzcGFuIGNsYXNzPSdzZWxlY3RlZC1pdGVtX19ncm91cC1uYW1lIFwiK28uY2xzR3JvdXBOYW1lK1wiJz5cIiArIGdyb3VwICsgXCI8L3NwYW4+XCI7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG11bHRpcGxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGwuYWRkQ2xhc3MoXCJkLW5vbmVcIik7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0LmFwcGVuZCh0aGlzLl9hZGRUYWcoaHRtbCwgbCkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudmFsKGl0ZW0udmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC5odG1sKGh0bWwpO1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpcmUoXCJjaGFuZ2VcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiBpdGVtLnZhbHVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBsLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbC5hcHBlbmQoYSkuYXBwZW5kVG8ocGFyZW50KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfYWRkT3B0aW9uR3JvdXA6IGZ1bmN0aW9uKGl0ZW0sIHBhcmVudCwgaW5wdXQsIG11bHRpcGxlKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBncm91cCA9ICQoaXRlbSk7XG5cbiAgICAgICAgICAgICQoXCI8bGk+XCIpLmh0bWwoaXRlbS5sYWJlbCkuYWRkQ2xhc3MoXCJncm91cC10aXRsZVwiKS5hZGRDbGFzcyhvLmNsc09wdGlvbkdyb3VwKS5hcHBlbmRUbyhwYXJlbnQpO1xuXG4gICAgICAgICAgICAkLmVhY2goZ3JvdXAuY2hpbGRyZW4oKSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0Ll9hZGRPcHRpb24odGhpcywgcGFyZW50LCBpbnB1dCwgbXVsdGlwbGUsIGl0ZW0ubGFiZWwpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlT3B0aW9uczogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucywgc2VsZWN0ID0gZWxlbWVudC5wYXJlbnQoKTtcbiAgICAgICAgICAgIHZhciBsaXN0ID0gc2VsZWN0LmZpbmQoXCJ1bFwiKS5lbXB0eSgpO1xuICAgICAgICAgICAgdmFyIHNlbGVjdGVkID0gZWxlbWVudC5maW5kKFwib3B0aW9uW3NlbGVjdGVkXVwiKS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgdmFyIG11bHRpcGxlID0gZWxlbWVudFswXS5tdWx0aXBsZTtcbiAgICAgICAgICAgIHZhciBpbnB1dCA9IGVsZW1lbnQuc2libGluZ3MoXCIuc2VsZWN0LWlucHV0XCIpO1xuXG4gICAgICAgICAgICBlbGVtZW50LnNpYmxpbmdzKFwiLnNlbGVjdC1pbnB1dFwiKS5lbXB0eSgpO1xuXG4gICAgICAgICAgICBpZiAoby5hZGRFbXB0eVZhbHVlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5wcmVwZW5kKCQoXCI8b3B0aW9uIFwiKyghc2VsZWN0ZWQgPyAnc2VsZWN0ZWQnIDogJycpK1wiIHZhbHVlPSdcIitvLmVtcHR5VmFsdWUrXCInIGNsYXNzPSdkLW5vbmUnPjwvb3B0aW9uPlwiKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICQuZWFjaChlbGVtZW50LmNoaWxkcmVuKCksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudGFnTmFtZSA9PT0gXCJPUFRJT05cIikge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9hZGRPcHRpb24odGhpcywgbGlzdCwgaW5wdXQsIG11bHRpcGxlLCBudWxsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudGFnTmFtZSA9PT0gXCJPUFRHUk9VUFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2FkZE9wdGlvbkdyb3VwKHRoaXMsIGxpc3QsIGlucHV0LCBtdWx0aXBsZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVNlbGVjdDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9ICQoXCI8bGFiZWw+XCIpLmFkZENsYXNzKFwic2VsZWN0IFwiICsgZWxlbWVudFswXS5jbGFzc05hbWUpLmFkZENsYXNzKG8uY2xzU2VsZWN0KTtcbiAgICAgICAgICAgIHZhciBtdWx0aXBsZSA9IGVsZW1lbnRbMF0ubXVsdGlwbGU7XG4gICAgICAgICAgICB2YXIgc2VsZWN0X2lkID0gVXRpbHMuZWxlbWVudElkKFwic2VsZWN0XCIpO1xuICAgICAgICAgICAgdmFyIGJ1dHRvbnMgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJidXR0b24tZ3JvdXBcIik7XG4gICAgICAgICAgICB2YXIgaW5wdXQsIGRyb3BfY29udGFpbmVyLCBkcm9wX2NvbnRhaW5lcl9pbnB1dCwgbGlzdCwgZmlsdGVyX2lucHV0LCBkcm9wZG93bl90b2dnbGU7XG4gICAgICAgICAgICB2YXIgY2hlY2tib3hJRCA9IFV0aWxzLmVsZW1lbnRJZChcInNlbGVjdC1mb2N1cy10cmlnZ2VyXCIpO1xuICAgICAgICAgICAgdmFyIGNoZWNrYm94ID0gJChcIjxpbnB1dCB0eXBlPSdjaGVja2JveCc+XCIpLmFkZENsYXNzKFwic2VsZWN0LWZvY3VzLXRyaWdnZXJcIikuYXR0cihcImlkXCIsIGNoZWNrYm94SUQpO1xuXG4gICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcInBsYWNlaG9sZGVyXCIpLmh0bWwoby5wbGFjZWhvbGRlcik7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5hdHRyKFwiaWRcIiwgc2VsZWN0X2lkKS5hdHRyKFwiZm9yXCIsIGNoZWNrYm94SUQpO1xuICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwiaW5wdXQtXCIgKyBvLnNpemUpO1xuXG4gICAgICAgICAgICBkcm9wZG93bl90b2dnbGUgPSAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwiZHJvcGRvd24tdG9nZ2xlXCIpO1xuICAgICAgICAgICAgZHJvcGRvd25fdG9nZ2xlLmFwcGVuZFRvKGNvbnRhaW5lcik7XG5cbiAgICAgICAgICAgIGlmIChtdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcIm11bHRpcGxlXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKGVsZW1lbnQpO1xuICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRUbyhjb250YWluZXIpO1xuICAgICAgICAgICAgYnV0dG9ucy5hcHBlbmRUbyhjb250YWluZXIpO1xuICAgICAgICAgICAgY2hlY2tib3guYXBwZW5kVG8oY29udGFpbmVyKTtcblxuICAgICAgICAgICAgaW5wdXQgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJzZWxlY3QtaW5wdXRcIikuYWRkQ2xhc3Moby5jbHNTZWxlY3RJbnB1dCkuYXR0cihcIm5hbWVcIiwgXCJfX1wiICsgc2VsZWN0X2lkICsgXCJfX1wiKTtcbiAgICAgICAgICAgIGRyb3BfY29udGFpbmVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiZHJvcC1jb250YWluZXJcIikuYWRkQ2xhc3Moby5jbHNEcm9wQ29udGFpbmVyKTtcblxuICAgICAgICAgICAgaWYgKG8uZHJvcEZ1bGxTaXplID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIGlmIChvLmRyb3BXaWR0aCkge1xuICAgICAgICAgICAgICAgICAgICBkcm9wX2NvbnRhaW5lci5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICtvLmRyb3BXaWR0aFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwiZHJvcC1mdWxsLXNpemVcIilcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZHJvcF9jb250YWluZXJfaW5wdXQgPSAkKFwiPGRpdj5cIikuYXBwZW5kVG8oZHJvcF9jb250YWluZXIpO1xuICAgICAgICAgICAgbGlzdCA9ICQoXCI8dWw+XCIpLmFkZENsYXNzKFwib3B0aW9uLWxpc3RcIikuYWRkQ2xhc3Moby5jbHNEcm9wTGlzdCkuY3NzKHtcbiAgICAgICAgICAgICAgICBcIm1heC1oZWlnaHRcIjogby5kcm9wSGVpZ2h0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGZpbHRlcl9pbnB1dCA9ICQoXCI8aW5wdXQgdHlwZT0ndGV4dCcgZGF0YS1yb2xlPSdpbnB1dCc+XCIpLmF0dHIoXCJwbGFjZWhvbGRlclwiLCBvLmZpbHRlclBsYWNlaG9sZGVyKS5hcHBlbmRUbyhkcm9wX2NvbnRhaW5lcl9pbnB1dCk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmQoaW5wdXQpO1xuICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZChkcm9wX2NvbnRhaW5lcik7XG5cbiAgICAgICAgICAgIGRyb3BfY29udGFpbmVyLmFwcGVuZChkcm9wX2NvbnRhaW5lcl9pbnB1dCk7XG5cbiAgICAgICAgICAgIGlmIChvLmZpbHRlciAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGRyb3BfY29udGFpbmVyX2lucHV0LmhpZGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZHJvcF9jb250YWluZXIuYXBwZW5kKGxpc3QpO1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVPcHRpb25zKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX3NldFBsYWNlaG9sZGVyKCk7XG5cbiAgICAgICAgICAgIE1ldHJvLm1ha2VQbHVnaW4oZHJvcF9jb250YWluZXIsIFwiZHJvcGRvd25cIiwge1xuICAgICAgICAgICAgICAgIGRyb3BGaWx0ZXI6IFwiLnNlbGVjdFwiLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBvLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgIHRvZ2dsZUVsZW1lbnQ6IFtjb250YWluZXJdLFxuICAgICAgICAgICAgICAgIGNoZWNrRHJvcFVwOiBvLmNoZWNrRHJvcFVwLFxuICAgICAgICAgICAgICAgIGRyb3BVcDogby5kcm9wVXAsXG4gICAgICAgICAgICAgICAgb25Ecm9wOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgZHJvcHBlZCwgdGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICBkcm9wZG93bl90b2dnbGUuYWRkQ2xhc3MoXCJhY3RpdmUtdG9nZ2xlXCIpO1xuICAgICAgICAgICAgICAgICAgICBkcm9wcGVkID0gJChcIi5zZWxlY3QgLmRyb3AtY29udGFpbmVyXCIpO1xuICAgICAgICAgICAgICAgICAgICAkLmVhY2goZHJvcHBlZCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkcm9wID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkcm9wLmlzKGRyb3BfY29udGFpbmVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YURyb3AgPSBNZXRyby5nZXRQbHVnaW4oZHJvcCwgJ2Ryb3Bkb3duJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YURyb3AgJiYgZGF0YURyb3AuY2xvc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhRHJvcC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfaW5wdXQudmFsKFwiXCIpLnRyaWdnZXIoTWV0cm8uZXZlbnRzLmtleXVwKTsvLy5mb2N1cygpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldCA9IGxpc3QuZmluZChcImxpLmFjdGl2ZVwiKS5sZW5ndGggPiAwID8gJChsaXN0LmZpbmQoXCJsaS5hY3RpdmVcIilbMF0pIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RbMF0uc2Nyb2xsVG9wID0gdGFyZ2V0LnBvc2l0aW9uKCkudG9wIC0gKCAobGlzdC5oZWlnaHQoKSAtIHRhcmdldC5oZWlnaHQoKSApLyAyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImRyb3BcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdDogbGlzdFswXVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uVXA6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duX3RvZ2dsZS5yZW1vdmVDbGFzcyhcImFjdGl2ZS10b2dnbGVcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwidXBcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdDogbGlzdFswXVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5saXN0ID0gbGlzdDtcblxuICAgICAgICAgICAgaWYgKG8uY2xlYXJCdXR0b24gPT09IHRydWUgJiYgIWVsZW1lbnRbMF0ucmVhZE9ubHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2xlYXJCdXR0b24gPSAkKFwiPGJ1dHRvbj5cIikuYWRkQ2xhc3MoXCJidXR0b24gaW5wdXQtY2xlYXItYnV0dG9uXCIpLmFkZENsYXNzKG8uY2xzQ2xlYXJCdXR0b24pLmF0dHIoXCJ0YWJpbmRleFwiLCAtMSkuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIikuaHRtbChvLmNsZWFyQnV0dG9uSWNvbik7XG4gICAgICAgICAgICAgICAgY2xlYXJCdXR0b24uYXBwZW5kVG8oYnV0dG9ucyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGJ1dHRvbnMuYWRkQ2xhc3MoXCJkLW5vbmVcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLnByZXBlbmQgIT09IFwiXCIgJiYgIW11bHRpcGxlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByZXBlbmQgPSAkKFwiPGRpdj5cIikuaHRtbChvLnByZXBlbmQpO1xuICAgICAgICAgICAgICAgIHByZXBlbmQuYWRkQ2xhc3MoXCJwcmVwZW5kXCIpLmFkZENsYXNzKG8uY2xzUHJlcGVuZCkuYXBwZW5kVG8oY29udGFpbmVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uYXBwZW5kICE9PSBcIlwiICYmICFtdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgIHZhciBhcHBlbmQgPSAkKFwiPGRpdj5cIikuaHRtbChvLmFwcGVuZCk7XG4gICAgICAgICAgICAgICAgYXBwZW5kLmFkZENsYXNzKFwiYXBwZW5kXCIpLmFkZENsYXNzKG8uY2xzQXBwZW5kKS5hcHBlbmRUbyhjb250YWluZXIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5jb3B5SW5saW5lU3R5bGVzID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBlbGVtZW50WzBdLnN0eWxlLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuY3NzKGVsZW1lbnRbMF0uc3R5bGVbaV0sIGVsZW1lbnQuY3NzKGVsZW1lbnRbMF0uc3R5bGVbaV0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChlbGVtZW50LmF0dHIoJ2RpcicpID09PSAncnRsJyApIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJydGxcIikuYXR0cihcImRpclwiLCBcInJ0bFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8ubGFiZWwpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGFiZWwgPSAkKFwiPGxhYmVsPlwiKS5hZGRDbGFzcyhcImxhYmVsLWZvci1pbnB1dFwiKS5hZGRDbGFzcyhvLmNsc0xhYmVsKS5odG1sKG8ubGFiZWwpLmluc2VydEJlZm9yZShjb250YWluZXIpO1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmF0dHIoXCJpZFwiKSkge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbC5hdHRyKFwiZm9yXCIsIGVsZW1lbnQuYXR0cihcImlkXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuYXR0cihcImRpclwiKSA9PT0gXCJydGxcIikge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbC5hZGRDbGFzcyhcInJ0bFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChlbGVtZW50LmlzKCc6ZGlzYWJsZWQnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBlbGVtZW50LmNsb3Nlc3QoXCIuc2VsZWN0XCIpO1xuICAgICAgICAgICAgdmFyIGRyb3BfY29udGFpbmVyID0gY29udGFpbmVyLmZpbmQoXCIuZHJvcC1jb250YWluZXJcIik7XG4gICAgICAgICAgICB2YXIgaW5wdXQgPSBlbGVtZW50LnNpYmxpbmdzKFwiLnNlbGVjdC1pbnB1dFwiKTtcbiAgICAgICAgICAgIHZhciBmaWx0ZXJfaW5wdXQgPSBkcm9wX2NvbnRhaW5lci5maW5kKFwiaW5wdXRcIik7XG4gICAgICAgICAgICB2YXIgbGlzdCA9IGRyb3BfY29udGFpbmVyLmZpbmQoXCJ1bFwiKTtcbiAgICAgICAgICAgIHZhciBjbGVhckJ1dHRvbiA9IGNvbnRhaW5lci5maW5kKFwiLmlucHV0LWNsZWFyLWJ1dHRvblwiKTtcbiAgICAgICAgICAgIHZhciBjaGVja2JveCA9IGNvbnRhaW5lci5maW5kKFwiLnNlbGVjdC1mb2N1cy10cmlnZ2VyXCIpO1xuXG4gICAgICAgICAgICBjaGVja2JveC5vbihcImZvY3VzXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwiZm9jdXNlZFwiKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjaGVja2JveC5vbihcImJsdXJcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBjb250YWluZXIucmVtb3ZlQ2xhc3MoXCJmb2N1c2VkXCIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNsZWFyQnV0dG9uLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZWxlbWVudC52YWwoby5lbXB0eVZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudFswXS5tdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgICAgICBsaXN0LmZpbmQoXCJsaVwiKS5yZW1vdmVDbGFzcyhcImQtbm9uZVwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpbnB1dC5jbGVhcigpO1xuICAgICAgICAgICAgICAgIHRoYXQuX3NldFBsYWNlaG9sZGVyKCk7XG5cbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImNsZWFyXCIpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImNoYW5nZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiB0aGF0LmdldFNlbGVjdGVkKClcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jaGFuZ2UsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5fc2V0UGxhY2Vob2xkZXIoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXIub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICQoXCIuZm9jdXNlZFwiKS5yZW1vdmVDbGFzcyhcImZvY3VzZWRcIik7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwiZm9jdXNlZFwiKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpbnB1dC5vbihNZXRyby5ldmVudHMuY2xpY2ssIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgJChcIi5mb2N1c2VkXCIpLnJlbW92ZUNsYXNzKFwiZm9jdXNlZFwiKTtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJmb2N1c2VkXCIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGxpc3Qub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcImxpXCIsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKFwiZ3JvdXAtdGl0bGVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgbGVhZiA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgdmFyIGRpc3BsYXlWYWx1ZSA9IGxlYWYuYXR0cihcImRhdGEtZGlzcGxheVwiKTtcbiAgICAgICAgICAgICAgICB2YXIgdmFsID0gbGVhZi5kYXRhKCd2YWx1ZScpO1xuICAgICAgICAgICAgICAgIHZhciBncm91cCA9IGxlYWYuZGF0YSgnZ3JvdXAnKTtcbiAgICAgICAgICAgICAgICB2YXIgaHRtbCA9IGRpc3BsYXlWYWx1ZSA/IGRpc3BsYXlWYWx1ZSA6IGxlYWYuY2hpbGRyZW4oJ2EnKS5odG1sKCk7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkO1xuICAgICAgICAgICAgICAgIHZhciBvcHRpb24gPSBsZWFmLmRhdGEoXCJvcHRpb25cIik7XG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBlbGVtZW50LmZpbmQoXCJvcHRpb25cIik7XG5cbiAgICAgICAgICAgICAgICBpZiAoby5zaG93R3JvdXBOYW1lICYmIGdyb3VwKSB7XG4gICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gXCImbmJzcDs8c3BhbiBjbGFzcz0nc2VsZWN0ZWQtaXRlbV9fZ3JvdXAtbmFtZSBcIitvLmNsc0dyb3VwTmFtZStcIic+XCIgKyBncm91cCArIFwiPC9zcGFuPlwiO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50WzBdLm11bHRpcGxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGxlYWYuYWRkQ2xhc3MoXCJkLW5vbmVcIik7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0LmFwcGVuZCh0aGF0Ll9hZGRUYWcoaHRtbCwgbGVhZikpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxpc3QuZmluZChcImxpLmFjdGl2ZVwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKS5yZW1vdmVDbGFzcyhvLmNsc09wdGlvbkFjdGl2ZSk7XG4gICAgICAgICAgICAgICAgICAgIGxlYWYuYWRkQ2xhc3MoXCJhY3RpdmVcIikuYWRkQ2xhc3Moby5jbHNPcHRpb25BY3RpdmUpO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC5odG1sKGh0bWwpO1xuICAgICAgICAgICAgICAgICAgICBNZXRyby5nZXRQbHVnaW4oZHJvcF9jb250YWluZXIsIFwiZHJvcGRvd25cIikuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkLmVhY2gob3B0aW9ucywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMgPT09IG9wdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcIml0ZW0tc2VsZWN0XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsOiB2YWwsXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbjogb3B0aW9uLFxuICAgICAgICAgICAgICAgICAgICBsZWFmOiBsZWFmWzBdXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzZWxlY3RlZCA9IHRoYXQuZ2V0U2VsZWN0ZWQoKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImNoYW5nZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBzZWxlY3RlZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlucHV0Lm9uKFwiY2xpY2tcIiwgXCIudGFnIC5yZW1vdmVyXCIsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gJCh0aGlzKS5jbG9zZXN0KFwiLnRhZ1wiKTtcbiAgICAgICAgICAgICAgICB2YXIgbGVhZiA9IGl0ZW0uZGF0YShcIm9wdGlvblwiKTtcbiAgICAgICAgICAgICAgICB2YXIgb3B0aW9uID0gbGVhZi5kYXRhKCdvcHRpb24nKTtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWQ7XG5cbiAgICAgICAgICAgICAgICBsZWFmLnJlbW92ZUNsYXNzKFwiZC1ub25lXCIpO1xuICAgICAgICAgICAgICAgICQuZWFjaChlbGVtZW50LmZpbmQoXCJvcHRpb25cIiksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzID09PSBvcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGl0ZW0ucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJpdGVtLWRlc2VsZWN0XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uOiBvcHRpb25cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNlbGVjdGVkID0gdGhhdC5nZXRTZWxlY3RlZCgpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiY2hhbmdlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHNlbGVjdGVkXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBmaWx0ZXJfaW5wdXQub24oTWV0cm8uZXZlbnRzLmtleXVwLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBmaWx0ZXIgPSB0aGlzLnZhbHVlLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgdmFyIGxpID0gbGlzdC5maW5kKFwibGlcIik7XG4gICAgICAgICAgICAgICAgdmFyIGksIGE7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgkKGxpW2ldKS5oYXNDbGFzcyhcImdyb3VwLXRpdGxlXCIpKSBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgYSA9IGxpW2ldLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiYVwiKVswXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGEuaW5uZXJIVE1MLnRvVXBwZXJDYXNlKCkuaW5kZXhPZihmaWx0ZXIpID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpW2ldLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGlbaV0uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGZpbHRlcl9pbnB1dC5vbihNZXRyby5ldmVudHMuY2xpY2ssIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGRyb3BfY29udGFpbmVyLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBkaXNhYmxlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmRhdGEoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5jbG9zZXN0KFwiLnNlbGVjdFwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGVuYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwiZGlzYWJsZWRcIiwgZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmNsb3Nlc3QoXCIuc2VsZWN0XCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlU3RhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiAodGhpcy5lbGVtLmRpc2FibGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKHRvX2RlZmF1bHQpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IGVsZW1lbnQuZmluZChcIm9wdGlvblwiKTtcbiAgICAgICAgICAgIHZhciBzZWxlY3QgPSBlbGVtZW50LmNsb3Nlc3QoJy5zZWxlY3QnKTtcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZDtcblxuICAgICAgICAgICAgJC5lYWNoKG9wdGlvbnMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9ICFVdGlscy5pc051bGwodG9fZGVmYXVsdCkgPyB0aGlzLmRlZmF1bHRTZWxlY3RlZCA6IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMubGlzdC5maW5kKFwibGlcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICBzZWxlY3QuZmluZChcIi5zZWxlY3QtaW5wdXRcIikuaHRtbCgnJyk7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZU9wdGlvbnMoKTtcblxuICAgICAgICAgICAgc2VsZWN0ZWQgPSB0aGlzLmdldFNlbGVjdGVkKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImNoYW5nZVwiLCB7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHNlbGVjdGVkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRTZWxlY3RlZDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xuXG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCJvcHRpb25cIikuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkKSByZXN1bHQucHVzaCh0aGlzLnZhbHVlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9LFxuXG4gICAgICAgIHZhbDogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBpbnB1dCA9IGVsZW1lbnQuc2libGluZ3MoXCIuc2VsZWN0LWlucHV0XCIpO1xuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBlbGVtZW50LmZpbmQoXCJvcHRpb25cIik7XG4gICAgICAgICAgICB2YXIgbGlzdF9pdGVtcyA9IHRoaXMubGlzdC5maW5kKFwibGlcIik7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgICAgICAgICB2YXIgbXVsdGlwbGUgPSBlbGVtZW50LmF0dHIoXCJtdWx0aXBsZVwiKSAhPT0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdmFyIG9wdGlvbjtcbiAgICAgICAgICAgIHZhciBpLCBodG1sLCBsaXN0X2l0ZW0sIG9wdGlvbl92YWx1ZSwgc2VsZWN0ZWQsIGdyb3VwO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNOdWxsKHZhbCkpIHtcbiAgICAgICAgICAgICAgICAkLmVhY2gob3B0aW9ucywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWQpIHJlc3VsdC5wdXNoKHRoaXMudmFsdWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBtdWx0aXBsZSA/IHJlc3VsdCA6IHJlc3VsdFswXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJC5lYWNoKG9wdGlvbnMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBsaXN0X2l0ZW1zLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpLnJlbW92ZUNsYXNzKG8uY2xzT3B0aW9uQWN0aXZlKTtcbiAgICAgICAgICAgIGlucHV0Lmh0bWwoJycpO1xuXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWwpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHZhbCAgPSBbdmFsXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJC5lYWNoKHZhbCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb24gPSBvcHRpb25zW2ldO1xuICAgICAgICAgICAgICAgICAgICBodG1sID0gVXRpbHMuaXNWYWx1ZShvcHRpb24uZ2V0QXR0cmlidXRlKCdkYXRhLXRlbXBsYXRlJykpID8gb3B0aW9uLmdldEF0dHJpYnV0ZSgnZGF0YS10ZW1wbGF0ZScpLnJlcGxhY2UoXCIkMVwiLCBvcHRpb24udGV4dCkgOiBvcHRpb24udGV4dDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFwiXCIrb3B0aW9uLnZhbHVlID09PSBcIlwiK3RoaXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGZvcihpID0gMDsgaSA8IGxpc3RfaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgbGlzdF9pdGVtID0gJChsaXN0X2l0ZW1zW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXAgPSBsaXN0X2l0ZW0uZGF0YShcImdyb3VwXCIpO1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25fdmFsdWUgPSBsaXN0X2l0ZW0uYXR0cihcImRhdGEtdmFsdWVcIik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChcIlwiK29wdGlvbl92YWx1ZSA9PT0gXCJcIit0aGlzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvLnNob3dHcm91cE5hbWUgJiYgZ3JvdXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sICs9IFwiJm5ic3A7PHNwYW4gY2xhc3M9J3NlbGVjdGVkLWl0ZW1fX2dyb3VwLW5hbWUnPlwiICsgZ3JvdXAgKyBcIjwvc3Bhbj5cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG11bHRpcGxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdF9pdGVtLmFkZENsYXNzKFwiZC1ub25lXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LmFwcGVuZCh0aGF0Ll9hZGRUYWcoaHRtbCwgbGlzdF9pdGVtKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0YWcgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJ0YWdcIikuYWRkQ2xhc3Moby5jbHNTZWxlY3RlZEl0ZW0pLmh0bWwoXCI8c3BhbiBjbGFzcz0ndGl0bGUnPlwiK2h0bWwrXCI8L3NwYW4+XCIpLmFwcGVuZFRvKGlucHV0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0YWcuZGF0YShcIm9wdGlvblwiLCBsaXN0X2l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJyZW1vdmVyXCIpLmFkZENsYXNzKG8uY2xzU2VsZWN0ZWRJdGVtUmVtb3ZlcikuaHRtbChcIiZ0aW1lcztcIikuYXBwZW5kVG8odGFnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdF9pdGVtLmFkZENsYXNzKFwiYWN0aXZlXCIpLmFkZENsYXNzKG8uY2xzT3B0aW9uQWN0aXZlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5odG1sKGh0bWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc2VsZWN0ZWQgPSB0aGlzLmdldFNlbGVjdGVkKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImNoYW5nZVwiLCB7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHNlbGVjdGVkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBvcHRpb25zOiBmdW5jdGlvbihvcCwgc2VsZWN0ZWQsIGRlbGltaXRlcil7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhKG9wLCBzZWxlY3RlZCwgZGVsaW1pdGVyKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkYXRhOiBmdW5jdGlvbihvcCwgc2VsZWN0ZWQsIGRlbGltaXRlcil7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBvcHRpb25fZ3JvdXAsIF9zZWxlY3RlZDtcbiAgICAgICAgICAgIHZhciBfZGVsaW1pdGVyID0gZGVsaW1pdGVyIHx8IFwiLFwiO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIHNlbGVjdGVkID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgX3NlbGVjdGVkID0gc2VsZWN0ZWQudG9BcnJheShfZGVsaW1pdGVyKS5tYXAoZnVuY3Rpb24odil7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpc05hTih2KSA/IHYgOiArdjtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShzZWxlY3RlZCkpIHtcbiAgICAgICAgICAgICAgICBfc2VsZWN0ZWQgPSBzZWxlY3RlZC5zbGljZSgpLm1hcChmdW5jdGlvbih2KXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzTmFOKHYpID8gdiA6ICt2O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBfc2VsZWN0ZWQgPSBbXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5lbXB0eSgpO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIG9wID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuaHRtbChvcCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKFV0aWxzLmlzT2JqZWN0MihvcCkpIHtcbiAgICAgICAgICAgICAgICAkLmVhY2gob3AsIGZ1bmN0aW9uKGtleSwgdmFsKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzT2JqZWN0Mih2YWwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25fZ3JvdXAgPSAkKFwiPG9wdGdyb3VwIGxhYmVsPScnPlwiKS5hdHRyKFwibGFiZWxcIiwga2V5KS5hcHBlbmRUbyhlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaCh2YWwsIGZ1bmN0aW9uKGtleTIsIHZhbDIpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcCA9ICQoXCI8b3B0aW9uPlwiKS5hdHRyKFwidmFsdWVcIiwga2V5MikudGV4dCh2YWwyKS5hcHBlbmRUbyhvcHRpb25fZ3JvdXApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfc2VsZWN0ZWQuaW5kZXhPZigra2V5MikgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcC5wcm9wKFwic2VsZWN0ZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3AgPSAkKFwiPG9wdGlvbj5cIikuYXR0cihcInZhbHVlXCIsIGtleSkudGV4dCh2YWwpLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9zZWxlY3RlZC5pbmRleE9mKGtleSkgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wLnByb3AoXCJzZWxlY3RlZFwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVPcHRpb25zKCk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFkZE9wdGlvbjogZnVuY3Rpb24odmFsLCB0aXRsZSwgc2VsZWN0ZWQpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgb3B0aW9uID0gJChcIjxvcHRpb24+XCIpLmF0dHIoXCJ2YWx1ZVwiLCB2YWwpLnRleHQodGl0bGUgPyB0aXRsZSA6IHZhbClcblxuICAgICAgICAgICAgZWxlbWVudC5hcHBlbmQob3B0aW9uKVxuXG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICBvcHRpb24ucHJvcChcInNlbGVjdGVkXCIsIHRydWUpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZU9wdGlvbnMoKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYWRkT3B0aW9uczogZnVuY3Rpb24odmFsdWVzKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgaWYgKCF2YWx1ZXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWVzKSkge1xuICAgICAgICAgICAgICAgICQuZWFjaCh2YWx1ZXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgaWYgKE1ldHJvLnV0aWxzLmlzT2JqZWN0MihvKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5hZGRPcHRpb24oby52YWwsIG8udGl0bGUsIG8uc2VsZWN0ZWQpXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmFkZE9wdGlvbihvKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoTWV0cm8udXRpbHMuaXNPYmplY3QyKHZhbHVlcykpIHtcbiAgICAgICAgICAgICAgICAkLmVhY2godmFsdWVzLCBmdW5jdGlvbihrZXksIHZhbCl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuYWRkT3B0aW9uKGtleSwgdmFsKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICByZW1vdmVPcHRpb246IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBvcHRpb25zID0gZWxlbWVudC5maW5kKFwib3B0aW9uXCIpXG5cbiAgICAgICAgICAgIG9wdGlvbnMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciAkZWwgPSAkKHRoaXMpXG5cbiAgICAgICAgICAgICAgICBpZiAoJGVsLmF0dHIoXCJ2YWx1ZVwiKSA9PSB2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgJGVsLnJlbW92ZSgpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlT3B0aW9ucygpO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICByZW1vdmVPcHRpb25zOiBmdW5jdGlvbih2YWx1ZXMpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IGVsZW1lbnQuZmluZChcIm9wdGlvblwiKVxuXG4gICAgICAgICAgICBpZiAoIXZhbHVlcyB8fCAhQXJyYXkuaXNBcnJheSh2YWx1ZXMpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG9wdGlvbnMuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciAkZWwgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIHZhciB2YWwgPSAkZWwuYXR0cihcInZhbHVlXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlcy5pbmRleE9mKHZhbCkgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICAkZWwucmVtb3ZlKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVPcHRpb25zKCk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSl7XG4gICAgICAgICAgICBpZiAoYXR0cmlidXRlTmFtZSA9PT0gJ2Rpc2FibGVkJykge1xuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlU3RhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgY29udGFpbmVyID0gZWxlbWVudC5jbG9zZXN0KFwiLnNlbGVjdFwiKTtcbiAgICAgICAgICAgIHZhciBkcm9wX2NvbnRhaW5lciA9IGNvbnRhaW5lci5maW5kKFwiLmRyb3AtY29udGFpbmVyXCIpO1xuICAgICAgICAgICAgdmFyIGlucHV0ID0gZWxlbWVudC5zaWJsaW5ncyhcIi5zZWxlY3QtaW5wdXRcIik7XG4gICAgICAgICAgICB2YXIgZmlsdGVyX2lucHV0ID0gZHJvcF9jb250YWluZXIuZmluZChcImlucHV0XCIpO1xuICAgICAgICAgICAgdmFyIGxpc3QgPSBkcm9wX2NvbnRhaW5lci5maW5kKFwidWxcIik7XG4gICAgICAgICAgICB2YXIgY2xlYXJCdXR0b24gPSBjb250YWluZXIuZmluZChcIi5pbnB1dC1jbGVhci1idXR0b25cIik7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5pbnB1dC1jbGVhci1idXR0b25cIik7XG4gICAgICAgICAgICBpbnB1dC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrKTtcbiAgICAgICAgICAgIGZpbHRlcl9pbnB1dC5vZmYoTWV0cm8uZXZlbnRzLmJsdXIpO1xuICAgICAgICAgICAgZmlsdGVyX2lucHV0Lm9mZihNZXRyby5ldmVudHMuZm9jdXMpO1xuICAgICAgICAgICAgbGlzdC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcImxpXCIpO1xuICAgICAgICAgICAgZmlsdGVyX2lucHV0Lm9mZihNZXRyby5ldmVudHMua2V5dXApO1xuICAgICAgICAgICAgZHJvcF9jb250YWluZXIub2ZmKE1ldHJvLmV2ZW50cy5jbGljayk7XG4gICAgICAgICAgICBjbGVhckJ1dHRvbi5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrKTtcblxuICAgICAgICAgICAgZHJvcF9jb250YWluZXIuZGF0YShcImRyb3Bkb3duXCIpLmRlc3Ryb3koKTtcblxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgICQoZG9jdW1lbnQpLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oKXtcbiAgICAgICAgJChcIi5zZWxlY3RcIikucmVtb3ZlQ2xhc3MoXCJmb2N1c2VkXCIpO1xuICAgIH0sIHtuczogXCJibHVyLXNlbGVjdC1lbGVtZW50c1wifSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgU2lkZWJhckRlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIG1lbnVTY3JvbGxiYXI6IGZhbHNlLFxuICAgICAgICBzaWRlYmFyRGVmZXJyZWQ6IDAsXG4gICAgICAgIHNoYWRvdzogdHJ1ZSxcbiAgICAgICAgcG9zaXRpb246IFwibGVmdFwiLFxuICAgICAgICBzaXplOiAyOTAsXG4gICAgICAgIHNoaWZ0OiBudWxsLFxuICAgICAgICBzdGF0aWNTaGlmdDogbnVsbCxcbiAgICAgICAgdG9nZ2xlOiBudWxsLFxuICAgICAgICBkdXJhdGlvbjogTUVUUk9fQU5JTUFUSU9OX0RVUkFUSU9OLFxuICAgICAgICBzdGF0aWM6IG51bGwsXG4gICAgICAgIG1lbnVJdGVtQ2xpY2s6IHRydWUsXG4gICAgICAgIGNsb3NlT3V0c2lkZTogdHJ1ZSxcbiAgICAgICAgb25PcGVuOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNsb3NlOiBNZXRyby5ub29wLFxuICAgICAgICBvblRvZ2dsZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25TdGF0aWNTZXQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uU3RhdGljTG9zczogTWV0cm8ubm9vcCxcbiAgICAgICAgb25TaWRlYmFyQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLnNpZGViYXJTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIFNpZGViYXJEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIFNpZGViYXJEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb1NpZGViYXJTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLnNpZGViYXJTZXR1cCh3aW5kb3dbXCJtZXRyb1NpZGViYXJTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCdzaWRlYmFyJywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIFNpZGViYXJEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgdG9nZ2xlX2VsZW1lbnQ6IG51bGwsXG4gICAgICAgICAgICAgICAgaWQ6IFV0aWxzLmVsZW1lbnRJZCgnc2lkZWJhcicpXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuICAgICAgICAgICAgJCh3aW5kb3cpLnJlc2l6ZSgpO1xuICAgICAgICAgICAgdGhpcy5fY2hlY2tTdGF0aWMoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwic2lkZWJhci1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBoZWFkZXIgPSBlbGVtZW50LmZpbmQoXCIuc2lkZWJhci1oZWFkZXJcIik7XG4gICAgICAgICAgICB2YXIgc2hlZXQgPSBNZXRyby5zaGVldDtcbiAgICAgICAgICAgIHZhciBtZW51ID0gZWxlbWVudC5maW5kKFwiLnNpZGViYXItbWVudVwiKTtcblxuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcInNpZGViYXJcIikuYWRkQ2xhc3MoXCJvbi1cIitvLnBvc2l0aW9uKTtcblxuICAgICAgICAgICAgaWYgKG8ubWVudVNjcm9sbGJhciA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBtZW51LmFkZENsYXNzKFwiaGlkZS1zY3JvbGxcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLnNpemUgIT09IDI5MCkge1xuICAgICAgICAgICAgICAgIFV0aWxzLmFkZENzc1J1bGUoc2hlZXQsIFwiLnNpZGViYXJcIiwgXCJ3aWR0aDogXCIgKyBvLnNpemUgKyBcInB4O1wiKTtcblxuICAgICAgICAgICAgICAgIGlmIChvLnBvc2l0aW9uID09PSBcImxlZnRcIikge1xuICAgICAgICAgICAgICAgICAgICBVdGlscy5hZGRDc3NSdWxlKHNoZWV0LCBcIi5zaWRlYmFyLm9uLWxlZnRcIiwgXCJsZWZ0OiBcIiArIC1vLnNpemUgKyBcInB4O1wiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBVdGlscy5hZGRDc3NSdWxlKHNoZWV0LCBcIi5zaWRlYmFyLm9uLXJpZ2h0XCIsIFwicmlnaHQ6IFwiICsgLW8uc2l6ZSArIFwicHg7XCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uc2hhZG93ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcInNpZGViYXItc2hhZG93XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby50b2dnbGUgIT09IG51bGwgJiYgJChvLnRvZ2dsZSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlX2VsZW1lbnQgPSAkKG8udG9nZ2xlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGhlYWRlci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKGhlYWRlci5kYXRhKFwiaW1hZ2VcIikgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXIuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogXCJ1cmwoXCIraGVhZGVyLmRhdGEoXCJpbWFnZVwiKStcIilcIlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLnN0YXRpYyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmIChvLnN0YXRpY1NoaWZ0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvLnBvc2l0aW9uID09PSAnbGVmdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLmFkZENzc1J1bGUoc2hlZXQsIFwiQG1lZGlhIHNjcmVlbiBhbmQgXCIgKyBNZXRyby5tZWRpYV9xdWVyaWVzW28uc3RhdGljLnRvVXBwZXJDYXNlKCldLCBvLnN0YXRpY1NoaWZ0ICsgXCJ7bWFyZ2luLWxlZnQ6IFwiICsgby5zaXplICsgXCJweDsgd2lkdGg6IGNhbGMoMTAwJSAtIFwiICsgby5zaXplICsgXCJweCk7fVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLmFkZENzc1J1bGUoc2hlZXQsIFwiQG1lZGlhIHNjcmVlbiBhbmQgXCIgKyBNZXRyby5tZWRpYV9xdWVyaWVzW28uc3RhdGljLnRvVXBwZXJDYXNlKCldLCBvLnN0YXRpY1NoaWZ0ICsgXCJ7bWFyZ2luLXJpZ2h0OiBcIiArIG8uc2l6ZSArIFwicHg7IHdpZHRoOiBjYWxjKDEwMCUgLSBcIiArIG8uc2l6ZSArIFwicHgpO31cIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciB0b2dnbGUgPSB0aGlzLnRvZ2dsZV9lbGVtZW50O1xuXG4gICAgICAgICAgICBpZiAodG9nZ2xlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdG9nZ2xlLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQudG9nZ2xlKCk7XG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG8udG9nZ2xlKSB7XG4gICAgICAgICAgICAgICAgJC5kb2N1bWVudCgpLm9uKFwiY2xpY2tcIiwgby50b2dnbGUsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQudG9nZ2xlKCk7XG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uc3RhdGljICE9PSBudWxsICYmIFtcImZzXCIsIFwic21cIiwgXCJtZFwiLCBcImxnXCIsIFwieGxcIiwgXCJ4eGxcIl0uaW5kZXhPZihvLnN0YXRpYykgPiAtMSkge1xuICAgICAgICAgICAgICAgICQod2luZG93KS5vbihNZXRyby5ldmVudHMucmVzaXplLGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2NoZWNrU3RhdGljKCk7XG4gICAgICAgICAgICAgICAgfSwge25zOiB0aGlzLmlkfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLm1lbnVJdGVtQ2xpY2sgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuc2lkZWJhci1tZW51IGxpID4gYVwiLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuc2lkZWJhci1tZW51IC5qcy1zaWRlYmFyLWNsb3NlXCIsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIHRoYXQuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAoby5jbG9zZU91dHNpZGUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQuaXNPcGVuKCkpIHRoYXQuY2xvc2UoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NoZWNrU3RhdGljOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICBpZiAoVXRpbHMubWVkaWFFeGlzdChvLnN0YXRpYykgJiYgIWVsZW1lbnQuaGFzQ2xhc3MoXCJzdGF0aWNcIikpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwic3RhdGljXCIpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuZGF0YShcIm9wZW5lZFwiLCBmYWxzZSkucmVtb3ZlQ2xhc3MoJ29wZW4nKTtcbiAgICAgICAgICAgICAgICBpZiAoby5zaGlmdCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAkLmVhY2goby5zaGlmdC5zcGxpdChcIixcIiksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmF3OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cjogby5kdXJhdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInN0YXRpYy1zZXRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIVV0aWxzLm1lZGlhRXhpc3Qoby5zdGF0aWMpKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcyhcInN0YXRpY1wiKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJzdGF0aWMtbG9zc1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpc09wZW46IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmRhdGEoXCJvcGVuZWRcIikgPT09IHRydWU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb3BlbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5oYXNDbGFzcyhcInN0YXRpY1wiKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnQuZGF0YShcIm9wZW5lZFwiLCB0cnVlKS5hZGRDbGFzcygnb3BlbicpO1xuXG4gICAgICAgICAgICBpZiAoby5zaGlmdCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICQoby5zaGlmdClcbiAgICAgICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGVsZW1lbnQub3V0ZXJXaWR0aCgpXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZHVyOiBvLmR1cmF0aW9uXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJvcGVuXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNsb3NlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmIChlbGVtZW50Lmhhc0NsYXNzKFwic3RhdGljXCIpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5kYXRhKFwib3BlbmVkXCIsIGZhbHNlKS5yZW1vdmVDbGFzcygnb3BlbicpO1xuXG4gICAgICAgICAgICBpZiAoby5zaGlmdCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICQoby5zaGlmdClcbiAgICAgICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IDBcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBkdXI6IG8uZHVyYXRpb25cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImNsb3NlXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzT3BlbigpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wZW4oKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwidG9nZ2xlXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgdG9nZ2xlID0gdGhpcy50b2dnbGVfZWxlbWVudDtcblxuICAgICAgICAgICAgaWYgKHRvZ2dsZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRvZ2dsZS5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uc3RhdGljICE9PSBudWxsICYmIFtcImZzXCIsIFwic21cIiwgXCJtZFwiLCBcImxnXCIsIFwieGxcIiwgXCJ4eGxcIl0uaW5kZXhPZihvLnN0YXRpYykgPiAtMSkge1xuICAgICAgICAgICAgICAgICQod2luZG93KS5vZmYoTWV0cm8uZXZlbnRzLnJlc2l6ZSwge25zOiB0aGlzLmlkfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLm1lbnVJdGVtQ2xpY2sgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLnNpZGViYXItbWVudSBsaSA+IGFcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuc2lkZWJhci1tZW51IC5qcy1zaWRlYmFyLWNsb3NlXCIpO1xuXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgTWV0cm9bJ3NpZGViYXInXSA9IHtcbiAgICAgICAgaXNTaWRlYmFyOiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICByZXR1cm4gVXRpbHMuaXNNZXRyb09iamVjdChlbCwgXCJzaWRlYmFyXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9wZW46IGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc1NpZGViYXIoZWwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbihlbCwgXCJzaWRlYmFyXCIpLm9wZW4oKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjbG9zZTogZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzU2lkZWJhcihlbCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKGVsLCBcInNpZGViYXJcIikuY2xvc2UoKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc1NpZGViYXIoZWwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbihlbCwgXCJzaWRlYmFyXCIpLnRvZ2dsZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzT3BlbjogZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzU2lkZWJhcihlbCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIE1ldHJvLmdldFBsdWdpbihlbCwgXCJzaWRlYmFyXCIpLmlzT3BlbigpO1xuICAgICAgICB9XG4gICAgfTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBTbGlkZXJEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBzbGlkZXJEZWZlcnJlZDogMCxcbiAgICAgICAgcm91bmRWYWx1ZTogdHJ1ZSxcbiAgICAgICAgbWluOiAwLFxuICAgICAgICBtYXg6IDEwMCxcbiAgICAgICAgYWNjdXJhY3k6IDAsXG4gICAgICAgIHNob3dNaW5NYXg6IGZhbHNlLFxuICAgICAgICBtaW5NYXhQb3NpdGlvbjogTWV0cm8ucG9zaXRpb24uVE9QLFxuICAgICAgICB2YWx1ZTogMCxcbiAgICAgICAgYnVmZmVyOiAwLFxuICAgICAgICBoaW50OiBmYWxzZSxcbiAgICAgICAgaGludEFsd2F5czogZmFsc2UsXG4gICAgICAgIGhpbnRQb3NpdGlvbjogTWV0cm8ucG9zaXRpb24uVE9QLFxuICAgICAgICBoaW50TWFzazogXCIkMVwiLFxuICAgICAgICB2ZXJ0aWNhbDogZmFsc2UsXG4gICAgICAgIHRhcmdldDogbnVsbCxcbiAgICAgICAgcmV0dXJuVHlwZTogXCJ2YWx1ZVwiLCAvLyB2YWx1ZSBvciBwZXJjZW50XG4gICAgICAgIHNpemU6IDAsXG5cbiAgICAgICAgY2xzU2xpZGVyOiBcIlwiLFxuICAgICAgICBjbHNCYWNrc2lkZTogXCJcIixcbiAgICAgICAgY2xzQ29tcGxldGU6IFwiXCIsXG4gICAgICAgIGNsc0J1ZmZlcjogXCJcIixcbiAgICAgICAgY2xzTWFya2VyOiBcIlwiLFxuICAgICAgICBjbHNIaW50OiBcIlwiLFxuICAgICAgICBjbHNNaW5NYXg6IFwiXCIsXG4gICAgICAgIGNsc01pbjogXCJcIixcbiAgICAgICAgY2xzTWF4OiBcIlwiLFxuXG4gICAgICAgIG9uU3RhcnQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uU3RvcDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Nb3ZlOiBNZXRyby5ub29wLFxuICAgICAgICBvblNsaWRlckNsaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNoYW5nZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25DaGFuZ2VWYWx1ZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25DaGFuZ2VCdWZmZXI6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uRm9jdXM6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQmx1cjogTWV0cm8ubm9vcCxcbiAgICAgICAgb25TbGlkZXJDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uc2xpZGVyU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBTbGlkZXJEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIFNsaWRlckRlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvU2xpZGVyU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5zbGlkZXJTZXR1cCh3aW5kb3dbXCJtZXRyb1NsaWRlclNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ3NsaWRlcicsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBTbGlkZXJEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgc2xpZGVyOiBudWxsLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAwLFxuICAgICAgICAgICAgICAgIHBlcmNlbnQ6IDAsXG4gICAgICAgICAgICAgICAgcGl4ZWw6IDAsXG4gICAgICAgICAgICAgICAgYnVmZmVyOiAwLFxuICAgICAgICAgICAgICAgIGtleUludGVydmFsOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBpZDogVXRpbHMuZWxlbWVudElkKCdzbGlkZXInKVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU2xpZGVyKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcbiAgICAgICAgICAgIHRoaXMuYnVmZihvLmJ1ZmZlcik7XG4gICAgICAgICAgICB0aGlzLnZhbChvLnZhbHVlKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwic2xpZGVyLWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVNsaWRlcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICB2YXIgcHJldiA9IGVsZW1lbnQucHJldigpO1xuICAgICAgICAgICAgdmFyIHBhcmVudCA9IGVsZW1lbnQucGFyZW50KCk7XG4gICAgICAgICAgICB2YXIgc2xpZGVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwic2xpZGVyIFwiICsgZWxlbWVudFswXS5jbGFzc05hbWUpLmFkZENsYXNzKG8uY2xzU2xpZGVyKTtcbiAgICAgICAgICAgIHZhciBiYWNrc2lkZSA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImJhY2tzaWRlXCIpLmFkZENsYXNzKG8uY2xzQmFja3NpZGUpO1xuICAgICAgICAgICAgdmFyIGNvbXBsZXRlID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiY29tcGxldGVcIikuYWRkQ2xhc3Moby5jbHNDb21wbGV0ZSk7XG4gICAgICAgICAgICB2YXIgYnVmZmVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiYnVmZmVyXCIpLmFkZENsYXNzKG8uY2xzQnVmZmVyKTtcbiAgICAgICAgICAgIHZhciBtYXJrZXIgPSAkKFwiPGJ1dHRvbj5cIikuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIikuYWRkQ2xhc3MoXCJtYXJrZXJcIikuYWRkQ2xhc3Moby5jbHNNYXJrZXIpO1xuICAgICAgICAgICAgdmFyIGhpbnQgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJoaW50XCIpLmFkZENsYXNzKG8uaGludFBvc2l0aW9uICsgXCItc2lkZVwiKS5hZGRDbGFzcyhvLmNsc0hpbnQpO1xuICAgICAgICAgICAgdmFyIGk7XG5cbiAgICAgICAgICAgIGlmIChvLnNpemUgPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKG8udmVydGljYWwgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVyLm91dGVySGVpZ2h0KG8uc2l6ZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVyLm91dGVyV2lkdGgoby5zaXplKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLnZlcnRpY2FsID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgc2xpZGVyLmFkZENsYXNzKFwidmVydGljYWwtc2xpZGVyXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocHJldi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBwYXJlbnQucHJlcGVuZChzbGlkZXIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzbGlkZXIuaW5zZXJ0QWZ0ZXIocHJldik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmhpbnRBbHdheXMgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBoaW50LmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IFwiYmxvY2tcIlxuICAgICAgICAgICAgICAgIH0pLmFkZENsYXNzKFwicGVybWFuZW50LWhpbnRcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kVG8oc2xpZGVyKTtcbiAgICAgICAgICAgIGJhY2tzaWRlLmFwcGVuZFRvKHNsaWRlcik7XG4gICAgICAgICAgICBjb21wbGV0ZS5hcHBlbmRUbyhzbGlkZXIpO1xuICAgICAgICAgICAgYnVmZmVyLmFwcGVuZFRvKHNsaWRlcik7XG4gICAgICAgICAgICBtYXJrZXIuYXBwZW5kVG8oc2xpZGVyKTtcbiAgICAgICAgICAgIGhpbnQuYXBwZW5kVG8obWFya2VyKTtcblxuICAgICAgICAgICAgaWYgKG8uc2hvd01pbk1heCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHZhciBtaW5fbWF4X3dyYXBwZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJzbGlkZXItbWluLW1heFwiKS5hZGRDbGFzcyhvLmNsc01pbk1heCk7XG4gICAgICAgICAgICAgICAgJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcInNsaWRlci10ZXh0LW1pblwiKS5hZGRDbGFzcyhvLmNsc01pbikuaHRtbChvLm1pbikuYXBwZW5kVG8obWluX21heF93cmFwcGVyKTtcbiAgICAgICAgICAgICAgICAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwic2xpZGVyLXRleHQtbWF4XCIpLmFkZENsYXNzKG8uY2xzTWF4KS5odG1sKG8ubWF4KS5hcHBlbmRUbyhtaW5fbWF4X3dyYXBwZXIpO1xuICAgICAgICAgICAgICAgIGlmIChvLm1pbk1heFBvc2l0aW9uID09PSBNZXRyby5wb3NpdGlvbi5UT1ApIHtcbiAgICAgICAgICAgICAgICAgICAgbWluX21heF93cmFwcGVyLmluc2VydEJlZm9yZShzbGlkZXIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG1pbl9tYXhfd3JhcHBlci5pbnNlcnRBZnRlcihzbGlkZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudFswXS5jbGFzc05hbWUgPSAnJztcbiAgICAgICAgICAgIGlmIChvLmNvcHlJbmxpbmVTdHlsZXMgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZWxlbWVudFswXS5zdHlsZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBzbGlkZXIuY3NzKGVsZW1lbnRbMF0uc3R5bGVbaV0sIGVsZW1lbnQuY3NzKGVsZW1lbnRbMF0uc3R5bGVbaV0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChlbGVtZW50LmlzKFwiOmRpc2FibGVkXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2xpZGVyID0gc2xpZGVyO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIHNsaWRlciA9IHRoaXMuc2xpZGVyLCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIG1hcmtlciA9IHNsaWRlci5maW5kKFwiLm1hcmtlclwiKTtcbiAgICAgICAgICAgIHZhciBoaW50ID0gc2xpZGVyLmZpbmQoXCIuaGludFwiKTtcblxuICAgICAgICAgICAgbWFya2VyLm9uKE1ldHJvLmV2ZW50cy5zdGFydEFsbCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAoby5oaW50ID09PSB0cnVlICYmIG8uaGludEFsd2F5cyAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBoaW50LmZhZGVJbigzMDApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKE1ldHJvLmV2ZW50cy5tb3ZlQWxsLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUuY2FuY2VsYWJsZSkgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9tb3ZlKGUpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcIm1vdmVcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiB0aGF0LnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGVyY2VudDogdGhhdC5wZXJjZW50XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfSwge25zOiB0aGF0LmlkLCBwYXNzaXZlOiBmYWxzZX0pO1xuXG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkub24oTWV0cm8uZXZlbnRzLnN0b3BBbGwsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihNZXRyby5ldmVudHMubW92ZUFsbCwge25zOiB0aGF0LmlkfSk7XG4gICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihNZXRyby5ldmVudHMuc3RvcEFsbCwge25zOiB0aGF0LmlkfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG8uaGludEFsd2F5cyAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGludC5mYWRlT3V0KDMwMCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJzdG9wXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbDogdGhhdC52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnQ6IHRoYXQucGVyY2VudFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LCB7bnM6IHRoYXQuaWR9KTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInN0YXJ0XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsOiB0aGF0LnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBwZXJjZW50OiB0aGF0LnBlcmNlbnRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtYXJrZXIub24oTWV0cm8uZXZlbnRzLmZvY3VzLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImZvY3VzXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsOiB0aGF0LnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBwZXJjZW50OiB0aGF0LnBlcmNlbnRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtYXJrZXIub24oTWV0cm8uZXZlbnRzLmJsdXIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiYmx1clwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHZhbDogdGhhdC52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgcGVyY2VudDogdGhhdC5wZXJjZW50XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbWFya2VyLm9uKE1ldHJvLmV2ZW50cy5rZXlkb3duLCBmdW5jdGlvbihlKXtcblxuICAgICAgICAgICAgICAgIHZhciBrZXkgPSBlLmtleUNvZGUgPyBlLmtleUNvZGUgOiBlLndoaWNoO1xuXG4gICAgICAgICAgICAgICAgaWYgKFszNywzOCwzOSw0MF0uaW5kZXhPZihrZXkpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN0ZXAgPSBvLmFjY3VyYWN5ID09PSAwID8gMSA6IG8uYWNjdXJhY3k7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhhdC5rZXlJbnRlcnZhbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGF0LmtleUludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsID0gdGhhdC52YWx1ZTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSAzNyB8fCBlLmtleUNvZGUgPT09IDQwKSB7IC8vIGxlZnQsIGRvd25cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWwgLSBzdGVwIDwgby5taW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBvLm1pbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsIC09IHN0ZXA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSAzOCB8fCBlLmtleUNvZGUgPT09IDM5KSB7IC8vIHJpZ2h0LCB1cFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCArIHN0ZXAgPiBvLm1heCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IG8ubWF4O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgKz0gc3RlcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQudmFsdWUgPSB0aGF0Ll9jb3JyZWN0KHZhbCk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQucGVyY2VudCA9IHRoYXQuX2NvbnZlcnQodGhhdC52YWx1ZSwgJ3ZhbDJwcmMnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5waXhlbCA9IHRoYXQuX2NvbnZlcnQodGhhdC5wZXJjZW50LCAncHJjMnBpeCcpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3JlZHJhdygpO1xuICAgICAgICAgICAgICAgIH0sIDEwMCk7XG5cbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbWFya2VyLm9uKE1ldHJvLmV2ZW50cy5rZXl1cCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRoYXQua2V5SW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgIHRoYXQua2V5SW50ZXJ2YWwgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzbGlkZXIub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICB0aGF0Ll9tb3ZlKGUpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwic2xpZGVyLWNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsOiB0aGF0LnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBwZXJjZW50OiB0aGF0LnBlcmNlbnRcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInN0b3BcIiwge1xuICAgICAgICAgICAgICAgICAgICB2YWw6IHRoYXQudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIHBlcmNlbnQ6IHRoYXQucGVyY2VudFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQod2luZG93KS5vbihNZXRyby5ldmVudHMucmVzaXplLGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC52YWwodGhhdC52YWx1ZSk7XG4gICAgICAgICAgICAgICAgdGhhdC5idWZmKHRoYXQuYnVmZmVyKTtcbiAgICAgICAgICAgIH0sIHtuczogdGhhdC5pZH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jb252ZXJ0OiBmdW5jdGlvbih2LCBob3cpe1xuICAgICAgICAgICAgdmFyIHNsaWRlciA9IHRoaXMuc2xpZGVyLCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGxlbmd0aCA9IChvLnZlcnRpY2FsID09PSB0cnVlID8gc2xpZGVyLm91dGVySGVpZ2h0KCkgOiBzbGlkZXIub3V0ZXJXaWR0aCgpKSAtIHNsaWRlci5maW5kKFwiLm1hcmtlclwiKS5vdXRlcldpZHRoKCk7XG4gICAgICAgICAgICBzd2l0Y2ggKGhvdykge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJwaXgycHJjXCI6IHJldHVybiAoIHYgKiAxMDAgLyBsZW5ndGggKTtcbiAgICAgICAgICAgICAgICBjYXNlIFwicGl4MnZhbFwiOiByZXR1cm4gKCB0aGlzLl9jb252ZXJ0KHYsICdwaXgycHJjJykgKiAoKG8ubWF4IC0gby5taW4pIC8gMTAwKSArIG8ubWluICk7XG4gICAgICAgICAgICAgICAgY2FzZSBcInZhbDJwcmNcIjogcmV0dXJuICggKHYgLSBvLm1pbikvKCAoby5tYXggLSBvLm1pbikgLyAxMDAgKSAgKTtcbiAgICAgICAgICAgICAgICBjYXNlIFwicHJjMnBpeFwiOiByZXR1cm4gKCB2IC8gKCAxMDAgLyBsZW5ndGggKSk7XG4gICAgICAgICAgICAgICAgY2FzZSBcInZhbDJwaXhcIjogcmV0dXJuICggdGhpcy5fY29udmVydCh0aGlzLl9jb252ZXJ0KHYsICd2YWwycHJjJyksICdwcmMycGl4JykgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NvcnJlY3Q6IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAgICAgICAgIHZhciByZXMgPSB2YWx1ZTtcbiAgICAgICAgICAgIHZhciBhY2N1cmFjeSAgPSB0aGlzLm9wdGlvbnMuYWNjdXJhY3k7XG4gICAgICAgICAgICB2YXIgbWluID0gdGhpcy5vcHRpb25zLm1pbiwgbWF4ID0gdGhpcy5vcHRpb25zLm1heDtcblxuICAgICAgICAgICAgaWYgKGFjY3VyYWN5ID09PSAwIHx8IGlzTmFOKGFjY3VyYWN5KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlcyA9IE1hdGgucm91bmQodmFsdWUvYWNjdXJhY3kpKmFjY3VyYWN5O1xuXG4gICAgICAgICAgICBpZiAocmVzIDwgbWluKSB7XG4gICAgICAgICAgICAgICAgcmVzID0gbWluO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzID4gbWF4KSB7XG4gICAgICAgICAgICAgICAgcmVzID0gbWF4O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmVzLnRvRml4ZWQoVXRpbHMuZGVjQ291bnQoYWNjdXJhY3kpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfbW92ZTogZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICB2YXIgc2xpZGVyID0gdGhpcy5zbGlkZXIsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgb2Zmc2V0ID0gc2xpZGVyLm9mZnNldCgpLFxuICAgICAgICAgICAgICAgIG1hcmtlcl9zaXplID0gc2xpZGVyLmZpbmQoXCIubWFya2VyXCIpLm91dGVyV2lkdGgoKSxcbiAgICAgICAgICAgICAgICBsZW5ndGggPSBvLnZlcnRpY2FsID09PSB0cnVlID8gc2xpZGVyLm91dGVySGVpZ2h0KCkgOiBzbGlkZXIub3V0ZXJXaWR0aCgpLFxuICAgICAgICAgICAgICAgIGNQb3MsIGNQaXgsIGNTdGFydCA9IDAsIGNTdG9wID0gbGVuZ3RoIC0gbWFya2VyX3NpemU7XG5cbiAgICAgICAgICAgIGNQb3MgPSBvLnZlcnRpY2FsID09PSB0cnVlID8gVXRpbHMucGFnZVhZKGUpLnkgLSBvZmZzZXQudG9wIDogVXRpbHMucGFnZVhZKGUpLnggLSBvZmZzZXQubGVmdDtcbiAgICAgICAgICAgIGNQaXggPSBvLnZlcnRpY2FsID09PSB0cnVlID8gbGVuZ3RoIC0gY1BvcyAtIG1hcmtlcl9zaXplIC8gMiA6IGNQb3MgLSBtYXJrZXJfc2l6ZSAvIDI7XG5cbiAgICAgICAgICAgIGlmIChjUGl4IDwgY1N0YXJ0IHx8IGNQaXggPiBjU3RvcCkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLl9jb3JyZWN0KHRoaXMuX2NvbnZlcnQoY1BpeCwgJ3BpeDJ2YWwnKSk7XG4gICAgICAgICAgICB0aGlzLnBlcmNlbnQgPSB0aGlzLl9jb252ZXJ0KHRoaXMudmFsdWUsICd2YWwycHJjJyk7XG4gICAgICAgICAgICB0aGlzLnBpeGVsID0gdGhpcy5fY29udmVydCh0aGlzLnBlcmNlbnQsICdwcmMycGl4Jyk7XG5cbiAgICAgICAgICAgIHRoaXMuX3JlZHJhdygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9oaW50OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnMsIHNsaWRlciA9IHRoaXMuc2xpZGVyLCBoaW50ID0gc2xpZGVyLmZpbmQoXCIuaGludFwiKTtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9ICt0aGlzLnZhbHVlIHx8IDA7XG4gICAgICAgICAgICB2YXIgcGVyY2VudCA9ICt0aGlzLnBlcmNlbnQgfHwgMDtcblxuICAgICAgICAgICAgaWYgKG8ucm91bmRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gKFV0aWxzLmlzVmFsdWUodmFsdWUpID8gK3ZhbHVlIDogMCkudG9GaXhlZChVdGlscy5kZWNDb3VudChvLmFjY3VyYWN5KSk7XG4gICAgICAgICAgICAgICAgcGVyY2VudCA9IChVdGlscy5pc1ZhbHVlKHBlcmNlbnQpID8gK3BlcmNlbnQgOiAwKS50b0ZpeGVkKFV0aWxzLmRlY0NvdW50KG8uYWNjdXJhY3kpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaGludC50ZXh0KG8uaGludE1hc2sucmVwbGFjZShcIiQxXCIsIHZhbHVlKS5yZXBsYWNlKFwiJDJcIiwgcGVyY2VudCkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF92YWx1ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gby5yZXR1cm5UeXBlID09PSAndmFsdWUnID8gdGhpcy52YWx1ZSA6IHRoaXMucGVyY2VudDtcbiAgICAgICAgICAgIHZhciBwZXJjZW50ID0gdGhpcy5wZXJjZW50O1xuICAgICAgICAgICAgdmFyIGJ1ZmZlciA9IHRoaXMuYnVmZmVyO1xuXG4gICAgICAgICAgICBpZiAoby5yb3VuZFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSAoVXRpbHMuaXNWYWx1ZSh2YWx1ZSkgPyArdmFsdWUgOiAwKS50b0ZpeGVkKFV0aWxzLmRlY0NvdW50KG8uYWNjdXJhY3kpKTtcbiAgICAgICAgICAgICAgICBwZXJjZW50ID0gKFV0aWxzLmlzVmFsdWUocGVyY2VudCkgPyArcGVyY2VudCA6IDApLnRvRml4ZWQoVXRpbHMuZGVjQ291bnQoby5hY2N1cmFjeSkpO1xuICAgICAgICAgICAgICAgIGJ1ZmZlciA9IChVdGlscy5pc1ZhbHVlKGJ1ZmZlcikgPyArYnVmZmVyIDogMCkudG9GaXhlZChVdGlscy5kZWNDb3VudChvLmFjY3VyYWN5KSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChlbGVtZW50WzBdLnRhZ05hbWUgPT09IFwiSU5QVVRcIikge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQudmFsKHZhbHVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8udGFyZ2V0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQoby50YXJnZXQpO1xuICAgICAgICAgICAgICAgIGlmICh0YXJnZXQubGVuZ3RoICE9PSAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHRhcmdldCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRhZ05hbWUgPT09IFwiSU5QVVRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudmFsKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC50ZXh0KHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHQudHJpZ2dlcihcImNoYW5nZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJjaGFuZ2UtdmFsdWVcIiwge1xuICAgICAgICAgICAgICAgIHZhbDogdmFsdWVcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJjaGFuZ2VcIiwge1xuICAgICAgICAgICAgICAgIHZhbDogdmFsdWUsXG4gICAgICAgICAgICAgICAgcGVyY2VudDogcGVyY2VudCxcbiAgICAgICAgICAgICAgICBidWZmZXI6IGJ1ZmZlclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX21hcmtlcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBzbGlkZXIgPSB0aGlzLnNsaWRlciwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBtYXJrZXIgPSBzbGlkZXIuZmluZChcIi5tYXJrZXJcIiksIGNvbXBsZXRlID0gc2xpZGVyLmZpbmQoXCIuY29tcGxldGVcIik7XG4gICAgICAgICAgICB2YXIgbGVuZ3RoID0gby52ZXJ0aWNhbCA9PT0gdHJ1ZSA/IHNsaWRlci5vdXRlckhlaWdodCgpIDogc2xpZGVyLm91dGVyV2lkdGgoKTtcbiAgICAgICAgICAgIHZhciBtYXJrZXJfc2l6ZSA9IHBhcnNlSW50KFV0aWxzLmdldFN0eWxlT25lKG1hcmtlciwgXCJ3aWR0aFwiKSk7XG4gICAgICAgICAgICB2YXIgc2xpZGVyX3Zpc2libGUgPSBVdGlscy5pc1Zpc2libGUoc2xpZGVyKTtcblxuICAgICAgICAgICAgaWYgKHNsaWRlcl92aXNpYmxlKSB7XG4gICAgICAgICAgICAgICAgbWFya2VyLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICdtYXJnaW4tdG9wJzogMCxcbiAgICAgICAgICAgICAgICAgICAgJ21hcmdpbi1sZWZ0JzogMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby52ZXJ0aWNhbCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGlmIChzbGlkZXJfdmlzaWJsZSkge1xuICAgICAgICAgICAgICAgICAgICBtYXJrZXIuY3NzKCd0b3AnLCBsZW5ndGggLSB0aGlzLnBpeGVsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBtYXJrZXIuY3NzKCd0b3AnLCAoMTAwIC0gdGhpcy5wZXJjZW50KSArIFwiJVwiKTtcbiAgICAgICAgICAgICAgICAgICAgbWFya2VyLmNzcygnbWFyZ2luLXRvcCcsIG1hcmtlcl9zaXplIC8gMik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbXBsZXRlLmNzcygnaGVpZ2h0JywgdGhpcy5wZXJjZW50K1wiJVwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHNsaWRlcl92aXNpYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgIG1hcmtlci5jc3MoJ2xlZnQnLCB0aGlzLnBpeGVsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBtYXJrZXIuY3NzKCdsZWZ0JywgdGhpcy5wZXJjZW50ICsgXCIlXCIpO1xuICAgICAgICAgICAgICAgICAgICBtYXJrZXIuY3NzKCdtYXJnaW4tbGVmdCcsIHRoaXMucGVyY2VudCA9PT0gMCA/IDAgOiAtMSAqIG1hcmtlcl9zaXplIC8gMik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbXBsZXRlLmNzcygnd2lkdGgnLCB0aGlzLnBlcmNlbnQrXCIlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9yZWRyYXc6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLl9tYXJrZXIoKTtcbiAgICAgICAgICAgIHRoaXMuX3ZhbHVlKCk7XG4gICAgICAgICAgICB0aGlzLl9oaW50KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2J1ZmZlcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGJ1ZmZlciA9IHRoaXMuc2xpZGVyLmZpbmQoXCIuYnVmZmVyXCIpO1xuXG4gICAgICAgICAgICBpZiAoby52ZXJ0aWNhbCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGJ1ZmZlci5jc3MoXCJoZWlnaHRcIiwgdGhpcy5idWZmZXIgKyBcIiVcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGJ1ZmZlci5jc3MoXCJ3aWR0aFwiLCB0aGlzLmJ1ZmZlciArIFwiJVwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiY2hhbmdlLWJ1ZmZlclwiLCB7XG4gICAgICAgICAgICAgICAgdmFsOiB0aGlzLmJ1ZmZlclxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImNoYW5nZVwiLCB7XG4gICAgICAgICAgICAgICAgdmFsOiBlbGVtZW50LnZhbCgpLFxuICAgICAgICAgICAgICAgIHBlcmNlbnQ6IHRoaXMucGVyY2VudCxcbiAgICAgICAgICAgICAgICBidWZmZXI6IHRoaXMuYnVmZmVyXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICB2YWw6IGZ1bmN0aW9uKHYpe1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmICh2ID09PSB1bmRlZmluZWQgfHwgaXNOYU4odikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHYgPCBvLm1pbikge1xuICAgICAgICAgICAgICAgIHYgPSBvLm1pbjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHYgPiBvLm1heCkge1xuICAgICAgICAgICAgICAgIHYgPSBvLm1heDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuX2NvcnJlY3Qodik7XG4gICAgICAgICAgICB0aGlzLnBlcmNlbnQgPSB0aGlzLl9jb252ZXJ0KHRoaXMudmFsdWUsICd2YWwycHJjJyk7XG4gICAgICAgICAgICB0aGlzLnBpeGVsID0gdGhpcy5fY29udmVydCh0aGlzLnBlcmNlbnQsICdwcmMycGl4Jyk7XG5cbiAgICAgICAgICAgIHRoaXMuX3JlZHJhdygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGJ1ZmY6IGZ1bmN0aW9uKHYpe1xuICAgICAgICAgICAgdmFyIHNsaWRlciA9IHRoaXMuc2xpZGVyO1xuICAgICAgICAgICAgdmFyIGJ1ZmZlciA9IHNsaWRlci5maW5kKFwiLmJ1ZmZlclwiKTtcblxuICAgICAgICAgICAgaWYgKHYgPT09IHVuZGVmaW5lZCB8fCBpc05hTih2KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlcjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGJ1ZmZlci5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHYgPSBwYXJzZUludCh2KTtcblxuICAgICAgICAgICAgaWYgKHYgPiAxMDApIHtcbiAgICAgICAgICAgICAgICB2ID0gMTAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodiA8IDApIHtcbiAgICAgICAgICAgICAgICB2ID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5idWZmZXIgPSB2O1xuICAgICAgICAgICAgdGhpcy5fYnVmZmVyKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlVmFsdWU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciB2YWwgPSBlbGVtZW50LmF0dHIoXCJkYXRhLXZhbHVlXCIpO1xuICAgICAgICAgICAgaWYgKHZhbCA8IG8ubWluKSB7XG4gICAgICAgICAgICAgICAgdmFsID0gby5taW5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2YWwgPiBvLm1heCkge1xuICAgICAgICAgICAgICAgIHZhbCA9IG8ubWF4XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnZhbCh2YWwpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUJ1ZmZlcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIHZhbCA9IHBhcnNlSW50KGVsZW1lbnQuYXR0cihcImRhdGEtYnVmZmVyXCIpKTtcbiAgICAgICAgICAgIGlmICh2YWwgPCAwKSB7XG4gICAgICAgICAgICAgICAgdmFsID0gMFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHZhbCA+IDEwMCkge1xuICAgICAgICAgICAgICAgIHZhbCA9IDEwMFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5idWZmKHZhbCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50KCkuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRpc2FibGVkXCIsIGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnQoKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZVN0YXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbS5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSl7XG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS12YWx1ZVwiOiB0aGlzLmNoYW5nZVZhbHVlKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLWJ1ZmZlclwiOiB0aGlzLmNoYW5nZUJ1ZmZlcigpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdkaXNhYmxlZCc6IHRoaXMudG9nZ2xlU3RhdGUoKTsgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBzbGlkZXIgPSB0aGlzLnNsaWRlcjtcbiAgICAgICAgICAgIHZhciBtYXJrZXIgPSBzbGlkZXIuZmluZChcIi5tYXJrZXJcIik7XG5cbiAgICAgICAgICAgIG1hcmtlci5vZmYoTWV0cm8uZXZlbnRzLnN0YXJ0QWxsKTtcbiAgICAgICAgICAgIG1hcmtlci5vZmYoTWV0cm8uZXZlbnRzLmZvY3VzKTtcbiAgICAgICAgICAgIG1hcmtlci5vZmYoTWV0cm8uZXZlbnRzLmJsdXIpO1xuICAgICAgICAgICAgbWFya2VyLm9mZihNZXRyby5ldmVudHMua2V5ZG93bik7XG4gICAgICAgICAgICBtYXJrZXIub2ZmKE1ldHJvLmV2ZW50cy5rZXl1cCk7XG4gICAgICAgICAgICBzbGlkZXIub2ZmKE1ldHJvLmV2ZW50cy5jbGljayk7XG4gICAgICAgICAgICAkKHdpbmRvdykub2ZmKE1ldHJvLmV2ZW50cy5yZXNpemUsIHtuczogdGhpcy5pZH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIFNvcnRlckRlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIHNvcnRlckRlZmVycmVkOiAwLFxuICAgICAgICB0aG91c2FuZFNlcGFyYXRvcjogXCIsXCIsXG4gICAgICAgIGRlY2ltYWxTZXBhcmF0b3I6IFwiLFwiLFxuICAgICAgICBzb3J0VGFyZ2V0OiBudWxsLFxuICAgICAgICBzb3J0U291cmNlOiBudWxsLFxuICAgICAgICBzb3J0RGlyOiBcImFzY1wiLFxuICAgICAgICBzb3J0U3RhcnQ6IHRydWUsXG4gICAgICAgIHNhdmVJbml0aWFsOiB0cnVlLFxuICAgICAgICBvblNvcnRTdGFydDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Tb3J0U3RvcDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Tb3J0SXRlbVN3aXRjaDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Tb3J0ZXJDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uc29ydGVyU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBTb3J0ZXJEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIFNvcnRlckRlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvU29ydGVyU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby5zb3J0ZXJTZXR1cCh3aW5kb3dbXCJtZXRyb1NvcnRlclNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ3NvcnRlcicsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBTb3J0ZXJEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbDogW11cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVN0cnVjdHVyZSgpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJzb3J0ZXItY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlU3RydWN0dXJlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmIChvLnNvcnRUYXJnZXQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBvLnNvcnRUYXJnZXQgPSBlbGVtZW50LmNoaWxkcmVuKClbMF0udGFnTmFtZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5pbml0aWFsID0gZWxlbWVudC5maW5kKG8uc29ydFRhcmdldCkuZ2V0KCk7XG5cbiAgICAgICAgICAgIGlmIChvLnNvcnRTdGFydCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc29ydChvLnNvcnREaXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9nZXRJdGVtQ29udGVudDogZnVuY3Rpb24oaXRlbSl7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBkYXRhLCBpbnNldCwgaSwgZm9ybWF0O1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLnNvcnRTb3VyY2UpKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgaW5zZXQgPSBpdGVtLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoby5zb3J0U291cmNlKTtcblxuICAgICAgICAgICAgICAgIGlmIChpbnNldC5sZW5ndGggPiAwKSBmb3IgKGkgPSAwOyBpIDwgaW5zZXQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSArPSBpbnNldFtpXS50ZXh0Q29udGVudDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9ybWF0ID0gaW5zZXRbMF0uZGF0YXNldC5mb3JtYXQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBpdGVtLnRleHRDb250ZW50O1xuICAgICAgICAgICAgICAgIGZvcm1hdCA9IGl0ZW0uZGF0YXNldC5mb3JtYXQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRhdGEgPSAoXCJcIitkYXRhKS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1tcXG5cXHJdK3xbXFxzXXsyLH0vZywgJyAnKS50cmltKCk7XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKGZvcm1hdCkpIHtcblxuICAgICAgICAgICAgICAgIGlmIChbJ251bWJlcicsICdpbnQnLCAnZmxvYXQnLCAnbW9uZXknXS5pbmRleE9mKGZvcm1hdCkgIT09IC0xICYmIChvLnRob3VzYW5kU2VwYXJhdG9yICE9PSBcIixcIiB8fCBvLmRlY2ltYWxTZXBhcmF0b3IgIT09IFwiLlwiICkpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IFV0aWxzLnBhcnNlTnVtYmVyKGRhdGEsIG8udGhvdXNhbmRTZXBhcmF0b3IsIG8uZGVjaW1hbFNlcGFyYXRvcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc3dpdGNoIChmb3JtYXQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImRhdGVcIjogZGF0YSA9IFV0aWxzLmlzRGF0ZShkYXRhKSA/IG5ldyBEYXRlKGRhdGEpIDogXCJcIjsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJudW1iZXJcIjogZGF0YSA9IE51bWJlcihkYXRhKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJpbnRcIjogZGF0YSA9IHBhcnNlSW50KGRhdGEpOyBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImZsb2F0XCI6IGRhdGEgPSBwYXJzZUZsb2F0KGRhdGEpOyBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIm1vbmV5XCI6IGRhdGEgPSBVdGlscy5wYXJzZU1vbmV5KGRhdGEpOyBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImNhcmRcIjogZGF0YSA9IFV0aWxzLnBhcnNlQ2FyZChkYXRhKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJwaG9uZVwiOiBkYXRhID0gVXRpbHMucGFyc2VQaG9uZShkYXRhKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgfSxcblxuICAgICAgICBzb3J0OiBmdW5jdGlvbihkaXIpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGl0ZW1zO1xuICAgICAgICAgICAgdmFyIGlkID0gVXRpbHMuZWxlbWVudElkKFwidGVtcFwiKTtcbiAgICAgICAgICAgIHZhciBwcmV2O1xuXG4gICAgICAgICAgICBpZiAoZGlyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBvLnNvcnREaXIgPSBkaXI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGl0ZW1zID0gZWxlbWVudC5maW5kKG8uc29ydFRhcmdldCkuZ2V0KCk7XG5cbiAgICAgICAgICAgIGlmIChpdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwcmV2ID0gJChcIjxkaXY+XCIpLmF0dHIoXCJpZFwiLCBpZCkuaW5zZXJ0QmVmb3JlKCQoZWxlbWVudC5maW5kKG8uc29ydFRhcmdldClbMF0pKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwic29ydC1zdGFydFwiLCB7XG4gICAgICAgICAgICAgICAgaXRlbXM6IGl0ZW1zXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXRlbXMuc29ydChmdW5jdGlvbihhLCBiKXtcbiAgICAgICAgICAgICAgICB2YXIgYzEgPSB0aGF0Ll9nZXRJdGVtQ29udGVudChhKTtcbiAgICAgICAgICAgICAgICB2YXIgYzIgPSB0aGF0Ll9nZXRJdGVtQ29udGVudChiKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gMDtcblxuICAgICAgICAgICAgICAgIGlmIChjMSA8IGMyICkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSAtMTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoYzEgPiBjMiApIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gMTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInNvcnQtaXRlbS1zd2l0Y2hcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgYTogYSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGI6IGIsXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQ6IHJlc3VsdFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChvLnNvcnREaXIgPT09IFwiZGVzY1wiKSB7XG4gICAgICAgICAgICAgICAgaXRlbXMucmV2ZXJzZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoby5zb3J0VGFyZ2V0KS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgJC5lYWNoKGl0ZW1zLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgJHRoaXMuaW5zZXJ0QWZ0ZXIocHJldik7XG4gICAgICAgICAgICAgICAgcHJldiA9ICR0aGlzO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoXCIjXCIraWQpLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJzb3J0LXN0b3BcIiwge1xuICAgICAgICAgICAgICAgIGl0ZW1zOiBpdGVtc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBpdGVtcztcbiAgICAgICAgICAgIHZhciBpZCA9IFV0aWxzLmVsZW1lbnRJZCgnc29ydGVyJyk7XG4gICAgICAgICAgICB2YXIgcHJldjtcblxuICAgICAgICAgICAgaXRlbXMgPSB0aGlzLmluaXRpYWw7XG5cbiAgICAgICAgICAgIGlmIChpdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwcmV2ID0gJChcIjxkaXY+XCIpLmF0dHIoXCJpZFwiLCBpZCkuaW5zZXJ0QmVmb3JlKCQoZWxlbWVudC5maW5kKG8uc29ydFRhcmdldClbMF0pKTtcblxuICAgICAgICAgICAgZWxlbWVudC5maW5kKG8uc29ydFRhcmdldCkucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgICQuZWFjaChpdGVtcywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgICR0aGlzLmluc2VydEFmdGVyKHByZXYpO1xuICAgICAgICAgICAgICAgIHByZXYgPSAkdGhpcztcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKFwiI1wiK2lkKS5yZW1vdmUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHJpYnV0ZU5hbWUpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICB2YXIgY2hhbmdlU29ydERpciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBkaXIgPSBlbGVtZW50LmF0dHIoXCJkYXRhLXNvcnQtZGlyXCIpLnRyaW0oKTtcbiAgICAgICAgICAgICAgICBpZiAoZGlyID09PSBcIlwiKSByZXR1cm47XG4gICAgICAgICAgICAgICAgby5zb3J0RGlyID0gZGlyO1xuICAgICAgICAgICAgICAgIHRoYXQuc29ydCgpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGNoYW5nZVNvcnRDb250ZW50ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IGVsZW1lbnQuYXR0cihcImRhdGEtc29ydC1jb250ZW50XCIpLnRyaW0oKTtcbiAgICAgICAgICAgICAgICBpZiAoY29udGVudCA9PT0gXCJcIikgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICBvLnNvcnRDb250ZW50ID0gY29udGVudDtcbiAgICAgICAgICAgICAgICB0aGF0LnNvcnQoKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHN3aXRjaCAoYXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLXNvcnQtZGlyXCI6IGNoYW5nZVNvcnREaXIoKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtc29ydC1jb250ZW50XCI6IGNoYW5nZVNvcnRDb250ZW50KCk7IGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBNZXRyb1snc29ydGVyJ10gPSB7XG4gICAgICAgIGNyZWF0ZTogZnVuY3Rpb24oZWwsIG9wKXtcbiAgICAgICAgICAgIHJldHVybiBVdGlscy4kKCkoZWwpLnNvcnRlcihvcCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNTb3J0ZXI6IGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIHJldHVybiBVdGlscy5pc01ldHJvT2JqZWN0KGVsLCBcInNvcnRlclwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzb3J0OiBmdW5jdGlvbihlbCwgZGlyKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc1NvcnRlcihlbCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGlyID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBkaXIgPSBcImFzY1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKGVsLCBcInNvcnRlclwiKS5zb3J0KGRpcik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc1NvcnRlcihlbCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBNZXRyby5nZXRQbHVnaW4oZWwsIFwic29ydGVyXCIpLnJlc2V0KCk7XG4gICAgICAgIH1cbiAgICB9O1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIFNwaW5uZXJEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBzcGlubmVyRGVmZXJyZWQ6IDAsXG4gICAgICAgIGxhYmVsOiBcIlwiLFxuICAgICAgICBzdGVwOiAxLFxuICAgICAgICBwbHVzSWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLXBsdXMnPjwvc3Bhbj5cIixcbiAgICAgICAgbWludXNJY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tbWludXMnPjwvc3Bhbj5cIixcbiAgICAgICAgYnV0dG9uc1Bvc2l0aW9uOiBcImRlZmF1bHRcIixcbiAgICAgICAgZGVmYXVsdFZhbHVlOiAwLFxuICAgICAgICBtaW5WYWx1ZTogbnVsbCxcbiAgICAgICAgbWF4VmFsdWU6IG51bGwsXG4gICAgICAgIGZpeGVkOiAwLFxuICAgICAgICByZXBlYXRUaHJlc2hvbGQ6IDEwMDAsXG4gICAgICAgIGhpZGVDdXJzb3I6IGZhbHNlLFxuICAgICAgICBjbHNTcGlubmVyOiBcIlwiLFxuICAgICAgICBjbHNTcGlubmVySW5wdXQ6IFwiXCIsXG4gICAgICAgIGNsc1NwaW5uZXJCdXR0b246IFwiXCIsXG4gICAgICAgIGNsc1NwaW5uZXJCdXR0b25QbHVzOiBcIlwiLFxuICAgICAgICBjbHNTcGlubmVyQnV0dG9uTWludXM6IFwiXCIsXG4gICAgICAgIGNsc0xhYmVsOiBcIlwiLFxuICAgICAgICBvbkJlZm9yZUNoYW5nZTogTWV0cm8ubm9vcF90cnVlLFxuICAgICAgICBvbkNoYW5nZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25QbHVzQ2xpY2s6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uTWludXNDbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25BcnJvd1VwOiBNZXRyby5ub29wLFxuICAgICAgICBvbkFycm93RG93bjogTWV0cm8ubm9vcCxcbiAgICAgICAgb25CdXR0b25DbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25BcnJvd0NsaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvblNwaW5uZXJDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uc3Bpbm5lclNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgU3Bpbm5lckRlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgU3Bpbm5lckRlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvU3Bpbm5lclNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8uc3Bpbm5lclNldHVwKHdpbmRvd1tcIm1ldHJvU3Bpbm5lclNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ3NwaW5uZXInLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgU3Bpbm5lckRlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICByZXBlYXRfdGltZXI6IGZhbHNlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJzcGlubmVyLWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVN0cnVjdHVyZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHNwaW5uZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJzcGlubmVyXCIpLmFkZENsYXNzKFwiYnV0dG9ucy1cIitvLmJ1dHRvbnNQb3NpdGlvbikuYWRkQ2xhc3MoZWxlbWVudFswXS5jbGFzc05hbWUpLmFkZENsYXNzKG8uY2xzU3Bpbm5lcik7XG4gICAgICAgICAgICB2YXIgYnV0dG9uX3BsdXMgPSAkKFwiPGJ1dHRvbj5cIikuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIikuYWRkQ2xhc3MoXCJidXR0b24gc3Bpbm5lci1idXR0b24gc3Bpbm5lci1idXR0b24tcGx1c1wiKS5hZGRDbGFzcyhvLmNsc1NwaW5uZXJCdXR0b24gKyBcIiBcIiArIG8uY2xzU3Bpbm5lckJ1dHRvblBsdXMpLmh0bWwoby5wbHVzSWNvbik7XG4gICAgICAgICAgICB2YXIgYnV0dG9uX21pbnVzID0gJChcIjxidXR0b24+XCIpLmF0dHIoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpLmFkZENsYXNzKFwiYnV0dG9uIHNwaW5uZXItYnV0dG9uIHNwaW5uZXItYnV0dG9uLW1pbnVzXCIpLmFkZENsYXNzKG8uY2xzU3Bpbm5lckJ1dHRvbiArIFwiIFwiICsgby5jbHNTcGlubmVyQnV0dG9uTWludXMpLmh0bWwoby5taW51c0ljb24pO1xuICAgICAgICAgICAgdmFyIGluaXRfdmFsdWUgPSBlbGVtZW50LnZhbCgpLnRyaW0oKTtcblxuICAgICAgICAgICAgaWYgKCFVdGlscy5pc1ZhbHVlKGluaXRfdmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC52YWwoMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnRbMF0uY2xhc3NOYW1lID0gJyc7XG5cbiAgICAgICAgICAgIHNwaW5uZXIuaW5zZXJ0QmVmb3JlKGVsZW1lbnQpO1xuICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRUbyhzcGlubmVyKS5hZGRDbGFzcyhvLmNsc1NwaW5uZXJJbnB1dCk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJvcmlnaW5hbC1pbnB1dFwiKTtcblxuICAgICAgICAgICAgYnV0dG9uX3BsdXMuYXBwZW5kVG8oc3Bpbm5lcik7XG4gICAgICAgICAgICBidXR0b25fbWludXMuYXBwZW5kVG8oc3Bpbm5lcik7XG5cbiAgICAgICAgICAgIGlmIChvLmhpZGVDdXJzb3IgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBzcGlubmVyLmFkZENsYXNzKFwiaGlkZS1jdXJzb3JcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gJChcIjxsYWJlbD5cIikuYWRkQ2xhc3MoXCJsYWJlbC1mb3ItaW5wdXRcIikuYWRkQ2xhc3Moby5jbHNMYWJlbCkuaHRtbChvLmxhYmVsKS5pbnNlcnRCZWZvcmUoc3Bpbm5lcik7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuYXR0cihcImlkXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsLmF0dHIoXCJmb3JcIiwgZWxlbWVudC5hdHRyKFwiaWRcIikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5hdHRyKFwiZGlyXCIpID09PSBcInJ0bFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsLmFkZENsYXNzKFwicnRsXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uZGlzYWJsZWQgPT09IHRydWUgfHwgZWxlbWVudC5pcyhcIjpkaXNhYmxlZFwiKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgc3Bpbm5lciA9IGVsZW1lbnQuY2xvc2VzdChcIi5zcGlubmVyXCIpO1xuICAgICAgICAgICAgdmFyIHNwaW5uZXJfYnV0dG9ucyA9IHNwaW5uZXIuZmluZChcIi5zcGlubmVyLWJ1dHRvblwiKTtcbiAgICAgICAgICAgIHZhciB2YWx1ZTtcblxuICAgICAgICAgICAgdmFyIHNwaW5uZXJCdXR0b25DbGljayA9IGZ1bmN0aW9uKHBsdXMsIHRocmVzaG9sZCl7XG4gICAgICAgICAgICAgICAgdmFyIGV2ZW50cyA9IFtwbHVzID8gXCJwbHVzLWNsaWNrXCIgOiBcIm1pbnVzLWNsaWNrXCIsIHBsdXMgPyBcImFycm93LXVwXCIgOiBcImFycm93LWRvd25cIiwgXCJidXR0b24tY2xpY2tcIiwgXCJhcnJvdy1jbGlja1wiXTtcbiAgICAgICAgICAgICAgICB2YXIgY3VyciA9ICtlbGVtZW50LnZhbCgpO1xuICAgICAgICAgICAgICAgIHZhciB2YWwgPSArZWxlbWVudC52YWwoKTtcbiAgICAgICAgICAgICAgICB2YXIgc3RlcCA9ICtvLnN0ZXA7XG5cbiAgICAgICAgICAgICAgICBpZiAocGx1cykge1xuICAgICAgICAgICAgICAgICAgICB2YWwgKz0gc3RlcDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YWwgLT0gc3RlcDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9zZXRWYWx1ZSh2YWwudG9GaXhlZChvLmZpeGVkKSwgdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnRzKGV2ZW50cywge1xuICAgICAgICAgICAgICAgICAgICBjdXJyOiBjdXJyLFxuICAgICAgICAgICAgICAgICAgICB2YWw6IHZhbCxcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFZhbDogZWxlbWVudC52YWwoKSxcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uOiBwbHVzID8gXCJwbHVzXCIgOiBcIm1pbnVzXCJcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQucmVwZWF0X3RpbWVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzcGlubmVyQnV0dG9uQ2xpY2socGx1cywgMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIHRocmVzaG9sZCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzcGlubmVyLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgJChcIi5mb2N1c2VkXCIpLnJlbW92ZUNsYXNzKFwiZm9jdXNlZFwiKTtcbiAgICAgICAgICAgICAgICBzcGlubmVyLmFkZENsYXNzKFwiZm9jdXNlZFwiKTtcblxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNwaW5uZXJfYnV0dG9ucy5vbihNZXRyby5ldmVudHMuc3RhcnRBbGwsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIHZhciBwbHVzID0gJCh0aGlzKS5jbG9zZXN0KFwiLnNwaW5uZXItYnV0dG9uXCIpLmhhc0NsYXNzKFwic3Bpbm5lci1idXR0b24tcGx1c1wiKTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGF0LnJlcGVhdF90aW1lcikgcmV0dXJuIDtcblxuICAgICAgICAgICAgICAgIHRoYXQucmVwZWF0X3RpbWVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzcGlubmVyQnV0dG9uQ2xpY2socGx1cywgby5yZXBlYXRUaHJlc2hvbGQpO1xuXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNwaW5uZXJfYnV0dG9ucy5vbihNZXRyby5ldmVudHMuc3RvcEFsbCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0LnJlcGVhdF90aW1lciA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmtleWRvd24sIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IE1ldHJvLmtleUNvZGUuVVBfQVJST1cgfHwgZS5rZXlDb2RlID09PSBNZXRyby5rZXlDb2RlLkRPV05fQVJST1cpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5yZXBlYXRfdGltZXIpIHJldHVybiA7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5yZXBlYXRfdGltZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBzcGlubmVyQnV0dG9uQ2xpY2soZS5rZXlDb2RlID09PSBNZXRyby5rZXlDb2RlLlVQX0FSUk9XLCBvLnJlcGVhdFRocmVzaG9sZCk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gZS5rZXk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09IFwiQmFja3NwYWNlXCIgfHwga2V5ID09PSBcIkRlbGV0ZVwiIHx8IGtleSA9PT0gXCJBcnJvd0xlZnRcIiB8fCBrZXkgPT09IFwiQXJyb3dSaWdodFwiICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihrZXkpIHx8IHBhcnNlSW50KGtleSkgPCAwICYmIHBhcnNlSW50KGtleSkgPiA5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlSW50KHRoaXMudmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5rZXl1cCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgdmFsID0gcGFyc2VJbnQodGhpcy52YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKChvLm1pblZhbHVlICYmIHZhbCA8IG8ubWluVmFsdWUpIHx8IChvLm1heFZhbHVlICYmIHZhbCA+IG8ubWF4VmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc3Bpbm5lci5vbihNZXRyby5ldmVudHMua2V5dXAsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5yZXBlYXRfdGltZXIgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9zZXRWYWx1ZTogZnVuY3Rpb24odmFsLCB0cmlnZ2VyX2NoYW5nZSl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgaWYgKFV0aWxzLmV4ZWMoby5vbkJlZm9yZUNoYW5nZSwgW3ZhbF0sIGVsZW1lbnRbMF0pICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5tYXhWYWx1ZSkgJiYgdmFsID4gTnVtYmVyKG8ubWF4VmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgdmFsID0gIE51bWJlcihvLm1heFZhbHVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5taW5WYWx1ZSkgJiYgdmFsIDwgTnVtYmVyKG8ubWluVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgdmFsID0gIE51bWJlcihvLm1pblZhbHVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC52YWwodmFsKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiY2hhbmdlXCIsIHt2YWw6IHZhbH0sIGZhbHNlLCB0cnVlKTtcblxuICAgICAgICAgICAgaWYgKHRyaWdnZXJfY2hhbmdlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5maXJlKFwiY2hhbmdlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsOiB2YWxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB2YWw6IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUodmFsKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnZhbCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGF0Ll9zZXRWYWx1ZSh2YWwudG9GaXhlZChvLmZpeGVkKSwgdHJ1ZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9EZWZhdWx0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgdmFsID0gVXRpbHMuaXNWYWx1ZShvLmRlZmF1bHRWYWx1ZSkgPyBOdW1iZXIoby5kZWZhdWx0VmFsdWUpIDogMDtcbiAgICAgICAgICAgIHRoaXMuX3NldFZhbHVlKHZhbC50b0ZpeGVkKG8uZml4ZWQpLCB0cnVlKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiY2hhbmdlXCIsIHtcbiAgICAgICAgICAgICAgICB2YWw6IHZhbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50KCkuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRpc2FibGVkXCIsIGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnQoKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZVN0YXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbS5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIHZhciBjaGFuZ2VWYWx1ZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIHZhbCA9IGVsZW1lbnQuYXR0cigndmFsdWUnKS50cmltKCk7XG4gICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUodmFsKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9zZXRWYWx1ZShOdW1iZXIodmFsKSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHN3aXRjaCAoYXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ2Rpc2FibGVkJzogdGhpcy50b2dnbGVTdGF0ZSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICd2YWx1ZSc6IGNoYW5nZVZhbHVlKCk7IGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBzcGlubmVyID0gZWxlbWVudC5jbG9zZXN0KFwiLnNwaW5uZXJcIik7XG4gICAgICAgICAgICB2YXIgc3Bpbm5lcl9idXR0b25zID0gc3Bpbm5lci5maW5kKFwiLnNwaW5uZXItYnV0dG9uXCIpO1xuXG4gICAgICAgICAgICBzcGlubmVyLm9mZihNZXRyby5ldmVudHMuY2xpY2spO1xuICAgICAgICAgICAgc3Bpbm5lcl9idXR0b25zLm9mZihNZXRyby5ldmVudHMuc3RhcnQpO1xuICAgICAgICAgICAgc3Bpbm5lcl9idXR0b25zLm9mZihNZXRyby5ldmVudHMuc3RvcCk7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMua2V5ZG93bik7XG4gICAgICAgICAgICBzcGlubmVyLm9mZihNZXRyby5ldmVudHMua2V5dXApO1xuXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgJChkb2N1bWVudCkub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBmdW5jdGlvbigpe1xuICAgICAgICAkKFwiLnNwaW5uZXJcIikucmVtb3ZlQ2xhc3MoXCJmb2N1c2VkXCIpO1xuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIFN0b3JhZ2UgPSBNZXRyby5zdG9yYWdlO1xuICAgIHZhciBTcGxpdHRlckRlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIHNwbGl0dGVyRGVmZXJyZWQ6IDAsXG4gICAgICAgIHNwbGl0TW9kZTogXCJob3Jpem9udGFsXCIsIC8vIGhvcml6b250YWwgb3IgdmVydGljYWxcbiAgICAgICAgc3BsaXRTaXplczogbnVsbCxcbiAgICAgICAgZ3V0dGVyU2l6ZTogNCxcbiAgICAgICAgbWluU2l6ZXM6IG51bGwsXG4gICAgICAgIGNoaWxkcmVuOiBcIipcIixcbiAgICAgICAgZ3V0dGVyQ2xpY2s6IFwiZXhwYW5kXCIsIC8vIFRPRE8gZXhwYW5kIG9yIGNvbGxhcHNlXG4gICAgICAgIHNhdmVTdGF0ZTogZmFsc2UsXG4gICAgICAgIG9uUmVzaXplU3RhcnQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uUmVzaXplU3RvcDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25SZXNpemVTcGxpdDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25SZXNpemVXaW5kb3c6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uU3BsaXR0ZXJDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uc3BsaXR0ZXJTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIFNwbGl0dGVyRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBTcGxpdHRlckRlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvU3BsaXR0ZXJTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLnNwbGl0dGVyU2V0dXAod2luZG93W1wibWV0cm9TcGxpdHRlclNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ3NwbGl0dGVyJywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIFNwbGl0dGVyRGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIHN0b3JhZ2U6IFV0aWxzLmlzVmFsdWUoU3RvcmFnZSkgPyBTdG9yYWdlIDogbnVsbCxcbiAgICAgICAgICAgICAgICBzdG9yYWdlS2V5OiBcIlNQTElUVEVSOlwiLFxuICAgICAgICAgICAgICAgIGlkOiBVdGlscy5lbGVtZW50SWQoXCJzcGxpdHRlclwiKVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwic3BsaXR0ZXItY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlU3RydWN0dXJlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSBlbGVtZW50LmNoaWxkcmVuKG8uY2hpbGRyZW4pLmFkZENsYXNzKFwic3BsaXQtYmxvY2tcIik7XG4gICAgICAgICAgICB2YXIgaSwgY2hpbGRyZW5fc2l6ZXMgPSBbXTtcbiAgICAgICAgICAgIHZhciByZXNpemVQcm9wID0gby5zcGxpdE1vZGUgPT09IFwiaG9yaXpvbnRhbFwiID8gXCJ3aWR0aFwiIDogXCJoZWlnaHRcIjtcblxuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcInNwbGl0dGVyXCIpO1xuICAgICAgICAgICAgaWYgKG8uc3BsaXRNb2RlLnRvTG93ZXJDYXNlKCkgPT09IFwidmVydGljYWxcIikge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJ2ZXJ0aWNhbFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICAgICAgICAgICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImd1dHRlclwiKS5jc3MocmVzaXplUHJvcCwgby5ndXR0ZXJTaXplKS5pbnNlcnRBZnRlcigkKGNoaWxkcmVuW2ldKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX3NldFNpemUoKTtcblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5taW5TaXplcykpIHtcbiAgICAgICAgICAgICAgICBpZiAoKFwiXCIrby5taW5TaXplcykuaW5jbHVkZXMoXCIsXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuX3NpemVzID0gby5taW5TaXplcy50b0FycmF5KCk7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjaGlsZHJlbl9zaXplcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgJChjaGlsZHJlbltpXSkuZGF0YShcIm1pbi1zaXplXCIsIGNoaWxkcmVuX3NpemVzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuW2ldLnN0eWxlLnNldFByb3BlcnR5KCdtaW4tJytyZXNpemVQcm9wLCAoXCJcIitjaGlsZHJlbl9zaXplc1tpXSkuaW5jbHVkZXMoXCIlXCIpID8gY2hpbGRyZW5fc2l6ZXNbaV0gOiAoXCJcIitjaGlsZHJlbl9zaXplc1tpXSkucmVwbGFjZShcInB4XCIsIFwiXCIpK1wicHhcIiwgJ2ltcG9ydGFudCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGNoaWxkcmVuLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5zZXRQcm9wZXJ0eSgnbWluLScrcmVzaXplUHJvcCwgKFwiXCIrby5taW5TaXplcykuaW5jbHVkZXMoXCIlXCIpID8gby5taW5TaXplcyA6IChcIlwiK28ubWluU2l6ZXMpLnJlcGxhY2UoXCJweFwiLCBcIlwiKStcInB4XCIsICdpbXBvcnRhbnQnKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5zYXZlU3RhdGUgJiYgdGhpcy5zdG9yYWdlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZ2V0U2l6ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9zZXRTaXplOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgZ3V0dGVycywgY2hpbGRyZW5fc2l6ZXMsIGk7XG4gICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSBlbGVtZW50LmNoaWxkcmVuKFwiLnNwbGl0LWJsb2NrXCIpO1xuXG4gICAgICAgICAgICBndXR0ZXJzID0gZWxlbWVudC5jaGlsZHJlbihcIi5ndXR0ZXJcIik7XG5cbiAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZShvLnNwbGl0U2l6ZXMpKSB7XG4gICAgICAgICAgICAgICAgY2hpbGRyZW4uY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgZmxleEJhc2lzOiBcImNhbGMoXCIrKDEwMC9jaGlsZHJlbi5sZW5ndGgpK1wiJSAtIFwiKyhndXR0ZXJzLmxlbmd0aCAqIG8uZ3V0dGVyU2l6ZSkrXCJweClcIlxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNoaWxkcmVuX3NpemVzID0gby5zcGxpdFNpemVzLnRvQXJyYXkoKTtcbiAgICAgICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCBjaGlsZHJlbl9zaXplcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAkKGNoaWxkcmVuW2ldKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxleEJhc2lzOiBcImNhbGMoXCIrY2hpbGRyZW5fc2l6ZXNbaV0rXCIlIC0gXCIrKGd1dHRlcnMubGVuZ3RoICogby5ndXR0ZXJTaXplKStcInB4KVwiXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGd1dHRlcnMgPSBlbGVtZW50LmNoaWxkcmVuKFwiLmd1dHRlclwiKTtcblxuICAgICAgICAgICAgZ3V0dGVycy5vbihNZXRyby5ldmVudHMuc3RhcnRBbGwsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIHZhciB3ID0gby5zcGxpdE1vZGUgPT09IFwiaG9yaXpvbnRhbFwiID8gZWxlbWVudC53aWR0aCgpIDogZWxlbWVudC5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICB2YXIgZ3V0dGVyID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgcHJldl9ibG9jayA9IGd1dHRlci5wcmV2KFwiLnNwbGl0LWJsb2NrXCIpO1xuICAgICAgICAgICAgICAgIHZhciBuZXh0X2Jsb2NrID0gZ3V0dGVyLm5leHQoXCIuc3BsaXQtYmxvY2tcIik7XG4gICAgICAgICAgICAgICAgdmFyIHByZXZfYmxvY2tfc2l6ZSA9IDEwMCAqIChvLnNwbGl0TW9kZSA9PT0gXCJob3Jpem9udGFsXCIgPyBwcmV2X2Jsb2NrLm91dGVyV2lkdGgodHJ1ZSkgOiBwcmV2X2Jsb2NrLm91dGVySGVpZ2h0KHRydWUpKSAvIHc7XG4gICAgICAgICAgICAgICAgdmFyIG5leHRfYmxvY2tfc2l6ZSA9IDEwMCAqIChvLnNwbGl0TW9kZSA9PT0gXCJob3Jpem9udGFsXCIgPyBuZXh0X2Jsb2NrLm91dGVyV2lkdGgodHJ1ZSkgOiBuZXh0X2Jsb2NrLm91dGVySGVpZ2h0KHRydWUpKSAvIHc7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXJ0X3BvcyA9IFV0aWxzLmdldEN1cnNvclBvc2l0aW9uKGVsZW1lbnRbMF0sIGUpO1xuXG4gICAgICAgICAgICAgICAgZ3V0dGVyLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuXG4gICAgICAgICAgICAgICAgcHJldl9ibG9jay5hZGRDbGFzcyhcInN0b3AtcG9pbnRlclwiKTtcbiAgICAgICAgICAgICAgICBuZXh0X2Jsb2NrLmFkZENsYXNzKFwic3RvcC1wb2ludGVyXCIpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwicmVzaXplLXN0YXJ0XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zOiBzdGFydF9wb3MsXG4gICAgICAgICAgICAgICAgICAgIGd1dHRlcjogZ3V0dGVyWzBdLFxuICAgICAgICAgICAgICAgICAgICBwcmV2QmxvY2s6IHByZXZfYmxvY2tbMF0sXG4gICAgICAgICAgICAgICAgICAgIG5leHRCbG9jazogbmV4dF9ibG9ja1swXVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgJCh3aW5kb3cpLm9uKE1ldHJvLmV2ZW50cy5tb3ZlQWxsLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBvcyA9IFV0aWxzLmdldEN1cnNvclBvc2l0aW9uKGVsZW1lbnRbMF0sIGUpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3X3BvcztcblxuICAgICAgICAgICAgICAgICAgICBpZiAoby5zcGxpdE1vZGUgPT09IFwiaG9yaXpvbnRhbFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdfcG9zID0gKHBvcy54ICogMTAwIC8gdykgLSAoc3RhcnRfcG9zLnggKiAxMDAgLyB3KTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3X3BvcyA9IChwb3MueSAqIDEwMCAvIHcpIC0gKHN0YXJ0X3Bvcy55ICogMTAwIC8gdyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBwcmV2X2Jsb2NrLmNzcyhcImZsZXgtYmFzaXNcIiwgXCJjYWxjKFwiICsgKHByZXZfYmxvY2tfc2l6ZSArIG5ld19wb3MpICsgXCIlIC0gXCIrKGd1dHRlcnMubGVuZ3RoICogby5ndXR0ZXJTaXplKStcInB4KVwiKTtcbiAgICAgICAgICAgICAgICAgICAgbmV4dF9ibG9jay5jc3MoXCJmbGV4LWJhc2lzXCIsIFwiY2FsYyhcIiArIChuZXh0X2Jsb2NrX3NpemUgLSBuZXdfcG9zKSArIFwiJSAtIFwiKyhndXR0ZXJzLmxlbmd0aCAqIG8uZ3V0dGVyU2l6ZSkrXCJweClcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwicmVzaXplLXNwbGl0XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvczogcG9zLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ3V0dGVyOiBndXR0ZXJbMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmV2QmxvY2s6IHByZXZfYmxvY2tbMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0QmxvY2s6IG5leHRfYmxvY2tbMF1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9LCB7bnM6IHRoYXQuaWR9KTtcblxuICAgICAgICAgICAgICAgICQod2luZG93KS5vbihNZXRyby5ldmVudHMuc3RvcEFsbCwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXJfcG9zO1xuXG4gICAgICAgICAgICAgICAgICAgIHByZXZfYmxvY2sucmVtb3ZlQ2xhc3MoXCJzdG9wLXBvaW50ZXJcIik7XG4gICAgICAgICAgICAgICAgICAgIG5leHRfYmxvY2sucmVtb3ZlQ2xhc3MoXCJzdG9wLXBvaW50ZXJcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fc2F2ZVNpemUoKTtcblxuICAgICAgICAgICAgICAgICAgICBndXR0ZXIucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgJCh3aW5kb3cpLm9mZihNZXRyby5ldmVudHMubW92ZUFsbCx7bnM6IHRoYXQuaWR9KTtcbiAgICAgICAgICAgICAgICAgICAgJCh3aW5kb3cpLm9mZihNZXRyby5ldmVudHMuc3RvcEFsbCx7bnM6IHRoYXQuaWR9KTtcblxuICAgICAgICAgICAgICAgICAgICBjdXJfcG9zID0gVXRpbHMuZ2V0Q3Vyc29yUG9zaXRpb24oZWxlbWVudFswXSwgZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwicmVzaXplLXN0b3BcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9zOiBjdXJfcG9zLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ3V0dGVyOiBndXR0ZXJbMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmV2QmxvY2s6IHByZXZfYmxvY2tbMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0QmxvY2s6IG5leHRfYmxvY2tbMF1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9LCB7bnM6IHRoYXQuaWR9KVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQod2luZG93KS5vbihNZXRyby5ldmVudHMucmVzaXplLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBndXR0ZXIgPSBlbGVtZW50LmNoaWxkcmVuKFwiLmd1dHRlclwiKTtcbiAgICAgICAgICAgICAgICB2YXIgcHJldl9ibG9jayA9IGd1dHRlci5wcmV2KFwiLnNwbGl0LWJsb2NrXCIpO1xuICAgICAgICAgICAgICAgIHZhciBuZXh0X2Jsb2NrID0gZ3V0dGVyLm5leHQoXCIuc3BsaXQtYmxvY2tcIik7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJyZXNpemUtd2luZG93XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgcHJldkJsb2NrOiBwcmV2X2Jsb2NrWzBdLFxuICAgICAgICAgICAgICAgICAgICBuZXh0QmxvY2s6IG5leHRfYmxvY2tbMF1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSwge25zOiB0aGF0LmlkfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3NhdmVTaXplOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgc3RvcmFnZSA9IHRoaXMuc3RvcmFnZSwgaXRlbXNTaXplID0gW107XG4gICAgICAgICAgICB2YXIgaWQgPSBlbGVtZW50LmF0dHIoXCJpZFwiKSB8fCB0aGlzLmlkO1xuXG4gICAgICAgICAgICBpZiAoby5zYXZlU3RhdGUgPT09IHRydWUgJiYgc3RvcmFnZSAhPT0gbnVsbCkge1xuXG4gICAgICAgICAgICAgICAgJC5lYWNoKGVsZW1lbnQuY2hpbGRyZW4oXCIuc3BsaXQtYmxvY2tcIiksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgaXRlbXNTaXplLnB1c2goaXRlbS5jc3MoXCJmbGV4LWJhc2lzXCIpKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChzdG9yYWdlKVxuICAgICAgICAgICAgICAgICAgICBzdG9yYWdlLnNldEl0ZW0odGhpcy5zdG9yYWdlS2V5ICsgaWQsIGl0ZW1zU2l6ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBfZ2V0U2l6ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHN0b3JhZ2UgPSB0aGlzLnN0b3JhZ2UsIGl0ZW1zU2l6ZSA9IFtdO1xuICAgICAgICAgICAgdmFyIGlkID0gZWxlbWVudC5hdHRyKFwiaWRcIikgfHwgdGhpcy5pZDtcblxuICAgICAgICAgICAgaWYgKG8uc2F2ZVN0YXRlID09PSB0cnVlICYmIHN0b3JhZ2UgIT09IG51bGwpIHtcblxuICAgICAgICAgICAgICAgIGl0ZW1zU2l6ZSA9IHN0b3JhZ2UuZ2V0SXRlbSh0aGlzLnN0b3JhZ2VLZXkgKyBpZCk7XG5cbiAgICAgICAgICAgICAgICAkLmVhY2goZWxlbWVudC5jaGlsZHJlbihcIi5zcGxpdC1ibG9ja1wiKSwgZnVuY3Rpb24oaSwgdil7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gJCh2KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoaXRlbXNTaXplKSAmJiBVdGlscy5pc1ZhbHVlKGl0ZW1zU2l6ZVtpXSkpIGl0ZW0uY3NzKFwiZmxleC1iYXNpc1wiLCBpdGVtc1NpemVbaV0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNpemU6IGZ1bmN0aW9uKHNpemUpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoc2l6ZSkpIHtcbiAgICAgICAgICAgICAgICBvLnNwbGl0U2l6ZXMgPSBzaXplO1xuICAgICAgICAgICAgICAgIHRoYXQuX3NldFNpemUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNoYW5nZVNpemUoKXtcbiAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IGVsZW1lbnQuYXR0cihcImRhdGEtc3BsaXQtc2l6ZXNcIik7XG4gICAgICAgICAgICAgICAgdGhhdC5zaXplKHNpemUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYXR0cmlidXRlTmFtZSA9PT0gJ2RhdGEtc3BsaXQtc2l6ZXMnKSB7XG4gICAgICAgICAgICAgICAgY2hhbmdlU2l6ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBndXR0ZXJzID0gZWxlbWVudC5jaGlsZHJlbihcIi5ndXR0ZXJcIik7XG4gICAgICAgICAgICBndXR0ZXJzLm9mZihNZXRyby5ldmVudHMuc3RhcnQpO1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBTdGVwcGVyRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgc3RlcHBlckRlZmVycmVkOiAwLFxuICAgICAgICB2aWV3OiBNZXRyby5zdGVwcGVyVmlldy5TUVVBUkUsIC8vIHNxdWFyZSwgY3ljbGUsIGRpYW1vbmRcbiAgICAgICAgc3RlcHM6IDMsXG4gICAgICAgIHN0ZXA6IDEsXG4gICAgICAgIHN0ZXBDbGljazogZmFsc2UsXG4gICAgICAgIGNsc1N0ZXBwZXI6IFwiXCIsXG4gICAgICAgIGNsc1N0ZXA6IFwiXCIsXG4gICAgICAgIGNsc0NvbXBsZXRlOiBcIlwiLFxuICAgICAgICBjbHNDdXJyZW50OiBcIlwiLFxuICAgICAgICBvblN0ZXA6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uU3RlcENsaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvblN0ZXBwZXJDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uc3RlcHBlclNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgU3RlcHBlckRlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgU3RlcHBlckRlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvU3RlcHBlclNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8uc3RlcHBlclNldHVwKHdpbmRvd1tcIm1ldHJvU3RlcHBlclNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ3N0ZXBwZXInLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgU3RlcHBlckRlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50OiAwXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAoby5zdGVwIDw9IDApIHtcbiAgICAgICAgICAgICAgICBvLnN0ZXAgPSAxO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdGVwcGVyKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwic3RlcHBlci1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdGVwcGVyOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgaTtcblxuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcInN0ZXBwZXJcIikuYWRkQ2xhc3Moby52aWV3KS5hZGRDbGFzcyhvLmNsc1N0ZXBwZXIpO1xuXG4gICAgICAgICAgICBmb3IoaSA9IDE7IGkgPD0gby5zdGVwczsgaSsrKSB7XG4gICAgICAgICAgICAgICAgJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcInN0ZXBcIikuYWRkQ2xhc3Moby5jbHNTdGVwKS5kYXRhKFwic3RlcFwiLCBpKS5odG1sKFwiPHNwYW4+XCIraStcIjwvc3Bhbj5cIikuYXBwZW5kVG8oZWxlbWVudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuY3VycmVudCA9IDE7XG4gICAgICAgICAgICB0aGlzLnRvU3RlcChvLnN0ZXApO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5zdGVwXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIHN0ZXAgPSAkKHRoaXMpLmRhdGEoXCJzdGVwXCIpO1xuICAgICAgICAgICAgICAgIGlmIChvLnN0ZXBDbGljayA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnRvU3RlcChzdGVwKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJzdGVwLWNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXA6IHN0ZXBcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbmV4dDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIHN0ZXBzID0gZWxlbWVudC5maW5kKFwiLnN0ZXBcIik7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnQgKyAxID4gc3RlcHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5jdXJyZW50Kys7XG5cbiAgICAgICAgICAgIHRoaXMudG9TdGVwKHRoaXMuY3VycmVudCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcHJldjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnQgLSAxID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5jdXJyZW50LS07XG5cbiAgICAgICAgICAgIHRoaXMudG9TdGVwKHRoaXMuY3VycmVudCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbGFzdDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLnRvU3RlcChlbGVtZW50LmZpbmQoXCIuc3RlcFwiKS5sZW5ndGgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGZpcnN0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy50b1N0ZXAoMSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9TdGVwOiBmdW5jdGlvbihzdGVwKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQoZWxlbWVudC5maW5kKFwiLnN0ZXBcIikuZ2V0KHN0ZXAgLSAxKSk7XG4gICAgICAgICAgICB2YXIgcHJldlN0ZXAgPSB0aGlzLmN1cnJlbnQ7XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5jdXJyZW50ID0gc3RlcDtcblxuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLnN0ZXBcIilcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJjb21wbGV0ZSBjdXJyZW50XCIpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKG8uY2xzQ3VycmVudClcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3Moby5jbHNDb21wbGV0ZSk7XG5cbiAgICAgICAgICAgIHRhcmdldC5hZGRDbGFzcyhcImN1cnJlbnRcIikuYWRkQ2xhc3Moby5jbHNDdXJyZW50KTtcbiAgICAgICAgICAgIHRhcmdldC5wcmV2QWxsKCkuYWRkQ2xhc3MoXCJjb21wbGV0ZVwiKS5hZGRDbGFzcyhvLmNsc0NvbXBsZXRlKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwic3RlcFwiLCB7XG4gICAgICAgICAgICAgICAgc3RlcDogdGhpcy5jdXJyZW50LFxuICAgICAgICAgICAgICAgIHByZXY6IHByZXZTdGVwXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLnN0ZXBcIik7XG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8pIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG5cbiAgICB2YXIgTWV0cm9TdG9yYWdlID0gZnVuY3Rpb24odHlwZSl7XG4gICAgICAgIHJldHVybiBuZXcgTWV0cm9TdG9yYWdlLmluaXQodHlwZSk7XG4gICAgfTtcblxuICAgIE1ldHJvU3RvcmFnZS5wcm90b3R5cGUgPSB7XG4gICAgICAgIHNldEtleTogZnVuY3Rpb24oa2V5KXtcbiAgICAgICAgICAgIHRoaXMua2V5ID0ga2V5XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0S2V5OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMua2V5O1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldEl0ZW06IGZ1bmN0aW9uKGtleSwgdmFsdWUpe1xuICAgICAgICAgICAgdGhpcy5zdG9yYWdlLnNldEl0ZW0odGhpcy5rZXkgKyBcIjpcIiArIGtleSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRJdGVtOiBmdW5jdGlvbihrZXksIGRlZmF1bHRfdmFsdWUsIHJldml2ZXIpe1xuICAgICAgICAgICAgdmFyIHJlc3VsdCwgdmFsdWU7XG5cbiAgICAgICAgICAgIHZhbHVlID0gdGhpcy5zdG9yYWdlLmdldEl0ZW0odGhpcy5rZXkgKyBcIjpcIiArIGtleSk7XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gSlNPTi5wYXJzZSh2YWx1ZSwgcmV2aXZlcik7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBVdGlscy5udmwocmVzdWx0LCBkZWZhdWx0X3ZhbHVlKTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRJdGVtUGFydDogZnVuY3Rpb24oa2V5LCBzdWJfa2V5LCBkZWZhdWx0X3ZhbHVlLCByZXZpdmVyKXtcbiAgICAgICAgICAgIHZhciBpO1xuICAgICAgICAgICAgdmFyIHZhbCA9IHRoaXMuZ2V0SXRlbShrZXksIGRlZmF1bHRfdmFsdWUsIHJldml2ZXIpO1xuXG4gICAgICAgICAgICBzdWJfa2V5ID0gc3ViX2tleS5zcGxpdChcIi0+XCIpO1xuICAgICAgICAgICAgZm9yKGkgPSAwOyBpIDwgc3ViX2tleS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhbCA9IHZhbFtzdWJfa2V5W2ldXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB2YWw7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVsSXRlbTogZnVuY3Rpb24oa2V5KXtcbiAgICAgICAgICAgIHRoaXMuc3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMua2V5ICsgXCI6XCIgKyBrZXkpXG4gICAgICAgIH0sXG5cbiAgICAgICAgc2l6ZTogZnVuY3Rpb24odW5pdCl7XG4gICAgICAgICAgICB2YXIgZGl2aWRlcjtcbiAgICAgICAgICAgIHN3aXRjaCAodW5pdCkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ20nOlxuICAgICAgICAgICAgICAgIGNhc2UgJ00nOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpdmlkZXIgPSAxMDI0ICogMTAyNDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgJ2snOlxuICAgICAgICAgICAgICAgIGNhc2UgJ0snOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpdmlkZXIgPSAxMDI0O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGVmYXVsdDogZGl2aWRlciA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcy5zdG9yYWdlKS5sZW5ndGggLyBkaXZpZGVyO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIE1ldHJvU3RvcmFnZS5pbml0ID0gZnVuY3Rpb24odHlwZSl7XG5cbiAgICAgICAgdGhpcy5rZXkgPSBcIlwiO1xuICAgICAgICB0aGlzLnN0b3JhZ2UgPSB0eXBlID8gdHlwZSA6IHdpbmRvdy5sb2NhbFN0b3JhZ2U7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIE1ldHJvU3RvcmFnZS5pbml0LnByb3RvdHlwZSA9IE1ldHJvU3RvcmFnZS5wcm90b3R5cGU7XG5cbiAgICBNZXRyby5zdG9yYWdlID0gTWV0cm9TdG9yYWdlKHdpbmRvdy5sb2NhbFN0b3JhZ2UpO1xuICAgIE1ldHJvLnNlc3Npb24gPSBNZXRyb1N0b3JhZ2Uod2luZG93LnNlc3Npb25TdG9yYWdlKTtcbn0oTWV0cm8pKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgU3RyZWFtZXJEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICBzdHJlYW1lckRlZmVycmVkOiAwLFxuICAgICAgICB3aGVlbDogdHJ1ZSxcbiAgICAgICAgd2hlZWxTdGVwOiAyMCxcbiAgICAgICAgZHVyYXRpb246IE1FVFJPX0FOSU1BVElPTl9EVVJBVElPTixcbiAgICAgICAgZGVmYXVsdENsb3NlZEljb246IFwiXCIsXG4gICAgICAgIGRlZmF1bHRPcGVuSWNvbjogXCJcIixcbiAgICAgICAgY2hhbmdlVXJpOiB0cnVlLFxuICAgICAgICBlbmNvZGVMaW5rOiB0cnVlLFxuICAgICAgICBjbG9zZWQ6IGZhbHNlLFxuICAgICAgICBjaHJvbWVOb3RpY2U6IGZhbHNlLFxuICAgICAgICBzdGFydEZyb206IG51bGwsXG4gICAgICAgIHNsaWRlVG9TdGFydDogdHJ1ZSxcbiAgICAgICAgc3RhcnRTbGlkZVNsZWVwOiAxMDAwLFxuICAgICAgICBzb3VyY2U6IG51bGwsXG4gICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgIGV2ZW50Q2xpY2s6IFwic2VsZWN0XCIsXG4gICAgICAgIHNlbGVjdEdsb2JhbDogdHJ1ZSxcbiAgICAgICAgc3RyZWFtU2VsZWN0OiBmYWxzZSxcbiAgICAgICAgZXhjbHVkZVNlbGVjdEVsZW1lbnQ6IG51bGwsXG4gICAgICAgIGV4Y2x1ZGVDbGlja0VsZW1lbnQ6IG51bGwsXG4gICAgICAgIGV4Y2x1ZGVFbGVtZW50OiBudWxsLFxuICAgICAgICBleGNsdWRlU2VsZWN0Q2xhc3M6IFwiXCIsXG4gICAgICAgIGV4Y2x1ZGVDbGlja0NsYXNzOiBcIlwiLFxuICAgICAgICBleGNsdWRlQ2xhc3M6IFwiXCIsXG5cbiAgICAgICAgb25EYXRhTG9hZDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EYXRhTG9hZGVkOiBNZXRyby5ub29wLFxuICAgICAgICBvbkRhdGFMb2FkRXJyb3I6IE1ldHJvLm5vb3AsXG5cbiAgICAgICAgb25EcmF3RXZlbnQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uRHJhd0dsb2JhbEV2ZW50OiBNZXRyby5ub29wLFxuICAgICAgICBvbkRyYXdTdHJlYW06IE1ldHJvLm5vb3AsXG5cbiAgICAgICAgb25TdHJlYW1DbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25TdHJlYW1TZWxlY3Q6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uRXZlbnRDbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25FdmVudFNlbGVjdDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25FdmVudHNTY3JvbGw6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uU3RyZWFtZXJDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8uc3RyZWFtZXJTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIFN0cmVhbWVyRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBTdHJlYW1lckRlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvU3RyZWFtZXJTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLnN0cmVhbWVyU2V0dXAod2luZG93W1wibWV0cm9TdHJlYW1lclNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ3N0cmVhbWVyJywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIFN0cmVhbWVyRGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgICAgICAgICAgc2Nyb2xsOiAwLFxuICAgICAgICAgICAgICAgIHNjcm9sbERpcjogXCJsZWZ0XCIsXG4gICAgICAgICAgICAgICAgZXZlbnRzOiBudWxsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwic3RyZWFtZXJcIik7XG5cbiAgICAgICAgICAgIGlmIChlbGVtZW50LmF0dHIoXCJpZFwiKSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwiaWRcIiwgVXRpbHMuZWxlbWVudElkKFwic3RyZWFtZXJcIikpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5zb3VyY2UgPT09IG51bGwgJiYgby5kYXRhID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJzdHJlYW1zXCIpLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiZXZlbnRzLWFyZWFcIikuYXBwZW5kVG8oZWxlbWVudCk7XG5cbiAgICAgICAgICAgIGlmIChvLnNvdXJjZSAhPT0gbnVsbCkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiZGF0YS1sb2FkXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlOiBvLnNvdXJjZVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fbG9hZFNvdXJjZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSBvLmRhdGE7XG4gICAgICAgICAgICAgICAgdGhpcy5idWlsZCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5jaHJvbWVOb3RpY2UgPT09IHRydWUgJiYgVXRpbHMuZGV0ZWN0Q2hyb21lKCkgPT09IHRydWUgJiYgJC50b3VjaGFibGUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgJChcIjxwPlwiKS5hZGRDbGFzcyhcInRleHQtc21hbGwgdGV4dC1tdXRlZFwiKS5odG1sKFwiKikgSW4gQ2hyb21lIGJyb3dzZXIgcGxlYXNlIHByZXNzIGFuZCBob2xkIFNoaWZ0IGFuZCB0dXJuIHRoZSBtb3VzZSB3aGVlbC5cIikuaW5zZXJ0QWZ0ZXIoZWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2xvYWRTb3VyY2U6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGZldGNoKG8uc291cmNlKVxuICAgICAgICAgICAgICAgIC50aGVuKE1ldHJvLmZldGNoLnN0YXR1cylcbiAgICAgICAgICAgICAgICAudGhlbihNZXRyby5mZXRjaC5qc29uKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJkYXRhLWxvYWRlZFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2U6IG8uc291cmNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0LmRhdGEgPSBkYXRhO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmJ1aWxkKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImRhdGEtbG9hZC1lcnJvclwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2U6IG8uc291cmNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGJ1aWxkOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zLCBkYXRhID0gdGhpcy5kYXRhO1xuICAgICAgICAgICAgdmFyIHN0cmVhbXMgPSBlbGVtZW50LmZpbmQoXCIuc3RyZWFtc1wiKS5odG1sKFwiXCIpO1xuICAgICAgICAgICAgdmFyIGV2ZW50c19hcmVhID0gZWxlbWVudC5maW5kKFwiLmV2ZW50cy1hcmVhXCIpLmh0bWwoXCJcIik7XG4gICAgICAgICAgICB2YXIgZmFrZV90aW1lbGluZTtcbiAgICAgICAgICAgIHZhciB0aW1lbGluZSA9ICQoXCI8dWw+XCIpLmFkZENsYXNzKFwic3RyZWFtZXItdGltZWxpbmVcIikuaHRtbChcIlwiKS5hcHBlbmRUbyhldmVudHNfYXJlYSk7XG4gICAgICAgICAgICB2YXIgc3RyZWFtZXJfZXZlbnRzID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwic3RyZWFtZXItZXZlbnRzXCIpLmFwcGVuZFRvKGV2ZW50c19hcmVhKTtcbiAgICAgICAgICAgIHZhciBldmVudF9ncm91cF9tYWluID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiZXZlbnQtZ3JvdXBcIikuYXBwZW5kVG8oc3RyZWFtZXJfZXZlbnRzKTtcbiAgICAgICAgICAgIHZhciBTdHJlYW1lcklEUyA9IFV0aWxzLmdldFVSSVBhcmFtZXRlcihudWxsLCBcIlN0cmVhbWVySURTXCIpO1xuXG4gICAgICAgICAgICBpZiAoU3RyZWFtZXJJRFMgIT09IG51bGwgJiYgby5lbmNvZGVMaW5rID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgU3RyZWFtZXJJRFMgPSBhdG9iKFN0cmVhbWVySURTKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIFN0cmVhbWVySURTX2kgPSBTdHJlYW1lcklEUyA/IFN0cmVhbWVySURTLnNwbGl0KFwifFwiKVswXSA6IG51bGw7XG4gICAgICAgICAgICB2YXIgU3RyZWFtZXJJRFNfYSA9IFN0cmVhbWVySURTID8gU3RyZWFtZXJJRFMuc3BsaXQoXCJ8XCIpWzFdLnNwbGl0KFwiLFwiKSA6IFtdO1xuXG4gICAgICAgICAgICBpZiAoZGF0YS5hY3Rpb25zICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgYWN0aW9ucyA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInN0cmVhbWVyLWFjdGlvbnNcIikuYXBwZW5kVG8oc3RyZWFtcyk7XG4gICAgICAgICAgICAgICAgJC5lYWNoKGRhdGEuYWN0aW9ucywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYnV0dG9uID0gJChcIjxidXR0b24+XCIpLmFkZENsYXNzKFwic3RyZWFtZXItYWN0aW9uXCIpLmFkZENsYXNzKGl0ZW0uY2xzKS5odG1sKGl0ZW0uaHRtbCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLm9uY2xpY2sgIT09IHVuZGVmaW5lZCkgYnV0dG9uLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLmV4ZWMoaXRlbS5vbmNsaWNrLCBbZWxlbWVudF0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmFwcGVuZFRvKGFjdGlvbnMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDcmVhdGUgdGltZWxpbmVcblxuICAgICAgICAgICAgdGltZWxpbmUuaHRtbChcIlwiKTtcblxuICAgICAgICAgICAgaWYgKGRhdGEudGltZWxpbmUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGRhdGEudGltZWxpbmUgPSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBcIjA5OjAwXCIsXG4gICAgICAgICAgICAgICAgICAgIHN0b3A6IFwiMTg6MDBcIixcbiAgICAgICAgICAgICAgICAgICAgc3RlcDogMjBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzdGFydCA9IG5ldyBEYXRlKCksIHN0b3AgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgdmFyIHN0YXJ0X3RpbWVfYXJyYXkgPSBkYXRhLnRpbWVsaW5lLnN0YXJ0ID8gZGF0YS50aW1lbGluZS5zdGFydC5zcGxpdChcIjpcIikgOiBbOSwwXTtcbiAgICAgICAgICAgIHZhciBzdG9wX3RpbWVfYXJyYXkgPSBkYXRhLnRpbWVsaW5lLnN0b3AgPyBkYXRhLnRpbWVsaW5lLnN0b3Auc3BsaXQoXCI6XCIpIDogWzE4LDBdO1xuICAgICAgICAgICAgdmFyIHN0ZXAgPSBkYXRhLnRpbWVsaW5lLnN0ZXAgPyBwYXJzZUludChkYXRhLnRpbWVsaW5lLnN0ZXApICogNjAgOiAxMjAwO1xuXG4gICAgICAgICAgICBzdGFydC5zZXRIb3VycyhzdGFydF90aW1lX2FycmF5WzBdKTtcbiAgICAgICAgICAgIHN0YXJ0LnNldE1pbnV0ZXMoc3RhcnRfdGltZV9hcnJheVsxXSk7XG4gICAgICAgICAgICBzdGFydC5zZXRTZWNvbmRzKDApO1xuXG4gICAgICAgICAgICBzdG9wLnNldEhvdXJzKHN0b3BfdGltZV9hcnJheVswXSk7XG4gICAgICAgICAgICBzdG9wLnNldE1pbnV0ZXMoc3RvcF90aW1lX2FycmF5WzFdKTtcbiAgICAgICAgICAgIHN0b3Auc2V0U2Vjb25kcygwKTtcblxuICAgICAgICAgICAgdmFyIGksIHQsIGgsIHYsIG0sIGosIGZtLCBsaSwgZmxpLCBmbGlfdztcblxuICAgICAgICAgICAgZm9yIChpID0gc3RhcnQuZ2V0VGltZSgpLzEwMDA7IGkgPD0gc3RvcC5nZXRUaW1lKCkvMTAwMDsgaSArPSBzdGVwKSB7XG4gICAgICAgICAgICAgICAgdCA9IG5ldyBEYXRlKGkgKiAxMDAwKTtcbiAgICAgICAgICAgICAgICBoID0gdC5nZXRIb3VycygpO1xuICAgICAgICAgICAgICAgIG0gPSB0LmdldE1pbnV0ZXMoKTtcbiAgICAgICAgICAgICAgICB2ID0gQ2FrZS5scGFkKGgsIDIsIFwiMFwiKStcIjpcIitDYWtlLmxwYWQobSwgMiwgXCIwXCIpO1xuXG4gICAgICAgICAgICAgICAgbGkgPSAkKFwiPGxpPlwiKS5kYXRhKFwidGltZVwiLCB2KS5hZGRDbGFzcyhcImpzLXRpbWUtcG9pbnQtXCIgKyB2LnJlcGxhY2UoXCI6XCIsIFwiLVwiKSkuaHRtbChcIjxlbT5cIit2K1wiPC9lbT5cIikuYXBwZW5kVG8odGltZWxpbmUpO1xuXG4gICAgICAgICAgICAgICAgZmxpX3cgPSBsaS53aWR0aCgpIC8gcGFyc2VJbnQoZGF0YS50aW1lbGluZS5zdGVwKTtcbiAgICAgICAgICAgICAgICBmYWtlX3RpbWVsaW5lID0gJChcIjx1bD5cIikuYWRkQ2xhc3MoXCJzdHJlYW1lci1mYWtlLXRpbWVsaW5lXCIpLmh0bWwoXCJcIikuYXBwZW5kVG8obGkpO1xuICAgICAgICAgICAgICAgIGZvcihqID0gMDsgaiA8IHBhcnNlSW50KGRhdGEudGltZWxpbmUuc3RlcCk7IGorKykge1xuICAgICAgICAgICAgICAgICAgICBmbSA9IG0gKyBqO1xuICAgICAgICAgICAgICAgICAgICB2ID0gQ2FrZS5scGFkKGgsIDIsIFwiMFwiKStcIjpcIitDYWtlLmxwYWQoZm0sIDIsIFwiMFwiKTtcbiAgICAgICAgICAgICAgICAgICAgZmxpID0gJChcIjxsaT5cIikuZGF0YShcInRpbWVcIiwgdikuYWRkQ2xhc3MoXCJqcy1mYWtlLXRpbWUtcG9pbnQtXCIgKyB2LnJlcGxhY2UoXCI6XCIsIFwiLVwiKSkuaHRtbChcInxcIikuYXBwZW5kVG8oZmFrZV90aW1lbGluZSk7XG4gICAgICAgICAgICAgICAgICAgIGZsaS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGZsaV93XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyAtLSBFbmQgdGltZWxpbmUgY3JlYXRvclxuXG4gICAgICAgICAgICBpZiAoZGF0YS5zdHJlYW1zICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAkLmVhY2goZGF0YS5zdHJlYW1zLCBmdW5jdGlvbihzdHJlYW1faW5kZXgpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3RyZWFtX2hlaWdodCA9IDc1LCByb3dzID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0cmVhbV9pdGVtID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0cmVhbSA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInN0cmVhbVwiKS5hZGRDbGFzcyh0aGlzLmNscykuYXBwZW5kVG8oc3RyZWFtcyk7XG4gICAgICAgICAgICAgICAgICAgIHN0cmVhbVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKHN0cmVhbV9pdGVtLmNscylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKFwib25lXCIsIGZhbHNlKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoXCJkYXRhXCIsIHN0cmVhbV9pdGVtLmRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInN0cmVhbS10aXRsZVwiKS5odG1sKHN0cmVhbV9pdGVtLnRpdGxlKS5hcHBlbmRUbyhzdHJlYW0pO1xuICAgICAgICAgICAgICAgICAgICAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJzdHJlYW0tc2Vjb25kYXJ5XCIpLmh0bWwoc3RyZWFtX2l0ZW0uc2Vjb25kYXJ5KS5hcHBlbmRUbyhzdHJlYW0pO1xuICAgICAgICAgICAgICAgICAgICAkKHN0cmVhbV9pdGVtLmljb24pLmFkZENsYXNzKFwic3RyZWFtLWljb25cIikuYXBwZW5kVG8oc3RyZWFtKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgYmcgPSBNZXRyby5jb2xvcnMudG9IRVgoVXRpbHMuZ2V0U3R5bGVPbmUoc3RyZWFtLCBcImJhY2tncm91bmQtY29sb3JcIikpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmcgPSBNZXRyby5jb2xvcnMudG9IRVgoVXRpbHMuZ2V0U3R5bGVPbmUoc3RyZWFtLCBcImNvbG9yXCIpKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RyZWFtX2V2ZW50cyA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInN0cmVhbS1ldmVudHNcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKFwiYmFja2dyb3VuZC1jb2xvclwiLCBiZylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKFwidGV4dC1jb2xvclwiLCBmZylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhldmVudF9ncm91cF9tYWluKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RyZWFtX2l0ZW0uZXZlbnRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChzdHJlYW1faXRlbS5ldmVudHMsIGZ1bmN0aW9uKGV2ZW50X2luZGV4KXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnRfaXRlbSA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvdyA9IGV2ZW50X2l0ZW0ucm93ID09PSB1bmRlZmluZWQgPyAxIDogcGFyc2VJbnQoZXZlbnRfaXRlbS5yb3cpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfaWNvbjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2lkID0gc3RyZWFtX2luZGV4K1wiOlwiK2V2ZW50X2luZGV4O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXN0b21faHRtbCA9IGV2ZW50X2l0ZW0uY3VzdG9tICE9PSB1bmRlZmluZWQgPyBldmVudF9pdGVtLmN1c3RvbSA6IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1c3RvbV9odG1sX29wZW4gPSBldmVudF9pdGVtLmN1c3RvbV9vcGVuICE9PSB1bmRlZmluZWQgPyBldmVudF9pdGVtLmN1c3RvbV9vcGVuIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VzdG9tX2h0bWxfY2xvc2UgPSBldmVudF9pdGVtLmN1c3RvbV9jbG9zZSAhPT0gdW5kZWZpbmVkID8gZXZlbnRfaXRlbS5jdXN0b21fY2xvc2UgOiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBldmVudDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudF9pdGVtLnNraXAgIT09IHVuZGVmaW5lZCAmJiBVdGlscy5ib29sKGV2ZW50X2l0ZW0uc2tpcCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudCA9ICQoXCI8ZGl2PlwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGF0YShcIm9yaWdpblwiLCBldmVudF9pdGVtKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGF0YShcInNpZFwiLCBzaWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKFwiZGF0YVwiLCBldmVudF9pdGVtLmRhdGEpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKFwidGltZVwiLCBldmVudF9pdGVtLnRpbWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKFwidGFyZ2V0XCIsIGV2ZW50X2l0ZW0udGFyZ2V0KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJzdHJlYW0tZXZlbnRcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKFwic2l6ZS1cIitldmVudF9pdGVtLnNpemUrKFtcImhhbGZcIiwgXCJvbmUtdGhpcmRcIl0uaW5jbHVkZXMoZXZlbnRfaXRlbS5zaXplKSA/IFwiXCIgOiBcInhcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhldmVudF9pdGVtLmNscylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZFRvKHN0cmVhbV9ldmVudHMpO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGltZV9wb2ludCA9IHRpbWVsaW5lLmZpbmQoXCIuanMtZmFrZS10aW1lLXBvaW50LVwiK3RoaXMudGltZS5yZXBsYWNlKFwiOlwiLCBcIi1cIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsZWZ0ID0gdGltZV9wb2ludC5vZmZzZXQoKS5sZWZ0IC0gc3RyZWFtX2V2ZW50cy5vZmZzZXQoKS5sZWZ0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b3AgPSA3NSAqIChyb3cgLSAxKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyb3cgPiByb3dzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd3MgPSByb3c7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IFwiYWJzb2x1dGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogbGVmdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiB0b3BcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzTnVsbChldmVudF9pdGVtLmh0bWwpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNsaWRlID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwic3RyZWFtLWV2ZW50LXNsaWRlXCIpLmFwcGVuZFRvKGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNsaWRlX2xvZ28gPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJzbGlkZS1sb2dvXCIpLmFwcGVuZFRvKHNsaWRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNsaWRlX2RhdGEgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJzbGlkZS1kYXRhXCIpLmFwcGVuZFRvKHNsaWRlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnRfaXRlbS5pY29uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc1RhZyhldmVudF9pdGVtLmljb24pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChldmVudF9pdGVtLmljb24pLmFkZENsYXNzKFwiaWNvblwiKS5hcHBlbmRUbyhzbGlkZV9sb2dvKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIjxpbWc+XCIpLmFkZENsYXNzKFwiaWNvblwiKS5hdHRyKFwic3JjXCIsIGV2ZW50X2l0ZW0uaWNvbikuYXBwZW5kVG8oc2xpZGVfbG9nbyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwidGltZVwiKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBiZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBmZ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5odG1sKGV2ZW50X2l0ZW0udGltZSkuYXBwZW5kVG8oc2xpZGVfbG9nbyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIjxkaXY+XCIpLmFkZENsYXNzKFwidGl0bGVcIikuaHRtbChldmVudF9pdGVtLnRpdGxlKS5hcHBlbmRUbyhzbGlkZV9kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIjxkaXY+XCIpLmFkZENsYXNzKFwic3VidGl0bGVcIikuaHRtbChldmVudF9pdGVtLnN1YnRpdGxlKS5hcHBlbmRUbyhzbGlkZV9kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiZGVzY1wiKS5odG1sKGV2ZW50X2l0ZW0uZGVzYykuYXBwZW5kVG8oc2xpZGVfZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG8uY2xvc2VkID09PSBmYWxzZSAmJiAoZWxlbWVudC5hdHRyKFwiaWRcIikgPT09IFN0cmVhbWVySURTX2kgJiYgU3RyZWFtZXJJRFNfYS5pbmRleE9mKHNpZCkgIT09IC0xKSB8fCBldmVudF9pdGVtLnNlbGVjdGVkID09PSB0cnVlIHx8IHBhcnNlSW50KGV2ZW50X2l0ZW0uc2VsZWN0ZWQpID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5hZGRDbGFzcyhcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG8uY2xvc2VkID09PSB0cnVlIHx8IGV2ZW50X2l0ZW0uY2xvc2VkID09PSB0cnVlIHx8IHBhcnNlSW50KGV2ZW50X2l0ZW0uY2xvc2VkKSA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2ljb24gPSBldmVudF9pdGVtLmNsb3NlZEljb24gIT09IHVuZGVmaW5lZCA/IFV0aWxzLmlzVGFnKGV2ZW50X2l0ZW0uY2xvc2VkSWNvbikgPyBldmVudF9pdGVtLmNsb3NlZEljb24gOiBcIjxzcGFuPlwiICsgZXZlbnRfaXRlbS5jbG9zZWRJY29uICsgXCI8L3NwYW4+XCIgOiBVdGlscy5pc1RhZyhvLmRlZmF1bHRDbG9zZWRJY29uKSA/IG8uZGVmYXVsdENsb3NlZEljb24gOiBcIjxzcGFuPlwiICsgby5kZWZhdWx0Q2xvc2VkSWNvbiArIFwiPC9zcGFuPlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChfaWNvbikuYWRkQ2xhc3MoXCJzdGF0ZS1pY29uXCIpLmFkZENsYXNzKGV2ZW50X2l0ZW0uY2xzQ2xvc2VkSWNvbikuYXBwZW5kVG8oc2xpZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGF0YShcImNsb3NlZFwiLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKFwidGFyZ2V0XCIsIGV2ZW50X2l0ZW0udGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LmFwcGVuZChjdXN0b21faHRtbF9vcGVuKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9pY29uID0gZXZlbnRfaXRlbS5vcGVuSWNvbiAhPT0gdW5kZWZpbmVkID8gVXRpbHMuaXNUYWcoZXZlbnRfaXRlbS5vcGVuSWNvbikgPyBldmVudF9pdGVtLm9wZW5JY29uIDogXCI8c3Bhbj5cIiArIGV2ZW50X2l0ZW0ub3Blbkljb24gKyBcIjwvc3Bhbj5cIiA6IFV0aWxzLmlzVGFnKG8uZGVmYXVsdE9wZW5JY29uKSA/IG8uZGVmYXVsdE9wZW5JY29uIDogXCI8c3Bhbj5cIiArIG8uZGVmYXVsdE9wZW5JY29uICsgXCI8L3NwYW4+XCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKF9pY29uKS5hZGRDbGFzcyhcInN0YXRlLWljb25cIikuYWRkQ2xhc3MoZXZlbnRfaXRlbS5jbHNPcGVuSWNvbikuYXBwZW5kVG8oc2xpZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGF0YShcImNsb3NlZFwiLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5hcHBlbmQoY3VzdG9tX2h0bWxfY2xvc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuYXBwZW5kKGN1c3RvbV9odG1sKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5odG1sKGV2ZW50X2l0ZW0uaHRtbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZHJhdy1ldmVudFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldmVudFswXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxhc3RfY2hpbGQgPSBzdHJlYW1fZXZlbnRzLmZpbmQoXCIuc3RyZWFtLWV2ZW50XCIpLmxhc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYXN0X2NoaWxkLmxlbmd0aCA+IDApIHN0cmVhbV9ldmVudHMub3V0ZXJXaWR0aChsYXN0X2NoaWxkWzBdLm9mZnNldExlZnQgKyBsYXN0X2NoaWxkLm91dGVyV2lkdGgoKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBzdHJlYW1fZXZlbnRzLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHN0cmVhbV9oZWlnaHQgKiByb3dzXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5zdHJlYW1cIikuZXEoc3RyZWFtX2V2ZW50cy5pbmRleCgpKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBzdHJlYW1faGVpZ2h0ICogcm93c1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJkcmF3LXN0cmVhbVwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW06IHN0cmVhbVswXVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZGF0YS5nbG9iYWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBzdHJlYW1lcl9ldmVudHNfbGVmdCA9IHN0cmVhbWVyX2V2ZW50cy5vZmZzZXQoKS5sZWZ0O1xuICAgICAgICAgICAgICAgICQuZWFjaChbJ2JlZm9yZScsICdhZnRlciddLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgZ2xvYmFsX2l0ZW0gPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5nbG9iYWxbZ2xvYmFsX2l0ZW1dICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChkYXRhLmdsb2JhbFtnbG9iYWxfaXRlbV0sIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50X2l0ZW0gPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBncm91cCA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImV2ZW50LWdyb3VwXCIpLmFkZENsYXNzKFwic2l6ZS1cIitldmVudF9pdGVtLnNpemUrKFtcImhhbGZcIiwgXCJvbmUtdGhpcmRcIl0uaW5jbHVkZXMoZXZlbnRfaXRlbS5zaXplKSA/IFwiXCIgOiBcInhcIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBldmVudHMgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJzdHJlYW0tZXZlbnRzIGdsb2JhbC1zdHJlYW1cIikuYXBwZW5kVG8oZ3JvdXApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBldmVudCA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInN0cmVhbS1ldmVudFwiKS5hcHBlbmRUbyhldmVudHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcImdsb2JhbC1ldmVudFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoZXZlbnRfaXRlbS5jbHMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKFwidGltZVwiLCBldmVudF9pdGVtLnRpbWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKFwib3JpZ2luXCIsIGV2ZW50X2l0ZW0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKFwiZGF0YVwiLCBldmVudF9pdGVtLmRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiZXZlbnQtdGl0bGVcIikuaHRtbChldmVudF9pdGVtLnRpdGxlKS5hcHBlbmRUbyhldmVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiZXZlbnQtc3VidGl0bGVcIikuaHRtbChldmVudF9pdGVtLnN1YnRpdGxlKS5hcHBlbmRUbyhldmVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiZXZlbnQtaHRtbFwiKS5odG1sKGV2ZW50X2l0ZW0uaHRtbCkuYXBwZW5kVG8oZXZlbnQpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxlZnQsIHQgPSB0aW1lbGluZS5maW5kKFwiLmpzLWZha2UtdGltZS1wb2ludC1cIit0aGlzLnRpbWUucmVwbGFjZShcIjpcIiwgXCItXCIpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGVmdCA9IHRbMF0ub2Zmc2V0TGVmdCAtIHN0cmVhbXMuZmluZChcIi5zdHJlYW1cIikub3V0ZXJXaWR0aCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0ID0gdC5vZmZzZXQoKS5sZWZ0IC0gc3RyZWFtZXJfZXZlbnRzX2xlZnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBcImFic29sdXRlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGxlZnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogXCIxMDAlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5hcHBlbmRUbyhzdHJlYW1lcl9ldmVudHMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZHJhdy1nbG9iYWwtZXZlbnRcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudDogZXZlbnRbMF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5kYXRhKFwic3RyZWFtXCIsIC0xKTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5ldmVudHMtYXJlYVwiKS5zY3JvbGxMZWZ0KDApO1xuXG4gICAgICAgICAgICB0aGlzLmV2ZW50cyA9IGVsZW1lbnQuZmluZChcIi5zdHJlYW0tZXZlbnRcIik7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICBpZiAoby5zdGFydEZyb20gIT09IG51bGwgJiYgby5zbGlkZVRvU3RhcnQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuc2xpZGVUbyhvLnN0YXJ0RnJvbSk7XG4gICAgICAgICAgICAgICAgfSwgby5zdGFydFNsaWRlU2xlZXApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJzdHJlYW1lci1jcmVhdGVcIik7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVTY3JvbGwoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfZmlyZVNjcm9sbDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBzY3JvbGxhYmxlID0gZWxlbWVudC5maW5kKFwiLmV2ZW50cy1hcmVhXCIpO1xuICAgICAgICAgICAgdmFyIG9sZFNjcm9sbCA9IHRoaXMuc2Nyb2xsO1xuXG4gICAgICAgICAgICBpZiAoc2Nyb2xsYWJsZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnNjcm9sbERpciA9IHRoaXMuc2Nyb2xsIDwgc2Nyb2xsYWJsZVswXS5zY3JvbGxMZWZ0ID8gXCJsZWZ0XCIgOiBcInJpZ2h0XCI7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbCA9IHNjcm9sbGFibGVbMF0uc2Nyb2xsTGVmdDtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiZXZlbnRzLXNjcm9sbFwiLCB7XG4gICAgICAgICAgICAgICAgc2Nyb2xsTGVmdDogc2Nyb2xsYWJsZVswXS5zY3JvbGxMZWZ0LFxuICAgICAgICAgICAgICAgIG9sZFNjcm9sbDogb2xkU2Nyb2xsLFxuICAgICAgICAgICAgICAgIHNjcm9sbERpcjogdGhhdC5zY3JvbGxEaXIsXG4gICAgICAgICAgICAgICAgZXZlbnRzOiAkLnRvQXJyYXkodGhpcy5ldmVudHMpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBkaXNhYmxlU2Nyb2xsKCkge1xuICAgICAgICAgICAgICAgIHZhciBzY3JvbGxUb3AgPSB3aW5kb3cucGFnZVlPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDtcbiAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsTGVmdCA9IHdpbmRvdy5wYWdlWE9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdDtcblxuICAgICAgICAgICAgICAgIHdpbmRvdy5vbnNjcm9sbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oc2Nyb2xsTGVmdCwgc2Nyb2xsVG9wKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlbmFibGVTY3JvbGwoKSB7XG4gICAgICAgICAgICAgICAgd2luZG93Lm9uc2Nyb2xsID0gZnVuY3Rpb24oKSB7fTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5zdHJlYW0tZXZlbnRcIikub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5zdHJlYW0tZXZlbnRcIiwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgdmFyIGV2ZW50ID0gJCh0aGlzKTtcblxuICAgICAgICAgICAgICAgIGlmIChvLmV4Y2x1ZGVDbGFzcyAhPT0gXCJcIiAmJiBldmVudC5oYXNDbGFzcyhvLmV4Y2x1ZGVDbGFzcykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoby5leGNsdWRlRWxlbWVudCAhPT0gbnVsbCAmJiAkKGUudGFyZ2V0KS5pcyhvLmV4Y2x1ZGVFbGVtZW50KSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChvLmNsb3NlZCA9PT0gZmFsc2UgJiYgZXZlbnQuZGF0YShcImNsb3NlZFwiKSAhPT0gdHJ1ZSAmJiBvLmV2ZW50Q2xpY2sgPT09ICdzZWxlY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvLmV4Y2x1ZGVTZWxlY3RDbGFzcyAhPT0gXCJcIiAmJiBldmVudC5oYXNDbGFzcyhvLmV4Y2x1ZGVTZWxlY3RDbGFzcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSAqL1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoby5leGNsdWRlU2VsZWN0RWxlbWVudCAhPT0gbnVsbCAmJiAkKGUudGFyZ2V0KS5pcyhvLmV4Y2x1ZGVTZWxlY3RFbGVtZW50KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSAqL1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5oYXNDbGFzcyhcImdsb2JhbC1ldmVudFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoby5zZWxlY3RHbG9iYWwgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnRvZ2dsZUNsYXNzKFwic2VsZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC50b2dnbGVDbGFzcyhcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoby5jaGFuZ2VVcmkgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fY2hhbmdlVVJJKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZXZlbnQtc2VsZWN0XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6IGV2ZW50WzBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogZXZlbnQuaGFzQ2xhc3MoXCJzZWxlY3RlZFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG8uZXhjbHVkZUNsaWNrQ2xhc3MgIT09IFwiXCIgJiYgZXZlbnQuaGFzQ2xhc3Moby5leGNsdWRlQ2xpY2tDbGFzcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSAqL1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvLmV4Y2x1ZGVDbGlja0VsZW1lbnQgIT09IG51bGwgJiYgJChlLnRhcmdldCkuaXMoby5leGNsdWRlQ2xpY2tFbGVtZW50KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSAqL1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZXZlbnQtY2xpY2tcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudDogZXZlbnRbMF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvLmNsb3NlZCA9PT0gdHJ1ZSB8fCBldmVudC5kYXRhKFwiY2xvc2VkXCIpID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldmVudC5kYXRhKFwidGFyZ2V0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHRhcmdldDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuc3RyZWFtXCIpLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuc3RyZWFtXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIHN0cmVhbSA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gc3RyZWFtLmluZGV4KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoby5zdHJlYW1TZWxlY3QgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5kYXRhKFwic3RyZWFtXCIpID09PSBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuc3RyZWFtLWV2ZW50XCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZGF0YShcInN0cmVhbVwiLCAtMSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5kYXRhKFwic3RyZWFtXCIsIGluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLnN0cmVhbS1ldmVudFwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmVuYWJsZVN0cmVhbShzdHJlYW0pO1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJzdHJlYW0tc2VsZWN0XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbTogc3RyZWFtXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInN0cmVhbS1jbGlja1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIHN0cmVhbTogc3RyZWFtXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKG8ud2hlZWwgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuZXZlbnRzLWFyZWFcIilcbiAgICAgICAgICAgICAgICAgICAgLm9mZihNZXRyby5ldmVudHMubW91c2V3aGVlbClcbiAgICAgICAgICAgICAgICAgICAgLm9uKE1ldHJvLmV2ZW50cy5tb3VzZXdoZWVsLCBmdW5jdGlvbihlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGUuZGVsdGFZID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsLCBzY3JvbGxhYmxlID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRpciA9IGUuZGVsdGFZID4gMCA/IC0xIDogMTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0ZXAgPSBvLndoZWVsU3RlcDtcblxuXG4gICAgICAgICAgICAgICAgICAgIHNjcm9sbCA9IHNjcm9sbGFibGUuc2Nyb2xsTGVmdCgpIC0gKCBkaXIgKiBzdGVwKTtcbiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsYWJsZS5zY3JvbGxMZWZ0KHNjcm9sbCk7XG5cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5ldmVudHMtYXJlYVwiKS5vZmYoXCJtb3VzZWVudGVyXCIpLm9uKFwibW91c2VlbnRlclwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZVNjcm9sbCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmV2ZW50cy1hcmVhXCIpLm9mZihcIm1vdXNlbGVhdmVcIikub24oXCJtb3VzZWxlYXZlXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVTY3JvbGwoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmV2ZW50cy1hcmVhXCIpLmxhc3QoKS5vZmYoXCJzY3JvbGxcIikub24oXCJzY3JvbGxcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlU2Nyb2xsKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKCQudG91Y2hhYmxlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5zdHJlYW1cIikub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5zdHJlYW1cIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0cmVhbSA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIHN0cmVhbS50b2dnbGVDbGFzcyhcImZvY3VzZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICQuZWFjaChlbGVtZW50LmZpbmQoXCIuc3RyZWFtXCIpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5pcyhzdHJlYW0pKSByZXR1cm4gO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcyhcImZvY3VzZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfY2hhbmdlVVJJOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGxpbmsgPSB0aGlzLmdldExpbmsoKTtcbiAgICAgICAgICAgIGhpc3RvcnkucHVzaFN0YXRlKHt9LCBkb2N1bWVudC50aXRsZSwgbGluayk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2xpZGVUbzogZnVuY3Rpb24odGltZSl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciB0YXJnZXQ7XG4gICAgICAgICAgICBpZiAodGltZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gJChlbGVtZW50LmZpbmQoXCIuc3RyZWFtZXItdGltZWxpbmUgbGlcIilbMF0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSAkKGVsZW1lbnQuZmluZChcIi5zdHJlYW1lci10aW1lbGluZSAuanMtdGltZS1wb2ludC1cIiArIHRpbWUucmVwbGFjZShcIjpcIiwgXCItXCIpKVswXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAuZmluZChcIi5ldmVudHMtYXJlYVwiKVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsTGVmdDogdGFyZ2V0WzBdLm9mZnNldExlZnQgLSBlbGVtZW50LmZpbmQoXCIuc3RyZWFtcyAuc3RyZWFtXCIpLm91dGVyV2lkdGgoKVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBkdXI6IG8uZHVyYXRpb25cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBlbmFibGVTdHJlYW06IGZ1bmN0aW9uKHN0cmVhbSl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBpbmRleCA9IHN0cmVhbS5pbmRleCgpLTE7XG4gICAgICAgICAgICBzdHJlYW0ucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKS5kYXRhKFwic3RyZWFtRGlzYWJsZWRcIiwgZmFsc2UpO1xuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLnN0cmVhbS1ldmVudHNcIikuZXEoaW5kZXgpLmZpbmQoXCIuc3RyZWFtLWV2ZW50XCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlzYWJsZVN0cmVhbTogZnVuY3Rpb24oc3RyZWFtKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gc3RyZWFtLmluZGV4KCktMTtcbiAgICAgICAgICAgIHN0cmVhbS5hZGRDbGFzcyhcImRpc2FibGVkXCIpLmRhdGEoXCJzdHJlYW1EaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZChcIi5zdHJlYW0tZXZlbnRzXCIpLmVxKGluZGV4KS5maW5kKFwiLnN0cmVhbS1ldmVudFwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZVN0cmVhbTogZnVuY3Rpb24oc3RyZWFtKXtcbiAgICAgICAgICAgIGlmIChzdHJlYW0uZGF0YShcInN0cmVhbURpc2FibGVkXCIpID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmFibGVTdHJlYW0oc3RyZWFtKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlU3RyZWFtKHN0cmVhbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0TGluazogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGV2ZW50cyA9IGVsZW1lbnQuZmluZChcIi5zdHJlYW0tZXZlbnRcIik7XG4gICAgICAgICAgICB2YXIgYSA9IFtdO1xuICAgICAgICAgICAgdmFyIGxpbms7XG4gICAgICAgICAgICB2YXIgb3JpZ2luID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG5cbiAgICAgICAgICAgICQuZWFjaChldmVudHMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGV2ZW50ID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZGF0YShcInNpZFwiKSA9PT0gdW5kZWZpbmVkIHx8ICFldmVudC5oYXNDbGFzcyhcInNlbGVjdGVkXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBhLnB1c2goZXZlbnQuZGF0YShcInNpZFwiKSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbGluayA9IGVsZW1lbnQuYXR0cihcImlkXCIpICsgXCJ8XCIgKyBhLmpvaW4oXCIsXCIpO1xuXG4gICAgICAgICAgICBpZiAoby5lbmNvZGVMaW5rID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgbGluayA9IGJ0b2EobGluayk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBVdGlscy51cGRhdGVVUklQYXJhbWV0ZXIob3JpZ2luLCBcIlN0cmVhbWVySURTXCIsIGxpbmspO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldFRpbWVzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgdGltZXMgPSBlbGVtZW50LmZpbmQoXCIuc3RyZWFtZXItdGltZWxpbmUgPiBsaVwiKTtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICAgICAgICAgICQuZWFjaCh0aW1lcywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgkKHRoaXMpLmRhdGEoXCJ0aW1lXCIpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRFdmVudHM6IGZ1bmN0aW9uKGV2ZW50X3R5cGUsIGluY2x1ZGVfZ2xvYmFsKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIGl0ZW1zLCBldmVudHMgPSBbXTtcblxuICAgICAgICAgICAgc3dpdGNoIChldmVudF90eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcInNlbGVjdGVkXCI6IGl0ZW1zID0gZWxlbWVudC5maW5kKFwiLnN0cmVhbS1ldmVudC5zZWxlY3RlZFwiKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcIm5vbi1zZWxlY3RlZFwiOiBpdGVtcyA9IGVsZW1lbnQuZmluZChcIi5zdHJlYW0tZXZlbnQ6bm90KC5zZWxlY3RlZClcIik7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IGl0ZW1zID0gZWxlbWVudC5maW5kKFwiLnN0cmVhbS1ldmVudFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJC5lYWNoKGl0ZW1zLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgb3JpZ2luO1xuXG4gICAgICAgICAgICAgICAgaWYgKGluY2x1ZGVfZ2xvYmFsICE9PSB0cnVlICYmIGl0ZW0ucGFyZW50KCkuaGFzQ2xhc3MoXCJnbG9iYWwtc3RyZWFtXCIpKSByZXR1cm4gO1xuXG4gICAgICAgICAgICAgICAgb3JpZ2luID0gaXRlbS5kYXRhKFwib3JpZ2luXCIpO1xuXG4gICAgICAgICAgICAgICAgZXZlbnRzLnB1c2gob3JpZ2luKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZXZlbnRzO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNvdXJjZTogZnVuY3Rpb24ocyl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgaWYgKHMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuc291cmNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJkYXRhLXNvdXJjZVwiLCBzKTtcblxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnNvdXJjZSA9IHM7XG4gICAgICAgICAgICB0aGlzLmNoYW5nZVNvdXJjZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRhdGFTZXQ6IGZ1bmN0aW9uKHMpe1xuICAgICAgICAgICAgaWYgKHMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuZGF0YTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmRhdGEgPSBzO1xuICAgICAgICAgICAgdGhpcy5jaGFuZ2VEYXRhKHMpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldFN0cmVhbWVyRGF0YTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRhdGE7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlRXZlbnQ6IGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgZXZlbnQgPSAkKGV2ZW50KTtcblxuICAgICAgICAgICAgaWYgKGV2ZW50Lmhhc0NsYXNzKFwiZ2xvYmFsLWV2ZW50XCIpICYmIG8uc2VsZWN0R2xvYmFsICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGV2ZW50Lmhhc0NsYXNzKFwic2VsZWN0ZWRcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdEV2ZW50KGV2ZW50LCBmYWxzZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0RXZlbnQoZXZlbnQsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNlbGVjdEV2ZW50OiBmdW5jdGlvbihldmVudCwgc3RhdGUpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgaWYgKHN0YXRlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBzdGF0ZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBldmVudCA9ICQoZXZlbnQpO1xuXG4gICAgICAgICAgICBpZiAoZXZlbnQuaGFzQ2xhc3MoXCJnbG9iYWwtZXZlbnRcIikgJiYgby5zZWxlY3RHbG9iYWwgIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc3RhdGUgPT09IHRydWUpIGV2ZW50LmFkZENsYXNzKFwic2VsZWN0ZWRcIik7IGVsc2UgZXZlbnQucmVtb3ZlQ2xhc3MoXCJzZWxlY3RlZFwiKTtcblxuICAgICAgICAgICAgaWYgKG8uY2hhbmdlVXJpID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5fY2hhbmdlVVJJKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImV2ZW50LXNlbGVjdFwiLCB7XG4gICAgICAgICAgICAgICAgZXZlbnQ6IGV2ZW50WzBdLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBzdGF0ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlU291cmNlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgbmV3X3NvdXJjZSA9IGVsZW1lbnQuYXR0cihcImRhdGEtc291cmNlXCIpO1xuXG4gICAgICAgICAgICBpZiAoU3RyaW5nKG5ld19zb3VyY2UpLnRyaW0oKSA9PT0gXCJcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG8uc291cmNlID0gbmV3X3NvdXJjZTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiZGF0YS1sb2FkXCIsIHtcbiAgICAgICAgICAgICAgICBzb3VyY2U6IG8uc291cmNlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5fbG9hZFNvdXJjZSgpO1xuXG4gICAgICAgICAgICAvLyAkLmpzb24oby5zb3VyY2UpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gICAgIHRoYXQuX2ZpcmVFdmVudChcImRhdGEtbG9hZGVkXCIsIHtcbiAgICAgICAgICAgIC8vICAgICAgICAgc291cmNlOiBvLnNvdXJjZSxcbiAgICAgICAgICAgIC8vICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgICAgLy8gICAgIH0pO1xuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vICAgICB0aGF0LmRhdGEgPSBkYXRhO1xuICAgICAgICAgICAgLy8gICAgIHRoYXQuYnVpbGQoKTtcbiAgICAgICAgICAgIC8vIH0sIGZ1bmN0aW9uKHhocil7XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gICAgIHRoYXQuX2ZpcmVFdmVudChcImRhdGEtbG9hZC1lcnJvclwiLCB7XG4gICAgICAgICAgICAvLyAgICAgICAgIHNvdXJjZTogby5zb3VyY2UsXG4gICAgICAgICAgICAvLyAgICAgICAgIHhocjogeGhyXG4gICAgICAgICAgICAvLyAgICAgfSk7XG4gICAgICAgICAgICAvLyB9KTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwic291cmNlLWNoYW5nZVwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VEYXRhOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIG9sZF9kYXRhID0gdGhpcy5kYXRhO1xuXG4gICAgICAgICAgICBvLmRhdGEgPSAgdHlwZW9mIGRhdGEgPT09ICdvYmplY3QnID8gZGF0YSA6IEpTT04ucGFyc2UoZWxlbWVudC5hdHRyKFwiZGF0YS1kYXRhXCIpKTtcblxuICAgICAgICAgICAgdGhpcy5kYXRhID0gby5kYXRhO1xuXG4gICAgICAgICAgICB0aGlzLmJ1aWxkKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImRhdGEtY2hhbmdlXCIsIHtcbiAgICAgICAgICAgICAgICBvbGREYXRhOiBvbGRfZGF0YSxcbiAgICAgICAgICAgICAgICBuZXdEYXRhOiBvLmRhdGFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZVN0cmVhbVNlbGVjdE9wdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBvLnN0cmVhbVNlbGVjdCA9IGVsZW1lbnQuYXR0cihcImRhdGEtc3RyZWFtLXNlbGVjdFwiKS50b0xvd2VyQ2FzZSgpID09PSBcInRydWVcIjtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHJpYnV0ZU5hbWUpe1xuICAgICAgICAgICAgc3dpdGNoIChhdHRyaWJ1dGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnZGF0YS1zb3VyY2UnOiB0aGlzLmNoYW5nZVNvdXJjZSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdkYXRhLWRhdGEnOiB0aGlzLmNoYW5nZURhdGEoKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnZGF0YS1zdHJlYW0tc2VsZWN0JzogdGhpcy5jaGFuZ2VTdHJlYW1TZWxlY3RPcHRpb24oKTsgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLnN0cmVhbS1ldmVudFwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuc3RyZWFtXCIpO1xuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwiLmV2ZW50cy1hcmVhXCIpLm9mZihNZXRyby5ldmVudHMubW91c2V3aGVlbCk7XG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCIuZXZlbnRzLWFyZWFcIikubGFzdCgpLm9mZihcInNjcm9sbFwiKTtcbiAgICAgICAgICAgIC8vIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuc3RyZWFtXCIpO1xuXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIFN3aXRjaERlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIHN3aXRjaERlZmVycmVkOiAwLFxuICAgICAgICBtYXRlcmlhbDogZmFsc2UsXG4gICAgICAgIHRyYW5zaXRpb246IHRydWUsXG4gICAgICAgIGNhcHRpb246IFwiXCIsXG4gICAgICAgIGNhcHRpb25Qb3NpdGlvbjogXCJyaWdodFwiLFxuICAgICAgICBjbHNTd2l0Y2g6IFwiXCIsXG4gICAgICAgIGNsc0NoZWNrOiBcIlwiLFxuICAgICAgICBjbHNDYXB0aW9uOiBcIlwiLFxuICAgICAgICB0ZXh0T246IFwiXCIsXG4gICAgICAgIHRleHRPZmY6IFwiXCIsXG4gICAgICAgIGxvY2FsZTogTUVUUk9fTE9DQUxFLFxuICAgICAgICBzaG93T25PZmY6IGZhbHNlLFxuICAgICAgICBvblN3aXRjaENyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5zd2l0Y2hTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIFN3aXRjaERlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgU3dpdGNoRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9Td2l0Y2hTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLnN3aXRjaFNldHVwKHdpbmRvd1tcIm1ldHJvU3dpdGNoU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnc3dpdGNoJywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIFN3aXRjaERlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICBsb2NhbGU6IG51bGxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY29udGFpbmVyIDtcbiAgICAgICAgICAgIHZhciBjaGVjayA9ICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJjaGVja1wiKTtcbiAgICAgICAgICAgIHZhciBjYXB0aW9uID0gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcImNhcHRpb25cIikuaHRtbChvLmNhcHRpb24pO1xuXG4gICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJ0eXBlXCIsIFwiY2hlY2tib3hcIik7XG5cbiAgICAgICAgICAgIGlmIChlbGVtZW50LmF0dHIoXCJyZWFkb25seVwiKSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5vbihcImNsaWNrXCIsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29udGFpbmVyID0gZWxlbWVudC53cmFwKFxuICAgICAgICAgICAgICAgICQoXCI8bGFiZWw+XCIpLmFkZENsYXNzKChvLm1hdGVyaWFsID09PSB0cnVlID8gXCIgc3dpdGNoLW1hdGVyaWFsIFwiIDogXCIgc3dpdGNoIFwiKSArIGVsZW1lbnRbMF0uY2xhc3NOYW1lKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgdGhpcy5jb21wb25lbnQgPSBjb250YWluZXI7XG5cbiAgICAgICAgICAgIGNoZWNrLmFwcGVuZFRvKGNvbnRhaW5lcik7XG4gICAgICAgICAgICBjYXB0aW9uLmFwcGVuZFRvKGNvbnRhaW5lcik7XG5cbiAgICAgICAgICAgIGlmIChvLnRyYW5zaXRpb24gPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJ0cmFuc2l0aW9uLW9uXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5jYXB0aW9uUG9zaXRpb24gPT09ICdsZWZ0Jykge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcImNhcHRpb24tbGVmdFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudFswXS5jbGFzc05hbWUgPSAnJztcblxuICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKG8uY2xzU3dpdGNoKTtcbiAgICAgICAgICAgIGNhcHRpb24uYWRkQ2xhc3Moby5jbHNDYXB0aW9uKTtcbiAgICAgICAgICAgIGNoZWNrLmFkZENsYXNzKG8uY2xzQ2hlY2spO1xuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5pcygnOmRpc2FibGVkJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmFibGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5pMThuKG8ubG9jYWxlKTtcbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInN3aXRjaC1jcmVhdGVcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wcm9wKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZW5hYmxlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnByb3AoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlU3RhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgaWYgKCFlbGVtZW50LmlzKFwiOmRpc2FibGVkXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbih2KXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5pcyhcIjpkaXNhYmxlZFwiKSkgcmV0dXJuIHRoaXM7XG5cbiAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZSh2KSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQucHJvcChcImNoZWNrZWRcIiwgIVV0aWxzLmJvb2woZWxlbWVudC5wcm9wKFwiY2hlY2tlZFwiKSkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnByb3AoXCJjaGVja2VkXCIsIHYgPT09IDEpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VMb2NhbGU6IGZ1bmN0aW9uKHdoZXJlLCB2YWwpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY2hlY2sgPSBlbGVtZW50LnNpYmxpbmdzKFwiLmNoZWNrXCIpO1xuXG4gICAgICAgICAgICBvW1widGV4dFwiK0Nha2UuY2FwaXRhbGl6ZSh3aGVyZSldID0gdmFsXG5cbiAgICAgICAgICAgIGNoZWNrLmF0dHIoXCJkYXRhLVwiK3doZXJlLCB2YWwpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGkxOG46IGZ1bmN0aW9uKGxvY2FsZSl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjaGVjayA9IGVsZW1lbnQuc2libGluZ3MoXCIuY2hlY2tcIik7XG4gICAgICAgICAgICB2YXIgb24sIG9mZjtcblxuICAgICAgICAgICAgby5sb2NhbGUgPSBsb2NhbGU7XG4gICAgICAgICAgICB0aGlzLmxvY2FsZSA9IE1ldHJvLmxvY2FsZXNbby5sb2NhbGVdICE9PSB1bmRlZmluZWQgPyBNZXRyby5sb2NhbGVzW28ubG9jYWxlXSA6IE1ldHJvLmxvY2FsZXNbXCJlbi1VU1wiXTtcblxuICAgICAgICAgICAgaWYgKG8uc2hvd09uT2ZmKSB7XG4gICAgICAgICAgICAgICAgb24gPSBlbGVtZW50LmF0dHIoXCJkYXRhLW9uXCIpIHx8IG8udGV4dE9uIHx8IHRoaXMubG9jYWxlLnN3aXRjaC5vbjtcbiAgICAgICAgICAgICAgICBvZmYgPSBlbGVtZW50LmF0dHIoXCJkYXRhLW9mZlwiKSB8fCBvLnRleHRPZmYgfHwgdGhpcy5sb2NhbGUuc3dpdGNoLm9mZjtcblxuICAgICAgICAgICAgICAgIGNoZWNrLmF0dHIoXCJkYXRhLW9uXCIsIG9uKTtcbiAgICAgICAgICAgICAgICBjaGVjay5hdHRyKFwiZGF0YS1vZmZcIiwgb2ZmKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY2hlY2sucmVtb3ZlQXR0cihcImRhdGEtb25cIik7XG4gICAgICAgICAgICAgICAgY2hlY2sucmVtb3ZlQXR0cihcImRhdGEtb2ZmXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0ciwgbmV3VmFsKXtcbiAgICAgICAgICAgIHN3aXRjaCAoYXR0cikge1xuICAgICAgICAgICAgICAgIGNhc2UgJ2RhdGEtb24nOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2RhdGEtdGV4dC1vbic6IHRoaXMuY2hhbmdlTG9jYWxlKCdvbicsIG5ld1ZhbCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2RhdGEtb2ZmJzpcbiAgICAgICAgICAgICAgICBjYXNlICdkYXRhLXRleHQtb2ZmJzogdGhpcy5jaGFuZ2VMb2NhbGUoJ29mZicsIG5ld1ZhbCk7IGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBUYWJsZURlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIHVzZUN1cnJlbnRTbGljZTogZmFsc2UsXG4gICAgICAgIHNob3dJbnNwZWN0b3JCdXR0b246IGZhbHNlLFxuICAgICAgICBpbnNwZWN0b3JCdXR0b25JY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tZXF1YWxpemVyJz5cIixcbiAgICAgICAgdGFibGVEZWZlcnJlZDogMCxcbiAgICAgICAgdGVtcGxhdGVCZWdpblRva2VuOiBcIjwlXCIsXG4gICAgICAgIHRlbXBsYXRlRW5kVG9rZW46IFwiJT5cIixcbiAgICAgICAgcGFnaW5hdGlvbkRpc3RhbmNlOiA1LFxuXG4gICAgICAgIGxvY2FsZTogTUVUUk9fTE9DQUxFLFxuXG4gICAgICAgIGhvcml6b250YWxTY3JvbGw6IGZhbHNlLFxuICAgICAgICBob3Jpem9udGFsU2Nyb2xsU3RvcDogbnVsbCxcbiAgICAgICAgY2hlY2s6IGZhbHNlLFxuICAgICAgICBjaGVja1R5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgICAgY2hlY2tTdHlsZTogMSxcbiAgICAgICAgY2hlY2tDb2xJbmRleDogMCxcbiAgICAgICAgY2hlY2tOYW1lOiBudWxsLFxuICAgICAgICBjaGVja1N0b3JlS2V5OiBcIlRBQkxFOiQxOktFWVNcIixcbiAgICAgICAgcm93bnVtOiBmYWxzZSxcbiAgICAgICAgcm93bnVtVGl0bGU6IFwiI1wiLFxuXG4gICAgICAgIGZpbHRlcnM6IG51bGwsXG4gICAgICAgIGZpbHRlcnNPcGVyYXRvcjogXCJhbmRcIixcblxuICAgICAgICBoZWFkOiBudWxsLFxuICAgICAgICBib2R5OiBudWxsLFxuICAgICAgICBzdGF0aWM6IGZhbHNlLFxuICAgICAgICBzb3VyY2U6IG51bGwsXG5cbiAgICAgICAgc2VhcmNoTWluTGVuZ3RoOiAxLFxuICAgICAgICBzZWFyY2hUaHJlc2hvbGQ6IDUwMCxcbiAgICAgICAgc2VhcmNoRmllbGRzOiBudWxsLFxuXG4gICAgICAgIHNob3dSb3dzU3RlcHM6IHRydWUsXG4gICAgICAgIHNob3dTZWFyY2g6IHRydWUsXG4gICAgICAgIHNob3dUYWJsZUluZm86IHRydWUsXG4gICAgICAgIHNob3dQYWdpbmF0aW9uOiB0cnVlLFxuICAgICAgICBwYWdpbmF0aW9uU2hvcnRNb2RlOiB0cnVlLFxuICAgICAgICBzaG93QWN0aXZpdHk6IHRydWUsXG4gICAgICAgIG11dGVUYWJsZTogdHJ1ZSxcbiAgICAgICAgc2hvd1NraXA6IGZhbHNlLFxuXG4gICAgICAgIHJvd3M6IDEwLFxuICAgICAgICByb3dzU3RlcHM6IFwiMTAsMjUsNTAsMTAwXCIsXG5cbiAgICAgICAgc3RhdGljVmlldzogZmFsc2UsXG4gICAgICAgIHZpZXdTYXZlTW9kZTogXCJjbGllbnRcIixcbiAgICAgICAgdmlld1NhdmVQYXRoOiBcIlRBQkxFOiQxOk9QVElPTlNcIixcblxuICAgICAgICBzb3J0RGlyOiBcImFzY1wiLFxuICAgICAgICBkZWNpbWFsU2VwYXJhdG9yOiBcIi5cIixcbiAgICAgICAgdGhvdXNhbmRTZXBhcmF0b3I6IFwiLFwiLFxuXG4gICAgICAgIHRhYmxlUm93c0NvdW50VGl0bGU6IG51bGwsXG4gICAgICAgIHRhYmxlU2VhcmNoVGl0bGU6IG51bGwsXG4gICAgICAgIHRhYmxlSW5mb1RpdGxlOiBudWxsLFxuICAgICAgICBwYWdpbmF0aW9uUHJldlRpdGxlOiBudWxsLFxuICAgICAgICBwYWdpbmF0aW9uTmV4dFRpdGxlOiBudWxsLFxuICAgICAgICBhbGxSZWNvcmRzVGl0bGU6IG51bGwsXG4gICAgICAgIGluc3BlY3RvclRpdGxlOiBudWxsLFxuICAgICAgICB0YWJsZVNraXBUaXRsZTogbnVsbCxcbiAgICAgICAgZW1wdHlUYWJsZVRpdGxlOiBudWxsLFxuXG4gICAgICAgIGFjdGl2aXR5VHlwZTogXCJhdG9tXCIsXG4gICAgICAgIGFjdGl2aXR5U3R5bGU6IFwiY29sb3JcIixcbiAgICAgICAgYWN0aXZpdHlUaW1lb3V0OiAxMDAsXG5cbiAgICAgICAgc2VhcmNoV3JhcHBlcjogbnVsbCxcbiAgICAgICAgcm93c1dyYXBwZXI6IG51bGwsXG4gICAgICAgIGluZm9XcmFwcGVyOiBudWxsLFxuICAgICAgICBwYWdpbmF0aW9uV3JhcHBlcjogbnVsbCxcbiAgICAgICAgc2tpcFdyYXBwZXI6IG51bGwsXG5cbiAgICAgICAgY2VsbFdyYXBwZXI6IHRydWUsXG5cbiAgICAgICAgY2xzQ29tcG9uZW50OiBcIlwiLFxuICAgICAgICBjbHNUYWJsZUNvbnRhaW5lcjogXCJcIixcbiAgICAgICAgY2xzVGFibGU6IFwiXCIsXG5cbiAgICAgICAgY2xzSGVhZDogXCJcIixcbiAgICAgICAgY2xzSGVhZFJvdzogXCJcIixcbiAgICAgICAgY2xzSGVhZENlbGw6IFwiXCIsXG5cbiAgICAgICAgY2xzQm9keTogXCJcIixcbiAgICAgICAgY2xzQm9keVJvdzogXCJcIixcbiAgICAgICAgY2xzQm9keUNlbGw6IFwiXCIsXG4gICAgICAgIGNsc0NlbGxXcmFwcGVyOiBcIlwiLFxuXG4gICAgICAgIGNsc0Zvb3RlcjogXCJcIixcbiAgICAgICAgY2xzRm9vdGVyUm93OiBcIlwiLFxuICAgICAgICBjbHNGb290ZXJDZWxsOiBcIlwiLFxuXG4gICAgICAgIGNsc1RhYmxlVG9wOiBcIlwiLFxuICAgICAgICBjbHNSb3dzQ291bnQ6IFwiXCIsXG4gICAgICAgIGNsc1NlYXJjaDogXCJcIixcblxuICAgICAgICBjbHNUYWJsZUJvdHRvbTogXCJcIixcbiAgICAgICAgY2xzVGFibGVJbmZvOiBcIlwiLFxuICAgICAgICBjbHNUYWJsZVBhZ2luYXRpb246IFwiXCIsXG5cbiAgICAgICAgY2xzUGFnaW5hdGlvbjogXCJcIixcbiAgICAgICAgY2xzVGFibGVTa2lwOiBcIlwiLFxuICAgICAgICBjbHNUYWJsZVNraXBJbnB1dDogXCJcIixcbiAgICAgICAgY2xzVGFibGVTa2lwQnV0dG9uOiBcIlwiLFxuXG4gICAgICAgIGNsc0V2ZW5Sb3c6IFwiXCIsXG4gICAgICAgIGNsc09kZFJvdzogXCJcIixcbiAgICAgICAgY2xzUm93OiBcIlwiLFxuXG4gICAgICAgIGNsc0VtcHR5VGFibGVUaXRsZTogXCJcIixcblxuICAgICAgICBvbkRyYXc6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uRHJhd1JvdzogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EcmF3Q2VsbDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25BcHBlbmRSb3c6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQXBwZW5kQ2VsbDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Tb3J0U3RhcnQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uU29ydFN0b3A6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uU29ydEl0ZW1Td2l0Y2g6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uU2VhcmNoOiBNZXRyby5ub29wLFxuICAgICAgICBvblJvd3NDb3VudENoYW5nZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EYXRhTG9hZDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25EYXRhTG9hZEVycm9yOiBNZXRyby5ub29wLFxuICAgICAgICBvbkRhdGFMb2FkZWQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uRGF0YUxvYWRFbmQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uRGF0YVNhdmVFcnJvcjogTWV0cm8ubm9vcCxcbiAgICAgICAgb25GaWx0ZXJSb3dBY2NlcHRlZDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25GaWx0ZXJSb3dEZWNsaW5lZDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25DaGVja0NsaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNoZWNrQ2xpY2tBbGw6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQ2hlY2tEcmF3OiBNZXRyby5ub29wLFxuICAgICAgICBvblZpZXdTYXZlOiBNZXRyby5ub29wLFxuICAgICAgICBvblZpZXdHZXQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uVmlld0NyZWF0ZWQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uVGFibGVDcmVhdGU6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uU2tpcDogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby50YWJsZVNldHVwID0gZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgICAgIFRhYmxlRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBUYWJsZURlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvVGFibGVTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLnRhYmxlU2V0dXAod2luZG93W1wibWV0cm9UYWJsZVNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ3RhYmxlJywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIFRhYmxlRGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRQYWdlOiAxLFxuICAgICAgICAgICAgICAgIHBhZ2VzQ291bnQ6IDEsXG4gICAgICAgICAgICAgICAgc2VhcmNoU3RyaW5nOiBcIlwiLFxuICAgICAgICAgICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgICAgICAgICAgYWN0aXZpdHk6IG51bGwsXG4gICAgICAgICAgICAgICAgbG9hZEFjdGl2aXR5OiBudWxsLFxuICAgICAgICAgICAgICAgIGJ1c3k6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGZpbHRlcnM6IFtdLFxuICAgICAgICAgICAgICAgIHdyYXBwZXJJbmZvOiBudWxsLFxuICAgICAgICAgICAgICAgIHdyYXBwZXJTZWFyY2g6IG51bGwsXG4gICAgICAgICAgICAgICAgd3JhcHBlclJvd3M6IG51bGwsXG4gICAgICAgICAgICAgICAgd3JhcHBlclBhZ2luYXRpb246IG51bGwsXG4gICAgICAgICAgICAgICAgd3JhcHBlclNraXA6IG51bGwsXG4gICAgICAgICAgICAgICAgZmlsdGVySW5kZXg6IG51bGwsXG4gICAgICAgICAgICAgICAgZmlsdGVyc0luZGV4ZXM6IFtdLFxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogbnVsbCxcbiAgICAgICAgICAgICAgICBpbnNwZWN0b3I6IG51bGwsXG4gICAgICAgICAgICAgICAgdmlldzoge30sXG4gICAgICAgICAgICAgICAgdmlld0RlZmF1bHQ6IHt9LFxuICAgICAgICAgICAgICAgIGxvY2FsZTogTWV0cm8ubG9jYWxlc1tcImVuLVVTXCJdLFxuICAgICAgICAgICAgICAgIGlucHV0X2ludGVydmFsOiBudWxsLFxuICAgICAgICAgICAgICAgIHNlYXJjaEZpZWxkczogW10sXG4gICAgICAgICAgICAgICAgaWQ6IFV0aWxzLmVsZW1lbnRJZCgndGFibGUnKSxcbiAgICAgICAgICAgICAgICBzb3J0OiB7XG4gICAgICAgICAgICAgICAgICAgIGRpcjogXCJhc2NcIixcbiAgICAgICAgICAgICAgICAgICAgY29sSW5kZXg6IDBcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNlcnZpY2U6IFtdLFxuICAgICAgICAgICAgICAgIGhlYWRzOiBbXSxcbiAgICAgICAgICAgICAgICBpdGVtczogW10sXG4gICAgICAgICAgICAgICAgZm9vdHM6IFtdLFxuICAgICAgICAgICAgICAgIGZpbHRlcmVkSXRlbXM6IFtdLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRTbGljZTogW10sXG4gICAgICAgICAgICAgICAgaW5kZXg6IHt9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBpZCA9IFV0aWxzLmVsZW1lbnRJZChcInRhYmxlXCIpO1xuICAgICAgICAgICAgdmFyIHRhYmxlX2NvbXBvbmVudCwgdGFibGVfY29udGFpbmVyLCBhY3Rpdml0eTtcblxuICAgICAgICAgICAgaWYgKCFVdGlscy5pc1ZhbHVlKGVsZW1lbnQuYXR0cihcImlkXCIpKSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcImlkXCIsIGlkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoTWV0cm8ubG9jYWxlc1tvLmxvY2FsZV0pKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2NhbGUgPSBNZXRyby5sb2NhbGVzW28ubG9jYWxlXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5zZWFyY2hGaWVsZHMpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hGaWVsZHMgPSBvLnNlYXJjaEZpZWxkcy50b0FycmF5KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8uaGVhZCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgX2hlYWQgPSBvLmhlYWQ7XG4gICAgICAgICAgICAgICAgby5oZWFkID0gVXRpbHMuaXNPYmplY3Qoby5oZWFkKTtcbiAgICAgICAgICAgICAgICBpZiAoIW8uaGVhZCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJIZWFkIFwiK19oZWFkK1wiIGRlZmluZWQgYnV0IG5vdCBleGlzdHMhXCIpO1xuICAgICAgICAgICAgICAgICAgICBvLmhlYWQgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5ib2R5KSkge1xuICAgICAgICAgICAgICAgIHZhciBfYm9keSA9IG8uYm9keTtcbiAgICAgICAgICAgICAgICBvLmJvZHkgPSBVdGlscy5pc09iamVjdChvLmJvZHkpO1xuICAgICAgICAgICAgICAgIGlmICghby5ib2R5KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcIkJvZHkgXCIrX2JvZHkrXCIgZGVmaW5lZCBidXQgbm90IGV4aXN0cyFcIik7XG4gICAgICAgICAgICAgICAgICAgIG8uYm9keSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5zdGF0aWMgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBvLnNob3dQYWdpbmF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgby5zaG93Um93c1N0ZXBzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgby5zaG93U2VhcmNoID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgby5zaG93VGFibGVJbmZvID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgby5zaG93U2tpcCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIG8ucm93cyA9IC0xO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0YWJsZV9jb21wb25lbnQgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJ0YWJsZS1jb21wb25lbnRcIik7XG4gICAgICAgICAgICB0YWJsZV9jb21wb25lbnQuaW5zZXJ0QmVmb3JlKGVsZW1lbnQpO1xuXG4gICAgICAgICAgICB0YWJsZV9jb250YWluZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJ0YWJsZS1jb250YWluZXJcIikuYWRkQ2xhc3Moby5jbHNUYWJsZUNvbnRhaW5lcikuYXBwZW5kVG8odGFibGVfY29tcG9uZW50KTtcbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kVG8odGFibGVfY29udGFpbmVyKTtcblxuICAgICAgICAgICAgaWYgKG8uaG9yaXpvbnRhbFNjcm9sbCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRhYmxlX2NvbnRhaW5lci5hZGRDbGFzcyhcImhvcml6b250YWwtc2Nyb2xsXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFVdGlscy5pc051bGwoby5ob3Jpem9udGFsU2Nyb2xsU3RvcCkgJiYgVXRpbHMubWVkaWFFeGlzdChvLmhvcml6b250YWxTY3JvbGxTdG9wKSkge1xuICAgICAgICAgICAgICAgIHRhYmxlX2NvbnRhaW5lci5yZW1vdmVDbGFzcyhcImhvcml6b250YWwtc2Nyb2xsXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0YWJsZV9jb21wb25lbnQuYWRkQ2xhc3Moby5jbHNDb21wb25lbnQpO1xuXG4gICAgICAgICAgICB0aGlzLmFjdGl2aXR5ID0gICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInRhYmxlLXByb2dyZXNzXCIpLmFwcGVuZFRvKHRhYmxlX2NvbXBvbmVudCk7XG5cbiAgICAgICAgICAgIGFjdGl2aXR5ID0gJChcIjxkaXY+XCIpLmFwcGVuZFRvKHRoaXMuYWN0aXZpdHkpO1xuICAgICAgICAgICAgTWV0cm8ubWFrZVBsdWdpbihhY3Rpdml0eSwgXCJhY3Rpdml0eVwiLCB7XG4gICAgICAgICAgICAgICAgdHlwZTogby5hY3Rpdml0eVR5cGUsXG4gICAgICAgICAgICAgICAgc3R5bGU6IG8uYWN0aXZpdHlTdHlsZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChvLnNob3dBY3Rpdml0eSAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZpdHkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogXCJoaWRkZW5cIlxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50ID0gdGFibGVfY29tcG9uZW50WzBdO1xuXG4gICAgICAgICAgICBpZiAoby5zb3VyY2UgIT09IG51bGwpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImRhdGEtbG9hZFwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZTogby5zb3VyY2VcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHZhciBvYmpTb3VyY2UgPSBVdGlscy5pc09iamVjdChvLnNvdXJjZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAob2JqU291cmNlICE9PSBmYWxzZSAmJiAkLmlzUGxhaW5PYmplY3Qob2JqU291cmNlKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9idWlsZChvYmpTb3VyY2UpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZpdHkuc2hvdyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmZXRjaChvLnNvdXJjZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihNZXRyby5mZXRjaC5zdGF0dXMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oTWV0cm8uZmV0Y2guanNvbilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5hY3Rpdml0eS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSAhPT0gXCJvYmplY3RcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0YSBmb3IgdGFibGUgaXMgbm90IGEgb2JqZWN0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZGF0YS1sb2FkZWRcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBvLnNvdXJjZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fYnVpbGQoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3Ipe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmFjdGl2aXR5LmhpZGUoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJkYXRhLWxvYWQtZXJyb3JcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBvLnNvdXJjZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBlcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGF0Ll9idWlsZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVJbmRleDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgY29sSW5kZXggPSB0aGlzLm9wdGlvbnMuY2hlY2tDb2xJbmRleDtcbiAgICAgICAgICAgIHNldEltbWVkaWF0ZShmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuaXRlbXMuZm9yRWFjaChmdW5jdGlvbih2LCBpKXtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5pbmRleFt2W2NvbEluZGV4XV0gPSBpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2J1aWxkOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciB2aWV3LCBpZCA9IGVsZW1lbnQuYXR0cihcImlkXCIpLCB2aWV3UGF0aDtcblxuICAgICAgICAgICAgby5yb3dzID0gK28ucm93cztcblxuICAgICAgICAgICAgdGhpcy5pdGVtcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5oZWFkcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5mb290cyA9IFtdO1xuXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvLmhlYWQpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oZWFkcyA9IG8uaGVhZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoby5ib2R5KSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBvLmJvZHk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlSXRlbXNGcm9tSlNPTihkYXRhKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlSXRlbXNGcm9tSFRNTCgpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSBpbmRleFxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlSW5kZXgoKTtcblxuICAgICAgICAgICAgdGhpcy52aWV3ID0gdGhpcy5fY3JlYXRlVmlldygpO1xuICAgICAgICAgICAgdGhpcy52aWV3RGVmYXVsdCA9IFV0aWxzLm9iamVjdENsb25lKHRoaXMudmlldyk7XG5cbiAgICAgICAgICAgIHZpZXdQYXRoID0gby52aWV3U2F2ZVBhdGgucmVwbGFjZShcIiQxXCIsIGlkKTtcblxuICAgICAgICAgICAgaWYgKG8udmlld1NhdmVNb2RlLnRvTG93ZXJDYXNlKCkgPT09IFwiY2xpZW50XCIpIHtcblxuICAgICAgICAgICAgICAgIHZpZXcgPSBNZXRyby5zdG9yYWdlLmdldEl0ZW0odmlld1BhdGgpO1xuICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKHZpZXcpICYmIFV0aWxzLm9iamVjdExlbmd0aCh2aWV3KSA9PT0gVXRpbHMub2JqZWN0TGVuZ3RoKHRoaXMudmlldykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3ID0gdmlldztcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJ2aWV3LWdldFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2U6IFwiY2xpZW50XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3OiB2aWV3XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9maW5hbCgpO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgZmV0Y2godmlld1BhdGgpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKE1ldHJvLmZldGNoLnN0YXR1cylcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oTWV0cm8uZmV0Y2guanNvbilcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24odmlldyl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZSh2aWV3KSAmJiBVdGlscy5vYmplY3RMZW5ndGgodmlldykgPT09IFV0aWxzLm9iamVjdExlbmd0aCh0aGF0LnZpZXcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC52aWV3ID0gdmlldztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJ2aWV3LWdldFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogXCJzZXJ2ZXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlldzogdmlld1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmluYWwoKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpbmFsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJXYXJuaW5nISBFcnJvciBsb2FkaW5nIHZpZXcgZm9yIHRhYmxlIFwiICsgZWxlbWVudC5hdHRyKCdpZCcpICsgXCI6IFwiICsgZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfZmluYWw6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBpZCA9IGVsZW1lbnQuYXR0cihcImlkXCIpO1xuXG4gICAgICAgICAgICBNZXRyby5zdG9yYWdlLmRlbEl0ZW0oby5jaGVja1N0b3JlS2V5LnJlcGxhY2UoXCIkMVwiLCBpZCkpO1xuXG4gICAgICAgICAgICB0aGlzLl9zZXJ2aWNlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUluc3BlY3RvcigpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlRXZlbnRzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInRhYmxlLWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3NlcnZpY2U6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlID0gW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUm93bnVtXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBvLnJvd251bVRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICBzb3J0YWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHNvcnREaXI6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgY2xzQ29sdW1uOiBcInJvd251bS1jZWxsIFwiICsgKG8ucm93bnVtICE9PSB0cnVlID8gXCJkLW5vbmVcIiA6IFwiXCIpLFxuICAgICAgICAgICAgICAgICAgICBjbHM6IFwicm93bnVtLWNlbGwgXCIgKyAoby5yb3dudW0gIT09IHRydWUgPyBcImQtbm9uZVwiIDogXCJcIiksXG4gICAgICAgICAgICAgICAgICAgIGNvbHNwYW46IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJyb3dudW1cIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAvLyBDaGVja1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogby5jaGVja1R5cGUgPT09IFwiY2hlY2tib3hcIiA/IFwiPGlucHV0IHR5cGU9J2NoZWNrYm94JyBkYXRhLXJvbGU9J2NoZWNrYm94JyBjbGFzcz0ndGFibGUtc2VydmljZS1jaGVjay1hbGwnIGRhdGEtc3R5bGU9J1wiK28uY2hlY2tTdHlsZStcIic+XCIgOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICBzb3J0YWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHNvcnREaXI6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgY2xzQ29sdW1uOiBcImNoZWNrLWNlbGwgXCIgKyAoby5jaGVjayAhPT0gdHJ1ZSA/IFwiZC1ub25lXCIgOiBcIlwiKSxcbiAgICAgICAgICAgICAgICAgICAgY2xzOiBcImNoZWNrLWNlbGwgXCIrKG8uY2hlY2sgIT09IHRydWUgPyBcImQtbm9uZVwiIDogXCJcIiksXG4gICAgICAgICAgICAgICAgICAgIGNvbHNwYW46IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJyb3djaGVja1wiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlVmlldzogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB2aWV3O1xuXG4gICAgICAgICAgICB2aWV3ID0ge307XG5cbiAgICAgICAgICAgICQuZWFjaCh0aGlzLmhlYWRzLCBmdW5jdGlvbihpKXtcblxuICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKHRoaXMuY2xzKSkge3RoaXMuY2xzID0gdGhpcy5jbHMucmVwbGFjZShcImhpZGRlblwiLCBcIlwiKTt9XG4gICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUodGhpcy5jbHNDb2x1bW4pKSB7dGhpcy5jbHNDb2x1bW4gPSB0aGlzLmNsc0NvbHVtbi5yZXBsYWNlKFwiaGlkZGVuXCIsIFwiXCIpO31cblxuICAgICAgICAgICAgICAgIHZpZXdbaV0gPSB7XG4gICAgICAgICAgICAgICAgICAgIFwiaW5kZXhcIjogaSxcbiAgICAgICAgICAgICAgICAgICAgXCJpbmRleC12aWV3XCI6IGksXG4gICAgICAgICAgICAgICAgICAgIFwic2hvd1wiOiAhVXRpbHMuaXNWYWx1ZSh0aGlzLnNob3cpID8gdHJ1ZSA6IHRoaXMuc2hvdyxcbiAgICAgICAgICAgICAgICAgICAgXCJzaXplXCI6IFV0aWxzLmlzVmFsdWUodGhpcy5zaXplKSA/IHRoaXMuc2l6ZSA6IFwiXCJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwidmlldy1jcmVhdGVkXCIsIHtcbiAgICAgICAgICAgICAgICB2aWV3OiB2aWV3XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHZpZXc7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUluc3BlY3Rvckl0ZW1zOiBmdW5jdGlvbih0YWJsZSl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgaiwgdGRzID0gW10sIHJvdztcbiAgICAgICAgICAgIHZhciBjZWxscyA9IHRoaXMuaGVhZHM7XG5cbiAgICAgICAgICAgIHRhYmxlLmh0bWwoXCJcIik7XG5cbiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBjZWxscy5sZW5ndGg7IGorKyl7XG4gICAgICAgICAgICAgICAgdGRzW2pdID0gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJC5lYWNoKGNlbGxzLCBmdW5jdGlvbihpKXtcbiAgICAgICAgICAgICAgICByb3cgPSAkKFwiPHRyPlwiKTtcbiAgICAgICAgICAgICAgICByb3cuZGF0YSgnaW5kZXgnLCBpKTtcbiAgICAgICAgICAgICAgICByb3cuZGF0YSgnaW5kZXgtdmlldycsIGkpO1xuICAgICAgICAgICAgICAgICQoXCI8dGQ+XCIpLmh0bWwoXCI8aW5wdXQgdHlwZT0nY2hlY2tib3gnIGRhdGEtc3R5bGU9J1wiK28uY2hlY2tTdHlsZStcIicgZGF0YS1yb2xlPSdjaGVja2JveCcgbmFtZT0nY29sdW1uX3Nob3dfY2hlY2tbXScgdmFsdWU9J1wiK2krXCInIFwiKyhVdGlscy5ib29sKHRoYXQudmlld1tpXVsnc2hvdyddKSA/IFwiY2hlY2tlZFwiIDogXCJcIikrXCI+XCIpLmFwcGVuZFRvKHJvdyk7XG4gICAgICAgICAgICAgICAgJChcIjx0ZD5cIikuaHRtbCh0aGlzLnRpdGxlKS5hcHBlbmRUbyhyb3cpO1xuICAgICAgICAgICAgICAgICQoXCI8dGQ+XCIpLmh0bWwoXCI8aW5wdXQgdHlwZT0nbnVtYmVyJyBkYXRhLXJvbGU9J3NwaW5uZXInIG5hbWU9J2NvbHVtbl9zaXplJyB2YWx1ZT0nXCIrdGhhdC52aWV3W2ldWydzaXplJ10rXCInIGRhdGEtaW5kZXg9J1wiK2krXCInPlwiKS5hcHBlbmRUbyhyb3cpO1xuICAgICAgICAgICAgICAgICQoXCI8dGQ+XCIpLmh0bWwoXCJcIiArXG4gICAgICAgICAgICAgICAgICAgIFwiPGJ1dHRvbiBjbGFzcz0nYnV0dG9uIHNxdWFyZSBqcy10YWJsZS1pbnNwZWN0b3ItZmllbGQtdXAnIHR5cGU9J2J1dHRvbic+PHNwYW4gY2xhc3M9J21pZi1hcnJvdy11cCc+PC9zcGFuPjwvYnV0dG9uPlwiICtcbiAgICAgICAgICAgICAgICAgICAgXCI8YnV0dG9uIGNsYXNzPSdidXR0b24gc3F1YXJlIGpzLXRhYmxlLWluc3BlY3Rvci1maWVsZC1kb3duJyB0eXBlPSdidXR0b24nPjxzcGFuIGNsYXNzPSdtaWYtYXJyb3ctZG93bic+PC9zcGFuPjwvYnV0dG9uPlwiICtcbiAgICAgICAgICAgICAgICAgICAgXCJcIikuYXBwZW5kVG8ocm93KTtcbiAgICAgICAgICAgICAgICB0ZHNbdGhhdC52aWV3W2ldWydpbmRleC12aWV3J11dID0gcm93O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgY2VsbHMubGVuZ3RoOyBqKyspe1xuICAgICAgICAgICAgICAgIHRkc1tqXS5hcHBlbmRUbyh0YWJsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUluc3BlY3RvcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGluc3BlY3RvciwgdGFibGVfd3JhcCwgdGFibGUsIHRib2R5LCBhY3Rpb25zO1xuXG4gICAgICAgICAgICBpbnNwZWN0b3IgPSAkKFwiPGRpdiBkYXRhLXJvbGU9J2RyYWdnYWJsZScgZGF0YS1kcmFnLWVsZW1lbnQ9Jy50YWJsZS1pbnNwZWN0b3ItaGVhZGVyJyBkYXRhLWRyYWctYXJlYT0nYm9keSc+XCIpLmFkZENsYXNzKFwidGFibGUtaW5zcGVjdG9yXCIpO1xuICAgICAgICAgICAgaW5zcGVjdG9yLmF0dHIoXCJmb3JcIiwgdGhpcy5lbGVtZW50LmF0dHIoXCJpZFwiKSk7XG5cbiAgICAgICAgICAgICQoXCI8ZGl2IGNsYXNzPSd0YWJsZS1pbnNwZWN0b3ItaGVhZGVyJz5cIisoby5pbnNwZWN0b3JUaXRsZSB8fCB0aGlzLmxvY2FsZS50YWJsZVtcImluc3BlY3RvclwiXSkrXCI8L2Rpdj5cIikuYXBwZW5kVG8oaW5zcGVjdG9yKTtcblxuICAgICAgICAgICAgdGFibGVfd3JhcCA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInRhYmxlLXdyYXBcIikuYXBwZW5kVG8oaW5zcGVjdG9yKTtcblxuICAgICAgICAgICAgdGFibGUgPSAkKFwiPHRhYmxlPlwiKS5hZGRDbGFzcyhcInRhYmxlIHN1YmNvbXBhY3RcIik7XG4gICAgICAgICAgICB0Ym9keSA9ICQoXCI8dGJvZHk+XCIpLmFwcGVuZFRvKHRhYmxlKTtcblxuICAgICAgICAgICAgdGFibGUuYXBwZW5kVG8odGFibGVfd3JhcCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUluc3BlY3Rvckl0ZW1zKHRib2R5KTtcblxuICAgICAgICAgICAgYWN0aW9ucyA9ICQoXCI8ZGl2IGNsYXNzPSd0YWJsZS1pbnNwZWN0b3ItYWN0aW9ucyc+XCIpLmFwcGVuZFRvKGluc3BlY3Rvcik7XG4gICAgICAgICAgICAkKFwiPGJ1dHRvbiBjbGFzcz0nYnV0dG9uIHByaW1hcnkganMtdGFibGUtaW5zcGVjdG9yLXNhdmUnIHR5cGU9J2J1dHRvbic+XCIpLmh0bWwodGhpcy5sb2NhbGUuYnV0dG9ucy5zYXZlKS5hcHBlbmRUbyhhY3Rpb25zKTtcbiAgICAgICAgICAgICQoXCI8YnV0dG9uIGNsYXNzPSdidXR0b24gc2Vjb25kYXJ5IGpzLXRhYmxlLWluc3BlY3Rvci1yZXNldCBtbC0yIG1yLTInIHR5cGU9J2J1dHRvbic+XCIpLmh0bWwodGhpcy5sb2NhbGUuYnV0dG9ucy5yZXNldCkuYXBwZW5kVG8oYWN0aW9ucyk7XG4gICAgICAgICAgICAkKFwiPGJ1dHRvbiBjbGFzcz0nYnV0dG9uIGxpbmsganMtdGFibGUtaW5zcGVjdG9yLWNhbmNlbCBwbGFjZS1yaWdodCcgdHlwZT0nYnV0dG9uJz5cIikuaHRtbCh0aGlzLmxvY2FsZS5idXR0b25zLmNhbmNlbCkuYXBwZW5kVG8oYWN0aW9ucyk7XG5cbiAgICAgICAgICAgIGluc3BlY3Rvci5kYXRhKFwib3BlblwiLCBmYWxzZSk7XG4gICAgICAgICAgICB0aGlzLmluc3BlY3RvciA9IGluc3BlY3RvcjtcblxuICAgICAgICAgICAgJChcImJvZHlcIikuYXBwZW5kKGluc3BlY3Rvcik7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUluc3BlY3RvckV2ZW50cygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9yZXNldEluc3BlY3RvcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBpbnNwZWN0b3IgPSB0aGlzLmluc3BlY3RvcjtcbiAgICAgICAgICAgIHZhciB0YWJsZSA9IGluc3BlY3Rvci5maW5kKFwidGFibGUgdGJvZHlcIik7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVJbnNwZWN0b3JJdGVtcyh0YWJsZSk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVJbnNwZWN0b3JFdmVudHMoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlSGVhZHNGcm9tSFRNTDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBoZWFkID0gZWxlbWVudC5maW5kKFwidGhlYWRcIik7XG5cbiAgICAgICAgICAgIGlmIChoZWFkLmxlbmd0aCA+IDApICQuZWFjaChoZWFkLmZpbmQoXCJ0ciA+ICpcIiksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIHZhciBkaXIsIGhlYWRfaXRlbSwgaXRlbV9jbGFzcztcblxuICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKGl0ZW0uZGF0YSgnc29ydC1kaXInKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlyID0gaXRlbS5kYXRhKCdzb3J0LWRpcicpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmhhc0NsYXNzKFwic29ydC1hc2NcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpciA9IFwiYXNjXCI7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5oYXNDbGFzcyhcInNvcnQtZGVzY1wiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlyID0gXCJkZXNjXCJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGl0ZW1fY2xhc3MgPSBpdGVtWzBdLmNsYXNzTmFtZS5yZXBsYWNlKFwic29ydGFibGUtY29sdW1uXCIsIFwiXCIpO1xuICAgICAgICAgICAgICAgIGl0ZW1fY2xhc3MgPSBpdGVtX2NsYXNzLnJlcGxhY2UoXCJzb3J0LWFzY1wiLCBcIlwiKTtcbiAgICAgICAgICAgICAgICBpdGVtX2NsYXNzID0gaXRlbV9jbGFzcy5yZXBsYWNlKFwic29ydC1kZXNjXCIsIFwiXCIpO1xuICAgICAgICAgICAgICAgIGl0ZW1fY2xhc3MgPSBpdGVtX2NsYXNzLnJlcGxhY2UoXCJoaWRkZW5cIiwgXCJcIik7XG5cbiAgICAgICAgICAgICAgICBoZWFkX2l0ZW0gPSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiZGF0YVwiLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogaXRlbS5odG1sKCksXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IFV0aWxzLmlzVmFsdWUoaXRlbS5kYXRhKFwibmFtZVwiKSkgPyBpdGVtLmRhdGEoXCJuYW1lXCIpIDogaXRlbS50ZXh0KCkucmVwbGFjZShcIiBcIiwgXCJfXCIpLFxuICAgICAgICAgICAgICAgICAgICBzb3J0YWJsZTogaXRlbS5oYXNDbGFzcyhcInNvcnRhYmxlLWNvbHVtblwiKSB8fCAoVXRpbHMuaXNWYWx1ZShpdGVtLmRhdGEoJ3NvcnRhYmxlJykpICYmIEpTT04ucGFyc2UoaXRlbS5kYXRhKCdzb3J0YWJsZScpKSA9PT0gdHJ1ZSksXG4gICAgICAgICAgICAgICAgICAgIHNvcnREaXI6IGRpcixcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBVdGlscy5pc1ZhbHVlKGl0ZW0uZGF0YShcImZvcm1hdFwiKSkgPyBpdGVtLmRhdGEoXCJmb3JtYXRcIikgOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICBmb3JtYXRNYXNrOiBVdGlscy5pc1ZhbHVlKGl0ZW0uZGF0YShcImZvcm1hdC1tYXNrXCIpKSA/IGl0ZW0uZGF0YShcImZvcm1hdC1tYXNrXCIpIDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgY2xzQ29sdW1uOiBVdGlscy5pc1ZhbHVlKGl0ZW0uZGF0YShcImNscy1jb2x1bW5cIikpID8gaXRlbS5kYXRhKFwiY2xzLWNvbHVtblwiKSA6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIGNsczogaXRlbV9jbGFzcyxcbiAgICAgICAgICAgICAgICAgICAgY29sc3BhbjogaXRlbS5hdHRyKFwiY29sc3BhblwiKSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogVXRpbHMuaXNWYWx1ZShpdGVtLmRhdGEoXCJzaXplXCIpKSA/IGl0ZW0uZGF0YShcInNpemVcIikgOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBzaG93OiAhKGl0ZW0uaGFzQ2xhc3MoXCJoaWRkZW5cIikgfHwgKFV0aWxzLmlzVmFsdWUoaXRlbS5kYXRhKCdzaG93JykpICYmIEpTT04ucGFyc2UoaXRlbS5kYXRhKCdzaG93JykpID09PSBmYWxzZSkpLFxuXG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBVdGlscy5pc1ZhbHVlKGl0ZW0uZGF0YShcInJlcXVpcmVkXCIpKSA/IEpTT04ucGFyc2UoaXRlbS5kYXRhKFwicmVxdWlyZWRcIikpID09PSB0cnVlICA6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZDogVXRpbHMuaXNWYWx1ZShpdGVtLmRhdGEoXCJmaWVsZFwiKSkgPyBpdGVtLmRhdGEoXCJmaWVsZFwiKSA6IFwiaW5wdXRcIixcbiAgICAgICAgICAgICAgICAgICAgZmllbGRUeXBlOiBVdGlscy5pc1ZhbHVlKGl0ZW0uZGF0YShcImZpZWxkLXR5cGVcIikpID8gaXRlbS5kYXRhKFwiZmllbGQtdHlwZVwiKSA6IFwidGV4dFwiLFxuICAgICAgICAgICAgICAgICAgICB2YWxpZGF0b3I6IFV0aWxzLmlzVmFsdWUoaXRlbS5kYXRhKFwidmFsaWRhdG9yXCIpKSA/IGl0ZW0uZGF0YShcInZhbGlkYXRvclwiKSA6IG51bGwsXG5cbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6IFV0aWxzLmlzVmFsdWUoaXRlbS5kYXRhKFwidGVtcGxhdGVcIikpID8gaXRlbS5kYXRhKFwidGVtcGxhdGVcIikgOiBudWxsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGF0LmhlYWRzLnB1c2goaGVhZF9pdGVtKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVGb290c0Zyb21IVE1MOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIGZvb3QgPSBlbGVtZW50LmZpbmQoXCJ0Zm9vdFwiKTtcblxuICAgICAgICAgICAgaWYgKGZvb3QubGVuZ3RoID4gMCkgJC5lYWNoKGZvb3QuZmluZChcInRyID4gKlwiKSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgdmFyIGZvb3RfaXRlbTtcblxuICAgICAgICAgICAgICAgIGZvb3RfaXRlbSA9IHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGl0ZW0uaHRtbCgpLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBVdGlscy5pc1ZhbHVlKGl0ZW0uZGF0YShcIm5hbWVcIikpID8gaXRlbS5kYXRhKFwibmFtZVwiKSA6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjbHM6IGl0ZW1bMF0uY2xhc3NOYW1lLFxuICAgICAgICAgICAgICAgICAgICBjb2xzcGFuOiBpdGVtLmF0dHIoXCJjb2xzcGFuXCIpXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHRoYXQuZm9vdHMucHVzaChmb290X2l0ZW0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUl0ZW1zRnJvbUhUTUw6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgYm9keSA9IGVsZW1lbnQuZmluZChcInRib2R5XCIpO1xuXG4gICAgICAgICAgICBpZiAoYm9keS5sZW5ndGggPiAwKSAkLmVhY2goYm9keS5maW5kKFwidHJcIiksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIHJvdyA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgdmFyIHRyID0gW107XG4gICAgICAgICAgICAgICAgJC5lYWNoKHJvdy5jaGlsZHJlbihcInRkXCIpLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGQgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB0ci5wdXNoKHRkLmh0bWwoKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhhdC5pdGVtcy5wdXNoKHRyKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVIZWFkc0Zyb21IVE1MKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVGb290c0Zyb21IVE1MKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUl0ZW1zRnJvbUpTT046IGZ1bmN0aW9uKHNvdXJjZSl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygc291cmNlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgc291cmNlID0gSlNPTi5wYXJzZShzb3VyY2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc291cmNlLmhlYWRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5oZWFkcyA9IHNvdXJjZS5oZWFkZXI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUhlYWRzRnJvbUhUTUwoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHNvdXJjZS5kYXRhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAkLmVhY2goc291cmNlLmRhdGEsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciByb3cgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdHIgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHJvdywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZCA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ci5wdXNoKHRkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaXRlbXMucHVzaCh0cik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzb3VyY2UuZm9vdGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZvb3RzID0gc291cmNlLmZvb3RlcjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlRm9vdHNGcm9tSFRNTCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVUYWJsZUhlYWRlcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGhlYWQgPSBlbGVtZW50LmZpbmQoXCJ0aGVhZFwiKTtcbiAgICAgICAgICAgIHZhciB0ciwgdGgsIHRkcyA9IFtdLCBqLCBjZWxscztcbiAgICAgICAgICAgIHZhciB2aWV3ID0gby5zdGF0aWNWaWV3ID8gdGhpcy5fY3JlYXRlVmlldygpIDogdGhpcy52aWV3O1xuXG4gICAgICAgICAgICBpZiAoaGVhZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBoZWFkID0gJChcIjx0aGVhZD5cIik7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5wcmVwZW5kKGhlYWQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBoZWFkLmNsZWFyKCkuYWRkQ2xhc3Moby5jbHNIZWFkKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuaGVhZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhlYWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRyID0gJChcIjx0cj5cIikuYWRkQ2xhc3Moby5jbHNIZWFkUm93KS5hcHBlbmRUbyhoZWFkKTtcblxuICAgICAgICAgICAgJC5lYWNoKHRoaXMuc2VydmljZSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXMsIGNsYXNzZXMgPSBbXTtcbiAgICAgICAgICAgICAgICB0aCA9ICQoXCI8dGg+XCIpLmFwcGVuZFRvKHRyKTtcbiAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShpdGVtLnRpdGxlKSkge3RoLmh0bWwoaXRlbS50aXRsZSk7fVxuICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKGl0ZW0uc2l6ZSkpIHt0aC5jc3Moe3dpZHRoOiBpdGVtLnNpemV9KTt9XG4gICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoaXRlbS5jbHMpKSB7Y2xhc3Nlcy5wdXNoKGl0ZW0uY2xzKTt9XG4gICAgICAgICAgICAgICAgY2xhc3Nlcy5wdXNoKG8uY2xzSGVhZENlbGwpO1xuICAgICAgICAgICAgICAgIHRoLmFkZENsYXNzKGNsYXNzZXMuam9pbihcIiBcIikpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNlbGxzID0gdGhpcy5oZWFkcztcblxuICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGNlbGxzLmxlbmd0aDsgaisrKXtcbiAgICAgICAgICAgICAgICB0ZHNbal0gPSBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkLmVhY2goY2VsbHMsIGZ1bmN0aW9uKGNlbGxfaW5kZXgpe1xuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgY2xhc3NlcyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgdGggPSAkKFwiPHRoPlwiKTtcbiAgICAgICAgICAgICAgICB0aC5kYXRhKFwiaW5kZXhcIiwgY2VsbF9pbmRleCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShpdGVtLnRpdGxlKSkge3RoLmh0bWwoaXRlbS50aXRsZSk7fVxuICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKGl0ZW0uZm9ybWF0KSkge3RoLmF0dHIoXCJkYXRhLWZvcm1hdFwiLCBpdGVtLmZvcm1hdCk7fVxuICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKGl0ZW0ubmFtZSkpIHt0aC5hdHRyKFwiZGF0YS1uYW1lXCIsIGl0ZW0ubmFtZSk7fVxuICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKGl0ZW0uY29sc3BhbikpIHt0aC5hdHRyKFwiY29sc3BhblwiLCBpdGVtLmNvbHNwYW4pO31cbiAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZSh2aWV3W2NlbGxfaW5kZXhdWydzaXplJ10pKSB7dGguY3NzKHt3aWR0aDogdmlld1tjZWxsX2luZGV4XVsnc2l6ZSddfSk7fVxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnNvcnRhYmxlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzZXMucHVzaChcInNvcnRhYmxlLWNvbHVtblwiKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShpdGVtLnNvcnREaXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc2VzLnB1c2goXCJzb3J0LVwiICsgaXRlbS5zb3J0RGlyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShpdGVtLmNscykpIHtcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGl0ZW0uY2xzLnRvQXJyYXkoKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3Nlcy5wdXNoKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKFV0aWxzLmJvb2wodmlld1tjZWxsX2luZGV4XVsnc2hvdyddKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNsYXNzZXMuaW5kZXhPZignaGlkZGVuJykgPT09IC0xKSBjbGFzc2VzLnB1c2goXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY2xhc3Nlcy5wdXNoKG8uY2xzSGVhZENlbGwpO1xuXG4gICAgICAgICAgICAgICAgaWYgKFV0aWxzLmJvb2wodmlld1tjZWxsX2luZGV4XVsnc2hvdyddKSkge1xuICAgICAgICAgICAgICAgICAgICBVdGlscy5hcnJheURlbGV0ZShjbGFzc2VzLCBcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aC5hZGRDbGFzcyhjbGFzc2VzLmpvaW4oXCIgXCIpKTtcblxuICAgICAgICAgICAgICAgIHRkc1t2aWV3W2NlbGxfaW5kZXhdWydpbmRleC12aWV3J11dID0gdGg7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGNlbGxzLmxlbmd0aDsgaisrKXtcbiAgICAgICAgICAgICAgICB0ZHNbal0uYXBwZW5kVG8odHIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVUYWJsZUJvZHk6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgYm9keSwgaGVhZCwgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgaGVhZCAgPSBlbGVtZW50LmZpbmQoXCJ0aGVhZFwiKTtcbiAgICAgICAgICAgIGJvZHkgID0gZWxlbWVudC5maW5kKFwidGJvZHlcIik7XG5cbiAgICAgICAgICAgIGlmIChib2R5Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGJvZHkgPSAkKFwiPHRib2R5PlwiKS5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuY2xzQm9keSk7XG4gICAgICAgICAgICAgICAgaWYgKGhlYWQubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGJvZHkuaW5zZXJ0QWZ0ZXIoaGVhZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hcHBlbmQoYm9keSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBib2R5LmNsZWFyKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVRhYmxlRm9vdGVyOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgZm9vdCA9IGVsZW1lbnQuZmluZChcInRmb290XCIpO1xuICAgICAgICAgICAgdmFyIHRyLCB0aDtcblxuICAgICAgICAgICAgaWYgKGZvb3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgZm9vdCA9ICQoXCI8dGZvb3Q+XCIpLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb290LmNsZWFyKCkuYWRkQ2xhc3Moby5jbHNGb290ZXIpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5mb290cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRyID0gJChcIjx0cj5cIikuYWRkQ2xhc3Moby5jbHNIZWFkUm93KS5hcHBlbmRUbyhmb290KTtcbiAgICAgICAgICAgICQuZWFjaCh0aGlzLmZvb3RzLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gdGhpcztcbiAgICAgICAgICAgICAgICB0aCA9ICQoXCI8dGg+XCIpLmFwcGVuZFRvKHRyKTtcblxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnRpdGxlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGguaHRtbChpdGVtLnRpdGxlKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5uYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGguYWRkQ2xhc3MoXCJmb290LWNvbHVtbi1uYW1lLVwiICsgaXRlbS5uYW1lKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5jbHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB0aC5hZGRDbGFzcyhpdGVtLmNscyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoaXRlbS5jb2xzcGFuKSkge1xuICAgICAgICAgICAgICAgICAgICB0aC5hdHRyKFwiY29sc3BhblwiLCBpdGVtLmNvbHNwYW4pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoLmFwcGVuZFRvKHRyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVUb3BCbG9jazogZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgdG9wX2Jsb2NrID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwidGFibGUtdG9wXCIpLmFkZENsYXNzKG8uY2xzVGFibGVUb3ApLmluc2VydEJlZm9yZShlbGVtZW50LnBhcmVudCgpKTtcbiAgICAgICAgICAgIHZhciBzZWFyY2hfYmxvY2ssIHNlYXJjaF9pbnB1dCwgcm93c19ibG9jaywgcm93c19zZWxlY3Q7XG5cbiAgICAgICAgICAgIHNlYXJjaF9ibG9jayA9IFV0aWxzLmlzVmFsdWUodGhpcy53cmFwcGVyU2VhcmNoKSA/IHRoaXMud3JhcHBlclNlYXJjaCA6ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInRhYmxlLXNlYXJjaC1ibG9ja1wiKS5hZGRDbGFzcyhvLmNsc1NlYXJjaCkuYXBwZW5kVG8odG9wX2Jsb2NrKTtcbiAgICAgICAgICAgIHNlYXJjaF9ibG9jay5hZGRDbGFzcyhvLmNsc1NlYXJjaCk7XG5cbiAgICAgICAgICAgIHNlYXJjaF9pbnB1dCA9ICQoXCI8aW5wdXQ+XCIpLmF0dHIoXCJ0eXBlXCIsIFwidGV4dFwiKS5hcHBlbmRUbyhzZWFyY2hfYmxvY2spO1xuICAgICAgICAgICAgTWV0cm8ubWFrZVBsdWdpbihzZWFyY2hfaW5wdXQsIFwiaW5wdXRcIiwge1xuICAgICAgICAgICAgICAgIHByZXBlbmQ6IG8udGFibGVTZWFyY2hUaXRsZSB8fCB0aGF0LmxvY2FsZS50YWJsZVtcInNlYXJjaFwiXVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChvLnNob3dTZWFyY2ggIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBzZWFyY2hfYmxvY2suaGlkZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByb3dzX2Jsb2NrID0gVXRpbHMuaXNWYWx1ZSh0aGlzLndyYXBwZXJSb3dzKSA/IHRoaXMud3JhcHBlclJvd3MgOiAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJ0YWJsZS1yb3dzLWJsb2NrXCIpLmFwcGVuZFRvKHRvcF9ibG9jayk7XG4gICAgICAgICAgICByb3dzX2Jsb2NrLmFkZENsYXNzKG8uY2xzUm93c0NvdW50KTtcblxuICAgICAgICAgICAgcm93c19zZWxlY3QgPSAkKFwiPHNlbGVjdD5cIikuYXBwZW5kVG8ocm93c19ibG9jayk7XG4gICAgICAgICAgICAkLmVhY2goby5yb3dzU3RlcHMudG9BcnJheSgpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbCA9IHBhcnNlSW50KHRoaXMpO1xuICAgICAgICAgICAgICAgIHZhciBvcHRpb24gPSAkKFwiPG9wdGlvbj5cIikuYXR0cihcInZhbHVlXCIsIHZhbCkudGV4dCh2YWwgPT09IC0xID8gKG8uYWxsUmVjb3Jkc1RpdGxlIHx8IHRoYXQubG9jYWxlLnRhYmxlW1wiYWxsXCJdKSA6IHZhbCkuYXBwZW5kVG8ocm93c19zZWxlY3QpO1xuICAgICAgICAgICAgICAgIGlmICh2YWwgPT09IHBhcnNlSW50KG8ucm93cykpIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uLmF0dHIoXCJzZWxlY3RlZFwiLCBcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgTWV0cm8ubWFrZVBsdWdpbihyb3dzX3NlbGVjdCwgXCJzZWxlY3RcIix7XG4gICAgICAgICAgICAgICAgZmlsdGVyOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBwcmVwZW5kOiBvLnRhYmxlUm93c0NvdW50VGl0bGUgfHwgdGhhdC5sb2NhbGUudGFibGVbXCJyb3dzQ291bnRcIl0sXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VJbnQodmFsKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCA9PT0gcGFyc2VJbnQoby5yb3dzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG8ucm93cyA9IHZhbDtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5jdXJyZW50UGFnZSA9IDE7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2RyYXcoKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJyb3dzLWNvdW50LWNoYW5nZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWw6IHZhbFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKG8uc2hvd0luc3BlY3RvckJ1dHRvbikge1xuICAgICAgICAgICAgICAgICQoXCI8YnV0dG9uPlwiKS5hZGRDbGFzcyhcImJ1dHRvbiBpbnNwZWN0b3ItYnV0dG9uXCIpLmF0dHIoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpLmh0bWwoby5pbnNwZWN0b3JCdXR0b25JY29uKS5pbnNlcnRBZnRlcihyb3dzX2Jsb2NrKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uc2hvd1Jvd3NTdGVwcyAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHJvd3NfYmxvY2suaGlkZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdG9wX2Jsb2NrO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVCb3R0b21CbG9jazogZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBib3R0b21fYmxvY2sgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJ0YWJsZS1ib3R0b21cIikuYWRkQ2xhc3Moby5jbHNUYWJsZUJvdHRvbSkuaW5zZXJ0QWZ0ZXIoZWxlbWVudC5wYXJlbnQoKSk7XG4gICAgICAgICAgICB2YXIgaW5mbywgcGFnaW5hdGlvbiwgc2tpcDtcblxuICAgICAgICAgICAgaW5mbyA9IFV0aWxzLmlzVmFsdWUodGhpcy53cmFwcGVySW5mbykgPyB0aGlzLndyYXBwZXJJbmZvIDogJChcIjxkaXY+XCIpLmFkZENsYXNzKFwidGFibGUtaW5mb1wiKS5hcHBlbmRUbyhib3R0b21fYmxvY2spO1xuICAgICAgICAgICAgaW5mby5hZGRDbGFzcyhvLmNsc1RhYmxlSW5mbyk7XG4gICAgICAgICAgICBpZiAoby5zaG93VGFibGVJbmZvICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgaW5mby5oaWRlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBhZ2luYXRpb24gPSBVdGlscy5pc1ZhbHVlKHRoaXMud3JhcHBlclBhZ2luYXRpb24pID8gdGhpcy53cmFwcGVyUGFnaW5hdGlvbiA6ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInRhYmxlLXBhZ2luYXRpb25cIikuYXBwZW5kVG8oYm90dG9tX2Jsb2NrKTtcbiAgICAgICAgICAgIHBhZ2luYXRpb24uYWRkQ2xhc3Moby5jbHNUYWJsZVBhZ2luYXRpb24pO1xuICAgICAgICAgICAgaWYgKG8uc2hvd1BhZ2luYXRpb24gIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBwYWdpbmF0aW9uLmhpZGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2tpcCA9IFV0aWxzLmlzVmFsdWUodGhpcy53cmFwcGVyU2tpcCkgPyB0aGlzLndyYXBwZXJTa2lwIDogJChcIjxkaXY+XCIpLmFkZENsYXNzKFwidGFibGUtc2tpcFwiKS5hcHBlbmRUbyhib3R0b21fYmxvY2spO1xuICAgICAgICAgICAgc2tpcC5hZGRDbGFzcyhvLmNsc1RhYmxlU2tpcCk7XG5cbiAgICAgICAgICAgICQoXCI8aW5wdXQgdHlwZT0ndGV4dCc+XCIpLmFkZENsYXNzKFwiaW5wdXQgdGFibGUtc2tpcC1pbnB1dFwiKS5hZGRDbGFzcyhvLmNsc1RhYmxlU2tpcElucHV0KS5hcHBlbmRUbyhza2lwKTtcbiAgICAgICAgICAgICQoXCI8YnV0dG9uPlwiKS5hZGRDbGFzcyhcImJ1dHRvbiB0YWJsZS1za2lwLWJ1dHRvblwiKS5hZGRDbGFzcyhvLmNsc1RhYmxlU2tpcEJ1dHRvbikuaHRtbChvLnRhYmxlU2tpcFRpdGxlIHx8IHRoaXMubG9jYWxlLnRhYmxlW1wic2tpcFwiXSkuYXBwZW5kVG8oc2tpcCk7XG5cbiAgICAgICAgICAgIGlmIChvLnNob3dTa2lwICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgc2tpcC5oaWRlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBib3R0b21fYmxvY2s7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVN0cnVjdHVyZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjb2x1bW5zO1xuICAgICAgICAgICAgdmFyIHdfc2VhcmNoID0gJChvLnNlYXJjaFdyYXBwZXIpLFxuICAgICAgICAgICAgICAgIHdfaW5mbyA9ICQoby5pbmZvV3JhcHBlciksXG4gICAgICAgICAgICAgICAgd19yb3dzID0gJChvLnJvd3NXcmFwcGVyKSxcbiAgICAgICAgICAgICAgICB3X3BhZ2luZyA9ICQoby5wYWdpbmF0aW9uV3JhcHBlciksXG4gICAgICAgICAgICAgICAgd19za2lwID0gJChvLnNraXBXcmFwcGVyKTtcblxuICAgICAgICAgICAgaWYgKHdfc2VhcmNoLmxlbmd0aCA+IDApIHt0aGlzLndyYXBwZXJTZWFyY2ggPSB3X3NlYXJjaDt9XG4gICAgICAgICAgICBpZiAod19pbmZvLmxlbmd0aCA+IDApIHt0aGlzLndyYXBwZXJJbmZvID0gd19pbmZvO31cbiAgICAgICAgICAgIGlmICh3X3Jvd3MubGVuZ3RoID4gMCkge3RoaXMud3JhcHBlclJvd3MgPSB3X3Jvd3M7fVxuICAgICAgICAgICAgaWYgKHdfcGFnaW5nLmxlbmd0aCA+IDApIHt0aGlzLndyYXBwZXJQYWdpbmF0aW9uID0gd19wYWdpbmc7fVxuICAgICAgICAgICAgaWYgKHdfc2tpcC5sZW5ndGggPiAwKSB7dGhpcy53cmFwcGVyU2tpcCA9IHdfc2tpcDt9XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3Moby5jbHNUYWJsZSk7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVRhYmxlSGVhZGVyKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVUYWJsZUJvZHkoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVRhYmxlRm9vdGVyKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVRvcEJsb2NrKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVCb3R0b21CbG9jaygpO1xuXG4gICAgICAgICAgICB2YXIgbmVlZF9zb3J0ID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy5oZWFkcy5sZW5ndGggPiAwKSAkLmVhY2godGhpcy5oZWFkcywgZnVuY3Rpb24oaSl7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB0aGlzO1xuICAgICAgICAgICAgICAgIGlmICghbmVlZF9zb3J0ICYmIFtcImFzY1wiLCBcImRlc2NcIl0uaW5kZXhPZihpdGVtLnNvcnREaXIpID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgbmVlZF9zb3J0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5zb3J0LmNvbEluZGV4ID0gaTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5zb3J0LmRpciA9IGl0ZW0uc29ydERpcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKG5lZWRfc29ydCkge1xuICAgICAgICAgICAgICAgIGNvbHVtbnMgPSBlbGVtZW50LmZpbmQoXCJ0aGVhZCB0aFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZXNldFNvcnRDbGFzcyhjb2x1bW5zKTtcbiAgICAgICAgICAgICAgICAkKGNvbHVtbnMuZ2V0KHRoaXMuc29ydC5jb2xJbmRleCArIHRoYXQuc2VydmljZS5sZW5ndGgpKS5hZGRDbGFzcyhcInNvcnQtXCIrdGhpcy5zb3J0LmRpcik7XG4gICAgICAgICAgICAgICAgdGhpcy5zb3J0aW5nKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBmaWx0ZXJfZnVuYztcblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5maWx0ZXJzKSAmJiB0eXBlb2Ygby5maWx0ZXJzID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICQuZWFjaChvLmZpbHRlcnMudG9BcnJheSgpLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZnVuYyA9IFV0aWxzLmlzRnVuYyh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlcl9mdW5jICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5maWx0ZXJzSW5kZXhlcy5wdXNoKHRoYXQuYWRkRmlsdGVyKGZpbHRlcl9mdW5jKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IDE7XG5cbiAgICAgICAgICAgIHRoaXMuX2RyYXcoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfcmVzZXRTb3J0Q2xhc3M6IGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgICQoZWwpLnJlbW92ZUNsYXNzKFwic29ydC1hc2Mgc29ydC1kZXNjXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY29tcG9uZW50ID0gZWxlbWVudC5jbG9zZXN0KFwiLnRhYmxlLWNvbXBvbmVudFwiKTtcbiAgICAgICAgICAgIHZhciB0YWJsZV9jb250YWluZXIgPSBjb21wb25lbnQuZmluZChcIi50YWJsZS1jb250YWluZXJcIik7XG4gICAgICAgICAgICB2YXIgc2VhcmNoID0gY29tcG9uZW50LmZpbmQoXCIudGFibGUtc2VhcmNoLWJsb2NrIGlucHV0XCIpO1xuICAgICAgICAgICAgdmFyIHNraXBfYnV0dG9uID0gby5za2lwV3JhcHBlciA/ICQoby5za2lwV3JhcHBlcikuZmluZCgnLnRhYmxlLXNraXAtYnV0dG9uJykgOiBjb21wb25lbnQuZmluZChcIi50YWJsZS1za2lwLWJ1dHRvblwiKTtcbiAgICAgICAgICAgIHZhciBza2lwX2lucHV0ID0gby5za2lwV3JhcHBlciA/ICQoby5za2lwV3JhcHBlcikuZmluZCgnLnRhYmxlLXNraXAtaW5wdXQnKSA6IGNvbXBvbmVudC5maW5kKFwiLnRhYmxlLXNraXAtaW5wdXRcIik7XG4gICAgICAgICAgICB2YXIgY3VzdG9tU2VhcmNoO1xuICAgICAgICAgICAgdmFyIGlkID0gZWxlbWVudC5hdHRyKFwiaWRcIik7XG4gICAgICAgICAgICB2YXIgaW5zcGVjdG9yQnV0dG9uID0gY29tcG9uZW50LmZpbmQoXCIuaW5zcGVjdG9yLWJ1dHRvblwiKTtcblxuICAgICAgICAgICAgaW5zcGVjdG9yQnV0dG9uLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0LnRvZ2dsZUluc3BlY3RvcigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNraXBfYnV0dG9uLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgc2tpcFRvID0gcGFyc2VJbnQoc2tpcF9pbnB1dC52YWwoKS50cmltKCkpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGlzTmFOKHNraXBUbykgfHwgc2tpcFRvIDw9MCB8fCBza2lwVG8gPiB0aGF0LnBhZ2VzQ291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2tpcF9pbnB1dC52YWwoJycpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc2tpcF9pbnB1dC52YWwoJycpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwic2tpcFwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHNraXBUbzogc2tpcFRvLFxuICAgICAgICAgICAgICAgICAgICBza2lwRnJvbTogdGhhdC5jdXJyZW50UGFnZVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5wYWdlKHNraXBUbyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKE1ldHJvLmV2ZW50cy5yZXNpemUsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKG8uaG9yaXpvbnRhbFNjcm9sbCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIVV0aWxzLmlzTnVsbChvLmhvcml6b250YWxTY3JvbGxTdG9wKSAmJiBVdGlscy5tZWRpYUV4aXN0KG8uaG9yaXpvbnRhbFNjcm9sbFN0b3ApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZV9jb250YWluZXIucmVtb3ZlQ2xhc3MoXCJob3Jpem9udGFsLXNjcm9sbFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlX2NvbnRhaW5lci5hZGRDbGFzcyhcImhvcml6b250YWwtc2Nyb2xsXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwge25zOiB0aGlzLmlkfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5zb3J0YWJsZS1jb2x1bW5cIiwgZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgIGlmIChvLm11dGVUYWJsZSA9PT0gdHJ1ZSkgZWxlbWVudC5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoYXQuYnVzeSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoYXQuYnVzeSA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICB2YXIgY29sID0gJCh0aGlzKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuYWN0aXZpdHkuc2hvdyhmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBzZXRJbW1lZGlhdGUoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBhZ2UgPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5zb3J0LmNvbEluZGV4ID0gY29sLmRhdGEoXCJpbmRleFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY29sLmhhc0NsYXNzKFwic29ydC1hc2NcIikgJiYgIWNvbC5oYXNDbGFzcyhcInNvcnQtZGVzY1wiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuc29ydC5kaXIgPSBvLnNvcnREaXI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2wuaGFzQ2xhc3MoXCJzb3J0LWFzY1wiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LnNvcnQuZGlyID0gXCJkZXNjXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5zb3J0LmRpciA9IFwiYXNjXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fcmVzZXRTb3J0Q2xhc3MoZWxlbWVudC5maW5kKFwiLnNvcnRhYmxlLWNvbHVtblwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wuYWRkQ2xhc3MoXCJzb3J0LVwiK3RoYXQuc29ydC5kaXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5zb3J0aW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9kcmF3KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5idXN5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG8ubXV0ZVRhYmxlID09PSB0cnVlKSBlbGVtZW50LnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLnRhYmxlLXNlcnZpY2UtY2hlY2sgaW5wdXRcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgY2hlY2sgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSBjaGVjay5pcyhcIjpjaGVja2VkXCIpO1xuICAgICAgICAgICAgICAgIHZhciB2YWwgPSBcIlwiK2NoZWNrLnZhbCgpO1xuICAgICAgICAgICAgICAgIHZhciBzdG9yZV9rZXkgPSBvLmNoZWNrU3RvcmVLZXkucmVwbGFjZShcIiQxXCIsIGlkKTtcbiAgICAgICAgICAgICAgICB2YXIgc3RvcmFnZSA9IE1ldHJvLnN0b3JhZ2U7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBzdG9yYWdlLmdldEl0ZW0oc3RvcmVfa2V5KTtcbiAgICAgICAgICAgICAgICB2YXIgaXNfcmFkaW8gPSBjaGVjay5hdHRyKCd0eXBlJykgPT09ICdyYWRpbyc7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNfcmFkaW8pIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFVdGlscy5pc1ZhbHVlKGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gW3ZhbF07XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkoZGF0YSkuaW5kZXhPZih2YWwpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaCh2YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLmFycmF5RGVsZXRlKGRhdGEsIHZhbCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gW107XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzdG9yYWdlLnNldEl0ZW0oc3RvcmVfa2V5LCBkYXRhKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImNoZWNrLWNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgY2hlY2s6IHRoaXMsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLnRhYmxlLXNlcnZpY2UtY2hlY2stYWxsIGlucHV0XCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGNoZWNrZWQgPSAkKHRoaXMpLmlzKFwiOmNoZWNrZWRcIik7XG4gICAgICAgICAgICAgICAgdmFyIHN0b3JlX2tleSA9IG8uY2hlY2tTdG9yZUtleS5yZXBsYWNlKFwiJDFcIiwgaWQpO1xuICAgICAgICAgICAgICAgIHZhciBzdG9yYWdlID0gTWV0cm8uc3RvcmFnZTtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSwgc3RvcmVkX2tleXM7XG5cbiAgICAgICAgICAgICAgICBpZiAoby51c2VDdXJyZW50U2xpY2UgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RvcmVkX2tleXMgPSBzdG9yYWdlLmdldEl0ZW0oc3RvcmVfa2V5LCBbXSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaCh0aGF0LmN1cnJlbnRTbGljZSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RvcmVkX2tleXMuaW5kZXhPZihcIlwiK3RoaXNbby5jaGVja0NvbEluZGV4XSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlZF9rZXlzLnB1c2goXCJcIit0aGlzW28uY2hlY2tDb2xJbmRleF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2godGhhdC5jdXJyZW50U2xpY2UsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IFwiXCIrdGhpc1tvLmNoZWNrQ29sSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdG9yZWRfa2V5cy5pbmRleE9mKGtleSkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1ldHJvLnV0aWxzLmFycmF5RGVsZXRlKHN0b3JlZF9rZXlzLCBrZXkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHN0b3JlZF9rZXlzXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaCh0aGF0LmZpbHRlcmVkSXRlbXMsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5pbmRleE9mKHRoaXNbby5jaGVja0NvbEluZGV4XSkgIT09IC0xKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKFwiXCIgKyB0aGlzW28uY2hlY2tDb2xJbmRleF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gW107XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzdG9yYWdlLnNldEl0ZW0oc3RvcmVfa2V5LCBkYXRhKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2RyYXcoKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImNoZWNrLWNsaWNrLWFsbFwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGNoZWNrOiB0aGlzLFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IGNoZWNrZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgX3NlYXJjaCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5zZWFyY2hTdHJpbmcgPSB0aGlzLnZhbHVlLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGF0LmlucHV0X2ludGVydmFsKTsgdGhhdC5pbnB1dF9pbnRlcnZhbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmICghdGhhdC5pbnB1dF9pbnRlcnZhbCkgdGhhdC5pbnB1dF9pbnRlcnZhbCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5jdXJyZW50UGFnZSA9IDE7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2RyYXcoKTtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGF0LmlucHV0X2ludGVydmFsKTsgdGhhdC5pbnB1dF9pbnRlcnZhbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0sIG8uc2VhcmNoVGhyZXNob2xkKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNlYXJjaC5vbihNZXRyby5ldmVudHMuaW5wdXRjaGFuZ2UsIF9zZWFyY2gpO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZSh0aGlzLndyYXBwZXJTZWFyY2gpKSB7XG4gICAgICAgICAgICAgICAgY3VzdG9tU2VhcmNoID0gdGhpcy53cmFwcGVyU2VhcmNoLmZpbmQoXCJpbnB1dFwiKTtcbiAgICAgICAgICAgICAgICBpZiAoY3VzdG9tU2VhcmNoLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tU2VhcmNoLm9uKE1ldHJvLmV2ZW50cy5pbnB1dGNoYW5nZSwgX3NlYXJjaCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBwYWdlTGlua0NsaWNrKGwpe1xuICAgICAgICAgICAgICAgIHZhciBsaW5rID0gJChsKTtcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGxpbmsucGFyZW50KCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoYXQuZmlsdGVyZWRJdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5oYXNDbGFzcyhcImFjdGl2ZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmhhc0NsYXNzKFwic2VydmljZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobGluay5kYXRhKFwicGFnZVwiKSA9PT0gXCJwcmV2XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBhZ2UtLTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LmN1cnJlbnRQYWdlID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5jdXJyZW50UGFnZSA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnRQYWdlKys7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5jdXJyZW50UGFnZSA+IHRoYXQucGFnZXNDb3VudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBhZ2UgPSB0aGF0LnBhZ2VzQ291bnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnRQYWdlID0gbGluay5kYXRhKFwicGFnZVwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9kcmF3KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbXBvbmVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLnBhZ2luYXRpb24gLnBhZ2UtbGlua1wiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHBhZ2VMaW5rQ2xpY2sodGhpcylcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZSh0aGlzLndyYXBwZXJQYWdpbmF0aW9uKSkge1xuICAgICAgICAgICAgICAgIHRoaXMud3JhcHBlclBhZ2luYXRpb24ub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5wYWdpbmF0aW9uIC5wYWdlLWxpbmtcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgcGFnZUxpbmtDbGljayh0aGlzKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVJbnNwZWN0b3JFdmVudHMoKTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmpzLXRhYmxlLWNydWQtYnV0dG9uXCIsIGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVJbnNwZWN0b3JFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGluc3BlY3RvciA9IHRoaXMuaW5zcGVjdG9yO1xuICAgICAgICAgICAgLy8gSW5zcGVjdG9yIGV2ZW50XG5cbiAgICAgICAgICAgIHRoaXMuX3JlbW92ZUluc3BlY3RvckV2ZW50cygpO1xuXG4gICAgICAgICAgICBpbnNwZWN0b3Iub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5qcy10YWJsZS1pbnNwZWN0b3ItZmllbGQtdXBcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgYnV0dG9uID0gJCh0aGlzKSwgdHIgPSBidXR0b24uY2xvc2VzdChcInRyXCIpO1xuICAgICAgICAgICAgICAgIHZhciB0cl9wcmV2ID0gdHIucHJldihcInRyXCIpO1xuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IHRyLmRhdGEoXCJpbmRleFwiKTtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXhfdmlldztcbiAgICAgICAgICAgICAgICBpZiAodHJfcHJldi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdHIuaW5zZXJ0QmVmb3JlKHRyX3ByZXYpO1xuICAgICAgICAgICAgICAgIHRyLmFkZENsYXNzKFwiZmxhc2hcIik7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB0ci5yZW1vdmVDbGFzcyhcImZsYXNoXCIpO1xuICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICAgICAgICAgIGluZGV4X3ZpZXcgPSB0ci5pbmRleCgpO1xuXG4gICAgICAgICAgICAgICAgdHIuZGF0YShcImluZGV4LXZpZXdcIiwgaW5kZXhfdmlldyk7XG4gICAgICAgICAgICAgICAgdGhhdC52aWV3W2luZGV4XVsnaW5kZXgtdmlldyddID0gaW5kZXhfdmlldztcblxuICAgICAgICAgICAgICAgICQuZWFjaCh0ci5uZXh0QWxsKCksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0ID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXhfdmlldysrO1xuICAgICAgICAgICAgICAgICAgICB0LmRhdGEoXCJpbmRleC12aWV3XCIsIGluZGV4X3ZpZXcpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnZpZXdbdC5kYXRhKFwiaW5kZXhcIildWydpbmRleC12aWV3J10gPSBpbmRleF92aWV3O1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5fY3JlYXRlVGFibGVIZWFkZXIoKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9kcmF3KCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaW5zcGVjdG9yLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuanMtdGFibGUtaW5zcGVjdG9yLWZpZWxkLWRvd25cIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgYnV0dG9uID0gJCh0aGlzKSwgdHIgPSBidXR0b24uY2xvc2VzdChcInRyXCIpO1xuICAgICAgICAgICAgICAgIHZhciB0cl9uZXh0ID0gdHIubmV4dChcInRyXCIpO1xuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IHRyLmRhdGEoXCJpbmRleFwiKTtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXhfdmlldztcbiAgICAgICAgICAgICAgICBpZiAodHJfbmV4dC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdHIuaW5zZXJ0QWZ0ZXIodHJfbmV4dCk7XG4gICAgICAgICAgICAgICAgdHIuYWRkQ2xhc3MoXCJmbGFzaFwiKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHRyLnJlbW92ZUNsYXNzKFwiZmxhc2hcIik7XG4gICAgICAgICAgICAgICAgfSwgMTAwMCk7XG4gICAgICAgICAgICAgICAgaW5kZXhfdmlldyA9IHRyLmluZGV4KCk7XG5cbiAgICAgICAgICAgICAgICB0ci5kYXRhKFwiaW5kZXgtdmlld1wiLCBpbmRleF92aWV3KTtcbiAgICAgICAgICAgICAgICB0aGF0LnZpZXdbaW5kZXhdWydpbmRleC12aWV3J10gPSBpbmRleF92aWV3O1xuXG4gICAgICAgICAgICAgICAgJC5lYWNoKHRyLnByZXZBbGwoKSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICBpbmRleF92aWV3LS07XG4gICAgICAgICAgICAgICAgICAgIHQuZGF0YShcImluZGV4LXZpZXdcIiwgaW5kZXhfdmlldyk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQudmlld1t0LmRhdGEoXCJpbmRleFwiKV1bJ2luZGV4LXZpZXcnXSA9IGluZGV4X3ZpZXc7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9jcmVhdGVUYWJsZUhlYWRlcigpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2RyYXcoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpbnNwZWN0b3Iub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcImlucHV0W3R5cGU9Y2hlY2tib3hdXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGNoZWNrID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gY2hlY2suaXMoXCI6Y2hlY2tlZFwiKTtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBjaGVjay52YWwoKTtcbiAgICAgICAgICAgICAgICB2YXIgb3AgPSBbJ2NscycsICdjbHNDb2x1bW4nXTtcblxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKG9wLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGE7XG4gICAgICAgICAgICAgICAgICAgICAgICBhID0gVXRpbHMuaXNWYWx1ZSh0aGF0LmhlYWRzW2luZGV4XVt0aGlzXSkgPyAodGhhdC5oZWFkc1tpbmRleF1bdGhpc10pLnRvQXJyYXkoXCIgXCIpIDogW107XG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5hcnJheURlbGV0ZShhLCBcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaGVhZHNbaW5kZXhdW3RoaXNdID0gYS5qb2luKFwiIFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQudmlld1tpbmRleF1bJ3Nob3cnXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQuZWFjaChvcCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBhID0gVXRpbHMuaXNWYWx1ZSh0aGF0LmhlYWRzW2luZGV4XVt0aGlzXSkgPyAodGhhdC5oZWFkc1tpbmRleF1bdGhpc10pLnRvQXJyYXkoXCIgXCIpIDogW107XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5pbmRleE9mKFwiaGlkZGVuXCIpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEucHVzaChcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaGVhZHNbaW5kZXhdW3RoaXNdID0gYS5qb2luKFwiIFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQudmlld1tpbmRleF1bJ3Nob3cnXSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9jcmVhdGVUYWJsZUhlYWRlcigpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2RyYXcoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpbnNwZWN0b3IuZmluZChcImlucHV0W3R5cGU9bnVtYmVyXVwiKS5vbihNZXRyby5ldmVudHMuaW5wdXRjaGFuZ2UsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGlucHV0ID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBpbnB1dC5hdHRyKFwiZGF0YS1pbmRleFwiKTtcbiAgICAgICAgICAgICAgICB2YXIgdmFsID0gcGFyc2VJbnQoaW5wdXQudmFsKCkpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC52aWV3W2luZGV4XVsnc2l6ZSddID0gdmFsID09PSAwID8gXCJcIiA6IHZhbDtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2NyZWF0ZVRhYmxlSGVhZGVyKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaW5zcGVjdG9yLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuanMtdGFibGUtaW5zcGVjdG9yLXNhdmVcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0Ll9zYXZlVGFibGVWaWV3KCk7XG4gICAgICAgICAgICAgICAgdGhhdC5vcGVuSW5zcGVjdG9yKGZhbHNlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpbnNwZWN0b3Iub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5qcy10YWJsZS1pbnNwZWN0b3ItY2FuY2VsXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5vcGVuSW5zcGVjdG9yKGZhbHNlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpbnNwZWN0b3Iub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5qcy10YWJsZS1pbnNwZWN0b3ItcmVzZXRcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0LnJlc2V0VmlldygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3JlbW92ZUluc3BlY3RvckV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBpbnNwZWN0b3IgPSB0aGlzLmluc3BlY3RvcjtcbiAgICAgICAgICAgIGluc3BlY3Rvci5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5qcy10YWJsZS1pbnNwZWN0b3ItZmllbGQtdXBcIik7XG4gICAgICAgICAgICBpbnNwZWN0b3Iub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuanMtdGFibGUtaW5zcGVjdG9yLWZpZWxkLWRvd25cIik7XG4gICAgICAgICAgICBpbnNwZWN0b3Iub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCJpbnB1dFt0eXBlPWNoZWNrYm94XVwiKTtcbiAgICAgICAgICAgIGluc3BlY3Rvci5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5qcy10YWJsZS1pbnNwZWN0b3Itc2F2ZVwiKTtcbiAgICAgICAgICAgIGluc3BlY3Rvci5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5qcy10YWJsZS1pbnNwZWN0b3ItY2FuY2VsXCIpO1xuICAgICAgICAgICAgaW5zcGVjdG9yLm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmpzLXRhYmxlLWluc3BlY3Rvci1yZXNldFwiKTtcbiAgICAgICAgICAgIGluc3BlY3Rvci5maW5kKFwiaW5wdXRbdHlwZT1udW1iZXJdXCIpLm9mZihNZXRyby5ldmVudHMuaW5wdXRjaGFuZ2UpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9zYXZlVGFibGVWaWV3OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHZpZXcgPSB0aGlzLnZpZXc7XG4gICAgICAgICAgICB2YXIgaWQgPSBlbGVtZW50LmF0dHIoXCJpZFwiKTtcbiAgICAgICAgICAgIHZhciB2aWV3UGF0aCA9IG8udmlld1NhdmVQYXRoLnJlcGxhY2UoXCIkMVwiLCBpZCk7XG4gICAgICAgICAgICB2YXIgc3RvcmFnZSA9IE1ldHJvLnN0b3JhZ2U7XG5cbiAgICAgICAgICAgIGlmIChvLnZpZXdTYXZlTW9kZS50b0xvd2VyQ2FzZSgpID09PSBcImNsaWVudFwiKSB7XG4gICAgICAgICAgICAgICAgc3RvcmFnZS5zZXRJdGVtKHZpZXdQYXRoLCB2aWV3KTtcblxuICAgICAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInZpZXctc2F2ZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldDogXCJjbGllbnRcIixcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogby52aWV3U2F2ZVBhdGgsXG4gICAgICAgICAgICAgICAgICAgIHZpZXc6IHZpZXdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIHBvc3RfZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgaWQgOiBlbGVtZW50LmF0dHIoXCJpZFwiKSxcbiAgICAgICAgICAgICAgICAgICAgdmlldyA6IHZpZXdcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgZmV0Y2godmlld1BhdGgsIHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIlxuICAgICAgICAgICAgICAgICAgICAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHBvc3RfZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgLCBoZWFkZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiQ29udGVudC10eXBlXCI6IFwiYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04XCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKE1ldHJvLmZldGNoLnN0YXR1cylcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oTWV0cm8uZmV0Y2gudGV4dClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJ2aWV3LXNhdmVcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogXCJzZXJ2ZXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBvLnZpZXdTYXZlUGF0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3OiB2aWV3LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RfZGF0YTogcG9zdF9kYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlOiBkYXRhXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImRhdGEtc2F2ZS1lcnJvclwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBvLnZpZXdTYXZlUGF0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZXJyb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdF9kYXRhOiBwb3N0X2RhdGFcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfaW5mbzogZnVuY3Rpb24oc3RhcnQsIHN0b3AsIGxlbmd0aCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjb21wb25lbnQgPSBlbGVtZW50LmNsb3Nlc3QoXCIudGFibGUtY29tcG9uZW50XCIpO1xuICAgICAgICAgICAgdmFyIGluZm8gPSBVdGlscy5pc1ZhbHVlKHRoaXMud3JhcHBlckluZm8pID8gdGhpcy53cmFwcGVySW5mbyA6IGNvbXBvbmVudC5maW5kKFwiLnRhYmxlLWluZm9cIik7XG4gICAgICAgICAgICB2YXIgdGV4dDtcblxuICAgICAgICAgICAgaWYgKGluZm8ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHN0b3AgPiBsZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBzdG9wID0gbGVuZ3RoO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5pdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBzdGFydCA9IHN0b3AgPSBsZW5ndGggPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0ZXh0ID0gby50YWJsZUluZm9UaXRsZSB8fCB0aGlzLmxvY2FsZS50YWJsZVtcImluZm9cIl07XG4gICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKFwiJDFcIiwgc3RhcnQpO1xuICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZShcIiQyXCIsIHN0b3ApO1xuICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZShcIiQzXCIsIGxlbmd0aCk7XG4gICAgICAgICAgICBpbmZvLmh0bWwodGV4dCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3BhZ2luZzogZnVuY3Rpb24obGVuZ3RoKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGNvbXBvbmVudCA9IGVsZW1lbnQuY2xvc2VzdChcIi50YWJsZS1jb21wb25lbnRcIik7XG4gICAgICAgICAgICB0aGlzLnBhZ2VzQ291bnQgPSBNYXRoLmNlaWwobGVuZ3RoIC8gby5yb3dzKTsgLy8g0JrQvtGB0YLRi9C70YxcbiAgICAgICAgICAgIE1ldHJvLnBhZ2luYXRpb24oe1xuICAgICAgICAgICAgICAgIGxlbmd0aDogbGVuZ3RoLFxuICAgICAgICAgICAgICAgIHJvd3M6IG8ucm93cyxcbiAgICAgICAgICAgICAgICBjdXJyZW50OiB0aGlzLmN1cnJlbnRQYWdlLFxuICAgICAgICAgICAgICAgIHRhcmdldDogVXRpbHMuaXNWYWx1ZSh0aGlzLndyYXBwZXJQYWdpbmF0aW9uKSA/IHRoaXMud3JhcHBlclBhZ2luYXRpb24gOiBjb21wb25lbnQuZmluZChcIi50YWJsZS1wYWdpbmF0aW9uXCIpLFxuICAgICAgICAgICAgICAgIGNsYVBhZ2luYXRpb246IG8uY2xzUGFnaW5hdGlvbixcbiAgICAgICAgICAgICAgICBwcmV2VGl0bGU6IG8ucGFnaW5hdGlvblByZXZUaXRsZSB8fCB0aGlzLmxvY2FsZS50YWJsZVtcInByZXZcIl0sXG4gICAgICAgICAgICAgICAgbmV4dFRpdGxlOiBvLnBhZ2luYXRpb25OZXh0VGl0bGUgfHwgdGhpcy5sb2NhbGUudGFibGVbXCJuZXh0XCJdLFxuICAgICAgICAgICAgICAgIGRpc3RhbmNlOiBvLnBhZ2luYXRpb25TaG9ydE1vZGUgPT09IHRydWUgPyBvLnBhZ2luYXRpb25EaXN0YW5jZSA6IDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9maWx0ZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgaXRlbXM7XG4gICAgICAgICAgICBpZiAoKFV0aWxzLmlzVmFsdWUodGhpcy5zZWFyY2hTdHJpbmcpICYmIHRoYXQuc2VhcmNoU3RyaW5nLmxlbmd0aCA+PSBvLnNlYXJjaE1pbkxlbmd0aCkgfHwgdGhpcy5maWx0ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBpdGVtcyA9IHRoaXMuaXRlbXMuZmlsdGVyKGZ1bmN0aW9uKHJvdyl7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHJvd19kYXRhID0gXCJcIiwgcmVzdWx0LCBzZWFyY2hfcmVzdWx0LCBpLCBqID0gMDtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5maWx0ZXJzLmxlbmd0aCA+IDApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gby5maWx0ZXJzT3BlcmF0b3IudG9Mb3dlckNhc2UoKSA9PT0gXCJhbmRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGF0LmZpbHRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNOdWxsKHRoYXQuZmlsdGVyc1tpXSkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGorKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBvLmZpbHRlcnNPcGVyYXRvci50b0xvd2VyQ2FzZSgpID09PSBcImFuZFwiID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICYmIFV0aWxzLmV4ZWModGhhdC5maWx0ZXJzW2ldLCBbcm93LCB0aGF0LmhlYWRzXSkgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgfHwgVXRpbHMuZXhlYyh0aGF0LmZpbHRlcnNbaV0sIFtyb3csIHRoYXQuaGVhZHNdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGogPT09IDApIHJlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQuc2VhcmNoRmllbGRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaCh0aGF0LmhlYWRzLCBmdW5jdGlvbihpLCB2KXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5zZWFyY2hGaWVsZHMuaW5kZXhPZih2Lm5hbWUpID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93X2RhdGEgKz0gXCLigKJcIityb3dbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvd19kYXRhID0gcm93LmpvaW4oXCLigKJcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByb3dfZGF0YSA9IHJvd19kYXRhLnJlcGxhY2UoL1tcXG5cXHJdK3xbXFxzXXsyLH0vZywgJyAnKS50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoX3Jlc3VsdCA9IFV0aWxzLmlzVmFsdWUodGhhdC5zZWFyY2hTdHJpbmcpICYmIHRoYXQuc2VhcmNoU3RyaW5nLmxlbmd0aCA+PSBvLnNlYXJjaE1pbkxlbmd0aCA/IH5yb3dfZGF0YS5pbmRleE9mKHRoYXQuc2VhcmNoU3RyaW5nKSA6IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIHNlYXJjaF9yZXN1bHQ7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZmlsdGVyLXJvdy1hY2NlcHRlZFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93OiByb3dcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZmlsdGVyLXJvdy1kZWNsaW5lZFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93OiByb3dcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpdGVtcyA9IHRoaXMuaXRlbXM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInNlYXJjaFwiLCB7XG4gICAgICAgICAgICAgICAgc2VhcmNoOiB0aGF0LnNlYXJjaFN0cmluZyxcbiAgICAgICAgICAgICAgICBpdGVtczogaXRlbXNcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLmZpbHRlcmVkSXRlbXMgPSBpdGVtcztcblxuICAgICAgICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9kcmF3OiBmdW5jdGlvbihjYil7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgYm9keSA9IGVsZW1lbnQuZmluZChcInRib2R5XCIpO1xuICAgICAgICAgICAgdmFyIGksIGosIHRyLCB0ZCwgY2hlY2ssIGNlbGxzLCB0ZHMsIGlzX2V2ZW5fcm93O1xuICAgICAgICAgICAgdmFyIHN0YXJ0ID0gcGFyc2VJbnQoby5yb3dzKSA9PT0gLTEgPyAwIDogby5yb3dzICogKHRoaXMuY3VycmVudFBhZ2UgLSAxKSxcbiAgICAgICAgICAgICAgICBzdG9wID0gcGFyc2VJbnQoby5yb3dzKSA9PT0gLTEgPyB0aGlzLml0ZW1zLmxlbmd0aCAtIDEgOiBzdGFydCArIG8ucm93cyAtIDE7XG4gICAgICAgICAgICB2YXIgaXRlbXMsIGNoZWNrZWRJdGVtcyA9IFtdO1xuICAgICAgICAgICAgdmFyIHN0b3JlZF9rZXlzID0gTWV0cm8uc3RvcmFnZS5nZXRJdGVtKG8uY2hlY2tTdG9yZUtleS5yZXBsYWNlKFwiJDFcIiwgZWxlbWVudC5hdHRyKCdpZCcpKSk7XG5cbiAgICAgICAgICAgIHZhciB2aWV3ID0gby5zdGF0aWNWaWV3ID8gdGhpcy52aWV3RGVmYXVsdCA6IHRoaXMudmlldztcblxuICAgICAgICAgICAgYm9keS5odG1sKFwiXCIpO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMuaGVhZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwiSGVhZHMgaXMgbm90IGRlZmluZWQgZm9yIHRhYmxlIElEIFwiICsgZWxlbWVudC5hdHRyKFwiaWRcIikpO1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGl0ZW1zID0gdGhpcy5fZmlsdGVyKCk7XG5cbiAgICAgICAgICAgIHRoaXMuY3VycmVudFNsaWNlID0gaXRlbXMuc2xpY2Uoc3RhcnQsIHN0b3AgKyAxKTtcbiAgICAgICAgICAgIGNoZWNrZWRJdGVtcyA9IFtdO1xuXG4gICAgICAgICAgICBpZiAoaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IHN0YXJ0OyBpIDw9IHN0b3A7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBjZWxscyA9IGl0ZW1zW2ldO1xuICAgICAgICAgICAgICAgICAgICB0ZHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFVdGlscy5pc1ZhbHVlKGNlbGxzKSkge2NvbnRpbnVlO31cbiAgICAgICAgICAgICAgICAgICAgdHIgPSAkKFwiPHRyPlwiKS5hZGRDbGFzcyhvLmNsc0JvZHlSb3cpO1xuICAgICAgICAgICAgICAgICAgICB0ci5kYXRhKCdvcmlnaW5hbCcsIGNlbGxzKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBSb3dudW1cblxuICAgICAgICAgICAgICAgICAgICBpc19ldmVuX3JvdyA9IGkgJSAyID09PSAwO1xuXG4gICAgICAgICAgICAgICAgICAgIHRkID0gJChcIjx0ZD5cIikuaHRtbChpICsgMSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LnNlcnZpY2VbMF0uY2xzQ29sdW1uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRkLmFkZENsYXNzKHRoYXQuc2VydmljZVswXS5jbHNDb2x1bW4pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRkLmFwcGVuZFRvKHRyKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBDaGVja2JveFxuICAgICAgICAgICAgICAgICAgICB0ZCA9ICQoXCI8dGQ+XCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoby5jaGVja1R5cGUgPT09IFwiY2hlY2tib3hcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2sgPSAkKFwiPGlucHV0IHR5cGU9J2NoZWNrYm94JyBkYXRhLXN0eWxlPSdcIitvLmNoZWNrU3R5bGUrXCInIGRhdGEtcm9sZT0nY2hlY2tib3gnIG5hbWU9J1wiICsgKFV0aWxzLmlzVmFsdWUoby5jaGVja05hbWUpID8gby5jaGVja05hbWUgOiAndGFibGVfcm93X2NoZWNrJykgKyBcIltdJyB2YWx1ZT0nXCIgKyBpdGVtc1tpXVtvLmNoZWNrQ29sSW5kZXhdICsgXCInPlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrID0gJChcIjxpbnB1dCB0eXBlPSdyYWRpbycgZGF0YS1zdHlsZT0nXCIrby5jaGVja1N0eWxlK1wiJyBkYXRhLXJvbGU9J3JhZGlvJyBuYW1lPSdcIiArIChVdGlscy5pc1ZhbHVlKG8uY2hlY2tOYW1lKSA/IG8uY2hlY2tOYW1lIDogJ3RhYmxlX3Jvd19jaGVjaycpICsgXCInIHZhbHVlPSdcIiArIGl0ZW1zW2ldW28uY2hlY2tDb2xJbmRleF0gKyBcIic+XCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoc3RvcmVkX2tleXMpICYmIEFycmF5LmlzQXJyYXkoc3RvcmVkX2tleXMpICYmIHN0b3JlZF9rZXlzLmluZGV4T2YoXCJcIitpdGVtc1tpXVtvLmNoZWNrQ29sSW5kZXhdKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVjay5wcm9wKFwiY2hlY2tlZFwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWRJdGVtcy5wdXNoKGNlbGxzKVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY2hlY2suYWRkQ2xhc3MoXCJ0YWJsZS1zZXJ2aWNlLWNoZWNrXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImNoZWNrLWRyYXdcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2s6IGNoZWNrXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrLmFwcGVuZFRvKHRkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQuc2VydmljZVsxXS5jbHNDb2x1bW4gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGQuYWRkQ2xhc3ModGhhdC5zZXJ2aWNlWzFdLmNsc0NvbHVtbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGQuYXBwZW5kVG8odHIpO1xuICAgICAgICAgICAgICAgICAgICAvLyBFbmQgb2YgY2hlY2tcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgY2VsbHMubGVuZ3RoOyBqKyspe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGRzW2pdID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICQuZWFjaChjZWxscywgZnVuY3Rpb24oY2VsbF9pbmRleCl7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZCA9ICQoXCI8dGQ+XCIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZSh0aGF0LmhlYWRzW2NlbGxfaW5kZXhdLnRlbXBsYXRlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IHRoYXQuaGVhZHNbY2VsbF9pbmRleF0udGVtcGxhdGUucmVwbGFjZSgvJVZBTCUvZywgdmFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgdGQuaHRtbCh2YWwpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZC5hZGRDbGFzcyhvLmNsc0JvZHlDZWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKHRoYXQuaGVhZHNbY2VsbF9pbmRleF0uY2xzQ29sdW1uKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRkLmFkZENsYXNzKHRoYXQuaGVhZHNbY2VsbF9pbmRleF0uY2xzQ29sdW1uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFV0aWxzLmJvb2wodmlld1tjZWxsX2luZGV4XS5zaG93KSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZC5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFV0aWxzLmJvb2wodmlld1tjZWxsX2luZGV4XS5zaG93KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRkLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZC5kYXRhKCdvcmlnaW5hbCcsdGhpcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRkc1t2aWV3W2NlbGxfaW5kZXhdWydpbmRleC12aWV3J11dID0gdGQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImRyYXctY2VsbFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGQ6IHRkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbDogdmFsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxJbmRleDogY2VsbF9pbmRleCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkOiB0aGF0LmhlYWRzW2NlbGxfaW5kZXhdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBjZWxsc1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvLmNlbGxXcmFwcGVyID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiZGF0YS13cmFwcGVyXCIpLmFkZENsYXNzKG8uY2xzQ2VsbFdyYXBwZXIpLmh0bWwodGQuaHRtbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZC5odG1sKCcnKS5hcHBlbmQodmFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGNlbGxzLmxlbmd0aDsgaisrKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRkc1tqXS5hcHBlbmRUbyh0cik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImFwcGVuZC1jZWxsXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZDogdGRzW2pdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyOiB0cixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleDogalxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJkcmF3LXJvd1wiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cjogdHIsXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3OiB0aGF0LnZpZXcsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkczogdGhhdC5oZWFkcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBjZWxsc1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB0ci5hZGRDbGFzcyhvLmNsc1JvdykuYWRkQ2xhc3MoaXNfZXZlbl9yb3cgPyBvLmNsc0V2ZW5Sb3cgOiBvLmNsc09kZFJvdykuYXBwZW5kVG8oYm9keSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiYXBwZW5kLXJvd1wiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cjogdHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJCh0aGlzLmNvbXBvbmVudCkuZmluZChcIi50YWJsZS1zZXJ2aWNlLWNoZWNrLWFsbCBpbnB1dFwiKS5wcm9wKFwiY2hlY2tlZFwiLCBjaGVja2VkSXRlbXMubGVuZ3RoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaiA9IDA7XG4gICAgICAgICAgICAgICAgJC5lYWNoKHZpZXcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNob3cpIGorKztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoby5jaGVjayA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBqKys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvLnJvd251bSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBqKys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRyID0gJChcIjx0cj5cIikuYWRkQ2xhc3Moby5jbHNCb2R5Um93KS5hcHBlbmRUbyhib2R5KTtcbiAgICAgICAgICAgICAgICB0ZCA9ICQoXCI8dGQ+XCIpLmF0dHIoXCJjb2xzcGFuXCIsIGopLmFkZENsYXNzKFwidGV4dC1jZW50ZXJcIikuaHRtbCgkKFwiPHNwYW4+XCIpLmFkZENsYXNzKG8uY2xzRW1wdHlUYWJsZVRpdGxlKS5odG1sKG8uZW1wdHlUYWJsZVRpdGxlIHx8IHRoYXQubG9jYWxlLnRhYmxlW1wiZW1wdHlcIl0pKTtcbiAgICAgICAgICAgICAgICB0ZC5hcHBlbmRUbyh0cik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2luZm8oc3RhcnQgKyAxLCBzdG9wICsgMSwgaXRlbXMubGVuZ3RoKTtcbiAgICAgICAgICAgIHRoaXMuX3BhZ2luZyhpdGVtcy5sZW5ndGgpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5hY3Rpdml0eSkgdGhpcy5hY3Rpdml0eS5oaWRlKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImRyYXdcIik7XG5cbiAgICAgICAgICAgIGlmIChjYiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgVXRpbHMuZXhlYyhjYiwgbnVsbCwgZWxlbWVudFswXSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfZ2V0SXRlbUNvbnRlbnQ6IGZ1bmN0aW9uKHJvdyl7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciByZXN1bHQsIGNvbCA9IHJvd1t0aGlzLnNvcnQuY29sSW5kZXhdO1xuICAgICAgICAgICAgdmFyIGZvcm1hdCA9IHRoaXMuaGVhZHNbdGhpcy5zb3J0LmNvbEluZGV4XS5mb3JtYXQ7XG4gICAgICAgICAgICB2YXIgZm9ybWF0TWFzayA9ICFVdGlscy5pc051bGwodGhpcy5oZWFkcykgJiYgIVV0aWxzLmlzTnVsbCh0aGlzLmhlYWRzW3RoaXMuc29ydC5jb2xJbmRleF0pICYmIFV0aWxzLmlzVmFsdWUodGhpcy5oZWFkc1t0aGlzLnNvcnQuY29sSW5kZXhdWydmb3JtYXRNYXNrJ10pID8gdGhpcy5oZWFkc1t0aGlzLnNvcnQuY29sSW5kZXhdWydmb3JtYXRNYXNrJ10gOiBcIiVZLSVtLSVkXCI7XG4gICAgICAgICAgICB2YXIgdGhvdXNhbmRTZXBhcmF0b3IgPSB0aGlzLmhlYWRzICYmIHRoaXMuaGVhZHNbdGhpcy5zb3J0LmNvbEluZGV4XSAmJiB0aGlzLmhlYWRzW3RoaXMuc29ydC5jb2xJbmRleF1bXCJ0aG91c2FuZFNlcGFyYXRvclwiXSA/IHRoaXMuaGVhZHNbdGhpcy5zb3J0LmNvbEluZGV4XVtcInRob3VzYW5kU2VwYXJhdG9yXCJdIDogby50aG91c2FuZFNlcGFyYXRvcjtcbiAgICAgICAgICAgIHZhciBkZWNpbWFsU2VwYXJhdG9yICA9IHRoaXMuaGVhZHMgJiYgdGhpcy5oZWFkc1t0aGlzLnNvcnQuY29sSW5kZXhdICYmIHRoaXMuaGVhZHNbdGhpcy5zb3J0LmNvbEluZGV4XVtcImRlY2ltYWxTZXBhcmF0b3JcIl0gPyB0aGlzLmhlYWRzW3RoaXMuc29ydC5jb2xJbmRleF1bXCJkZWNpbWFsU2VwYXJhdG9yXCJdIDogby5kZWNpbWFsU2VwYXJhdG9yO1xuXG4gICAgICAgICAgICByZXN1bHQgPSAoXCJcIitjb2wpLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvW1xcblxccl0rfFtcXHNdezIsfS9nLCAnICcpLnRyaW0oKTtcblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUocmVzdWx0KSAmJiBVdGlscy5pc1ZhbHVlKGZvcm1hdCkpIHtcblxuICAgICAgICAgICAgICAgIGlmIChbJ251bWJlcicsICdpbnQnLCAnZmxvYXQnLCAnbW9uZXknXS5pbmRleE9mKGZvcm1hdCkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IFV0aWxzLnBhcnNlTnVtYmVyKHJlc3VsdCwgdGhvdXNhbmRTZXBhcmF0b3IsIGRlY2ltYWxTZXBhcmF0b3IpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHN3aXRjaCAoZm9ybWF0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRlXCI6IHJlc3VsdCA9IGZvcm1hdE1hc2sgPyBEYXRldGltZS5mcm9tKHJlc3VsdCwgZm9ybWF0TWFzaywgby5sb2NhbGUpIDogZGF0ZXRpbWUocmVzdWx0KTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJudW1iZXJcIjogcmVzdWx0ID0gK3Jlc3VsdDsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJpbnRcIjogcmVzdWx0ID0gcGFyc2VJbnQocmVzdWx0KTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJmbG9hdFwiOiByZXN1bHQgPSBwYXJzZUZsb2F0KHJlc3VsdCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwibW9uZXlcIjogcmVzdWx0ID0gVXRpbHMucGFyc2VNb25leShyZXN1bHQpOyBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImNhcmRcIjogcmVzdWx0ID0gVXRpbHMucGFyc2VDYXJkKHJlc3VsdCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwicGhvbmVcIjogcmVzdWx0ID0gVXRpbHMucGFyc2VQaG9uZShyZXN1bHQpOyBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYWRkSXRlbTogZnVuY3Rpb24oaXRlbSwgcmVkcmF3KXtcbiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShpdGVtKSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcIkl0ZW0gaXMgbm90IGFuIGFycmF5IGFuZCBjYW4ndCBiZSBhZGRlZFwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuaXRlbXMucHVzaChpdGVtKTtcbiAgICAgICAgICAgIGlmIChyZWRyYXcgIT09IGZhbHNlKSB0aGlzLmRyYXcoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBhZGRJdGVtczogZnVuY3Rpb24oaXRlbXMsIHJlZHJhdyl7XG4gICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoaXRlbXMpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwiSXRlbXMgaXMgbm90IGFuIGFycmF5IGFuZCBjYW4ndCBiZSBhZGRlZFwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaXRlbSkpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMucHVzaChpdGVtLCBmYWxzZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuZHJhdygpO1xuICAgICAgICAgICAgaWYgKHJlZHJhdyAhPT0gZmFsc2UpIHRoaXMuZHJhdygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHVwZGF0ZUl0ZW06IGZ1bmN0aW9uKGtleSwgZmllbGQsIHZhbHVlKXtcbiAgICAgICAgICAgIHZhciBpdGVtID0gdGhpcy5pdGVtc1t0aGlzLmluZGV4W2tleV1dO1xuICAgICAgICAgICAgdmFyIGZpZWxkSW5kZXggPSBudWxsO1xuICAgICAgICAgICAgaWYgKFV0aWxzLmlzTnVsbChpdGVtKSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignSXRlbSBpcyB1bmRlZmluZWQgZm9yIHVwZGF0ZScpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzTmFOKGZpZWxkKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGVhZHMuZm9yRWFjaChmdW5jdGlvbih2LCBpKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZbJ25hbWUnXSA9PT0gZmllbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkSW5kZXggPSBpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNOdWxsKGZpZWxkSW5kZXgpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdJdGVtIGlzIHVuZGVmaW5lZCBmb3IgdXBkYXRlLiBGaWVsZCAnICsgZmllbGQgKyAnIG5vdCBmb3VuZCBpbiBkYXRhIHN0cnVjdHVyZScpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpdGVtW2ZpZWxkSW5kZXhdID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLml0ZW1zW3RoaXMuaW5kZXhba2V5XV0gPSBpdGVtO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0SXRlbTogZnVuY3Rpb24oa2V5KXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLml0ZW1zW3RoaXMuaW5kZXhba2V5XV07XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVsZXRlSXRlbTogZnVuY3Rpb24oZmllbGRJbmRleCwgdmFsdWUpe1xuICAgICAgICAgICAgdmFyIGksIGRlbGV0ZUluZGV4ZXMgPSBbXTtcbiAgICAgICAgICAgIHZhciBpc19mdW5jID0gVXRpbHMuaXNGdW5jKHZhbHVlKTtcbiAgICAgICAgICAgIGZvcihpID0gMDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNfZnVuYykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoVXRpbHMuZXhlYyh2YWx1ZSwgW3RoaXMuaXRlbXNbaV1bZmllbGRJbmRleF1dKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlSW5kZXhlcy5wdXNoKGkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXRlbXNbaV1bZmllbGRJbmRleF0gPT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVJbmRleGVzLnB1c2goaSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBVdGlscy5hcnJheURlbGV0ZUJ5TXVsdGlwbGVLZXlzKHRoaXMuaXRlbXMsIGRlbGV0ZUluZGV4ZXMpO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBkZWxldGVJdGVtQnlOYW1lOiBmdW5jdGlvbihmaWVsZE5hbWUsIHZhbHVlKXtcbiAgICAgICAgICAgIHZhciBpLCBmaWVsZEluZGV4LCBkZWxldGVJbmRleGVzID0gW107XG4gICAgICAgICAgICB2YXIgaXNfZnVuYyA9IFV0aWxzLmlzRnVuYyh2YWx1ZSk7XG5cbiAgICAgICAgICAgIGZvcihpID0gMDsgaSA8IHRoaXMuaGVhZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5oZWFkc1tpXVsnbmFtZSddID09PSBmaWVsZE5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRJbmRleCA9IGk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZm9yKGkgPSAwOyBpIDwgdGhpcy5pdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChpc19mdW5jKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChVdGlscy5leGVjKHZhbHVlLCBbdGhpcy5pdGVtc1tpXVtmaWVsZEluZGV4XV0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVJbmRleGVzLnB1c2goaSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pdGVtc1tpXVtmaWVsZEluZGV4XSA9PT0gdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZUluZGV4ZXMucHVzaChpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5pdGVtcyA9IFV0aWxzLmFycmF5RGVsZXRlQnlNdWx0aXBsZUtleXModGhpcy5pdGVtcywgZGVsZXRlSW5kZXhlcyk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRyYXc6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLl9kcmF3KCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBzb3J0aW5nOiBmdW5jdGlvbihkaXIpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShkaXIpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zb3J0LmRpciA9IGRpcjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwic29ydC1zdGFydFwiLCB7XG4gICAgICAgICAgICAgICAgaXRlbXM6IHRoaXMuaXRlbXNcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLml0ZW1zLnNvcnQoZnVuY3Rpb24oYSwgYil7XG4gICAgICAgICAgICAgICAgdmFyIGMxID0gdGhhdC5fZ2V0SXRlbUNvbnRlbnQoYSk7XG4gICAgICAgICAgICAgICAgdmFyIGMyID0gdGhhdC5fZ2V0SXRlbUNvbnRlbnQoYik7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IDA7XG5cbiAgICAgICAgICAgICAgICBpZiAoYzEgPCBjMikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGF0LnNvcnQuZGlyID09PSBcImFzY1wiID8gLTEgOiAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoYzEgPiBjMikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGF0LnNvcnQuZGlyID09PSBcImFzY1wiID8gMSA6IC0xO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgIT09IDApIHtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJzb3J0LWl0ZW0tc3dpdGNoXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGE6IGEsXG4gICAgICAgICAgICAgICAgICAgICAgICBiOiBiLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0OiByZXN1bHRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJzb3J0LXN0b3BcIiwge1xuICAgICAgICAgICAgICAgIGl0ZW1zOiB0aGlzLml0ZW1zXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2VhcmNoOiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgdGhpcy5zZWFyY2hTdHJpbmcgPSB2YWwudHJpbSgpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gMTtcbiAgICAgICAgICAgIHRoaXMuX2RyYXcoKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9yZWJ1aWxkOiBmdW5jdGlvbihyZXZpZXcpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIG5lZWRfc29ydCA9IGZhbHNlLCBzb3J0YWJsZV9jb2x1bW5zO1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVJbmRleCgpO1xuXG4gICAgICAgICAgICBpZiAocmV2aWV3ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52aWV3ID0gdGhpcy5fY3JlYXRlVmlldygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVUYWJsZUhlYWRlcigpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlVGFibGVCb2R5KCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVUYWJsZUZvb3RlcigpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5oZWFkcy5sZW5ndGggPiAwKSAkLmVhY2godGhpcy5oZWFkcywgZnVuY3Rpb24oaSl7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB0aGlzO1xuICAgICAgICAgICAgICAgIGlmICghbmVlZF9zb3J0ICYmIFtcImFzY1wiLCBcImRlc2NcIl0uaW5kZXhPZihpdGVtLnNvcnREaXIpID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgbmVlZF9zb3J0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5zb3J0LmNvbEluZGV4ID0gaTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5zb3J0LmRpciA9IGl0ZW0uc29ydERpcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKG5lZWRfc29ydCkge1xuICAgICAgICAgICAgICAgIHNvcnRhYmxlX2NvbHVtbnMgPSBlbGVtZW50LmZpbmQoXCIuc29ydGFibGUtY29sdW1uXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3Jlc2V0U29ydENsYXNzKHNvcnRhYmxlX2NvbHVtbnMpO1xuICAgICAgICAgICAgICAgICQoc29ydGFibGVfY29sdW1ucy5nZXQodGhhdC5zb3J0LmNvbEluZGV4KSkuYWRkQ2xhc3MoXCJzb3J0LVwiK3RoYXQuc29ydC5kaXIpO1xuICAgICAgICAgICAgICAgIHRoaXMuc29ydGluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGF0LmN1cnJlbnRQYWdlID0gMTtcblxuICAgICAgICAgICAgdGhhdC5fZHJhdygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldEhlYWRzOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIHRoaXMuaGVhZHMgPSBkYXRhO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0SGVhZEl0ZW06IGZ1bmN0aW9uKG5hbWUsIGRhdGEpe1xuICAgICAgICAgICAgdmFyIGksIGluZGV4O1xuICAgICAgICAgICAgZm9yKGkgPSAwOyBpIDwgdGhpcy5oZWFkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmhlYWRzW2ldLm5hbWUgPT09IG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmhlYWRzW2luZGV4XSA9IGRhdGE7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRJdGVtczogZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICB0aGlzLml0ZW1zID0gZGF0YTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldERhdGE6IGZ1bmN0aW9uKC8qb2JqKi8gZGF0YSl7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdGhpcy5pdGVtcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5oZWFkcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5mb290cyA9IFtdO1xuXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvLmhlYWQpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oZWFkcyA9IG8uaGVhZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoby5ib2R5KSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBvLmJvZHk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUl0ZW1zRnJvbUpTT04oZGF0YSk7XG5cbiAgICAgICAgICAgIHRoaXMuX3JlYnVpbGQodHJ1ZSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGxvYWREYXRhOiBmdW5jdGlvbihzb3VyY2UsIHJldmlldyl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZShyZXZpZXcpKSB7XG4gICAgICAgICAgICAgICAgcmV2aWV3ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5odG1sKFwiXCIpO1xuXG4gICAgICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUoc291cmNlKSkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVidWlsZChyZXZpZXcpO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG8uc291cmNlID0gc291cmNlO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiZGF0YS1sb2FkXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlOiBvLnNvdXJjZVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5hY3Rpdml0eS5zaG93KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGZldGNoKG8uc291cmNlKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oTWV0cm8uZmV0Y2guc3RhdHVzKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oTWV0cm8uZmV0Y2guanNvbilcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuYWN0aXZpdHkuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaXRlbXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmhlYWRzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5mb290cyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZGF0YS1sb2FkZWRcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2U6IG8uc291cmNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvLmhlYWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaGVhZHMgPSBvLmhlYWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoby5ib2R5KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0Lml0ZW1zID0gby5ib2R5O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2NyZWF0ZUl0ZW1zRnJvbUpTT04oZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fcmVidWlsZChyZXZpZXcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX3Jlc2V0SW5zcGVjdG9yKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJkYXRhLWxvYWQtZW5kXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBvLnNvdXJjZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5hY3Rpdml0eS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZGF0YS1sb2FkLWVycm9yXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBvLnNvdXJjZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVsb2FkOiBmdW5jdGlvbihyZXZpZXcpe1xuICAgICAgICAgICAgdGhpcy5sb2FkRGF0YSh0aGlzLm9wdGlvbnMuc291cmNlLCByZXZpZXcpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNsZWFyOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5pdGVtcyA9IFtdO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZHJhdygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG5leHQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiAodGhpcy5pdGVtcy5sZW5ndGggPT09IDApIHJldHVybiA7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlKys7XG4gICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50UGFnZSA+IHRoaXMucGFnZXNDb3VudCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSB0aGlzLnBhZ2VzQ291bnQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2RyYXcoKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIHByZXY6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiAodGhpcy5pdGVtcy5sZW5ndGggPT09IDApIHJldHVybiA7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlLS07XG4gICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50UGFnZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSAxO1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9kcmF3KCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBmaXJzdDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0aGlzLml0ZW1zLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSAxO1xuICAgICAgICAgICAgdGhpcy5fZHJhdygpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbGFzdDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0aGlzLml0ZW1zLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSB0aGlzLnBhZ2VzQ291bnQ7XG4gICAgICAgICAgICB0aGlzLl9kcmF3KCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBwYWdlOiBmdW5jdGlvbihudW0pe1xuICAgICAgICAgICAgaWYgKG51bSA8PSAwKSB7XG4gICAgICAgICAgICAgICAgbnVtID0gMTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG51bSA+IHRoaXMucGFnZXNDb3VudCkge1xuICAgICAgICAgICAgICAgIG51bSA9IHRoaXMucGFnZXNDb3VudDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IG51bTtcbiAgICAgICAgICAgIHRoaXMuX2RyYXcoKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFkZEZpbHRlcjogZnVuY3Rpb24oZiwgcmVkcmF3KXtcbiAgICAgICAgICAgIHZhciBmaWx0ZXJJbmRleCA9IG51bGwsIGksIGZ1bmMgPSBVdGlscy5pc0Z1bmMoZik7XG4gICAgICAgICAgICBpZiAoZnVuYyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCB0aGlzLmZpbHRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNOdWxsKHRoaXMuZmlsdGVyc1tpXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVySW5kZXggPSBpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbHRlcnNbaV0gPSBmdW5jO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc051bGwoZmlsdGVySW5kZXgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJzLnB1c2goZnVuYyk7XG4gICAgICAgICAgICAgICAgZmlsdGVySW5kZXggPSB0aGlzLmZpbHRlcnMubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHJlZHJhdyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSAxO1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhdygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZmlsdGVySW5kZXhcbiAgICAgICAgfSxcblxuICAgICAgICByZW1vdmVGaWx0ZXI6IGZ1bmN0aW9uKGtleSwgcmVkcmF3KXtcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyc1trZXldID0gbnVsbDtcbiAgICAgICAgICAgIGlmIChyZWRyYXcgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZUZpbHRlcnM6IGZ1bmN0aW9uKHJlZHJhdyl7XG4gICAgICAgICAgICB0aGlzLmZpbHRlcnMgPSBbXTtcbiAgICAgICAgICAgIGlmIChyZWRyYXcgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldEl0ZW1zOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXRlbXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0SGVhZHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5oZWFkcztcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRWaWV3OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudmlldztcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRGaWx0ZXJlZEl0ZW1zOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyZWRJdGVtcy5sZW5ndGggPiAwID8gdGhpcy5maWx0ZXJlZEl0ZW1zIDogdGhpcy5pdGVtcztcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRTZWxlY3RlZEl0ZW1zOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgc3RvcmVkX2tleXMgPSBNZXRyby5zdG9yYWdlLmdldEl0ZW0oby5jaGVja1N0b3JlS2V5LnJlcGxhY2UoXCIkMVwiLCBlbGVtZW50LmF0dHIoXCJpZFwiKSkpO1xuICAgICAgICAgICAgdmFyIHNlbGVjdGVkID0gW107XG5cbiAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZShzdG9yZWRfa2V5cykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICQuZWFjaCh0aGlzLml0ZW1zLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmIChzdG9yZWRfa2V5cy5pbmRleE9mKFwiXCIrdGhpc1tvLmNoZWNrQ29sSW5kZXhdKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQucHVzaCh0aGlzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZDtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRTdG9yZWRLZXlzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICByZXR1cm4gTWV0cm8uc3RvcmFnZS5nZXRJdGVtKG8uY2hlY2tTdG9yZUtleS5yZXBsYWNlKFwiJDFcIiwgZWxlbWVudC5hdHRyKFwiaWRcIikpLCBbXSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xlYXJTZWxlY3RlZDogZnVuY3Rpb24ocmVkcmF3KXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgTWV0cm8uc3RvcmFnZS5zZXRJdGVtKG8uY2hlY2tTdG9yZUtleS5yZXBsYWNlKFwiJDFcIiwgZWxlbWVudC5hdHRyKFwiaWRcIikpLCBbXSk7XG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCJ0YWJsZS1zZXJ2aWNlLWNoZWNrLWFsbCBpbnB1dFwiKS5wcm9wKFwiY2hlY2tlZFwiLCBmYWxzZSk7XG4gICAgICAgICAgICBpZiAocmVkcmF3ID09PSB0cnVlKSB0aGlzLl9kcmF3KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0RmlsdGVyczogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbHRlcnM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0RmlsdGVyc0luZGV4ZXM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJzSW5kZXhlcztcbiAgICAgICAgfSxcblxuICAgICAgICBvcGVuSW5zcGVjdG9yOiBmdW5jdGlvbihtb2RlKXtcbiAgICAgICAgICAgIHZhciBpbnMgPSB0aGlzLmluc3BlY3RvcjtcbiAgICAgICAgICAgIGlmIChtb2RlKSB7XG4gICAgICAgICAgICAgICAgaW5zLnNob3coMCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgaW5zLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3A6ICgkKHdpbmRvdykuaGVpZ2h0KCkgIC0gaW5zLm91dGVySGVpZ2h0KHRydWUpKSAvIDIgKyBwYWdlWU9mZnNldCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6ICgkKHdpbmRvdykud2lkdGgoKSAtIGlucy5vdXRlcldpZHRoKHRydWUpKSAvIDIgKyBwYWdlWE9mZnNldFxuICAgICAgICAgICAgICAgICAgICB9KS5kYXRhKFwib3BlblwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaW5zLmhpZGUoKS5kYXRhKFwib3BlblwiLCBmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2VJbnNwZWN0b3I6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLm9wZW5JbnNwZWN0b3IoZmFsc2UpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZUluc3BlY3RvcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMub3Blbkluc3BlY3RvcighdGhpcy5pbnNwZWN0b3IuZGF0YShcIm9wZW5cIikpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlc2V0VmlldzogZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgdGhpcy52aWV3ID0gdGhpcy5fY3JlYXRlVmlldygpO1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVUYWJsZUhlYWRlcigpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlVGFibGVGb290ZXIoKTtcbiAgICAgICAgICAgIHRoaXMuX2RyYXcoKTtcblxuICAgICAgICAgICAgdGhpcy5fcmVzZXRJbnNwZWN0b3IoKTtcbiAgICAgICAgICAgIHRoaXMuX3NhdmVUYWJsZVZpZXcoKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZWJ1aWxkSW5kZXg6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVJbmRleCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldEluZGV4OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXg7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXhwb3J0OiBmdW5jdGlvbih0bywgbW9kZSwgZmlsZW5hbWUsIG9wdGlvbnMpe1xuICAgICAgICAgICAgdmFyIEV4cG9ydCA9IE1ldHJvLmV4cG9ydDtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciB0YWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0YWJsZVwiKTtcbiAgICAgICAgICAgIHZhciBoZWFkID0gJChcIjx0aGVhZD5cIikuYXBwZW5kVG8odGFibGUpO1xuICAgICAgICAgICAgdmFyIGJvZHkgPSAkKFwiPHRib2R5PlwiKS5hcHBlbmRUbyh0YWJsZSk7XG4gICAgICAgICAgICB2YXIgaSwgaiwgY2VsbHMsIHRkcyA9IFtdLCBpdGVtcywgdHIsIHRkO1xuICAgICAgICAgICAgdmFyIHN0YXJ0LCBzdG9wO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIEV4cG9ydC50YWJsZVRvQ1NWICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbW9kZSA9IFV0aWxzLmlzVmFsdWUobW9kZSkgPyBtb2RlLnRvTG93ZXJDYXNlKCkgOiBcImFsbC1maWx0ZXJlZFwiO1xuICAgICAgICAgICAgZmlsZW5hbWUgPSBVdGlscy5pc1ZhbHVlKGZpbGVuYW1lKSA/IGZpbGVuYW1lIDogVXRpbHMuZWxlbWVudElkKFwidGFibGVcIikrXCItZXhwb3J0LmNzdlwiO1xuXG4gICAgICAgICAgICAvLyBDcmVhdGUgdGFibGUgaGVhZGVyXG4gICAgICAgICAgICB0ciA9ICQoXCI8dHI+XCIpO1xuICAgICAgICAgICAgY2VsbHMgPSB0aGlzLmhlYWRzO1xuXG4gICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgY2VsbHMubGVuZ3RoOyBqKyspe1xuICAgICAgICAgICAgICAgIHRkc1tqXSA9IG51bGw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICQuZWFjaChjZWxscywgZnVuY3Rpb24oY2VsbF9pbmRleCl7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB0aGlzO1xuICAgICAgICAgICAgICAgIGlmIChVdGlscy5ib29sKHRoYXQudmlld1tjZWxsX2luZGV4XVsnc2hvdyddKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGQgPSAkKFwiPHRoPlwiKTtcbiAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShpdGVtLnRpdGxlKSkge1xuICAgICAgICAgICAgICAgICAgICB0ZC5odG1sKGl0ZW0udGl0bGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0ZHNbdGhhdC52aWV3W2NlbGxfaW5kZXhdWydpbmRleC12aWV3J11dID0gdGQ7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGNlbGxzLmxlbmd0aDsgaisrKXtcbiAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZSh0ZHNbal0pKSB0ZHNbal0uYXBwZW5kVG8odHIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHIuYXBwZW5kVG8oaGVhZCk7XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSB0YWJsZSBkYXRhXG4gICAgICAgICAgICBpZiAobW9kZSA9PT0gXCJjaGVja2VkXCIpIHtcbiAgICAgICAgICAgICAgICBpdGVtcyA9IHRoaXMuZ2V0U2VsZWN0ZWRJdGVtcygpO1xuICAgICAgICAgICAgICAgIHN0YXJ0ID0gMDsgc3RvcCA9IGl0ZW1zLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG1vZGUgPT09IFwidmlld1wiKSB7XG4gICAgICAgICAgICAgICAgaXRlbXMgPSB0aGlzLl9maWx0ZXIoKTtcbiAgICAgICAgICAgICAgICBzdGFydCA9IHBhcnNlSW50KG8ucm93cykgPT09IC0xID8gMCA6IG8ucm93cyAqICh0aGlzLmN1cnJlbnRQYWdlIC0gMSk7XG4gICAgICAgICAgICAgICAgc3RvcCA9IHBhcnNlSW50KG8ucm93cykgPT09IC0xID8gaXRlbXMubGVuZ3RoIC0gMSA6IHN0YXJ0ICsgby5yb3dzIC0gMTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gXCJhbGxcIikge1xuICAgICAgICAgICAgICAgIGl0ZW1zID0gdGhpcy5pdGVtcztcbiAgICAgICAgICAgICAgICBzdGFydCA9IDA7IHN0b3AgPSBpdGVtcy5sZW5ndGggLSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpdGVtcyA9IHRoaXMuX2ZpbHRlcigpO1xuICAgICAgICAgICAgICAgIHN0YXJ0ID0gMDsgc3RvcCA9IGl0ZW1zLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvciAoaSA9IHN0YXJ0OyBpIDw9IHN0b3A7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKGl0ZW1zW2ldKSkge1xuICAgICAgICAgICAgICAgICAgICB0ciA9ICQoXCI8dHI+XCIpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNlbGxzID0gaXRlbXNbaV07XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGNlbGxzLmxlbmd0aDsgaisrKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRkc1tqXSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAkLmVhY2goY2VsbHMsIGZ1bmN0aW9uKGNlbGxfaW5kZXgpe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFV0aWxzLmJvb2wodGhhdC52aWV3W2NlbGxfaW5kZXhdLnNob3cpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZCA9ICQoXCI8dGQ+XCIpLmh0bWwodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZHNbdGhhdC52aWV3W2NlbGxfaW5kZXhdWydpbmRleC12aWV3J11dID0gdGQ7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBjZWxscy5sZW5ndGg7IGorKyl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZSh0ZHNbal0pKSB0ZHNbal0uYXBwZW5kVG8odHIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdHIuYXBwZW5kVG8oYm9keSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBzd2l0Y2ggKHRvKSB7XG4gICAgICAgICAgICAvLyAgICAgZGVmYXVsdDogRXhwb3J0LnRhYmxlVG9DU1YodGFibGUsIGZpbGVuYW1lLCBvcHRpb25zKTtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIEV4cG9ydC50YWJsZVRvQ1NWKHRhYmxlLCBmaWxlbmFtZSwgb3B0aW9ucyk7XG4gICAgICAgICAgICB0YWJsZS5yZW1vdmUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGF0dHJpYnV0ZU5hbWUpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBkYXRhQ2hlY2soKXtcbiAgICAgICAgICAgICAgICBvLmNoZWNrID0gVXRpbHMuYm9vbChlbGVtZW50LmF0dHIoXCJkYXRhLWNoZWNrXCIpKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9zZXJ2aWNlKCk7XG4gICAgICAgICAgICAgICAgdGhhdC5fY3JlYXRlVGFibGVIZWFkZXIoKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9kcmF3KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGRhdGFSb3dudW0oKXtcbiAgICAgICAgICAgICAgICBvLnJvd251bSA9IFV0aWxzLmJvb2woZWxlbWVudC5hdHRyKFwiZGF0YS1yb3dudW1cIikpO1xuICAgICAgICAgICAgICAgIHRoYXQuX3NlcnZpY2UoKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9jcmVhdGVUYWJsZUhlYWRlcigpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2RyYXcoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3dpdGNoIChhdHRyaWJ1dGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtY2hlY2tcIjogZGF0YUNoZWNrKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLXJvd251bVwiOiBkYXRhUm93bnVtKCk7IGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBjb21wb25lbnQgPSBlbGVtZW50LmNsb3Nlc3QoXCIudGFibGUtY29tcG9uZW50XCIpO1xuICAgICAgICAgICAgdmFyIHNlYXJjaF9pbnB1dCA9IGNvbXBvbmVudC5maW5kKFwiaW5wdXRcIik7XG4gICAgICAgICAgICB2YXIgcm93c19zZWxlY3QgPSBjb21wb25lbnQuZmluZChcInNlbGVjdFwiKTtcblxuICAgICAgICAgICAgc2VhcmNoX2lucHV0LmRhdGEoXCJpbnB1dFwiKS5kZXN0cm95KCk7XG4gICAgICAgICAgICByb3dzX3NlbGVjdC5kYXRhKFwic2VsZWN0XCIpLmRlc3Ryb3koKTtcblxuICAgICAgICAgICAgJCh3aW5kb3cpLm9mZihNZXRyby5ldmVudHMucmVzaXplLCB7bnM6IHRoaXMuaWR9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5zb3J0YWJsZS1jb2x1bW5cIik7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIudGFibGUtc2VydmljZS1jaGVjayBpbnB1dFwiKTtcblxuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi50YWJsZS1zZXJ2aWNlLWNoZWNrLWFsbCBpbnB1dFwiKTtcblxuICAgICAgICAgICAgc2VhcmNoX2lucHV0Lm9mZihNZXRyby5ldmVudHMuaW5wdXRjaGFuZ2UpO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZSh0aGlzLndyYXBwZXJTZWFyY2gpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGN1c3RvbVNlYXJjaCA9IHRoaXMud3JhcHBlclNlYXJjaC5maW5kKFwiaW5wdXRcIik7XG4gICAgICAgICAgICAgICAgaWYgKGN1c3RvbVNlYXJjaC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbVNlYXJjaC5vZmYoTWV0cm8uZXZlbnRzLmlucHV0Y2hhbmdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbXBvbmVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5wYWdpbmF0aW9uIC5wYWdlLWxpbmtcIik7XG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZSh0aGlzLndyYXBwZXJQYWdpbmF0aW9uKSkge1xuICAgICAgICAgICAgICAgIHRoaXMud3JhcHBlclBhZ2luYXRpb24ub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIucGFnaW5hdGlvbiAucGFnZS1saW5rXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5qcy10YWJsZS1jcnVkLWJ1dHRvblwiKTtcblxuICAgICAgICAgICAgdGhpcy5fcmVtb3ZlSW5zcGVjdG9yRXZlbnRzKCk7XG5cbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgTWF0ZXJpYWxUYWJzRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgd2hlZWxTdGVwOiAyMCxcbiAgICAgICAgbWF0ZXJpYWx0YWJzRGVmZXJyZWQ6IDAsXG4gICAgICAgIGRlZXA6IGZhbHNlLFxuICAgICAgICBmaXhlZFRhYnM6IGZhbHNlLFxuICAgICAgICBkdXJhdGlvbjogMzAwLFxuICAgICAgICBhcHBCYXI6IGZhbHNlLFxuXG4gICAgICAgIGNsc0NvbXBvbmVudDogXCJcIixcbiAgICAgICAgY2xzVGFiczogXCJcIixcbiAgICAgICAgY2xzVGFiOiBcIlwiLFxuICAgICAgICBjbHNUYWJBY3RpdmU6IFwiXCIsXG4gICAgICAgIGNsc01hcmtlcjogXCJcIixcblxuICAgICAgICBvbkJlZm9yZVRhYk9wZW46IE1ldHJvLm5vb3BfdHJ1ZSxcbiAgICAgICAgb25UYWJPcGVuOiBNZXRyby5ub29wLFxuICAgICAgICBvblRhYnNTY3JvbGw6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uVGFic0NyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby5tYXRlcmlhbFRhYnNTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIE1hdGVyaWFsVGFic0RlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgTWF0ZXJpYWxUYWJzRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9NYXRlcmlhbFRhYnNTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLm1hdGVyaWFsVGFic1NldHVwKHdpbmRvd1tcIm1ldHJvTWF0ZXJpYWxUYWJzU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnbWF0ZXJpYWwtdGFicycsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBNYXRlcmlhbFRhYnNEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgbWFya2VyOiBudWxsLFxuICAgICAgICAgICAgICAgIHNjcm9sbDogMCxcbiAgICAgICAgICAgICAgICBzY3JvbGxEaXI6IFwibGVmdFwiXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJ0YWJzLWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVN0cnVjdHVyZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHRhYnMgPSBlbGVtZW50LmZpbmQoXCJsaVwiKSwgYWN0aXZlX3RhYiA9IGVsZW1lbnQuZmluZChcImxpLmFjdGl2ZVwiKTtcbiAgICAgICAgICAgIHZhciB3cmFwcGVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwidGFicy1tYXRlcmlhbC13cmFwcGVyXCIpLmFkZENsYXNzKG8uY2xzQ29tcG9uZW50KS5pbnNlcnRCZWZvcmUoZWxlbWVudCk7XG5cbiAgICAgICAgICAgIGlmIChvLmFwcEJhciA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHdyYXBwZXIuYWRkQ2xhc3MoXCJhcHAtYmFyLXByZXNlbnRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoby5hcHBCYXIgPT09IFwibW9yZVwiKSB7XG4gICAgICAgICAgICAgICAgd3JhcHBlci5hZGRDbGFzcyhcImFwcC1iYXItcHJlc2VudC1tb3JlXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LmFwcGVuZFRvKHdyYXBwZXIpO1xuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcInRhYnMtbWF0ZXJpYWxcIikuYWRkQ2xhc3Moby5jbHNUYWJzKTtcbiAgICAgICAgICAgIHRhYnMuYWRkQ2xhc3Moby5jbHNUYWIpO1xuXG4gICAgICAgICAgICBpZiAoby5kZWVwID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImRlZXBcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmZpeGVkVGFicyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJmaXhlZC10YWJzXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLm1hcmtlciA9IGVsZW1lbnQuZmluZChcIi50YWItbWFya2VyXCIpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5tYXJrZXIubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tYXJrZXIgPSAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwidGFiLW1hcmtlclwiKS5hZGRDbGFzcyhvLmNsc01hcmtlcikuYXBwZW5kVG8oZWxlbWVudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMub3BlblRhYihhY3RpdmVfdGFiLmxlbmd0aCA9PT0gMCA/IHRhYnNbMF0gOiBhY3RpdmVfdGFiWzBdKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCJsaVwiLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICB2YXIgdGFiID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgYWN0aXZlX3RhYiA9IGVsZW1lbnQuZmluZChcImxpLmFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICB2YXIgdGFiX25leHQgPSB0YWIuaW5kZXgoKSA+IGFjdGl2ZV90YWIuaW5kZXgoKTtcbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gdGFiLmNoaWxkcmVuKFwiYVwiKS5hdHRyKFwiaHJlZlwiKTtcblxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKHRhcmdldCkgJiYgdGFyZ2V0WzBdID09PSBcIiNcIikge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFiLmhhc0NsYXNzKFwiYWN0aXZlXCIpKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YWIuaGFzQ2xhc3MoXCJkaXNhYmxlZFwiKSkgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICBpZiAoVXRpbHMuZXhlYyhvLm9uQmVmb3JlVGFiT3BlbiwgW3RhYiwgdGFyZ2V0LCB0YWJfbmV4dF0sIHRoaXMpID09PSBmYWxzZSkgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lm9wZW5UYWIodGFiLCB0YWJfbmV4dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLnNjcm9sbCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgb2xkU2Nyb2xsID0gdGhhdC5zY3JvbGw7XG5cbiAgICAgICAgICAgICAgICB0aGF0LnNjcm9sbERpciA9IHRoYXQuc2Nyb2xsIDwgZWxlbWVudFswXS5zY3JvbGxMZWZ0ID8gXCJsZWZ0XCIgOiBcInJpZ2h0XCI7XG4gICAgICAgICAgICAgICAgdGhhdC5zY3JvbGwgPSBlbGVtZW50WzBdLnNjcm9sbExlZnQ7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJ0YWJzLXNjcm9sbFwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHNjcm9sbExlZnQ6IGVsZW1lbnRbMF0uc2Nyb2xsTGVmdCxcbiAgICAgICAgICAgICAgICAgICAgb2xkU2Nyb2xsOiBvbGRTY3JvbGwsXG4gICAgICAgICAgICAgICAgICAgIHNjcm9sbERpcjogdGhhdC5zY3JvbGxEaXJcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLm1vdXNld2hlZWwsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGlmIChlLmRlbHRhWSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHNjcm9sbCwgc2Nyb2xsYWJsZSA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgdmFyIGRpciA9IGUuZGVsdGFZID4gMCA/IC0xIDogMTtcbiAgICAgICAgICAgICAgICB2YXIgc3RlcCA9IG8ud2hlZWxTdGVwO1xuXG5cbiAgICAgICAgICAgICAgICBzY3JvbGwgPSBzY3JvbGxhYmxlLnNjcm9sbExlZnQoKSAtICggZGlyICogc3RlcCk7XG4gICAgICAgICAgICAgICAgc2Nyb2xsYWJsZS5zY3JvbGxMZWZ0KHNjcm9sbCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuXG4gICAgICAgIG9wZW5UYWI6IGZ1bmN0aW9uKHRhYiwgdGFiX25leHQpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgdGFicyA9IGVsZW1lbnQuZmluZChcImxpXCIpO1xuICAgICAgICAgICAgdmFyIG1hZ2ljID0gNTIsIHNoaWZ0LCB3aWR0aCwgdGFiX3dpZHRoLCB0YXJnZXQsIHRhYl9sZWZ0LCBzY3JvbGwsIHNjcm9sbExlZnQ7XG5cbiAgICAgICAgICAgIHRhYiA9ICQodGFiKTtcblxuICAgICAgICAgICAgJC5lYWNoKHRhYnMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQodGhpcykuZmluZChcImFcIikuYXR0cihcImhyZWZcIik7XG4gICAgICAgICAgICAgICAgaWYgKCFVdGlscy5pc1ZhbHVlKHRhcmdldCkpIHJldHVybjtcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0WzBdID09PSBcIiNcIiAmJiB0YXJnZXQubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAkKHRhcmdldCkuaGlkZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB3aWR0aCA9IGVsZW1lbnQud2lkdGgoKTtcbiAgICAgICAgICAgIHNjcm9sbCA9IGVsZW1lbnQuc2Nyb2xsTGVmdCgpO1xuICAgICAgICAgICAgdGFiX2xlZnQgPSB0YWIucG9zaXRpb24oKS5sZWZ0O1xuICAgICAgICAgICAgdGFiX3dpZHRoID0gdGFiLndpZHRoKCk7XG4gICAgICAgICAgICBzaGlmdCA9IHRhYl9sZWZ0ICsgdGFiX3dpZHRoO1xuXG4gICAgICAgICAgICB0YWJzLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpLnJlbW92ZUNsYXNzKG8uY2xzVGFiQWN0aXZlKTtcbiAgICAgICAgICAgIHRhYi5hZGRDbGFzcyhcImFjdGl2ZVwiKS5hZGRDbGFzcyhvLmNsc1RhYkFjdGl2ZSk7XG5cbiAgICAgICAgICAgIGlmIChzaGlmdCArIG1hZ2ljID4gd2lkdGggKyBzY3JvbGwpIHtcbiAgICAgICAgICAgICAgICBzY3JvbGxMZWZ0ID0gc2Nyb2xsICsgKG1hZ2ljICogMik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhYl9sZWZ0IDwgc2Nyb2xsKSB7XG4gICAgICAgICAgICAgICAgc2Nyb2xsTGVmdCA9IHRhYl9sZWZ0IC0gbWFnaWMgKiAyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzY3JvbGxMZWZ0ID0gc2Nyb2xsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIGRyYXc6IHtcbiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsTGVmdDogc2Nyb2xsTGVmdFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZHVyOiBvLmR1cmF0aW9uXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5tYXJrZXIuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICBsZWZ0OiB0YWJfbGVmdCxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRhYl93aWR0aFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZHVyOiBvLmR1cmF0aW9uXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGFyZ2V0ID0gdGFiLmZpbmQoXCJhXCIpLmF0dHIoXCJocmVmXCIpO1xuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUodGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgIGlmICh0YXJnZXRbMF0gPT09IFwiI1wiICYmIHRhcmdldC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICQodGFyZ2V0KS5zaG93KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJ0YWItb3BlblwiLCB7XG4gICAgICAgICAgICAgICAgdGFiOiB0YWJbMF0sXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICAgICAgICAgICAgdGFiX25leHQ6IHRhYl9uZXh0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBvcGVuOiBmdW5jdGlvbih0YWJfbnVtKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIHRhYnMgPSBlbGVtZW50LmZpbmQoXCJsaVwiKTtcbiAgICAgICAgICAgIHZhciBhY3RpdmVfdGFiID0gZWxlbWVudC5maW5kKFwibGkuYWN0aXZlXCIpO1xuICAgICAgICAgICAgdmFyIHRhYiA9IHRhYnMuZXEodGFiX251bSAtIDEpO1xuICAgICAgICAgICAgdmFyIHRhYl9uZXh0ID0gdGFicy5pbmRleCh0YWIpID4gdGFicy5pbmRleChhY3RpdmVfdGFiKTtcbiAgICAgICAgICAgIHRoaXMub3BlblRhYih0YWIsIHRhYl9uZXh0KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwibGlcIik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuc2Nyb2xsKTtcblxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIFRhYnNEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICB0YWJzRGVmZXJyZWQ6IDAsXG4gICAgICAgIGV4cGFuZDogZmFsc2UsXG4gICAgICAgIGV4cGFuZFBvaW50OiBudWxsLFxuICAgICAgICB0YWJzUG9zaXRpb246IFwidG9wXCIsXG4gICAgICAgIHRhYnNUeXBlOiBcImRlZmF1bHRcIixcblxuICAgICAgICBjbHNUYWJzOiBcIlwiLFxuICAgICAgICBjbHNUYWJzTGlzdDogXCJcIixcbiAgICAgICAgY2xzVGFic0xpc3RJdGVtOiBcIlwiLFxuICAgICAgICBjbHNUYWJzTGlzdEl0ZW1BY3RpdmU6IFwiXCIsXG5cbiAgICAgICAgb25UYWI6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQmVmb3JlVGFiOiBNZXRyby5ub29wX3RydWUsXG4gICAgICAgIG9uVGFic0NyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby50YWJzU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBUYWJzRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBUYWJzRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9UYWJzU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby50YWJzU2V0dXAod2luZG93W1wibWV0cm9UYWJzU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgndGFicycsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBUYWJzRGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIF90YXJnZXRzOiBbXSxcbiAgICAgICAgICAgICAgICBpZDogVXRpbHMuZWxlbWVudElkKCd0YWJzJylcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgdGFiID0gZWxlbWVudC5maW5kKFwiLmFjdGl2ZVwiKS5sZW5ndGggPiAwID8gJChlbGVtZW50LmZpbmQoXCIuYWN0aXZlXCIpWzBdKSA6IHVuZGVmaW5lZDtcblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcbiAgICAgICAgICAgIHRoaXMuX29wZW4odGFiKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwidGFicy1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBwYXJlbnQgPSBlbGVtZW50LnBhcmVudCgpO1xuICAgICAgICAgICAgdmFyIHJpZ2h0X3BhcmVudCA9IHBhcmVudC5oYXNDbGFzcyhcInRhYnNcIik7XG4gICAgICAgICAgICB2YXIgY29udGFpbmVyID0gcmlnaHRfcGFyZW50ID8gcGFyZW50IDogJChcIjxkaXY+XCIpLmFkZENsYXNzKFwidGFicyB0YWJzLXdyYXBwZXJcIik7XG4gICAgICAgICAgICB2YXIgZXhwYW5kVGl0bGUsIGhhbWJ1cmdlcjtcblxuICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKG8udGFic1Bvc2l0aW9uLnJlcGxhY2UoW1wiLVwiLCBcIl9cIiwgXCIrXCJdLCBcIiBcIikpO1xuXG4gICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwidGFicy1saXN0XCIpO1xuICAgICAgICAgICAgaWYgKG8udGFic1R5cGUgIT09IFwiZGVmYXVsdFwiKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcInRhYnMtXCIrby50YWJzVHlwZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXJpZ2h0X3BhcmVudCkge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5pbnNlcnRCZWZvcmUoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRUbyhjb250YWluZXIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LmRhdGEoJ2V4cGFuZGVkJywgZmFsc2UpO1xuXG4gICAgICAgICAgICBleHBhbmRUaXRsZSA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImV4cGFuZC10aXRsZVwiKTsgY29udGFpbmVyLnByZXBlbmQoZXhwYW5kVGl0bGUpO1xuICAgICAgICAgICAgaGFtYnVyZ2VyID0gY29udGFpbmVyLmZpbmQoXCIuaGFtYnVyZ2VyXCIpO1xuICAgICAgICAgICAgaWYgKGhhbWJ1cmdlci5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBoYW1idXJnZXIgPSAkKFwiPGJ1dHRvbj5cIikuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIikuYWRkQ2xhc3MoXCJoYW1idXJnZXIgbWVudS1kb3duXCIpLmFwcGVuZFRvKGNvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IDM7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwibGluZVwiKS5hcHBlbmRUbyhoYW1idXJnZXIpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChNZXRyby5jb2xvcnMuaXNMaWdodChVdGlscy5nZXRTdHlsZU9uZShjb250YWluZXIsIFwiYmFja2dyb3VuZC1jb2xvclwiKSkgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFtYnVyZ2VyLmFkZENsYXNzKFwiZGFya1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcyhvLmNsc1RhYnMpO1xuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhvLmNsc1RhYnNMaXN0KTtcbiAgICAgICAgICAgIGVsZW1lbnQuY2hpbGRyZW4oXCJsaVwiKS5hZGRDbGFzcyhvLmNsc1RhYnNMaXN0SXRlbSk7XG5cbiAgICAgICAgICAgIGlmIChvLmV4cGFuZCA9PT0gdHJ1ZSAmJiAhby50YWJzUG9zaXRpb24uaW5jbHVkZXMoXCJ2ZXJ0aWNhbFwiKSkge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcInRhYnMtZXhwYW5kXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLmV4cGFuZFBvaW50KSAmJiBVdGlscy5tZWRpYUV4aXN0KG8uZXhwYW5kUG9pbnQpICYmICFvLnRhYnNQb3NpdGlvbi5pbmNsdWRlcyhcInZlcnRpY2FsXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcInRhYnMtZXhwYW5kXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8udGFic1Bvc2l0aW9uLmluY2x1ZGVzKFwidmVydGljYWxcIikpIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJ0YWJzLWV4cGFuZFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgY29udGFpbmVyID0gZWxlbWVudC5wYXJlbnQoKTtcblxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKE1ldHJvLmV2ZW50cy5yZXNpemUsIGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgICAgICBpZiAoby50YWJzUG9zaXRpb24uaW5jbHVkZXMoXCJ2ZXJ0aWNhbFwiKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChvLmV4cGFuZCA9PT0gdHJ1ZSAmJiAhby50YWJzUG9zaXRpb24uaW5jbHVkZXMoXCJ2ZXJ0aWNhbFwiKSkge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJ0YWJzLWV4cGFuZFwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLmV4cGFuZFBvaW50KSAmJiBVdGlscy5tZWRpYUV4aXN0KG8uZXhwYW5kUG9pbnQpICYmICFvLnRhYnNQb3NpdGlvbi5pbmNsdWRlcyhcInZlcnRpY2FsXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbnRhaW5lci5oYXNDbGFzcyhcInRhYnMtZXhwYW5kXCIpKSBjb250YWluZXIuYWRkQ2xhc3MoXCJ0YWJzLWV4cGFuZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250YWluZXIuaGFzQ2xhc3MoXCJ0YWJzLWV4cGFuZFwiKSkgY29udGFpbmVyLnJlbW92ZUNsYXNzKFwidGFicy1leHBhbmRcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB7bnM6IHRoaXMuaWR9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuaGFtYnVyZ2VyLCAuZXhwYW5kLXRpdGxlXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuZGF0YSgnZXhwYW5kZWQnKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImV4cGFuZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5kYXRhKCdleHBhbmRlZCcsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuZmluZChcIi5oYW1idXJnZXJcIikuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcyhcImV4cGFuZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5kYXRhKCdleHBhbmRlZCcsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoXCIuaGFtYnVyZ2VyXCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCJhXCIsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIHZhciBsaW5rID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgaHJlZiA9IGxpbmsuYXR0cihcImhyZWZcIikudHJpbSgpO1xuICAgICAgICAgICAgICAgIHZhciB0YWIgPSBsaW5rLnBhcmVudChcImxpXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRhYi5oYXNDbGFzcyhcImFjdGl2ZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuZGF0YSgnZXhwYW5kZWQnKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKFwiZXhwYW5kXCIpO1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmRhdGEoJ2V4cGFuZGVkJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuZmluZChcIi5oYW1idXJnZXJcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKFV0aWxzLmV4ZWMoby5vbkJlZm9yZVRhYiwgW3RhYiwgZWxlbWVudF0sIHRhYlswXSkgIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKGhyZWYpICYmIGhyZWZbMF0gPT09IFwiI1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX29wZW4odGFiKTtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jb2xsZWN0VGFyZ2V0czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciB0YWJzID0gZWxlbWVudC5maW5kKFwibGlcIik7XG5cbiAgICAgICAgICAgIHRoaXMuX3RhcmdldHMgPSBbXTtcblxuICAgICAgICAgICAgJC5lYWNoKHRhYnMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQodGhpcykuZmluZChcImFcIikuYXR0cihcImhyZWZcIikudHJpbSgpO1xuICAgICAgICAgICAgICAgIGlmICh0YXJnZXQubGVuZ3RoID4gMSAmJiB0YXJnZXRbMF0gPT09IFwiI1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3RhcmdldHMucHVzaCh0YXJnZXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9vcGVuOiBmdW5jdGlvbih0YWIpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgdGFicyA9IGVsZW1lbnQuZmluZChcImxpXCIpO1xuICAgICAgICAgICAgdmFyIGV4cGFuZFRpdGxlID0gZWxlbWVudC5zaWJsaW5ncyhcIi5leHBhbmQtdGl0bGVcIik7XG5cblxuICAgICAgICAgICAgaWYgKHRhYnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9jb2xsZWN0VGFyZ2V0cygpO1xuXG4gICAgICAgICAgICBpZiAodGFiID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0YWIgPSAkKHRhYnNbMF0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gdGFiLmZpbmQoXCJhXCIpLmF0dHIoXCJocmVmXCIpO1xuXG4gICAgICAgICAgICBpZiAodGFyZ2V0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRhYnMucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIikucmVtb3ZlQ2xhc3Moby5jbHNUYWJzTGlzdEl0ZW1BY3RpdmUpO1xuICAgICAgICAgICAgaWYgKHRhYi5wYXJlbnQoKS5oYXNDbGFzcyhcImQtbWVudVwiKSkge1xuICAgICAgICAgICAgICAgIHRhYi5wYXJlbnQoKS5wYXJlbnQoKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFiLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkLmVhY2godGhpcy5fdGFyZ2V0cywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgdCA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgaWYgKHQubGVuZ3RoID4gMCkgdC5oaWRlKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKHRhcmdldCAhPT0gXCIjXCIgJiYgdGFyZ2V0WzBdID09PSBcIiNcIikge1xuICAgICAgICAgICAgICAgICQodGFyZ2V0KS5zaG93KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGV4cGFuZFRpdGxlLmh0bWwodGFiLmZpbmQoXCJhXCIpLmh0bWwoKSk7XG5cbiAgICAgICAgICAgIHRhYi5hZGRDbGFzcyhvLmNsc1RhYnNMaXN0SXRlbUFjdGl2ZSk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInRhYlwiLCB7XG4gICAgICAgICAgICAgICAgdGFiOiB0YWJbMF1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIG5leHQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBuZXh0LCBhY3RpdmVfdGFiID0gZWxlbWVudC5maW5kKFwibGkuYWN0aXZlXCIpO1xuXG4gICAgICAgICAgICBuZXh0ID0gYWN0aXZlX3RhYi5uZXh0KFwibGlcIik7XG4gICAgICAgICAgICBpZiAobmV4dC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb3BlbihuZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBwcmV2OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgbmV4dCwgYWN0aXZlX3RhYiA9IGVsZW1lbnQuZmluZChcImxpLmFjdGl2ZVwiKTtcblxuICAgICAgICAgICAgbmV4dCA9IGFjdGl2ZV90YWIucHJldihcImxpXCIpO1xuICAgICAgICAgICAgaWYgKG5leHQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX29wZW4obmV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgb3BlbjogZnVuY3Rpb24odGFiKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIHRhYnMgPSBlbGVtZW50LmZpbmQoXCJsaVwiKTtcblxuICAgICAgICAgICAgaWYgKCFVdGlscy5pc1ZhbHVlKHRhYikpIHtcbiAgICAgICAgICAgICAgICB0YWIgPSAxO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNJbnQodGFiKSkge1xuICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKHRhYnNbdGFiLTFdKSkgdGhpcy5fb3BlbigkKHRhYnNbdGFiLTFdKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX29wZW4oJCh0YWIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGVsZW1lbnQucGFyZW50KCk7XG5cbiAgICAgICAgICAgICQod2luZG93KS5vZmYoTWV0cm8uZXZlbnRzLnJlc2l6ZSx7bnM6IHRoaXMuaWR9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyLm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmhhbWJ1cmdlciwgLmV4cGFuZC10aXRsZVwiKTtcblxuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcImFcIik7XG5cbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBUYWdJbnB1dERlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGF1dG9jb21wbGV0ZTogbnVsbCxcbiAgICAgICAgYXV0b2NvbXBsZXRlVW5pcXVlOiB0cnVlLFxuICAgICAgICBhdXRvY29tcGxldGVVcmw6IG51bGwsXG4gICAgICAgIGF1dG9jb21wbGV0ZVVybE1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgYXV0b2NvbXBsZXRlVXJsS2V5OiBudWxsLFxuICAgICAgICBhdXRvY29tcGxldGVEaXZpZGVyOiBcIixcIixcbiAgICAgICAgYXV0b2NvbXBsZXRlTGlzdEhlaWdodDogMjAwLFxuXG4gICAgICAgIGxhYmVsOiBcIlwiLFxuICAgICAgICBzaXplOiBcIm5vcm1hbFwiLFxuICAgICAgICB0YWdpbnB1dERlZmVycmVkOiAwLFxuICAgICAgICBzdGF0aWM6IGZhbHNlLFxuICAgICAgICBjbGVhckJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgY2xlYXJCdXR0b25JY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tY3Jvc3MnPjwvc3Bhbj5cIixcblxuICAgICAgICByYW5kb21Db2xvcjogZmFsc2UsXG4gICAgICAgIG1heFRhZ3M6IDAsXG4gICAgICAgIHRhZ1NlcGFyYXRvcjogXCIsXCIsXG4gICAgICAgIHRhZ1RyaWdnZXI6IFwiRW50ZXIsIFNwYWNlLCBDb21tYVwiLFxuICAgICAgICBiYWNrc3BhY2U6IHRydWUsXG5cbiAgICAgICAgY2xzQ29tcG9uZW50OiBcIlwiLFxuICAgICAgICBjbHNJbnB1dDogXCJcIixcbiAgICAgICAgY2xzQ2xlYXJCdXR0b246IFwiXCIsXG4gICAgICAgIGNsc1RhZzogXCJcIixcbiAgICAgICAgY2xzVGFnVGl0bGU6IFwiXCIsXG4gICAgICAgIGNsc1RhZ1JlbW92ZXI6IFwiXCIsXG4gICAgICAgIGNsc0xhYmVsOiBcIlwiLFxuXG4gICAgICAgIG9uQmVmb3JlVGFnQWRkOiBNZXRyby5ub29wX3RydWUsXG4gICAgICAgIG9uVGFnQWRkOiBNZXRyby5ub29wLFxuICAgICAgICBvbkJlZm9yZVRhZ1JlbW92ZTogTWV0cm8ubm9vcF90cnVlLFxuICAgICAgICBvblRhZ1JlbW92ZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25UYWc6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQ2xlYXI6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uVGFnVHJpZ2dlcjogTWV0cm8ubm9vcCxcbiAgICAgICAgb25UYWdJbnB1dENyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby50YWdJbnB1dFNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgVGFnSW5wdXREZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIFRhZ0lucHV0RGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9UYWdJbnB1dFNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8udGFnSW5wdXRTZXR1cCh3aW5kb3dbXCJtZXRyb1RhZ0lucHV0U2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgndGFnLWlucHV0Jywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIFRhZ0lucHV0RGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIHZhbHVlczogW10sXG4gICAgICAgICAgICAgICAgdHJpZ2dlcnM6IFtdLFxuICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZTogW11cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy50cmlnZ2VycyA9IChcIlwiK3RoaXMub3B0aW9ucy50YWdUcmlnZ2VyKS50b0FycmF5KFwiLFwiKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMudHJpZ2dlcnMuaW5jbHVkZXMoXCJTcGFjZVwiKSB8fCB0aGlzLnRyaWdnZXJzLmluY2x1ZGVzKFwiU3BhY2ViYXJcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJzLnB1c2goXCIgXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcnMucHVzaChcIlNwYWNlYmFyXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy50cmlnZ2Vycy5pbmNsdWRlcyhcIkNvbW1hXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2Vycy5wdXNoKFwiLFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwidGFnLWlucHV0LWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogdGhpcy5lbGVtZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlU3RydWN0dXJlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciwgaW5wdXQsIGNsZWFyQnV0dG9uO1xuICAgICAgICAgICAgdmFyIHZhbHVlcyA9IGVsZW1lbnQudmFsKCkudHJpbSgpO1xuXG4gICAgICAgICAgICBjb250YWluZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJ0YWctaW5wdXQgXCIgICsgZWxlbWVudFswXS5jbGFzc05hbWUpLmFkZENsYXNzKG8uY2xzQ29tcG9uZW50KS5pbnNlcnRCZWZvcmUoZWxlbWVudCk7XG4gICAgICAgICAgICBlbGVtZW50LmFwcGVuZFRvKGNvbnRhaW5lcik7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcImlucHV0LVwiICsgby5zaXplKVxuXG4gICAgICAgICAgICBlbGVtZW50WzBdLmNsYXNzTmFtZSA9IFwiXCI7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJvcmlnaW5hbC1pbnB1dFwiKTtcbiAgICAgICAgICAgIGlucHV0ID0gJChcIjxpbnB1dCB0eXBlPSd0ZXh0Jz5cIikuYWRkQ2xhc3MoXCJpbnB1dC13cmFwcGVyXCIpLmFkZENsYXNzKG8uY2xzSW5wdXQpLmF0dHIoXCJzaXplXCIsIDEpO1xuICAgICAgICAgICAgaW5wdXQuYXBwZW5kVG8oY29udGFpbmVyKTtcblxuICAgICAgICAgICAgaWYgKG8uY2xlYXJCdXR0b24gIT09IGZhbHNlICYmICFlbGVtZW50WzBdLnJlYWRPbmx5KSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwicGFkZGluZy1mb3ItY2xlYXJcIik7XG4gICAgICAgICAgICAgICAgY2xlYXJCdXR0b24gPSAkKFwiPGJ1dHRvbj5cIikuYWRkQ2xhc3MoXCJidXR0b24gaW5wdXQtY2xlYXItYnV0dG9uXCIpLmF0dHIoXCJ0YWJpbmRleFwiLCAtMSkuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIikuaHRtbChvLmNsZWFyQnV0dG9uSWNvbik7XG4gICAgICAgICAgICAgICAgY2xlYXJCdXR0b24uYXBwZW5kVG8oY29udGFpbmVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUodmFsdWVzKSkge1xuICAgICAgICAgICAgICAgICQuZWFjaCh2YWx1ZXMudG9BcnJheShvLnRhZ1NlcGFyYXRvciksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2FkZFRhZyh0aGlzKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5sYWJlbCkge1xuICAgICAgICAgICAgICAgIHZhciBsYWJlbCA9ICQoXCI8bGFiZWw+XCIpLmFkZENsYXNzKFwibGFiZWwtZm9yLWlucHV0XCIpLmFkZENsYXNzKG8uY2xzTGFiZWwpLmh0bWwoby5sYWJlbCkuaW5zZXJ0QmVmb3JlKGNvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuYXR0cihcImlkXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsLmF0dHIoXCJmb3JcIiwgZWxlbWVudC5hdHRyKFwiaWRcIikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5hdHRyKFwiZGlyXCIpID09PSBcInJ0bFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsLmFkZENsYXNzKFwicnRsXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuaXMoXCI6ZGlzYWJsZWRcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmFibGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uc3RhdGljID09PSB0cnVlIHx8IGVsZW1lbnQuYXR0cihcInJlYWRvbmx5XCIpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJzdGF0aWMtbW9kZVwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFVdGlscy5pc051bGwoby5hdXRvY29tcGxldGUpIHx8ICFVdGlscy5pc051bGwoby5hdXRvY29tcGxldGVVcmwpKSB7XG4gICAgICAgICAgICAgICAgJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiYXV0b2NvbXBsZXRlLWxpc3RcIikuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgbWF4SGVpZ2h0OiBvLmF1dG9jb21wbGV0ZUxpc3RIZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IFwibm9uZVwiXG4gICAgICAgICAgICAgICAgfSkuYXBwZW5kVG8oY29udGFpbmVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5hdXRvY29tcGxldGUpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGF1dG9jb21wbGV0ZV9vYmogPSBVdGlscy5pc09iamVjdChvLmF1dG9jb21wbGV0ZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoYXV0b2NvbXBsZXRlX29iaiAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRvY29tcGxldGUgPSBhdXRvY29tcGxldGVfb2JqO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXV0b2NvbXBsZXRlID0gby5hdXRvY29tcGxldGUudG9BcnJheShvLmF1dG9jb21wbGV0ZURpdmlkZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoby5hdXRvY29tcGxldGVVcmwpKSB7XG4gICAgICAgICAgICAgICAgZmV0Y2goby5hdXRvY29tcGxldGVVcmwsIHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBvLmF1dG9jb21wbGV0ZVVybE1ldGhvZFxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UudGV4dCgpXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0RhdGEgPSBbXTtcblxuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3RGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoby5hdXRvY29tcGxldGVVcmxLZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdEYXRhID0gbmV3RGF0YVtvLmF1dG9jb21wbGV0ZVVybEtleV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0RhdGEgPSBkYXRhLnNwbGl0KFwiXFxuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5hdXRvY29tcGxldGUgPSB0aGF0LmF1dG9jb21wbGV0ZS5jb25jYXQobmV3RGF0YSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBlbGVtZW50LmNsb3Nlc3QoXCIudGFnLWlucHV0XCIpO1xuICAgICAgICAgICAgdmFyIGlucHV0ID0gY29udGFpbmVyLmZpbmQoXCIuaW5wdXQtd3JhcHBlclwiKTtcbiAgICAgICAgICAgIHZhciBhdXRvY29tcGxldGVMaXN0ID0gY29udGFpbmVyLmZpbmQoXCIuYXV0b2NvbXBsZXRlLWxpc3RcIik7XG5cbiAgICAgICAgICAgIGlucHV0Lm9uKE1ldHJvLmV2ZW50cy5mb2N1cywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJmb2N1c2VkXCIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlucHV0Lm9uKE1ldHJvLmV2ZW50cy5ibHVyLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5yZW1vdmVDbGFzcyhcImZvY3VzZWRcIik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaW5wdXQub24oTWV0cm8uZXZlbnRzLmlucHV0Y2hhbmdlLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlucHV0LmF0dHIoXCJzaXplXCIsIE1hdGguY2VpbChpbnB1dC52YWwoKS5sZW5ndGggLyAyKSArIDIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlucHV0Lm9uKE1ldHJvLmV2ZW50cy5rZXlkb3duLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICB2YXIgdmFsID0gaW5wdXQudmFsKCkudHJpbSgpO1xuICAgICAgICAgICAgICAgIHZhciBrZXkgPSBlLmtleTtcblxuICAgICAgICAgICAgICAgIGlmIChrZXkgPT09IFwiRW50ZXJcIikgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKG8uYmFja3NwYWNlID09PSB0cnVlICYmIGtleSA9PT0gXCJCYWNrc3BhY2VcIiAmJiB2YWwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LnZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LnZhbHVlcy5zcGxpY2UoLTEsMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnNpYmxpbmdzKFwiLnRhZ1wiKS5sYXN0KCkucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnZhbCh0aGF0LnZhbHVlcy5qb2luKG8udGFnU2VwYXJhdG9yKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodmFsID09PSBcIlwiKSB7cmV0dXJuIDt9XG5cbiAgICAgICAgICAgICAgICBpZiAoIXRoYXQudHJpZ2dlcnMuaW5jbHVkZXMoa2V5KSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInRhZy10cmlnZ2VyXCIsIHtcbiAgICAgICAgICAgICAgICAgICAga2V5OiBrZXlcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlucHV0LnZhbChcIlwiKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9hZGRUYWcodmFsKTtcbiAgICAgICAgICAgICAgICBpbnB1dC5hdHRyKFwic2l6ZVwiLCAxKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpbnB1dC5vbihNZXRyby5ldmVudHMua2V5dXAsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIHZhciB2YWwgPSBpbnB1dC52YWwoKTtcbiAgICAgICAgICAgICAgICB2YXIga2V5ID0gZS5rZXk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhhdC50cmlnZ2Vycy5pbmNsdWRlcyhrZXkpICYmIHZhbFt2YWwubGVuZ3RoIC0gMV0gPT09IGtleSkge1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWwodmFsLnNsaWNlKDAsIC0xKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLnRhZyAucmVtb3ZlclwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciB0YWcgPSAkKHRoaXMpLmNsb3Nlc3QoXCIudGFnXCIpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2RlbFRhZyh0YWcpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5vbihNZXRyby5ldmVudHMuY2xpY2ssIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaW5wdXQuZm9jdXMoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXIub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5pbnB1dC1jbGVhci1idXR0b25cIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgdmFsID0gZWxlbWVudC52YWwoKTtcbiAgICAgICAgICAgICAgICB0aGF0LmNsZWFyKCk7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJjbGVhclwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHZhbDogdmFsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaW5wdXQub24oTWV0cm8uZXZlbnRzLmlucHV0LCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciB2YWwgPSB0aGlzLnZhbHVlLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgdGhhdC5fZHJhd0F1dG9jb21wbGV0ZUxpc3QodmFsKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXIub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5hdXRvY29tcGxldGUtbGlzdCAuaXRlbVwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciB2YWwgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWF1dG9jb21wbGV0ZS12YWx1ZVwiKTtcblxuICAgICAgICAgICAgICAgIGlucHV0LnZhbChcIlwiKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9hZGRUYWcodmFsKTtcbiAgICAgICAgICAgICAgICBpbnB1dC5hdHRyKFwic2l6ZVwiLCAxKTtcblxuICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZUxpc3QuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogXCJub25lXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJhdXRvY29tcGxldGUtc2VsZWN0XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2RyYXdBdXRvY29tcGxldGVMaXN0OiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGVsZW1lbnQuY2xvc2VzdChcIi50YWctaW5wdXRcIik7XG4gICAgICAgICAgICB2YXIgaW5wdXQgPSBjb250YWluZXIuZmluZChcIi5pbnB1dC13cmFwcGVyXCIpO1xuICAgICAgICAgICAgdmFyIGF1dG9jb21wbGV0ZUxpc3QgPSBjb250YWluZXIuZmluZChcIi5hdXRvY29tcGxldGUtbGlzdFwiKTtcbiAgICAgICAgICAgIHZhciBpdGVtcztcblxuICAgICAgICAgICAgaWYgKGF1dG9jb21wbGV0ZUxpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhdXRvY29tcGxldGVMaXN0Lmh0bWwoXCJcIik7XG5cbiAgICAgICAgICAgIGl0ZW1zID0gdGhpcy5hdXRvY29tcGxldGUuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih2YWwpID4gLTE7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYXV0b2NvbXBsZXRlTGlzdC5jc3Moe1xuICAgICAgICAgICAgICAgIGRpc3BsYXk6IGl0ZW1zLmxlbmd0aCA+IDAgPyBcImJsb2NrXCIgOiBcIm5vbmVcIixcbiAgICAgICAgICAgICAgICBsZWZ0OiBpbnB1dC5wb3NpdGlvbigpLmxlZnRcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkLmVhY2goaXRlbXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKG8uYXV0b2NvbXBsZXRlVW5pcXVlICYmIHRoYXQudmFsdWVzLmluZGV4T2YodGhpcykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IHYudG9Mb3dlckNhc2UoKS5pbmRleE9mKHZhbCksIGNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJpdGVtXCIpLmF0dHIoXCJkYXRhLWF1dG9jb21wbGV0ZS12YWx1ZVwiLCB2KTtcblxuICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gXCI8c3Ryb25nPlwiK3Yuc3Vic3RyKDAsIHZhbC5sZW5ndGgpK1wiPC9zdHJvbmc+XCIrdi5zdWJzdHIodmFsLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IHYuc3Vic3RyKDAsIGluZGV4KSArIFwiPHN0cm9uZz5cIit2LnN1YnN0cihpbmRleCwgdmFsLmxlbmd0aCkrXCI8L3N0cm9uZz5cIit2LnN1YnN0cihpbmRleCArIHZhbC5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGl0ZW0uaHRtbChjb250ZW50KS5hcHBlbmRUbyhhdXRvY29tcGxldGVMaXN0KTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImRyYXctYXV0b2NvbXBsZXRlLWl0ZW1cIiwge1xuICAgICAgICAgICAgICAgICAgICBpdGVtOiBpdGVtXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9hZGRUYWc6IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBlbGVtZW50LmNsb3Nlc3QoXCIudGFnLWlucHV0XCIpO1xuICAgICAgICAgICAgdmFyIGlucHV0ID0gY29udGFpbmVyLmZpbmQoXCIuaW5wdXQtd3JhcHBlclwiKTtcbiAgICAgICAgICAgIHZhciB0YWcsIHRpdGxlLCByZW1vdmVyO1xuICAgICAgICAgICAgdmFyIHRhZ1NpemUsIHRhZ1N0YXRpYztcblxuICAgICAgICAgICAgaWYgKGNvbnRhaW5lci5oYXNDbGFzcyhcImlucHV0LWxhcmdlXCIpKSB7XG4gICAgICAgICAgICAgICAgdGFnU2l6ZSA9IFwibGFyZ2VcIjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGFpbmVyLmhhc0NsYXNzKFwiaW5wdXQtc21hbGxcIikpIHtcbiAgICAgICAgICAgICAgICB0YWdTaXplID0gXCJzbWFsbFwiXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLm1heFRhZ3MgPiAwICYmIHRoaXMudmFsdWVzLmxlbmd0aCA9PT0gby5tYXhUYWdzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKChcIlwiK3ZhbCkudHJpbSgpID09PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFVdGlscy5leGVjKG8ub25CZWZvcmVUYWdBZGQsIFt2YWwsIHRoaXMudmFsdWVzXSwgZWxlbWVudFswXSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIHRhZyA9ICQoXCI8c3Bhbj5cIilcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJ0YWdcIilcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3ModGFnU2l6ZSlcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3Moby5jbHNUYWcpXG4gICAgICAgICAgICAgICAgLmluc2VydEJlZm9yZShpbnB1dCk7XG4gICAgICAgICAgICB0YWcuZGF0YShcInZhbHVlXCIsIHZhbCk7XG5cbiAgICAgICAgICAgIHRhZ1N0YXRpYyA9IG8uc3RhdGljIHx8IGNvbnRhaW5lci5oYXNDbGFzcyhcInN0YXRpYy1tb2RlXCIpIHx8IGVsZW1lbnQucmVhZG9ubHkgfHwgZWxlbWVudC5kaXNhYmxlZCB8fCBjb250YWluZXIuaGFzQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIGlmICh0YWdTdGF0aWMpIHtcbiAgICAgICAgICAgICAgICB0YWcuYWRkQ2xhc3MoXCJzdGF0aWNcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRpdGxlID0gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcInRpdGxlXCIpLmFkZENsYXNzKG8uY2xzVGFnVGl0bGUpLmh0bWwodmFsKTtcbiAgICAgICAgICAgIHJlbW92ZXIgPSAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwicmVtb3ZlclwiKS5hZGRDbGFzcyhvLmNsc1RhZ1JlbW92ZXIpLmh0bWwoXCImdGltZXM7XCIpO1xuXG4gICAgICAgICAgICB0aXRsZS5hcHBlbmRUbyh0YWcpO1xuICAgICAgICAgICAgcmVtb3Zlci5hcHBlbmRUbyh0YWcpO1xuXG4gICAgICAgICAgICBpZiAoby5yYW5kb21Db2xvciA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHZhciBjb2xvcnMgPSBNZXRyby5jb2xvcnMuY29sb3JzKE1ldHJvLmNvbG9ycy5QQUxFVFRFUy5BTEwpLCBiZywgZmcsIGJnX3I7XG5cbiAgICAgICAgICAgICAgICBiZyA9IGNvbG9yc1skLnJhbmRvbSgwLCBjb2xvcnMubGVuZ3RoIC0gMSldO1xuICAgICAgICAgICAgICAgIGJnX3IgPSBNZXRyby5jb2xvcnMuZGFya2VuKGJnLCAxNSk7XG4gICAgICAgICAgICAgICAgZmcgPSBNZXRyby5jb2xvcnMuaXNEYXJrKGJnKSA/IFwiI2ZmZmZmZlwiIDogXCIjMDAwMDAwXCI7XG5cbiAgICAgICAgICAgICAgICB0YWcuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBiZyxcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IGZnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmVtb3Zlci5jc3Moe1xuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGJnX3IsXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiBmZ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnZhbHVlcy5wdXNoKHZhbCk7XG4gICAgICAgICAgICBlbGVtZW50LnZhbCh0aGlzLnZhbHVlcy5qb2luKG8udGFnU2VwYXJhdG9yKSk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInRhZy1hZGRcIiwge1xuICAgICAgICAgICAgICAgIHRhZzogdGFnWzBdLFxuICAgICAgICAgICAgICAgIHZhbDogdmFsLFxuICAgICAgICAgICAgICAgIHZhbHVlczogdGhpcy52YWx1ZXNcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJ0YWdcIiwge1xuICAgICAgICAgICAgICAgIHRhZzogdGFnWzBdLFxuICAgICAgICAgICAgICAgIHZhbDogdmFsLFxuICAgICAgICAgICAgICAgIHZhbHVlczogdGhpcy52YWx1ZXNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9kZWxUYWc6IGZ1bmN0aW9uKHRhZykge1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgdmFsID0gdGFnLmRhdGEoXCJ2YWx1ZVwiKTtcblxuICAgICAgICAgICAgaWYgKCFVdGlscy5leGVjKG8ub25CZWZvcmVUYWdSZW1vdmUsIFt0YWcsIHZhbCwgdGhpcy52YWx1ZXNdLCBlbGVtZW50WzBdKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIFV0aWxzLmFycmF5RGVsZXRlKHRoaXMudmFsdWVzLCB2YWwpO1xuICAgICAgICAgICAgZWxlbWVudC52YWwodGhpcy52YWx1ZXMuam9pbihvLnRhZ1NlcGFyYXRvcikpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJ0YWctcmVtb3ZlXCIsIHtcbiAgICAgICAgICAgICAgICB0YWc6IHRhZ1swXSxcbiAgICAgICAgICAgICAgICB2YWw6IHZhbCxcbiAgICAgICAgICAgICAgICB2YWx1ZXM6IHRoaXMudmFsdWVzXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwidGFnXCIsIHtcbiAgICAgICAgICAgICAgICB0YWc6IHRhZ1swXSxcbiAgICAgICAgICAgICAgICB2YWw6IHZhbCxcbiAgICAgICAgICAgICAgICB2YWx1ZXM6IHRoaXMudmFsdWVzXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGFnLnJlbW92ZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRhZ3M6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdmFsOiBmdW5jdGlvbih2KXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBlbGVtZW50LmNsb3Nlc3QoXCIudGFnLWlucHV0XCIpO1xuICAgICAgICAgICAgdmFyIG5ld1ZhbHVlcyA9IFtdO1xuXG4gICAgICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUodikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50YWdzKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMudmFsdWVzID0gW107XG4gICAgICAgICAgICBjb250YWluZXIuZmluZChcIi50YWdcIikucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgdiA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIG5ld1ZhbHVlcyA9IChcIlwiK3YpLnRvQXJyYXkoby50YWdTZXBhcmF0b3IpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2KSkge1xuICAgICAgICAgICAgICAgICAgICBuZXdWYWx1ZXMgPSB2O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJC5lYWNoKG5ld1ZhbHVlcywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0Ll9hZGRUYWcodGhpcyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYXBwZW5kOiBmdW5jdGlvbih2KXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBuZXdWYWx1ZXMgPSB0aGlzLnZhbHVlcztcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiB2ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgbmV3VmFsdWVzID0gKFwiXCIrdikudG9BcnJheShvLnRhZ1NlcGFyYXRvcik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHYpKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlcyA9IHY7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkLmVhY2gobmV3VmFsdWVzLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuX2FkZFRhZyh0aGlzKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBjbGVhcjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGVsZW1lbnQuY2xvc2VzdChcIi50YWctaW5wdXRcIik7XG5cbiAgICAgICAgICAgIHRoaXMudmFsdWVzID0gW107XG5cbiAgICAgICAgICAgIGVsZW1lbnQudmFsKFwiXCIpLnRyaWdnZXIoXCJjaGFuZ2VcIik7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKFwiLnRhZ1wiKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50KCkuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRpc2FibGVkXCIsIGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnQoKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZVN0YXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbS5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZVN0YXRpYzogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSB0aGlzLmVsZW1lbnQuY2xvc2VzdChcIi50YWctaW5wdXRcIik7XG4gICAgICAgICAgICB2YXIgc3RhdGljTW9kZTtcblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUodmFsKSkge1xuICAgICAgICAgICAgICAgIHN0YXRpY01vZGUgPSBVdGlscy5ib29sKHZhbCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHN0YXRpY01vZGUgPSAhY29udGFpbmVyLmhhc0NsYXNzKFwic3RhdGljLW1vZGVcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzdGF0aWNNb2RlKSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwic3RhdGljLW1vZGVcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5yZW1vdmVDbGFzcyhcInN0YXRpYy1tb2RlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldEF1dG9jb21wbGV0ZUxpc3Q6IGZ1bmN0aW9uKGwpe1xuICAgICAgICAgICAgdmFyIGF1dG9jb21wbGV0ZV9saXN0ID0gVXRpbHMuaXNPYmplY3QobCk7XG4gICAgICAgICAgICBpZiAoYXV0b2NvbXBsZXRlX2xpc3QgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hdXRvY29tcGxldGUgPSBhdXRvY29tcGxldGVfbGlzdDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGwgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmF1dG9jb21wbGV0ZSA9IGwudG9BcnJheSh0aGlzLm9wdGlvbnMuYXV0b2NvbXBsZXRlRGl2aWRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdmFyIGNoYW5nZVZhbHVlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgdmFsID0gZWxlbWVudC5hdHRyKFwidmFsdWVcIikudHJpbSgpO1xuICAgICAgICAgICAgICAgIHRoYXQuY2xlYXIoKTtcbiAgICAgICAgICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUodmFsKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGF0LnZhbCh2YWwudG9BcnJheShvLnRhZ1NlcGFyYXRvcikpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc3dpdGNoIChhdHRyaWJ1dGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcInZhbHVlXCI6IGNoYW5nZVZhbHVlKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkaXNhYmxlZFwiOiB0aGlzLnRvZ2dsZVN0YXRlKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzdGF0aWNcIjogdGhpcy50b2dnbGVTdGF0aWMoKTsgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGVsZW1lbnQuY2xvc2VzdChcIi50YWctaW5wdXRcIik7XG4gICAgICAgICAgICB2YXIgaW5wdXQgPSBjb250YWluZXIuZmluZChcIi5pbnB1dC13cmFwcGVyXCIpO1xuXG4gICAgICAgICAgICBpbnB1dC5vZmYoTWV0cm8uZXZlbnRzLmZvY3VzKTtcbiAgICAgICAgICAgIGlucHV0Lm9mZihNZXRyby5ldmVudHMuYmx1cik7XG4gICAgICAgICAgICBpbnB1dC5vZmYoTWV0cm8uZXZlbnRzLmtleWRvd24pO1xuICAgICAgICAgICAgY29udGFpbmVyLm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLnRhZyAucmVtb3ZlclwiKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrKTtcblxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgICQoZG9jdW1lbnQpLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgZnVuY3Rpb24oKXtcbiAgICAgICAgJCgnLnRhZy1pbnB1dCAuYXV0b2NvbXBsZXRlLWxpc3QnKS5oaWRlKCk7XG4gICAgfSk7XG5cbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG5cbiAgICB2YXIgRW5naW5lID0gZnVuY3Rpb24oaHRtbCwgb3B0aW9ucywgY29uZikge1xuICAgICAgICB2YXIgUmVFeCwgcmUgPSAnPCUoLis/KSU+JyxcbiAgICAgICAgICAgIHJlRXhwID0gLyheKCApPyh2YXJ8aWZ8Zm9yfGVsc2V8c3dpdGNofGNhc2V8YnJlYWt8e3x9fDspKSguKik/L2csXG4gICAgICAgICAgICBjb2RlID0gJ3dpdGgob2JqKSB7IHZhciByPVtdO1xcbicsXG4gICAgICAgICAgICBjdXJzb3IgPSAwLFxuICAgICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgICAgbWF0Y2g7XG4gICAgICAgIHZhciBhZGQgPSBmdW5jdGlvbihsaW5lLCBqcykge1xuICAgICAgICAgICAgLyoganNoaW50IC1XMDMwICovXG4gICAgICAgICAgICBqcz8gKGNvZGUgKz0gbGluZS5tYXRjaChyZUV4cCkgPyBsaW5lICsgJ1xcbicgOiAnci5wdXNoKCcgKyBsaW5lICsgJyk7XFxuJykgOlxuICAgICAgICAgICAgICAgIChjb2RlICs9IGxpbmUgIT09ICcnID8gJ3IucHVzaChcIicgKyBsaW5lLnJlcGxhY2UoL1wiL2csICdcXFxcXCInKSArICdcIik7XFxuJyA6ICcnKTtcbiAgICAgICAgICAgIHJldHVybiBhZGQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKFV0aWxzLmlzVmFsdWUoY29uZikpIHtcbiAgICAgICAgICAgIGlmICgoJC5oYXNQcm9wKGNvbmYsICdiZWdpblRva2VuJykpKSB7XG4gICAgICAgICAgICAgICAgcmUgPSByZS5yZXBsYWNlKCc8JScsIGNvbmYuYmVnaW5Ub2tlbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoKCQuaGFzUHJvcChjb25mLCdlbmRUb2tlbicpKSkge1xuICAgICAgICAgICAgICAgIHJlID0gcmUucmVwbGFjZSgnJT4nLCBjb25mLmVuZFRva2VuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIFJlRXggPSBuZXcgUmVnRXhwKHJlLCAnZycpO1xuICAgICAgICBtYXRjaCA9IFJlRXguZXhlYyhodG1sKTtcblxuICAgICAgICB3aGlsZShtYXRjaCkge1xuICAgICAgICAgICAgYWRkKGh0bWwuc2xpY2UoY3Vyc29yLCBtYXRjaC5pbmRleCkpKG1hdGNoWzFdLCB0cnVlKTtcbiAgICAgICAgICAgIGN1cnNvciA9IG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoO1xuICAgICAgICAgICAgbWF0Y2ggPSBSZUV4LmV4ZWMoaHRtbCk7XG4gICAgICAgIH1cbiAgICAgICAgYWRkKGh0bWwuc3Vic3RyKGN1cnNvciwgaHRtbC5sZW5ndGggLSBjdXJzb3IpKTtcbiAgICAgICAgY29kZSA9IChjb2RlICsgJ3JldHVybiByLmpvaW4oXCJcIik7IH0nKS5yZXBsYWNlKC9bXFxyXFx0XFxuXS9nLCAnICcpO1xuICAgICAgICAvKiBqc2hpbnQgLVcwNTQgKi9cbiAgICAgICAgdHJ5IHsgcmVzdWx0ID0gbmV3IEZ1bmN0aW9uKCdvYmonLCBjb2RlKS5hcHBseShvcHRpb25zLCBbb3B0aW9uc10pOyB9XG4gICAgICAgIGNhdGNoKGVycikgeyBjb25zb2xlLmVycm9yKFwiJ1wiICsgZXJyLm1lc3NhZ2UgKyBcIidcIiwgXCIgaW4gXFxuXFxuQ29kZTpcXG5cIiwgY29kZSwgXCJcXG5cIik7IH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgdmFyIFRlbXBsYXRlRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgdGVtcGxhdGVEYXRhOiBudWxsLFxuICAgICAgICBvblRlbXBsYXRlQ29tcGlsZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25UZW1wbGF0ZUNyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby50ZW1wbGF0ZVNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgVGVtcGxhdGVEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIFRlbXBsYXRlRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9UZW1wbGF0ZVNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8udGVtcGxhdGVTZXR1cCh3aW5kb3dbXCJtZXRyb1RlbXBsYXRlU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgndGVtcGxhdGUnLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgVGVtcGxhdGVEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6IG51bGwsXG4gICAgICAgICAgICAgICAgZGF0YToge31cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NvbXBpbGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciB0ZW1wbGF0ZSwgY29tcGlsZWQ7XG5cbiAgICAgICAgICAgIHRlbXBsYXRlID0gdGhpcy50ZW1wbGF0ZVxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8oJmx0OyUpL2dtLCBcIjwlXCIpXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoLyglJmd0OykvZ20sIFwiJT5cIilcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvKCZsdDspL2dtLCBcIjxcIilcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvKCZndDspL2dtLCBcIj5cIik7XG5cbiAgICAgICAgICAgIGNvbXBpbGVkID0gRW5naW5lKHRlbXBsYXRlLCB0aGlzLmRhdGEpO1xuICAgICAgICAgICAgZWxlbWVudC5odG1sKGNvbXBpbGVkKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KCd0ZW1wbGF0ZS1jb21waWxlJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiB0ZW1wbGF0ZSxcbiAgICAgICAgICAgICAgICBjb21waWxlZDogY29tcGlsZWQsXG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGVsZW1lbnQuaHRtbCgpO1xuICAgICAgICAgICAgdGhpcy5kYXRhID0gVXRpbHMuaXNPYmplY3Qoby50ZW1wbGF0ZURhdGEpIHx8IHt9O1xuICAgICAgICAgICAgdGhpcy5fY29tcGlsZSgpO1xuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KCd0ZW1wbGF0ZS1jcmVhdGUnLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYnVpbGRXaXRoOiBmdW5jdGlvbihvYmope1xuICAgICAgICAgICAgdmFyIGRhdGEgPSBVdGlscy5pc09iamVjdChvYmopO1xuICAgICAgICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgICAgICAgICAgIHRoaXMuX2NvbXBpbGUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VBdHRyaWJ1dGU6IGZ1bmN0aW9uKGEsIHYpe1xuICAgICAgICAgICAgaWYgKGEgPT09IFwiZGF0YS10ZW1wbGF0ZS1kYXRhXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMudGVtcGxhdGVEYXRhID0gdjtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSBVdGlscy5pc09iamVjdCh2KSB8fCB7fTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb21waWxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIE1ldHJvLnRlbXBsYXRlID0gRW5naW5lO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIFRleHRhcmVhRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgbGFiZWw6IFwiXCIsXG4gICAgICAgIHRleHRhcmVhRGVmZXJyZWQ6IDAsXG4gICAgICAgIGNoYXJzQ291bnRlcjogbnVsbCxcbiAgICAgICAgY2hhcnNDb3VudGVyVGVtcGxhdGU6IFwiJDFcIixcbiAgICAgICAgZGVmYXVsdFZhbHVlOiBcIlwiLFxuICAgICAgICBwcmVwZW5kOiBcIlwiLFxuICAgICAgICBhcHBlbmQ6IFwiXCIsXG4gICAgICAgIGNvcHlJbmxpbmVTdHlsZXM6IGZhbHNlLFxuICAgICAgICBjbGVhckJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgY2xlYXJCdXR0b25JY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tY3Jvc3MnPjwvc3Bhbj5cIixcbiAgICAgICAgYXV0b1NpemU6IHRydWUsXG4gICAgICAgIG1heEhlaWdodDogMCxcbiAgICAgICAgY2xzUHJlcGVuZDogXCJcIixcbiAgICAgICAgY2xzQXBwZW5kOiBcIlwiLFxuICAgICAgICBjbHNDb21wb25lbnQ6IFwiXCIsXG4gICAgICAgIGNsc1RleHRhcmVhOiBcIlwiLFxuICAgICAgICBjbHNMYWJlbDogXCJcIixcbiAgICAgICAgb25DaGFuZ2U6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uVGV4dGFyZWFDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8udGV4dGFyZWFTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIFRleHRhcmVhRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBUZXh0YXJlYURlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvVGV4dGFyZWFTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLnRleHRhcmVhU2V0dXAod2luZG93W1wibWV0cm9UZXh0YXJlYVNldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ3RleHRhcmVhJywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIFRleHRhcmVhRGVmYXVsdENvbmZpZyk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVN0cnVjdHVyZSgpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlRXZlbnRzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInRleHRhcmVhLWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZVN0cnVjdHVyZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgZWxlbSA9IHRoaXMuZWxlbSwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJ0ZXh0YXJlYSBcIiArIGVsZW1lbnRbMF0uY2xhc3NOYW1lKTtcbiAgICAgICAgICAgIHZhciBmYWtlVGV4dGFyZWEgPSAkKFwiPHRleHRhcmVhPlwiKS5hZGRDbGFzcyhcImZha2UtdGV4dGFyZWFcIik7XG4gICAgICAgICAgICB2YXIgY2xlYXJCdXR0b247XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5pbnNlcnRCZWZvcmUoZWxlbWVudCk7XG4gICAgICAgICAgICBlbGVtZW50LmFwcGVuZFRvKGNvbnRhaW5lcik7XG4gICAgICAgICAgICBmYWtlVGV4dGFyZWEuYXBwZW5kVG8oY29udGFpbmVyKTtcblxuICAgICAgICAgICAgaWYgKG8uY2xlYXJCdXR0b24gIT09IGZhbHNlICYmICFlbGVtZW50WzBdLnJlYWRPbmx5KSB7XG4gICAgICAgICAgICAgICAgY2xlYXJCdXR0b24gPSAkKFwiPGJ1dHRvbj5cIikuYWRkQ2xhc3MoXCJidXR0b24gaW5wdXQtY2xlYXItYnV0dG9uXCIpLmF0dHIoXCJ0YWJpbmRleFwiLCAtMSkuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIikuaHRtbChvLmNsZWFyQnV0dG9uSWNvbik7XG4gICAgICAgICAgICAgICAgY2xlYXJCdXR0b24uYXBwZW5kVG8oY29udGFpbmVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuYXR0cignZGlyJykgPT09ICdydGwnICkge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcInJ0bFwiKS5hdHRyKFwiZGlyXCIsIFwicnRsXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5wcmVwZW5kICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByZXBlbmQgPSAkKFwiPGRpdj5cIikuaHRtbChvLnByZXBlbmQpO1xuICAgICAgICAgICAgICAgIHByZXBlbmQuYWRkQ2xhc3MoXCJwcmVwZW5kXCIpLmFkZENsYXNzKG8uY2xzUHJlcGVuZCkuYXBwZW5kVG8oY29udGFpbmVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uYXBwZW5kICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFwcGVuZCA9ICQoXCI8ZGl2PlwiKS5odG1sKG8uYXBwZW5kKTtcbiAgICAgICAgICAgICAgICBhcHBlbmQuYWRkQ2xhc3MoXCJhcHBlbmRcIikuYWRkQ2xhc3Moby5jbHNBcHBlbmQpLmFwcGVuZFRvKGNvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgY2xlYXJCdXR0b24uY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgcmlnaHQ6IGFwcGVuZC5vdXRlcldpZHRoKCkgKyA0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW0uY2xhc3NOYW1lID0gJyc7XG4gICAgICAgICAgICBpZiAoby5jb3B5SW5saW5lU3R5bGVzID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBlbGVtLnN0eWxlLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuY3NzKGVsZW0uc3R5bGVbaV0sIGVsZW1lbnQuY3NzKGVsZW0uc3R5bGVbaV0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8uZGVmYXVsdFZhbHVlKSAmJiBlbGVtZW50LnZhbCgpLnRyaW0oKSA9PT0gXCJcIikge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQudmFsKG8uZGVmYXVsdFZhbHVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKG8uY2xzQ29tcG9uZW50KTtcbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3Moby5jbHNUZXh0YXJlYSk7XG5cbiAgICAgICAgICAgIGlmIChvLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gJChcIjxsYWJlbD5cIikuYWRkQ2xhc3MoXCJsYWJlbC1mb3ItaW5wdXRcIikuYWRkQ2xhc3Moby5jbHNMYWJlbCkuaHRtbChvLmxhYmVsKS5pbnNlcnRCZWZvcmUoY29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5hdHRyKFwiaWRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwuYXR0cihcImZvclwiLCBlbGVtZW50LmF0dHIoXCJpZFwiKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmF0dHIoXCJkaXJcIikgPT09IFwicnRsXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwuYWRkQ2xhc3MoXCJydGxcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5pcygnOmRpc2FibGVkJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmFibGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZmFrZVRleHRhcmVhLnZhbChlbGVtZW50LnZhbCgpKTtcblxuICAgICAgICAgICAgaWYgKG8uYXV0b1NpemUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJhdXRvc2l6ZSBuby1zY3JvbGwtdmVydGljYWxcIik7XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQucmVzaXplKCk7XG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHRleHRhcmVhID0gZWxlbWVudC5jbG9zZXN0KFwiLnRleHRhcmVhXCIpO1xuICAgICAgICAgICAgdmFyIGZha2VUZXh0YXJlYSA9IHRleHRhcmVhLmZpbmQoXCIuZmFrZS10ZXh0YXJlYVwiKTtcbiAgICAgICAgICAgIHZhciBjaGFyc19jb3VudGVyID0gJChvLmNoYXJzQ291bnRlcik7XG5cbiAgICAgICAgICAgIHRleHRhcmVhLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuaW5wdXQtY2xlYXItYnV0dG9uXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgZWxlbWVudC52YWwoVXRpbHMuaXNWYWx1ZShvLmRlZmF1bHRWYWx1ZSkgPyBvLmRlZmF1bHRWYWx1ZSA6IFwiXCIpLnRyaWdnZXIoJ2NoYW5nZScpLnRyaWdnZXIoJ2tleXVwJykuZm9jdXMoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoby5hdXRvU2l6ZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmlucHV0Y2hhbmdlICsgXCIgXCIgKyBNZXRyby5ldmVudHMua2V5dXAsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGZha2VUZXh0YXJlYS52YWwodGhpcy52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQucmVzaXplKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmJsdXIsIGZ1bmN0aW9uKCl7dGV4dGFyZWEucmVtb3ZlQ2xhc3MoXCJmb2N1c2VkXCIpO30pO1xuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuZm9jdXMsIGZ1bmN0aW9uKCl7dGV4dGFyZWEuYWRkQ2xhc3MoXCJmb2N1c2VkXCIpO30pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5rZXl1cCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLmNoYXJzQ291bnRlcikgJiYgY2hhcnNfY291bnRlci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGFyc19jb3VudGVyWzBdLnRhZ05hbWUgPT09IFwiSU5QVVRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnNfY291bnRlci52YWwodGhhdC5sZW5ndGgoKSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFyc19jb3VudGVyLmh0bWwoby5jaGFyc0NvdW50ZXJUZW1wbGF0ZS5yZXBsYWNlKFwiJDFcIiwgdGhhdC5sZW5ndGgoKSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiY2hhbmdlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsOiBlbGVtZW50LnZhbCgpLFxuICAgICAgICAgICAgICAgICAgICBsZW5ndGg6IHRoYXQubGVuZ3RoKClcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcblxuICAgICAgICByZXNpemU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgICAgICB0ZXh0YXJlYSA9IGVsZW1lbnQuY2xvc2VzdChcIi50ZXh0YXJlYVwiKSxcbiAgICAgICAgICAgICAgICBmYWtlVGV4dGFyZWEgPSB0ZXh0YXJlYS5maW5kKFwiLmZha2UtdGV4dGFyZWFcIiksXG4gICAgICAgICAgICAgICAgY3VycmVudEhlaWdodCA9IGZha2VUZXh0YXJlYVswXS5zY3JvbGxIZWlnaHQ7XG5cbiAgICAgICAgICAgIGlmIChvLm1heEhlaWdodCAmJiBjdXJyZW50SGVpZ2h0ID49IG8ubWF4SGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgdGV4dGFyZWEucmVtb3ZlQ2xhc3MoXCJuby1zY3JvbGwtdmVydGljYWxcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8ubWF4SGVpZ2h0ICYmIGN1cnJlbnRIZWlnaHQgPCBvLm1heEhlaWdodCkge1xuICAgICAgICAgICAgICAgIHRleHRhcmVhLmFkZENsYXNzKFwibm8tc2Nyb2xsLXZlcnRpY2FsXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmYWtlVGV4dGFyZWFbMF0uc3R5bGUuY3NzVGV4dCA9ICdoZWlnaHQ6YXV0bzsnO1xuICAgICAgICAgICAgZmFrZVRleHRhcmVhWzBdLnN0eWxlLmNzc1RleHQgPSAnaGVpZ2h0OicgKyBmYWtlVGV4dGFyZWFbMF0uc2Nyb2xsSGVpZ2h0ICsgJ3B4JztcbiAgICAgICAgICAgIGVsZW1lbnRbMF0uc3R5bGUuY3NzVGV4dCA9ICdoZWlnaHQ6JyArIGZha2VUZXh0YXJlYVswXS5zY3JvbGxIZWlnaHQgKyAncHgnO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNsZWFyOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnZhbChcIlwiKS50cmlnZ2VyKCdjaGFuZ2UnKS50cmlnZ2VyKCdrZXl1cCcpLmZvY3VzKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9EZWZhdWx0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnZhbChVdGlscy5pc1ZhbHVlKHRoaXMub3B0aW9ucy5kZWZhdWx0VmFsdWUpID8gdGhpcy5vcHRpb25zLmRlZmF1bHRWYWx1ZSA6IFwiXCIpLnRyaWdnZXIoJ2NoYW5nZScpLnRyaWdnZXIoJ2tleXVwJykuZm9jdXMoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBsZW5ndGg6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgY2hhcmFjdGVycyA9IHRoaXMuZWxlbS52YWx1ZS5zcGxpdCgnJyk7XG4gICAgICAgICAgICByZXR1cm4gY2hhcmFjdGVycy5sZW5ndGg7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50KCkuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRpc2FibGVkXCIsIGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnQoKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZVN0YXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbS5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSl7XG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdkaXNhYmxlZCc6IHRoaXMudG9nZ2xlU3RhdGUoKTsgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHRleHRhcmVhID0gZWxlbWVudC5jbG9zZXN0KFwiLnRleHRhcmVhXCIpO1xuXG4gICAgICAgICAgICB0ZXh0YXJlYS5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5pbnB1dC1jbGVhci1idXR0b25cIik7XG5cbiAgICAgICAgICAgIGlmIChvLmF1dG9TaXplKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmlucHV0Y2hhbmdlICsgXCIgXCIgKyBNZXRyby5ldmVudHMua2V5dXApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuYmx1cik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuZm9jdXMpO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMua2V5dXApO1xuXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIGVmZmVjdHMgPSBbXG4gICAgICAgIFwic2xpZGUtdXBcIiwgXCJzbGlkZS1kb3duXCIsIFwic2xpZGUtbGVmdFwiLCBcInNsaWRlLXJpZ2h0XCIsIFwiZmFkZVwiLCBcInpvb21cIiwgXCJzd2lybFwiLCBcInN3aXRjaFwiXG4gICAgXTtcbiAgICB2YXIgVGlsZURlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIHRpbGVEZWZlcnJlZDogMCxcbiAgICAgICAgc2l6ZTogXCJtZWRpdW1cIixcbiAgICAgICAgY292ZXI6IFwiXCIsXG4gICAgICAgIGNvdmVyUG9zaXRpb246IFwiY2VudGVyXCIsXG4gICAgICAgIGVmZmVjdDogXCJcIiwgLy8gc2xpZGUtdXAsIHNsaWRlLWRvd24sIHNsaWRlLWxlZnQsIHNsaWRlLXJpZ2h0LCBmYWRlLCB6b29tLCBzd2lybCwgc3dpdGNoXG4gICAgICAgIGVmZmVjdEludGVydmFsOiAzMDAwLFxuICAgICAgICBlZmZlY3REdXJhdGlvbjogNTAwLFxuICAgICAgICB0YXJnZXQ6IG51bGwsXG4gICAgICAgIGNhblRyYW5zZm9ybTogdHJ1ZSxcbiAgICAgICAgb25UaWxlQ2xpY2s6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uVGlsZUNyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby50aWxlU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBUaWxlRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBUaWxlRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9UaWxlU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby50aWxlU2V0dXAod2luZG93W1wibWV0cm9UaWxlU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgndGlsZScsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBUaWxlRGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIGVmZmVjdEludGVydmFsOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBpbWFnZXM6IFtdLFxuICAgICAgICAgICAgICAgIHNsaWRlczogW10sXG4gICAgICAgICAgICAgICAgY3VycmVudFNsaWRlOiAtMSxcbiAgICAgICAgICAgICAgICB1bmxvYWQ6IGZhbHNlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVUaWxlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwidGlsZS1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVUaWxlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgZnVuY3Rpb24gc3dpdGNoSW1hZ2UoZWwsIGltZ19zcmMsIGkpe1xuICAgICAgICAgICAgICAgICQuc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBlbC5mYWRlT3V0KDUwMCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmNzcyhcImJhY2tncm91bmQtaW1hZ2VcIiwgXCJ1cmwoXCIgKyBpbWdfc3JjICsgXCIpXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWwuZmFkZUluKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sIGkgKiAzMDApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgc2xpZGVzID0gZWxlbWVudC5maW5kKFwiLnNsaWRlXCIpO1xuICAgICAgICAgICAgdmFyIHNsaWRlczIgPSBlbGVtZW50LmZpbmQoXCIuc2xpZGUtZnJvbnQsIC5zbGlkZS1iYWNrXCIpO1xuXG4gICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwidGlsZS1cIiArIG8uc2l6ZSk7XG5cbiAgICAgICAgICAgIGlmIChvLmVmZmVjdC5pbmRleE9mKFwiaG92ZXItXCIpID4gLTEpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwiZWZmZWN0LVwiICsgby5lZmZlY3QpO1xuICAgICAgICAgICAgICAgICQuZWFjaChzbGlkZXMyLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2xpZGUgPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzbGlkZS5kYXRhKFwiY292ZXJcIikgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fc2V0Q292ZXIoc2xpZGUsIHNsaWRlLmRhdGEoXCJjb3ZlclwiKSwgc2xpZGUuZGF0YShcImNvdmVyLXBvc2l0aW9uXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChlZmZlY3RzLmluY2x1ZGVzKG8uZWZmZWN0KSAmJiBzbGlkZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICQuZWFjaChzbGlkZXMsIGZ1bmN0aW9uKGkpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2xpZGUgPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuc2xpZGVzLnB1c2godGhpcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNsaWRlLmRhdGEoXCJjb3ZlclwiKSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9zZXRDb3ZlcihzbGlkZSwgc2xpZGUuZGF0YShcImNvdmVyXCIpLCBzbGlkZS5kYXRhKFwiY292ZXItcG9zaXRpb25cIikpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoW1wic2xpZGUtdXBcIiwgXCJzbGlkZS1kb3duXCJdLmluZGV4T2Yoby5lZmZlY3QpID4gLTEpIHNsaWRlLmNzcyhcInRvcFwiLCBcIjEwMCVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoW1wic2xpZGUtbGVmdFwiLCBcInNsaWRlLXJpZ2h0XCJdLmluZGV4T2Yoby5lZmZlY3QpID4gLTEpIHNsaWRlLmNzcyhcImxlZnRcIiwgXCIxMDAlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFtcImZhZGVcIiwgXCJ6b29tXCIsIFwic3dpcmxcIiwgXCJzd2l0Y2hcIl0uaW5kZXhPZihvLmVmZmVjdCkgPiAtMSkgc2xpZGUuY3NzKFwib3BhY2l0eVwiLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2xpZGUgPSAwO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fcnVuRWZmZWN0cygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5jb3ZlciAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuX3NldENvdmVyKGVsZW1lbnQsIG8uY292ZXIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5lZmZlY3QgPT09IFwiaW1hZ2Utc2V0XCIpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwiaW1hZ2Utc2V0XCIpO1xuXG4gICAgICAgICAgICAgICAgJC5lYWNoKGVsZW1lbnQuY2hpbGRyZW4oXCJpbWdcIiksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaW1hZ2VzLnB1c2godGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IHRoaXMuaW1hZ2VzLnNsaWNlKCk7XG5cbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgNTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBybmRfaW5kZXggPSAkLnJhbmRvbSgwLCB0ZW1wLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGl2ID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwiaW1nIC1qcy1pbWctXCIraSkuY3NzKFwiYmFja2dyb3VuZC1pbWFnZVwiLCBcInVybChcIit0ZW1wW3JuZF9pbmRleF0uc3JjK1wiKVwiKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5wcmVwZW5kKGRpdik7XG4gICAgICAgICAgICAgICAgICAgIHRlbXAuc3BsaWNlKHJuZF9pbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGEgPSBbMCwgMSwgNCwgMywgMl07XG5cbiAgICAgICAgICAgICAgICAkLnNldEludGVydmFsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gdGhhdC5pbWFnZXMuc2xpY2UoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJnID0gTWV0cm8uY29sb3JzLnJhbmRvbSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY3NzKFwiYmFja2dyb3VuZC1jb2xvclwiLCBiZyk7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBybmRfaW5kZXggPSAkLnJhbmRvbSgwLCB0ZW1wLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpdiA9IGVsZW1lbnQuZmluZChcIi4tanMtaW1nLVwiK2FbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoSW1hZ2UoZGl2LCB0ZW1wW3JuZF9pbmRleF0uc3JjLCBpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAuc3BsaWNlKHJuZF9pbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBhID0gYS5yZXZlcnNlKCk7XG4gICAgICAgICAgICAgICAgfSwgNTAwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3J1bkVmZmVjdHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmVmZmVjdEludGVydmFsID09PSBmYWxzZSkgdGhpcy5lZmZlY3RJbnRlcnZhbCA9ICQuc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudCwgbmV4dDtcblxuICAgICAgICAgICAgICAgIGN1cnJlbnQgPSAkKHRoYXQuc2xpZGVzW3RoYXQuY3VycmVudFNsaWRlXSk7XG5cbiAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnRTbGlkZSsrO1xuICAgICAgICAgICAgICAgIGlmICh0aGF0LmN1cnJlbnRTbGlkZSA9PT0gdGhhdC5zbGlkZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFNsaWRlID0gMDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBuZXh0ID0gdGhhdC5zbGlkZXNbdGhhdC5jdXJyZW50U2xpZGVdO1xuXG4gICAgICAgICAgICAgICAgaWYgKGVmZmVjdHMuaW5jbHVkZXMoby5lZmZlY3QpKSB7XG4gICAgICAgICAgICAgICAgICAgIE1ldHJvLmFuaW1hdGlvbnNbQ2FrZS5jYW1lbENhc2Uoby5lZmZlY3QpXSgkKGN1cnJlbnQpLCAkKG5leHQpLCB7ZHVyYXRpb246IG8uZWZmZWN0RHVyYXRpb259KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0sIG8uZWZmZWN0SW50ZXJ2YWwpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9zdG9wRWZmZWN0czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICQuY2xlYXJJbnRlcnZhbCh0aGlzLmVmZmVjdEludGVydmFsKTtcbiAgICAgICAgICAgIHRoaXMuZWZmZWN0SW50ZXJ2YWwgPSBmYWxzZTtcbiAgICAgICAgfSxcblxuICAgICAgICBfc2V0Q292ZXI6IGZ1bmN0aW9uKHRvLCBzcmMsIHBvcyl7XG4gICAgICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUocG9zKSkge1xuICAgICAgICAgICAgICAgIHBvcyA9IHRoaXMub3B0aW9ucy5jb3ZlclBvc2l0aW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdG8uY3NzKHtcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6IFwidXJsKFwiK3NyYytcIilcIixcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kU2l6ZTogXCJjb3ZlclwiLFxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRSZXBlYXQ6IFwibm8tcmVwZWF0XCIsXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZFBvc2l0aW9uOiBwb3NcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLnN0YXJ0QWxsLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICB2YXIgdGlsZSA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgdmFyIGRpbSA9IHt3OiBlbGVtZW50LndpZHRoKCksIGg6IGVsZW1lbnQuaGVpZ2h0KCl9O1xuICAgICAgICAgICAgICAgIHZhciBYID0gVXRpbHMucGFnZVhZKGUpLnggLSB0aWxlLm9mZnNldCgpLmxlZnQsXG4gICAgICAgICAgICAgICAgICAgIFkgPSBVdGlscy5wYWdlWFkoZSkueSAtIHRpbGUub2Zmc2V0KCkudG9wO1xuICAgICAgICAgICAgICAgIHZhciBzaWRlO1xuXG4gICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzUmlnaHRNb3VzZShlKSA9PT0gZmFsc2UpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoWCA8IGRpbS53ICogMSAvIDMgJiYgKFkgPCBkaW0uaCAqIDEgLyAyIHx8IFkgPiBkaW0uaCAqIDEgLyAyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2lkZSA9ICdsZWZ0JztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChYID4gZGltLncgKiAyIC8gMyAmJiAoWSA8IGRpbS5oICogMSAvIDIgfHwgWSA+IGRpbS5oICogMSAvIDIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaWRlID0gJ3JpZ2h0JztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChYID4gZGltLncgKiAxIC8gMyAmJiBYIDwgZGltLncgKiAyIC8gMyAmJiBZID4gZGltLmggLyAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaWRlID0gJ2JvdHRvbSc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaWRlID0gXCJ0b3BcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChvLmNhblRyYW5zZm9ybSA9PT0gdHJ1ZSkgdGlsZS5hZGRDbGFzcyhcInRyYW5zZm9ybS1cIiArIHNpZGUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChvLnRhcmdldCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSBvLnRhcmdldDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJ0aWxlLWNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpZGU6IHNpZGVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oW01ldHJvLmV2ZW50cy5zdG9wQWxsLCBNZXRyby5ldmVudHMubGVhdmVdLmpvaW4oXCIgXCIpLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICQodGhpcylcbiAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwidHJhbnNmb3JtLWxlZnRcIilcbiAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwidHJhbnNmb3JtLXJpZ2h0XCIpXG4gICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcInRyYW5zZm9ybS10b3BcIilcbiAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwidHJhbnNmb3JtLWJvdHRvbVwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5zdGFydEFsbCk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKFtNZXRyby5ldmVudHMuc3RvcEFsbCwgTWV0cm8uZXZlbnRzLmxlYXZlXS5qb2luKFwiIFwiKSk7XG5cbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgVGltZVBpY2tlckRlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGxhYmVsOiBcIlwiLFxuICAgICAgICB0aW1lcGlja2VyRGVmZXJyZWQ6IDAsXG4gICAgICAgIGhvdXJzU3RlcDogMSxcbiAgICAgICAgbWludXRlc1N0ZXA6IDEsXG4gICAgICAgIHNlY29uZHNTdGVwOiAxLFxuICAgICAgICB2YWx1ZTogbnVsbCxcbiAgICAgICAgbG9jYWxlOiBNRVRST19MT0NBTEUsXG4gICAgICAgIGRpc3RhbmNlOiAzLFxuICAgICAgICBob3VyczogdHJ1ZSxcbiAgICAgICAgbWludXRlczogdHJ1ZSxcbiAgICAgICAgc2Vjb25kczogdHJ1ZSxcbiAgICAgICAgc2hvd0xhYmVsczogdHJ1ZSxcbiAgICAgICAgc2Nyb2xsU3BlZWQ6IDQsXG4gICAgICAgIGNvcHlJbmxpbmVTdHlsZXM6IGZhbHNlLFxuICAgICAgICBjbHNQaWNrZXI6IFwiXCIsXG4gICAgICAgIGNsc1BhcnQ6IFwiXCIsXG4gICAgICAgIGNsc0hvdXJzOiBcIlwiLFxuICAgICAgICBjbHNNaW51dGVzOiBcIlwiLFxuICAgICAgICBjbHNTZWNvbmRzOiBcIlwiLFxuICAgICAgICBjbHNMYWJlbDogXCJcIixcbiAgICAgICAgY2xzQnV0dG9uOiBcIlwiLFxuICAgICAgICBjbHNPa0J1dHRvbjogXCJcIixcbiAgICAgICAgY2xzQ2FuY2VsQnV0dG9uOiBcIlwiLFxuICAgICAgICBva0J1dHRvbkljb246IFwiPHNwYW4gY2xhc3M9J2RlZmF1bHQtaWNvbi1jaGVjayc+PC9zcGFuPlwiLFxuICAgICAgICBjYW5jZWxCdXR0b25JY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tY3Jvc3MnPjwvc3Bhbj5cIixcbiAgICAgICAgb25TZXQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uT3BlbjogTWV0cm8ubm9vcCxcbiAgICAgICAgb25DbG9zZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25TY3JvbGw6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uVGltZVBpY2tlckNyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby50aW1lUGlja2VyU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBUaW1lUGlja2VyRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBUaW1lUGlja2VyRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9UaW1lUGlja2VyU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby50aW1lUGlja2VyU2V0dXAod2luZG93W1wibWV0cm9UaW1lUGlja2VyU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgndGltZS1waWNrZXInLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgVGltZVBpY2tlckRlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICBwaWNrZXI6IG51bGwsXG4gICAgICAgICAgICAgICAgaXNPcGVuOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogW10sXG4gICAgICAgICAgICAgICAgbG9jYWxlOiBNZXRyby5sb2NhbGVzW01FVFJPX0xPQ0FMRV1bJ2NhbGVuZGFyJ10sXG4gICAgICAgICAgICAgICAgbGlzdFRpbWVyOiB7XG4gICAgICAgICAgICAgICAgICAgIGhvdXJzOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBtaW51dGVzOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBzZWNvbmRzOiBudWxsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpZDogVXRpbHMuZWxlbWVudElkKFwidGltZS1waWNrZXJcIilcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgaTtcblxuICAgICAgICAgICAgaWYgKG8uZGlzdGFuY2UgPCAxKSB7XG4gICAgICAgICAgICAgICAgby5kaXN0YW5jZSA9IDE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmhvdXJzU3RlcCA8IDEpIHtvLmhvdXJzU3RlcCA9IDE7fVxuICAgICAgICAgICAgaWYgKG8uaG91cnNTdGVwID4gMjMpIHtvLmhvdXJzU3RlcCA9IDIzO31cblxuICAgICAgICAgICAgaWYgKG8ubWludXRlc1N0ZXAgPCAxKSB7by5taW51dGVzU3RlcCA9IDE7fVxuICAgICAgICAgICAgaWYgKG8ubWludXRlc1N0ZXAgPiA1OSkge28ubWludXRlc1N0ZXAgPSA1OTt9XG5cbiAgICAgICAgICAgIGlmIChvLnNlY29uZHNTdGVwIDwgMSkge28uc2Vjb25kc1N0ZXAgPSAxO31cbiAgICAgICAgICAgIGlmIChvLnNlY29uZHNTdGVwID4gNTkpIHtvLnNlY29uZHNTdGVwID0gNTk7fVxuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC52YWwoKSA9PT0gXCJcIiAmJiAoIVV0aWxzLmlzVmFsdWUoby52YWx1ZSkpKSB7XG4gICAgICAgICAgICAgICAgby52YWx1ZSA9IGRhdGV0aW1lKCkuZm9ybWF0KFwiSEg6bW06c3NcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSAoZWxlbWVudC52YWwoKSAhPT0gXCJcIiA/IGVsZW1lbnQudmFsKCkgOiBcIlwiK28udmFsdWUpLnRvQXJyYXkoXCI6XCIpO1xuXG4gICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCAzOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy52YWx1ZVtpXSA9PT0gdW5kZWZpbmVkIHx8IHRoaXMudmFsdWVbaV0gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZVtpXSA9IDA7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZVtpXSA9IHBhcnNlSW50KHRoaXMudmFsdWVbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fbm9ybWFsaXplVmFsdWUoKTtcblxuICAgICAgICAgICAgaWYgKE1ldHJvLmxvY2FsZXNbby5sb2NhbGVdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBvLmxvY2FsZSA9IE1FVFJPX0xPQ0FMRTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5sb2NhbGUgPSBNZXRyby5sb2NhbGVzW28ubG9jYWxlXVsnY2FsZW5kYXInXTtcblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcbiAgICAgICAgICAgIHRoaXMuX3NldCgpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJ0aW1lLXBpY2tlci1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9ub3JtYWxpemVWYWx1ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAoby5ob3Vyc1N0ZXAgPiAxKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZVswXSA9IFV0aWxzLm5lYXJlc3QodGhpcy52YWx1ZVswXSwgby5ob3Vyc1N0ZXAsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG8ubWludXRlc1N0ZXAgPiAxKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZVsxXSA9IFV0aWxzLm5lYXJlc3QodGhpcy52YWx1ZVsxXSwgby5taW51dGVzU3RlcCwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoby5taW51dGVzU3RlcCA+IDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlWzJdID0gVXRpbHMubmVhcmVzdCh0aGlzLnZhbHVlWzJdLCBvLnNlY29uZHNTdGVwLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlU3RydWN0dXJlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgcGlja2VyLCBob3VycywgbWludXRlcywgc2Vjb25kcywgaTtcbiAgICAgICAgICAgIHZhciB0aW1lV3JhcHBlciwgc2VsZWN0V3JhcHBlciwgc2VsZWN0QmxvY2ssIGFjdGlvbkJsb2NrO1xuXG4gICAgICAgICAgICBwaWNrZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJ3aGVlbC1waWNrZXIgdGltZS1waWNrZXIgXCIgKyBlbGVtZW50WzBdLmNsYXNzTmFtZSkuYWRkQ2xhc3Moby5jbHNQaWNrZXIpO1xuXG4gICAgICAgICAgICBwaWNrZXIuaW5zZXJ0QmVmb3JlKGVsZW1lbnQpO1xuICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwicmVhZG9ubHlcIiwgdHJ1ZSkuYXBwZW5kVG8ocGlja2VyKTtcblxuICAgICAgICAgICAgaWYgKG8ubGFiZWwpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGFiZWwgPSAkKFwiPGxhYmVsPlwiKS5hZGRDbGFzcyhcImxhYmVsLWZvci1pbnB1dFwiKS5hZGRDbGFzcyhvLmNsc0xhYmVsKS5odG1sKG8ubGFiZWwpLmluc2VydEJlZm9yZShwaWNrZXIpO1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmF0dHIoXCJpZFwiKSkge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbC5hdHRyKFwiZm9yXCIsIGVsZW1lbnQuYXR0cihcImlkXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuYXR0cihcImRpclwiKSA9PT0gXCJydGxcIikge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbC5hZGRDbGFzcyhcInJ0bFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRpbWVXcmFwcGVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwidGltZS13cmFwcGVyXCIpLmFwcGVuZFRvKHBpY2tlcik7XG5cbiAgICAgICAgICAgIGlmIChvLmhvdXJzID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgaG91cnMgPSAkKFwiPGRpdj5cIikuYXR0cihcImRhdGEtdGl0bGVcIiwgdGhpcy5sb2NhbGVbJ3RpbWUnXVsnaG91cnMnXSkuYWRkQ2xhc3MoXCJob3Vyc1wiKS5hZGRDbGFzcyhvLmNsc1BhcnQpLmFkZENsYXNzKG8uY2xzSG91cnMpLmFwcGVuZFRvKHRpbWVXcmFwcGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvLm1pbnV0ZXMgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBtaW51dGVzID0gJChcIjxkaXY+XCIpLmF0dHIoXCJkYXRhLXRpdGxlXCIsIHRoaXMubG9jYWxlWyd0aW1lJ11bJ21pbnV0ZXMnXSkuYWRkQ2xhc3MoXCJtaW51dGVzXCIpLmFkZENsYXNzKG8uY2xzUGFydCkuYWRkQ2xhc3Moby5jbHNNaW51dGVzKS5hcHBlbmRUbyh0aW1lV3JhcHBlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoby5zZWNvbmRzID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgc2Vjb25kcyA9ICQoXCI8ZGl2PlwiKS5hdHRyKFwiZGF0YS10aXRsZVwiLCB0aGlzLmxvY2FsZVsndGltZSddWydzZWNvbmRzJ10pLmFkZENsYXNzKFwic2Vjb25kc1wiKS5hZGRDbGFzcyhvLmNsc1BhcnQpLmFkZENsYXNzKG8uY2xzU2Vjb25kcykuYXBwZW5kVG8odGltZVdyYXBwZXIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZWxlY3RXcmFwcGVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwic2VsZWN0LXdyYXBwZXJcIikuYXBwZW5kVG8ocGlja2VyKTtcblxuICAgICAgICAgICAgc2VsZWN0QmxvY2sgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJzZWxlY3QtYmxvY2tcIikuYXBwZW5kVG8oc2VsZWN0V3JhcHBlcik7XG4gICAgICAgICAgICBpZiAoby5ob3VycyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGhvdXJzID0gJChcIjx1bD5cIikuYWRkQ2xhc3MoXCJzZWwtaG91cnNcIikuYXBwZW5kVG8oc2VsZWN0QmxvY2spO1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBvLmRpc3RhbmNlOyBpKyspICQoXCI8bGk+XCIpLmh0bWwoXCImbmJzcDtcIikuZGF0YShcInZhbHVlXCIsIC0xKS5hcHBlbmRUbyhob3Vycyk7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDI0OyBpID0gaSArIG8uaG91cnNTdGVwKSB7XG4gICAgICAgICAgICAgICAgICAgICQoXCI8bGk+XCIpLmFkZENsYXNzKFwianMtaG91cnMtXCIraSkuaHRtbChDYWtlLmxwYWQoaSwgMiwgXCIwXCIpKS5kYXRhKFwidmFsdWVcIiwgaSkuYXBwZW5kVG8oaG91cnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgby5kaXN0YW5jZTsgaSsrKSAkKFwiPGxpPlwiKS5odG1sKFwiJm5ic3A7XCIpLmRhdGEoXCJ2YWx1ZVwiLCAtMSkuYXBwZW5kVG8oaG91cnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG8ubWludXRlcyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIG1pbnV0ZXMgPSAkKFwiPHVsPlwiKS5hZGRDbGFzcyhcInNlbC1taW51dGVzXCIpLmFwcGVuZFRvKHNlbGVjdEJsb2NrKTtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgby5kaXN0YW5jZTsgaSsrKSAkKFwiPGxpPlwiKS5odG1sKFwiJm5ic3A7XCIpLmRhdGEoXCJ2YWx1ZVwiLCAtMSkuYXBwZW5kVG8obWludXRlcyk7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDYwOyBpID0gaSArIG8ubWludXRlc1N0ZXApIHtcbiAgICAgICAgICAgICAgICAgICAgJChcIjxsaT5cIikuYWRkQ2xhc3MoXCJqcy1taW51dGVzLVwiK2kpLmh0bWwoQ2FrZS5scGFkKGksIDIsIFwiMFwiKSkuZGF0YShcInZhbHVlXCIsIGkpLmFwcGVuZFRvKG1pbnV0ZXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgby5kaXN0YW5jZTsgaSsrKSAkKFwiPGxpPlwiKS5odG1sKFwiJm5ic3A7XCIpLmRhdGEoXCJ2YWx1ZVwiLCAtMSkuYXBwZW5kVG8obWludXRlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoby5zZWNvbmRzID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgc2Vjb25kcyA9ICQoXCI8dWw+XCIpLmFkZENsYXNzKFwic2VsLXNlY29uZHNcIikuYXBwZW5kVG8oc2VsZWN0QmxvY2spO1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBvLmRpc3RhbmNlOyBpKyspICQoXCI8bGk+XCIpLmh0bWwoXCImbmJzcDtcIikuZGF0YShcInZhbHVlXCIsIC0xKS5hcHBlbmRUbyhzZWNvbmRzKTtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgNjA7IGkgPSBpICsgby5zZWNvbmRzU3RlcCkge1xuICAgICAgICAgICAgICAgICAgICAkKFwiPGxpPlwiKS5hZGRDbGFzcyhcImpzLXNlY29uZHMtXCIraSkuaHRtbChDYWtlLmxwYWQoaSwgMiwgXCIwXCIpKS5kYXRhKFwidmFsdWVcIiwgaSkuYXBwZW5kVG8oc2Vjb25kcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBvLmRpc3RhbmNlOyBpKyspICQoXCI8bGk+XCIpLmh0bWwoXCImbmJzcDtcIikuZGF0YShcInZhbHVlXCIsIC0xKS5hcHBlbmRUbyhzZWNvbmRzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2VsZWN0QmxvY2suaGVpZ2h0KChvLmRpc3RhbmNlICogMiArIDEpICogNDApO1xuXG4gICAgICAgICAgICBhY3Rpb25CbG9jayA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImFjdGlvbi1ibG9ja1wiKS5hcHBlbmRUbyhzZWxlY3RXcmFwcGVyKTtcbiAgICAgICAgICAgICQoXCI8YnV0dG9uPlwiKS5hdHRyKFwidHlwZVwiLCBcImJ1dHRvblwiKS5hZGRDbGFzcyhcImJ1dHRvbiBhY3Rpb24tb2tcIikuYWRkQ2xhc3Moby5jbHNCdXR0b24pLmFkZENsYXNzKG8uY2xzT2tCdXR0b24pLmh0bWwoby5va0J1dHRvbkljb24pLmFwcGVuZFRvKGFjdGlvbkJsb2NrKTtcbiAgICAgICAgICAgICQoXCI8YnV0dG9uPlwiKS5hdHRyKFwidHlwZVwiLCBcImJ1dHRvblwiKS5hZGRDbGFzcyhcImJ1dHRvbiBhY3Rpb24tY2FuY2VsXCIpLmFkZENsYXNzKG8uY2xzQnV0dG9uKS5hZGRDbGFzcyhvLmNsc0NhbmNlbEJ1dHRvbikuaHRtbChvLmNhbmNlbEJ1dHRvbkljb24pLmFwcGVuZFRvKGFjdGlvbkJsb2NrKTtcblxuXG4gICAgICAgICAgICBlbGVtZW50WzBdLmNsYXNzTmFtZSA9ICcnO1xuICAgICAgICAgICAgaWYgKG8uY29weUlubGluZVN0eWxlcyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBlbGVtZW50WzBdLnN0eWxlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHBpY2tlci5jc3MoZWxlbWVudFswXS5zdHlsZVtpXSwgZWxlbWVudC5jc3MoZWxlbWVudFswXS5zdHlsZVtpXSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uc2hvd0xhYmVscyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHBpY2tlci5hZGRDbGFzcyhcInNob3ctbGFiZWxzXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5wcm9wKFwiZGlzYWJsZWRcIikpIHtcbiAgICAgICAgICAgICAgICBwaWNrZXIuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5waWNrZXIgPSBwaWNrZXI7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBwaWNrZXIgPSB0aGlzLnBpY2tlcjtcblxuICAgICAgICAgICAgcGlja2VyLm9uKE1ldHJvLmV2ZW50cy5zdGFydCwgXCIuc2VsZWN0LWJsb2NrIHVsXCIsIGZ1bmN0aW9uKGUpe1xuXG4gICAgICAgICAgICAgICAgaWYgKGUuY2hhbmdlZFRvdWNoZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgcGFnZVkgPSBVdGlscy5wYWdlWFkoZSkueTtcblxuICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKE1ldHJvLmV2ZW50cy5tb3ZlLCBmdW5jdGlvbihlKXtcblxuICAgICAgICAgICAgICAgICAgICB0YXJnZXQuc2Nyb2xsVG9wIC09IG8uc2Nyb2xsU3BlZWQgKiAocGFnZVkgID4gVXRpbHMucGFnZVhZKGUpLnkgPyAtMSA6IDEpO1xuXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VZID0gVXRpbHMucGFnZVhZKGUpLnk7XG4gICAgICAgICAgICAgICAgfSwge25zOiB0aGF0LmlkfSk7XG5cbiAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vbihNZXRyby5ldmVudHMuc3RvcCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudCkub2ZmKE1ldHJvLmV2ZW50cy5tb3ZlLCB7bnM6IHRoYXQuaWR9KTtcbiAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudCkub2ZmKE1ldHJvLmV2ZW50cy5zdG9wLCB7bnM6IHRoYXQuaWR9KTtcbiAgICAgICAgICAgICAgICB9LCB7bnM6IHRoYXQuaWR9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBwaWNrZXIub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICBpZiAodGhhdC5pc09wZW4gPT09IGZhbHNlKSB0aGF0Lm9wZW4oKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHBpY2tlci5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmFjdGlvbi1va1wiLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICB2YXIgaCwgbSwgcztcbiAgICAgICAgICAgICAgICB2YXIgc2ggPSBwaWNrZXIuZmluZChcIi5zZWwtaG91cnMgbGkuYWN0aXZlXCIpLFxuICAgICAgICAgICAgICAgICAgICBzbSA9IHBpY2tlci5maW5kKFwiLnNlbC1taW51dGVzIGxpLmFjdGl2ZVwiKSxcbiAgICAgICAgICAgICAgICAgICAgc3MgPSBwaWNrZXIuZmluZChcIi5zZWwtc2Vjb25kcyBsaS5hY3RpdmVcIik7XG5cbiAgICAgICAgICAgICAgICBoID0gc2gubGVuZ3RoID09PSAwID8gMCA6IHNoLmRhdGEoXCJ2YWx1ZVwiKTtcbiAgICAgICAgICAgICAgICBtID0gc20ubGVuZ3RoID09PSAwID8gMCA6IHNtLmRhdGEoXCJ2YWx1ZVwiKTtcbiAgICAgICAgICAgICAgICBzID0gc3MubGVuZ3RoID09PSAwID8gMCA6IHNzLmRhdGEoXCJ2YWx1ZVwiKTtcblxuICAgICAgICAgICAgICAgIHRoYXQudmFsdWUgPSBbaCwgbSwgc107XG4gICAgICAgICAgICAgICAgdGhhdC5fbm9ybWFsaXplVmFsdWUoKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9zZXQoKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHBpY2tlci5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmFjdGlvbi1jYW5jZWxcIiwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgdGhhdC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmFyIHNjcm9sbExhdGVuY3kgPSAxNTA7XG4gICAgICAgICAgICAkLmVhY2goWydob3VycycsICdtaW51dGVzJywgJ3NlY29uZHMnXSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgcGFydCA9IHRoaXMsIGxpc3QgPSBwaWNrZXIuZmluZChcIi5zZWwtXCIrcGFydCk7XG5cbiAgICAgICAgICAgICAgICBsaXN0Lm9uKFwic2Nyb2xsXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhhdC5pc09wZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5saXN0VGltZXJbcGFydF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGF0Lmxpc3RUaW1lcltwYXJ0XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Lmxpc3RUaW1lcltwYXJ0XSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoYXQubGlzdFRpbWVyW3BhcnRdKSB0aGF0Lmxpc3RUaW1lcltwYXJ0XSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0LCB0YXJnZXRFbGVtZW50LCBzY3JvbGxUb3A7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQubGlzdFRpbWVyW3BhcnRdID0gbnVsbDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gTWF0aC5yb3VuZCgoTWF0aC5jZWlsKGxpc3Quc2Nyb2xsVG9wKCkpIC8gNDApKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnQgPT09IFwiaG91cnNcIiAmJiBvLmhvdXJzU3RlcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCAqPSBwYXJzZUludChvLmhvdXJzU3RlcCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFydCA9PT0gXCJtaW51dGVzXCIgJiYgby5taW51dGVzU3RlcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCAqPSBwYXJzZUludChvLm1pbnV0ZXNTdGVwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0ID09PSBcInNlY29uZHNcIiAmJiBvLnNlY29uZHNTdGVwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ICo9IHBhcnNlSW50KG8uc2Vjb25kc1N0ZXApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRFbGVtZW50ID0gbGlzdC5maW5kKFwiLmpzLVwiICsgcGFydCArIFwiLVwiICsgdGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFRvcCA9IHRhcmdldEVsZW1lbnQucG9zaXRpb24oKS50b3AgLSAoby5kaXN0YW5jZSAqIDQwKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC5maW5kKFwiLmFjdGl2ZVwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdFswXS5zY3JvbGxUb3AgPSBzY3JvbGxUb3A7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRFbGVtZW50LmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMuZXhlYyhvLm9uU2Nyb2xsLCBbdGFyZ2V0RWxlbWVudCwgbGlzdCwgcGlja2VyXSwgbGlzdFswXSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSwgc2Nyb2xsTGF0ZW5jeSk7XG5cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3NldDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHBpY2tlciA9IHRoaXMucGlja2VyO1xuICAgICAgICAgICAgdmFyIGggPSBcIjAwXCIsIG0gPSBcIjAwXCIsIHMgPSBcIjAwXCI7XG5cbiAgICAgICAgICAgIGlmIChvLmhvdXJzID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgaCA9IHBhcnNlSW50KHRoaXMudmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgIHBpY2tlci5maW5kKFwiLmhvdXJzXCIpLmh0bWwoQ2FrZS5scGFkKGgsIDIsIFwiMFwiKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoby5taW51dGVzID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgbSA9IHBhcnNlSW50KHRoaXMudmFsdWVbMV0pO1xuICAgICAgICAgICAgICAgIHBpY2tlci5maW5kKFwiLm1pbnV0ZXNcIikuaHRtbChDYWtlLmxwYWQobSwgMiwgXCIwXCIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvLnNlY29uZHMgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBzID0gcGFyc2VJbnQodGhpcy52YWx1ZVsyXSk7XG4gICAgICAgICAgICAgICAgcGlja2VyLmZpbmQoXCIuc2Vjb25kc1wiKS5odG1sKENha2UubHBhZChzLCAyLCBcIjBcIikpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LnZhbChbaCwgbSwgc10uam9pbihcIjpcIikpLnRyaWdnZXIoXCJjaGFuZ2VcIik7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInNldFwiLCB7XG4gICAgICAgICAgICAgICAgdmFsOiB0aGlzLnZhbHVlLFxuICAgICAgICAgICAgICAgIGVsZW1lbnRWYWw6IGVsZW1lbnQudmFsKClcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgb3BlbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHBpY2tlciA9IHRoaXMucGlja2VyO1xuICAgICAgICAgICAgdmFyIGgsIG0sIHM7XG4gICAgICAgICAgICB2YXIgaF9saXN0LCBtX2xpc3QsIHNfbGlzdDtcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IHBpY2tlci5maW5kKFwibGlcIik7XG4gICAgICAgICAgICB2YXIgc2VsZWN0X3dyYXBwZXIgPSBwaWNrZXIuZmluZChcIi5zZWxlY3Qtd3JhcHBlclwiKTtcbiAgICAgICAgICAgIHZhciBzZWxlY3Rfd3JhcHBlcl9pbl92aWV3cG9ydCwgc2VsZWN0X3dyYXBwZXJfcmVjdDtcbiAgICAgICAgICAgIHZhciBoX2l0ZW0sIG1faXRlbSwgc19pdGVtO1xuXG4gICAgICAgICAgICBzZWxlY3Rfd3JhcHBlci5wYXJlbnQoKS5yZW1vdmVDbGFzcyhcImZvci10b3AgZm9yLWJvdHRvbVwiKTtcbiAgICAgICAgICAgIHNlbGVjdF93cmFwcGVyLnNob3coMCk7XG4gICAgICAgICAgICBpdGVtcy5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcblxuICAgICAgICAgICAgc2VsZWN0X3dyYXBwZXJfaW5fdmlld3BvcnQgPSBVdGlscy5pblZpZXdwb3J0KHNlbGVjdF93cmFwcGVyWzBdKTtcbiAgICAgICAgICAgIHNlbGVjdF93cmFwcGVyX3JlY3QgPSBVdGlscy5yZWN0KHNlbGVjdF93cmFwcGVyWzBdKTtcblxuICAgICAgICAgICAgaWYgKCFzZWxlY3Rfd3JhcHBlcl9pbl92aWV3cG9ydCAmJiBzZWxlY3Rfd3JhcHBlcl9yZWN0LnRvcCA+IDApIHtcbiAgICAgICAgICAgICAgICBzZWxlY3Rfd3JhcHBlci5wYXJlbnQoKS5hZGRDbGFzcyhcImZvci1ib3R0b21cIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghc2VsZWN0X3dyYXBwZXJfaW5fdmlld3BvcnQgJiYgc2VsZWN0X3dyYXBwZXJfcmVjdC50b3AgPCAwKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0X3dyYXBwZXIucGFyZW50KCkuYWRkQ2xhc3MoXCJmb3ItdG9wXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgYW5pbWF0ZUxpc3QgPSBmdW5jdGlvbihsaXN0LCBpdGVtKXtcbiAgICAgICAgICAgICAgICBsaXN0XG4gICAgICAgICAgICAgICAgICAgIC5zY3JvbGxUb3AoMClcbiAgICAgICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogaXRlbS5wb3NpdGlvbigpLnRvcCAtIChvLmRpc3RhbmNlICogNDApICsgbGlzdC5zY3JvbGxUb3AoKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cjogMTAwXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKG8uaG91cnMgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBoID0gcGFyc2VJbnQodGhpcy52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgaF9saXN0ID0gcGlja2VyLmZpbmQoXCIuc2VsLWhvdXJzXCIpO1xuICAgICAgICAgICAgICAgIGhfaXRlbSA9IGhfbGlzdC5maW5kKFwibGkuanMtaG91cnMtXCIgKyBoKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICBhbmltYXRlTGlzdChoX2xpc3QsIGhfaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoby5taW51dGVzID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgbSA9IHBhcnNlSW50KHRoaXMudmFsdWVbMV0pO1xuICAgICAgICAgICAgICAgIG1fbGlzdCA9IHBpY2tlci5maW5kKFwiLnNlbC1taW51dGVzXCIpO1xuICAgICAgICAgICAgICAgIG1faXRlbSA9IG1fbGlzdC5maW5kKFwibGkuanMtbWludXRlcy1cIiArIG0pLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgIGFuaW1hdGVMaXN0KG1fbGlzdCwgbV9pdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvLnNlY29uZHMgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBzID0gcGFyc2VJbnQodGhpcy52YWx1ZVsyXSk7XG4gICAgICAgICAgICAgICAgc19saXN0ID0gcGlja2VyLmZpbmQoXCIuc2VsLXNlY29uZHNcIik7XG4gICAgICAgICAgICAgICAgc19pdGVtID0gc19saXN0LmZpbmQoXCJsaS5qcy1zZWNvbmRzLVwiICsgcykuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgYW5pbWF0ZUxpc3Qoc19saXN0LCBzX2l0ZW0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcIm9wZW5cIiwge1xuICAgICAgICAgICAgICAgIHZhbDogdGhpcy52YWx1ZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBjbG9zZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBwaWNrZXIgPSB0aGlzLnBpY2tlcjtcbiAgICAgICAgICAgIHBpY2tlci5maW5kKFwiLnNlbGVjdC13cmFwcGVyXCIpLmhpZGUoMCk7XG4gICAgICAgICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJjbG9zZVwiLCB7XG4gICAgICAgICAgICAgICAgdmFsOiB0aGlzLnZhbHVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY29udmVydDogZnVuY3Rpb24odCl7XG4gICAgICAgICAgICB2YXIgcmVzdWx0O1xuXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0KSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHQ7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiAgdC5nZXRNb250aCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IFt0LmdldEhvdXJzKCksIHQuZ2V0TWludXRlcygpLCB0LmdldFNlY29uZHMoKV07XG4gICAgICAgICAgICB9IGVsc2UgaWYgKFV0aWxzLmlzT2JqZWN0KHQpKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gW3QuaCwgdC5tLCB0LnNdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB0LnRvQXJyYXkoXCI6XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9LFxuXG4gICAgICAgIHZhbDogZnVuY3Rpb24odCl7XG4gICAgICAgICAgICBpZiAodCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC52YWwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLl9jb252ZXJ0KHQpO1xuICAgICAgICAgICAgdGhpcy5fbm9ybWFsaXplVmFsdWUoKTtcbiAgICAgICAgICAgIHRoaXMuX3NldCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRpbWU6IGZ1bmN0aW9uKHQpe1xuICAgICAgICAgICAgaWYgKHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGg6IHRoaXMudmFsdWVbMF0sXG4gICAgICAgICAgICAgICAgICAgIG06IHRoaXMudmFsdWVbMV0sXG4gICAgICAgICAgICAgICAgICAgIHM6IHRoaXMudmFsdWVbMl1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLl9jb252ZXJ0KHQpO1xuICAgICAgICAgICAgdGhpcy5fbm9ybWFsaXplVmFsdWUoKTtcbiAgICAgICAgICAgIHRoaXMuX3NldCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRhdGU6IGZ1bmN0aW9uKHQpe1xuICAgICAgICAgICAgaWYgKHQgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgdC5nZXRNb250aCAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRldGltZSgpXG4gICAgICAgICAgICAgICAgICAgIC5ob3VyKHRoaXMudmFsdWVbMF0pXG4gICAgICAgICAgICAgICAgICAgIC5taW51dGUodGhpcy52YWx1ZVsxXSlcbiAgICAgICAgICAgICAgICAgICAgLnNlY29uZCh0aGlzLnZhbHVlWzJdKVxuICAgICAgICAgICAgICAgICAgICAubXMoMClcbiAgICAgICAgICAgICAgICAgICAgLnZhbCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5fY29udmVydCh0KTtcbiAgICAgICAgICAgIHRoaXMuX25vcm1hbGl6ZVZhbHVlKCk7XG4gICAgICAgICAgICB0aGlzLl9zZXQoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkaXNhYmxlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmRhdGEoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnQoKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGVuYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwiZGlzYWJsZWRcIiwgZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnBhcmVudCgpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlU3RhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiAodGhpcy5lbGVtLmRpc2FibGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyLCBuZXdWYWx1ZSl7XG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHIpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS12YWx1ZVwiOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbChuZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkaXNhYmxlZFwiOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZVN0YXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBwaWNrZXIgPSB0aGlzLnBpY2tlcjtcblxuICAgICAgICAgICAgJC5lYWNoKFsnaG91cnMnLCAnbWludXRlcycsICdzZWNvbmRzJ10sIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgcGlja2VyLmZpbmQoXCIuc2VsLVwiK3RoaXMpLm9mZihcInNjcm9sbFwiKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBwaWNrZXIub2ZmKE1ldHJvLmV2ZW50cy5zdGFydCwgXCIuc2VsZWN0LWJsb2NrIHVsXCIpO1xuICAgICAgICAgICAgcGlja2VyLm9mZihNZXRyby5ldmVudHMuY2xpY2spO1xuICAgICAgICAgICAgcGlja2VyLm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmFjdGlvbi1va1wiKTtcbiAgICAgICAgICAgIHBpY2tlci5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5hY3Rpb24tY2FuY2VsXCIpO1xuXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICAkKGRvY3VtZW50KS5vbihNZXRyby5ldmVudHMuY2xpY2ssIGZ1bmN0aW9uKCl7XG4gICAgICAgICQuZWFjaCgkKFwiLnRpbWUtcGlja2VyXCIpLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgJCh0aGlzKS5maW5kKFwiaW5wdXRcIikuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbih0aGlzLCBcInRpbWVwaWNrZXJcIikuY2xvc2UoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0oTWV0cm8sIG00cSkpO1xyXG5cclxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBUb2FzdERlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGNhbGxiYWNrOiBNZXRyby5ub29wLFxuICAgICAgICB0aW1lb3V0OiBNRVRST19USU1FT1VULFxuICAgICAgICBkaXN0YW5jZTogMjAsXG4gICAgICAgIHNob3dUb3A6IGZhbHNlLFxuICAgICAgICBjbHNUb2FzdDogXCJcIlxuICAgIH07XG5cbiAgICBNZXRyby50b2FzdFNldHVwID0gZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgICAgIFRvYXN0RGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBUb2FzdERlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvVG9hc3RTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLnRvYXN0U2V0dXAod2luZG93W1wibWV0cm9Ub2FzdFNldHVwXCJdKTtcbiAgICB9XG5cbiAgICB2YXIgVG9hc3QgPSB7XG4gICAgICAgIGNyZWF0ZTogZnVuY3Rpb24obWVzc2FnZSwgLypjYWxsYmFjaywgdGltZW91dCwgY2xzLCAqL29wdGlvbnMpe1xuICAgICAgICAgICAgdmFyIG8sIHRvYXN0LCB3aWR0aDtcbiAgICAgICAgICAgIHZhciBhcmdzID0gQXJyYXkuZnJvbShhcmd1bWVudHMpO1xuICAgICAgICAgICAgdmFyIHRpbWVvdXQsIGNhbGxiYWNrLCBjbHM7XG5cbiAgICAgICAgICAgIGlmICghJC5pc1BsYWluT2JqZWN0KG9wdGlvbnMpKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IGFyZ3NbNF07XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBhcmdzWzFdO1xuICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBhcmdzWzJdO1xuICAgICAgICAgICAgICAgIGNscyA9IGFyZ3NbM107XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG8gPSAkLmV4dGVuZCh7fSwgVG9hc3REZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcblxuICAgICAgICAgICAgdG9hc3QgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJ0b2FzdFwiKS5odG1sKG1lc3NhZ2UpLmFwcGVuZFRvKCQoXCJib2R5XCIpKTtcbiAgICAgICAgICAgIHdpZHRoID0gdG9hc3Qub3V0ZXJXaWR0aCgpO1xuICAgICAgICAgICAgdG9hc3QuaGlkZSgpO1xuXG4gICAgICAgICAgICB0aW1lb3V0ID0gdGltZW91dCB8fCBvLnRpbWVvdXQ7XG4gICAgICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IG8uY2FsbGJhY2s7XG4gICAgICAgICAgICBjbHMgPSBjbHMgfHwgby5jbHNUb2FzdDtcblxuICAgICAgICAgICAgaWYgKG8uc2hvd1RvcCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRvYXN0LmFkZENsYXNzKFwic2hvdy10b3BcIikuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBvLmRpc3RhbmNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRvYXN0LmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIGJvdHRvbTogby5kaXN0YW5jZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRvYXN0XG4gICAgICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICdsZWZ0JzogJzUwJScsXG4gICAgICAgICAgICAgICAgICAgICdtYXJnaW4tbGVmdCc6IC0od2lkdGggLyAyKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKG8uY2xzVG9hc3QpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKGNscylcbiAgICAgICAgICAgICAgICAuZmFkZUluKE1FVFJPX0FOSU1BVElPTl9EVVJBVElPTiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgVG9hc3QucmVtb3ZlKHRvYXN0LCBjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgICAgIH0sIHRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZTogZnVuY3Rpb24odG9hc3QsIGNiKXtcbiAgICAgICAgICAgIGlmICghdG9hc3QpIHJldHVybiA7XG5cbiAgICAgICAgICAgIHRvYXN0LmZhZGVPdXQoTUVUUk9fQU5JTUFUSU9OX0RVUkFUSU9OLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRvYXN0LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIFV0aWxzLmV4ZWMoY2IsIG51bGwsIHRvYXN0WzBdKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIE1ldHJvWyd0b2FzdCddID0gVG9hc3Q7XG4gICAgTWV0cm9bJ2NyZWF0ZVRvYXN0J10gPSBUb2FzdC5jcmVhdGU7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBUb2tlbml6ZXJEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICB0ZXh0VG9Ub2tlbml6ZTogXCJcIixcbiAgICAgICAgc3BhY2VTeW1ib2w6IFwiXCIsXG4gICAgICAgIHNwYWNlQ2xhc3M6IFwic3BhY2VcIixcbiAgICAgICAgdG9rZW5DbGFzczogXCJcIixcbiAgICAgICAgc3BsaXR0ZXI6IFwiXCIsXG4gICAgICAgIHRva2VuRWxlbWVudDogXCJzcGFuXCIsXG4gICAgICAgIHVzZVRva2VuU3ltYm9sOiB0cnVlLFxuICAgICAgICB1c2VUb2tlbkluZGV4OiB0cnVlLFxuICAgICAgICBjbHNUb2tlbml6ZXI6IFwiXCIsXG4gICAgICAgIGNsc1Rva2VuOiBcIlwiLFxuICAgICAgICBjbHNUb2tlbk9kZDogXCJcIixcbiAgICAgICAgY2xzVG9rZW5FdmVuOiBcIlwiLFxuICAgICAgICBvblRva2VuQ3JlYXRlOiBNZXRyby5ub29wLFxuICAgICAgICBvblRva2VuaXplOiBNZXRyby5ub29wLFxuICAgICAgICBvblRva2VuaXplckNyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby50b2tlbml6ZXJTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIFRva2VuaXplckRlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgVG9rZW5pemVyRGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9Ub2tlbml6ZXJTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLnRva2VuaXplclNldHVwKHdpbmRvd1tcIm1ldHJvVG9rZW5pemVyU2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgndG9rZW5pemVyJywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIFRva2VuaXplckRlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICAvLyBkZWZpbmUgaW5zdGFuY2UgdmFycyBoZXJlXG4gICAgICAgICAgICAgICAgb3JpZ2luYWxUZXh0OiBcIlwiXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxUZXh0ID0gby50ZXh0VG9Ub2tlbml6ZSA/IG8udGV4dFRvVG9rZW5pemUudHJpbSgpIDogZWxlbWVudC50ZXh0KCkudHJpbSgpLnJlcGxhY2UoL1tcXHJcXG5cXHRdL2dpLCAnJykucmVwbGFjZSgvXFxzXFxzKy9nLCBcIiBcIik7XG5cbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVN0cnVjdHVyZSgpO1xuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KCd0b2tlbml6ZXItY3JlYXRlJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3Rva2VuaXplOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gMCwgYXBwZW5kLCBwcmVwZW5kO1xuXG4gICAgICAgICAgICBlbGVtZW50LmNsZWFyKCkuYXR0cihcImFyaWEtbGFiZWxcIiwgdGhpcy5vcmlnaW5hbFRleHQpO1xuXG4gICAgICAgICAgICAkLmVhY2godGhpcy5vcmlnaW5hbFRleHQuc3BsaXQoby5zcGxpdHRlciksIGZ1bmN0aW9uKGkpe1xuICAgICAgICAgICAgICAgIHZhciBzeW1ib2wgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHZhciBpc1NwYWNlID0gc3ltYm9sID09PSBcIiBcIjtcbiAgICAgICAgICAgICAgICB2YXIgdG9rZW47XG5cbiAgICAgICAgICAgICAgICB0b2tlbiA9ICQoXCI8XCIrby50b2tlbkVsZW1lbnQrXCI+XCIpXG4gICAgICAgICAgICAgICAgICAgIC5odG1sKGlzU3BhY2UgPyBvLnNwYWNlU3ltYm9sIDogc3ltYm9sKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImFyaWEtaGlkZGVuXCIsIHRydWUpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhpc1NwYWNlID8gby5zcGFjZUNsYXNzIDogXCJcIilcbiAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKGlzU3BhY2UgJiYgby51c2VUb2tlblN5bWJvbCA/IFwiXCIgOiBcInRzLVwiK3N5bWJvbC5yZXBsYWNlKFwiIFwiLCBcIl9cIikpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhpc1NwYWNlICYmIG8udXNlVG9rZW5JbmRleCA/IFwiXCIgOiBcInRpLVwiICsgKGkgKyAxKSlcbiAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKG8udG9rZW5DbGFzcyA/IG8udG9rZW5DbGFzcyA6IFwiXCIpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyghaXNTcGFjZSA/IG8uY2xzVG9rZW4gOiBcIlwiKTtcblxuICAgICAgICAgICAgICAgIGlmICghaXNTcGFjZSkge1xuICAgICAgICAgICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICAgICAgICAgICAgICB0b2tlbi5hZGRDbGFzcyhpbmRleCAlIDIgPT09IDAgPyBcInRlLWV2ZW5cIiA6IFwidGUtb2RkXCIpO1xuICAgICAgICAgICAgICAgICAgICB0b2tlbi5hZGRDbGFzcyhpbmRleCAlIDIgPT09IDAgPyBvLmNsc1Rva2VuRXZlbiA6IG8uY2xzVG9rZW5PZGQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChvLnByZXBlbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJlcGVuZCA9ICQuaXNTZWxlY3RvcihvLnByZXBlbmQpID8gJChvLnByZXBlbmQpIDogJChcIjxzcGFuPlwiKS5odG1sKG8ucHJlcGVuZCk7XG4gICAgICAgICAgICAgICAgICAgIHRva2VuLnByZXBlbmQocHJlcGVuZCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG8uYXBwZW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcGVuZCA9ICQuaXNTZWxlY3RvcihvLmFwcGVuZCkgPyAkKG8uYXBwZW5kKSA6ICQoXCI8c3Bhbj5cIikuaHRtbChvLmFwcGVuZCk7XG4gICAgICAgICAgICAgICAgICAgIHRva2VuLmFwcGVuZChhcHBlbmQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kKHRva2VuKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInRva2VuLWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHRva2VuOiB0b2tlblswXVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInRva2VuaXplXCIsIHtcbiAgICAgICAgICAgICAgICB0b2tlbnM6IGVsZW1lbnQuY2hpbGRyZW4oKS5pdGVtcygpLFxuICAgICAgICAgICAgICAgIG9yaWdpbmFsVGV4dDogdGhpcy5vcmlnaW5hbFRleHRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKG8uY2xzVG9rZW5pemVyKTtcbiAgICAgICAgICAgIHRoaXMuX3Rva2VuaXplKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9rZW5pemU6IGZ1bmN0aW9uKHYpe1xuICAgICAgICAgICAgdGhpcy5vcmlnaW5hbFRleHQgPSB2O1xuICAgICAgICAgICAgdGhpcy5fdG9rZW5pemUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgVG91Y2hDb25zdCA9IHtcbiAgICAgICAgTEVGVCA6IFwibGVmdFwiLFxuICAgICAgICBSSUdIVCA6IFwicmlnaHRcIixcbiAgICAgICAgVVAgOiBcInVwXCIsXG4gICAgICAgIERPV04gOiBcImRvd25cIixcbiAgICAgICAgSU4gOiBcImluXCIsXG4gICAgICAgIE9VVCA6IFwib3V0XCIsXG4gICAgICAgIE5PTkUgOiBcIm5vbmVcIixcbiAgICAgICAgQVVUTyA6IFwiYXV0b1wiLFxuICAgICAgICBTV0lQRSA6IFwic3dpcGVcIixcbiAgICAgICAgUElOQ0ggOiBcInBpbmNoXCIsXG4gICAgICAgIFRBUCA6IFwidGFwXCIsXG4gICAgICAgIERPVUJMRV9UQVAgOiBcImRvdWJsZXRhcFwiLFxuICAgICAgICBMT05HX1RBUCA6IFwibG9uZ3RhcFwiLFxuICAgICAgICBIT0xEIDogXCJob2xkXCIsXG4gICAgICAgIEhPUklaT05UQUwgOiBcImhvcml6b250YWxcIixcbiAgICAgICAgVkVSVElDQUwgOiBcInZlcnRpY2FsXCIsXG4gICAgICAgIEFMTF9GSU5HRVJTIDogXCJhbGxcIixcbiAgICAgICAgRE9VQkxFX1RBUF9USFJFU0hPTEQgOiAxMCxcbiAgICAgICAgUEhBU0VfU1RBUlQgOiBcInN0YXJ0XCIsXG4gICAgICAgIFBIQVNFX01PVkUgOiBcIm1vdmVcIixcbiAgICAgICAgUEhBU0VfRU5EIDogXCJlbmRcIixcbiAgICAgICAgUEhBU0VfQ0FOQ0VMIDogXCJjYW5jZWxcIixcbiAgICAgICAgU1VQUE9SVFNfVE9VQ0ggOiAnb250b3VjaHN0YXJ0JyBpbiB3aW5kb3csXG4gICAgICAgIFNVUFBPUlRTX1BPSU5URVJfSUUxMCA6IHdpbmRvdy5uYXZpZ2F0b3IubXNQb2ludGVyRW5hYmxlZCAmJiAhd2luZG93Lm5hdmlnYXRvci5wb2ludGVyRW5hYmxlZCAmJiAhKCdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdyksXG4gICAgICAgIFNVUFBPUlRTX1BPSU5URVIgOiAod2luZG93Lm5hdmlnYXRvci5wb2ludGVyRW5hYmxlZCB8fCB3aW5kb3cubmF2aWdhdG9yLm1zUG9pbnRlckVuYWJsZWQpICYmICEoJ29udG91Y2hzdGFydCcgaW4gd2luZG93KSxcbiAgICAgICAgSU5fVE9VQ0g6IFwiaW50b3VjaFwiXG4gICAgfTtcblxuICAgIHZhciBUb3VjaERlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIHRvdWNoRGVmZXJyZWQ6IDAsXG4gICAgICAgIGZpbmdlcnM6IDEsXG4gICAgICAgIHRocmVzaG9sZDogNzUsXG4gICAgICAgIGNhbmNlbFRocmVzaG9sZDogbnVsbCxcbiAgICAgICAgcGluY2hUaHJlc2hvbGQ6IDIwLFxuICAgICAgICBtYXhUaW1lVGhyZXNob2xkOiBudWxsLFxuICAgICAgICBmaW5nZXJSZWxlYXNlVGhyZXNob2xkOiAyNTAsXG4gICAgICAgIGxvbmdUYXBUaHJlc2hvbGQ6IDUwMCxcbiAgICAgICAgZG91YmxlVGFwVGhyZXNob2xkOiAyMDAsXG4gICAgICAgIHRyaWdnZXJPblRvdWNoRW5kOiB0cnVlLFxuICAgICAgICB0cmlnZ2VyT25Ub3VjaExlYXZlOiBmYWxzZSxcbiAgICAgICAgYWxsb3dQYWdlU2Nyb2xsOiBcImF1dG9cIixcbiAgICAgICAgZmFsbGJhY2tUb01vdXNlRXZlbnRzOiB0cnVlLFxuICAgICAgICBleGNsdWRlZEVsZW1lbnRzOiBcIi5uby1zd2lwZVwiLFxuICAgICAgICBwcmV2ZW50RGVmYXVsdEV2ZW50czogdHJ1ZSxcblxuICAgICAgICBvblN3aXBlOiBNZXRyby5ub29wLFxuICAgICAgICBvblN3aXBlTGVmdDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Td2lwZVJpZ2h0OiBNZXRyby5ub29wLFxuICAgICAgICBvblN3aXBlVXA6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uU3dpcGVEb3duOiBNZXRyby5ub29wLFxuICAgICAgICBvblN3aXBlU3RhdHVzOiBNZXRyby5ub29wX3RydWUsIC8vIHBhcmFtczogcGhhc2UsIGRpcmVjdGlvbiwgZGlzdGFuY2UsIGR1cmF0aW9uLCBmaW5nZXJDb3VudCwgZmluZ2VyRGF0YSwgY3VycmVudERpcmVjdGlvblxuICAgICAgICBvblBpbmNoSW46IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uUGluY2hPdXQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uUGluY2hTdGF0dXM6IE1ldHJvLm5vb3BfdHJ1ZSxcbiAgICAgICAgb25UYXA6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uRG91YmxlVGFwOiBNZXRyby5ub29wLFxuICAgICAgICBvbkxvbmdUYXA6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uSG9sZDogTWV0cm8ubm9vcCxcblxuICAgICAgICBvblRvdWNoQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLnRvdWNoU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBUb3VjaERlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgVG91Y2hEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb1RvdWNoU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby50b3VjaFNldHVwKHdpbmRvd1tcIm1ldHJvVG91Y2hTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCd0b3VjaCcsIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBUb3VjaERlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICB1c2VUb3VjaEV2ZW50czogbnVsbCxcbiAgICAgICAgICAgICAgICBTVEFSVF9FVjogbnVsbCxcbiAgICAgICAgICAgICAgICBNT1ZFX0VWOiBudWxsLFxuICAgICAgICAgICAgICAgIEVORF9FVjogbnVsbCxcbiAgICAgICAgICAgICAgICBMRUFWRV9FVjogbnVsbCxcbiAgICAgICAgICAgICAgICBDQU5DRUxfRVY6IG51bGwsXG5cbiAgICAgICAgICAgICAgICBkaXN0YW5jZTogMCxcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb246IG51bGwsXG4gICAgICAgICAgICAgICAgY3VycmVudERpcmVjdGlvbjogbnVsbCxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMCxcbiAgICAgICAgICAgICAgICBzdGFydFRvdWNoZXNEaXN0YW5jZTogMCxcbiAgICAgICAgICAgICAgICBlbmRUb3VjaGVzRGlzdGFuY2U6IDAsXG4gICAgICAgICAgICAgICAgcGluY2hab29tOiAxLFxuICAgICAgICAgICAgICAgIHBpbmNoRGlzdGFuY2U6IDAsXG4gICAgICAgICAgICAgICAgcGluY2hEaXJlY3Rpb246IDAsXG4gICAgICAgICAgICAgICAgbWF4aW11bXNNYXA6IG51bGwsXG5cbiAgICAgICAgICAgICAgICBwaGFzZTogXCJzdGFydFwiLFxuXG4gICAgICAgICAgICAgICAgZmluZ2VyQ291bnQ6IDAsXG5cbiAgICAgICAgICAgICAgICBmaW5nZXJEYXRhOiB7fSxcblxuICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogMCxcbiAgICAgICAgICAgICAgICBlbmRUaW1lOiAwLFxuICAgICAgICAgICAgICAgIHByZXZpb3VzVG91Y2hFbmRUaW1lOiAwLFxuICAgICAgICAgICAgICAgIGZpbmdlckNvdW50QXRSZWxlYXNlOiAwLFxuICAgICAgICAgICAgICAgIGRvdWJsZVRhcFN0YXJ0VGltZTogMCxcblxuICAgICAgICAgICAgICAgIHNpbmdsZVRhcFRpbWVvdXQ6IG51bGwsXG4gICAgICAgICAgICAgICAgaG9sZFRpbWVvdXQ6IG51bGxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICB0aGlzLnVzZVRvdWNoRXZlbnRzID0gKFRvdWNoQ29uc3QuU1VQUE9SVFNfVE9VQ0ggfHwgVG91Y2hDb25zdC5TVVBQT1JUU19QT0lOVEVSIHx8ICF0aGlzLm9wdGlvbnMuZmFsbGJhY2tUb01vdXNlRXZlbnRzKTtcbiAgICAgICAgICAgIHRoaXMuU1RBUlRfRVYgPSB0aGlzLnVzZVRvdWNoRXZlbnRzID8gKFRvdWNoQ29uc3QuU1VQUE9SVFNfUE9JTlRFUiA/IChUb3VjaENvbnN0LlNVUFBPUlRTX1BPSU5URVJfSUUxMCA/ICdNU1BvaW50ZXJEb3duJyA6ICdwb2ludGVyZG93bicpIDogJ3RvdWNoc3RhcnQnKSA6ICdtb3VzZWRvd24nO1xuICAgICAgICAgICAgdGhpcy5NT1ZFX0VWID0gdGhpcy51c2VUb3VjaEV2ZW50cyA/IChUb3VjaENvbnN0LlNVUFBPUlRTX1BPSU5URVIgPyAoVG91Y2hDb25zdC5TVVBQT1JUU19QT0lOVEVSX0lFMTAgPyAnTVNQb2ludGVyTW92ZScgOiAncG9pbnRlcm1vdmUnKSA6ICd0b3VjaG1vdmUnKSA6ICdtb3VzZW1vdmUnO1xuICAgICAgICAgICAgdGhpcy5FTkRfRVYgPSB0aGlzLnVzZVRvdWNoRXZlbnRzID8gKFRvdWNoQ29uc3QuU1VQUE9SVFNfUE9JTlRFUiA/IChUb3VjaENvbnN0LlNVUFBPUlRTX1BPSU5URVJfSUUxMCA/ICdNU1BvaW50ZXJVcCcgOiAncG9pbnRlcnVwJykgOiAndG91Y2hlbmQnKSA6ICdtb3VzZXVwJztcbiAgICAgICAgICAgIHRoaXMuTEVBVkVfRVYgPSB0aGlzLnVzZVRvdWNoRXZlbnRzID8gKFRvdWNoQ29uc3QuU1VQUE9SVFNfUE9JTlRFUiA/ICdtb3VzZWxlYXZlJyA6IG51bGwpIDogJ21vdXNlbGVhdmUnOyAvL3dlIG1hbnVhbGx5IGRldGVjdCBsZWF2ZSBvbiB0b3VjaCBkZXZpY2VzLCBzbyBudWxsIGV2ZW50IGhlcmVcbiAgICAgICAgICAgIHRoaXMuQ0FOQ0VMX0VWID0gKFRvdWNoQ29uc3QuU1VQUE9SVFNfUE9JTlRFUiA/IChUb3VjaENvbnN0LlNVUFBPUlRTX1BPSU5URVJfSUUxMCA/ICdNU1BvaW50ZXJDYW5jZWwnIDogJ3BvaW50ZXJjYW5jZWwnKSA6ICd0b3VjaGNhbmNlbCcpO1xuXG4gICAgICAgICAgICBpZiAoby5hbGxvd1BhZ2VTY3JvbGwgPT09IHVuZGVmaW5lZCAmJiAoby5vblN3aXBlICE9PSBNZXRyby5ub29wIHx8IG8ub25Td2lwZVN0YXR1cyAhPT0gTWV0cm8ubm9vcCkpIHtcbiAgICAgICAgICAgICAgICBvLmFsbG93UGFnZVNjcm9sbCA9IFRvdWNoQ29uc3QuTk9ORTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uKHRoaXMuU1RBUlRfRVYsICQucHJveHkodGhpcy50b3VjaFN0YXJ0LCB0aGF0KSk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5vbih0aGlzLkNBTkNFTF9FViwgJC5wcm94eSh0aGlzLnRvdWNoQ2FuY2VsLCB0aGF0KSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFdmVudHMgbm90IHN1cHBvcnRlZCAnICsgdGhpcy5TVEFSVF9FViArICcsJyArIHRoaXMuQ0FOQ0VMX0VWICsgJyBvbiBTd2lwZScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJ0b3VjaC1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvdWNoU3RhcnQ6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICAvL0lmIHdlIGFscmVhZHkgaW4gYSB0b3VjaCBldmVudCAoYSBmaW5nZXIgYWxyZWFkeSBpbiB1c2UpIHRoZW4gaWdub3JlIHN1YnNlcXVlbnQgb25lcy4uXG4gICAgICAgICAgICBpZiAodGhpcy5nZXRUb3VjaEluUHJvZ3Jlc3MoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9DaGVjayBpZiB0aGlzIGVsZW1lbnQgbWF0Y2hlcyBhbnkgaW4gdGhlIGV4Y2x1ZGVkIGVsZW1lbnRzIHNlbGVjdG9ycywgIG9yIGl0cyBwYXJlbnQgaXMgZXhjbHVkZWQsIGlmIHNvLCBET04nVCBzd2lwZVxuICAgICAgICAgICAgaWYgKCQoZS50YXJnZXQpLmNsb3Nlc3Qob3B0aW9ucy5leGNsdWRlZEVsZW1lbnRzKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL0FzIHdlIHVzZSBKcXVlcnkgYmluZCBmb3IgZXZlbnRzLCB3ZSBuZWVkIHRvIHRhcmdldCB0aGUgb3JpZ2luYWwgZXZlbnQgb2JqZWN0XG4gICAgICAgICAgICAvL0lmIHRoZXNlIGV2ZW50cyBhcmUgYmVpbmcgcHJvZ3JhbW1hdGljYWxseSB0cmlnZ2VyZWQsIHdlIGRvbid0IGhhdmUgYW4gb3JpZ2luYWwgZXZlbnQgb2JqZWN0LCBzbyB1c2UgdGhlIEpxIG9uZS5cbiAgICAgICAgICAgIHZhciBldmVudCA9IGU7XG5cbiAgICAgICAgICAgIHZhciByZXQsXG4gICAgICAgICAgICAgICAgdG91Y2hlcyA9IGV2ZW50LnRvdWNoZXMsXG4gICAgICAgICAgICAgICAgZXZ0ID0gdG91Y2hlcyA/IHRvdWNoZXNbMF0gOiBldmVudDtcblxuICAgICAgICAgICAgdGhpcy5waGFzZSA9IFRvdWNoQ29uc3QuUEhBU0VfU1RBUlQ7XG5cbiAgICAgICAgICAgIC8vSWYgd2Ugc3VwcG9ydCB0b3VjaGVzLCBnZXQgdGhlIGZpbmdlciBjb3VudFxuICAgICAgICAgICAgaWYgKHRvdWNoZXMpIHtcbiAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIHRvdGFsIG51bWJlciBvZiBmaW5nZXJzIHRvdWNoaW5nIHRoZSBzY3JlZW5cbiAgICAgICAgICAgICAgICB0aGlzLmZpbmdlckNvdW50ID0gdG91Y2hlcy5sZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL0Vsc2UgdGhpcyBpcyB0aGUgZGVza3RvcCwgc28gc3RvcCB0aGUgYnJvd3NlciBmcm9tIGRyYWdnaW5nIGNvbnRlbnRcbiAgICAgICAgICAgIGVsc2UgaWYgKG9wdGlvbnMucHJldmVudERlZmF1bHRFdmVudHMgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOyAvL2NhbGwgdGhpcyBvbiBqcSBldmVudCBzbyB3ZSBhcmUgY3Jvc3MgYnJvd3NlclxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL2NsZWFyIHZhcnMuLlxuICAgICAgICAgICAgdGhpcy5kaXN0YW5jZSA9IDA7XG4gICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnREaXJlY3Rpb249bnVsbDtcbiAgICAgICAgICAgIHRoaXMucGluY2hEaXJlY3Rpb24gPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5kdXJhdGlvbiA9IDA7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0VG91Y2hlc0Rpc3RhbmNlID0gMDtcbiAgICAgICAgICAgIHRoaXMuZW5kVG91Y2hlc0Rpc3RhbmNlID0gMDtcbiAgICAgICAgICAgIHRoaXMucGluY2hab29tID0gMTtcbiAgICAgICAgICAgIHRoaXMucGluY2hEaXN0YW5jZSA9IDA7XG4gICAgICAgICAgICB0aGlzLm1heGltdW1zTWFwID0gdGhpcy5jcmVhdGVNYXhpbXVtc0RhdGEoKTtcbiAgICAgICAgICAgIHRoaXMuY2FuY2VsTXVsdGlGaW5nZXJSZWxlYXNlKCk7XG5cbiAgICAgICAgICAgIC8vQ3JlYXRlIHRoZSBkZWZhdWx0IGZpbmdlciBkYXRhXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUZpbmdlckRhdGEoMCwgZXZ0KTtcblxuICAgICAgICAgICAgLy8gY2hlY2sgdGhlIG51bWJlciBvZiBmaW5nZXJzIGlzIHdoYXQgd2UgYXJlIGxvb2tpbmcgZm9yLCBvciB3ZSBhcmUgY2FwdHVyaW5nIHBpbmNoZXNcbiAgICAgICAgICAgIGlmICghdG91Y2hlcyB8fCAodGhpcy5maW5nZXJDb3VudCA9PT0gb3B0aW9ucy5maW5nZXJzIHx8IG9wdGlvbnMuZmluZ2VycyA9PT0gVG91Y2hDb25zdC5BTExfRklOR0VSUykgfHwgdGhpcy5oYXNQaW5jaGVzKCkpIHtcbiAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIGNvb3JkaW5hdGVzIG9mIHRoZSB0b3VjaFxuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRUaW1lID0gdGhpcy5nZXRUaW1lU3RhbXAoKTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZpbmdlckNvdW50ID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vS2VlcCB0cmFjayBvZiB0aGUgaW5pdGlhbCBwaW5jaCBkaXN0YW5jZSwgc28gd2UgY2FuIGNhbGN1bGF0ZSB0aGUgZGlmZiBsYXRlclxuICAgICAgICAgICAgICAgICAgICAvL1N0b3JlIHNlY29uZCBmaW5nZXIgZGF0YSBhcyBzdGFydFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZpbmdlckRhdGEoMSwgdG91Y2hlc1sxXSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRUb3VjaGVzRGlzdGFuY2UgPSB0aGlzLmVuZFRvdWNoZXNEaXN0YW5jZSA9IHRoaXMuY2FsY3VsYXRlVG91Y2hlc0Rpc3RhbmNlKHRoaXMuZmluZ2VyRGF0YVswXS5zdGFydCwgdGhpcy5maW5nZXJEYXRhWzFdLnN0YXJ0KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5vblN3aXBlU3RhdHVzICE9PSBNZXRyby5ub29wIHx8IG9wdGlvbnMub25QaW5jaFN0YXR1cyAhPT0gTWV0cm8ubm9vcCkge1xuICAgICAgICAgICAgICAgICAgICByZXQgPSB0aGlzLnRyaWdnZXJIYW5kbGVyKGV2ZW50LCB0aGlzLnBoYXNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vQSB0b3VjaCB3aXRoIG1vcmUgb3IgbGVzcyB0aGFuIHRoZSBmaW5nZXJzIHdlIGFyZSBsb29raW5nIGZvciwgc28gY2FuY2VsXG4gICAgICAgICAgICAgICAgcmV0ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vSWYgd2UgaGF2ZSBhIHJldHVybiB2YWx1ZSBmcm9tIHRoZSB1c2VycyBoYW5kbGVyLCB0aGVuIHJldHVybiBhbmQgY2FuY2VsXG4gICAgICAgICAgICBpZiAocmV0ID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSBUb3VjaENvbnN0LlBIQVNFX0NBTkNFTDtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJIYW5kbGVyKGV2ZW50LCB0aGlzLnBoYXNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5vbkhvbGQgIT09IE1ldHJvLm5vb3ApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ob2xkVGltZW91dCA9IHNldFRpbWVvdXQoJC5wcm94eShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vVHJpZ2dlciB0aGUgZXZlbnRcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudHJpZ2dlcignaG9sZCcsIFtldmVudC50YXJnZXRdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vRmlyZSB0aGUgY2FsbGJhY2tcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm9uSG9sZCAhPT0gTWV0cm8ubm9vcCkgeyAvLyBUT0RPIFJlbW92ZSB0aGlzIGlmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gVXRpbHMuZXhlYyhvcHRpb25zLm9uSG9sZCwgW2V2ZW50LCBldmVudC50YXJnZXRdLCBlbGVtZW50WzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpcmUoXCJob2xkXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6IGV2ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IGV2ZW50LnRhcmdldFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSwgb3B0aW9ucy5sb25nVGFwVGhyZXNob2xkKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLnNldFRvdWNoSW5Qcm9ncmVzcyh0cnVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG91Y2hNb3ZlOiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAvL0FzIHdlIHVzZSBKcXVlcnkgYmluZCBmb3IgZXZlbnRzLCB3ZSBuZWVkIHRvIHRhcmdldCB0aGUgb3JpZ2luYWwgZXZlbnQgb2JqZWN0XG4gICAgICAgICAgICAvL0lmIHRoZXNlIGV2ZW50cyBhcmUgYmVpbmcgcHJvZ3JhbW1hdGljYWxseSB0cmlnZ2VyZWQsIHdlIGRvbid0IGhhdmUgYW4gb3JpZ2luYWwgZXZlbnQgb2JqZWN0LCBzbyB1c2UgdGhlIEpxIG9uZS5cbiAgICAgICAgICAgIHZhciBldmVudCA9IGU7XG5cbiAgICAgICAgICAgIC8vSWYgd2UgYXJlIGVuZGluZywgY2FuY2VsbGluZywgb3Igd2l0aGluIHRoZSB0aHJlc2hvbGQgb2YgMiBmaW5nZXJzIGJlaW5nIHJlbGVhc2VkLCBkb24ndCB0cmFjayBhbnl0aGluZy4uXG4gICAgICAgICAgICBpZiAodGhpcy5waGFzZSA9PT0gVG91Y2hDb25zdC5QSEFTRV9FTkQgfHwgdGhpcy5waGFzZSA9PT0gVG91Y2hDb25zdC5QSEFTRV9DQU5DRUwgfHwgdGhpcy5pbk11bHRpRmluZ2VyUmVsZWFzZSgpKVxuICAgICAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICAgICAgdmFyIHJldCxcbiAgICAgICAgICAgICAgICB0b3VjaGVzID0gZXZlbnQudG91Y2hlcyxcbiAgICAgICAgICAgICAgICBldnQgPSB0b3VjaGVzID8gdG91Y2hlc1swXSA6IGV2ZW50O1xuXG4gICAgICAgICAgICAvL1VwZGF0ZSB0aGUgIGZpbmdlciBkYXRhXG4gICAgICAgICAgICB2YXIgY3VycmVudEZpbmdlciA9IHRoaXMudXBkYXRlRmluZ2VyRGF0YShldnQpO1xuICAgICAgICAgICAgdGhpcy5lbmRUaW1lID0gdGhpcy5nZXRUaW1lU3RhbXAoKTtcblxuICAgICAgICAgICAgaWYgKHRvdWNoZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpbmdlckNvdW50ID0gdG91Y2hlcy5sZW5ndGg7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMub25Ib2xkICE9PSBNZXRyby5ub29wKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuaG9sZFRpbWVvdXQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnBoYXNlID0gVG91Y2hDb25zdC5QSEFTRV9NT1ZFO1xuXG4gICAgICAgICAgICAvL0lmIHdlIGhhdmUgMiBmaW5nZXJzIGdldCBUb3VjaGVzIGRpc3RhbmNlIGFzIHdlbGxcbiAgICAgICAgICAgIGlmICh0aGlzLmZpbmdlckNvdW50ID09PSAyKSB7XG5cbiAgICAgICAgICAgICAgICAvL0tlZXAgdHJhY2sgb2YgdGhlIGluaXRpYWwgcGluY2ggZGlzdGFuY2UsIHNvIHdlIGNhbiBjYWxjdWxhdGUgdGhlIGRpZmYgbGF0ZXJcbiAgICAgICAgICAgICAgICAvL1dlIGRvIHRoaXMgaGVyZSBhcyB3ZWxsIGFzIHRoZSBzdGFydCBldmVudCwgaW4gY2FzZSB0aGV5IHN0YXJ0IHdpdGggMSBmaW5nZXIsIGFuZCB0aGUgcHJlc3MgMiBmaW5nZXJzXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhcnRUb3VjaGVzRGlzdGFuY2UgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy9DcmVhdGUgc2Vjb25kIGZpbmdlciBpZiB0aGlzIGlzIHRoZSBmaXJzdCB0aW1lLi4uXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRmluZ2VyRGF0YSgxLCB0b3VjaGVzWzFdKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0VG91Y2hlc0Rpc3RhbmNlID0gdGhpcy5lbmRUb3VjaGVzRGlzdGFuY2UgPSB0aGlzLmNhbGN1bGF0ZVRvdWNoZXNEaXN0YW5jZSh0aGlzLmZpbmdlckRhdGFbMF0uc3RhcnQsIHRoaXMuZmluZ2VyRGF0YVsxXS5zdGFydCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy9FbHNlIGp1c3QgdXBkYXRlIHRoZSBzZWNvbmQgZmluZ2VyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRmluZ2VyRGF0YSh0b3VjaGVzWzFdKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVuZFRvdWNoZXNEaXN0YW5jZSA9IHRoaXMuY2FsY3VsYXRlVG91Y2hlc0Rpc3RhbmNlKHRoaXMuZmluZ2VyRGF0YVswXS5lbmQsIHRoaXMuZmluZ2VyRGF0YVsxXS5lbmQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBpbmNoRGlyZWN0aW9uID0gdGhpcy5jYWxjdWxhdGVQaW5jaERpcmVjdGlvbih0aGlzLmZpbmdlckRhdGFbMF0uZW5kLCB0aGlzLmZpbmdlckRhdGFbMV0uZW5kKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLnBpbmNoWm9vbSA9IHRoaXMuY2FsY3VsYXRlUGluY2hab29tKHRoaXMuc3RhcnRUb3VjaGVzRGlzdGFuY2UsIHRoaXMuZW5kVG91Y2hlc0Rpc3RhbmNlKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBpbmNoRGlzdGFuY2UgPSBNYXRoLmFicyh0aGlzLnN0YXJ0VG91Y2hlc0Rpc3RhbmNlIC0gdGhpcy5lbmRUb3VjaGVzRGlzdGFuY2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoKHRoaXMuZmluZ2VyQ291bnQgPT09IHRoaXMub3B0aW9ucy5maW5nZXJzIHx8IHRoaXMub3B0aW9ucy5maW5nZXJzID09PSBUb3VjaENvbnN0LkFMTF9GSU5HRVJTKSB8fCAhdG91Y2hlcyB8fCB0aGlzLmhhc1BpbmNoZXMoKSkge1xuXG4gICAgICAgICAgICAgICAgLy9UaGUgb3ZlcmFsbCBkaXJlY3Rpb24gb2YgdGhlIHN3aXBlLiBGcm9tIHN0YXJ0IHRvIG5vdy5cbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IHRoaXMuY2FsY3VsYXRlRGlyZWN0aW9uKGN1cnJlbnRGaW5nZXIuc3RhcnQsIGN1cnJlbnRGaW5nZXIuZW5kKTtcblxuICAgICAgICAgICAgICAgIC8vVGhlIGltbWVkaWF0ZSBkaXJlY3Rpb24gb2YgdGhlIHN3aXBlLCBkaXJlY3Rpb24gYmV0d2VlbiB0aGUgbGFzdCBtb3ZlbWVudCBhbmQgdGhpcyBvbmUuXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RGlyZWN0aW9uID0gdGhpcy5jYWxjdWxhdGVEaXJlY3Rpb24oY3VycmVudEZpbmdlci5sYXN0LCBjdXJyZW50RmluZ2VyLmVuZCk7XG5cbiAgICAgICAgICAgICAgICAvL0NoZWNrIGlmIHdlIG5lZWQgdG8gcHJldmVudCBkZWZhdWx0IGV2ZW50IChwYWdlIHNjcm9sbCAvIHBpbmNoIHpvb20pIG9yIG5vdFxuICAgICAgICAgICAgICAgIHRoaXMudmFsaWRhdGVEZWZhdWx0RXZlbnQoZSwgdGhpcy5jdXJyZW50RGlyZWN0aW9uKTtcblxuICAgICAgICAgICAgICAgIC8vRGlzdGFuY2UgYW5kIGR1cmF0aW9uIGFyZSBhbGwgb2ZmIHRoZSBtYWluIGZpbmdlclxuICAgICAgICAgICAgICAgIHRoaXMuZGlzdGFuY2UgPSB0aGlzLmNhbGN1bGF0ZURpc3RhbmNlKGN1cnJlbnRGaW5nZXIuc3RhcnQsIGN1cnJlbnRGaW5nZXIuZW5kKTtcbiAgICAgICAgICAgICAgICB0aGlzLmR1cmF0aW9uID0gdGhpcy5jYWxjdWxhdGVEdXJhdGlvbigpO1xuXG4gICAgICAgICAgICAgICAgLy9DYWNoZSB0aGUgbWF4aW11bSBkaXN0YW5jZSB3ZSBtYWRlIGluIHRoaXMgZGlyZWN0aW9uXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRNYXhEaXN0YW5jZSh0aGlzLmRpcmVjdGlvbiwgdGhpcy5kaXN0YW5jZSk7XG5cbiAgICAgICAgICAgICAgICAvL1RyaWdnZXIgc3RhdHVzIGhhbmRsZXJcbiAgICAgICAgICAgICAgICByZXQgPSB0aGlzLnRyaWdnZXJIYW5kbGVyKGV2ZW50LCB0aGlzLnBoYXNlKTtcblxuXG4gICAgICAgICAgICAgICAgLy9JZiB3ZSB0cmlnZ2VyIGVuZCBldmVudHMgd2hlbiB0aHJlc2hvbGQgYXJlIG1ldCwgb3IgdHJpZ2dlciBldmVudHMgd2hlbiB0b3VjaCBsZWF2ZXMgZWxlbWVudFxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLnRyaWdnZXJPblRvdWNoRW5kIHx8IHRoaXMub3B0aW9ucy50cmlnZ2VyT25Ub3VjaExlYXZlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGluQm91bmRzID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICAvL0lmIGNoZWNraW5nIGlmIHdlIGxlYXZlIHRoZSBlbGVtZW50LCBydW4gdGhlIGJvdW5kcyBjaGVjayAod2UgY2FuIHVzZSB0b3VjaGxlYXZlIGFzIGl0cyBub3Qgc3VwcG9ydGVkIG9uIHdlYmtpdClcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy50cmlnZ2VyT25Ub3VjaExlYXZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYm91bmRzID0gdGhpcy5nZXRCb3VuZHModGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbkJvdW5kcyA9IHRoaXMuaXNJbkJvdW5kcyhjdXJyZW50RmluZ2VyLmVuZCwgYm91bmRzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vVHJpZ2dlciBlbmQgaGFuZGxlcyBhcyB3ZSBzd2lwZSBpZiB0aHJlc2hvbGRzIG1ldCBvciBpZiB3ZSBoYXZlIGxlZnQgdGhlIGVsZW1lbnQgaWYgdGhlIHVzZXIgaGFzIGFza2VkIHRvIGNoZWNrIHRoZXNlLi5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMudHJpZ2dlck9uVG91Y2hFbmQgJiYgaW5Cb3VuZHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSB0aGlzLmdldE5leHRQaGFzZShUb3VjaENvbnN0LlBIQVNFX01PVkUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vV2UgZW5kIGlmIG91dCBvZiBib3VuZHMgaGVyZSwgc28gc2V0IGN1cnJlbnQgcGhhc2UgdG8gRU5ELCBhbmQgY2hlY2sgaWYgaXRzIG1vZGlmaWVkXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMub3B0aW9ucy50cmlnZ2VyT25Ub3VjaExlYXZlICYmICFpbkJvdW5kcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IHRoaXMuZ2V0TmV4dFBoYXNlKFRvdWNoQ29uc3QuUEhBU0VfRU5EKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBoYXNlID09PSBUb3VjaENvbnN0LlBIQVNFX0NBTkNFTCB8fCB0aGlzLnBoYXNlID09PSBUb3VjaENvbnN0LlBIQVNFX0VORCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VySGFuZGxlcihldmVudCwgdGhpcy5waGFzZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSBUb3VjaENvbnN0LlBIQVNFX0NBTkNFTDtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJIYW5kbGVyKGV2ZW50LCB0aGlzLnBoYXNlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHJldCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gVG91Y2hDb25zdC5QSEFTRV9DQU5DRUw7XG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VySGFuZGxlcihldmVudCwgdGhpcy5waGFzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG91Y2hFbmQ6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIC8vQXMgd2UgdXNlIEpxdWVyeSBiaW5kIGZvciBldmVudHMsIHdlIG5lZWQgdG8gdGFyZ2V0IHRoZSBvcmlnaW5hbCBldmVudCBvYmplY3RcbiAgICAgICAgICAgIC8vSWYgdGhlc2UgZXZlbnRzIGFyZSBiZWluZyBwcm9ncmFtbWF0aWNhbGx5IHRyaWdnZXJlZCwgd2UgZG9uJ3QgaGF2ZSBhbiBvcmlnaW5hbCBldmVudCBvYmplY3QsIHNvIHVzZSB0aGUgSnEgb25lLlxuICAgICAgICAgICAgdmFyIGV2ZW50ID0gZSxcbiAgICAgICAgICAgICAgICB0b3VjaGVzID0gZXZlbnQudG91Y2hlcztcblxuICAgICAgICAgICAgLy9JZiB3ZSBhcmUgc3RpbGwgaW4gYSB0b3VjaCB3aXRoIHRoZSBkZXZpY2Ugd2FpdCBhIGZyYWN0aW9uIGFuZCBzZWUgaWYgdGhlIG90aGVyIGZpbmdlciBjb21lcyB1cFxuICAgICAgICAgICAgLy9pZiBpdCBkb2VzIHdpdGhpbiB0aGUgdGhyZXNob2xkLCB0aGVuIHdlIHRyZWF0IGl0IGFzIGEgbXVsdGkgcmVsZWFzZSwgbm90IGEgc2luZ2xlIHJlbGVhc2UgYW5kIGVuZCB0aGUgdG91Y2ggLyBzd2lwZVxuICAgICAgICAgICAgaWYgKHRvdWNoZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAodG91Y2hlcy5sZW5ndGggJiYgIXRoaXMuaW5NdWx0aUZpbmdlclJlbGVhc2UoKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0TXVsdGlGaW5nZXJSZWxlYXNlKGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0b3VjaGVzLmxlbmd0aCAmJiB0aGlzLmluTXVsdGlGaW5nZXJSZWxlYXNlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL0lmIGEgcHJldmlvdXMgZmluZ2VyIGhhcyBiZWVuIHJlbGVhc2VkLCBjaGVjayBob3cgbG9uZyBhZ28sIGlmIHdpdGhpbiB0aGUgdGhyZXNob2xkLCB0aGVuIGFzc3VtZSBpdCB3YXMgYSBtdWx0aWZpbmdlciByZWxlYXNlLlxuICAgICAgICAgICAgLy9UaGlzIGlzIHVzZWQgdG8gYWxsb3cgMiBmaW5nZXJzIHRvIHJlbGVhc2UgZnJhY3Rpb25hbGx5IGFmdGVyIGVhY2ggb3RoZXIsIHdoaWxzdCBtYWludGFpbmluZyB0aGUgZXZlbnQgYXMgY29udGFpbmluZyAyIGZpbmdlcnMsIG5vdCAxXG4gICAgICAgICAgICBpZiAodGhpcy5pbk11bHRpRmluZ2VyUmVsZWFzZSgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maW5nZXJDb3VudCA9IHRoaXMuZmluZ2VyQ291bnRBdFJlbGVhc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vU2V0IGVuZCBvZiBzd2lwZVxuICAgICAgICAgICAgdGhpcy5lbmRUaW1lID0gdGhpcy5nZXRUaW1lU3RhbXAoKTtcblxuICAgICAgICAgICAgLy9HZXQgZHVyYXRpb24gaW5jYXNlIG1vdmUgd2FzIG5ldmVyIGZpcmVkXG4gICAgICAgICAgICB0aGlzLmR1cmF0aW9uID0gdGhpcy5jYWxjdWxhdGVEdXJhdGlvbigpO1xuXG4gICAgICAgICAgICAvL0lmIHdlIHRyaWdnZXIgaGFuZGxlcnMgYXQgZW5kIG9mIHN3aXBlIE9SLCB3ZSB0cmlnZ2VyIGR1cmluZywgYnV0IHRoZXkgZGlkbnQgdHJpZ2dlciBhbmQgd2UgYXJlIHN0aWxsIGluIHRoZSBtb3ZlIHBoYXNlXG4gICAgICAgICAgICBpZiAodGhpcy5kaWRTd2lwZUJhY2tUb0NhbmNlbCgpIHx8ICF0aGlzLnZhbGlkYXRlU3dpcGVEaXN0YW5jZSgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IFRvdWNoQ29uc3QuUEhBU0VfQ0FOQ0VMO1xuICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlckhhbmRsZXIoZXZlbnQsIHRoaXMucGhhc2UpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMudHJpZ2dlck9uVG91Y2hFbmQgfHwgKHRoaXMub3B0aW9ucy50cmlnZ2VyT25Ub3VjaEVuZCA9PT0gZmFsc2UgJiYgdGhpcy5waGFzZSA9PT0gVG91Y2hDb25zdC5QSEFTRV9NT1ZFKSkge1xuICAgICAgICAgICAgICAgIC8vY2FsbCB0aGlzIG9uIGpxIGV2ZW50IHNvIHdlIGFyZSBjcm9zcyBicm93c2VyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5wcmV2ZW50RGVmYXVsdEV2ZW50cyAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gVG91Y2hDb25zdC5QSEFTRV9FTkQ7XG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VySGFuZGxlcihldmVudCwgdGhpcy5waGFzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL1NwZWNpYWwgY2FzZXMgLSBBIHRhcCBzaG91bGQgYWx3YXlzIGZpcmUgb24gdG91Y2ggZW5kIHJlZ2FyZGxlc3MsXG4gICAgICAgICAgICAvL1NvIGhlcmUgd2UgbWFudWFsbHkgdHJpZ2dlciB0aGUgdGFwIGVuZCBoYW5kbGVyIGJ5IGl0c2VsZlxuICAgICAgICAgICAgLy9XZSBkb250IHJ1biB0cmlnZ2VyIGhhbmRsZXIgYXMgaXQgd2lsbCByZS10cmlnZ2VyIGV2ZW50cyB0aGF0IG1heSBoYXZlIGZpcmVkIGFscmVhZHlcbiAgICAgICAgICAgIGVsc2UgaWYgKCF0aGlzLm9wdGlvbnMudHJpZ2dlck9uVG91Y2hFbmQgJiYgdGhpcy5oYXNUYXAoKSkge1xuICAgICAgICAgICAgICAgIC8vVHJpZ2dlciB0aGUgcGluY2ggZXZlbnRzLi4uXG4gICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IFRvdWNoQ29uc3QuUEhBU0VfRU5EO1xuICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlckhhbmRsZXJGb3JHZXN0dXJlKGV2ZW50LCB0aGlzLnBoYXNlLCBUb3VjaENvbnN0LlRBUCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucGhhc2UgPT09IFRvdWNoQ29uc3QuUEhBU0VfTU9WRSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSBUb3VjaENvbnN0LlBIQVNFX0NBTkNFTDtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJIYW5kbGVyKGV2ZW50LCB0aGlzLnBoYXNlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5zZXRUb3VjaEluUHJvZ3Jlc3MoZmFsc2UpO1xuXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfSxcblxuICAgICAgICB0b3VjaENhbmNlbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvLyByZXNldCB0aGUgdmFyaWFibGVzIGJhY2sgdG8gZGVmYXVsdCB2YWx1ZXNcbiAgICAgICAgICAgIHRoaXMuZmluZ2VyQ291bnQgPSAwO1xuICAgICAgICAgICAgdGhpcy5lbmRUaW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRUaW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRUb3VjaGVzRGlzdGFuY2UgPSAwO1xuICAgICAgICAgICAgdGhpcy5lbmRUb3VjaGVzRGlzdGFuY2UgPSAwO1xuICAgICAgICAgICAgdGhpcy5waW5jaFpvb20gPSAxO1xuXG4gICAgICAgICAgICAvL0lmIHdlIHdlcmUgaW4gcHJvZ3Jlc3Mgb2YgdHJhY2tpbmcgYSBwb3NzaWJsZSBtdWx0aSB0b3VjaCBlbmQsIHRoZW4gcmUgc2V0IGl0LlxuICAgICAgICAgICAgdGhpcy5jYW5jZWxNdWx0aUZpbmdlclJlbGVhc2UoKTtcblxuICAgICAgICAgICAgdGhpcy5zZXRUb3VjaEluUHJvZ3Jlc3MoZmFsc2UpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvdWNoTGVhdmU6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudHJpZ2dlck9uVG91Y2hMZWF2ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSB0aGlzLmdldE5leHRQaGFzZShUb3VjaENvbnN0LlBIQVNFX0VORCk7XG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VySGFuZGxlcihlLCB0aGlzLnBoYXNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBnZXROZXh0UGhhc2U6IGZ1bmN0aW9uKGN1cnJlbnRQaGFzZSkge1xuICAgICAgICAgICAgdmFyIG9wdGlvbnMgID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIG5leHRQaGFzZSA9IGN1cnJlbnRQaGFzZTtcblxuICAgICAgICAgICAgLy8gRW5zdXJlIHdlIGhhdmUgdmFsaWQgc3dpcGUgKHVuZGVyIHRpbWUgYW5kIG92ZXIgZGlzdGFuY2UgIGFuZCBjaGVjayBpZiB3ZSBhcmUgb3V0IG9mIGJvdW5kLi4uKVxuICAgICAgICAgICAgdmFyIHZhbGlkVGltZSA9IHRoaXMudmFsaWRhdGVTd2lwZVRpbWUoKTtcbiAgICAgICAgICAgIHZhciB2YWxpZERpc3RhbmNlID0gdGhpcy52YWxpZGF0ZVN3aXBlRGlzdGFuY2UoKTtcbiAgICAgICAgICAgIHZhciBkaWRDYW5jZWwgPSB0aGlzLmRpZFN3aXBlQmFja1RvQ2FuY2VsKCk7XG5cbiAgICAgICAgICAgIC8vSWYgd2UgaGF2ZSBleGNlZWRlZCBvdXIgdGltZSwgdGhlbiBjYW5jZWxcbiAgICAgICAgICAgIGlmICghdmFsaWRUaW1lIHx8IGRpZENhbmNlbCkge1xuICAgICAgICAgICAgICAgIG5leHRQaGFzZSA9IFRvdWNoQ29uc3QuUEhBU0VfQ0FOQ0VMO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9FbHNlIGlmIHdlIGFyZSBtb3ZpbmcsIGFuZCBoYXZlIHJlYWNoZWQgZGlzdGFuY2UgdGhlbiBlbmRcbiAgICAgICAgICAgIGVsc2UgaWYgKHZhbGlkRGlzdGFuY2UgJiYgY3VycmVudFBoYXNlID09PSBUb3VjaENvbnN0LlBIQVNFX01PVkUgJiYgKCFvcHRpb25zLnRyaWdnZXJPblRvdWNoRW5kIHx8IG9wdGlvbnMudHJpZ2dlck9uVG91Y2hMZWF2ZSkpIHtcbiAgICAgICAgICAgICAgICBuZXh0UGhhc2UgPSBUb3VjaENvbnN0LlBIQVNFX0VORDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vRWxzZSBpZiB3ZSBoYXZlIGVuZGVkIGJ5IGxlYXZpbmcgYW5kIGRpZG4ndCByZWFjaCBkaXN0YW5jZSwgdGhlbiBjYW5jZWxcbiAgICAgICAgICAgIGVsc2UgaWYgKCF2YWxpZERpc3RhbmNlICYmIGN1cnJlbnRQaGFzZSA9PT0gVG91Y2hDb25zdC5QSEFTRV9FTkQgJiYgb3B0aW9ucy50cmlnZ2VyT25Ub3VjaExlYXZlKSB7XG4gICAgICAgICAgICAgICAgbmV4dFBoYXNlID0gVG91Y2hDb25zdC5QSEFTRV9DQU5DRUw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBuZXh0UGhhc2U7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdHJpZ2dlckhhbmRsZXI6IGZ1bmN0aW9uKGV2ZW50LCBwaGFzZSkge1xuICAgICAgICAgICAgdmFyIHJldCxcbiAgICAgICAgICAgICAgICB0b3VjaGVzID0gZXZlbnQudG91Y2hlcztcblxuICAgICAgICAgICAgLy8gU1dJUEUgR0VTVFVSRVNcbiAgICAgICAgICAgIGlmICh0aGlzLmRpZFN3aXBlKCkgfHwgdGhpcy5oYXNTd2lwZXMoKSkge1xuICAgICAgICAgICAgICAgIHJldCA9IHRoaXMudHJpZ2dlckhhbmRsZXJGb3JHZXN0dXJlKGV2ZW50LCBwaGFzZSwgVG91Y2hDb25zdC5TV0lQRSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFBJTkNIIEdFU1RVUkVTIChpZiB0aGUgYWJvdmUgZGlkbid0IGNhbmNlbClcbiAgICAgICAgICAgIGlmICgodGhpcy5kaWRQaW5jaCgpIHx8IHRoaXMuaGFzUGluY2hlcygpKSAmJiByZXQgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgcmV0ID0gdGhpcy50cmlnZ2VySGFuZGxlckZvckdlc3R1cmUoZXZlbnQsIHBoYXNlLCBUb3VjaENvbnN0LlBJTkNIKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ0xJQ0sgLyBUQVAgKGlmIHRoZSBhYm92ZSBkaWRuJ3QgY2FuY2VsKVxuICAgICAgICAgICAgaWYgKHRoaXMuZGlkRG91YmxlVGFwKCkgJiYgcmV0ICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIC8vVHJpZ2dlciB0aGUgdGFwIGV2ZW50cy4uLlxuICAgICAgICAgICAgICAgIHJldCA9IHRoaXMudHJpZ2dlckhhbmRsZXJGb3JHZXN0dXJlKGV2ZW50LCBwaGFzZSwgVG91Y2hDb25zdC5ET1VCTEVfVEFQKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ0xJQ0sgLyBUQVAgKGlmIHRoZSBhYm92ZSBkaWRuJ3QgY2FuY2VsKVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5kaWRMb25nVGFwKCkgJiYgcmV0ICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIC8vVHJpZ2dlciB0aGUgdGFwIGV2ZW50cy4uLlxuICAgICAgICAgICAgICAgIHJldCA9IHRoaXMudHJpZ2dlckhhbmRsZXJGb3JHZXN0dXJlKGV2ZW50LCBwaGFzZSwgVG91Y2hDb25zdC5MT05HX1RBUCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENMSUNLIC8gVEFQIChpZiB0aGUgYWJvdmUgZGlkbid0IGNhbmNlbClcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuZGlkVGFwKCkgJiYgcmV0ICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIC8vVHJpZ2dlciB0aGUgdGFwIGV2ZW50Li5cbiAgICAgICAgICAgICAgICByZXQgPSB0aGlzLnRyaWdnZXJIYW5kbGVyRm9yR2VzdHVyZShldmVudCwgcGhhc2UsIFRvdWNoQ29uc3QuVEFQKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gSWYgd2UgYXJlIGNhbmNlbGxpbmcgdGhlIGdlc3R1cmUsIHRoZW4gbWFudWFsbHkgdHJpZ2dlciB0aGUgcmVzZXQgaGFuZGxlclxuICAgICAgICAgICAgaWYgKHBoYXNlID09PSBUb3VjaENvbnN0LlBIQVNFX0NBTkNFTCkge1xuICAgICAgICAgICAgICAgIHRoaXMudG91Y2hDYW5jZWwoZXZlbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBJZiB3ZSBhcmUgZW5kaW5nIHRoZSBnZXN0dXJlLCB0aGVuIG1hbnVhbGx5IHRyaWdnZXIgdGhlIHJlc2V0IGhhbmRsZXIgSUYgYWxsIGZpbmdlcnMgYXJlIG9mZlxuICAgICAgICAgICAgaWYgKHBoYXNlID09PSBUb3VjaENvbnN0LlBIQVNFX0VORCkge1xuICAgICAgICAgICAgICAgIC8vSWYgd2Ugc3VwcG9ydCB0b3VjaCwgdGhlbiBjaGVjayB0aGF0IGFsbCBmaW5nZXJzIGFyZSBvZmYgYmVmb3JlIHdlIGNhbmNlbFxuICAgICAgICAgICAgICAgIGlmICh0b3VjaGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdG91Y2hlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG91Y2hDYW5jZWwoZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b3VjaENhbmNlbChldmVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICB9LFxuXG4gICAgICAgIHRyaWdnZXJIYW5kbGVyRm9yR2VzdHVyZTogZnVuY3Rpb24oZXZlbnQsIHBoYXNlLCBnZXN0dXJlKSB7XG5cbiAgICAgICAgICAgIHZhciByZXQsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIC8vU1dJUEVTLi4uLlxuICAgICAgICAgICAgaWYgKGdlc3R1cmUgPT09IFRvdWNoQ29uc3QuU1dJUEUpIHtcbiAgICAgICAgICAgICAgICAvL1RyaWdnZXIgc3RhdHVzIGV2ZXJ5IHRpbWUuLlxuICAgICAgICAgICAgICAgIGVsZW1lbnQudHJpZ2dlcignc3dpcGVTdGF0dXMnLCBbcGhhc2UsIHRoaXMuZGlyZWN0aW9uIHx8IG51bGwsIHRoaXMuZGlzdGFuY2UgfHwgMCwgdGhpcy5kdXJhdGlvbiB8fCAwLCB0aGlzLmZpbmdlckNvdW50LCB0aGlzLmZpbmdlckRhdGEsIHRoaXMuY3VycmVudERpcmVjdGlvbl0pO1xuXG4gICAgICAgICAgICAgICAgcmV0ID0gVXRpbHMuZXhlYyhvcHRpb25zLm9uU3dpcGVTdGF0dXMsIFtldmVudCwgcGhhc2UsIHRoaXMuZGlyZWN0aW9uIHx8IG51bGwsIHRoaXMuZGlzdGFuY2UgfHwgMCwgdGhpcy5kdXJhdGlvbiB8fCAwLCB0aGlzLmZpbmdlckNvdW50LCB0aGlzLmZpbmdlckRhdGEsIHRoaXMuY3VycmVudERpcmVjdGlvbl0sIGVsZW1lbnRbMF0pO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuZmlyZShcInN3aXBlc3RhdHVzXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQ6IGV2ZW50LFxuICAgICAgICAgICAgICAgICAgICBwaGFzZTogcGhhc2UsXG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogdGhpcy5kaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlOiB0aGlzLmRpc3RhbmNlLFxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogdGhpcy5kdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZmluZ2VyQ291bnQ6IHRoaXMuZmluZ2VyQ291bnQsXG4gICAgICAgICAgICAgICAgICAgIGZpbmdlckRhdGE6IHRoaXMuZmluZ2VyRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudERpcmVjdGlvbjogdGhpcy5jdXJyZW50RGlyZWN0aW9uXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKHJldCA9PT0gZmFsc2UpIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgICAgIGlmIChwaGFzZSA9PT0gVG91Y2hDb25zdC5QSEFTRV9FTkQgJiYgdGhpcy52YWxpZGF0ZVN3aXBlKCkpIHtcblxuICAgICAgICAgICAgICAgICAgICAvL0NhbmNlbCBhbnkgdGFwcyB0aGF0IHdlcmUgaW4gcHJvZ3Jlc3MuLi5cbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc2luZ2xlVGFwVGltZW91dCk7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmhvbGRUaW1lb3V0KTtcblxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnRyaWdnZXIoJ3N3aXBlJywgW3RoaXMuZGlyZWN0aW9uLCB0aGlzLmRpc3RhbmNlLCB0aGlzLmR1cmF0aW9uLCB0aGlzLmZpbmdlckNvdW50LCB0aGlzLmZpbmdlckRhdGEsIHRoaXMuY3VycmVudERpcmVjdGlvbl0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldCA9IFV0aWxzLmV4ZWMob3B0aW9ucy5vblN3aXBlLCBbZXZlbnQsIHRoaXMuZGlyZWN0aW9uLCB0aGlzLmRpc3RhbmNlLCB0aGlzLmR1cmF0aW9uLCB0aGlzLmZpbmdlckNvdW50LCB0aGlzLmZpbmdlckRhdGEsIHRoaXMuY3VycmVudERpcmVjdGlvbl0sIGVsZW1lbnRbMF0pO1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpcmUoXCJzd2lwZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudDogZXZlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246IHRoaXMuZGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2U6IHRoaXMuZGlzdGFuY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogdGhpcy5kdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmdlckNvdW50OiB0aGlzLmZpbmdlckNvdW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgZmluZ2VyRGF0YTogdGhpcy5maW5nZXJEYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudERpcmVjdGlvbjogdGhpcy5jdXJyZW50RGlyZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXQgPT09IGZhbHNlKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgLy90cmlnZ2VyIGRpcmVjdGlvbiBzcGVjaWZpYyBldmVudCBoYW5kbGVyc1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMuZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRvdWNoQ29uc3QuTEVGVDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnRyaWdnZXIoJ3N3aXBlTGVmdCcsIFt0aGlzLmRpcmVjdGlvbiwgdGhpcy5kaXN0YW5jZSwgdGhpcy5kdXJhdGlvbiwgdGhpcy5maW5nZXJDb3VudCwgdGhpcy5maW5nZXJEYXRhLCB0aGlzLmN1cnJlbnREaXJlY3Rpb25dKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBVdGlscy5leGVjKG9wdGlvbnMub25Td2lwZUxlZnQsIFtldmVudCwgdGhpcy5kaXJlY3Rpb24sIHRoaXMuZGlzdGFuY2UsIHRoaXMuZHVyYXRpb24sIHRoaXMuZmluZ2VyQ291bnQsIHRoaXMuZmluZ2VyRGF0YSwgdGhpcy5jdXJyZW50RGlyZWN0aW9uXSwgZWxlbWVudFswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maXJlKFwic3dpcGVsZWZ0XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6IGV2ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246IHRoaXMuZGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZTogdGhpcy5kaXN0YW5jZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IHRoaXMuZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmdlckNvdW50OiB0aGlzLmZpbmdlckNvdW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5nZXJEYXRhOiB0aGlzLmZpbmdlckRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnREaXJlY3Rpb246IHRoaXMuY3VycmVudERpcmVjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRvdWNoQ29uc3QuUklHSFQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC50cmlnZ2VyKCdzd2lwZVJpZ2h0JywgW3RoaXMuZGlyZWN0aW9uLCB0aGlzLmRpc3RhbmNlLCB0aGlzLmR1cmF0aW9uLCB0aGlzLmZpbmdlckNvdW50LCB0aGlzLmZpbmdlckRhdGEsIHRoaXMuY3VycmVudERpcmVjdGlvbl0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IFV0aWxzLmV4ZWMob3B0aW9ucy5vblN3aXBlUmlnaHQsIFtldmVudCwgdGhpcy5kaXJlY3Rpb24sIHRoaXMuZGlzdGFuY2UsIHRoaXMuZHVyYXRpb24sIHRoaXMuZmluZ2VyQ291bnQsIHRoaXMuZmluZ2VyRGF0YSwgdGhpcy5jdXJyZW50RGlyZWN0aW9uXSwgZWxlbWVudFswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maXJlKFwic3dpcGVyaWdodFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiB0aGlzLmRpcmVjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2U6IHRoaXMuZGlzdGFuY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiB0aGlzLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5nZXJDb3VudDogdGhpcy5maW5nZXJDb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluZ2VyRGF0YTogdGhpcy5maW5nZXJEYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50RGlyZWN0aW9uOiB0aGlzLmN1cnJlbnREaXJlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUb3VjaENvbnN0LlVQOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudHJpZ2dlcignc3dpcGVVcCcsIFt0aGlzLmRpcmVjdGlvbiwgdGhpcy5kaXN0YW5jZSwgdGhpcy5kdXJhdGlvbiwgdGhpcy5maW5nZXJDb3VudCwgdGhpcy5maW5nZXJEYXRhLCB0aGlzLmN1cnJlbnREaXJlY3Rpb25dKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBVdGlscy5leGVjKG9wdGlvbnMub25Td2lwZVVwLCBbZXZlbnQsIHRoaXMuZGlyZWN0aW9uLCB0aGlzLmRpc3RhbmNlLCB0aGlzLmR1cmF0aW9uLCB0aGlzLmZpbmdlckNvdW50LCB0aGlzLmZpbmdlckRhdGEsIHRoaXMuY3VycmVudERpcmVjdGlvbl0sIGVsZW1lbnRbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmlyZShcInN3aXBldXBcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudDogZXZlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogdGhpcy5kaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlOiB0aGlzLmRpc3RhbmNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogdGhpcy5kdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluZ2VyQ291bnQ6IHRoaXMuZmluZ2VyQ291bnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmdlckRhdGE6IHRoaXMuZmluZ2VyRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudERpcmVjdGlvbjogdGhpcy5jdXJyZW50RGlyZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVG91Y2hDb25zdC5ET1dOOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudHJpZ2dlcignc3dpcGVEb3duJywgW3RoaXMuZGlyZWN0aW9uLCB0aGlzLmRpc3RhbmNlLCB0aGlzLmR1cmF0aW9uLCB0aGlzLmZpbmdlckNvdW50LCB0aGlzLmZpbmdlckRhdGEsIHRoaXMuY3VycmVudERpcmVjdGlvbl0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IFV0aWxzLmV4ZWMob3B0aW9ucy5vblN3aXBlRG93biwgW2V2ZW50LCB0aGlzLmRpcmVjdGlvbiwgdGhpcy5kaXN0YW5jZSwgdGhpcy5kdXJhdGlvbiwgdGhpcy5maW5nZXJDb3VudCwgdGhpcy5maW5nZXJEYXRhLCB0aGlzLmN1cnJlbnREaXJlY3Rpb25dLCBlbGVtZW50WzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpcmUoXCJzd2lwZWRvd25cIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudDogZXZlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogdGhpcy5kaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlOiB0aGlzLmRpc3RhbmNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogdGhpcy5kdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluZ2VyQ291bnQ6IHRoaXMuZmluZ2VyQ291bnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmdlckRhdGE6IHRoaXMuZmluZ2VyRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudERpcmVjdGlvbjogdGhpcy5jdXJyZW50RGlyZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgLy9QSU5DSEVTLi4uLlxuICAgICAgICAgICAgaWYgKGdlc3R1cmUgPT09IFRvdWNoQ29uc3QuUElOQ0gpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnRyaWdnZXIoJ3BpbmNoU3RhdHVzJywgW3BoYXNlLCB0aGlzLnBpbmNoRGlyZWN0aW9uIHx8IG51bGwsIHRoaXMucGluY2hEaXN0YW5jZSB8fCAwLCB0aGlzLmR1cmF0aW9uIHx8IDAsIHRoaXMuZmluZ2VyQ291bnQsIHRoaXMuZmluZ2VyRGF0YSwgdGhpcy5waW5jaFpvb21dKTtcblxuICAgICAgICAgICAgICAgIHJldCA9IFV0aWxzLmV4ZWMob3B0aW9ucy5vblBpbmNoU3RhdHVzLCBbZXZlbnQsIHBoYXNlLCB0aGlzLnBpbmNoRGlyZWN0aW9uIHx8IG51bGwsIHRoaXMucGluY2hEaXN0YW5jZSB8fCAwLCB0aGlzLmR1cmF0aW9uIHx8IDAsIHRoaXMuZmluZ2VyQ291bnQsIHRoaXMuZmluZ2VyRGF0YSwgdGhpcy5waW5jaFpvb21dLCBlbGVtZW50WzBdKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmZpcmUoXCJwaW5jaHN0YXR1c1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldmVudCxcbiAgICAgICAgICAgICAgICAgICAgcGhhc2U6IHBoYXNlLFxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246IHRoaXMucGluY2hEaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlOiB0aGlzLnBpbmNoRGlzdGFuY2UsXG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiB0aGlzLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICBmaW5nZXJDb3VudDogdGhpcy5maW5nZXJDb3VudCxcbiAgICAgICAgICAgICAgICAgICAgZmluZ2VyRGF0YTogdGhpcy5maW5nZXJEYXRhLFxuICAgICAgICAgICAgICAgICAgICB6b29tOiB0aGlzLnBpbmNoWm9vbVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChyZXQgPT09IGZhbHNlKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBpZiAocGhhc2UgPT09IFRvdWNoQ29uc3QuUEhBU0VfRU5EICYmIHRoaXMudmFsaWRhdGVQaW5jaCgpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0aGlzLnBpbmNoRGlyZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRvdWNoQ29uc3QuSU46XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC50cmlnZ2VyKCdwaW5jaEluJywgW3RoaXMucGluY2hEaXJlY3Rpb24gfHwgbnVsbCwgdGhpcy5waW5jaERpc3RhbmNlIHx8IDAsIHRoaXMuZHVyYXRpb24gfHwgMCwgdGhpcy5maW5nZXJDb3VudCwgdGhpcy5maW5nZXJEYXRhLCB0aGlzLnBpbmNoWm9vbV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IFV0aWxzLmV4ZWMob3B0aW9ucy5vblBpbmNoSW4sIFtldmVudCwgdGhpcy5waW5jaERpcmVjdGlvbiB8fCBudWxsLCB0aGlzLnBpbmNoRGlzdGFuY2UgfHwgMCwgdGhpcy5kdXJhdGlvbiB8fCAwLCB0aGlzLmZpbmdlckNvdW50LCB0aGlzLmZpbmdlckRhdGEsIHRoaXMucGluY2hab29tXSwgZWxlbWVudFswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maXJlKFwicGluY2hpblwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiB0aGlzLnBpbmNoRGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZTogdGhpcy5waW5jaERpc3RhbmNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogdGhpcy5kdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluZ2VyQ291bnQ6IHRoaXMuZmluZ2VyQ291bnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmdlckRhdGE6IHRoaXMuZmluZ2VyRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgem9vbTogdGhpcy5waW5jaFpvb21cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUb3VjaENvbnN0Lk9VVDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnRyaWdnZXIoJ3BpbmNoT3V0JywgW3RoaXMucGluY2hEaXJlY3Rpb24gfHwgbnVsbCwgdGhpcy5waW5jaERpc3RhbmNlIHx8IDAsIHRoaXMuZHVyYXRpb24gfHwgMCwgdGhpcy5maW5nZXJDb3VudCwgdGhpcy5maW5nZXJEYXRhLCB0aGlzLnBpbmNoWm9vbV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IFV0aWxzLmV4ZWMob3B0aW9ucy5vblBpbmNoT3V0LCBbZXZlbnQsIHRoaXMucGluY2hEaXJlY3Rpb24gfHwgbnVsbCwgdGhpcy5waW5jaERpc3RhbmNlIHx8IDAsIHRoaXMuZHVyYXRpb24gfHwgMCwgdGhpcy5maW5nZXJDb3VudCwgdGhpcy5maW5nZXJEYXRhLCB0aGlzLnBpbmNoWm9vbV0sIGVsZW1lbnRbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmlyZShcInBpbmNob3V0XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6IGV2ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246IHRoaXMucGluY2hEaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlOiB0aGlzLnBpbmNoRGlzdGFuY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiB0aGlzLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5nZXJDb3VudDogdGhpcy5maW5nZXJDb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluZ2VyRGF0YTogdGhpcy5maW5nZXJEYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB6b29tOiB0aGlzLnBpbmNoWm9vbVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZ2VzdHVyZSA9PT0gVG91Y2hDb25zdC5UQVApIHtcbiAgICAgICAgICAgICAgICBpZiAocGhhc2UgPT09IFRvdWNoQ29uc3QuUEhBU0VfQ0FOQ0VMIHx8IHBoYXNlID09PSBUb3VjaENvbnN0LlBIQVNFX0VORCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnNpbmdsZVRhcFRpbWVvdXQpO1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5ob2xkVGltZW91dCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy9JZiB3ZSBhcmUgYWxzbyBsb29raW5nIGZvciBkb3ViZWxUYXBzLCB3YWl0IGluY2FzZSB0aGlzIGlzIG9uZS4uLlxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNEb3VibGVUYXAoKSAmJiAhdGhpcy5pbkRvdWJsZVRhcCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRvdWJsZVRhcFN0YXJ0VGltZSA9IHRoaXMuZ2V0VGltZVN0YW1wKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vTm93IHdhaXQgZm9yIHRoZSBkb3VibGUgdGFwIHRpbWVvdXQsIGFuZCB0cmlnZ2VyIHRoaXMgc2luZ2xlIHRhcFxuICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiBpdHMgbm90IGNhbmNlbGxlZCBieSBhIGRvdWJsZSB0YXBcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2luZ2xlVGFwVGltZW91dCA9IHNldFRpbWVvdXQoJC5wcm94eShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRvdWJsZVRhcFN0YXJ0VGltZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gVXRpbHMuZXhlYyhvcHRpb25zLm9uVGFwLCBbZXZlbnQsIGV2ZW50LnRhcmdldF0sIGVsZW1lbnRbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmlyZShcInRhcFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiBldmVudC50YXJnZXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpLCBvcHRpb25zLmRvdWJsZVRhcFRocmVzaG9sZCk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZG91YmxlVGFwU3RhcnRUaW1lID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IFV0aWxzLmV4ZWMob3B0aW9ucy5vblRhcCwgW2V2ZW50LCBldmVudC50YXJnZXRdLCBlbGVtZW50WzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmlyZShcInRhcFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6IGV2ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogZXZlbnQudGFyZ2V0XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZ2VzdHVyZSA9PT0gVG91Y2hDb25zdC5ET1VCTEVfVEFQKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBoYXNlID09PSBUb3VjaENvbnN0LlBIQVNFX0NBTkNFTCB8fCBwaGFzZSA9PT0gVG91Y2hDb25zdC5QSEFTRV9FTkQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc2luZ2xlVGFwVGltZW91dCk7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmhvbGRUaW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kb3VibGVUYXBTdGFydFRpbWUgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldCA9IFV0aWxzLmV4ZWMob3B0aW9ucy5vbkRvdWJsZVRhcCwgW2V2ZW50LCBldmVudC50YXJnZXRdLCBlbGVtZW50WzBdKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maXJlKFwiZG91YmxldGFwXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogZXZlbnQudGFyZ2V0XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZ2VzdHVyZSA9PT0gVG91Y2hDb25zdC5MT05HX1RBUCkge1xuICAgICAgICAgICAgICAgIGlmIChwaGFzZSA9PT0gVG91Y2hDb25zdC5QSEFTRV9DQU5DRUwgfHwgcGhhc2UgPT09IFRvdWNoQ29uc3QuUEhBU0VfRU5EKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnNpbmdsZVRhcFRpbWVvdXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRvdWJsZVRhcFN0YXJ0VGltZSA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0ID0gVXRpbHMuZXhlYyhvcHRpb25zLm9uTG9uZ1RhcCwgW2V2ZW50LCBldmVudC50YXJnZXRdLCBlbGVtZW50WzBdKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maXJlKFwibG9uZ3RhcFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudDogZXZlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IGV2ZW50LnRhcmdldFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdmFsaWRhdGVTd2lwZURpc3RhbmNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciB2YWxpZCA9IHRydWU7XG4gICAgICAgICAgICAvL0lmIHdlIG1hZGUgaXQgcGFzdCB0aGUgbWluIHN3aXBlIGRpc3RhbmNlLi5cbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudGhyZXNob2xkICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFsaWQgPSB0aGlzLmRpc3RhbmNlID49IHRoaXMub3B0aW9ucy50aHJlc2hvbGQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB2YWxpZDtcbiAgICAgICAgfSxcblxuICAgICAgICBkaWRTd2lwZUJhY2tUb0NhbmNlbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBjYW5jZWxsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmNhbmNlbFRocmVzaG9sZCAhPT0gbnVsbCAmJiB0aGlzLmRpcmVjdGlvbiAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNhbmNlbGxlZCA9ICh0aGlzLmdldE1heERpc3RhbmNlKHRoaXMuZGlyZWN0aW9uKSAtIHRoaXMuZGlzdGFuY2UpID49IG9wdGlvbnMuY2FuY2VsVGhyZXNob2xkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gY2FuY2VsbGVkO1xuICAgICAgICB9LFxuXG4gICAgICAgIHZhbGlkYXRlUGluY2hEaXN0YW5jZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnBpbmNoVGhyZXNob2xkICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGluY2hEaXN0YW5jZSA+PSB0aGlzLm9wdGlvbnMucGluY2hUaHJlc2hvbGQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSxcblxuICAgICAgICB2YWxpZGF0ZVN3aXBlVGltZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0LCBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5tYXhUaW1lVGhyZXNob2xkKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5kdXJhdGlvbiA8IG9wdGlvbnMubWF4VGltZVRocmVzaG9sZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSxcblxuICAgICAgICB2YWxpZGF0ZURlZmF1bHRFdmVudDogZnVuY3Rpb24oZSwgZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgLy9JZiB0aGUgb3B0aW9uIGlzIHNldCwgYWxsd2F5cyBhbGxvdyB0aGUgZXZlbnQgdG8gYnViYmxlIHVwIChsZXQgdXNlciBoYW5kbGUgd2VpcmRuZXNzKVxuICAgICAgICAgICAgaWYgKG9wdGlvbnMucHJldmVudERlZmF1bHRFdmVudHMgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5hbGxvd1BhZ2VTY3JvbGwgPT09IFRvdWNoQ29uc3QuTk9ORSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGF1dG8gPSBvcHRpb25zLmFsbG93UGFnZVNjcm9sbCA9PT0gVG91Y2hDb25zdC5BVVRPO1xuXG4gICAgICAgICAgICAgICAgc3dpdGNoIChkaXJlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBUb3VjaENvbnN0LkxFRlQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKG9wdGlvbnMub25Td2lwZUxlZnQgIT09IE1ldHJvLm5vb3AgJiYgYXV0bykgfHwgKCFhdXRvICYmIG9wdGlvbnMuYWxsb3dQYWdlU2Nyb2xsLnRvTG93ZXJDYXNlKCkgIT09IFRvdWNoQ29uc3QuSE9SSVpPTlRBTCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICBjYXNlIFRvdWNoQ29uc3QuUklHSFQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKG9wdGlvbnMub25Td2lwZVJpZ2h0ICE9PSBNZXRyby5ub29wICYmIGF1dG8pIHx8ICghYXV0byAmJiBvcHRpb25zLmFsbG93UGFnZVNjcm9sbC50b0xvd2VyQ2FzZSgpICE9PSBUb3VjaENvbnN0LkhPUklaT05UQUwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgY2FzZSBUb3VjaENvbnN0LlVQOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChvcHRpb25zLm9uU3dpcGVVcCAhPT0gTWV0cm8ubm9vcCAmJiBhdXRvKSB8fCAoIWF1dG8gJiYgb3B0aW9ucy5hbGxvd1BhZ2VTY3JvbGwudG9Mb3dlckNhc2UoKSAhPT0gVG91Y2hDb25zdC5WRVJUSUNBTCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICBjYXNlIFRvdWNoQ29uc3QuRE9XTjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgob3B0aW9ucy5vblN3aXBlRG93biAhPT0gTWV0cm8ubm9vcCAmJiBhdXRvKSB8fCAoIWF1dG8gJiYgb3B0aW9ucy5hbGxvd1BhZ2VTY3JvbGwudG9Mb3dlckNhc2UoKSAhPT0gVG91Y2hDb25zdC5WRVJUSUNBTCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICBjYXNlIFRvdWNoQ29uc3QuTk9ORTpcblxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHZhbGlkYXRlUGluY2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGhhc0NvcnJlY3RGaW5nZXJDb3VudCA9IHRoaXMudmFsaWRhdGVGaW5nZXJzKCk7XG4gICAgICAgICAgICB2YXIgaGFzRW5kUG9pbnQgPSB0aGlzLnZhbGlkYXRlRW5kUG9pbnQoKTtcbiAgICAgICAgICAgIHZhciBoYXNDb3JyZWN0RGlzdGFuY2UgPSB0aGlzLnZhbGlkYXRlUGluY2hEaXN0YW5jZSgpO1xuICAgICAgICAgICAgcmV0dXJuIGhhc0NvcnJlY3RGaW5nZXJDb3VudCAmJiBoYXNFbmRQb2ludCAmJiBoYXNDb3JyZWN0RGlzdGFuY2U7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGFzUGluY2hlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL0VudXJlIHdlIGRvbnQgcmV0dXJuIDAgb3IgbnVsbCBmb3IgZmFsc2UgdmFsdWVzXG4gICAgICAgICAgICByZXR1cm4gISEodGhpcy5vcHRpb25zLm9uUGluY2hTdGF0dXMgfHwgdGhpcy5vcHRpb25zLm9uUGluY2hJbiB8fCB0aGlzLm9wdGlvbnMub25QaW5jaE91dCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlkUGluY2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy9FbnVyZSB3ZSBkb250IHJldHVybiAwIG9yIG51bGwgZm9yIGZhbHNlIHZhbHVlc1xuICAgICAgICAgICAgcmV0dXJuICEhKHRoaXMudmFsaWRhdGVQaW5jaCgpICYmIHRoaXMuaGFzUGluY2hlcygpKTtcbiAgICAgICAgfSxcblxuICAgICAgICB2YWxpZGF0ZVN3aXBlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vQ2hlY2sgdmFsaWRpdHkgb2Ygc3dpcGVcbiAgICAgICAgICAgIHZhciBoYXNWYWxpZFRpbWUgPSB0aGlzLnZhbGlkYXRlU3dpcGVUaW1lKCk7XG4gICAgICAgICAgICB2YXIgaGFzVmFsaWREaXN0YW5jZSA9IHRoaXMudmFsaWRhdGVTd2lwZURpc3RhbmNlKCk7XG4gICAgICAgICAgICB2YXIgaGFzQ29ycmVjdEZpbmdlckNvdW50ID0gdGhpcy52YWxpZGF0ZUZpbmdlcnMoKTtcbiAgICAgICAgICAgIHZhciBoYXNFbmRQb2ludCA9IHRoaXMudmFsaWRhdGVFbmRQb2ludCgpO1xuICAgICAgICAgICAgdmFyIGRpZENhbmNlbCA9IHRoaXMuZGlkU3dpcGVCYWNrVG9DYW5jZWwoKTtcblxuICAgICAgICAgICAgLy8gaWYgdGhlIHVzZXIgc3dpcGVkIG1vcmUgdGhhbiB0aGUgbWluaW11bSBsZW5ndGgsIHBlcmZvcm0gdGhlIGFwcHJvcHJpYXRlIGFjdGlvblxuICAgICAgICAgICAgLy8gaGFzVmFsaWREaXN0YW5jZSBpcyBudWxsIHdoZW4gbm8gZGlzdGFuY2UgaXMgc2V0XG4gICAgICAgICAgICByZXR1cm4gIWRpZENhbmNlbCAmJiBoYXNFbmRQb2ludCAmJiBoYXNDb3JyZWN0RmluZ2VyQ291bnQgJiYgaGFzVmFsaWREaXN0YW5jZSAmJiBoYXNWYWxpZFRpbWU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGFzU3dpcGVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgLy9FbnVyZSB3ZSBkb250IHJldHVybiAwIG9yIG51bGwgZm9yIGZhbHNlIHZhbHVlc1xuICAgICAgICAgICAgcmV0dXJuICEhKFxuICAgICAgICAgICAgICAgIG8ub25Td2lwZSAhPT0gTWV0cm8ubm9vcFxuICAgICAgICAgICAgICAgIHx8IG8ub25Td2lwZVN0YXR1cyAgIT09IE1ldHJvLm5vb3BcbiAgICAgICAgICAgICAgICB8fCBvLm9uU3dpcGVMZWZ0ICAhPT0gTWV0cm8ubm9vcFxuICAgICAgICAgICAgICAgIHx8IG8ub25Td2lwZVJpZ2h0ICAhPT0gTWV0cm8ubm9vcFxuICAgICAgICAgICAgICAgIHx8IG8ub25Td2lwZVVwICAhPT0gTWV0cm8ubm9vcFxuICAgICAgICAgICAgICAgIHx8IG8ub25Td2lwZURvd24gIT09IE1ldHJvLm5vb3BcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlkU3dpcGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy9FbnVyZSB3ZSBkb250IHJldHVybiAwIG9yIG51bGwgZm9yIGZhbHNlIHZhbHVlc1xuICAgICAgICAgICAgcmV0dXJuICEhKHRoaXMudmFsaWRhdGVTd2lwZSgpICYmIHRoaXMuaGFzU3dpcGVzKCkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHZhbGlkYXRlRmluZ2VyczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL1RoZSBudW1iZXIgb2YgZmluZ2VycyB3ZSB3YW50IHdlcmUgbWF0Y2hlZCwgb3Igb24gZGVza3RvcCB3ZSBpZ25vcmVcbiAgICAgICAgICAgIHJldHVybiAoKHRoaXMuZmluZ2VyQ291bnQgPT09IHRoaXMub3B0aW9ucy5maW5nZXJzIHx8IHRoaXMub3B0aW9ucy5maW5nZXJzID09PSBUb3VjaENvbnN0LkFMTF9GSU5HRVJTKSB8fCAhVG91Y2hDb25zdC5TVVBQT1JUU19UT1VDSCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdmFsaWRhdGVFbmRQb2ludDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL1dlIGhhdmUgYW4gZW5kIHZhbHVlIGZvciB0aGUgZmluZ2VyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5maW5nZXJEYXRhWzBdLmVuZC54ICE9PSAwO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhhc1RhcDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL0VudXJlIHdlIGRvbnQgcmV0dXJuIDAgb3IgbnVsbCBmb3IgZmFsc2UgdmFsdWVzXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLm9uVGFwICE9PSBNZXRyby5ub29wO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhhc0RvdWJsZVRhcDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL0VudXJlIHdlIGRvbnQgcmV0dXJuIDAgb3IgbnVsbCBmb3IgZmFsc2UgdmFsdWVzXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLm9uRG91YmxlVGFwICE9PSBNZXRyby5ub29wO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhhc0xvbmdUYXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy9FbnVyZSB3ZSBkb250IHJldHVybiAwIG9yIG51bGwgZm9yIGZhbHNlIHZhbHVlc1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5vbkxvbmdUYXAgIT09IE1ldHJvLm5vb3A7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdmFsaWRhdGVEb3VibGVUYXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZG91YmxlVGFwU3RhcnRUaW1lID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgbm93ID0gdGhpcy5nZXRUaW1lU3RhbXAoKTtcbiAgICAgICAgICAgIHJldHVybiAodGhpcy5oYXNEb3VibGVUYXAoKSAmJiAoKG5vdyAtIHRoaXMuZG91YmxlVGFwU3RhcnRUaW1lKSA8PSB0aGlzLm9wdGlvbnMuZG91YmxlVGFwVGhyZXNob2xkKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5Eb3VibGVUYXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsaWRhdGVEb3VibGVUYXAoKTtcbiAgICAgICAgfSxcblxuICAgICAgICB2YWxpZGF0ZVRhcDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gKCh0aGlzLmZpbmdlckNvdW50ID09PSAxIHx8ICFUb3VjaENvbnN0LlNVUFBPUlRTX1RPVUNIKSAmJiAoaXNOYU4odGhpcy5kaXN0YW5jZSkgfHwgdGhpcy5kaXN0YW5jZSA8IHRoaXMub3B0aW9ucy50aHJlc2hvbGQpKTtcbiAgICAgICAgfSxcblxuICAgICAgICB2YWxpZGF0ZUxvbmdUYXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICAvL3NsaWdodCB0aHJlc2hvbGQgb24gbW92aW5nIGZpbmdlclxuICAgICAgICAgICAgcmV0dXJuICgodGhpcy5kdXJhdGlvbiA+IG9wdGlvbnMubG9uZ1RhcFRocmVzaG9sZCkgJiYgKHRoaXMuZGlzdGFuY2UgPCBUb3VjaENvbnN0LkRPVUJMRV9UQVBfVEhSRVNIT0xEKSk7IC8vIGNoZWNrIGRvdWJsZV90YWJfdGhyZXNob2xkIHdoZXJlIGZyb21cbiAgICAgICAgfSxcblxuICAgICAgICBkaWRUYXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy9FbnVyZSB3ZSBkb250IHJldHVybiAwIG9yIG51bGwgZm9yIGZhbHNlIHZhbHVlc1xuICAgICAgICAgICAgcmV0dXJuICEhKHRoaXMudmFsaWRhdGVUYXAoKSAmJiB0aGlzLmhhc1RhcCgpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkaWREb3VibGVUYXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy9FbnVyZSB3ZSBkb250IHJldHVybiAwIG9yIG51bGwgZm9yIGZhbHNlIHZhbHVlc1xuICAgICAgICAgICAgcmV0dXJuICEhKHRoaXMudmFsaWRhdGVEb3VibGVUYXAoKSAmJiB0aGlzLmhhc0RvdWJsZVRhcCgpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkaWRMb25nVGFwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vRW51cmUgd2UgZG9udCByZXR1cm4gMCBvciBudWxsIGZvciBmYWxzZSB2YWx1ZXNcbiAgICAgICAgICAgIHJldHVybiAhISh0aGlzLnZhbGlkYXRlTG9uZ1RhcCgpICYmIHRoaXMuaGFzTG9uZ1RhcCgpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzdGFydE11bHRpRmluZ2VyUmVsZWFzZTogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIHRoaXMucHJldmlvdXNUb3VjaEVuZFRpbWUgPSB0aGlzLmdldFRpbWVTdGFtcCgpO1xuICAgICAgICAgICAgdGhpcy5maW5nZXJDb3VudEF0UmVsZWFzZSA9IGV2ZW50LnRvdWNoZXMubGVuZ3RoICsgMTtcbiAgICAgICAgfSxcblxuICAgICAgICBjYW5jZWxNdWx0aUZpbmdlclJlbGVhc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5wcmV2aW91c1RvdWNoRW5kVGltZSA9IDA7XG4gICAgICAgICAgICB0aGlzLmZpbmdlckNvdW50QXRSZWxlYXNlID0gMDtcbiAgICAgICAgfSxcblxuICAgICAgICBpbk11bHRpRmluZ2VyUmVsZWFzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgd2l0aGluVGhyZXNob2xkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnByZXZpb3VzVG91Y2hFbmRUaW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRpZmYgPSB0aGlzLmdldFRpbWVTdGFtcCgpIC0gdGhpcy5wcmV2aW91c1RvdWNoRW5kVGltZTtcbiAgICAgICAgICAgICAgICBpZiAoZGlmZiA8PSB0aGlzLm9wdGlvbnMuZmluZ2VyUmVsZWFzZVRocmVzaG9sZCkge1xuICAgICAgICAgICAgICAgICAgICB3aXRoaW5UaHJlc2hvbGQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHdpdGhpblRocmVzaG9sZDtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRUb3VjaEluUHJvZ3Jlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICAvL3N0cmljdCBlcXVhbGl0eSB0byBlbnN1cmUgb25seSB0cnVlIGFuZCBmYWxzZSBhcmUgcmV0dXJuZWRcbiAgICAgICAgICAgIHJldHVybiAoZWxlbWVudC5kYXRhKCdpbnRvdWNoJykgPT09IHRydWUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldFRvdWNoSW5Qcm9ncmVzczogZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgLy9JZiBkZXN0cm95IGlzIGNhbGxlZCBpbiBhbiBldmVudCBoYW5kbGVyLCB3ZSBoYXZlIG5vIGVsLCBhbmQgd2UgaGF2ZSBhbHJlYWR5IGNsZWFuZWQgdXAsIHNvIHJldHVybi5cbiAgICAgICAgICAgIGlmKCFlbGVtZW50KSB7IHJldHVybjsgfVxuXG4gICAgICAgICAgICAvL0FkZCBvciByZW1vdmUgZXZlbnQgbGlzdGVuZXJzIGRlcGVuZGluZyBvbiB0b3VjaCBzdGF0dXNcbiAgICAgICAgICAgIGlmICh2YWwgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uKHRoaXMuTU9WRV9FViwgJC5wcm94eSh0aGlzLnRvdWNoTW92ZSwgdGhpcykpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQub24odGhpcy5FTkRfRVYsICQucHJveHkodGhpcy50b3VjaEVuZCwgdGhpcykpO1xuXG4gICAgICAgICAgICAgICAgLy93ZSBvbmx5IGhhdmUgbGVhdmUgZXZlbnRzIG9uIGRlc2t0b3AsIHdlIG1hbnVhbGx5IGNhbGN1YXRlIGxlYXZlIG9uIHRvdWNoIGFzIGl0cyBub3Qgc3VwcG9ydGVkIGluIHdlYmtpdFxuICAgICAgICAgICAgICAgIGlmICh0aGlzLkxFQVZFX0VWKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQub24odGhpcy5MRUFWRV9FViwgJC5wcm94eSh0aGlzLnRvdWNoTGVhdmUsIHRoaXMpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5vZmYodGhpcy5NT1ZFX0VWKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9mZih0aGlzLkVORF9FVik7XG5cbiAgICAgICAgICAgICAgICAvL3dlIG9ubHkgaGF2ZSBsZWF2ZSBldmVudHMgb24gZGVza3RvcCwgd2UgbWFudWFsbHkgY2FsY3VhdGUgbGVhdmUgb24gdG91Y2ggYXMgaXRzIG5vdCBzdXBwb3J0ZWQgaW4gd2Via2l0XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuTEVBVkVfRVYpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5vZmYodGhpcy5MRUFWRV9FVik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL3N0cmljdCBlcXVhbGl0eSB0byBlbnN1cmUgb25seSB0cnVlIGFuZCBmYWxzZSBjYW4gdXBkYXRlIHRoZSB2YWx1ZVxuICAgICAgICAgICAgZWxlbWVudC5kYXRhKCdpbnRvdWNoJywgdmFsID09PSB0cnVlKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjcmVhdGVGaW5nZXJEYXRhOiBmdW5jdGlvbihpZCwgZXZ0KSB7XG4gICAgICAgICAgICB2YXIgZiA9IHtcbiAgICAgICAgICAgICAgICBzdGFydDoge1xuICAgICAgICAgICAgICAgICAgICB4OiAwLFxuICAgICAgICAgICAgICAgICAgICB5OiAwXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBsYXN0OiB7XG4gICAgICAgICAgICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgICAgICAgICAgIHk6IDBcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVuZDoge1xuICAgICAgICAgICAgICAgICAgICB4OiAwLFxuICAgICAgICAgICAgICAgICAgICB5OiAwXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGYuc3RhcnQueCA9IGYubGFzdC54ID0gZi5lbmQueCA9IGV2dC5wYWdlWCB8fCBldnQuY2xpZW50WDtcbiAgICAgICAgICAgIGYuc3RhcnQueSA9IGYubGFzdC55ID0gZi5lbmQueSA9IGV2dC5wYWdlWSB8fCBldnQuY2xpZW50WTtcbiAgICAgICAgICAgIHRoaXMuZmluZ2VyRGF0YVtpZF0gPSBmO1xuICAgICAgICAgICAgcmV0dXJuIGY7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdXBkYXRlRmluZ2VyRGF0YTogZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgICAgICB2YXIgaWQgPSBldnQuaWRlbnRpZmllciAhPT0gdW5kZWZpbmVkID8gZXZ0LmlkZW50aWZpZXIgOiAwO1xuICAgICAgICAgICAgdmFyIGYgPSB0aGlzLmdldEZpbmdlckRhdGEoaWQpO1xuXG4gICAgICAgICAgICBpZiAoZiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGYgPSB0aGlzLmNyZWF0ZUZpbmdlckRhdGEoaWQsIGV2dCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGYubGFzdC54ID0gZi5lbmQueDtcbiAgICAgICAgICAgIGYubGFzdC55ID0gZi5lbmQueTtcblxuICAgICAgICAgICAgZi5lbmQueCA9IGV2dC5wYWdlWCB8fCBldnQuY2xpZW50WDtcbiAgICAgICAgICAgIGYuZW5kLnkgPSBldnQucGFnZVkgfHwgZXZ0LmNsaWVudFk7XG5cbiAgICAgICAgICAgIHJldHVybiBmO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldEZpbmdlckRhdGE6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5maW5nZXJEYXRhW2lkXSB8fCBudWxsO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldE1heERpc3RhbmNlOiBmdW5jdGlvbihkaXJlY3Rpb24sIGRpc3RhbmNlKSB7XG4gICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09PSBUb3VjaENvbnN0Lk5PTkUpIHJldHVybjtcbiAgICAgICAgICAgIGRpc3RhbmNlID0gTWF0aC5tYXgoZGlzdGFuY2UsIHRoaXMuZ2V0TWF4RGlzdGFuY2UoZGlyZWN0aW9uKSk7XG4gICAgICAgICAgICB0aGlzLm1heGltdW1zTWFwW2RpcmVjdGlvbl0uZGlzdGFuY2UgPSBkaXN0YW5jZTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRNYXhEaXN0YW5jZTogZnVuY3Rpb24oZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gKHRoaXMubWF4aW11bXNNYXBbZGlyZWN0aW9uXSkgPyB0aGlzLm1heGltdW1zTWFwW2RpcmVjdGlvbl0uZGlzdGFuY2UgOiB1bmRlZmluZWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY3JlYXRlTWF4aW11bXNEYXRhOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBtYXhEYXRhID0ge307XG4gICAgICAgICAgICBtYXhEYXRhW1RvdWNoQ29uc3QuTEVGVF0gPSB0aGlzLmNyZWF0ZU1heGltdW1WTyhUb3VjaENvbnN0LkxFRlQpO1xuICAgICAgICAgICAgbWF4RGF0YVtUb3VjaENvbnN0LlJJR0hUXSA9IHRoaXMuY3JlYXRlTWF4aW11bVZPKFRvdWNoQ29uc3QuUklHSFQpO1xuICAgICAgICAgICAgbWF4RGF0YVtUb3VjaENvbnN0LlVQXSA9IHRoaXMuY3JlYXRlTWF4aW11bVZPKFRvdWNoQ29uc3QuVVApO1xuICAgICAgICAgICAgbWF4RGF0YVtUb3VjaENvbnN0LkRPV05dID0gdGhpcy5jcmVhdGVNYXhpbXVtVk8oVG91Y2hDb25zdC5ET1dOKTtcblxuICAgICAgICAgICAgcmV0dXJuIG1heERhdGE7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY3JlYXRlTWF4aW11bVZPOiBmdW5jdGlvbihkaXIpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBkaXIsXG4gICAgICAgICAgICAgICAgZGlzdGFuY2U6IDBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjYWxjdWxhdGVEdXJhdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVuZFRpbWUgLSB0aGlzLnN0YXJ0VGltZTtcbiAgICAgICAgfSxcblxuICAgICAgICBjYWxjdWxhdGVUb3VjaGVzRGlzdGFuY2U6IGZ1bmN0aW9uKHN0YXJ0UG9pbnQsIGVuZFBvaW50KXtcbiAgICAgICAgICAgIHZhciBkaWZmWCA9IE1hdGguYWJzKHN0YXJ0UG9pbnQueCAtIGVuZFBvaW50LngpO1xuICAgICAgICAgICAgdmFyIGRpZmZZID0gTWF0aC5hYnMoc3RhcnRQb2ludC55IC0gZW5kUG9pbnQueSk7XG5cbiAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKE1hdGguc3FydChkaWZmWCAqIGRpZmZYICsgZGlmZlkgKiBkaWZmWSkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNhbGN1bGF0ZVBpbmNoWm9vbTogZnVuY3Rpb24oc3RhcnREaXN0YW5jZSwgZW5kRGlzdGFuY2Upe1xuICAgICAgICAgICAgdmFyIHBlcmNlbnQgPSAoZW5kRGlzdGFuY2UgLyBzdGFydERpc3RhbmNlKSAqIDEwMDsgLy8gMSA/IDEwMFxuICAgICAgICAgICAgcmV0dXJuIHBlcmNlbnQudG9GaXhlZCgyKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjYWxjdWxhdGVQaW5jaERpcmVjdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0aGlzLnBpbmNoWm9vbSA8IDEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gVG91Y2hDb25zdC5PVVQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBUb3VjaENvbnN0LklOO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNhbGN1bGF0ZURpc3RhbmNlOiBmdW5jdGlvbihzdGFydFBvaW50LCBlbmRQb2ludCl7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChNYXRoLnNxcnQoTWF0aC5wb3coZW5kUG9pbnQueCAtIHN0YXJ0UG9pbnQueCwgMikgKyBNYXRoLnBvdyhlbmRQb2ludC55IC0gc3RhcnRQb2ludC55LCAyKSkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNhbGN1bGF0ZUFuZ2xlOiBmdW5jdGlvbihzdGFydFBvaW50LCBlbmRQb2ludCl7XG4gICAgICAgICAgICB2YXIgeCA9IHN0YXJ0UG9pbnQueCAtIGVuZFBvaW50Lng7XG4gICAgICAgICAgICB2YXIgeSA9IGVuZFBvaW50LnkgLSBzdGFydFBvaW50Lnk7XG4gICAgICAgICAgICB2YXIgciA9IE1hdGguYXRhbjIoeSwgeCk7IC8vcmFkaWFuc1xuICAgICAgICAgICAgdmFyIGFuZ2xlID0gTWF0aC5yb3VuZChyICogMTgwIC8gTWF0aC5QSSk7IC8vZGVncmVlc1xuXG4gICAgICAgICAgICAvL2Vuc3VyZSB2YWx1ZSBpcyBwb3NpdGl2ZVxuICAgICAgICAgICAgaWYgKGFuZ2xlIDwgMCkge1xuICAgICAgICAgICAgICAgIGFuZ2xlID0gMzYwIC0gTWF0aC5hYnMoYW5nbGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gYW5nbGU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2FsY3VsYXRlRGlyZWN0aW9uOiBmdW5jdGlvbihzdGFydFBvaW50LCBlbmRQb2ludCl7XG4gICAgICAgICAgICBpZiggdGhpcy5jb21wYXJlUG9pbnRzKHN0YXJ0UG9pbnQsIGVuZFBvaW50KSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gVG91Y2hDb25zdC5OT05FO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgYW5nbGUgPSB0aGlzLmNhbGN1bGF0ZUFuZ2xlKHN0YXJ0UG9pbnQsIGVuZFBvaW50KTtcblxuICAgICAgICAgICAgaWYgKChhbmdsZSA8PSA0NSkgJiYgKGFuZ2xlID49IDApKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFRvdWNoQ29uc3QuTEVGVDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoKGFuZ2xlIDw9IDM2MCkgJiYgKGFuZ2xlID49IDMxNSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gVG91Y2hDb25zdC5MRUZUO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgoYW5nbGUgPj0gMTM1KSAmJiAoYW5nbGUgPD0gMjI1KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBUb3VjaENvbnN0LlJJR0hUO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgoYW5nbGUgPiA0NSkgJiYgKGFuZ2xlIDwgMTM1KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBUb3VjaENvbnN0LkRPV047XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBUb3VjaENvbnN0LlVQO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGdldFRpbWVTdGFtcDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiAobmV3IERhdGUoKSkuZ2V0VGltZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldEJvdW5kczogZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgICAgICBlbCA9ICQoZWwpO1xuICAgICAgICAgICAgdmFyIG9mZnNldCA9IGVsLm9mZnNldCgpO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGxlZnQ6IG9mZnNldC5sZWZ0LFxuICAgICAgICAgICAgICAgIHJpZ2h0OiBvZmZzZXQubGVmdCArIGVsLm91dGVyV2lkdGgoKSxcbiAgICAgICAgICAgICAgICB0b3A6IG9mZnNldC50b3AsXG4gICAgICAgICAgICAgICAgYm90dG9tOiBvZmZzZXQudG9wICsgZWwub3V0ZXJIZWlnaHQoKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcblxuICAgICAgICBpc0luQm91bmRzOiBmdW5jdGlvbihwb2ludCwgYm91bmRzKXtcbiAgICAgICAgICAgIHJldHVybiAocG9pbnQueCA+IGJvdW5kcy5sZWZ0ICYmIHBvaW50LnggPCBib3VuZHMucmlnaHQgJiYgcG9pbnQueSA+IGJvdW5kcy50b3AgJiYgcG9pbnQueSA8IGJvdW5kcy5ib3R0b20pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNvbXBhcmVQb2ludHM6IGZ1bmN0aW9uKHBvaW50QSwgcG9pbnRCKSB7XG4gICAgICAgICAgICByZXR1cm4gKHBvaW50QS54ID09PSBwb2ludEIueCAmJiBwb2ludEEueSA9PT0gcG9pbnRCLnkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZUxpc3RlbmVyczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgZWxlbWVudC5vZmYodGhpcy5TVEFSVF9FVik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZih0aGlzLkNBTkNFTF9FVik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZih0aGlzLk1PVkVfRVYpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYodGhpcy5FTkRfRVYpO1xuXG4gICAgICAgICAgICAvL3dlIG9ubHkgaGF2ZSBsZWF2ZSBldmVudHMgb24gZGVza3RvcCwgd2UgbWFudWFsbHkgY2FsY3VsYXRlIGxlYXZlIG9uIHRvdWNoIGFzIGl0cyBub3Qgc3VwcG9ydGVkIGluIHdlYmtpdFxuICAgICAgICAgICAgaWYgKHRoaXMuTEVBVkVfRVYpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9mZih0aGlzLkxFQVZFX0VWKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5zZXRUb3VjaEluUHJvZ3Jlc3MoZmFsc2UpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGVuYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50Lm9uKHRoaXMuU1RBUlRfRVYsIHRoaXMudG91Y2hTdGFydCk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQub24odGhpcy5DQU5DRUxfRVYsIHRoaXMudG91Y2hDYW5jZWwpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgICAgICAgfSxcblxuICAgICAgICBkaXNhYmxlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVMaXN0ZW5lcnMoKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbigpe1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZUxpc3RlbmVycygpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBNZXRyb1sndG91Y2gnXSA9IFRvdWNoQ29uc3Q7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgVHJlZVZpZXdEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICB0cmVldmlld0RlZmVycmVkOiAwLFxuICAgICAgICBzaG93Q2hpbGRDb3VudDogZmFsc2UsXG4gICAgICAgIGR1cmF0aW9uOiAxMDAsXG4gICAgICAgIG9uTm9kZUNsaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvbk5vZGVEYmxDbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25Ob2RlRGVsZXRlOiBNZXRyby5ub29wLFxuICAgICAgICBvbk5vZGVJbnNlcnQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uTm9kZUNsZWFuOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNoZWNrQ2xpY2s6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uUmFkaW9DbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25FeHBhbmROb2RlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNvbGxhcHNlTm9kZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25UcmVlVmlld0NyZWF0ZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby50cmVlVmlld1NldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgVHJlZVZpZXdEZWZhdWx0Q29uZmlnID0gJC5leHRlbmQoe30sIFRyZWVWaWV3RGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9UcmVlVmlld1NldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8udHJlZVZpZXdTZXR1cCh3aW5kb3dbXCJtZXRyb1RyZWVWaWV3U2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgndHJlZS12aWV3Jywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIFRyZWVWaWV3RGVmYXVsdENvbmZpZyk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVUcmVlKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcblxuICAgICAgICAgICAgJC5lYWNoKGVsZW1lbnQuZmluZChcImlucHV0XCIpLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmICghJCh0aGlzKS5pcyhcIjpjaGVja2VkXCIpKSByZXR1cm47XG4gICAgICAgICAgICAgICAgdGhhdC5fcmVjaGVjayh0aGlzKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJ0cmVlLXZpZXctY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlSWNvbjogZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICB2YXIgaWNvbiwgc3JjO1xuXG4gICAgICAgICAgICBzcmMgPSBVdGlscy5pc1RhZyhkYXRhKSA/ICQoZGF0YSkgOiAkKFwiPGltZyBzcmM9JycgYWx0PScnPlwiKS5hdHRyKFwic3JjXCIsIGRhdGEpO1xuICAgICAgICAgICAgaWNvbiA9ICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJpY29uXCIpO1xuICAgICAgICAgICAgaWNvbi5odG1sKHNyYy5vdXRlckhUTUwoKSk7XG5cbiAgICAgICAgICAgIHJldHVybiBpY29uO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVDYXB0aW9uOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIHJldHVybiAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwiY2FwdGlvblwiKS5odG1sKGRhdGEpO1xuICAgICAgICB9LFxuXG5cbiAgICAgICAgX2NyZWF0ZVRvZ2dsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwibm9kZS10b2dnbGVcIik7XG4gICAgICAgIH0sXG5cblxuICAgICAgICBfY3JlYXRlTm9kZTogZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICB2YXIgbm9kZTtcblxuICAgICAgICAgICAgbm9kZSA9ICQoXCI8bGk+XCIpO1xuXG4gICAgICAgICAgICBpZiAoZGF0YS5jYXB0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBub2RlLnByZXBlbmQodGhpcy5fY3JlYXRlQ2FwdGlvbihkYXRhLmNhcHRpb24pKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGRhdGEuaWNvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgbm9kZS5wcmVwZW5kKHRoaXMuX2NyZWF0ZUljb24oZGF0YS5pY29uKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkYXRhLmh0bWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIG5vZGUuYXBwZW5kKGRhdGEuaHRtbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBub2RlO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVUcmVlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIG5vZGVzID0gZWxlbWVudC5maW5kKFwibGlcIik7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJ0cmVldmlld1wiKTtcblxuICAgICAgICAgICAgJC5lYWNoKG5vZGVzLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBub2RlID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgY2FwdGlvbiwgaWNvbjtcblxuICAgICAgICAgICAgICAgIGNhcHRpb24gPSBub2RlLmRhdGEoXCJjYXB0aW9uXCIpO1xuICAgICAgICAgICAgICAgIGljb24gPSBub2RlLmRhdGEoXCJpY29uXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGNhcHRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5jaGlsZHJlbihcInVsXCIpLmxlbmd0aCA+IDAgJiYgby5zaG93Q2hpbGRDb3VudCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FwdGlvbiArPSBcIiAoXCIrbm9kZS5jaGlsZHJlbihcInVsXCIpLmNoaWxkcmVuKFwibGlcIikubGVuZ3RoK1wiKVwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbm9kZS5wcmVwZW5kKHRoYXQuX2NyZWF0ZUNhcHRpb24oY2FwdGlvbikpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChpY29uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5wcmVwZW5kKHRoYXQuX2NyZWF0ZUljb24oaWNvbikpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChub2RlLmNoaWxkcmVuKFwidWxcIikubGVuZ3RoID4gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuYWRkQ2xhc3MoXCJ0cmVlLW5vZGVcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgbm9kZS5hcHBlbmQodGhhdC5fY3JlYXRlVG9nZ2xlKCkpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChVdGlscy5ib29sKG5vZGUuYXR0cihcImRhdGEtY29sbGFwc2VkXCIpKSAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5hZGRDbGFzcyhcImV4cGFuZGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5jaGlsZHJlbihcInVsXCIpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLm5vZGUtdG9nZ2xlXCIsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIHZhciB0b2dnbGUgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIHZhciBub2RlID0gdG9nZ2xlLnBhcmVudCgpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC50b2dnbGVOb2RlKG5vZGUpO1xuXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcImxpID4gLmNhcHRpb25cIiwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgdmFyIG5vZGUgPSAkKHRoaXMpLnBhcmVudCgpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5jdXJyZW50KG5vZGUpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwibm9kZS1jbGlja1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGU6IG5vZGVbMF1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5kYmxjbGljaywgXCJsaSA+IC5jYXB0aW9uXCIsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIHZhciBub2RlID0gJCh0aGlzKS5jbG9zZXN0KFwibGlcIik7XG4gICAgICAgICAgICAgICAgdmFyIHRvZ2dsZSA9IG5vZGUuY2hpbGRyZW4oXCIubm9kZS10b2dnbGVcIik7XG4gICAgICAgICAgICAgICAgdmFyIHN1YnRyZWUgPSBub2RlLmNoaWxkcmVuKFwidWxcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAodG9nZ2xlLmxlbmd0aCA+IDAgfHwgc3VidHJlZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQudG9nZ2xlTm9kZShub2RlKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJub2RlLWRibC1jbGlja1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGU6IG5vZGVbMF1cbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcImlucHV0W3R5cGU9cmFkaW9dXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGNoZWNrID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgY2hlY2tlZCA9IGNoZWNrLmlzKFwiOmNoZWNrZWRcIik7XG4gICAgICAgICAgICAgICAgdmFyIG5vZGUgPSBjaGVjay5jbG9zZXN0KFwibGlcIik7XG5cbiAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnQobm9kZSk7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJyYWRpby1jbGlja1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ6IGNoZWNrZWQsXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrOiBjaGVja1swXSxcbiAgICAgICAgICAgICAgICAgICAgbm9kZTogbm9kZVswXVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcImlucHV0W3R5cGU9Y2hlY2tib3hdXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGNoZWNrID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgY2hlY2tlZCA9IGNoZWNrLmlzKFwiOmNoZWNrZWRcIik7XG4gICAgICAgICAgICAgICAgdmFyIG5vZGUgPSBjaGVjay5jbG9zZXN0KFwibGlcIik7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9yZWNoZWNrKGNoZWNrKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImNoZWNrLWNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tlZDogY2hlY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgY2hlY2s6IGNoZWNrWzBdLFxuICAgICAgICAgICAgICAgICAgICBub2RlOiBub2RlWzBdXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfcmVjaGVjazogZnVuY3Rpb24oY2hlY2spe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgY2hlY2tlZCwgbm9kZSwgY2hlY2tzLCBhbGxfY2hlY2tzO1xuXG4gICAgICAgICAgICBjaGVjayA9ICQoY2hlY2spO1xuXG4gICAgICAgICAgICBjaGVja2VkID0gY2hlY2suaXMoXCI6Y2hlY2tlZFwiKTtcbiAgICAgICAgICAgIG5vZGUgPSBjaGVjay5jbG9zZXN0KFwibGlcIik7XG5cbiAgICAgICAgICAgIHRoaXMuY3VycmVudChub2RlKTtcblxuICAgICAgICAgICAgLy8gZG93blxuICAgICAgICAgICAgY2hlY2tzID0gY2hlY2suY2xvc2VzdChcImxpXCIpLmZpbmQoXCJ1bCBpbnB1dFt0eXBlPWNoZWNrYm94XVwiKTtcbiAgICAgICAgICAgIGNoZWNrcy5hdHRyKFwiZGF0YS1pbmRldGVybWluYXRlXCIsIGZhbHNlKTtcbiAgICAgICAgICAgIGNoZWNrcy5wcm9wKFwiY2hlY2tlZFwiLCBjaGVja2VkKTtcbiAgICAgICAgICAgIGNoZWNrcy50cmlnZ2VyKCdjaGFuZ2UnKTtcblxuICAgICAgICAgICAgYWxsX2NoZWNrcyA9IFtdO1xuXG4gICAgICAgICAgICAkLmVhY2goZWxlbWVudC5maW5kKFwiaW5wdXRbdHlwZT1jaGVja2JveF1cIiksIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgYWxsX2NoZWNrcy5wdXNoKHRoaXMpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQuZWFjaChhbGxfY2hlY2tzLnJldmVyc2UoKSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgY2ggPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IGNoLmNsb3Nlc3QoXCJsaVwiKS5jaGlsZHJlbihcInVsXCIpLmZpbmQoXCJpbnB1dFt0eXBlPWNoZWNrYm94XVwiKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkcmVuX2NoZWNrZWQgPSBjaC5jbG9zZXN0KFwibGlcIikuY2hpbGRyZW4oXCJ1bFwiKS5maW5kKFwiaW5wdXRbdHlwZT1jaGVja2JveF1cIikuZmlsdGVyKGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsLmNoZWNrZWQ7XG4gICAgICAgICAgICAgICAgfSkubGVuZ3RoO1xuXG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkcmVuID4gMCAmJiBjaGlsZHJlbl9jaGVja2VkID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoLmF0dHIoXCJkYXRhLWluZGV0ZXJtaW5hdGVcIiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBjaC5wcm9wKFwiY2hlY2tlZFwiLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIGNoLnRyaWdnZXIoJ2NoYW5nZScpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChjaGlsZHJlbl9jaGVja2VkID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoLmF0dHIoXCJkYXRhLWluZGV0ZXJtaW5hdGVcIiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZHJlbl9jaGVja2VkID4gMCAmJiBjaGlsZHJlbiA+IGNoaWxkcmVuX2NoZWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoLmF0dHIoXCJkYXRhLWluZGV0ZXJtaW5hdGVcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hpbGRyZW4gPT09IGNoaWxkcmVuX2NoZWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoLmF0dHIoXCJkYXRhLWluZGV0ZXJtaW5hdGVcIiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2gucHJvcChcImNoZWNrZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaC50cmlnZ2VyKCdjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGN1cnJlbnQ6IGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGlmIChub2RlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5maW5kKFwibGkuY3VycmVudFwiKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoXCJsaVwiKS5yZW1vdmVDbGFzcyhcImN1cnJlbnRcIik7XG4gICAgICAgICAgICBub2RlLmFkZENsYXNzKFwiY3VycmVudFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGVOb2RlOiBmdW5jdGlvbihuKXtcbiAgICAgICAgICAgIHZhciBub2RlID0gJChuKTtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGZ1bmM7XG4gICAgICAgICAgICB2YXIgdG9CZUV4cGFuZGVkID0gIW5vZGUuZGF0YShcImNvbGxhcHNlZFwiKTsvLyFub2RlLmhhc0NsYXNzKFwiZXhwYW5kZWRcIik7XG5cbiAgICAgICAgICAgIG5vZGUudG9nZ2xlQ2xhc3MoXCJleHBhbmRlZFwiKTtcbiAgICAgICAgICAgIG5vZGUuZGF0YShcImNvbGxhcHNlZFwiLCB0b0JlRXhwYW5kZWQpO1xuXG4gICAgICAgICAgICBmdW5jID0gdG9CZUV4cGFuZGVkID09PSB0cnVlID8gXCJzbGlkZVVwXCIgOiBcInNsaWRlRG93blwiO1xuXG4gICAgICAgICAgICBpZiAoIXRvQmVFeHBhbmRlZCkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiZXhwYW5kLW5vZGVcIiwge1xuICAgICAgICAgICAgICAgICAgICBub2RlOiBub2RlWzBdXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJjb2xsYXBzZS1ub2RlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZTogbm9kZVswXVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG5vZGUuY2hpbGRyZW4oXCJ1bFwiKVtmdW5jXShvLmR1cmF0aW9uKTtcbiAgICAgICAgfSxcblxuICAgICAgICBhZGRUbzogZnVuY3Rpb24obm9kZSwgZGF0YSl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciB0YXJnZXQ7XG4gICAgICAgICAgICB2YXIgbmV3X25vZGU7XG4gICAgICAgICAgICB2YXIgdG9nZ2xlO1xuXG4gICAgICAgICAgICBpZiAobm9kZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRhcmdldCA9IGVsZW1lbnQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG5vZGUgPSAkKG5vZGUpO1xuICAgICAgICAgICAgICAgIHRhcmdldCA9IG5vZGUuY2hpbGRyZW4oXCJ1bFwiKTtcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXQgPSAkKFwiPHVsPlwiKS5hcHBlbmRUbyhub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlID0gdGhpcy5fY3JlYXRlVG9nZ2xlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRvZ2dsZS5hcHBlbmRUbyhub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5hZGRDbGFzcyhcImV4cGFuZGVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbmV3X25vZGUgPSB0aGlzLl9jcmVhdGVOb2RlKGRhdGEpO1xuXG4gICAgICAgICAgICBuZXdfbm9kZS5hcHBlbmRUbyh0YXJnZXQpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJub2RlLWluc2VydFwiLCB7XG4gICAgICAgICAgICAgICAgbm9kZTogbmV3X25vZGVbMF0sXG4gICAgICAgICAgICAgICAgcGFyZW50OiBub2RlID8gbm9kZVswXSA6IG51bGxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gbmV3X25vZGU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5zZXJ0QmVmb3JlOiBmdW5jdGlvbihub2RlLCBkYXRhKXtcbiAgICAgICAgICAgIHZhciBuZXdfbm9kZSA9IHRoaXMuX2NyZWF0ZU5vZGUoZGF0YSk7XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc051bGwobm9kZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hZGRUbyhub2RlLCBkYXRhKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbm9kZSA9ICQobm9kZSk7XG4gICAgICAgICAgICBuZXdfbm9kZS5pbnNlcnRCZWZvcmUobm9kZSk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcIm5vZGUtaW5zZXJ0XCIsIHtcbiAgICAgICAgICAgICAgICBub2RlOiBuZXdfbm9kZVswXSxcbiAgICAgICAgICAgICAgICBwYXJlbnQ6IG5vZGUgPyBub2RlWzBdIDogbnVsbFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBuZXdfbm9kZTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbnNlcnRBZnRlcjogZnVuY3Rpb24obm9kZSwgZGF0YSl7XG4gICAgICAgICAgICB2YXIgbmV3X25vZGUgPSB0aGlzLl9jcmVhdGVOb2RlKGRhdGEpO1xuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNOdWxsKG5vZGUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkVG8obm9kZSwgZGF0YSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG5vZGUgPSAkKG5vZGUpO1xuICAgICAgICAgICAgbmV3X25vZGUuaW5zZXJ0QWZ0ZXIobm9kZSk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcIm5vZGUtaW5zZXJ0XCIsIHtcbiAgICAgICAgICAgICAgICBub2RlOiBuZXdfbm9kZVswXSxcbiAgICAgICAgICAgICAgICBwYXJlbnQ6IG5vZGVbMF1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gbmV3X25vZGU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVsOiBmdW5jdGlvbihub2RlKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgICAgbm9kZSA9ICQobm9kZSk7XG4gICAgICAgICAgICB2YXIgcGFyZW50X2xpc3QgPSBub2RlLmNsb3Nlc3QoXCJ1bFwiKTtcbiAgICAgICAgICAgIHZhciBwYXJlbnRfbm9kZSA9IHBhcmVudF9saXN0LmNsb3Nlc3QoXCJsaVwiKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwibm9kZS1kZWxldGVcIiwge1xuICAgICAgICAgICAgICAgIG5vZGU6IG5vZGVbMF1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBub2RlLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICBpZiAocGFyZW50X2xpc3QuY2hpbGRyZW4oKS5sZW5ndGggPT09IDAgJiYgIXBhcmVudF9saXN0LmlzKGVsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgcGFyZW50X2xpc3QucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgcGFyZW50X25vZGUucmVtb3ZlQ2xhc3MoXCJleHBhbmRlZFwiKTtcbiAgICAgICAgICAgICAgICBwYXJlbnRfbm9kZS5jaGlsZHJlbihcIi5ub2RlLXRvZ2dsZVwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjbGVhbjogZnVuY3Rpb24obm9kZSl7XG4gICAgICAgICAgICBub2RlID0gJChub2RlKTtcbiAgICAgICAgICAgIG5vZGUuY2hpbGRyZW4oXCJ1bFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIG5vZGUucmVtb3ZlQ2xhc3MoXCJleHBhbmRlZFwiKTtcbiAgICAgICAgICAgIG5vZGUuY2hpbGRyZW4oXCIubm9kZS10b2dnbGVcIikucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcIm5vZGUtY2xlYW5cIiwge1xuICAgICAgICAgICAgICAgIG5vZGU6IG5vZGVbMF1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIubm9kZS10b2dnbGVcIik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwibGkgPiAuY2FwdGlvblwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5kYmxjbGljaywgXCJsaSA+IC5jYXB0aW9uXCIpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcImlucHV0W3R5cGU9cmFkaW9dXCIpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcImlucHV0W3R5cGU9Y2hlY2tib3hdXCIpO1xuXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgVmFsaWRhdG9yRnVuY3MgPSB7XG4gICAgICAgIHJlcXVpcmVkOiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWwubGVuZ3RoID4gMCA/IHZhbCA6IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gVXRpbHMuaXNWYWx1ZSh2YWwpID8gdmFsLnRyaW0oKSA6IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBsZW5ndGg6IGZ1bmN0aW9uKHZhbCwgbGVuKXtcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbCkpIHtyZXR1cm4gdmFsLmxlbmd0aCA9PT0gcGFyc2VJbnQobGVuKTt9XG4gICAgICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUobGVuKSB8fCBpc05hTihsZW4pIHx8IGxlbiA8PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZhbC50cmltKCkubGVuZ3RoID09PSBwYXJzZUludChsZW4pO1xuICAgICAgICB9LFxuICAgICAgICBtaW5sZW5ndGg6IGZ1bmN0aW9uKHZhbCwgbGVuKXtcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbCkpIHtyZXR1cm4gdmFsLmxlbmd0aCA+PSBwYXJzZUludChsZW4pO31cbiAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZShsZW4pIHx8IGlzTmFOKGxlbikgfHwgbGVuIDw9IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdmFsLnRyaW0oKS5sZW5ndGggPj0gcGFyc2VJbnQobGVuKTtcbiAgICAgICAgfSxcbiAgICAgICAgbWF4bGVuZ3RoOiBmdW5jdGlvbih2YWwsIGxlbil7XG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWwpKSB7cmV0dXJuIHZhbC5sZW5ndGggPD0gcGFyc2VJbnQobGVuKTt9XG4gICAgICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUobGVuKSB8fCBpc05hTihsZW4pIHx8IGxlbiA8PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZhbC50cmltKCkubGVuZ3RoIDw9IHBhcnNlSW50KGxlbik7XG4gICAgICAgIH0sXG4gICAgICAgIG1pbjogZnVuY3Rpb24odmFsLCBtaW5fdmFsdWUpe1xuICAgICAgICAgICAgaWYgKCFVdGlscy5pc1ZhbHVlKG1pbl92YWx1ZSkgfHwgaXNOYU4obWluX3ZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5udW1iZXIodmFsKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc05hTih2YWwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIE51bWJlcih2YWwpID49IE51bWJlcihtaW5fdmFsdWUpO1xuICAgICAgICB9LFxuICAgICAgICBtYXg6IGZ1bmN0aW9uKHZhbCwgbWF4X3ZhbHVlKXtcbiAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZShtYXhfdmFsdWUpIHx8IGlzTmFOKG1heF92YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMubnVtYmVyKHZhbCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXNOYU4odmFsKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBOdW1iZXIodmFsKSA8PSBOdW1iZXIobWF4X3ZhbHVlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZW1haWw6IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgKi9cbiAgICAgICAgICAgIHJldHVybiAvXlthLXowLTlcXHUwMDdGLVxcdWZmZmYhIyQlJicqK1xcLz0/Xl9ge3x9fi1dKyg/OlxcLlthLXowLTlcXHUwMDdGLVxcdWZmZmYhIyQlJicqK1xcLz0/Xl9ge3x9fi1dKykqQCg/OlthLXowLTldKD86W2EtejAtOS1dKlthLXowLTldKT9cXC4pK1thLXpdezIsfSQvaS50ZXN0KHZhbCk7XG4gICAgICAgIH0sXG4gICAgICAgIGRvbWFpbjogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSAqL1xuICAgICAgICAgICAgcmV0dXJuIC9eKCh4bi0tKT9bYS16MC05XSsoLVthLXowLTldKykqXFwuKStbYS16XXsyLH0kLy50ZXN0KHZhbCk7XG4gICAgICAgIH0sXG4gICAgICAgIHVybDogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSAqL1xuICAgICAgICAgICAgdmFyIHJlZ2V4cCAgICA9IC9eKD86KD86KD86aHR0cHM/fGZ0cCk6KT9cXC9cXC8pKD86XFxTKyg/OjpcXFMqKT9AKT8oPzooPyEoPzoxMHwxMjcpKD86XFwuXFxkezEsM30pezN9KSg/ISg/OjE2OVxcLjI1NHwxOTJcXC4xNjgpKD86XFwuXFxkezEsM30pezJ9KSg/ITE3MlxcLig/OjFbNi05XXwyXFxkfDNbMC0xXSkoPzpcXC5cXGR7MSwzfSl7Mn0pKD86WzEtOV1cXGQ/fDFcXGRcXGR8MlswMV1cXGR8MjJbMC0zXSkoPzpcXC4oPzoxP1xcZHsxLDJ9fDJbMC00XVxcZHwyNVswLTVdKSl7Mn0oPzpcXC4oPzpbMS05XVxcZD98MVxcZFxcZHwyWzAtNF1cXGR8MjVbMC00XSkpfCg/Oig/OlthLXowLTlcXHUwMGExLVxcdWZmZmZdW2EtejAtOVxcdTAwYTEtXFx1ZmZmZl8tXXswLDYyfSk/W2EtejAtOVxcdTAwYTEtXFx1ZmZmZl1cXC4pKyg/OlthLXpcXHUwMGExLVxcdWZmZmZdezIsfVxcLj8pKSg/OjpcXGR7Miw1fSk/KD86Wy8/I11cXFMqKT8kL2k7XG4gICAgICAgICAgICByZXR1cm4gcmVnZXhwLnRlc3QodmFsKTtcbiAgICAgICAgfSxcbiAgICAgICAgZGF0ZTogZnVuY3Rpb24odmFsLCBmb3JtYXQsIGxvY2FsZSl7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGlmICghZm9ybWF0KSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGV0aW1lKHZhbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgRGF0ZXRpbWUuZnJvbSh2YWwsIGZvcm1hdCwgbG9jYWxlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBudW1iZXI6IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgICByZXR1cm4gIWlzTmFOKHZhbCk7XG4gICAgICAgIH0sXG4gICAgICAgIGludGVnZXI6IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgICByZXR1cm4gVXRpbHMuaXNJbnQodmFsKTtcbiAgICAgICAgfSxcbiAgICAgICAgZmxvYXQ6IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgICByZXR1cm4gVXRpbHMuaXNGbG9hdCh2YWwpO1xuICAgICAgICB9LFxuICAgICAgICBkaWdpdHM6IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgICByZXR1cm4gL15cXGQrJC8udGVzdCh2YWwpO1xuICAgICAgICB9LFxuICAgICAgICBoZXhjb2xvcjogZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSAqL1xuICAgICAgICAgICAgcmV0dXJuIC8oXiNbMC05QS1GXXs2fSQpfCheI1swLTlBLUZdezN9JCkvaS50ZXN0KHZhbCk7XG4gICAgICAgIH0sXG4gICAgICAgIGNvbG9yOiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgaWYgKCFVdGlscy5pc1ZhbHVlKHZhbCkpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybiBNZXRyby5jb2xvcnMuY29sb3IodmFsLCBNZXRyby5jb2xvcnMuUEFMRVRURVMuU1RBTkRBUkQpICE9PSBmYWxzZSB8fCBNZXRyby5jb2xvcnMuaXNDb2xvcihNZXRyby5jb2xvcnMucGFyc2UodmFsKSk7XG4gICAgICAgIH0sXG4gICAgICAgIHBhdHRlcm46IGZ1bmN0aW9uKHZhbCwgcGF0KXtcbiAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZSh2YWwpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICBpZiAoIVV0aWxzLmlzVmFsdWUocGF0KSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgdmFyIHJlZyA9IG5ldyBSZWdFeHAocGF0KTtcbiAgICAgICAgICAgIHJldHVybiByZWcudGVzdCh2YWwpO1xuICAgICAgICB9LFxuICAgICAgICBjb21wYXJlOiBmdW5jdGlvbih2YWwsIHZhbDIpe1xuICAgICAgICAgICAgcmV0dXJuIHZhbCA9PT0gdmFsMjtcbiAgICAgICAgfSxcbiAgICAgICAgbm90OiBmdW5jdGlvbih2YWwsIG5vdF90aGlzKXtcbiAgICAgICAgICAgIHJldHVybiB2YWwgIT09IG5vdF90aGlzO1xuICAgICAgICB9LFxuICAgICAgICBub3RlcXVhbHM6IGZ1bmN0aW9uKHZhbCwgdmFsMil7XG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNOdWxsKHZhbCkpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIGlmIChVdGlscy5pc051bGwodmFsMikpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybiB2YWwudHJpbSgpICE9PSB2YWwyLnRyaW0oKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXF1YWxzOiBmdW5jdGlvbih2YWwsIHZhbDIpe1xuICAgICAgICAgICAgaWYgKFV0aWxzLmlzTnVsbCh2YWwpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNOdWxsKHZhbDIpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm4gdmFsLnRyaW0oKSA9PT0gdmFsMi50cmltKCk7XG4gICAgICAgIH0sXG4gICAgICAgIGN1c3RvbTogZnVuY3Rpb24odmFsLCBmdW5jKXtcbiAgICAgICAgICAgIGlmIChVdGlscy5pc0Z1bmMoZnVuYykgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFV0aWxzLmV4ZWMoZnVuYywgW3ZhbF0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzX2NvbnRyb2w6IGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIHJldHVybiBlbC5wYXJlbnQoKS5oYXNDbGFzcyhcImlucHV0XCIpXG4gICAgICAgICAgICAgICAgfHwgZWwucGFyZW50KCkuaGFzQ2xhc3MoXCJzZWxlY3RcIilcbiAgICAgICAgICAgICAgICB8fCBlbC5wYXJlbnQoKS5oYXNDbGFzcyhcInRleHRhcmVhXCIpXG4gICAgICAgICAgICAgICAgfHwgZWwucGFyZW50KCkuaGFzQ2xhc3MoXCJjaGVja2JveFwiKVxuICAgICAgICAgICAgICAgIHx8IGVsLnBhcmVudCgpLmhhc0NsYXNzKFwic3dpdGNoXCIpXG4gICAgICAgICAgICAgICAgfHwgZWwucGFyZW50KCkuaGFzQ2xhc3MoXCJyYWRpb1wiKVxuICAgICAgICAgICAgICAgIHx8IGVsLnBhcmVudCgpLmhhc0NsYXNzKFwic3Bpbm5lclwiKVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICByZXNldF9zdGF0ZTogZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgdmFyIGlucHV0ID0gJChlbCk7XG4gICAgICAgICAgICB2YXIgaXNfY29udHJvbCA9IFZhbGlkYXRvckZ1bmNzLmlzX2NvbnRyb2woaW5wdXQpO1xuXG4gICAgICAgICAgICBpZiAoaXNfY29udHJvbCkge1xuICAgICAgICAgICAgICAgIGlucHV0LnBhcmVudCgpLnJlbW92ZUNsYXNzKFwiaW52YWxpZCB2YWxpZFwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaW5wdXQucmVtb3ZlQ2xhc3MoXCJpbnZhbGlkIHZhbGlkXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldF92YWxpZF9zdGF0ZTogZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgdmFyIGlucHV0ID0gJChlbCk7XG4gICAgICAgICAgICB2YXIgaXNfY29udHJvbCA9IFZhbGlkYXRvckZ1bmNzLmlzX2NvbnRyb2woaW5wdXQpO1xuXG4gICAgICAgICAgICBpZiAoaXNfY29udHJvbCkge1xuICAgICAgICAgICAgICAgIGlucHV0LnBhcmVudCgpLmFkZENsYXNzKFwidmFsaWRcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlucHV0LmFkZENsYXNzKFwidmFsaWRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0X2ludmFsaWRfc3RhdGU6IGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIHZhciBpbnB1dCA9ICQoZWwpO1xuICAgICAgICAgICAgdmFyIGlzX2NvbnRyb2wgPSBWYWxpZGF0b3JGdW5jcy5pc19jb250cm9sKGlucHV0KTtcblxuICAgICAgICAgICAgaWYgKGlzX2NvbnRyb2wpIHtcbiAgICAgICAgICAgICAgICBpbnB1dC5wYXJlbnQoKS5hZGRDbGFzcyhcImludmFsaWRcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlucHV0LmFkZENsYXNzKFwiaW52YWxpZFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZXNldDogZnVuY3Rpb24oZm9ybSl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICAkLmVhY2goJChmb3JtKS5maW5kKFwiW2RhdGEtdmFsaWRhdGVdXCIpLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQucmVzZXRfc3RhdGUodGhpcyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdmFsaWRhdGU6IGZ1bmN0aW9uKGVsLCByZXN1bHQsIGNiX29rLCBjYl9lcnJvciwgcmVxdWlyZWRfbW9kZSl7XG4gICAgICAgICAgICB2YXIgdGhpc19yZXN1bHQgPSB0cnVlO1xuICAgICAgICAgICAgdmFyIGlucHV0ID0gJChlbCk7XG4gICAgICAgICAgICB2YXIgZnVuY3MgPSBpbnB1dC5kYXRhKCd2YWxpZGF0ZScpICE9PSB1bmRlZmluZWQgPyBTdHJpbmcoaW5wdXQuZGF0YSgndmFsaWRhdGUnKSkuc3BsaXQoXCIgXCIpLm1hcChmdW5jdGlvbihzKXtyZXR1cm4gcy50cmltKCk7fSkgOiBbXTtcbiAgICAgICAgICAgIHZhciBlcnJvcnMgPSBbXTtcbiAgICAgICAgICAgIHZhciBoYXNGb3JtID0gaW5wdXQuY2xvc2VzdCgnZm9ybScpLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICB2YXIgYXR0cl9uYW1lLCByYWRpb19jaGVja2VkO1xuXG4gICAgICAgICAgICBpZiAoZnVuY3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMucmVzZXRfc3RhdGUoaW5wdXQpO1xuXG4gICAgICAgICAgICBpZiAoaW5wdXQuYXR0cigndHlwZScpICYmIGlucHV0LmF0dHIoJ3R5cGUnKS50b0xvd2VyQ2FzZSgpID09PSBcImNoZWNrYm94XCIpIHtcbiAgICAgICAgICAgICAgICBpZiAoZnVuY3MuaW5kZXhPZigncmVxdWlyZWQnKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpc19yZXN1bHQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXNfcmVzdWx0ID0gaW5wdXQuaXMoXCI6Y2hlY2tlZFwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpc19yZXN1bHQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKCdyZXF1aXJlZCcpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQudmFsICs9IHRoaXNfcmVzdWx0ID8gMCA6IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChpbnB1dC5hdHRyKCd0eXBlJykgJiYgaW5wdXQuYXR0cigndHlwZScpLnRvTG93ZXJDYXNlKCkgPT09IFwicmFkaW9cIikge1xuICAgICAgICAgICAgICAgIGF0dHJfbmFtZSA9IGlucHV0LmF0dHIoJ25hbWUnKTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGF0dHJfbmFtZSAgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzX3Jlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgKiBGaXggd2l0aCBlc2NhcGVkIG5hbWUgYnkgbmxhcmVkIGh0dHBzOi8vZ2l0aHViLmNvbS9ubGFyZWRcbiAgICAgICAgICAgICAgICAgICAgKiAqL1xuICAgICAgICAgICAgICAgICAgICByYWRpb19jaGVja2VkID0gJChcImlucHV0W25hbWU9XCIgKyBhdHRyX25hbWUucmVwbGFjZShcIltcIiwgXCJcXFxcXFxbXCIpLnJlcGxhY2UoXCJdXCIsIFwiXFxcXFxcXVwiKSArIFwiXTpjaGVja2VkXCIpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgICAgICAgICAgICAgICAgIHRoaXNfcmVzdWx0ID0gcmFkaW9fY2hlY2tlZC5sZW5ndGggPiAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnZhbCArPSB0aGlzX3Jlc3VsdCA/IDAgOiAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKGZ1bmNzLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpc19yZXN1bHQgPT09IGZhbHNlKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIHZhciBydWxlID0gdGhpcy5zcGxpdChcIj1cIik7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmLCBhLCBiO1xuXG4gICAgICAgICAgICAgICAgICAgIGYgPSBydWxlWzBdOyBydWxlLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgICAgIGEgPSBydWxlLmpvaW4oXCI9XCIpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChbJ2NvbXBhcmUnLCAnZXF1YWxzJywgJ25vdGVxdWFscyddLmluZGV4T2YoZikgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGhhc0Zvcm0gPyBpbnB1dFswXS5mb3JtLmVsZW1lbnRzW2FdLnZhbHVlIDogJChcIltuYW1lPVwiK2ErXCJdXCIpLnZhbCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGYgPT09ICdkYXRlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGlucHV0LmF0dHIoXCJkYXRhLXZhbHVlLWZvcm1hdFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBpbnB1dC5hdHRyKFwiZGF0YS12YWx1ZS1sb2NhbGVcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoVXRpbHMuaXNGdW5jKFZhbGlkYXRvckZ1bmNzW2ZdKSA9PT0gZmFsc2UpICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzX3Jlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWlyZWRfbW9kZSA9PT0gdHJ1ZSB8fCBmID09PSBcInJlcXVpcmVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzX3Jlc3VsdCA9IFZhbGlkYXRvckZ1bmNzW2ZdKGlucHV0LnZhbCgpLCBhLCBiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbCgpLnRyaW0oKSAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzX3Jlc3VsdCA9IFZhbGlkYXRvckZ1bmNzW2ZdKGlucHV0LnZhbCgpLCBhLCBiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzX3Jlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXNfcmVzdWx0ID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goZik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC52YWwgKz0gdGhpc19yZXN1bHQgPyAwIDogMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpc19yZXN1bHQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRfaW52YWxpZF9zdGF0ZShpbnB1dCk7XG5cbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmxvZy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0OiBpbnB1dFswXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGlucHV0LmF0dHIoXCJuYW1lXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGlucHV0LnZhbCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3M6IGZ1bmNzLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzOiBlcnJvcnNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGNiX2Vycm9yICE9PSB1bmRlZmluZWQpIFV0aWxzLmV4ZWMoY2JfZXJyb3IsIFtpbnB1dCwgaW5wdXQudmFsKCldLCBpbnB1dFswXSk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRfdmFsaWRfc3RhdGUoaW5wdXQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGNiX29rICE9PSB1bmRlZmluZWQpIFV0aWxzLmV4ZWMoY2Jfb2ssIFtpbnB1dCwgaW5wdXQudmFsKCldLCBpbnB1dFswXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzX3Jlc3VsdDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBNZXRyb1sndmFsaWRhdG9yJ10gPSBWYWxpZGF0b3JGdW5jcztcblxuICAgIHZhciBWYWxpZGF0b3JEZWZhdWx0Q29uZmlnID0ge1xuICAgICAgICB2YWxpZGF0b3JEZWZlcnJlZDogMCxcbiAgICAgICAgc3VibWl0VGltZW91dDogMjAwLFxuICAgICAgICBpbnRlcmFjdGl2ZUNoZWNrOiBmYWxzZSxcbiAgICAgICAgY2xlYXJJbnZhbGlkOiAwLFxuICAgICAgICByZXF1aXJlZE1vZGU6IHRydWUsXG4gICAgICAgIHVzZVJlcXVpcmVkQ2xhc3M6IHRydWUsXG4gICAgICAgIG9uQmVmb3JlU3VibWl0OiBNZXRyby5ub29wX3RydWUsXG4gICAgICAgIG9uU3VibWl0OiBNZXRyby5ub29wLFxuICAgICAgICBvbkVycm9yOiBNZXRyby5ub29wLFxuICAgICAgICBvblZhbGlkYXRlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkVycm9yRm9ybTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25WYWxpZGF0ZUZvcm06IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uVmFsaWRhdG9yQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLnZhbGlkYXRvclNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgVmFsaWRhdG9yRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBWYWxpZGF0b3JEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb1ZhbGlkYXRvclNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8udmFsaWRhdG9yU2V0dXAod2luZG93W1wibWV0cm9WYWxpZGF0b3JTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCd2YWxpZGF0b3InLCB7XG4gICAgICAgIG5hbWU6IFwiVmFsaWRhdG9yXCIsXG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW0gKSB7XG4gICAgICAgICAgICB0aGlzLl9zdXBlcihlbGVtLCBvcHRpb25zLCBWYWxpZGF0b3JEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgX29uc3VibWl0OiBudWxsLFxuICAgICAgICAgICAgICAgIF9vbnJlc2V0OiBudWxsLFxuICAgICAgICAgICAgICAgIHJlc3VsdDogW11cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGlucHV0cyA9IGVsZW1lbnQuZmluZChcIltkYXRhLXZhbGlkYXRlXVwiKTtcblxuICAgICAgICAgICAgZWxlbWVudFxuICAgICAgICAgICAgICAgIC5hdHRyKFwibm92YWxpZGF0ZVwiLCAnbm92YWxpZGF0ZScpO1xuXG4gICAgICAgICAgICAkLmVhY2goaW5wdXRzLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBpbnB1dCA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgdmFyIGZ1bmNzID0gaW5wdXQuZGF0YShcInZhbGlkYXRlXCIpO1xuICAgICAgICAgICAgICAgIHZhciByZXF1aXJlZCA9IGZ1bmNzLmluZGV4T2YoXCJyZXF1aXJlZFwiKSA+IC0xO1xuICAgICAgICAgICAgICAgIGlmIChyZXF1aXJlZCAmJiBvLnVzZVJlcXVpcmVkQ2xhc3MgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFZhbGlkYXRvckZ1bmNzLmlzX2NvbnRyb2woaW5wdXQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5wYXJlbnQoKS5hZGRDbGFzcyhcInJlcXVpcmVkXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQuYWRkQ2xhc3MoXCJyZXF1aXJlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoby5pbnRlcmFjdGl2ZUNoZWNrID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0Lm9uKE1ldHJvLmV2ZW50cy5pbnB1dGNoYW5nZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgVmFsaWRhdG9yRnVuY3MudmFsaWRhdGUodGhpcywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgby5yZXF1aXJlZE1vZGUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5fb25zdWJtaXQgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5fb25yZXNldCA9IG51bGw7XG5cbiAgICAgICAgICAgIGlmIChlbGVtZW50WzBdLm9uc3VibWl0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb25zdWJtaXQgPSBlbGVtZW50WzBdLm9uc3VibWl0O1xuICAgICAgICAgICAgICAgIGVsZW1lbnRbMF0ub25zdWJtaXQgPSBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZWxlbWVudFswXS5vbnJlc2V0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb25yZXNldCA9IGVsZW1lbnRbMF0ub25yZXNldDtcbiAgICAgICAgICAgICAgICBlbGVtZW50WzBdLm9ucmVzZXQgPSBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50WzBdLm9uc3VibWl0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhhdC5fc3VibWl0KCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBlbGVtZW50WzBdLm9ucmVzZXQgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGF0Ll9yZXNldCgpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwidmFsaWRhdG9yLWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3Jlc2V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgVmFsaWRhdG9yRnVuY3MucmVzZXQodGhpcy5lbGVtZW50KTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9vbnN1Ym1pdCAhPT0gIG51bGwpIFV0aWxzLmV4ZWModGhpcy5fb25zdWJtaXQsIG51bGwsIHRoaXMuZWxlbWVudFswXSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3N1Ym1pdDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBmb3JtID0gdGhpcy5lbGVtO1xuICAgICAgICAgICAgdmFyIGlucHV0cyA9IGVsZW1lbnQuZmluZChcIltkYXRhLXZhbGlkYXRlXVwiKTtcbiAgICAgICAgICAgIHZhciBzdWJtaXQgPSBlbGVtZW50LmZpbmQoXCJpbnB1dFt0eXBlPXN1Ym1pdF0sIGJ1dHRvblt0eXBlPXN1Ym1pdF1cIik7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgIHZhbDogMCxcbiAgICAgICAgICAgICAgICBsb2c6IFtdXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIGZvcm1EYXRhID0gJC5zZXJpYWxpemVUb0FycmF5KGVsZW1lbnQpO1xuXG4gICAgICAgICAgICBpZiAoc3VibWl0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBzdWJtaXQuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJC5lYWNoKGlucHV0cywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBWYWxpZGF0b3JGdW5jcy52YWxpZGF0ZSh0aGlzLCByZXN1bHQsIG8ub25WYWxpZGF0ZSwgby5vbkVycm9yLCBvLnJlcXVpcmVkTW9kZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc3VibWl0LnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuXG4gICAgICAgICAgICByZXN1bHQudmFsICs9IFV0aWxzLmV4ZWMoby5vbkJlZm9yZVN1Ym1pdCwgW2Zvcm1EYXRhXSwgdGhpcy5lbGVtKSA9PT0gZmFsc2UgPyAxIDogMDtcblxuICAgICAgICAgICAgaWYgKHJlc3VsdC52YWwgPT09IDApIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInZhbGlkYXRlLWZvcm1cIiwge1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiBmb3JtRGF0YVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPIG5lZWQgZml4IGV2ZW50IG5hbWUgdG8gZXF1aXZhbGVudFxuICAgICAgICAgICAgICAgICAgICBVdGlscy5leGVjKG8ub25TdWJtaXQsIFtmb3JtRGF0YV0sIGZvcm0pO1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpcmUoXCJmb3Jtc3VibWl0XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGZvcm1EYXRhXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5fb25zdWJtaXQgIT09ICBudWxsKSBVdGlscy5leGVjKHRoYXQuX29uc3VibWl0LCBudWxsLCBmb3JtKTtcbiAgICAgICAgICAgICAgICB9LCBvLnN1Ym1pdFRpbWVvdXQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImVycm9yLWZvcm1cIiwge1xuICAgICAgICAgICAgICAgICAgICBsb2c6IHJlc3VsdC5sb2csXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGZvcm1EYXRhXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoby5jbGVhckludmFsaWQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChpbnB1dHMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlucCAgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChWYWxpZGF0b3JGdW5jcy5pc19jb250cm9sKGlucCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wLnBhcmVudCgpLnJlbW92ZUNsYXNzKFwiaW52YWxpZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnAucmVtb3ZlQ2xhc3MoXCJpbnZhbGlkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH0sIG8uY2xlYXJJbnZhbGlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQudmFsID09PSAwO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4vKipcbiAqIENvbXBvbmVudCBWZWdhcyBiYXNlZCBvbiBWZWdhcyBieSBKYXkgU2FsdmF0IChodHRwOi8vamF5c2FsdmF0LmNvbS8pXG4gKiBPcmlnaW5hbCBjb2RlIGh0dHBzOi8vZ2l0aHViLmNvbS9qYXlzYWx2YXQvdmVnYXNcbiAqIE1JVCBMaWNlbnNlLCBDb3B5cmlnaHQgMjAxOCBKYXkgU2FsdmF0XG4gKlxuICogQWRhcHRhdGlvbiBmb3IgTWV0cm8gNCBieSBTZXJoaWkgUGltZW5vdixcbiAqIENvcHlyaWdodCAyMDIwIFNlcmhpaSBQaW1lbm92XG4gKi9cblxuKGZ1bmN0aW9uKE1ldHJvLCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBVdGlscyA9IE1ldHJvLnV0aWxzO1xuICAgIHZhciBWZWdhc0RlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIGR1cmF0aW9uOiA0MDAwLFxuICAgICAgICBhbmltYXRpb25EdXJhdGlvbjogbnVsbCxcbiAgICAgICAgdHJhbnNpdGlvbkR1cmF0aW9uOiBudWxsLFxuICAgICAgICB0cmFuc2l0aW9uOiBcImZhZGVcIixcbiAgICAgICAgYW5pbWF0aW9uOiBudWxsLFxuICAgICAgICBzbGlkZXM6IFtdLFxuICAgICAgICBzaHVmZmxlOiBmYWxzZSxcbiAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgIHZhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgbG9vcDogdHJ1ZSxcbiAgICAgICAgYXV0b3BsYXk6IHRydWUsXG4gICAgICAgIG11dGU6IHRydWUsXG4gICAgICAgIGNvdmVyOiB0cnVlLFxuICAgICAgICBwcmVsb2FkOiB0cnVlLFxuICAgICAgICB0aW1lcjogdHJ1ZSxcbiAgICAgICAgb3ZlcmxheTogMixcbiAgICAgICAgY29sb3I6IG51bGwsXG4gICAgICAgIHZvbHVtZTogMSxcbiAgICAgICAgb25QbGF5OiBNZXRyby5ub29wLFxuICAgICAgICBvblBhdXNlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkVuZDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25XYWxrOiBNZXRyby5ub29wLFxuICAgICAgICBvbk5leHQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uUHJldjogTWV0cm8ubm9vcCxcbiAgICAgICAgb25KdW1wOiBNZXRyby5ub29wLFxuICAgICAgICBvblZlZ2FzQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLnZlZ2FzU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBWZWdhc0RlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgVmVnYXNEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb1ZlZ2FzU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby52ZWdhc1NldHVwKHdpbmRvd1tcIm1ldHJvVmVnYXNTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCd2ZWdhcycsIHtcblxuICAgICAgICB2aWRlb0NhY2hlOiB7fSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMudHJhbnNpdGlvbnMgPSBbXG4gICAgICAgICAgICAgICAgXCJmYWRlXCIsIFwiZmFkZTJcIixcbiAgICAgICAgICAgICAgICBcInNsaWRlTGVmdFwiLCBcInNsaWRlTGVmdDJcIixcbiAgICAgICAgICAgICAgICBcInNsaWRlUmlnaHRcIiwgXCJzbGlkZVJpZ2h0MlwiLFxuICAgICAgICAgICAgICAgIFwic2xpZGVVcFwiLCBcInNsaWRlVXAyXCIsXG4gICAgICAgICAgICAgICAgXCJzbGlkZURvd25cIiwgXCJzbGlkZURvd24yXCIsXG4gICAgICAgICAgICAgICAgXCJ6b29tSW5cIiwgXCJ6b29tSW4yXCIsXG4gICAgICAgICAgICAgICAgXCJ6b29tT3V0XCIsIFwiem9vbU91dDJcIixcbiAgICAgICAgICAgICAgICBcInN3aXJsTGVmdFwiLCBcInN3aXJsTGVmdDJcIixcbiAgICAgICAgICAgICAgICBcInN3aXJsUmlnaHRcIiwgXCJzd2lybFJpZ2h0MlwiXG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgdGhpcy5hbmltYXRpb25zID0gW1xuICAgICAgICAgICAgICAgIFwia2VuYnVybnNcIixcbiAgICAgICAgICAgICAgICBcImtlbmJ1cm5zVXBcIixcbiAgICAgICAgICAgICAgICBcImtlbmJ1cm5zRG93blwiLFxuICAgICAgICAgICAgICAgIFwia2VuYnVybnNSaWdodFwiLFxuICAgICAgICAgICAgICAgIFwia2VuYnVybnNMZWZ0XCIsXG4gICAgICAgICAgICAgICAgXCJrZW5idXJuc1VwTGVmdFwiLFxuICAgICAgICAgICAgICAgIFwia2VuYnVybnNVcFJpZ2h0XCIsXG4gICAgICAgICAgICAgICAgXCJrZW5idXJuc0Rvd25MZWZ0XCIsXG4gICAgICAgICAgICAgICAgXCJrZW5idXJuc0Rvd25SaWdodFwiXG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICB0aGlzLnN1cHBvcnQgPSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0Rml0OiAgJ29iamVjdEZpdCcgIGluIGRvY3VtZW50LmJvZHkuc3R5bGUsXG4gICAgICAgICAgICAgICAgdmlkZW86ICEvKEFuZHJvaWR8d2ViT1N8UGhvbmV8aVBhZHxpUG9kfEJsYWNrQmVycnl8V2luZG93cyBQaG9uZSkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIFZlZ2FzRGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIHNsaWRlOiAwLFxuICAgICAgICAgICAgICAgIHNsaWRlczogbnVsbCxcbiAgICAgICAgICAgICAgICB0b3RhbDogMCxcbiAgICAgICAgICAgICAgICBub3Nob3c6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHBhdXNlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgZW5kZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRpbWVyOiBudWxsLFxuICAgICAgICAgICAgICAgIG92ZXJsYXk6IG51bGwsXG4gICAgICAgICAgICAgICAgZmlyc3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgdGltZW91dDogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIHRoaXMuc2xpZGVzID0gVXRpbHMuaXNPYmplY3Qoby5zbGlkZXMpIHx8IFtdO1xuICAgICAgICAgICAgdGhpcy50b3RhbCA9IHRoaXMuc2xpZGVzLmxlbmd0aDtcbiAgICAgICAgICAgIHRoaXMubm9zaG93ID0gdGhpcy50b3RhbCA8IDI7XG4gICAgICAgICAgICB0aGlzLnBhdXNlZCA9ICFvLmF1dG9wbGF5IHx8IHRoaXMubm9zaG93O1xuXG4gICAgICAgICAgICBpZiAoby5zaHVmZmxlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZXMuc2h1ZmZsZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5wcmVsb2FkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcHJlbG9hZCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJ2ZWdhcy1jcmVhdGVcIiwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVTdHJ1Y3R1cmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgaXNCb2R5ID0gZWxlbWVudFswXS50YWdOYW1lID09PSAnQk9EWSc7XG4gICAgICAgICAgICB2YXIgd3JhcHBlcjtcblxuICAgICAgICAgICAgaWYgKCFpc0JvZHkpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmNzcygnaGVpZ2h0JywgZWxlbWVudC5jc3MoJ2hlaWdodCcpKTsgLy8gaXQgaXMgbm90IGNsZWFyIHdoeSB0aGlzIGxpbmVcblxuICAgICAgICAgICAgICAgIHdyYXBwZXIgPSAkKCc8ZGl2IGNsYXNzPVwidmVnYXMtd3JhcHBlclwiPicpXG4gICAgICAgICAgICAgICAgICAgIC5jc3MoJ292ZXJmbG93JywgZWxlbWVudC5jc3MoJ292ZXJmbG93JykpXG4gICAgICAgICAgICAgICAgICAgIC5jc3MoJ3BhZGRpbmcnLCAgZWxlbWVudC5jc3MoJ3BhZGRpbmcnKSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWVsZW1lbnQuY3NzKCdwYWRkaW5nJykpIHtcbiAgICAgICAgICAgICAgICAgICAgd3JhcHBlclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNzcygncGFkZGluZy10b3AnLCAgICBlbGVtZW50LmNzcygncGFkZGluZy10b3AnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jc3MoJ3BhZGRpbmctYm90dG9tJywgZWxlbWVudC5jc3MoJ3BhZGRpbmctYm90dG9tJykpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY3NzKCdwYWRkaW5nLWxlZnQnLCAgIGVsZW1lbnQuY3NzKCdwYWRkaW5nLWxlZnQnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jc3MoJ3BhZGRpbmctcmlnaHQnLCAgZWxlbWVudC5jc3MoJ3BhZGRpbmctcmlnaHQnKSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jaGlsZHJlbigpLmFwcGVuZFRvKHdyYXBwZXIpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xlYXIoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyhcInZlZ2FzLWNvbnRhaW5lclwiKTtcblxuICAgICAgICAgICAgaWYgKCFpc0JvZHkpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmFwcGVuZCh3cmFwcGVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8udGltZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVyID0gJCgnPGRpdiBjbGFzcz1cInZlZ2FzLXRpbWVyXCI+PGRpdiBjbGFzcz1cInZlZ2FzLXRpbWVyLXByb2dyZXNzXCI+Jyk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hcHBlbmQodGhpcy50aW1lcik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLm92ZXJsYXkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm92ZXJsYXkgPSAkKCc8ZGl2IGNsYXNzPVwidmVnYXMtb3ZlcmxheVwiPicpLmFkZENsYXNzKCdvdmVybGF5JyArICh0eXBlb2Ygby5vdmVybGF5ID09PSAnYm9vbGVhbicgfHwgaXNOYU4oby5vdmVybGF5KSA/IDIgOiArby5vdmVybGF5KSk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hcHBlbmQodGhpcy5vdmVybGF5KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIFV0aWxzLmV4ZWMoby5vblBsYXksIG51bGwsIGVsZW1lbnRbMF0pO1xuICAgICAgICAgICAgICAgIHRoYXQuX2dvdG8odGhhdC5zbGlkZSk7XG4gICAgICAgICAgICB9LDEpXG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZUV2ZW50czogZnVuY3Rpb24oKXtcbiAgICAgICAgfSxcblxuICAgICAgICBfcHJlbG9hZDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBpbWcsIGk7XG5cbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLnNsaWRlcy5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuc2xpZGVzW2ldO1xuXG4gICAgICAgICAgICAgICAgaWYgKG9iai5zcmMpIHtcbiAgICAgICAgICAgICAgICAgICAgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgICAgICAgICAgICAgICAgIGltZy5zcmMgPSB0aGlzLnNsaWRlc1tpXS5zcmM7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG9iai52aWRlbykge1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnZpZGVvIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3ZpZGVvKG9iai52aWRlbyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl92aWRlbyhvYmoudmlkZW8uc3JjKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfc2xpZGVTaG93OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnRvdGFsID4gMSAmJiAhdGhpcy5lbmRlZCAmJiAhdGhpcy5wYXVzZWQgJiYgIXRoaXMubm9zaG93KSB7XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQubmV4dCgpO1xuICAgICAgICAgICAgICAgIH0sIG8uZHVyYXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF90aW1lcjogZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVvdXQpO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMudGltZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMudGltZXJcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ3ZlZ2FzLXRpbWVyLXJ1bm5pbmcnKVxuICAgICAgICAgICAgICAgIC5maW5kKCdkaXYnKVxuICAgICAgICAgICAgICAgIC5jc3MoJ3RyYW5zaXRpb24tZHVyYXRpb24nLCAnMG1zJyk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmVuZGVkIHx8IHRoaXMucGF1c2VkIHx8IHRoaXMubm9zaG93KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc3RhdGUpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC50aW1lclxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKCd2ZWdhcy10aW1lci1ydW5uaW5nJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKCdkaXYnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNzcygndHJhbnNpdGlvbi1kdXJhdGlvbicsICtvLmR1cmF0aW9uIC0gMTAwICsgJ21zJyk7XG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfZmFkZVNvdW5kSW46IGZ1bmN0aW9uKHZpZGVvLCBkdXJhdGlvbil7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgJC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBlbDogdmlkZW8sXG4gICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICB2b2x1bWU6ICtvLnZvbHVtZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZHVyOiBkdXJhdGlvblxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcblxuICAgICAgICBfZmFkZVNvdW5kT3V0OiBmdW5jdGlvbih2aWRlbywgZHVyYXRpb24pe1xuICAgICAgICAgICAgJC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBlbDogdmlkZW8sXG4gICAgICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICAgICAgICB2b2x1bWU6IDBcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGR1cjogZHVyYXRpb25cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG5cbiAgICAgICAgX3ZpZGVvOiBmdW5jdGlvbihzb3VyY2VzKXtcbiAgICAgICAgICAgIHZhciB2aWRlbywgc291cmNlO1xuICAgICAgICAgICAgdmFyIGNhY2hlS2V5ID0gc291cmNlcy50b1N0cmluZygpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy52aWRlb0NhY2hlW2NhY2hlS2V5XSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZpZGVvQ2FjaGVbY2FjaGVLZXldO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoc291cmNlcykpIHtcbiAgICAgICAgICAgICAgICBzb3VyY2VzID0gW3NvdXJjZXNdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2aWRlbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ2aWRlb1wiKTtcbiAgICAgICAgICAgIHZpZGVvLnByZWxvYWQgPSB0cnVlO1xuXG4gICAgICAgICAgICBzb3VyY2VzLmZvckVhY2goZnVuY3Rpb24oc3JjKXtcbiAgICAgICAgICAgICAgICBzb3VyY2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic291cmNlXCIpO1xuICAgICAgICAgICAgICAgIHNvdXJjZS5zcmMgPSBzcmM7XG4gICAgICAgICAgICAgICAgdmlkZW8uYXBwZW5kQ2hpbGQoc291cmNlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLnZpZGVvQ2FjaGVbY2FjaGVLZXldID0gdmlkZW87XG5cbiAgICAgICAgICAgIHJldHVybiB2aWRlbztcbiAgICAgICAgfSxcblxuICAgICAgICBfZ290bzogZnVuY3Rpb24obil7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5zbGlkZXNbbl0gPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgbiA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2xpZGUgPSBuO1xuXG4gICAgICAgICAgICB2YXIgJHNsaWRlLCAkaW5uZXIsIHZpZGVvLCBpbWcsICR2aWRlbztcbiAgICAgICAgICAgIHZhciBzbGlkZXMgPSBlbGVtZW50LmNoaWxkcmVuKFwiLnZlZ2FzLXNsaWRlXCIpO1xuICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuc2xpZGVzW25dO1xuICAgICAgICAgICAgdmFyIGNvdmVyID0gby5jb3ZlcjtcbiAgICAgICAgICAgIHZhciB0cmFuc2l0aW9uLCBhbmltYXRpb247XG4gICAgICAgICAgICB2YXIgdHJhbnNpdGlvbkR1cmF0aW9uLCBhbmltYXRpb25EdXJhdGlvbjtcblxuICAgICAgICAgICAgaWYgKHRoaXMuZmlyc3QpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpcnN0ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChjb3ZlciAhPT0gJ3JlcGVhdCcpIHtcbiAgICAgICAgICAgICAgICBpZiAoY292ZXIgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY292ZXIgPSAnY292ZXInO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY292ZXIgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvdmVyID0gJ2NvbnRhaW4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8udHJhbnNpdGlvbiA9PT0gJ3JhbmRvbScpIHtcbiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uID0gJC5yYW5kb20odGhpcy50cmFuc2l0aW9ucyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRyYW5zaXRpb24gPSBvLnRyYW5zaXRpb24gPyBvLnRyYW5zaXRpb24gOiB0aGlzLnRyYW5zaXRpb25zWzBdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5hbmltYXRpb24gPT09ICdyYW5kb20nKSB7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uID0gJC5yYW5kb20odGhpcy5hbmltYXRpb25zKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uID0gby5hbmltYXRpb24gPyBvLmFuaW1hdGlvbiA6IHRoaXMuYW5pbWF0aW9uc1swXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFvLnRyYW5zaXRpb25EdXJhdGlvbikge1xuICAgICAgICAgICAgICAgIHRyYW5zaXRpb25EdXJhdGlvbiA9ICtvLmR1cmF0aW9uO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChvLnRyYW5zaXRpb25EdXJhdGlvbiA9PT0gJ2F1dG8nIHx8ICtvLnRyYW5zaXRpb25EdXJhdGlvbiA+ICtvLmR1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbkR1cmF0aW9uID0gK28uZHVyYXRpb247XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRyYW5zaXRpb25EdXJhdGlvbiA9ICtvLnRyYW5zaXRpb25EdXJhdGlvbjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFvLmFuaW1hdGlvbkR1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uRHVyYXRpb24gPSArby5kdXJhdGlvbjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoby5hbmltYXRpb25EdXJhdGlvbiA9PT0gJ2F1dG8nIHx8ICtvLmFuaW1hdGlvbkR1cmF0aW9uID4gK28uZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb25EdXJhdGlvbiA9ICtvLmR1cmF0aW9uO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb25EdXJhdGlvbiA9ICtvLmFuaW1hdGlvbkR1cmF0aW9uO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkc2xpZGUgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJ2ZWdhcy1zbGlkZVwiKS5hZGRDbGFzcygndmVnYXMtdHJhbnNpdGlvbi0nICsgdHJhbnNpdGlvbik7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnN1cHBvcnQudmlkZW8gJiYgb2JqLnZpZGVvKSB7XG4gICAgICAgICAgICAgICAgdmlkZW8gPSBvYmoudmlkZW8gaW5zdGFuY2VvZiBBcnJheSA/IHRoaXMuX3ZpZGVvKG9iai52aWRlbykgOiB0aGlzLl92aWRlbyhvYmoudmlkZW8uc3JjKTtcbiAgICAgICAgICAgICAgICB2aWRlby5sb29wID0gb2JqLnZpZGVvLmxvb3AgPyBvYmoudmlkZW8ubG9vcCA6IG8ubG9vcDtcbiAgICAgICAgICAgICAgICB2aWRlby5tdXRlZCA9IG9iai52aWRlby5tdXRlID8gb2JqLnZpZGVvLm11dGUgOiBvLm11dGU7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXZpZGVvLm11dGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZhZGVTb3VuZEluKHZpZGVvLCB0cmFuc2l0aW9uRHVyYXRpb24pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZpZGVvLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJHZpZGVvID0gJCh2aWRlbylcbiAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKCd2ZWdhcy12aWRlbycpXG4gICAgICAgICAgICAgICAgICAgIC5jc3MoJ2JhY2tncm91bmQtY29sb3InLCBvLmNvbG9yIHx8ICcjMDAwMDAwJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdXBwb3J0Lm9iamVjdEZpdCkge1xuICAgICAgICAgICAgICAgICAgICAkdmlkZW9cbiAgICAgICAgICAgICAgICAgICAgICAgIC5jc3MoJ29iamVjdC1wb3NpdGlvbicsIG8uYWxpZ24gKyAnICcgKyBvLnZhbGlnbilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jc3MoJ29iamVjdC1maXQnLCBjb3ZlcilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jc3MoJ3dpZHRoJywgICcxMDAlJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jc3MoJ2hlaWdodCcsICcxMDAlJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb3ZlciA9PT0gJ2NvbnRhaW4nKSB7XG4gICAgICAgICAgICAgICAgICAgICR2aWRlb1xuICAgICAgICAgICAgICAgICAgICAgICAgLmNzcygnd2lkdGgnLCAgJzEwMCUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNzcygnaGVpZ2h0JywgJzEwMCUnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkc2xpZGUuYXBwZW5kKCR2aWRlbyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGltZyA9IG5ldyBJbWFnZSgpO1xuICAgICAgICAgICAgICAgICRpbm5lciA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcygndmVnYXMtc2xpZGUtaW5uZXInKVxuICAgICAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogJ3VybChcIicrb2JqLnNyYysnXCIpJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogby5jb2xvciB8fCAnIzAwMDAwMCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kUG9zaXRpb246IG8uYWxpZ24gKyAnICcgKyBvLnZhbGlnblxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChjb3ZlciA9PT0gJ3JlcGVhdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgJGlubmVyLmNzcygnYmFja2dyb3VuZC1yZXBlYXQnLCAncmVwZWF0Jyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJGlubmVyLmNzcygnYmFja2dyb3VuZC1zaXplJywgY292ZXIpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChhbmltYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgJGlubmVyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ3ZlZ2FzLWFuaW1hdGlvbi0nICsgYW5pbWF0aW9uKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNzcygnYW5pbWF0aW9uLWR1cmF0aW9uJywgIGFuaW1hdGlvbkR1cmF0aW9uICsgJ21zJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJHNsaWRlLmFwcGVuZCgkaW5uZXIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc2xpZGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHNsaWRlcy5lcShzbGlkZXMubGVuZ3RoIC0gMSkuYWZ0ZXIoJHNsaWRlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5wcmVwZW5kKCRzbGlkZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNsaWRlc1xuICAgICAgICAgICAgICAgIC5jc3MoJ3RyYW5zaXRpb24nLCAnYWxsIDBtcycpXG4gICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGFzc05hbWUgID0gJ3ZlZ2FzLXNsaWRlJztcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50YWdOYW1lID09PSAnVklERU8nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTmFtZSArPSAnIHZlZ2FzLXZpZGVvJztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmFuc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTmFtZSArPSAnIHZlZ2FzLXRyYW5zaXRpb24tJyArIHRyYW5zaXRpb247XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTmFtZSArPSAnIHZlZ2FzLXRyYW5zaXRpb24tJyArIHRyYW5zaXRpb24gKyAnLWluJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIHRoaXMuX3RpbWVyKGZhbHNlKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gZ28oKXtcbiAgICAgICAgICAgICAgICB0aGF0Ll90aW1lcih0cnVlKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVzXG4gICAgICAgICAgICAgICAgICAgICAgICAuY3NzKCd0cmFuc2l0aW9uJywgJ2FsbCAnICsgdHJhbnNpdGlvbkR1cmF0aW9uICsgJ21zJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcygndmVnYXMtdHJhbnNpdGlvbi0nICsgdHJhbnNpdGlvbiArICctb3V0Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2xpZGVzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZpZGVvID0gc2xpZGVzLmZpbmQoJ3ZpZGVvJykuZ2V0KDApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmlkZW8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlby52b2x1bWUgPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZhZGVTb3VuZE91dCh2aWRlbywgdHJhbnNpdGlvbkR1cmF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlXG4gICAgICAgICAgICAgICAgICAgICAgICAuY3NzKCd0cmFuc2l0aW9uJywgJ2FsbCAnICsgdHJhbnNpdGlvbkR1cmF0aW9uICsgJ21zJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcygndmVnYXMtdHJhbnNpdGlvbi0nICsgdHJhbnNpdGlvbiArICctaW4nKTtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNsaWRlcy5sZW5ndGggLSAxOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlcy5lcShpKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcIndhbGtcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGU6IHRoYXQuY3VycmVudCh0cnVlKVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9zbGlkZVNob3coKTtcbiAgICAgICAgICAgICAgICB9LCAxMDApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodmlkZW8pIHtcbiAgICAgICAgICAgICAgICBpZiAodmlkZW8ucmVhZHlTdGF0ZSA9PT0gNCkge1xuICAgICAgICAgICAgICAgICAgICB2aWRlby5jdXJyZW50VGltZSA9IDA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmlkZW8ucGxheSgpO1xuICAgICAgICAgICAgICAgIGdvKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGltZy5zcmMgPSBvYmouc3JjO1xuXG4gICAgICAgICAgICAgICAgaWYgKGltZy5jb21wbGV0ZSkge1xuICAgICAgICAgICAgICAgICAgICBnbygpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGltZy5vbmxvYWQgPSBnbztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2VuZDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHRoaXMuZW5kZWQgPSB0aGlzLm9wdGlvbnMuYXV0b3BsYXk7XG4gICAgICAgICAgICB0aGlzLl90aW1lcihmYWxzZSk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImVuZFwiLCB7XG4gICAgICAgICAgICAgICAgc2xpZGU6IHRoaXMuY3VycmVudCh0cnVlKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcGxheTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5wYXVzZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJwbGF5XCIsIHtcbiAgICAgICAgICAgICAgICBzbGlkZTogdGhpcy5jdXJyZW50KHRydWUpXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5wYXVzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMubmV4dCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHBhdXNlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5fdGltZXIoZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy5wYXVzZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJwYXVzZVwiLCB7XG4gICAgICAgICAgICAgICAgc2xpZGU6IHRoaXMuY3VycmVudCh0cnVlKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5wYXVzZWQgPyB0aGlzLnBsYXkoKSA6IHRoaXMucGF1c2UoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBwbGF5aW5nOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuICF0aGlzLnBhdXNlZCAmJiAhdGhpcy5ub3Nob3c7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY3VycmVudDogZnVuY3Rpb24gKGFkdmFuY2VkKSB7XG4gICAgICAgICAgICBpZiAoYWR2YW5jZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBzbGlkZTogdGhpcy5zbGlkZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogIHRoaXMuc2xpZGVzW3RoaXMuc2xpZGVdXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNsaWRlO1xuICAgICAgICB9LFxuXG4gICAgICAgIGp1bXA6IGZ1bmN0aW9uKG4pe1xuICAgICAgICAgICAgaWYgKG4gPD0gMCB8fCBuID4gdGhpcy5zbGlkZXMubGVuZ3RoIHx8IG4gPT09IHRoaXMuc2xpZGUgKyAxKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2xpZGUgPSBuIC0gMTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwianVtcFwiLCB7XG4gICAgICAgICAgICAgICAgc2xpZGU6IHRoaXMuY3VycmVudCh0cnVlKVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgdGhpcy5fZ290byh0aGlzLnNsaWRlKTtcbiAgICAgICAgfSxcblxuICAgICAgICBuZXh0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIHRoaXMuc2xpZGUrKztcblxuICAgICAgICAgICAgaWYgKHRoaXMuc2xpZGUgPj0gdGhpcy5zbGlkZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFvLmxvb3ApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VuZCgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMuc2xpZGUgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJuZXh0XCIsIHtcbiAgICAgICAgICAgICAgICBzbGlkZTogdGhpcy5jdXJyZW50KHRydWUpXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5fZ290byh0aGlzLnNsaWRlKTtcbiAgICAgICAgfSxcblxuICAgICAgICBwcmV2OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIHRoaXMuc2xpZGUtLTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuc2xpZGUgPCAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFvLmxvb3ApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zbGlkZSsrO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5kKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZSA9IHRoaXMuc2xpZGVzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcInByZXZcIiwge1xuICAgICAgICAgICAgICAgIHNsaWRlOiB0aGlzLmN1cnJlbnQodHJ1ZSlcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLl9nb3RvKHRoaXMuc2xpZGUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oYXR0cil7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBwcm9wTmFtZSA9IENha2UuY2FtZWxDYXNlKGF0dHIucmVwbGFjZShcImRhdGEtXCIsIFwiXCIpKTtcblxuICAgICAgICAgICAgaWYgKHByb3BOYW1lID09PSAnc2xpZGVzJykge1xuICAgICAgICAgICAgICAgIG8uc2xpZGVzID0gZWxlbWVudC5hdHRyKCdkYXRhLXNsaWRlcycpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVzID0gVXRpbHMuaXNPYmplY3Qoby5zbGlkZXMpIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMudG90YWwgPSB0aGlzLnNsaWRlcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdGhpcy5ub3Nob3cgPSB0aGlzLnRvdGFsIDwgMjtcbiAgICAgICAgICAgICAgICB0aGlzLnBhdXNlZCA9ICF0aGlzLm9wdGlvbnMuYXV0b3BsYXkgfHwgdGhpcy5ub3Nob3c7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgVmVnYXNEZWZhdWx0Q29uZmlnW3Byb3BOYW1lXSAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAgICAgIG9bcHJvcE5hbWVdID0gSlNPTi5wYXJzZShlbGVtZW50LmF0dHIoYXR0cikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7XG4gICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKCd2ZWdhcy1jb250YWluZXInKTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnPiAudmVnYXMtc2xpZGUnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnPiAudmVnYXMtd3JhcHBlcicpLmNoaWxkcmVuKCkuYXBwZW5kVG8oZWxlbWVudCk7XG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoJz4gLnZlZ2FzLXdyYXBwZXInKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgaWYgKG8udGltZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVyLnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5vdmVybGF5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vdmVybGF5LnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudFswXTtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIFZpZGVvUGxheWVyRGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgdmlkZW9EZWZlcnJlZDogMCxcbiAgICAgICAgc3JjOiBudWxsLFxuXG4gICAgICAgIHBvc3RlcjogXCJcIixcbiAgICAgICAgbG9nbzogXCJcIixcbiAgICAgICAgbG9nb0hlaWdodDogMzIsXG4gICAgICAgIGxvZ29XaWR0aDogXCJhdXRvXCIsXG4gICAgICAgIGxvZ29UYXJnZXQ6IFwiXCIsXG5cbiAgICAgICAgdm9sdW1lOiAuNSxcbiAgICAgICAgbG9vcDogZmFsc2UsXG4gICAgICAgIGF1dG9wbGF5OiBmYWxzZSxcblxuICAgICAgICBmdWxsU2NyZWVuTW9kZTogTWV0cm8uZnVsbFNjcmVlbk1vZGUuREVTS1RPUCxcbiAgICAgICAgYXNwZWN0UmF0aW86IE1ldHJvLmFzcGVjdFJhdGlvLkhELFxuXG4gICAgICAgIGNvbnRyb2xzSGlkZTogMzAwMCxcblxuICAgICAgICBzaG93TG9vcDogdHJ1ZSxcbiAgICAgICAgc2hvd1BsYXk6IHRydWUsXG4gICAgICAgIHNob3dTdG9wOiB0cnVlLFxuICAgICAgICBzaG93TXV0ZTogdHJ1ZSxcbiAgICAgICAgc2hvd0Z1bGw6IHRydWUsXG4gICAgICAgIHNob3dTdHJlYW06IHRydWUsXG4gICAgICAgIHNob3dWb2x1bWU6IHRydWUsXG4gICAgICAgIHNob3dJbmZvOiB0cnVlLFxuXG4gICAgICAgIGxvb3BJY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tbG9vcCc+PC9zcGFuPlwiLFxuICAgICAgICBzdG9wSWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLXN0b3AnPjwvc3Bhbj5cIixcbiAgICAgICAgcGxheUljb246IFwiPHNwYW4gY2xhc3M9J2RlZmF1bHQtaWNvbi1wbGF5Jz48L3NwYW4+XCIsXG4gICAgICAgIHBhdXNlSWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLXBhdXNlJz48L3NwYW4+XCIsXG4gICAgICAgIG11dGVJY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tbXV0ZSc+PC9zcGFuPlwiLFxuICAgICAgICB2b2x1bWVMb3dJY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tbG93LXZvbHVtZSc+PC9zcGFuPlwiLFxuICAgICAgICB2b2x1bWVNZWRpdW1JY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tbWVkaXVtLXZvbHVtZSc+PC9zcGFuPlwiLFxuICAgICAgICB2b2x1bWVIaWdoSWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLWhpZ2gtdm9sdW1lJz48L3NwYW4+XCIsXG4gICAgICAgIHNjcmVlbk1vcmVJY29uOiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tZW5sYXJnZSc+PC9zcGFuPlwiLFxuICAgICAgICBzY3JlZW5MZXNzSWNvbjogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLXNocmluayc+PC9zcGFuPlwiLFxuXG4gICAgICAgIG9uUGxheTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25QYXVzZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25TdG9wOiBNZXRyby5ub29wLFxuICAgICAgICBvbkVuZDogTWV0cm8ubm9vcCxcbiAgICAgICAgb25NZXRhZGF0YTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25UaW1lOiBNZXRyby5ub29wLFxuICAgICAgICBvblZpZGVvUGxheWVyQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLnZpZGVvUGxheWVyU2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBWaWRlb1BsYXllckRlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgVmlkZW9QbGF5ZXJEZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb1ZpZGVvUGxheWVyU2V0dXBcIl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBNZXRyby52aWRlb1BsYXllclNldHVwKHdpbmRvd1tcIm1ldHJvVmlkZW9QbGF5ZXJTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCd2aWRlby1wbGF5ZXInLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgVmlkZW9QbGF5ZXJEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgZnVsbHNjcmVlbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgcHJlbG9hZGVyOiBudWxsLFxuICAgICAgICAgICAgICAgIHBsYXllcjogbnVsbCxcbiAgICAgICAgICAgICAgICB2aWRlbzogZWxlbSxcbiAgICAgICAgICAgICAgICBzdHJlYW06IG51bGwsXG4gICAgICAgICAgICAgICAgdm9sdW1lOiBudWxsLFxuICAgICAgICAgICAgICAgIHZvbHVtZUJhY2t1cDogMCxcbiAgICAgICAgICAgICAgICBtdXRlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgZnVsbFNjcmVlbkludGVydmFsOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBpc1BsYXlpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlkOiBVdGlscy5lbGVtZW50SWQoJ3ZpZGVvLXBsYXllcicpXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAoTWV0cm8uZnVsbFNjcmVlbkVuYWJsZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgby5mdWxsU2NyZWVuTW9kZSA9IE1ldHJvLmZ1bGxTY3JlZW5Nb2RlLldJTkRPVztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlUGxheWVyKCk7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVDb250cm9scygpO1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlRXZlbnRzKCk7XG4gICAgICAgICAgICB0aGlzLl9zZXRBc3BlY3RSYXRpbygpO1xuXG4gICAgICAgICAgICBpZiAoby5hdXRvcGxheSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGxheSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJ2aWRlby1wbGF5ZXItY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50LFxuICAgICAgICAgICAgICAgIHBsYXllcjogdGhpcy5wbGF5ZXJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVQbGF5ZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucywgdmlkZW8gPSB0aGlzLnZpZGVvO1xuICAgICAgICAgICAgdmFyIHBsYXllciA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcIm1lZGlhLXBsYXllciB2aWRlby1wbGF5ZXIgXCIgKyBlbGVtZW50WzBdLmNsYXNzTmFtZSk7XG4gICAgICAgICAgICB2YXIgcHJlbG9hZGVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwicHJlbG9hZGVyXCIpLmFwcGVuZFRvKHBsYXllcik7XG4gICAgICAgICAgICB2YXIgbG9nbyA9ICQoXCI8YT5cIikuYXR0cihcImhyZWZcIiwgby5sb2dvVGFyZ2V0KS5hZGRDbGFzcyhcImxvZ29cIikuYXBwZW5kVG8ocGxheWVyKTtcblxuICAgICAgICAgICAgcGxheWVyLmluc2VydEJlZm9yZShlbGVtZW50KTtcbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kVG8ocGxheWVyKTtcblxuICAgICAgICAgICAgJC5lYWNoKFsnbXV0ZWQnLCAnYXV0b3BsYXknLCAnY29udHJvbHMnLCAnaGVpZ2h0JywgJ3dpZHRoJywgJ2xvb3AnLCAncG9zdGVyJywgJ3ByZWxvYWQnXSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZUF0dHIodGhpcyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwicHJlbG9hZFwiLCBcImF1dG9cIik7XG5cbiAgICAgICAgICAgIGlmIChvLnBvc3RlciAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cihcInBvc3RlclwiLCBvLnBvc3Rlcik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZpZGVvLnZvbHVtZSA9IG8udm9sdW1lO1xuXG4gICAgICAgICAgICBwcmVsb2FkZXIuYWN0aXZpdHkoe1xuICAgICAgICAgICAgICAgIHR5cGU6IFwiY3ljbGVcIixcbiAgICAgICAgICAgICAgICBzdHlsZTogXCJjb2xvclwiXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcHJlbG9hZGVyLmhpZGUoKTtcblxuICAgICAgICAgICAgdGhpcy5wcmVsb2FkZXIgPSBwcmVsb2FkZXI7XG5cbiAgICAgICAgICAgIGlmIChvLmxvZ28gIT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAkKFwiPGltZz5cIilcbiAgICAgICAgICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IG8ubG9nb0hlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBvLmxvZ29XaWR0aFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInNyY1wiLCBvLmxvZ28pLmFwcGVuZFRvKGxvZ28pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5zcmMgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zZXRTb3VyY2Uoby5zcmMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50WzBdLmNsYXNzTmFtZSA9IFwiXCI7XG5cbiAgICAgICAgICAgIHRoaXMucGxheWVyID0gcGxheWVyO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9zZXRTb3VyY2U6IGZ1bmN0aW9uKHNyYyl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgZWxlbWVudC5maW5kKFwic291cmNlXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVBdHRyKFwic3JjXCIpO1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc3JjKSkge1xuICAgICAgICAgICAgICAgICQuZWFjaChzcmMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc3JjID09PSB1bmRlZmluZWQpIHJldHVybiA7XG4gICAgICAgICAgICAgICAgICAgICQoXCI8c291cmNlPlwiKS5hdHRyKCdzcmMnLCBpdGVtLnNyYykuYXR0cigndHlwZScsIGl0ZW0udHlwZSAhPT0gdW5kZWZpbmVkID8gaXRlbS50eXBlIDogJycpLmFwcGVuZFRvKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHIoXCJzcmNcIiwgc3JjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlQ29udHJvbHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnMsIHZpZGVvID0gdGhpcy5lbGVtO1xuXG4gICAgICAgICAgICB2YXIgY29udHJvbHMgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJjb250cm9sc1wiKS5hZGRDbGFzcyhvLmNsc0NvbnRyb2xzKS5pbnNlcnRBZnRlcihlbGVtZW50KTtcblxuICAgICAgICAgICAgdmFyIHN0cmVhbSA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInN0cmVhbVwiKS5hcHBlbmRUbyhjb250cm9scyk7XG4gICAgICAgICAgICB2YXIgc3RyZWFtU2xpZGVyID0gJChcIjxpbnB1dD5cIikuYWRkQ2xhc3MoXCJzdHJlYW0tc2xpZGVyIHVsdHJhLXRoaW4gY3ljbGUtbWFya2VyXCIpLmFwcGVuZFRvKHN0cmVhbSk7XG5cbiAgICAgICAgICAgIHZhciB2b2x1bWUgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJ2b2x1bWVcIikuYXBwZW5kVG8oY29udHJvbHMpO1xuICAgICAgICAgICAgdmFyIHZvbHVtZVNsaWRlciA9ICQoXCI8aW5wdXQ+XCIpLmFkZENsYXNzKFwidm9sdW1lLXNsaWRlciB1bHRyYS10aGluIGN5Y2xlLW1hcmtlclwiKS5hcHBlbmRUbyh2b2x1bWUpO1xuXG4gICAgICAgICAgICB2YXIgaW5mb0JveCA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImluZm8tYm94XCIpLmFwcGVuZFRvKGNvbnRyb2xzKTtcblxuICAgICAgICAgICAgaWYgKG8uc2hvd0luZm8gIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBpbmZvQm94LmhpZGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgTWV0cm8ubWFrZVBsdWdpbihzdHJlYW1TbGlkZXIsIFwic2xpZGVyXCIsIHtcbiAgICAgICAgICAgICAgICBjbHNNYXJrZXI6IFwiYmctcmVkXCIsXG4gICAgICAgICAgICAgICAgY2xzSGludDogXCJiZy1jeWFuIGZnLXdoaXRlXCIsXG4gICAgICAgICAgICAgICAgY2xzQ29tcGxldGU6IFwiYmctY3lhblwiLFxuICAgICAgICAgICAgICAgIGhpbnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgb25TdGFydDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF2aWRlby5wYXVzZWQpIHZpZGVvLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvblN0b3A6IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2aWRlby5zZWVrYWJsZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2aWRlby5jdXJyZW50VGltZSA9ICh0aGF0LmR1cmF0aW9uICogdmFsIC8gMTAwKS50b0ZpeGVkKDApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh2aWRlby5wYXVzZWQgJiYgdmlkZW8uY3VycmVudFRpbWUgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2aWRlby5wbGF5KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5zdHJlYW0gPSBzdHJlYW1TbGlkZXI7XG5cbiAgICAgICAgICAgIGlmIChvLnNob3dTdHJlYW0gIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBzdHJlYW0uaGlkZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBNZXRyby5tYWtlUGx1Z2luKHZvbHVtZVNsaWRlciwgXCJzbGlkZXJcIiwge1xuICAgICAgICAgICAgICAgIGNsc01hcmtlcjogXCJiZy1yZWRcIixcbiAgICAgICAgICAgICAgICBjbHNIaW50OiBcImJnLWN5YW4gZmctd2hpdGVcIixcbiAgICAgICAgICAgICAgICBoaW50OiB0cnVlLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBvLnZvbHVtZSAqIDEwMCxcbiAgICAgICAgICAgICAgICBvbkNoYW5nZVZhbHVlOiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgICAgICAgICB2aWRlby52b2x1bWUgPSB2YWwgLyAxMDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMudm9sdW1lID0gdm9sdW1lU2xpZGVyO1xuXG4gICAgICAgICAgICBpZiAoby5zaG93Vm9sdW1lICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdm9sdW1lLmhpZGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGxvb3A7XG5cbiAgICAgICAgICAgIGlmIChvLnNob3dMb29wID09PSB0cnVlKSBsb29wID0gJChcIjxidXR0b24+XCIpLmF0dHIoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpLmFkZENsYXNzKFwiYnV0dG9uIHNxdWFyZSBsb29wXCIpLmh0bWwoby5sb29wSWNvbikuYXBwZW5kVG8oY29udHJvbHMpO1xuICAgICAgICAgICAgaWYgKG8uc2hvd1BsYXkgPT09IHRydWUpICQoXCI8YnV0dG9uPlwiKS5hdHRyKFwidHlwZVwiLCBcImJ1dHRvblwiKS5hZGRDbGFzcyhcImJ1dHRvbiBzcXVhcmUgcGxheVwiKS5odG1sKG8ucGxheUljb24pLmFwcGVuZFRvKGNvbnRyb2xzKTtcbiAgICAgICAgICAgIGlmIChvLnNob3dTdG9wID09PSB0cnVlKSAkKFwiPGJ1dHRvbj5cIikuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIikuYWRkQ2xhc3MoXCJidXR0b24gc3F1YXJlIHN0b3BcIikuaHRtbChvLnN0b3BJY29uKS5hcHBlbmRUbyhjb250cm9scyk7XG4gICAgICAgICAgICBpZiAoby5zaG93TXV0ZSA9PT0gdHJ1ZSkgJChcIjxidXR0b24+XCIpLmF0dHIoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpLmFkZENsYXNzKFwiYnV0dG9uIHNxdWFyZSBtdXRlXCIpLmh0bWwoby5tdXRlSWNvbikuYXBwZW5kVG8oY29udHJvbHMpO1xuICAgICAgICAgICAgaWYgKG8uc2hvd0Z1bGwgPT09IHRydWUpICQoXCI8YnV0dG9uPlwiKS5hdHRyKFwidHlwZVwiLCBcImJ1dHRvblwiKS5hZGRDbGFzcyhcImJ1dHRvbiBzcXVhcmUgZnVsbFwiKS5odG1sKG8uc2NyZWVuTW9yZUljb24pLmFwcGVuZFRvKGNvbnRyb2xzKTtcblxuICAgICAgICAgICAgaWYgKG8ubG9vcCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGxvb3AuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKFwibG9vcFwiLCBcImxvb3BcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX3NldFZvbHVtZSgpO1xuXG4gICAgICAgICAgICBpZiAoby5tdXRlZCkge1xuICAgICAgICAgICAgICAgIHRoYXQudm9sdW1lQmFja3VwID0gdmlkZW8udm9sdW1lO1xuICAgICAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbih0aGF0LnZvbHVtZSwgJ3NsaWRlcicpLnZhbCgwKTtcbiAgICAgICAgICAgICAgICB2aWRlby52b2x1bWUgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpbmZvQm94Lmh0bWwoXCIwMDowMCAvIDAwOjAwXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnMsIHZpZGVvID0gdGhpcy5lbGVtLCBwbGF5ZXIgPSB0aGlzLnBsYXllcjtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihcImxvYWRzdGFydFwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQucHJlbG9hZGVyLnNob3coKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKFwibG9hZGVkbWV0YWRhdGFcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0LmR1cmF0aW9uID0gdmlkZW8uZHVyYXRpb24udG9GaXhlZCgwKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9zZXRJbmZvKDAsIHRoYXQuZHVyYXRpb24pO1xuICAgICAgICAgICAgICAgIFV0aWxzLmV4ZWMoby5vbk1ldGFkYXRhLCBbdmlkZW8sIHBsYXllcl0sIGVsZW1lbnRbMF0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oXCJjYW5wbGF5XCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5fc2V0QnVmZmVyKCk7XG4gICAgICAgICAgICAgICAgdGhhdC5wcmVsb2FkZXIuaGlkZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oXCJwcm9ncmVzc1wiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuX3NldEJ1ZmZlcigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oXCJ0aW1ldXBkYXRlXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gTWF0aC5yb3VuZCh2aWRlby5jdXJyZW50VGltZSAqIDEwMCAvIHRoYXQuZHVyYXRpb24pO1xuICAgICAgICAgICAgICAgIHRoYXQuX3NldEluZm8odmlkZW8uY3VycmVudFRpbWUsIHRoYXQuZHVyYXRpb24pO1xuICAgICAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbih0aGF0LnN0cmVhbSwgJ3NsaWRlcicpLnZhbChwb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgVXRpbHMuZXhlYyhvLm9uVGltZSwgW3ZpZGVvLmN1cnJlbnRUaW1lLCB0aGF0LmR1cmF0aW9uLCB2aWRlbywgcGxheWVyXSwgZWxlbWVudFswXSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihcIndhaXRpbmdcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0LnByZWxvYWRlci5zaG93KCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihcImxvYWRlZGRhdGFcIiwgZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oXCJwbGF5XCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgcGxheWVyLmZpbmQoXCIucGxheVwiKS5odG1sKG8ucGF1c2VJY29uKTtcbiAgICAgICAgICAgICAgICBVdGlscy5leGVjKG8ub25QbGF5LCBbdmlkZW8sIHBsYXllcl0sIGVsZW1lbnRbMF0pO1xuICAgICAgICAgICAgICAgIHRoYXQuX29uTW91c2UoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKFwicGF1c2VcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBwbGF5ZXIuZmluZChcIi5wbGF5XCIpLmh0bWwoby5wbGF5SWNvbik7XG4gICAgICAgICAgICAgICAgVXRpbHMuZXhlYyhvLm9uUGF1c2UsIFt2aWRlbywgcGxheWVyXSwgZWxlbWVudFswXSk7XG4gICAgICAgICAgICAgICAgdGhhdC5fb2ZmTW91c2UoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKFwic3RvcFwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbih0aGF0LnN0cmVhbSwgJ3NsaWRlcicpLnZhbCgwKTtcbiAgICAgICAgICAgICAgICBVdGlscy5leGVjKG8ub25TdG9wLCBbdmlkZW8sIHBsYXllcl0sIGVsZW1lbnRbMF0pO1xuICAgICAgICAgICAgICAgIHRoYXQuX29mZk1vdXNlKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihcImVuZGVkXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKHRoYXQuc3RyZWFtLCAnc2xpZGVyJykudmFsKDApO1xuICAgICAgICAgICAgICAgIFV0aWxzLmV4ZWMoby5vbkVuZCwgW3ZpZGVvLCBwbGF5ZXJdLCBlbGVtZW50WzBdKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9vZmZNb3VzZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oXCJ2b2x1bWVjaGFuZ2VcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0Ll9zZXRWb2x1bWUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBwbGF5ZXIub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5wbGF5XCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKHZpZGVvLnBhdXNlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnBsYXkoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHBsYXllci5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLnN0b3BcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0LnN0b3AoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBwbGF5ZXIub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5tdXRlXCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5fdG9nZ2xlTXV0ZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHBsYXllci5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmxvb3BcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0Ll90b2dnbGVMb29wKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcGxheWVyLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuZnVsbFwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuZnVsbHNjcmVlbiA9ICF0aGF0LmZ1bGxzY3JlZW47XG4gICAgICAgICAgICAgICAgcGxheWVyLmZpbmQoXCIuZnVsbFwiKS5odG1sKHRoYXQuZnVsbHNjcmVlbiA9PT0gdHJ1ZSA/IG8uc2NyZWVuTGVzc0ljb24gOiBvLnNjcmVlbk1vcmVJY29uKTtcbiAgICAgICAgICAgICAgICBpZiAoby5mdWxsU2NyZWVuTW9kZSA9PT0gTWV0cm8uZnVsbFNjcmVlbk1vZGUuV0lORE9XKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LmZ1bGxzY3JlZW4gPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5hZGRDbGFzcyhcImZ1bGwtc2NyZWVuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnJlbW92ZUNsYXNzKFwiZnVsbC1zY3JlZW5cIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5mdWxsc2NyZWVuID09PSB0cnVlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIE1ldHJvLnJlcXVlc3RGdWxsU2NyZWVuKHZpZGVvKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQuZnVsbFNjcmVlbkludGVydmFsID09PSBmYWxzZSkgdGhhdC5mdWxsU2NyZWVuSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNZXRyby5pbkZ1bGxTY3JlZW4oKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5mdWxsc2NyZWVuID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhhdC5mdWxsU2NyZWVuSW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmZ1bGxTY3JlZW5JbnRlcnZhbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuZmluZChcIi5mdWxsXCIpLmh0bWwoby5zY3JlZW5Nb3JlSWNvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIE1ldHJvLmV4aXRGdWxsU2NyZWVuKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBpZiAodGhhdC5mdWxsc2NyZWVuID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgLy8gICAgICQoZG9jdW1lbnQpLm9uKE1ldHJvLmV2ZW50cy5rZXl1cCArIFwiLnZpZGVvLXBsYXllclwiLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IDI3KSB7XG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgcGxheWVyLmZpbmQoXCIuZnVsbFwiKS5jbGljaygpO1xuICAgICAgICAgICAgICAgIC8vICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vICAgICB9KTtcbiAgICAgICAgICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vICAgICAkKGRvY3VtZW50KS5vZmYoTWV0cm8uZXZlbnRzLmtleXVwICsgXCIudmlkZW8tcGxheWVyXCIpO1xuICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKHdpbmRvdykub24oTWV0cm8uZXZlbnRzLmtleXVwLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICBpZiAodGhhdC5mdWxsc2NyZWVuICYmIGUua2V5Q29kZSA9PT0gMjcpIHtcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyLmZpbmQoXCIuZnVsbFwiKS5jbGljaygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHtuczogdGhpcy5pZH0pO1xuXG4gICAgICAgICAgICAkKHdpbmRvdykub24oTWV0cm8uZXZlbnRzLnJlc2l6ZSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGF0Ll9zZXRBc3BlY3RSYXRpbygpO1xuICAgICAgICAgICAgfSwge25zOiB0aGlzLmlkfSk7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBfb25Nb3VzZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zLCBwbGF5ZXIgPSB0aGlzLnBsYXllcjtcblxuICAgICAgICAgICAgcGxheWVyLm9uKE1ldHJvLmV2ZW50cy5lbnRlciwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgY29udHJvbHMgPSBwbGF5ZXIuZmluZChcIi5jb250cm9sc1wiKTtcbiAgICAgICAgICAgICAgICBpZiAoby5jb250cm9sc0hpZGUgPiAwICYmIGNvbnRyb2xzLnN0eWxlKCdkaXNwbGF5JykgPT09ICdub25lJykge1xuICAgICAgICAgICAgICAgICAgICBjb250cm9scy5zdG9wKHRydWUpLmZhZGVJbig1MDAsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9scy5jc3MoXCJkaXNwbGF5XCIsIFwiZmxleFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHBsYXllci5vbihNZXRyby5ldmVudHMubGVhdmUsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGNvbnRyb2xzID0gcGxheWVyLmZpbmQoXCIuY29udHJvbHNcIik7XG4gICAgICAgICAgICAgICAgaWYgKG8uY29udHJvbHNIaWRlID4gMCAmJiBwYXJzZUludChjb250cm9scy5zdHlsZSgnb3BhY2l0eScpKSA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xzLnN0b3AodHJ1ZSkuZmFkZU91dCg1MDApO1xuICAgICAgICAgICAgICAgICAgICB9LCBvLmNvbnRyb2xzSGlkZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX29mZk1vdXNlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHBsYXllciA9IHRoaXMucGxheWVyLCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIGNvbnRyb2xzID0gcGxheWVyLmZpbmQoXCIuY29udHJvbHNcIik7XG5cbiAgICAgICAgICAgIHBsYXllci5vZmYoTWV0cm8uZXZlbnRzLmVudGVyKTtcbiAgICAgICAgICAgIHBsYXllci5vZmYoTWV0cm8uZXZlbnRzLmxlYXZlKTtcblxuICAgICAgICAgICAgaWYgKG8uY29udHJvbHNIaWRlID4gMCAmJiBjb250cm9scy5zdHlsZSgnZGlzcGxheScpID09PSAnbm9uZScpIHtcbiAgICAgICAgICAgICAgICBjb250cm9scy5zdG9wKHRydWUpLmZhZGVJbig1MDAsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xzLmNzcyhcImRpc3BsYXlcIiwgXCJmbGV4XCIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF90b2dnbGVMb29wOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGxvb3AgPSB0aGlzLnBsYXllci5maW5kKFwiLmxvb3BcIik7XG4gICAgICAgICAgICBpZiAobG9vcC5sZW5ndGggPT09IDApIHJldHVybiA7XG4gICAgICAgICAgICBsb29wLnRvZ2dsZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgaWYgKGxvb3AuaGFzQ2xhc3MoXCJhY3RpdmVcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYXR0cihcImxvb3BcIiwgXCJsb29wXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cihcImxvb3BcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3RvZ2dsZU11dGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLm11dGVkID0gIXRoaXMubXV0ZWQ7XG4gICAgICAgICAgICBpZiAodGhpcy5tdXRlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZpZGVvLnZvbHVtZSA9IHRoaXMudm9sdW1lQmFja3VwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZvbHVtZUJhY2t1cCA9IHRoaXMudmlkZW8udm9sdW1lO1xuICAgICAgICAgICAgICAgIHRoaXMudmlkZW8udm9sdW1lID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbih0aGlzLnZvbHVtZSwgJ3NsaWRlcicpLnZhbCh0aGlzLm11dGVkID09PSBmYWxzZSA/IHRoaXMudm9sdW1lQmFja3VwICogMTAwIDogMCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3NldEluZm86IGZ1bmN0aW9uKGEsIGIpe1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuZmluZChcIi5pbmZvLWJveFwiKS5odG1sKFV0aWxzLnNlY29uZHNUb0Zvcm1hdHRlZFN0cmluZyhNYXRoLnJvdW5kKGEpKSArIFwiIC8gXCIgKyBVdGlscy5zZWNvbmRzVG9Gb3JtYXR0ZWRTdHJpbmcoTWF0aC5yb3VuZChiKSkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9zZXRCdWZmZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy52aWRlby5idWZmZXJlZC5sZW5ndGggPyBNYXRoLnJvdW5kKE1hdGguZmxvb3IodGhpcy52aWRlby5idWZmZXJlZC5lbmQoMCkpIC8gTWF0aC5mbG9vcih0aGlzLnZpZGVvLmR1cmF0aW9uKSAqIDEwMCkgOiAwO1xuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKHRoaXMuc3RyZWFtLCAnc2xpZGVyJykuYnVmZihidWZmZXIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9zZXRWb2x1bWU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdmlkZW8gPSB0aGlzLnZpZGVvLCBwbGF5ZXIgPSB0aGlzLnBsYXllciwgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdmFyIHZvbHVtZUJ1dHRvbiA9IHBsYXllci5maW5kKFwiLm11dGVcIik7XG4gICAgICAgICAgICB2YXIgdm9sdW1lID0gdmlkZW8udm9sdW1lICogMTAwO1xuICAgICAgICAgICAgaWYgKHZvbHVtZSA+IDEgJiYgdm9sdW1lIDwgMzApIHtcbiAgICAgICAgICAgICAgICB2b2x1bWVCdXR0b24uaHRtbChvLnZvbHVtZUxvd0ljb24pO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh2b2x1bWUgPj0gMzAgJiYgdm9sdW1lIDwgNjApIHtcbiAgICAgICAgICAgICAgICB2b2x1bWVCdXR0b24uaHRtbChvLnZvbHVtZU1lZGl1bUljb24pO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh2b2x1bWUgPj0gNjAgJiYgdm9sdW1lIDw9IDEwMCkge1xuICAgICAgICAgICAgICAgIHZvbHVtZUJ1dHRvbi5odG1sKG8udm9sdW1lSGlnaEljb24pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2b2x1bWVCdXR0b24uaHRtbChvLm11dGVJY29uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfc2V0QXNwZWN0UmF0aW86IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wbGF5ZXIsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgd2lkdGggPSBwbGF5ZXIub3V0ZXJXaWR0aCgpO1xuICAgICAgICAgICAgdmFyIGhlaWdodDtcblxuICAgICAgICAgICAgc3dpdGNoIChvLmFzcGVjdFJhdGlvKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBNZXRyby5hc3BlY3RSYXRpby5TRDogaGVpZ2h0ID0gVXRpbHMuYXNwZWN0UmF0aW9IKHdpZHRoLCBcIjQvM1wiKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBNZXRyby5hc3BlY3RSYXRpby5DSU5FTUE6IGhlaWdodCA9IFV0aWxzLmFzcGVjdFJhdGlvSCh3aWR0aCwgXCIyMS85XCIpOyBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBoZWlnaHQgPSBVdGlscy5hc3BlY3RSYXRpb0god2lkdGgsIFwiMTYvOVwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGxheWVyLm91dGVySGVpZ2h0KGhlaWdodCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYXNwZWN0UmF0aW86IGZ1bmN0aW9uKHJhdGlvKXtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hc3BlY3RSYXRpbyA9IHJhdGlvO1xuICAgICAgICAgICAgdGhpcy5fc2V0QXNwZWN0UmF0aW8oKTtcbiAgICAgICAgfSxcblxuICAgICAgICBwbGF5OiBmdW5jdGlvbihzcmMpe1xuICAgICAgICAgICAgaWYgKHNyYyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2V0U291cmNlKHNyYyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmVsZW1lbnQuYXR0cihcInNyY1wiKSA9PT0gdW5kZWZpbmVkICYmIHRoaXMuZWxlbWVudC5maW5kKFwic291cmNlXCIpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuaXNQbGF5aW5nID0gdHJ1ZTtcblxuICAgICAgICAgICAgdGhpcy52aWRlby5wbGF5KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcGF1c2U6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmlzUGxheWluZyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy52aWRlby5wYXVzZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlc3VtZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmICh0aGlzLnZpZGVvLnBhdXNlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMucGxheSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHN0b3A6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmlzUGxheWluZyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy52aWRlby5wYXVzZSgpO1xuICAgICAgICAgICAgdGhpcy52aWRlby5jdXJyZW50VGltZSA9IDA7XG4gICAgICAgICAgICBNZXRyby5nZXRQbHVnaW4odGhpcy5zdHJlYW0sICdzbGlkZXInKS52YWwoMCk7XG4gICAgICAgICAgICB0aGlzLl9vZmZNb3VzZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldFZvbHVtZTogZnVuY3Rpb24odil7XG4gICAgICAgICAgICBpZiAodiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudmlkZW8udm9sdW1lO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodiA+IDEpIHtcbiAgICAgICAgICAgICAgICB2IC89IDEwMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy52aWRlby52b2x1bWUgPSB2O1xuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKHRoaXMudm9sdW1lWzBdLCAnc2xpZGVyJykudmFsKHYqMTAwKTtcbiAgICAgICAgfSxcblxuICAgICAgICBsb29wOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5fdG9nZ2xlTG9vcCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG11dGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLl90b2dnbGVNdXRlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXNwZWN0UmF0aW86IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuYXNwZWN0UmF0aW8gPSB0aGlzLmVsZW1lbnQuYXR0cihcImRhdGEtYXNwZWN0LXJhdGlvXCIpO1xuICAgICAgICAgICAgdGhpcy5fc2V0QXNwZWN0UmF0aW8oKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VTb3VyY2U6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgc3JjID0gSlNPTi5wYXJzZSh0aGlzLmVsZW1lbnQuYXR0cignZGF0YS1zcmMnKSk7XG4gICAgICAgICAgICB0aGlzLnBsYXkoc3JjKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VWb2x1bWU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdm9sdW1lID0gdGhpcy5lbGVtZW50LmF0dHIoXCJkYXRhLXZvbHVtZVwiKTtcbiAgICAgICAgICAgIHRoaXMuc2V0Vm9sdW1lKHZvbHVtZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lKXtcbiAgICAgICAgICAgIHN3aXRjaCAoYXR0cmlidXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLWFzcGVjdC1yYXRpb1wiOiB0aGlzLmNoYW5nZUFzcGVjdFJhdGlvKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLXNyY1wiOiB0aGlzLmNoYW5nZVNvdXJjZSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS12b2x1bWVcIjogdGhpcy5jaGFuZ2VWb2x1bWUoKTsgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBwbGF5ZXIgPSB0aGlzLnBsYXllcjtcblxuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKHRoaXMuc3RyZWFtLCBcInNsaWRlclwiKS5kZXN0cm95KCk7XG4gICAgICAgICAgICBNZXRyby5nZXRQbHVnaW4odGhpcy52b2x1bWUsIFwic2xpZGVyXCIpLmRlc3Ryb3koKTtcblxuICAgICAgICAgICAgZWxlbWVudC5vZmYoXCJsb2Fkc3RhcnRcIik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihcImxvYWRlZG1ldGFkYXRhXCIpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoXCJjYW5wbGF5XCIpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoXCJwcm9ncmVzc1wiKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKFwidGltZXVwZGF0ZVwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKFwid2FpdGluZ1wiKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKFwibG9hZGVkZGF0YVwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKFwicGxheVwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKFwicGF1c2VcIik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihcInN0b3BcIik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihcImVuZGVkXCIpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoXCJ2b2x1bWVjaGFuZ2VcIik7XG5cbiAgICAgICAgICAgIHBsYXllci5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5wbGF5XCIpO1xuICAgICAgICAgICAgcGxheWVyLm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLnN0b3BcIik7XG4gICAgICAgICAgICBwbGF5ZXIub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIubXV0ZVwiKTtcbiAgICAgICAgICAgIHBsYXllci5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5sb29wXCIpO1xuICAgICAgICAgICAgcGxheWVyLm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmZ1bGxcIik7XG5cbiAgICAgICAgICAgICQod2luZG93KS5vZmYoTWV0cm8uZXZlbnRzLmtleXVwLHtuczogdGhpcy5pZH0pO1xuICAgICAgICAgICAgJCh3aW5kb3cpLm9mZihNZXRyby5ldmVudHMucmVzaXplLHtuczogdGhpcy5pZH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgVmlld3BvcnRDaGVja0RlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIG9uVmlld3BvcnQ6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uVmlld3BvcnRFbnRlcjogTWV0cm8ubm9vcCxcbiAgICAgICAgb25WaWV3cG9ydExlYXZlOiBNZXRyby5ub29wLFxuICAgICAgICBvblZpZXdwb3J0Q2hlY2tDcmVhdGU6IE1ldHJvLm5vb3BcbiAgICB9O1xuXG4gICAgTWV0cm8udmlld3BvcnRDaGVja1NldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgVmlld3BvcnRDaGVja0RlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgVmlld3BvcnRDaGVja0RlZmF1bHRDb25maWcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tcIm1ldHJvVmlld3BvcnRDaGVja1NldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8udmlld3BvcnRDaGVja1NldHVwKHdpbmRvd1tcIm1ldHJvVmlld3BvcnRDaGVja1NldHVwXCJdKTtcbiAgICB9XG5cbiAgICBNZXRyby5Db21wb25lbnQoJ3ZpZXdwb3J0LWNoZWNrJywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIFZpZXdwb3J0Q2hlY2tEZWZhdWx0Q29uZmlnLCB7XG4gICAgICAgICAgICAgICAgLy8gZGVmaW5lIGluc3RhbmNlIHZhcnMgaGVyZVxuICAgICAgICAgICAgICAgIGluVmlld3BvcnQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlkOiBVdGlscy5lbGVtZW50SWQoXCJ2aWV3cG9ydC1jaGVja1wiKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5pblZpZXdwb3J0ID0gVXRpbHMuaW5WaWV3cG9ydCh0aGlzLmVsZW0pO1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVFdmVudHMoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KCd2aWV3cG9ydC1jaGVjay1jcmVhdGUnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlRXZlbnRzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBlbGVtID0gdGhpcy5lbGVtO1xuXG4gICAgICAgICAgICAkKHdpbmRvdykub24oTWV0cm8uZXZlbnRzLnNjcm9sbCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgb2xkU3RhdGUgPSB0aGF0LmluVmlld3BvcnQ7XG5cbiAgICAgICAgICAgICAgICB0aGF0LmluVmlld3BvcnQgPSBVdGlscy5pblZpZXdwb3J0KGVsZW0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKG9sZFN0YXRlICE9PSB0aGF0LmluVmlld3BvcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQuaW5WaWV3cG9ydCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwidmlld3BvcnQtZW50ZXJcIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJ2aWV3cG9ydC1sZWF2ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInZpZXdwb3J0XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdGU6IHRoYXQuaW5WaWV3cG9ydFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwge25zOiB0aGF0LmlkfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc3RhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pblZpZXdwb3J0O1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkKHdpbmRvdykub2ZmKE1ldHJvLmV2ZW50cy5zY3JvbGwsIHtuczogdGhpcy5pZH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgICAgICB9XG4gICAgfSk7XG59KE1ldHJvLCBtNHEpKTtcclxuXHJcbihmdW5jdGlvbihNZXRybywgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgVXRpbHMgPSBNZXRyby51dGlscztcbiAgICB2YXIgV2luZG93RGVmYXVsdENvbmZpZyA9IHtcbiAgICAgICAgd2luZG93RGVmZXJyZWQ6IDAsXG4gICAgICAgIGhpZGRlbjogZmFsc2UsXG4gICAgICAgIHdpZHRoOiBcImF1dG9cIixcbiAgICAgICAgaGVpZ2h0OiBcImF1dG9cIixcbiAgICAgICAgYnRuQ2xvc2U6IHRydWUsXG4gICAgICAgIGJ0bk1pbjogdHJ1ZSxcbiAgICAgICAgYnRuTWF4OiB0cnVlLFxuICAgICAgICBkcmFnZ2FibGU6IHRydWUsXG4gICAgICAgIGRyYWdFbGVtZW50OiBcIi53aW5kb3ctY2FwdGlvbiAuaWNvbiwgLndpbmRvdy1jYXB0aW9uIC50aXRsZVwiLFxuICAgICAgICBkcmFnQXJlYTogXCJwYXJlbnRcIixcbiAgICAgICAgc2hhZG93OiBmYWxzZSxcbiAgICAgICAgaWNvbjogXCJcIixcbiAgICAgICAgdGl0bGU6IFwiV2luZG93XCIsXG4gICAgICAgIGNvbnRlbnQ6IG51bGwsXG4gICAgICAgIHJlc2l6YWJsZTogdHJ1ZSxcbiAgICAgICAgb3ZlcmxheTogZmFsc2UsXG4gICAgICAgIG92ZXJsYXlDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgb3ZlcmxheUFscGhhOiAuNSxcbiAgICAgICAgbW9kYWw6IGZhbHNlLFxuICAgICAgICBwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLFxuICAgICAgICBjaGVja0VtYmVkOiB0cnVlLFxuICAgICAgICB0b3A6IFwiYXV0b1wiLFxuICAgICAgICBsZWZ0OiBcImF1dG9cIixcbiAgICAgICAgcGxhY2U6IFwiYXV0b1wiLFxuICAgICAgICBjbG9zZUFjdGlvbjogTWV0cm8uYWN0aW9ucy5SRU1PVkUsXG4gICAgICAgIGN1c3RvbUJ1dHRvbnM6IG51bGwsXG5cbiAgICAgICAgY2xzQ3VzdG9tQnV0dG9uOiBcIlwiLFxuICAgICAgICBjbHNDYXB0aW9uOiBcIlwiLFxuICAgICAgICBjbHNDb250ZW50OiBcIlwiLFxuICAgICAgICBjbHNXaW5kb3c6IFwiXCIsXG5cbiAgICAgICAgX3J1bnRpbWU6IGZhbHNlLFxuXG4gICAgICAgIG1pbldpZHRoOiAwLFxuICAgICAgICBtaW5IZWlnaHQ6IDAsXG4gICAgICAgIG1heFdpZHRoOiAwLFxuICAgICAgICBtYXhIZWlnaHQ6IDAsXG4gICAgICAgIG9uRHJhZ1N0YXJ0OiBNZXRyby5ub29wLFxuICAgICAgICBvbkRyYWdTdG9wOiBNZXRyby5ub29wLFxuICAgICAgICBvbkRyYWdNb3ZlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkNhcHRpb25EYmxDbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25DbG9zZUNsaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvbk1heENsaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvbk1pbkNsaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvblJlc2l6ZVN0YXJ0OiBNZXRyby5ub29wLFxuICAgICAgICBvblJlc2l6ZVN0b3A6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uUmVzaXplOiBNZXRyby5ub29wLFxuICAgICAgICBvbldpbmRvd0NyZWF0ZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25TaG93OiBNZXRyby5ub29wLFxuICAgICAgICBvbldpbmRvd0Rlc3Ryb3k6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uQ2FuQ2xvc2U6IE1ldHJvLm5vb3BfdHJ1ZSxcbiAgICAgICAgb25DbG9zZTogTWV0cm8ubm9vcFxuICAgIH07XG5cbiAgICBNZXRyby53aW5kb3dTZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIFdpbmRvd0RlZmF1bHRDb25maWcgPSAkLmV4dGVuZCh7fSwgV2luZG93RGVmYXVsdENvbmZpZywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2Ygd2luZG93W1wibWV0cm9XaW5kb3dTZXR1cFwiXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE1ldHJvLndpbmRvd1NldHVwKHdpbmRvd1tcIm1ldHJvV2luZG93U2V0dXBcIl0pO1xuICAgIH1cblxuICAgIE1ldHJvLkNvbXBvbmVudCgnd2luZG93Jywge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGVsZW0sIG9wdGlvbnMsIFdpbmRvd0RlZmF1bHRDb25maWcsIHtcbiAgICAgICAgICAgICAgICB3aW46IG51bGwsXG4gICAgICAgICAgICAgICAgb3ZlcmxheTogbnVsbCxcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IDBcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGhpZGRlbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgY29udGVudDogbnVsbFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgd2luLCBvdmVybGF5O1xuICAgICAgICAgICAgdmFyIHBhcmVudCA9IG8uZHJhZ0FyZWEgPT09IFwicGFyZW50XCIgPyBlbGVtZW50LnBhcmVudCgpIDogJChvLmRyYWdBcmVhKTtcbiAgICAgICAgICAgIHZhciBfY29udGVudDtcblxuICAgICAgICAgICAgaWYgKG8ubW9kYWwgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBvLmJ0bk1heCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIG8uYnRuTWluID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgby5yZXNpemFibGUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzTnVsbChvLmNvbnRlbnQpKSB7XG4gICAgICAgICAgICAgICAgby5jb250ZW50ID0gZWxlbWVudDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzVXJsKG8uY29udGVudCkgJiYgVXRpbHMuaXNWaWRlb1VybChvLmNvbnRlbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgIG8uY29udGVudCA9IFV0aWxzLmVtYmVkVXJsKG8uY29udGVudCk7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogXCIxMDAlXCJcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlXG5cbiAgICAgICAgICAgICAgICBpZiAoIVV0aWxzLmlzUShvLmNvbnRlbnQpICYmIFV0aWxzLmlzRnVuYyhvLmNvbnRlbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgIG8uY29udGVudCA9IFV0aWxzLmV4ZWMoby5jb250ZW50KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBfY29udGVudCA9ICQoby5jb250ZW50KTtcbiAgICAgICAgICAgICAgICBpZiAoX2NvbnRlbnQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kVGV4dChvLmNvbnRlbnQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kKF9jb250ZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgby5jb250ZW50ID0gZWxlbWVudDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uX3J1bnRpbWUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lKGVsZW1lbnQsIFwid2luZG93XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB3aW4gPSB0aGlzLl93aW5kb3cobyk7XG4gICAgICAgICAgICB3aW4uYWRkQ2xhc3MoXCJuby12aXNpYmxlXCIpO1xuXG4gICAgICAgICAgICBwYXJlbnQuYXBwZW5kKHdpbik7XG5cbiAgICAgICAgICAgIGlmIChvLm92ZXJsYXkgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBvdmVybGF5ID0gdGhpcy5fb3ZlcmxheSgpO1xuICAgICAgICAgICAgICAgIG92ZXJsYXkuYXBwZW5kVG8od2luLnBhcmVudCgpKTtcbiAgICAgICAgICAgICAgICB0aGlzLm92ZXJsYXkgPSBvdmVybGF5O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLndpbiA9IHdpbjtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwid2luZG93LWNyZWF0ZVwiLCB7XG4gICAgICAgICAgICAgICAgd2luOiB0aGlzLndpblswXSxcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuX3NldFBvc2l0aW9uKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoby5oaWRkZW4gIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC53aW4ucmVtb3ZlQ2xhc3MoXCJuby12aXNpYmxlXCIpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcInNob3dcIiwge1xuICAgICAgICAgICAgICAgICAgICB3aW46IHRoYXQud2luWzBdLFxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LCAxMDApO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9zZXRQb3NpdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHdpbiA9IHRoaXMud2luO1xuICAgICAgICAgICAgdmFyIHBhcmVudCA9IG8uZHJhZ0FyZWEgPT09IFwicGFyZW50XCIgPyB3aW4ucGFyZW50KCkgOiAkKG8uZHJhZ0FyZWEpO1xuICAgICAgICAgICAgdmFyIHRvcF9jZW50ZXIgPSBwYXJlbnQuaGVpZ2h0KCkgLyAyIC0gd2luWzBdLm9mZnNldEhlaWdodCAvIDI7XG4gICAgICAgICAgICB2YXIgbGVmdF9jZW50ZXIgPSBwYXJlbnQud2lkdGgoKSAvIDIgLSB3aW5bMF0ub2Zmc2V0V2lkdGggLyAyO1xuICAgICAgICAgICAgdmFyIHRvcCwgbGVmdCwgcmlnaHQsIGJvdHRvbTtcblxuICAgICAgICAgICAgaWYgKG8ucGxhY2UgIT09ICdhdXRvJykge1xuXG4gICAgICAgICAgICAgICAgc3dpdGNoIChvLnBsYWNlLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInRvcC1sZWZ0XCI6IHRvcCA9IDA7IGxlZnQgPSAwOyByaWdodCA9IFwiYXV0b1wiOyBib3R0b20gPSBcImF1dG9cIjsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJ0b3AtY2VudGVyXCI6IHRvcCA9IDA7IGxlZnQgPSBsZWZ0X2NlbnRlcjsgcmlnaHQgPSBcImF1dG9cIjsgYm90dG9tID0gXCJhdXRvXCI7IGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwidG9wLXJpZ2h0XCI6IHRvcCA9IDA7IHJpZ2h0ID0gMDsgbGVmdCA9IFwiYXV0b1wiOyBib3R0b20gPSBcImF1dG9cIjsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJyaWdodC1jZW50ZXJcIjogdG9wID0gdG9wX2NlbnRlcjsgcmlnaHQgPSAwOyBsZWZ0ID0gXCJhdXRvXCI7IGJvdHRvbSA9IFwiYXV0b1wiOyBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImJvdHRvbS1yaWdodFwiOiBib3R0b20gPSAwOyByaWdodCA9IDA7IGxlZnQgPSBcImF1dG9cIjsgdG9wID0gXCJhdXRvXCI7IGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiYm90dG9tLWNlbnRlclwiOiBib3R0b20gPSAwOyBsZWZ0ID0gbGVmdF9jZW50ZXI7IHJpZ2h0ID0gXCJhdXRvXCI7IHRvcCA9IFwiYXV0b1wiOyBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImJvdHRvbS1sZWZ0XCI6IGJvdHRvbSA9IDA7IGxlZnQgPSAwOyByaWdodCA9IFwiYXV0b1wiOyB0b3AgPSBcImF1dG9cIjsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJsZWZ0LWNlbnRlclwiOiB0b3AgPSB0b3BfY2VudGVyOyBsZWZ0ID0gMDsgcmlnaHQgPSBcImF1dG9cIjsgYm90dG9tID0gXCJhdXRvXCI7IGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB0b3AgPSB0b3BfY2VudGVyOyBsZWZ0ID0gbGVmdF9jZW50ZXI7IGJvdHRvbSA9IFwiYXV0b1wiOyByaWdodCA9IFwiYXV0b1wiO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHdpbi5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB0b3A6IHRvcCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogbGVmdCxcbiAgICAgICAgICAgICAgICAgICAgYm90dG9tOiBib3R0b20sXG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0OiByaWdodFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF93aW5kb3c6IGZ1bmN0aW9uKG8pe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIHdpbiwgY2FwdGlvbiwgY29udGVudCwgaWNvbiwgdGl0bGUsIGJ1dHRvbnMsIGJ0bkNsb3NlLCBidG5NaW4sIGJ0bk1heCwgcmVzaXplciwgc3RhdHVzO1xuICAgICAgICAgICAgdmFyIHdpZHRoID0gby53aWR0aCwgaGVpZ2h0ID0gby5oZWlnaHQ7XG5cbiAgICAgICAgICAgIHdpbiA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcIndpbmRvd1wiKTtcblxuICAgICAgICAgICAgaWYgKG8ubW9kYWwgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB3aW4uYWRkQ2xhc3MoXCJtb2RhbFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2FwdGlvbiA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcIndpbmRvdy1jYXB0aW9uXCIpO1xuICAgICAgICAgICAgY29udGVudCA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcIndpbmRvdy1jb250ZW50XCIpO1xuXG4gICAgICAgICAgICB3aW4uYXBwZW5kKGNhcHRpb24pO1xuICAgICAgICAgICAgd2luLmFwcGVuZChjb250ZW50KTtcblxuICAgICAgICAgICAgaWYgKG8uc3RhdHVzID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgc3RhdHVzID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwid2luZG93LXN0YXR1c1wiKTtcbiAgICAgICAgICAgICAgICB3aW4uYXBwZW5kKHN0YXR1cyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLnNoYWRvdyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHdpbi5hZGRDbGFzcyhcIndpbi1zaGFkb3dcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5pc1ZhbHVlKG8uaWNvbikpIHtcbiAgICAgICAgICAgICAgICBpY29uID0gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcImljb25cIikuaHRtbChvLmljb24pO1xuICAgICAgICAgICAgICAgIGljb24uYXBwZW5kVG8oY2FwdGlvbik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRpdGxlID0gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcInRpdGxlXCIpLmh0bWwoVXRpbHMuaXNWYWx1ZShvLnRpdGxlKSA/IG8udGl0bGUgOiBcIiZuYnNwO1wiKTtcbiAgICAgICAgICAgIHRpdGxlLmFwcGVuZFRvKGNhcHRpb24pO1xuXG4gICAgICAgICAgICBpZiAoIVV0aWxzLmlzTnVsbChvLmNvbnRlbnQpKSB7XG4gICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzUShvLmNvbnRlbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgIG8uY29udGVudC5hcHBlbmRUbyhjb250ZW50KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50Lmh0bWwoby5jb250ZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJ1dHRvbnMgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJidXR0b25zXCIpO1xuICAgICAgICAgICAgYnV0dG9ucy5hcHBlbmRUbyhjYXB0aW9uKTtcblxuICAgICAgICAgICAgaWYgKG8uYnRuTWF4ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgYnRuTWF4ID0gJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcImJ1dHRvbiBidG4tbWF4IHN5cy1idXR0b25cIik7XG4gICAgICAgICAgICAgICAgYnRuTWF4LmFwcGVuZFRvKGJ1dHRvbnMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5idG5NaW4gPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBidG5NaW4gPSAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwiYnV0dG9uIGJ0bi1taW4gc3lzLWJ1dHRvblwiKTtcbiAgICAgICAgICAgICAgICBidG5NaW4uYXBwZW5kVG8oYnV0dG9ucyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvLmJ0bkNsb3NlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgYnRuQ2xvc2UgPSAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwiYnV0dG9uIGJ0bi1jbG9zZSBzeXMtYnV0dG9uXCIpO1xuICAgICAgICAgICAgICAgIGJ0bkNsb3NlLmFwcGVuZFRvKGJ1dHRvbnMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNWYWx1ZShvLmN1c3RvbUJ1dHRvbnMpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGN1c3RvbUJ1dHRvbnMgPSBbXTtcblxuICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc09iamVjdChvLmN1c3RvbUJ1dHRvbnMpICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICBvLmN1c3RvbUJ1dHRvbnMgPSBVdGlscy5pc09iamVjdChvLmN1c3RvbUJ1dHRvbnMpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygby5jdXN0b21CdXR0b25zID09PSBcInN0cmluZ1wiICYmIG8uY3VzdG9tQnV0dG9ucy5pbmRleE9mKFwie1wiKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbUJ1dHRvbnMgPSBKU09OLnBhcnNlKG8uY3VzdG9tQnV0dG9ucyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygby5jdXN0b21CdXR0b25zID09PSBcIm9iamVjdFwiICYmIFV0aWxzLm9iamVjdExlbmd0aChvLmN1c3RvbUJ1dHRvbnMpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBjdXN0b21CdXR0b25zID0gby5jdXN0b21CdXR0b25zO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcIlVua25vd24gZm9ybWF0IGZvciBjdXN0b20gYnV0dG9uc1wiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkLmVhY2goY3VzdG9tQnV0dG9ucywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY3VzdG9tQnV0dG9uID0gJChcIjxzcGFuPlwiKTtcblxuICAgICAgICAgICAgICAgICAgICBjdXN0b21CdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcImJ1dHRvbiBidG4tY3VzdG9tXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3Moby5jbHNDdXN0b21CdXR0b24pXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoaXRlbS5jbHMpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInRhYmluZGV4XCIsIC0xKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmh0bWwoaXRlbS5odG1sKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5hdHRyICYmIHR5cGVvZiBpdGVtLmF0dHIgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goaXRlbS5hdHRyLCBmdW5jdGlvbihrLCB2KXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21CdXR0b24uYXR0cihDYWtlLmRhc2hlZE5hbWUoayksIHYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjdXN0b21CdXR0b24uZGF0YShcImFjdGlvblwiLCBpdGVtLm9uY2xpY2spO1xuXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbnMucHJlcGVuZChjdXN0b21CdXR0b24pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjYXB0aW9uLm9uKE1ldHJvLmV2ZW50cy5zdG9wLCBcIi5idG4tY3VzdG9tXCIsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc1JpZ2h0TW91c2UoZSkpIHJldHVybjtcbiAgICAgICAgICAgICAgICB2YXIgYnV0dG9uID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgYWN0aW9uID0gYnV0dG9uLmRhdGEoXCJhY3Rpb25cIik7XG4gICAgICAgICAgICAgICAgVXRpbHMuZXhlYyhhY3Rpb24sIFtidXR0b25dLCB0aGlzKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB3aW4uYXR0cihcImlkXCIsIG8uaWQgPT09IHVuZGVmaW5lZCA/IFV0aWxzLmVsZW1lbnRJZChcIndpbmRvd1wiKSA6IG8uaWQpO1xuXG4gICAgICAgICAgICB3aW4ub24oTWV0cm8uZXZlbnRzLmRibGNsaWNrLCBcIi53aW5kb3ctY2FwdGlvblwiLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICB0aGF0Lm1heGltaXplZChlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjYXB0aW9uLm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIuYnRuLW1heCwgLmJ0bi1taW4sIC5idG4tY2xvc2VcIiwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgaWYgKFV0aWxzLmlzUmlnaHRNb3VzZShlKSkgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSAkKGUudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0Lmhhc0NsYXNzKFwiYnRuLW1heFwiKSkgdGhhdC5tYXhpbWl6ZWQoZSk7XG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldC5oYXNDbGFzcyhcImJ0bi1taW5cIikpIHRoYXQubWluaW1pemVkKGUpO1xuICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuaGFzQ2xhc3MoXCJidG4tY2xvc2VcIikpIHRoYXQuY2xvc2UoZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKG8uZHJhZ2dhYmxlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgTWV0cm8ubWFrZVBsdWdpbih3aW4sIFwiZHJhZ2dhYmxlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgZHJhZ0NvbnRleHQ6IHdpblswXSxcbiAgICAgICAgICAgICAgICAgICAgZHJhZ0VsZW1lbnQ6IG8uZHJhZ0VsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgIGRyYWdBcmVhOiBvLmRyYWdBcmVhLFxuICAgICAgICAgICAgICAgICAgICBvbkRyYWdTdGFydDogby5vbkRyYWdTdGFydCxcbiAgICAgICAgICAgICAgICAgICAgb25EcmFnU3RvcDogby5vbkRyYWdTdG9wLFxuICAgICAgICAgICAgICAgICAgICBvbkRyYWdNb3ZlOiBvLm9uRHJhZ01vdmVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgd2luLmFkZENsYXNzKG8uY2xzV2luZG93KTtcbiAgICAgICAgICAgIGNhcHRpb24uYWRkQ2xhc3Moby5jbHNDYXB0aW9uKTtcbiAgICAgICAgICAgIGNvbnRlbnQuYWRkQ2xhc3Moby5jbHNDb250ZW50KTtcblxuICAgICAgICAgICAgaWYgKG8ubWluV2lkdGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBvLm1pbldpZHRoID0gMzQ7XG4gICAgICAgICAgICAgICAgJC5lYWNoKGJ1dHRvbnMuY2hpbGRyZW4oXCIuYnRuLWN1c3RvbVwiKSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgby5taW5XaWR0aCArPSBVdGlscy5oaWRkZW5FbGVtZW50U2l6ZSh0aGlzKS53aWR0aDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoby5idG5NYXgpIG8ubWluV2lkdGggKz0gMzQ7XG4gICAgICAgICAgICAgICAgaWYgKG8uYnRuTWluKSBvLm1pbldpZHRoICs9IDM0O1xuICAgICAgICAgICAgICAgIGlmIChvLmJ0bkNsb3NlKSBvLm1pbldpZHRoICs9IDM0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoby5taW5XaWR0aCA+IDAgJiYgIWlzTmFOKG8ud2lkdGgpICYmIG8ud2lkdGggPCBvLm1pbldpZHRoKSB7XG4gICAgICAgICAgICAgICAgd2lkdGggPSBvLm1pbldpZHRoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG8ubWluSGVpZ2h0ID4gMCAmJiAhaXNOYU4oby5oZWlnaHQpICYmIG8uaGVpZ2h0ID4gby5taW5IZWlnaHQpIHtcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSBvLm1pbkhlaWdodDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8ucmVzaXphYmxlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgcmVzaXplciA9ICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJyZXNpemUtZWxlbWVudFwiKTtcbiAgICAgICAgICAgICAgICByZXNpemVyLmFwcGVuZFRvKHdpbik7XG4gICAgICAgICAgICAgICAgd2luLmFkZENsYXNzKFwicmVzaXphYmxlXCIpO1xuXG4gICAgICAgICAgICAgICAgTWV0cm8ubWFrZVBsdWdpbih3aW4sIFwicmVzaXphYmxlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgbWluV2lkdGg6IG8ubWluV2lkdGgsXG4gICAgICAgICAgICAgICAgICAgIG1pbkhlaWdodDogby5taW5IZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIG1heFdpZHRoOiBvLm1heFdpZHRoLFxuICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IG8ubWF4SGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICByZXNpemVFbGVtZW50OiBcIi5yZXNpemUtZWxlbWVudFwiLFxuICAgICAgICAgICAgICAgICAgICBvblJlc2l6ZVN0YXJ0OiBvLm9uUmVzaXplU3RhcnQsXG4gICAgICAgICAgICAgICAgICAgIG9uUmVzaXplU3RvcDogby5vblJlc2l6ZVN0b3AsXG4gICAgICAgICAgICAgICAgICAgIG9uUmVzaXplOiBvLm9uUmVzaXplXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHdpbi5jc3Moe1xuICAgICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogby5wb3NpdGlvbixcbiAgICAgICAgICAgICAgICB0b3A6IG8udG9wLFxuICAgICAgICAgICAgICAgIGxlZnQ6IG8ubGVmdFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB3aW47XG4gICAgICAgIH0sXG5cbiAgICAgICAgX292ZXJsYXk6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdmFyIG92ZXJsYXkgPSAkKFwiPGRpdj5cIik7XG4gICAgICAgICAgICBvdmVybGF5LmFkZENsYXNzKFwib3ZlcmxheVwiKTtcblxuICAgICAgICAgICAgaWYgKG8ub3ZlcmxheUNvbG9yID09PSAndHJhbnNwYXJlbnQnKSB7XG4gICAgICAgICAgICAgICAgb3ZlcmxheS5hZGRDbGFzcyhcInRyYW5zcGFyZW50XCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvdmVybGF5LmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IE1ldHJvLmNvbG9ycy50b1JHQkEoby5vdmVybGF5Q29sb3IsIG8ub3ZlcmxheUFscGhhKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gb3ZlcmxheTtcbiAgICAgICAgfSxcblxuICAgICAgICB3aWR0aDogZnVuY3Rpb24odil7XG4gICAgICAgICAgICB2YXIgd2luID0gdGhpcy53aW47XG5cbiAgICAgICAgICAgIGlmICghVXRpbHMuaXNWYWx1ZSh2KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB3aW4ud2lkdGgoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgd2luLmNzcyhcIndpZHRoXCIsIHBhcnNlSW50KHYpKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGVpZ2h0OiBmdW5jdGlvbih2KXtcbiAgICAgICAgICAgIHZhciB3aW4gPSB0aGlzLndpbjtcblxuICAgICAgICAgICAgaWYgKCFVdGlscy5pc1ZhbHVlKHYpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHdpbi5oZWlnaHQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgd2luLmNzcyhcImhlaWdodFwiLCBwYXJzZUludCh2KSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIG1heGltaXplZDogZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICB2YXIgd2luID0gdGhpcy53aW4sIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gJChlLnRhcmdldCk7XG5cbiAgICAgICAgICAgIGlmIChvLmJ0bk1heCkge1xuICAgICAgICAgICAgICAgIHdpbi5yZW1vdmVDbGFzcyhcIm1pbmltaXplZFwiKTtcbiAgICAgICAgICAgICAgICB3aW4udG9nZ2xlQ2xhc3MoXCJtYXhpbWl6ZWRcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQuaGFzQ2xhc3MgJiYgdGFyZ2V0Lmhhc0NsYXNzKFwidGl0bGVcIikpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImNhcHRpb24tZGJsLWNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgd2luOiB3aW5bMF1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcIm1heC1jbGlja1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIHdpbjogd2luWzBdXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBtaW5pbWl6ZWQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgd2luID0gdGhpcy53aW4sIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmIChvLmJ0bk1pbikge1xuICAgICAgICAgICAgICAgIHdpbi5yZW1vdmVDbGFzcyhcIm1heGltaXplZFwiKTtcbiAgICAgICAgICAgICAgICB3aW4udG9nZ2xlQ2xhc3MoXCJtaW5pbWl6ZWRcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcIm1pbi1jbGlja1wiLCB7XG4gICAgICAgICAgICAgICAgd2luOiB3aW5bMF1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNsb3NlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCB3aW4gPSB0aGlzLndpbiwgIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmIChVdGlscy5leGVjKG8ub25DYW5DbG9zZSwgW3dpbl0pID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHRpbWVvdXQgPSAwO1xuXG4gICAgICAgICAgICBpZiAoby5vbkNsb3NlICE9PSBNZXRyby5ub29wKSB7XG4gICAgICAgICAgICAgICAgdGltZW91dCA9IDUwMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwiY2xvc2VcIiwge1xuICAgICAgICAgICAgICAgIHdpbjogd2luWzBdXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmIChvLm1vZGFsID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbi5zaWJsaW5ncyhcIi5vdmVybGF5XCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImNsb3NlLWNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgd2luOiB3aW5bMF1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChvLmNsb3NlQWN0aW9uID09PSBNZXRyby5hY3Rpb25zLlJFTU9WRSkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJ3aW5kb3ctZGVzdHJveVwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW46IHdpblswXVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgd2luLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaGlkZSgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSwgdGltZW91dCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGlkZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB3aW4gPSB0aGlzLndpbjtcblxuICAgICAgICAgICAgd2luLmNzcyh7XG4gICAgICAgICAgICAgICAgZGlzcGxheTogXCJub25lXCJcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJoaWRlXCIsIHtcbiAgICAgICAgICAgICAgICB3aW46IHdpblswXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2hvdzogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB3aW4gPSB0aGlzLndpbjtcblxuICAgICAgICAgICAgd2luXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwibm8tdmlzaWJsZVwiKVxuICAgICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBcImZsZXhcIlxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJzaG93XCIsIHtcbiAgICAgICAgICAgICAgICB3aW46IHdpblswXVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiAodGhpcy53aW4uY3NzKFwiZGlzcGxheVwiKSA9PT0gXCJub25lXCIgfHwgdGhpcy53aW4uaGFzQ2xhc3MoXCJuby12aXNpYmxlXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93KCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGlzT3BlbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLndpbi5oYXNDbGFzcyhcIm5vLXZpc2libGVcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbWluOiBmdW5jdGlvbihhKXtcbiAgICAgICAgICAgIGEgPyB0aGlzLndpbi5hZGRDbGFzcyhcIm1pbmltaXplZFwiKSA6IHRoaXMud2luLnJlbW92ZUNsYXNzKFwibWluaW1pemVkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG1heDogZnVuY3Rpb24oYSl7XG4gICAgICAgICAgICBhID8gdGhpcy53aW4uYWRkQ2xhc3MoXCJtYXhpbWl6ZWRcIikgOiB0aGlzLndpbi5yZW1vdmVDbGFzcyhcIm1heGltaXplZFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VDbGFzczogZnVuY3Rpb24oYSl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgd2luID0gdGhpcy53aW4sIG8gPSB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIGlmIChhID09PSBcImRhdGEtY2xzLXdpbmRvd1wiKSB7XG4gICAgICAgICAgICAgICAgd2luWzBdLmNsYXNzTmFtZSA9IFwid2luZG93IFwiICsgKG8ucmVzaXphYmxlID8gXCIgcmVzaXphYmxlIFwiIDogXCIgXCIpICsgZWxlbWVudC5hdHRyKFwiZGF0YS1jbHMtd2luZG93XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGEgPT09IFwiZGF0YS1jbHMtY2FwdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgd2luLmZpbmQoXCIud2luZG93LWNhcHRpb25cIilbMF0uY2xhc3NOYW1lID0gXCJ3aW5kb3ctY2FwdGlvbiBcIiArIGVsZW1lbnQuYXR0cihcImRhdGEtY2xzLWNhcHRpb25cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYSA9PT0gXCJkYXRhLWNscy1jb250ZW50XCIpIHtcbiAgICAgICAgICAgICAgICB3aW4uZmluZChcIi53aW5kb3ctY29udGVudFwiKVswXS5jbGFzc05hbWUgPSBcIndpbmRvdy1jb250ZW50IFwiICsgZWxlbWVudC5hdHRyKFwiZGF0YS1jbHMtY29udGVudFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGVTaGFkb3c6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgd2luID0gdGhpcy53aW47XG4gICAgICAgICAgICB2YXIgZmxhZyA9IEpTT04ucGFyc2UoZWxlbWVudC5hdHRyKFwiZGF0YS1zaGFkb3dcIikpO1xuICAgICAgICAgICAgaWYgKGZsYWcgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB3aW4uYWRkQ2xhc3MoXCJ3aW4tc2hhZG93XCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB3aW4ucmVtb3ZlQ2xhc3MoXCJ3aW4tc2hhZG93XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldENvbnRlbnQ6IGZ1bmN0aW9uKGMpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIHdpbiA9IHRoaXMud2luO1xuICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBVdGlscy5pc1ZhbHVlKGMpID8gYyA6IGVsZW1lbnQuYXR0cihcImRhdGEtY29udGVudFwiKTtcbiAgICAgICAgICAgIHZhciByZXN1bHQ7XG5cbiAgICAgICAgICAgIGlmICghVXRpbHMuaXNRKGNvbnRlbnQpICYmIFV0aWxzLmlzRnVuYyhjb250ZW50KSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IFV0aWxzLmV4ZWMoY29udGVudCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKFV0aWxzLmlzUShjb250ZW50KSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNvbnRlbnQuaHRtbCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBjb250ZW50O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB3aW4uZmluZChcIi53aW5kb3ctY29udGVudFwiKS5odG1sKHJlc3VsdCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0VGl0bGU6IGZ1bmN0aW9uKHQpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIHdpbiA9IHRoaXMud2luO1xuICAgICAgICAgICAgdmFyIHRpdGxlID0gVXRpbHMuaXNWYWx1ZSh0KSA/IHQgOiBlbGVtZW50LmF0dHIoXCJkYXRhLXRpdGxlXCIpO1xuICAgICAgICAgICAgd2luLmZpbmQoXCIud2luZG93LWNhcHRpb24gLnRpdGxlXCIpLmh0bWwodGl0bGUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldEljb246IGZ1bmN0aW9uKGkpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIHdpbiA9IHRoaXMud2luO1xuICAgICAgICAgICAgdmFyIGljb24gPSBVdGlscy5pc1ZhbHVlKGkpID8gaSA6IGVsZW1lbnQuYXR0cihcImRhdGEtaWNvblwiKTtcbiAgICAgICAgICAgIHdpbi5maW5kKFwiLndpbmRvdy1jYXB0aW9uIC5pY29uXCIpLmh0bWwoaWNvbik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0SWNvbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLndpbi5maW5kKFwiLndpbmRvdy1jYXB0aW9uIC5pY29uXCIpLmh0bWwoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRUaXRsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLndpbi5maW5kKFwiLndpbmRvdy1jYXB0aW9uIC50aXRsZVwiKS5odG1sKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlRHJhZ2dhYmxlOiBmdW5jdGlvbihmKXtcbiAgICAgICAgICAgIHZhciB3aW4gPSB0aGlzLndpbjtcbiAgICAgICAgICAgIHZhciBmbGFnID0gVXRpbHMuYm9vbChmKTtcbiAgICAgICAgICAgIHZhciBkcmFnID0gTWV0cm8uZ2V0UGx1Z2luKHdpbiwgXCJkcmFnZ2FibGVcIik7XG4gICAgICAgICAgICBpZiAoZmxhZyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGRyYWcub24oKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZHJhZy5vZmYoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGVSZXNpemFibGU6IGZ1bmN0aW9uKGYpe1xuICAgICAgICAgICAgdmFyIHdpbiA9IHRoaXMud2luO1xuICAgICAgICAgICAgdmFyIGZsYWcgPSBVdGlscy5ib29sKGYpO1xuICAgICAgICAgICAgdmFyIHJlc2l6ZSA9IE1ldHJvLmdldFBsdWdpbih3aW4sIFwicmVzaXphYmxlXCIpO1xuICAgICAgICAgICAgaWYgKGZsYWcgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICByZXNpemUub24oKTtcbiAgICAgICAgICAgICAgICB3aW4uZmluZChcIi5yZXNpemUtZWxlbWVudFwiKS5yZW1vdmVDbGFzcyhcInJlc2l6ZS1lbGVtZW50LWRpc2FibGVkXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXNpemUub2ZmKCk7XG4gICAgICAgICAgICAgICAgd2luLmZpbmQoXCIucmVzaXplLWVsZW1lbnRcIikuYWRkQ2xhc3MoXCJyZXNpemUtZWxlbWVudC1kaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VQbGFjZTogZnVuY3Rpb24gKHApIHtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCB3aW4gPSB0aGlzLndpbjtcbiAgICAgICAgICAgIHZhciBwbGFjZSA9IFV0aWxzLmlzVmFsdWUocCkgPyBwIDogZWxlbWVudC5hdHRyKFwiZGF0YS1wbGFjZVwiKTtcbiAgICAgICAgICAgIHdpbi5hZGRDbGFzcyhwbGFjZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcG9zOiBmdW5jdGlvbih0b3AsIGxlZnQpe1xuICAgICAgICAgICAgdmFyIHdpbiA9IHRoaXMud2luO1xuICAgICAgICAgICAgd2luLmNzcyh7XG4gICAgICAgICAgICAgICAgdG9wOiB0b3AsXG4gICAgICAgICAgICAgICAgbGVmdDogbGVmdFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICB0b3A6IGZ1bmN0aW9uKHYpe1xuICAgICAgICAgICAgdGhpcy53aW4uY3NzKHtcbiAgICAgICAgICAgICAgICB0b3A6IHZcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbGVmdDogZnVuY3Rpb24odil7XG4gICAgICAgICAgICB0aGlzLndpbi5jc3Moe1xuICAgICAgICAgICAgICAgIGxlZnQ6IHZcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlQXR0cmlidXRlOiBmdW5jdGlvbihhdHRyLCB2YWx1ZSl7XG4gICAgICAgICAgICB2YXIgY2hhbmdlUG9zID0gZnVuY3Rpb24oYSwgdil7XG4gICAgICAgICAgICAgICAgdmFyIHdpbiA9IHRoaXMud2luO1xuICAgICAgICAgICAgICAgIHZhciBwb3M7XG4gICAgICAgICAgICAgICAgaWYgKGEgPT09IFwiZGF0YS10b3BcIikge1xuICAgICAgICAgICAgICAgICAgICBwb3MgPSBwYXJzZUludCh2KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc05hTihwb3MpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHdpbi5jc3MoXCJ0b3BcIiwgcG9zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGEgPT09IFwiZGF0YS1sZWZ0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zID0gcGFyc2VJbnQodik7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNOYU4ocG9zKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB3aW4uY3NzKFwibGVmdFwiLCBwb3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciB0b2dnbGVCdXR0b25zID0gZnVuY3Rpb24oYSwgdikge1xuICAgICAgICAgICAgICAgIHZhciB3aW4gPSB0aGlzLndpbjtcbiAgICAgICAgICAgICAgICB2YXIgYnRuQ2xvc2UgPSB3aW4uZmluZChcIi5idG4tY2xvc2VcIik7XG4gICAgICAgICAgICAgICAgdmFyIGJ0bk1pbiA9IHdpbi5maW5kKFwiLmJ0bi1taW5cIik7XG4gICAgICAgICAgICAgICAgdmFyIGJ0bk1heCA9IHdpbi5maW5kKFwiLmJ0bi1tYXhcIik7XG4gICAgICAgICAgICAgICAgdmFyIF92ID0gVXRpbHMuYm9vbCh2KTtcbiAgICAgICAgICAgICAgICB2YXIgZnVuYyA9IF92ID8gXCJzaG93XCIgOiBcImhpZGVcIjtcblxuICAgICAgICAgICAgICAgIHN3aXRjaCAoYSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1idG4tY2xvc2VcIjogYnRuQ2xvc2VbZnVuY10oKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLWJ0bi1taW5cIjogYnRuTWluW2Z1bmNdKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1idG4tbWF4XCI6IGJ0bk1heFtmdW5jXSgpOyBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgY2hhbmdlU2l6ZSA9IGZ1bmN0aW9uKGEsIHYpe1xuICAgICAgICAgICAgICAgIHZhciB3aW4gPSB0aGlzLndpbjtcbiAgICAgICAgICAgICAgICBpZiAoYSA9PT0gXCJkYXRhLXdpZHRoXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgd2luLmNzcyhcIndpZHRoXCIsICt2KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGEgPT09IFwiZGF0YS1oZWlnaHRcIikge1xuICAgICAgICAgICAgICAgICAgICB3aW4uY3NzKFwiaGVpZ2h0XCIsICt2KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzd2l0Y2ggKGF0dHIpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1idG4tY2xvc2VcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1idG4tbWluXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtYnRuLW1heFwiOiB0b2dnbGVCdXR0b25zKGF0dHIsIHZhbHVlKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtd2lkdGhcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1oZWlnaHRcIjogY2hhbmdlU2l6ZShhdHRyLCB2YWx1ZSk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLWNscy13aW5kb3dcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1jbHMtY2FwdGlvblwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLWNscy1jb250ZW50XCI6IHRoaXMuY2hhbmdlQ2xhc3MoYXR0cik7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLXNoYWRvd1wiOiB0aGlzLnRvZ2dsZVNoYWRvdygpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS1pY29uXCI6IHRoaXMuc2V0SWNvbigpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZGF0YS10aXRsZVwiOiB0aGlzLnNldFRpdGxlKCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLWNvbnRlbnRcIjogdGhpcy5zZXRDb250ZW50KCk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLWRyYWdnYWJsZVwiOiB0aGlzLnRvZ2dsZURyYWdnYWJsZSh2YWx1ZSk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLXJlc2l6YWJsZVwiOiB0aGlzLnRvZ2dsZVJlc2l6YWJsZSh2YWx1ZSk7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLXRvcFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJkYXRhLWxlZnRcIjogY2hhbmdlUG9zKGF0dHIsIHZhbHVlKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRhdGEtcGxhY2VcIjogdGhpcy5jaGFuZ2VQbGFjZSgpOyBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgTWV0cm9bJ3dpbmRvdyddID0ge1xuXG4gICAgICAgIGlzV2luZG93OiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICByZXR1cm4gVXRpbHMuaXNNZXRyb09iamVjdChlbCwgXCJ3aW5kb3dcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbWluOiBmdW5jdGlvbihlbCwgYSl7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNXaW5kb3coZWwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKGVsLFwid2luZG93XCIpLm1pbihhKTtcbiAgICAgICAgfSxcblxuICAgICAgICBtYXg6IGZ1bmN0aW9uKGVsLCBhKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc1dpbmRvdyhlbCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBNZXRyby5nZXRQbHVnaW4oZWwsIFwid2luZG93XCIpLm1heChhKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzaG93OiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNXaW5kb3coZWwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKGVsLCBcIndpbmRvd1wiKS5zaG93KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGlkZTogZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzV2luZG93KGVsKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbihlbCwgXCJ3aW5kb3dcIikuaGlkZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZTogZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzV2luZG93KGVsKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbihlbCwgXCJ3aW5kb3dcIikudG9nZ2xlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNPcGVuOiBmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNXaW5kb3coZWwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHdpbiA9IE1ldHJvLmdldFBsdWdpbihlbCxcIndpbmRvd1wiKTtcbiAgICAgICAgICAgIHJldHVybiB3aW4uaXNPcGVuKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc1dpbmRvdyhlbCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBNZXRyby5nZXRQbHVnaW4oZWwsIFwid2luZG93XCIpLmNsb3NlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcG9zOiBmdW5jdGlvbihlbCwgdG9wLCBsZWZ0KXtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc1dpbmRvdyhlbCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBNZXRyby5nZXRQbHVnaW4oZWwsIFwid2luZG93XCIpLnBvcyh0b3AsIGxlZnQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvcDogZnVuY3Rpb24oZWwsIHRvcCl7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNXaW5kb3coZWwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKGVsLCBcIndpbmRvd1wiKS50b3AodG9wKTtcbiAgICAgICAgfSxcblxuICAgICAgICBsZWZ0OiBmdW5jdGlvbihlbCwgbGVmdCl7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNXaW5kb3coZWwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKGVsLCBcIndpbmRvd1wiKS5sZWZ0KGxlZnQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHdpZHRoOiBmdW5jdGlvbihlbCwgd2lkdGgpe1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzV2luZG93KGVsKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE1ldHJvLmdldFBsdWdpbihlbCwgXCJ3aW5kb3dcIikud2lkdGgod2lkdGgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhlaWdodDogZnVuY3Rpb24oZWwsIGhlaWdodCl7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNXaW5kb3coZWwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTWV0cm8uZ2V0UGx1Z2luKGVsLCBcIndpbmRvd1wiKS5oZWlnaHQoaGVpZ2h0KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKG9wdGlvbnMsIHBhcmVudCl7XG4gICAgICAgICAgICB2YXIgdztcblxuICAgICAgICAgICAgdyA9ICQoXCI8ZGl2PlwiKS5hcHBlbmRUbyhwYXJlbnQgPyAkKHBhcmVudCkgOiAkKFwiYm9keVwiKSk7XG5cbiAgICAgICAgICAgIHZhciB3X29wdGlvbnMgPSAkLmV4dGVuZCh7XG4gICAgICAgICAgICAgICAgX3J1bnRpbWU6IHRydWVcbiAgICAgICAgICAgIH0sIChvcHRpb25zID8gb3B0aW9ucyA6IHt9KSk7XG5cbiAgICAgICAgICAgIHJldHVybiBNZXRyby5tYWtlUGx1Z2luKHcsIFwid2luZG93XCIsIHdfb3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICB9O1xufShNZXRybywgbTRxKSk7XHJcblxyXG4oZnVuY3Rpb24oTWV0cm8sICQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFV0aWxzID0gTWV0cm8udXRpbHM7XG4gICAgdmFyIFdpemFyZERlZmF1bHRDb25maWcgPSB7XG4gICAgICAgIHdpemFyZERlZmVycmVkOiAwLFxuICAgICAgICBzdGFydDogMSxcbiAgICAgICAgZmluaXNoOiAwLFxuICAgICAgICBpY29uSGVscDogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLWhlbHAnPjwvc3Bhbj5cIixcbiAgICAgICAgaWNvblByZXY6IFwiPHNwYW4gY2xhc3M9J2RlZmF1bHQtaWNvbi1sZWZ0LWFycm93Jz48L3NwYW4+XCIsXG4gICAgICAgIGljb25OZXh0OiBcIjxzcGFuIGNsYXNzPSdkZWZhdWx0LWljb24tcmlnaHQtYXJyb3cnPjwvc3Bhbj5cIixcbiAgICAgICAgaWNvbkZpbmlzaDogXCI8c3BhbiBjbGFzcz0nZGVmYXVsdC1pY29uLWNoZWNrJz48L3NwYW4+XCIsXG5cbiAgICAgICAgYnV0dG9uTW9kZTogXCJjeWNsZVwiLCAvLyBkZWZhdWx0LCBjeWNsZSwgc3F1YXJlXG4gICAgICAgIGJ1dHRvbk91dGxpbmU6IHRydWUsXG4gICAgICAgIGR1cmF0aW9uOiAzMDAsXG5cbiAgICAgICAgY2xzV2l6YXJkOiBcIlwiLFxuICAgICAgICBjbHNBY3Rpb25zOiBcIlwiLFxuICAgICAgICBjbHNIZWxwOiBcIlwiLFxuICAgICAgICBjbHNQcmV2OiBcIlwiLFxuICAgICAgICBjbHNOZXh0OiBcIlwiLFxuICAgICAgICBjbHNGaW5pc2g6IFwiXCIsXG5cbiAgICAgICAgb25QYWdlOiBNZXRyby5ub29wLFxuICAgICAgICBvbk5leHRQYWdlOiBNZXRyby5ub29wLFxuICAgICAgICBvblByZXZQYWdlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkZpcnN0UGFnZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25MYXN0UGFnZTogTWV0cm8ubm9vcCxcbiAgICAgICAgb25GaW5pc2hQYWdlOiBNZXRyby5ub29wLFxuICAgICAgICBvbkhlbHBDbGljazogTWV0cm8ubm9vcCxcbiAgICAgICAgb25QcmV2Q2xpY2s6IE1ldHJvLm5vb3AsXG4gICAgICAgIG9uTmV4dENsaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvbkZpbmlzaENsaWNrOiBNZXRyby5ub29wLFxuICAgICAgICBvbkJlZm9yZVByZXY6IE1ldHJvLm5vb3BfdHJ1ZSxcbiAgICAgICAgb25CZWZvcmVOZXh0OiBNZXRyby5ub29wX3RydWUsXG4gICAgICAgIG9uV2l6YXJkQ3JlYXRlOiBNZXRyby5ub29wXG4gICAgfTtcblxuICAgIE1ldHJvLndpemFyZFNldHVwID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgV2l6YXJkRGVmYXVsdENvbmZpZyA9ICQuZXh0ZW5kKHt9LCBXaXphcmREZWZhdWx0Q29uZmlnLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3dbXCJtZXRyb1dpemFyZFNldHVwXCJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgTWV0cm8ud2l6YXJkU2V0dXAod2luZG93W1wibWV0cm9XaXphcmRTZXR1cFwiXSk7XG4gICAgfVxuXG4gICAgTWV0cm8uQ29tcG9uZW50KCd3aXphcmQnLCB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zLCBlbGVtICkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoZWxlbSwgb3B0aW9ucywgV2l6YXJkRGVmYXVsdENvbmZpZywge1xuICAgICAgICAgICAgICAgIGlkOiBVdGlscy5lbGVtZW50SWQoJ3dpemFyZCcpXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVXaXphcmQoKTtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJ3aXphcmQtY3JlYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBfY3JlYXRlV2l6YXJkOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgYmFyO1xuXG4gICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwid2l6YXJkXCIpLmFkZENsYXNzKG8udmlldykuYWRkQ2xhc3Moby5jbHNXaXphcmQpO1xuXG4gICAgICAgICAgICBiYXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJhY3Rpb24tYmFyXCIpLmFkZENsYXNzKG8uY2xzQWN0aW9ucykuYXBwZW5kVG8oZWxlbWVudCk7XG5cbiAgICAgICAgICAgIHZhciBidXR0b25Nb2RlID0gby5idXR0b25Nb2RlID09PSBcImJ1dHRvblwiID8gXCJcIiA6IG8uYnV0dG9uTW9kZTtcbiAgICAgICAgICAgIGlmIChvLmJ1dHRvbk91dGxpbmUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBidXR0b25Nb2RlICs9IFwiIG91dGxpbmVcIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG8uaWNvbkhlbHAgIT09IGZhbHNlKSAkKFwiPGJ1dHRvbj5cIikuYXR0cihcInR5cGVcIiwgXCJidXR0b25cIikuYWRkQ2xhc3MoXCJidXR0b24gd2l6YXJkLWJ0bi1oZWxwXCIpLmFkZENsYXNzKGJ1dHRvbk1vZGUpLmFkZENsYXNzKG8uY2xzSGVscCkuaHRtbChVdGlscy5pc1RhZyhvLmljb25IZWxwKSA/IG8uaWNvbkhlbHAgOiAkKFwiPGltZz5cIikuYXR0cignc3JjJywgby5pY29uSGVscCkpLmFwcGVuZFRvKGJhcik7XG4gICAgICAgICAgICBpZiAoby5pY29uUHJldiAhPT0gZmFsc2UpICQoXCI8YnV0dG9uPlwiKS5hdHRyKFwidHlwZVwiLCBcImJ1dHRvblwiKS5hZGRDbGFzcyhcImJ1dHRvbiB3aXphcmQtYnRuLXByZXZcIikuYWRkQ2xhc3MoYnV0dG9uTW9kZSkuYWRkQ2xhc3Moby5jbHNQcmV2KS5odG1sKFV0aWxzLmlzVGFnKG8uaWNvblByZXYpID8gby5pY29uUHJldiA6ICQoXCI8aW1nPlwiKS5hdHRyKCdzcmMnLCBvLmljb25QcmV2KSkuYXBwZW5kVG8oYmFyKTtcbiAgICAgICAgICAgIGlmIChvLmljb25OZXh0ICE9PSBmYWxzZSkgJChcIjxidXR0b24+XCIpLmF0dHIoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpLmFkZENsYXNzKFwiYnV0dG9uIHdpemFyZC1idG4tbmV4dFwiKS5hZGRDbGFzcyhidXR0b25Nb2RlKS5hZGRDbGFzcyhvLmNsc05leHQpLmh0bWwoVXRpbHMuaXNUYWcoby5pY29uTmV4dCkgPyBvLmljb25OZXh0IDogJChcIjxpbWc+XCIpLmF0dHIoJ3NyYycsIG8uaWNvbk5leHQpKS5hcHBlbmRUbyhiYXIpO1xuICAgICAgICAgICAgaWYgKG8uaWNvbkZpbmlzaCAhPT0gZmFsc2UpICQoXCI8YnV0dG9uPlwiKS5hdHRyKFwidHlwZVwiLCBcImJ1dHRvblwiKS5hZGRDbGFzcyhcImJ1dHRvbiB3aXphcmQtYnRuLWZpbmlzaFwiKS5hZGRDbGFzcyhidXR0b25Nb2RlKS5hZGRDbGFzcyhvLmNsc0ZpbmlzaCkuaHRtbChVdGlscy5pc1RhZyhvLmljb25GaW5pc2gpID8gby5pY29uRmluaXNoIDogJChcIjxpbWc+XCIpLmF0dHIoJ3NyYycsIG8uaWNvbkZpbmlzaCkpLmFwcGVuZFRvKGJhcik7XG5cbiAgICAgICAgICAgIHRoaXMudG9QYWdlKG8uc3RhcnQpO1xuXG4gICAgICAgICAgICB0aGlzLl9zZXRIZWlnaHQoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfc2V0SGVpZ2h0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgcGFnZXMgPSBlbGVtZW50LmNoaWxkcmVuKFwic2VjdGlvblwiKTtcbiAgICAgICAgICAgIHZhciBtYXhfaGVpZ2h0ID0gMDtcblxuICAgICAgICAgICAgcGFnZXMuY2hpbGRyZW4oXCIucGFnZS1jb250ZW50XCIpLmNzcyhcIm1heC1oZWlnaHRcIiwgXCJub25lXCIpO1xuXG4gICAgICAgICAgICAkLmVhY2gocGFnZXMsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyIGggPSAkKHRoaXMpLmhlaWdodCgpO1xuICAgICAgICAgICAgICAgIGlmIChtYXhfaGVpZ2h0IDwgcGFyc2VJbnQoaCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbWF4X2hlaWdodCA9IGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuaGVpZ2h0KG1heF9oZWlnaHQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9jcmVhdGVFdmVudHM6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi53aXphcmQtYnRuLWhlbHBcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgcGFnZXMgPSBlbGVtZW50LmNoaWxkcmVuKFwic2VjdGlvblwiKTtcbiAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IHBhZ2VzLmdldCh0aGF0LmN1cnJlbnQgLSAxKTtcblxuICAgICAgICAgICAgICAgIHRoYXQuX2ZpcmVFdmVudChcImhlbHAtY2xpY2tcIiwge1xuICAgICAgICAgICAgICAgICAgICBpbmRleDogdGhhdC5jdXJyZW50LFxuICAgICAgICAgICAgICAgICAgICBwYWdlOiBwYWdlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5vbihNZXRyby5ldmVudHMuY2xpY2ssIFwiLndpemFyZC1idG4tcHJldlwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQucHJldigpO1xuICAgICAgICAgICAgICAgIHZhciBwYWdlcyA9IGVsZW1lbnQuY2hpbGRyZW4oXCJzZWN0aW9uXCIpO1xuICAgICAgICAgICAgICAgIHZhciBwYWdlID0gcGFnZXMuZ2V0KHRoYXQuY3VycmVudCAtIDEpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwicHJldi1jbGlja1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIGluZGV4OiB0aGF0LmN1cnJlbnQsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50Lm9uKE1ldHJvLmV2ZW50cy5jbGljaywgXCIud2l6YXJkLWJ0bi1uZXh0XCIsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5uZXh0KCk7XG4gICAgICAgICAgICAgICAgdmFyIHBhZ2VzID0gZWxlbWVudC5jaGlsZHJlbihcInNlY3Rpb25cIik7XG4gICAgICAgICAgICAgICAgdmFyIHBhZ2UgPSBwYWdlcy5nZXQodGhhdC5jdXJyZW50IC0gMSk7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9maXJlRXZlbnQoXCJuZXh0LWNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXg6IHRoYXQuY3VycmVudCxcbiAgICAgICAgICAgICAgICAgICAgcGFnZTogcGFnZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi53aXphcmQtYnRuLWZpbmlzaFwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBwYWdlcyA9IGVsZW1lbnQuY2hpbGRyZW4oXCJzZWN0aW9uXCIpO1xuICAgICAgICAgICAgICAgIHZhciBwYWdlID0gcGFnZXMuZ2V0KHRoYXQuY3VycmVudCAtIDEpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5fZmlyZUV2ZW50KFwiZmluaXNoLWNsaWNrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXg6IHRoYXQuY3VycmVudCxcbiAgICAgICAgICAgICAgICAgICAgcGFnZTogcGFnZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub24oTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi5jb21wbGV0ZVwiLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9ICQodGhpcykuaW5kZXgoKSArIDE7XG4gICAgICAgICAgICAgICAgdGhhdC50b1BhZ2UoaW5kZXgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQod2luZG93KS5vbihNZXRyby5ldmVudHMucmVzaXplLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoYXQuX3NldEhlaWdodCgpO1xuICAgICAgICAgICAgfSwge25zOiB0aGlzLmlkfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbmV4dDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgICAgIHZhciBwYWdlcyA9IGVsZW1lbnQuY2hpbGRyZW4oXCJzZWN0aW9uXCIpO1xuICAgICAgICAgICAgdmFyIHBhZ2UgPSAkKGVsZW1lbnQuY2hpbGRyZW4oXCJzZWN0aW9uXCIpLmdldCh0aGlzLmN1cnJlbnQgLSAxKSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnQgKyAxID4gcGFnZXMubGVuZ3RoIHx8IFV0aWxzLmV4ZWMoby5vbkJlZm9yZU5leHQsIFt0aGlzLmN1cnJlbnQsIHBhZ2UsIGVsZW1lbnRdKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnQrKztcblxuICAgICAgICAgICAgdGhpcy50b1BhZ2UodGhpcy5jdXJyZW50KTtcblxuICAgICAgICAgICAgcGFnZSA9ICQoZWxlbWVudC5jaGlsZHJlbihcInNlY3Rpb25cIikuZ2V0KHRoaXMuY3VycmVudCAtIDEpKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwibmV4dC1wYWdlXCIsIHtcbiAgICAgICAgICAgICAgICBpbmRleDogdGhhdC5jdXJyZW50LFxuICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2VbMF1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHByZXY6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsIG8gPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgcGFnZSA9ICQoZWxlbWVudC5jaGlsZHJlbihcInNlY3Rpb25cIikuZ2V0KHRoaXMuY3VycmVudCAtIDEpKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudCAtIDEgPT09IDAgfHwgVXRpbHMuZXhlYyhvLm9uQmVmb3JlUHJldiwgW3RoaXMuY3VycmVudCwgcGFnZSwgZWxlbWVudF0pID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuY3VycmVudC0tO1xuXG4gICAgICAgICAgICB0aGlzLnRvUGFnZSh0aGlzLmN1cnJlbnQpO1xuXG4gICAgICAgICAgICBwYWdlID0gJChlbGVtZW50LmNoaWxkcmVuKFwic2VjdGlvblwiKS5nZXQodGhpcy5jdXJyZW50IC0gMSkpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJwcmV2LXBhZ2VcIiwge1xuICAgICAgICAgICAgICAgIGluZGV4OiB0aGF0LmN1cnJlbnQsXG4gICAgICAgICAgICAgICAgcGFnZTogcGFnZVswXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbGFzdDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgICAgIHZhciBwYWdlO1xuXG4gICAgICAgICAgICB0aGlzLnRvUGFnZShlbGVtZW50LmNoaWxkcmVuKFwic2VjdGlvblwiKS5sZW5ndGgpO1xuXG4gICAgICAgICAgICBwYWdlID0gJChlbGVtZW50LmNoaWxkcmVuKFwic2VjdGlvblwiKS5nZXQodGhpcy5jdXJyZW50IC0gMSkpO1xuXG4gICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJsYXN0LXBhZ2VcIiwge1xuICAgICAgICAgICAgICAgIGluZGV4OiB0aGF0LmN1cnJlbnQsXG4gICAgICAgICAgICAgICAgcGFnZTogcGFnZVswXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZmlyc3Q6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgcGFnZTtcblxuICAgICAgICAgICAgdGhpcy50b1BhZ2UoMSk7XG5cbiAgICAgICAgICAgIHBhZ2UgPSAkKGVsZW1lbnQuY2hpbGRyZW4oXCJzZWN0aW9uXCIpLmdldCgwKSk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZpcmVFdmVudChcImZpcnN0LXBhZ2VcIiwge1xuICAgICAgICAgICAgICAgIGluZGV4OiB0aGF0LmN1cnJlbnQsXG4gICAgICAgICAgICAgICAgcGFnZTogcGFnZVswXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9QYWdlOiBmdW5jdGlvbihwYWdlKXtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQoZWxlbWVudC5jaGlsZHJlbihcInNlY3Rpb25cIikuZ2V0KHBhZ2UgLSAxKSk7XG4gICAgICAgICAgICB2YXIgc2VjdGlvbnMgPSBlbGVtZW50LmNoaWxkcmVuKFwic2VjdGlvblwiKTtcbiAgICAgICAgICAgIHZhciBhY3Rpb25zID0gZWxlbWVudC5maW5kKFwiLmFjdGlvbi1iYXJcIik7XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGZpbmlzaCA9IGVsZW1lbnQuZmluZChcIi53aXphcmQtYnRuLWZpbmlzaFwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgdmFyIG5leHQgPSBlbGVtZW50LmZpbmQoXCIud2l6YXJkLWJ0bi1uZXh0XCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICB2YXIgcHJldiA9IGVsZW1lbnQuZmluZChcIi53aXphcmQtYnRuLXByZXZcIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcblxuICAgICAgICAgICAgdGhpcy5jdXJyZW50ID0gcGFnZTtcblxuICAgICAgICAgICAgZWxlbWVudC5jaGlsZHJlbihcInNlY3Rpb25cIilcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJjb21wbGV0ZSBjdXJyZW50XCIpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKG8uY2xzQ3VycmVudClcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3Moby5jbHNDb21wbGV0ZSk7XG5cbiAgICAgICAgICAgIHRhcmdldC5hZGRDbGFzcyhcImN1cnJlbnRcIikuYWRkQ2xhc3Moby5jbHNDdXJyZW50KTtcbiAgICAgICAgICAgIHRhcmdldC5wcmV2QWxsKCkuYWRkQ2xhc3MoXCJjb21wbGV0ZVwiKS5hZGRDbGFzcyhvLmNsc0NvbXBsZXRlKTtcblxuICAgICAgICAgICAgdmFyIGJvcmRlcl9zaXplID0gZWxlbWVudC5jaGlsZHJlbihcInNlY3Rpb24uY29tcGxldGVcIikubGVuZ3RoID09PSAwID8gMCA6IHBhcnNlSW50KFV0aWxzLmdldFN0eWxlT25lKGVsZW1lbnQuY2hpbGRyZW4oXCJzZWN0aW9uLmNvbXBsZXRlXCIpWzBdLCBcImJvcmRlci1sZWZ0LXdpZHRoXCIpKTtcblxuICAgICAgICAgICAgYWN0aW9ucy5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBkcmF3OiB7XG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IGVsZW1lbnQuY2hpbGRyZW4oXCJzZWN0aW9uLmNvbXBsZXRlXCIpLmxlbmd0aCAqIGJvcmRlcl9zaXplICsgNDFcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGR1cjogby5kdXJhdGlvblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAodGhpcy5jdXJyZW50ID09PSBzZWN0aW9ucy5sZW5ndGgpIHx8IChvLmZpbmlzaCA+IDAgJiYgdGhpcy5jdXJyZW50ID49IG8uZmluaXNoKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgZmluaXNoLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChwYXJzZUludChvLmZpbmlzaCkgPiAwICYmIHRoaXMuY3VycmVudCA9PT0gcGFyc2VJbnQoby5maW5pc2gpKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9maXJlRXZlbnQoXCJmaW5pc2gtcGFnZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGluZGV4OiB0aGlzLmN1cnJlbnQsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2U6IHRhcmdldFswXVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50IDwgc2VjdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgbmV4dC5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50ID4gMSkge1xuICAgICAgICAgICAgICAgIHByZXYucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fZmlyZUV2ZW50KFwicGFnZVwiLCB7XG4gICAgICAgICAgICAgICAgaW5kZXg6IHRoaXMuY3VycmVudCxcbiAgICAgICAgICAgICAgICBwYWdlOiB0YXJnZXRbMF1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZUF0dHJpYnV0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIud2l6YXJkLWJ0bi1oZWxwXCIpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoTWV0cm8uZXZlbnRzLmNsaWNrLCBcIi53aXphcmQtYnRuLXByZXZcIik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLndpemFyZC1idG4tbmV4dFwiKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmKE1ldHJvLmV2ZW50cy5jbGljaywgXCIud2l6YXJkLWJ0bi1maW5pc2hcIik7XG4gICAgICAgICAgICBlbGVtZW50Lm9mZihNZXRyby5ldmVudHMuY2xpY2ssIFwiLmNvbXBsZXRlXCIpO1xuICAgICAgICAgICAgJCh3aW5kb3cpLm9mZihNZXRyby5ldmVudHMucmVzaXplLHtuczogdGhpcy5pZH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuICAgIH0pO1xufShNZXRybywgbTRxKSk7Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/metro4/build/js/metro.js\n");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	!function() {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = function(module) {
/******/ 			var getter = module && module.__esModule ?
/******/ 				function() { return module['default']; } :
/******/ 				function() { return module; };
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	}();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	!function() {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = function(exports, definition) {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	}();
/******/ 	
/******/ 	/* webpack/runtime/global */
/******/ 	!function() {
/******/ 		__webpack_require__.g = (function() {
/******/ 			if (typeof globalThis === 'object') return globalThis;
/******/ 			try {
/******/ 				return this || new Function('return this')();
/******/ 			} catch (e) {
/******/ 				if (typeof window === 'object') return window;
/******/ 			}
/******/ 		})();
/******/ 	}();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	!function() {
/******/ 		__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }
/******/ 	}();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	!function() {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = function(exports) {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	}();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval-source-map devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./resources/js/page/attendee/index.js");
/******/ 	
/******/ })()
;